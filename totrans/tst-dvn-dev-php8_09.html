<html><head></head><body>
<div id="_idContainer142">
<h1 class="chapter-number" id="_idParaDest-137"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-138"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.2.1">Continuous Integration</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the previous chapters, we went through the software development process of a toy car model inventory solution. </span><span class="koboSpan" id="kobo.3.2">We followed the test-driven development process, and at this stage, we should now be familiar with it. </span><span class="koboSpan" id="kobo.3.3">However, there are still a lot of missing features in the software that we are building. </span><span class="koboSpan" id="kobo.3.4">In this chapter, we will start with an almost complete solution that you can get from the GitHub repository for this chapter. </span><span class="koboSpan" id="kobo.3.5">We will then make sure our </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">solution works.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, we’ll start with an almost complete software solution except for the missing last feature, which is to filter the table containing the toy car models. </span><span class="koboSpan" id="kobo.5.2">We have built a lot of tests; wouldn’t it be great if we could automatically trigger the execution of these tests whenever we created a pull request to the develop or main branch? </span><span class="koboSpan" id="kobo.5.3">Automatically triggering the test suites that we have spent so much time developing will help us catch bugs or defects before they even get merged into the main branch. </span><span class="koboSpan" id="kobo.5.4">This is where continuous integration will be able to help us. </span></p>
<p><span class="koboSpan" id="kobo.6.1">In this chapter, we will go through the </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.8.1">Running and passing all the Symfony </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">application tests</span></span></li>
<li><span class="koboSpan" id="kobo.10.1">Using Bitbucket Pipelines for </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">continuous integration</span></span></li>
</ul>
<h1 id="_idParaDest-139"><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.12.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.13.1">In this chapter, you are expected to have basic knowledge of using Git version control for web applications. </span><span class="koboSpan" id="kobo.13.2">You should also use the development environment and solution code from this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">repository: </span></span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%209"><span class="No-Break"><span class="koboSpan" id="kobo.15.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%209</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.16.1">.</span></span></p>
<h2 id="_idParaDest-140"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.17.1">Preparing the development environment for this chapter</span></h2>
<p><span class="koboSpan" id="kobo.18.1">First, download the code found </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">at </span></span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%209"><span class="No-Break"><span class="koboSpan" id="kobo.20.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%209</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.21.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.22.1">To run the containers and execute the commands in this chapter, you should be inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.23.1">docker-server-web-1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.24.1"> container.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">Run the following command to confirm the container name for our </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">web server:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.27.1">
docker ps</span></pre>
<p><span class="koboSpan" id="kobo.28.1">To run the containers, run the following command from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.29.1">/docker</span></strong><span class="koboSpan" id="kobo.30.1"> directory from the repository in your </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">host machine:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.32.1">
docker-compose build &amp;&amp; docker-compose up -d
docker exec -it docker-server-web-1 /bin/bash</span></pre>
<p><span class="koboSpan" id="kobo.33.1">Once inside the container, run the following commands to install the libraries required </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">through Composer:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.35.1">
/var/www/html/symfony# ./setup.sh
/var/www/html/behat# ./setup.sh </span></pre>
<h1 id="_idParaDest-141"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.36.1">Running and passing all the Symfony application tests</span></h1>
<p><span class="koboSpan" id="kobo.37.1">In the previous chapter, we</span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.38.1"> started writing</span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.39.1"> solution code by trying to follow the SOLID principles. </span><span class="koboSpan" id="kobo.39.2">To develop the other parts of the application, we can just continue following the same process. </span><span class="koboSpan" id="kobo.39.3">In this chapter, I have taken the liberty to complete all other tests and the solution code needed to pass those tests. </span><span class="koboSpan" id="kobo.39.4">We will go through the tests and make sure </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">they pass.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.41.1">Setting up the local environment</span></h2>
<p><span class="koboSpan" id="kobo.42.1">Check out the source</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.43.1"> code provided in the </span><em class="italic"><span class="koboSpan" id="kobo.44.1">Technical requirements</span></em><span class="koboSpan" id="kobo.45.1"> section into your local development machine and run the following commands from the host machine to configure your </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">development environment:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.47.1">
$ cd docker
$ docker-compose build &amp;&amp; docker-compose up -d</span></pre>
<p><span class="koboSpan" id="kobo.48.1">After running these commands, make sure that the containers we built earlier in this book are up and running by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.50.1">
$ docker ps</span></pre>
<p><span class="koboSpan" id="kobo.51.1">You should see the following Docker </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">container names:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.53.1">
docker_server-web_1
docker_app-phpmyadmin_1
docker_server-mysql_1</span></pre>
<p><span class="koboSpan" id="kobo.54.1">Now that the containers</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.55.1"> are running, we need to prepare the Symfony and Behat applications running inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">docker_server-web_1</span></strong><span class="koboSpan" id="kobo.57.1"> container by installing the packages they depend on, as well as creating the database and tables that our example PHP </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">application needs.</span></span></p>
<h3><span class="koboSpan" id="kobo.59.1">Preparing the Symfony application and tests</span></h3>
<p><span class="koboSpan" id="kobo.60.1">Now, let’s set up the required database tables</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.61.1"> and libraries needed by our Symfony</span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.62.1"> application. </span><span class="koboSpan" id="kobo.62.2">While still inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">docker</span></strong><span class="koboSpan" id="kobo.64.1"> directory, run the following command from your </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">host machine:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.66.1">
$ docker exec -i docker_server-web_1 /var/www/html/symfony/setup.sh</span></pre>
<p><span class="koboSpan" id="kobo.67.1">Alternatively, run the following command inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">docker_server-web_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.69.1"> container:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.70.1">
/var/www/html/symfony# ./setup.sh</span></pre>
<p><span class="koboSpan" id="kobo.71.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">setup.sh</span></strong><span class="koboSpan" id="kobo.73.1"> file is just a shell script I have added to easily configure our Symfony application and prepare the database and tables we need to run </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">the tests.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">If you open the following shell file, you will see that we are simply running some Doctrine commands and using Composer to install all the Symfony </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">dependencies needed:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.77.1">codebase/symfony/setup.sh</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.78.1">
#!/bin/bash
composer install -d /var/www/html/symfony/
# Test DB
php /var/www/html/symfony/bin/console doctrine:database:create -n --env=test
php /var/www/html/symfony/bin/console doctrine:migrations:migrate -n --env=test
php /var/www/html/symfony/bin/console doctrine:fixtures:load -n --env=test
# Main DB
php /var/www/html/symfony/bin/console doctrine:database:create -n
php /var/www/html/symfony/bin/console doctrine:migrations:migrate -n
php /var/www/html/symfony/bin/console doctrine:fixtures:load -n</span></pre>
<p><span class="koboSpan" id="kobo.79.1">This shell script will come in handy once we are running</span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.80.1"> the application in the </span><strong class="bold"><span class="koboSpan" id="kobo.81.1">continuous integration</span></strong><span class="koboSpan" id="kobo.82.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.83.1">CI</span></strong><span class="koboSpan" id="kobo.84.1">) machine. </span></p>
<p><span class="koboSpan" id="kobo.85.1">After running</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.86.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">setup.sh</span></strong><span class="koboSpan" id="kobo.88.1"> command, your development</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.89.1"> environment should be ready to run all the unit and integration tests from inside our </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">Symfony application.</span></span></p>
<p><span class="koboSpan" id="kobo.91.1">In </span><a href="B18318_05.xhtml#_idTextAnchor070"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.92.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.93.1">, </span><em class="italic"><span class="koboSpan" id="kobo.94.1">Unit Testing</span></em><span class="koboSpan" id="kobo.95.1">, we created a shell script called </span><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">codebase/symfony/runCoverage.sh</span></strong><span class="koboSpan" id="kobo.97.1">. </span><span class="koboSpan" id="kobo.97.2">This shell script will help us run all the tests and check how much test coverage we have against our solution code. </span><span class="koboSpan" id="kobo.97.3">Realistically speaking though, we don’t have to cover all the code inside our application since some of them are third-party libraries</span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.98.1"> with no tests, or some of them might be just </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">Plain Old PHP Object</span></strong><span class="koboSpan" id="kobo.100.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.101.1">POPO</span></strong><span class="koboSpan" id="kobo.102.1">) classes. </span><span class="koboSpan" id="kobo.102.2">But for the code that we develop, we should add automated tests for them. </span></p>
<p><span class="koboSpan" id="kobo.103.1">If you think you need to exclude some classes from the code coverage report, you can open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">codebase/symfony/phpunit.xml</span></strong><span class="koboSpan" id="kobo.105.1"> configuration file and add the directories you want to exclude from the </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">coverage report.</span></span></p>
<p><span class="koboSpan" id="kobo.107.1">From within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">docker_server-web_1</span></strong><span class="koboSpan" id="kobo.109.1"> container, if you open</span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.110.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">codebase/symfony/tests</span></strong><span class="koboSpan" id="kobo.112.1"> directory inside</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.113.1"> our Symfony application, you will see the </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">following tests:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer129">
<span class="koboSpan" id="kobo.115.1"><img alt="Figure 9.1 – Symfony tests directory" src="image/Figure_9.01_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.116.1">Figure 9.1 – Symfony tests directory</span></p>
<p><span class="koboSpan" id="kobo.117.1">We have three main directories for the tests: </span><strong class="bold"><span class="koboSpan" id="kobo.118.1">Functional</span></strong><span class="koboSpan" id="kobo.119.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.120.1">Integration</span></strong><span class="koboSpan" id="kobo.121.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.122.1">Unit</span></strong><span class="koboSpan" id="kobo.123.1">. </span><span class="koboSpan" id="kobo.123.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.124.1">Functional</span></strong><span class="koboSpan" id="kobo.125.1"> tests in this example are the controller tests, which are the tests that use HTTP requests; you can think of them as Integration tests as well but they cover more integrated code. </span><span class="koboSpan" id="kobo.125.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.126.1">Integration</span></strong><span class="koboSpan" id="kobo.127.1"> tests are the tests that run through the different custom classes and how they interact with each other, making sure that they all work as expected. </span><span class="koboSpan" id="kobo.127.2">Finally, the </span><strong class="bold"><span class="koboSpan" id="kobo.128.1">Unit</span></strong><span class="koboSpan" id="kobo.129.1"> tests are simple tests that focus on single units or functions inside a </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">specific class.</span></span></p>
<p><span class="koboSpan" id="kobo.131.1">You can browse through</span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.132.1"> the directories</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.133.1"> and classes inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">codebase/symfony/src</span></strong><span class="koboSpan" id="kobo.135.1"> to check the actual classes our tests are </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">testing against.</span></span></p>
<p><span class="koboSpan" id="kobo.137.1">Let’s see whether the tests pass; from the host machine, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.139.1">
$ docker exec -i docker_server-web_1 /var/www/html/symfony/runTests.sh</span></pre>
<p><span class="koboSpan" id="kobo.140.1">Alternatively, run the following command inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">docker_server-web_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.142.1"> container:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.143.1">
/var/www/html/symfony# ./runTests.sh</span></pre>
<p><span class="koboSpan" id="kobo.144.1">Since we have configured the database and tables needed for the tests, you should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer130">
<span class="koboSpan" id="kobo.146.1"><img alt="Figure 9.2 – Passing Symfony tests" src="image/Figure_9.02_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.147.1">Figure 9.2 – Passing Symfony tests</span></p>
<p><span class="koboSpan" id="kobo.148.1">It looks like we have a lot of passing tests, but let’s open one of the test classes and see exactly what we are </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">testing for.</span></span></p>
<p><span class="koboSpan" id="kobo.150.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">codebase/symfony/tests/Integration/DAL/Reader/ColorReaderTest.php</span></strong><span class="koboSpan" id="kobo.152.1">; you will see</span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.153.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">following</span></span><span class="No-Break"><a id="_idIndexMarker475"/></span><span class="No-Break"><span class="koboSpan" id="kobo.155.1"> content:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.156.1">
&lt;?php
namespace App\Tests\Integration\DAL\Reader;
use App\DAL\Reader\Doctrine\ColorReader;
use App\Entity\Color;
use App\Model\ToyColor;
class ColorReaderTest extends DataReaderTestBase
{
    public function testCanReadColors()
    {
        $reader = $this-&gt;getServiceContainer()-&gt;get(ColorReader::class);
        $colorsFromDb = $reader-&gt;getAll();
        /** @var Color $color */
        foreach ($colorsFromDb as $color) {
            $this-&gt;assertInstanceOf(ToyColor::class, $color);
            $this-&gt;assertIsInt($color-&gt;getId());
            $this-&gt;assertNotNull($color-&gt;getName());
        }
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.157.1">You will notice that in this test class, we are reading data from the database and running some assertions against the results from the database. </span><span class="koboSpan" id="kobo.157.2">In </span><a href="B18318_07.xhtml#_idTextAnchor108"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.158.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.159.1">, </span><em class="italic"><span class="koboSpan" id="kobo.160.1">Building Solution Code with BDD and TDD</span></em><span class="koboSpan" id="kobo.161.1">, we created the databases we needed for both testing and the main database for the actual </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">solution code.</span></span></p>
<p><span class="koboSpan" id="kobo.163.1">We have the following databases inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">docker_server-mysql_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.165.1"> container:</span></span></p>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer131">
<span class="koboSpan" id="kobo.166.1"><img alt="Figure 9.3 – MySQL databases" src="image/Figure_9.03_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.167.1">Figure 9.3 – MySQL databases</span></p>
<p><span class="koboSpan" id="kobo.168.1">We are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">cars</span></strong><span class="koboSpan" id="kobo.170.1"> database</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.171.1"> for the actual solution code, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">cars_test</span></strong><span class="koboSpan" id="kobo.173.1"> for the automated</span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.174.1"> tests. </span><span class="koboSpan" id="kobo.174.2">This way, our automated tests won’t contaminate our main </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">application database.</span></span></p>
<p><span class="koboSpan" id="kobo.176.1">Now, finally, before we deploy to the CI solution, let’s run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">runCoverage.sh</span></strong><span class="koboSpan" id="kobo.178.1"> shell script we </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">built earlier.</span></span></p>
<p><span class="koboSpan" id="kobo.180.1">Run the following command from the </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">host machine:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.182.1">
$ docker exec -i docker_server-web_1 /var/www/html/symfony/runCoverage.sh</span></pre>
<p><span class="koboSpan" id="kobo.183.1">Alternatively, run the following command inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">docker_server-web_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.185.1"> container:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.186.1">
/var/www/html/symfony# ./runCoverage.sh</span></pre>
<p><span class="koboSpan" id="kobo.187.1">Now, you should see the following </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">test result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer132">
<span class="koboSpan" id="kobo.189.1"><img alt="Figure 9.4 – Test coverage report" src="image/Figure_9.04_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.190.1">Figure 9.4 – Test coverage report</span></p>
<p><span class="koboSpan" id="kobo.191.1">Great! </span><span class="koboSpan" id="kobo.191.2">At this stage, we</span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.192.1"> are sure that the tests</span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.193.1"> are running properly and that they can also connect to the </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">test database:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer133">
<span class="koboSpan" id="kobo.195.1"><img alt="Figure 9.5 – Test data" src="image/Figure_9.05_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.196.1">Figure 9.5 – Test data</span></p>
<p><span class="koboSpan" id="kobo.197.1">If you check the </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">toy_cars</span></strong><span class="koboSpan" id="kobo.199.1"> table inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">cars_test</span></strong><span class="koboSpan" id="kobo.201.1"> MySQL database, you should see some sample data created by the </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">automated tests.</span></span></p>
<p><span class="koboSpan" id="kobo.203.1">Next, let’s move on to our more elaborate functional tests defined inside the </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">Behat application.</span></span></p>
<h3><span class="koboSpan" id="kobo.205.1">Preparing the Behat application and tests</span></h3>
<p><span class="koboSpan" id="kobo.206.1">In the previous section, we</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.207.1"> were able to run</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.208.1"> and pass all the Symfony application tests. </span><span class="koboSpan" id="kobo.208.2">Now, we’ll need to make sure that we have also passed our behavior-driven tests living inside the Behat application. </span></p>
<p><span class="koboSpan" id="kobo.209.1">Run the following command from your host machine to set up the </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">Behat application:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.211.1">
$ docker exec -i docker_server-web_1 /var/www/html/
behat/setup.sh</span></pre>
<p><span class="koboSpan" id="kobo.212.1">Alternatively, run the following command inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">docker_server-web_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.214.1"> container:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.215.1">
/var/www/html/behat# ./setup.sh</span></pre>
<p><span class="koboSpan" id="kobo.216.1">Just like what we did earlier in the Symfony application, we first need to set up the Behat application and install </span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">its dependencies.</span></span></p>
<p><span class="koboSpan" id="kobo.218.1">In </span><a href="B18318_06.xhtml#_idTextAnchor094"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.219.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.220.1">, </span><em class="italic"><span class="koboSpan" id="kobo.221.1">Applying Behavior-Driven Development</span></em><span class="koboSpan" id="kobo.222.1">, we created test features and scenarios using the Gherkin language. </span><span class="koboSpan" id="kobo.222.2">We also created some Context PHP classes that contain steps we have defined in the feature files we’ve created. </span><span class="koboSpan" id="kobo.222.3">These Context classes will be executed by Behat to serve as functional </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">PHP tests.</span></span></p>
<p><span class="koboSpan" id="kobo.224.1">The difference between the Symfony tests and the tests from our Behat application is that the Behat tests do not care about how we achieve the results or how specific PHP classes interact with other PHP classes. </span><span class="koboSpan" id="kobo.224.2">They only care about testing very high-level functional and </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">behavioral scenarios.</span></span></p>
<p><span class="koboSpan" id="kobo.226.1">That’s it – now, we are ready to run our </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">behavior-driven tests.</span></span></p>
<p><span class="koboSpan" id="kobo.228.1">Run the following command from the host machine and see whether you can pass our </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">Behat tests:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.230.1">
docker exec -i docker_server-web_1 /var/www/html/behat/runBehatTests.sh</span></pre>
<p><span class="koboSpan" id="kobo.231.1">Alternatively, run the following command inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">docker_server-web_1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.233.1"> container:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.234.1">
/var/www/html/behat# ./runBehatTests.sh</span></pre>
<p><span class="koboSpan" id="kobo.235.1">You should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">following results:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer134">
<span class="koboSpan" id="kobo.237.1"><img alt="Figure 9.6 – Behat tests passing" src="image/Figure_9.06_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.238.1">Figure 9.6 – Behat tests passing</span></p>
<p><span class="koboSpan" id="kobo.239.1">Great! </span><span class="koboSpan" id="kobo.239.2">We have passed</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.240.1"> all the test scenarios that we have defined. </span><span class="koboSpan" id="kobo.240.2">If you want to check</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.241.1"> all the feature files and scenarios, you can open the files </span><span class="No-Break"><span class="koboSpan" id="kobo.242.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">codebase/behat/features</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.245.1">Now that we are sure that our automated tests are working properly from our development machine, we are ready to use them in Bitbucket Pipelines for our </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">CI solution.</span></span></p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.247.1">Using Bitbucket Pipelines for CI</span></h1>
<p><span class="koboSpan" id="kobo.248.1">We’ve spent a lot of effort building</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.249.1"> our automated tests</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.250.1"> and solution code, and all these efforts are aimed to help us develop maintainable and more reliable software. </span><span class="koboSpan" id="kobo.250.2">CI is the practice of being able to integrate code changes from different sources. </span><span class="koboSpan" id="kobo.250.3">With the addition of automated tests, this is where our hard work will start to pay off on a bigger scale with all the tests we’ve been writing. </span><span class="koboSpan" id="kobo.250.4">This will help in preventing us from introducing regressions into the main code base. </span><span class="koboSpan" id="kobo.250.5">For example, the CI process can reject a git pull request if there are broken </span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">automated tests.</span></span></p>
<p><span class="koboSpan" id="kobo.252.1">There are a lot of CI tools out there, but in this example, since I am using Bitbucket for the version control in the project, I’ll just use Bitbucket Pipelines as it’s already integrated well with Bitbucket Cloud. </span><span class="koboSpan" id="kobo.252.2">It is extremely easy to use, as you will see. </span><span class="koboSpan" id="kobo.252.3">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">get started:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.254.1">In the Bitbucket Cloud dashboard, select the repository you are using for your project, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.255.1">Pipelines</span></strong><span class="koboSpan" id="kobo.256.1"> link on the </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">left menu:</span></span></li>
</ol>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer135">
<span class="koboSpan" id="kobo.258.1"><img alt="Figure 9.7 – Create your first pipeline" src="image/Figure_9.07_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.259.1">Figure 9.7 – Create your first pipeline</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.260.1">Then, select the </span><strong class="bold"><span class="koboSpan" id="kobo.261.1">Build PHP Application</span></strong><span class="koboSpan" id="kobo.262.1"> box. </span><span class="koboSpan" id="kobo.262.2">You</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.263.1"> will see the example</span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.264.1"> template for creating your </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">first pipeline:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer136">
<span class="koboSpan" id="kobo.266.1"><img alt="Figure 9.8 – Create your first pipeline" src="image/Figure_9.08_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.267.1">Figure 9.8 – Create your first pipeline</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.268.1">Here, you will see</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.269.1"> a simple </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">.yml</span></strong><span class="koboSpan" id="kobo.271.1"> file; you can edit</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.272.1"> it to run your script. </span><span class="koboSpan" id="kobo.272.2">For our example project, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.274.1">bitbucket-pipelines.yml</span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.275.1">image: docker:stable</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.276.1">options:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.277.1">  docker: true</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.278.1">pipelines:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.279.1">  default:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.280.1">    - parallel:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.281.1">        - step:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.282.1">            name: Prepare environment</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.283.1">            script:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.284.1">              - set -eu</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.285.1">              - apk add --no-cache py-pip bash</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.286.1">              - apk add --no-cache gcc</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.287.1">              - apk add --update --no-cache --virtual </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.288.1">.tmp-build-deps gcc libc-dev linux-headers postgresql-dev &amp;&amp; apk add libffi-dev</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.289.1">              - apk update &amp;&amp; apk add python3-dev gcc libc-dev</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.290.1">              - pip install --upgrade pip setuptools wheel</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.291.1">              - pip install --no-cache-dir docker-compose</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.292.1">              - docker-compose -v</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.293.1">              - ls -lap</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.294.1">              - pwd</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.295.1">              - cd docker</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.296.1">              - docker-compose build &amp;&amp; docker-compose up -d</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.297.1">              - docker exec -i docker_server-web_1 /var/www/html/symfony/setup.sh</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.298.1">              - docker exec -i docker_server-web_1 </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.299.1">              /var/www/html/symfony/runCoverage.sh</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.300.1">              - docker exec -i docker_server-web_1 </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.301.1">              /var/www/html/behat/setup.sh</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.302.1">              - docker exec -i docker_server-web_1 </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.303.1">              /var/www/html/behat/runBehatTests.sh</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.304.1">            caches:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.305.1">              - composer</span></strong></pre>
<p><span class="koboSpan" id="kobo.306.1">As you can see, these</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.307.1"> are just some commands</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.308.1"> we want to run while setting up the Docker containers we need to use in the CI cloud. </span><span class="koboSpan" id="kobo.308.2">You will notice that we are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">codebase/symfony/setup.sh</span></strong><span class="koboSpan" id="kobo.310.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">codebase/behat/setup.sh</span></strong><span class="koboSpan" id="kobo.312.1"> files to install all the dependencies and libraries that our Symfony and Behat applications need. </span><span class="koboSpan" id="kobo.312.2">This includes creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">cars</span></strong><span class="koboSpan" id="kobo.314.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">cars_test</span></strong><span class="koboSpan" id="kobo.316.1"> databases we are using inside our </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">Symfony application!</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.318.1">Paste the script into the text area and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.319.1">Commit File</span></strong><span class="koboSpan" id="kobo.320.1"> button. </span><span class="koboSpan" id="kobo.320.2">You’ll be redirected to the </span><strong class="bold"><span class="koboSpan" id="kobo.321.1">Pipelines</span></strong><span class="koboSpan" id="kobo.322.1"> page, where you will see your </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">build running:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer137">
<span class="koboSpan" id="kobo.324.1"><img alt="Figure 9.9 – Pipeline running" src="image/Figure_9.09_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.325.1">Figure 9.9 – Pipeline running</span></p>
<p><span class="koboSpan" id="kobo.326.1">You will notice from the preceding</span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.327.1"> screenshot that we were able</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.328.1"> to build the same containers we were working with from our </span><span class="No-Break"><span class="koboSpan" id="kobo.329.1">local machine.</span></span></p>
<p><span class="koboSpan" id="kobo.330.1">The build will take a few minutes to run. </span><span class="koboSpan" id="kobo.330.2">Here, we want the following to happen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">CI cloud:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.332.1">Create a </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">host machine.</span></span></li>
<li><span class="koboSpan" id="kobo.334.1">Install the necessary libraries we need to </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">run </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">docker-compose</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.338.1">Build the Docker containers we are using for </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">our solution.</span></span></li>
<li><span class="koboSpan" id="kobo.340.1">Install Composer packages </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">for Symfony.</span></span></li>
<li><span class="koboSpan" id="kobo.342.1">Run the Doctrine Database migrations </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">for Symfony.</span></span></li>
<li><span class="koboSpan" id="kobo.344.1">Execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">runCoverage.sh</span></strong><span class="koboSpan" id="kobo.346.1"> test script </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">for Symfony.</span></span></li>
<li><span class="koboSpan" id="kobo.348.1">Make sure we pass all the </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">Symfony tests.</span></span></li>
<li><span class="koboSpan" id="kobo.350.1">Install Composer packages </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">for Behat.</span></span></li>
<li><span class="koboSpan" id="kobo.352.1">Execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">runBehatTests.sh</span></strong><span class="koboSpan" id="kobo.354.1"> test script </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">for Behat.</span></span></li>
<li><span class="koboSpan" id="kobo.356.1">Make sure we pass all the </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">Behat tests.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.358.1">That’s a lot of steps! </span><span class="koboSpan" id="kobo.358.2">But we need to do</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.359.1"> all of these things to make sure we can run</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.360.1"> our automated tests as if we are just running them from our local machine. </span><span class="koboSpan" id="kobo.360.2">After a few minutes, check back on your </span><strong class="bold"><span class="koboSpan" id="kobo.361.1">Build</span></strong><span class="koboSpan" id="kobo.362.1"> and see whether we have passed the </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">Symfony tests:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer138">
<span class="koboSpan" id="kobo.364.1"><img alt="" src="image/Figure_9.10_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Figure"><span class="koboSpan" id="kobo.365.1">Figue 9.10 – CI pass Symfony tests</span></p>
<p><span class="koboSpan" id="kobo.366.1">Great! </span><span class="koboSpan" id="kobo.366.2">By running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">runCoverage.sh</span></strong><span class="koboSpan" id="kobo.368.1"> shell script from inside the CI, we can make sure that all the tests and code are still running as expected! </span><span class="koboSpan" id="kobo.368.2">Now, let’s see whether our Behat tests also pass. </span><span class="koboSpan" id="kobo.368.3">Keep scrolling down the build screen until you find the Behat </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">test results:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer139">
<span class="koboSpan" id="kobo.370.1"><img alt="Figure 9.11 – CI pass Behat tests" src="image/Figure_9.11_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.371.1">Figure 9.11 – CI pass Behat tests</span></p>
<p><span class="koboSpan" id="kobo.372.1">As you can see from</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.373.1"> the log, we passed</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.374.1"> the same five scenarios that we passed earlier from our local </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">development machine!</span></span></p>
<p><span class="koboSpan" id="kobo.376.1">At this stage, </span><strong class="bold"><span class="koboSpan" id="kobo.377.1">Pipelines</span></strong><span class="koboSpan" id="kobo.378.1"> will show a green bar with a check indicating that we have passed the </span><span class="No-Break"><span class="koboSpan" id="kobo.379.1">entire build.</span></span></p>
<p><span class="koboSpan" id="kobo.380.1">In </span><a href="B18318_02.xhtml#_idTextAnchor027"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.381.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.382.1">, </span><em class="italic"><span class="koboSpan" id="kobo.383.1">Understanding and Organizing the Business Requirements of Our Project</span></em><span class="koboSpan" id="kobo.384.1">, we created some Jira tickets and integrated our Bitbucket repository into the Jira project. </span><span class="koboSpan" id="kobo.384.2">Now, this is going to be very handy for Bitbucket Pipelines as it is also seamlessly integrated </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">with Jira.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">In the root directory of the solution code, as cloned from </span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%209"><span class="koboSpan" id="kobo.387.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%209</span></a><span class="koboSpan" id="kobo.388.1">, you will find a </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">bitbucket-pipelines.yml</span></strong><span class="koboSpan" id="kobo.390.1"> file containing the scripts we have used to run our first pipeline. </span><span class="koboSpan" id="kobo.390.2">Now, each time you push an update into the Bitbucket</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.391.1"> branch that is connected</span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.392.1"> to the Jira ticket that you’re working on, Jira will be automatically able to detect the Pipelines build that is running for your Jira ticket </span><span class="No-Break"><span class="koboSpan" id="kobo.393.1">as well:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer140">
<span class="koboSpan" id="kobo.394.1"><img alt="Figure 9.12 – Jira and Pipelines integrated" src="image/Figure_9.12_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.395.1">Figure 9.12 – Jira and Pipelines integrated</span></p>
<p><span class="koboSpan" id="kobo.396.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.397.1">1 build incomplete</span></strong><span class="koboSpan" id="kobo.398.1"> link below the </span><strong class="bold"><span class="koboSpan" id="kobo.399.1">Create pull request</span></strong><em class="italic"> </em><span class="koboSpan" id="kobo.400.1">link area highlighted in the preceding screenshot; you will see a popup containing the list of builds that have been executed for that branch </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">and ticket:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer141">
<span class="koboSpan" id="kobo.402.1"><img alt="Figure 9.13 – Pipelines builds popup from the Jira page" src="image/Figure_9.13_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.403.1">Figure 9.13 – Pipelines builds popup from the Jira page</span></p>
<p><span class="koboSpan" id="kobo.404.1">This is a set of very powerful tools. </span><span class="koboSpan" id="kobo.404.2">Your team</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.405.1"> can monitor tasks</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.406.1"> using Jira, and you can make sure that the source code being pushed by you, or any other developer, is not detrimental to the existing software before you decide whether you want to deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">the solution.</span></span></p>
<p><span class="koboSpan" id="kobo.408.1">If a developer pushes code that changes the behavior of your application negatively, and there are enough automated tests to cover it, then you’ll be able to catch the problem as it will fail the </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">CI build.</span></span></p>
<h1 id="_idParaDest-144"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.410.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.411.1">In this chapter, we went through the process of setting up our updated development environment complete with all the test and solution code we need to build our example project. </span><span class="koboSpan" id="kobo.411.2">We created and used shell scripts to help us install dependencies, set up databases, and seed data, making sure that we have everything we need to easily run our tests from a local machine or in </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">the cloud.</span></span></p>
<p><span class="koboSpan" id="kobo.413.1">We also created our first Bitbucket Pipeline to help us implement continuous integration. </span><span class="koboSpan" id="kobo.413.2">By using CI, we can run all our automated tests in the cloud to make sure that we do not break anything in the code base each time we commit and push changes to </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">a branch.</span></span></p>
<p><span class="koboSpan" id="kobo.415.1">In the next chapter, we will deploy our solution into an external web server, where we will also be able to test the application using a </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">web browser.</span></span></p>
</div>
</body></html>