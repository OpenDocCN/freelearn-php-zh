<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Controller Usage and Scope"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Controller Usage and Scope</h1></div></div></div><p>This chapter covers the CI controller scope and the various controller usage categories with several code examples of web applications. The controllers are the front-line decision makers of how to process or route a request and how to respond to actions, such as a rendered view sending back to the browser as an HTML page, an AJAX response to let the current requesting page update certain selector areas by the response, or even just to update the database seamlessly. The controllers use the available models, helpers, libraries, and views to respond to the caller, be it  a web browser URL or a cron process issuing the cURL types <code class="literal">POST</code>/<code class="literal">GET</code> requests automatically.</p><p>The CI built-in controller behaves like an abstract class in the project scope so any of our project controllers must be extensions of a built-in CI controller. Our developed controller will inherit the CI built-in controller capabilities and built-in resources, such as auto-loaded helpers, libraries, and models, and let us code any specific services as controller methods to address our project requirements, and rendering the needs of the view.</p><p>As mentioned before, the controller is part of the MVC development framework that operates with models, and applies business logic, which most commonly renders a view back to the client web browser to proceed with user interaction.</p><p>The web user refers, via a browser, to a URL. In CI, the view is implemented as a call to a CI controller method. The CI controller method processes the browser request and sends back a rendered view that becomes a visualized web page to the browsing user.</p><p>The web page received from the CI controller is referred to as the rendered controller view; it may include anchors and buttons for the user to continue the interaction with the controller. When the user clicks on an anchor in the browser, a call to a controller is made (the anchor makes an HTTP request to activate a controller call). In case the user issue a event such as Button clicking, operate scroll bars, and so on so that this user event will trigger an action using jQuery to activate, for example a jQuery callback function. The jQuery callback function may issue a call to another rendering controller, such as :</p><p><code class="literal">$(location).attr('href',controller_url_to_call);</code></p><p>Another option is to activate an asynchronous AJAX calls to an AJAX controller. Such a controller function handles the AJAX request that we will discuss later on. When AJAX calls returned from the server , their returned data may be used by client-side JavaScript to, update certain page regions/ (HTML selector/s) of the web page, for example, when typing a search string and issuing a search button, the AJAX response will provide the search results to be visualized in the same web page or will move to another page.</p><p>More on controllers in general can be found at <a class="ulink" href="http://en.wikipedia.org/wiki/Model-view-controller">http://en.wikipedia.org/wiki/Model-view-controller</a>.</p><p>The following are the chapter topics and subtopics we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Scope of the CI controller</li><li class="listitem" style="list-style-type: disc">Usage categories:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rendering views</li><li class="listitem" style="list-style-type: disc">Controllers serving browser AJAX requests</li><li class="listitem" style="list-style-type: disc">Controllers serving Linux scheduled <code class="literal">cron</code> execution requests</li></ul></div></li><li class="listitem" style="list-style-type: disc">CI controller expansion and usage( )(Refer to <a class="link" href="ch02.html" title="Chapter 2. Configurations and Naming Conventions">Chapter 2</a>, <span class="emphasis"><em>Configurations and Naming Conventions</em></span>, for more)<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loading resources of models, helpers, and libraries</li><li class="listitem" style="list-style-type: disc">Using loaded resources</li><li class="listitem" style="list-style-type: disc">Calling CI controller methods</li></ul></div></li><li class="listitem" style="list-style-type: disc">Example 1: the default home page controller</li><li class="listitem" style="list-style-type: disc">Example 2: sending e-mails with attachments</li><li class="listitem" style="list-style-type: disc">Example 3: admin and regular user log in</li></ul></div><p>We will begin by briefly reviewing the scope and use cases of the application controller in the CI framework and how we can use them for our project requirement needs.</p><div class="section" title="Scope of the CI controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Scope of the CI controller</h1></div></div></div><p>The CI controller<a id="id79" class="indexterm"/> is the hub and brain of the CI MVC that handles the HTTP requests, such as those from the browser, and operates with other CI resources to respond. The CI controller scope is described in the following figure and operates with other CI resources to respond to the requests:</p><div class="mediaobject"><img src="graphics/4704OT_03_01.jpg" alt="Scope of the CI controller"/></div><p>The general flow with the<a id="id80" class="indexterm"/> CI controller is shown in the preceding figure. The user's browser sends the HTTP request to the URL of the CI project. Initially, the requested URL is processed via the routes based on the routes configuration <code class="literal">/conf/routes.php</code>. For more information, refer to <a class="link" href="ch02.html" title="Chapter 2. Configurations and Naming Conventions">Chapter 2</a>, <span class="emphasis"><em>Configurations and Naming Conventions</em></span>. The specific CI controller is instantiated and the specific method is called. The CI method may be assisted by any of the project resources, such as models, libraries, and helpers for operations (business logic, and database queries). The CI controller generally uses a view that defines a web page to be responded to via an HTTP response.</p></div></div>
<div class="section" title="The user-defined CI controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>The user-defined CI controller</h1></div></div></div><p>Each CI project must have<a id="id81" class="indexterm"/> one or more user-defined controllers in order to operate. The user-defined controllers are the starting point of any CI user interaction. Calling the controller and its methods can be done in several ways. The controller can be called via project root URI submission to a browser (the project default controller will be called), by issuing the user anchor from a rendered view, by a client-side AJAX request for actions (updating page selectors), or even by a <code class="literal">crontab</code> (Linux known scheduler service) scheduled action executed repeatedly as a URI of a certain controller method.</p><p>We can see that the controller scope is a general manager of all the other project resources, such as models, views, helpers, and libraries, governing all to address execution requests from the user or a scheduled request.</p><p>Any application controller will be located under <code class="literal">application/controller/</code> in the <code class="literal">project</code> directory.</p><p>The controller can load other CI project code resources of libraries, models, and helpers so that they can be accessed directly by the rendered views. This means that, if a controller loaded a library, the rendered view PHP file can call the library function in the exact same way as the controller does. The following is the code resources that the controller can load:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">application/helpers</code>: The helper/s are built-in CI third-party, or user-defined.</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/models</code>: The models are most commonly user-defined for the specific database/s and tables of the specific project, extending the built-in CI model. Wrapping with CRUD service for specific defined database/s table/s,  but also can be third-party (for example, data mapper extensions that can be used generically with any database).</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/libraries</code>: The library can be built-in, third-party, or user-defined. The library is an Object Oriented PHP class-based service that can provide some reusable services related to a specific project, or across many projects. For example, as Flickr, Facebook, or LinkedIn wrapper API libraries. A good practice is to define in addition to the third-party libraries we may decide to use, our project oriented libraries to enhance our project simplicity, and maintainability.</li></ul></div><div class="section" title="Extending the CI controller"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>Extending the CI controller</h2></div></div></div><p>As we said, our application<a id="id82" class="indexterm"/> controller extends the built-in CI controller that is something like an abstract class in the development scope, so that in order to use the controller for our needs, we must build our controller extending the base class. We can extend the CI controller in several ways.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loading resources of helpers, models, and libraries:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Those can be from the CI built-in repository, third-party developed, or self-developed. For more information on how to self-develop models, refer to <a class="link" href="ch06.html" title="Chapter 6. Models">Chapter 6</a>, <span class="emphasis"><em>Models</em></span>, on how to self-develop libraries, refer to <a class="link" href="ch04.html" title="Chapter 4. Libraries">Chapter 4</a>, <span class="emphasis"><em>Libraries</em></span>, and on how to self-develop helpers, refer to <a class="link" href="ch05.html" title="Chapter 5. Helpers">Chapter 5</a>, <span class="emphasis"><em>Helpers</em></span>.</li><li class="listitem" style="list-style-type: disc">The controller can load any of the external resources in the following fashion in any of its methods, commonly at the contractor and in case the resource is required in all the controllers via the <code class="literal">autoload.php</code> configuration file ( ) (refer to <a class="link" href="ch03.html" title="Chapter 3. Controller Usage and Scope">Chapter 3</a>, <span class="emphasis"><em>Configurations and Naming Conventions</em></span> for more information). However, for the best resource optimization to minimize the footprint and overhead even better, the resources will be loaded only on those controller methods that need their services to operate.</li></ul></div><p>The following are a few examples of how to load the mentioned resources:</p><div class="informalexample"><pre class="programlisting">$this-&gt;load-&gt;model('some_model');
$this-&gt;load-&gt;library('some_library', $keyed_array);
$this-&gt;load-&gt;helper('some_helper');</pre></div></li><li class="listitem" style="list-style-type: disc">Adding <a id="id83" class="indexterm"/>public and private methods:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This approach is the common guideline of PHP OOP that you are expected to be familiar with (although elaboration on this can be found at <a class="ulink" href="http://php.net">http://php.net</a>). The following is a simple example of how a public method calls a private method to get some data:<div class="informalexample"><pre class="programlisting">public function <span class="strong"><strong>get_something ()</strong></span> {
  $some_data= $this-&gt;_get_it ();
  }
private function <span class="strong"><strong>_get_it ()</strong></span> {
  return= 'hello';
  }</pre></div></li></ul></div></li><li class="listitem" style="list-style-type: disc">Using loaded resources:<p>The loaded resources can be used after loading as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using loaded model methods:<div class="informalexample"><pre class="programlisting">$status= $this-&gt;some_model-&gt;save_data($table, $row);$rows= $this-&gt;some_model-&gt;get_table($table_name);</pre></div></li><li class="listitem" style="list-style-type: disc">Using loaded library methods:<div class="informalexample"><pre class="programlisting">$another_data = $this-&gt;some_library-&gt;method($some_data);</pre></div></li><li class="listitem" style="list-style-type: disc">Using loaded helpers:<div class="informalexample"><pre class="programlisting">$your_ip =get_your_ip();  // myhtml_helper function
<span class="strong"><strong>// NOTE: a helper defines regular functions!</strong></span>
</pre></div></li></ul></div></li><li class="listitem" style="list-style-type: disc">Calling a controller:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The controller is automatically instantiated by the CI core, and its methods are called via HTTP URIs. For more information, refer to <a class="link" href="ch02.html" title="Chapter 2. Configurations and Naming Conventions">Chapter 2</a>, <span class="emphasis"><em>Configurations and Naming Conventions</em></span>.</li><li class="listitem" style="list-style-type: disc">Ways to call a controller:<p>Calling only the contractor and later calling the index method, if defined as follows: <code class="literal">$URI = "base_url().'/mycontroller'; mycontroller';</code></p><p>Calling the<a id="id84" class="indexterm"/> method of the <code class="literal">mycontroller</code> class without parameters: <code class="literal">$URI = "base_url.'/mycontroller/mymethod';</code></p><p>Calling the method of the <code class="literal">mycontroller</code> class with two parameters, a and b: <code class="literal">$URI = "base_url.'/mycontroller/mymethod/a/b';</code></p></li></ul></div></li></ul></div></div></div>
<div class="section" title="CI controller use cases"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>CI controller use cases</h1></div></div></div><p>There are several <a id="id85" class="indexterm"/>different use cases for a CI user-defined controller. Commonly, the CI controller will handle initiating/rendering HTML pages, enable us to let the user navigate and view the different web application pages we defined. However, the controller may also provide other services, such as AJAX server-side controller, serving asynchronously the client-side browser requests, and commonly return back the JSON formatted data instead of a rendered view. The exact scope and usage of AJAX is not part of the CI framework, but it is very useful standard de-facto technology. To learn more about AJAX, please refer to AJAX (Asynchronous JavaScript and XML) on Wikipedia <a class="ulink" href="http://en.wikipedia.org">http://en.wikipedia.org</a>.</p><p>The main usage categories for our controller in a CI framework are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rendering views: These type of controllers mostly performs some preparations for data and render the requested view, along with the prepared data, to be displayed to the user for the next user session state with web application.</li><li class="listitem" style="list-style-type: disc">A special case is the home page view rendering. So that the user refers to the Project root directory via URI such as:<div class="informalexample"><pre class="programlisting">
http://mydomain.com/my_ci_project.
</pre></div></li><li class="listitem" style="list-style-type: disc">Where the CI routes will define <code class="literal">maincontroller</code> as the home page or default controller as follows under the project root:<code class="literal">application/config/routes.php</code>. So that the default controller will be defined as follows:<div class="informalexample"><pre class="programlisting">
$route ['default_controller'] = "maincontroller";
</pre></div></li><li class="listitem" style="list-style-type: disc">Then the call to<div class="informalexample"><pre class="programlisting">http://mydomain.com/my_ci_project will be routed by the CI routes </pre></div><p>to</p><div class="informalexample"><pre class="programlisting">http://mydomain.com/my_ci_project/maincontroller</pre></div><p>For user navigation request to another page, we shall have in the rendered view, HTML anchors for navigating into another pages something like the following view code:</p><div class="informalexample"><pre class="programlisting">
&lt;?PHP echo <span class="strong"><strong>anchor </strong></span>
    <span class="strong"><strong>'Navigate me to page B'</strong></span>); ?&gt;
</pre></div></li><li class="listitem" style="list-style-type: disc">Controller serving the browser AJAX requests. These controllers respond to the AJAX client requests. and most commonly return the JSON data to the calling jQuery script as follows:<div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
function autocomplete(clue_val) {
  varurl = '&lt;?php echo site_url(); ?&gt;/AJAX_controller/autocomplete_name';
  $AJAX ({type: "POST", url: url, data: {clue: clue_val},
    dataType: "json", success: function(data) {
      // show the data of matching names
      }
    return;
    });</pre></div></li><li class="listitem" style="list-style-type: disc">Controller <a id="id86" class="indexterm"/>serving Linux scheduled <code class="literal">cron</code> requests: A very powerful CI usage we found is serving Linux <code class="literal">cron</code> schedule requests defined in the Linux <code class="literal">cron</code> (for more information about Linux <code class="literal">cron</code> scheduling, please refer to <a class="ulink" href="http://en.wikipedia.org/wiki/Cron">http://en.wikipedia.org/wiki/Cron</a>).<p>We can find, within the <span class="strong"><strong>DirectAdmin</strong></span><a id="id87" class="indexterm"/> apache admin tool, a UI editor to define the scheduled <code class="literal">crontab</code> repeatable actions we want the server to perform.</p><p>For each request, we will define the PHP processor path; for example, <code class="literal">/user/local/bin/php</code>, as well as the PHP script to be executed; for example, <code class="literal">/home/mysite.com/public_html/crontabs/ci_crontab.php</code>.</p><p><code class="literal">ci_crontab.php</code> can execute the CI controller method.</p><p><code class="literal">http://myCIproject/mycontroller/mymethod</code> will, for example, scan the database and update a table named <code class="literal">sums_table</code>, which contains the number of rows in all the tables added together after every execution. Let us see an example of how to make that CI controller call from the PHP script.</p><p>In order to call a CI controller via an HTTP request, <code class="literal">ci_crontab.php</code> will use the cURL service that will call the CI controller, similar to the way we issue it from a<a id="id88" class="indexterm"/> browser (<span class="strong"><strong>cURL</strong></span> (<span class="strong"><strong>Client URLs</strong></span>), <a class="ulink" href="http://php.net/manual/en/ref.curl.php">http://php.net/manual/en/ref.curl.php</a>).</p><p>Let's build <code class="literal">/home/mysite.com/public_html/crontabs/ci_crontab.php</code>.</p><p>Linux crontab will call every defined action repeatedly.</p><p>The code of <code class="literal">ci_crontab.php</code> will be something like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?PHP
function file_get_contents_curl($url) {
  $ch = curl_init();
  curl_setopt($ch, CURLOPT_HEADER, 0);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt($ch, CURLOPT_URL, $url);
  $data = curl_exec($ch);
  curl_close($ch);
  return $data;
  }
$http_to_execut='http://myCIproject/mycontroller/mymethod';
$result = file_get_contents_curl ($http_to_execute);</pre></div><p>The <code class="literal">$result</code> will be the rendered output from the controller, mostly simple echoed messages such as <code class="literal">Processed 127 entries</code>. Sure, we can log the result every time and append it to a log file of the action logs performed.</p><p>We just saw how<a id="id89" class="indexterm"/> we can use the CI controller to serve Linux cron services, which has a very powerful capability in many business cases.</p></li></ul></div></div>
<div class="section" title="Example 1 &#x2013; default homepage controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Example 1 – default homepage controller</h1></div></div></div><p>Initially, we will start with a<a id="id90" class="indexterm"/> simple controller example that opens a home page with the navigation option back and forth to another page B, and similarly to the home page. We will do so while rendering some controller calculated data at the view.</p><p>This example doesn't use the database. This example will be built from the following CI framework component configuration, controller, and view files.</p><p>Let us define the default controller filename as <code class="literal">controller/home_page.php</code> and the home page view as <code class="literal">views/home_page_view.php</code>.</p><p>Let us assume the URI to the project root is <code class="literal">http://mydomain.com/myproject</code>.</p><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>The controller file</h2></div></div></div><p>The <a id="id91" class="indexterm"/>controller file <code class="literal">/home_page.php</code> will prepare some data to be shown in the view and will let the user navigate to page B and similarly back to the home page.</p><p>The helpers used are provided with the sample source code provided with this book.</p><p>The following is the code:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class Home_page extends CI_Controller
{
  function __construct() {
    parent::__construct();
    $this-&gt;load-&gt;helper ('validators_helper');
    $this-&gt;load-&gt;helper ('dates_time_helper');
    }
  public function index() {
    $data = array ();
    $data ['email'] = $email = "the@email.com";
    // validators_helpercalls
    $data ['email_valid'] = isValidEmail($email);
    $data ['url'] = $url = "http://cnn.com";
    $data ['url_valid'] = isValidURL($url);
    $data ['url_exist'] = isURLExists($url);
    $this-&gt;load-&gt;view('home_page_view', $data);
    }
  publicfunction page_b () {
    $data = array ();
    $myqsl_date = "1970-01-01";
    // dates_time_helper calls
    $data ['since'] = ui_date ($myqsl_date);
    $data ['past'] = getAgeAccurate ($myqsl_date, $percision = 2);
    $this-&gt;load-&gt;view ('page_b_view', $data);
    }
  }
// End controller</pre></div></div><div class="section" title="The view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>The view file</h2></div></div></div><p>The controller file will<a id="id92" class="indexterm"/> prepare the current date and time to be shown in the home page <code class="literal">views/home_page_view.php</code> view.</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;meta content="text/html; charset=utf-8"/&gt;
&lt;?PHP
/* data from controller
$email, $email_valid, $url, $url_valid , $url_exist
*/
$validation_text = ($email_valid) ? "Is Valid ": "Is Not Valid!";
$validation_url = ($url_valid) ? "Is Valid ": "Is Not Valid!";
$exist_url = ($url_exist) ? "Exist ": "Not exist!"; ?&gt;
&lt;body style="text-align: left; color: blue;"&gt;
&lt;H1&gt;Main Page&lt;/H1&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;div style = "float: left"&gt;
The Email: &lt;? = $email; ?&gt;&lt;? = $validation_text; ?&gt;
&lt;/div&gt;
&lt;div style = "clear: both;"&gt;&lt;/div&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;div&gt;
The url: &lt;? = $url; ?&gt;&lt;? = $validation_url; ?&gt; and &lt;? = $exist_url; ?&gt;
&lt;? = anchor ($url, '[visit the url]', array ("target" =&gt; "_blank", "title" =&gt; "opens a new Tab")); ?&gt;
&lt;/div&gt;
&lt;div style = "clear: both;"&gt;&lt;/div&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;?php echo anchor ('home_page/page_b', 'Navigate me to page B') ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>The controller has a <code class="literal">page_b()</code> method to render<a id="id93" class="indexterm"/> the following view file. It will prepare the parameters <code class="literal">$since</code> and <code class="literal">$past</code> for this page to be used inline in the rendered view <code class="literal">page_b_view,</code> as follows:</p><p>The view file is <code class="literal">views/page_b_view.php</code>.</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;meta content="text/html; charset=utf-8" /&gt;
&lt;?PHP
/* data from controller $since, $past */ ?&gt;
&lt;body style = "text-align: left; color: blue;"&gt;
&lt;H1&gt;Page B&lt;/H1&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;div style = "float: left"&gt;
&lt;!We render the provided controller parameters $since &amp; $past&gt;
Since: &lt;? = $since; ?&gt; past&lt;? = $past; ?&gt; years&lt;/div&gt;
&lt;div style = "clear: both;"&gt;&lt;/div&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;?php echo anchor ('home_page', 'Back to Home Page') ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></div><div class="section" title="The configuration file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec24"/>The configuration file</h2></div></div></div><p>Initially, we shall define at application/config/routes.php the default controller to be called.</p><div class="informalexample"><pre class="programlisting">For example, $route['default_controller'] = "home_page";.</pre></div><p>So that in case, you will issue URI of the project root in the browser, lets say:</p><p><code class="literal">http://mydomain.com/myproject</code></p><p><code class="literal">http://mydomain.com/myproject/home_page will be called</code>.</p><p>Optionally we can configure CI to eliminate the need to use <code class="literal">index.php</code> as part of the URI path to call our CI project controller/s  (Refer for information, to <a class="link" href="ch02.html" title="Chapter 2. Configurations and Naming Conventions">Chapter 2</a>, <span class="emphasis"><em>Configurations and Naming Conventions</em></span>).</p></div></div>
<div class="section" title="Example 2 &#x2013; sending e-mails with attachments"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Example 2 – sending e-mails with attachments</h1></div></div></div><p>In this example, we <a id="id94" class="indexterm"/>will see how the controller can load a mail service<a id="id95" class="indexterm"/> library and use it to send mail attachments.</p><p>The CI mail library is <a id="id96" class="indexterm"/>not an auto-loaded library, and hence, will be loaded by the controller we are building for sending e-mail.</p><p>The CI mail library makes it easy to send subject messages of non-English languages supporting UTF-8 both for the subject and the mail body. Adding attachments to an e-mail becomes a piece of cake using the CI mail library. We only need to have the files on a known directory path in our server and refer to them to attach them to the mail.</p><p>We can attach one or more files to create the mail body. HTML/TEXT is defined via a simple configuration setting to the CI mail library.</p><p>This example will be constructed from the mail controller only; you may add a rendered view later on to add to the example report on the mailing list, sending a report of a list of e-mail destinations instead of just one or two destinations.</p><p>Let us specify the default <a id="id97" class="indexterm"/>controller filename as <code class="literal">controller/mail</code>.</p><p>Let us assume the URI to the project root is <code class="literal">http://mydomain.com/myproject</code>. Hence, the URI to execute the controller for sending the mail will be <code class="literal">http://mydomain.com/myproject/mail</code>.</p><p>We shall remember that in CodeIgniter, if you refer only to the controller URI path, the CI will operate the function controller class <code class="literal">index()function</code>, if any. In case the controller class does have<a id="id98" class="indexterm"/> <code class="literal">index()function</code>. And actually in any case, the controller constructor will be called to create the class instance.</p><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>The controller file</h2></div></div></div><p>The<a id="id99" class="indexterm"/> controller file, <code class="literal">controller/email.php</code>, will initially load the CI mail library, then it will configure the mail service properties, such as from/to e-mail address, subject, HTML body, and the attachment files. Finally, the controller will issue the e-mail send service of the library, getting back the operation completion status to report to the web user. In case of a failure, the controller will render a report for the reason of the failure with debugging information provided by the CI mail library.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>The helpers used are provided with the sample source code provided with this book.</p></div></div><p>Since this controller example has several functions, we shall review their usage initially, before we review the code as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">__construct()</code>: This contractor loads the CI e-mail library to be used by other functions</li><li class="listitem" style="list-style-type: disc"><code class="literal">index()</code>: This builds the e-mail message and sends it to its destination</li><li class="listitem" style="list-style-type: disc"><code class="literal">doc_root_path()</code>: This provides the directory path to find the e-mail attachments to send</li></ul></div><p>Regarding the need to load resources such as libraries, helpers, and models, the best practice is the amount of usage in our controller. Let's say, for example, that we have 40 controllers and 39 of them need the same library. We shall add that library into the auto-load list, <code class="literal">/config/autoload.php</code>. If we did add a resource, such as a library, model, or helper into the project auto-load, we can eliminate loading it in the class that needs the resource services as follows:</p><div class="informalexample"><pre class="programlisting">class Email extends CI_Controller
// The controller/email.php file will contain this class
{
  function __construct()
  {
<span class="strong"><strong>    // call the parent constructor to inherit all its services</strong></span>
    parent::__construct();
<span class="strong"><strong>    // Loads the CI e-mail library, so that it will be instantiated // and its methods will be accessed, as $this-&gt;mail-&gt;METHOD_NAME.</strong></span>
    $this-&gt;load-&gt;library('email');
    }
<span class="strong"><strong>  // Define the controller methodindex (the default method), so that referring to the URI mydomain.com/myproject/email will execute the index method call</strong></span>
  function index() {
<span class="strong"><strong>    // Configure the library to work with UTF-8 strings // multi-language support, as well as enable HTML content body.</strong></span>
    $config['charset'] = 'utf-8';
    $config['mailtype'] = 'html';
    
<span class="strong"><strong>    // Loads the configuration settings by initialize method</strong></span>
    $this-&gt;email-&gt;initialize($config);
<span class="strong"><strong>    // Since the mail body is HTML, define CR/LF to be // replaced with HTML &lt;BR/&gt;</strong></span>
    $this-&gt;email-&gt;set_newline("&lt;BR/&gt;");
<span class="strong"><strong>    // Define the 'From' Email address</strong></span>
    $this-&gt;email-&gt;from('eliorr@phpmyqsl.com', 'Eli Orr');
    
<span class="strong"><strong>    // Define the 'To' Email/s</strong></span>
    $this-&gt;email-&gt;to (array('"Name 1" &lt;name1@name.com&gt;', '"Name 2" &lt;name2@name.com&gt;'));
<span class="strong"><strong>    // Set the e-mail subject</strong></span>
    $this-&gt;email-&gt;subject ("This is the Subject – can be ANY UTF-8 chars");
<span class="strong"><strong>    // Define the e-mail body in HTML format, as we set the message to be HTML typed</strong></span>
    $this-&gt;email-&gt;message
    ('&lt;H1&gt;Hello there!&lt;H1/&gt;
    &lt;p&gt;
    This Email is sent from CI via its cool e-mail library)&lt;BR/&gt;
    &lt;font color=green size=3&gt;&lt;b&gt;See Attached Files&lt;/b&gt;&lt;/font&gt;&lt;BR/&gt;
    Attachedfiles: &lt;BR/&gt;
    &lt;ul&gt;
    &lt;li&gt; 1 - File One.&lt;/li&gt;
    &lt;li&gt; 2 - Second File &lt;/li&gt;
    &lt;/p&gt;
    );
    
<span class="strong"><strong>    // Load the attachments</strong></span>
    $path = $this-&gt;doc_root_path ();
<span class="strong"><strong>    // Doc root For example, /home/yourdomain.com/public_html</strong></span>
<span class="strong"><strong>    // Let say attachment under public_html as /attachments</strong></span>
    $attachment_path1 = $path."/attachments/file1.jpg";
    $attachment_path2 = $path."/attachments/file2.php";
    
<span class="strong"><strong>    // Set the two attachment file paths</strong></span>
    $this-&gt;email-&gt;attach($attachment_path1);
    $this-&gt;email-&gt;attach($attachment_path2);
    
<span class="strong"><strong>    // We have the e-mail object ready! Let us send it!</strong></span>
<span class="strong"><strong>    // execute send and check the result status</strong></span>
    if ($this-&gt;email-&gt;send())
    {
<span class="strong"><strong>      // The e-mail was sent successfully.</strong></span>
      echo 'Your email was sent!';
      }
    else {
<span class="strong"><strong>      // We had some problems, let's show what was wrong</strong></span>
      echo $this-&gt;email-&gt;print_debugger();
      }
    }
  functiondoc_root_path () {
    // An auxiliary method for calculating attachment // file path in our server 
    return $doc_root = $_SERVER["DOCUMENT_ROOT"];
    }
  }</pre></div></div></div>
<div class="section" title="Example 3 &#x2013; admin and regular user log in"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Example 3 – admin and regular user log in</h1></div></div></div><p>In this example we will see how the <a id="id100" class="indexterm"/>controller can coordinate using models and views a<a id="id101" class="indexterm"/> login session for a regular user, as well <a id="id102" class="indexterm"/>as an admin super user, so that each will have a distinct menu. In order to use the provided database file and successfully log in, use the following steps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For regular user login:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">User: <code class="literal">reg_user</code></li><li class="listitem" style="list-style-type: disc">Password: <code class="literal">111111111</code> (9 x 1 s)</li></ul></div></li><li class="listitem" style="list-style-type: disc">For admin user login:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">User: <code class="literal">admin_user</code></li><li class="listitem" style="list-style-type: disc">Password: <code class="literal">111111111</code> (9 x 1 s)</li></ul></div></li></ul></div><p>This example will be constructed from the following controller, models, and views:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">application/controller/auth.php</code>: This <a id="id103" class="indexterm"/>controller is used to control authentication checkup and redirect each user category to its view or notify of a login failure. Regular users and admin users will have different view menu, message, and logout options.</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/models/users_model.php</code>: This is the<a id="id104" class="indexterm"/> model to validate the submitted user name and password (stored in the database via MD5) against the predefined database table of users.</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/views/login_view.php</code>: This is the <a id="id105" class="indexterm"/>view shown to users that are not logged in, in order to log in.</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/views/logged_in_view.php</code>: This<a id="id106" class="indexterm"/> is the view shown to users that were successfully logged in and performed their roles as <code class="literal">reg_user</code>/admin users.</li><li class="listitem" style="list-style-type: disc"><code class="literal">MySQL database- USERS_DB.sql</code>: This is a database <a id="id107" class="indexterm"/>table that we will upload to our database.</li></ul></div><p>Let us assume the URI to <a id="id108" class="indexterm"/>the project root is <code class="literal">http://mydomain.com/myproject</code>.</p><p>Hence the URI to execute the auth controller for login will be <code class="literal">http://mydomain.com/myproject/auth</code>.</p><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>The controller file</h2></div></div></div><p>The controller file, <code class="literal">controller/auth.php</code>, will <a id="id109" class="indexterm"/>initially load the CI form helper; this helper will be used to construct and operate the login form. For more on helper usage and scope, refer to <a class="link" href="ch05.html" title="Chapter 5. Helpers">Chapter 5</a>, <span class="emphasis"><em>Helpers</em></span>.</p><p><code class="literal">users_model</code>, written especially to serve the controller for authenticating users credentials against the user table, will be loaded. The controller <code class="literal">auth</code>/<code class="literal">index</code> will be called from both the initial stage as well as after a <code class="literal">login_view</code> submission.</p><p>The session is a well known issue in PHP and is out of the scope of this book. However, CI enables the storing of operated sessions with served clients via the database in a table named <code class="literal">ci_sessions</code>.</p><p>This way the sessions are much more organized for the project to manipulate with search session and load session parameter. In order to use a database stored session, we shall edit <code class="literal">/config/config.php</code>.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$config['sess_use_database'] = TRUE;</strong></span>
<span class="strong"><strong>/* Enforce storing sessions data in the database */</strong></span>
</pre></div><p>Also, we will add a session library as we want to use it for this example along with other commonly used <code class="literal">/config/autoload.php</code> libraries.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$autoload['libraries'] = array('database', 'session', 'xmlrpc');</strong></span>
</pre></div><p>In case of a submission, the input post for the password will not be null and the controller will proceed with the credentials checkup using the <code class="literal">users_model</code> model. If successful, the user record fields will be kept in the session and the controller methods <code class="literal">auth/admin_main_menu</code> or <code class="literal">auth/user_main_menu</code> will be called as per the model returned user role. If the logged in user issues the logout anchor, <code class="literal">auth/logout</code> will be called to destroy the<a id="id110" class="indexterm"/> session and redirect the user to the login form.</p><p>The following is the code:</p><div class="informalexample"><pre class="programlisting">class Auth extends CI_Controller {
  function __construct() {
    parent::__construct
    $this-&gt;load-&gt;helper ('form');
    $this-&gt;load-&gt;model ('users_model');
    }
  // called with auth is called with no specific method and // simply calls the login method
  function index() {
    $this-&gt;login();
    }
  functionlogin()
  {
    // The message to user in case of login failure
    $msg = "";
    if ($this-&gt;input-&gt;post('password'))
    {
      // The caller is from the form submission 
      // we will check credentials validity using the local method // check_login.
      $stat = $this-&gt;check_login();
      // Extract failure message to user if any
      $msg = $stat ['msg' ];
      if($stat['result'] == 'ok')
      {
        // Successful login!
        // See what We have
        // admin_user or regular user?
        if ($this-&gt;session-&gt;userdata ('role') == 'admin_user')
        // Issue the controller for admin user main menu
        redirect('auth/admin_main_menu');
        else
        // Issue regular user main menu controller
        redirect('auth/user_main_menu');
        return;
        }
      }
    else {
      // rendered with no submission 
      // let's destroy any previous session and challenge again // the user
      $this-&gt;session-&gt;sess_destroy();
      }
    // We can get here due to login failure or referring to auth // controller without any active submission.
    // Keep the msg return from the model into view view_setup
    ['msg'] = $msg; 
    // render the login view to challenge the user
    $this-&gt;load-&gt;view('login_view.php', $view_setup);
    }
  functioncheck_login() {
    // Extract the credentials from the submitted login_viewform
    $user_name = $this-&gt;input-&gt;post('user_name');
    $password = $this-&gt;input-&gt;post('password');
    // init an array to return
    $ret = array ();
    // Check if login is ok and get the $row using the loaded // users_model model.
    $user_record = $this-&gt;users_model-&gt;check_login ($user_name, $password);
    if ($user_record) {
      // User passed credentials checkup successfully
      // We have the user record. Let's use it to extract info // for the logged session buildup
      $this-&gt;session-&gt;set_userdata ('user_id', $user_record-&gt;id);
      $this-&gt;session-&gt;set_userdata ('user_name', $user_record-&gt;user_name);
      $this-&gt;session-&gt;set_userdata ('role', $user_record-&gt;role);
      $ret ['result'] = 'ok'; $ret ['msg' ] = 'Logged-in!';
      }
    else {
    // login failed!
    $ret ['result'] = 'notok';
    // inform the login form to alert user for the failure
    $ret ['msg' ] = 'Invalid User/Pass - Try Again!';
    }
  return $ret;
  }
// logout method called auth/logout
function logout() {
  // destroy the current session
  $this-&gt;session-&gt;sess_destroy();
  redirect('auth');
  }
functionadmin_main_menu() {
  // Shall render an admin main menu page
  $view_setup ['uid'] = $this-&gt;session-&gt;userdata ('user_id');
  $view_setup ['user_name'] = $this-&gt;session-&gt;userdata ('user_name');
  $view_setup ['role'] = $this-&gt;session-&gt;userdata ('role');
  $view_setup ['menu'] = "Add User/Modify User/Delete User";
  $this-&gt;load-&gt;view ('logged_in_view.php', $view_setup);
  }

functionuser_main_menu() {
  // Shall render a regular user
  $view_setup ['uid'] = $this-&gt;session-&gt;userdata ('user_id');
  $view_setup ['user_name']= $this-&gt;session-&gt;userdata ('user_name');
  $view_setup ['role']= $this-&gt;session-&gt;userdata ('role');
  $view_setup ['menu']= "View Content/Modify Your Account/Logout";
  $this-&gt;load-&gt;view ('logged_in_view.php', $view_setup);
  }
}</pre></div></div><div class="section" title="The model file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>The model file</h2></div></div></div><p>The <a id="id111" class="indexterm"/>model file <code class="literal">application/models/users_model.php</code> will serve the controller for authenticating user credentials against the user table. If successful, the model will return the user database row to the caller.</p><p><code class="literal">auth/admin_main_menu</code> or <code class="literal">auth/user_main_menu</code> will be called as per the model returned user role. If the logged in user issues the logout anchor, <code class="literal">auth/logout</code> will be called to destroy the session and redirect the user to the login form.</p><p>The following is the code:</p><div class="informalexample"><pre class="programlisting">class Users_model extends CI_Model {
  function __construct()
  {
    parent::__construct();
    }
  functioncheck_login ($user, $pass)
  {
<span class="strong"><strong>  // Important notice.</strong></span>
<span class="strong"><strong>  // Since the model extends the base CI model, it already got the // instance. However, we can use the $ci = &amp;get_instance(); instead // $this-&gt; anywhere in helpers, libraries, and so on.</strong></span>
  // convert the typed password in the login form to md5, same as // we do, when opening a user account.
  $md5_pass = md5($pass);
  // build up the query 
  $sql = "SELECT * FROM users WHERE user_name = '$user' AND password = '$md5_pass' ";
  $q = $this-&gt;db-&gt;query($sql);
  if ($q-&gt;num_rows()) {
    foreach ($q-&gt;result() as $row)
    return $row;
    }
  // In case no num_rows: return NULL;
  }
}</pre></div></div><div class="section" title="The database file to upload for this example"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec28"/>The database file to upload for this example</h2></div></div></div><p>We shall <a id="id112" class="indexterm"/>upload this database file, provided as part of the book resources, into our database connected to CI.</p><p>The user table includes two users, namely <code class="literal">reg_user</code> and <code class="literal">admin_user</code>. Their passwords are stored as the md5 of the text passwords, where <code class="literal">111111111</code> and <code class="literal">222222222</code> are the passwords of the <code class="literal">reg_user</code> and <code class="literal">admin_user</code> users.</p><p>The following is the code:</p><div class="informalexample"><pre class="programlisting">-- phpMyAdmin SQL Dump
-- http://www.phpmyadmin.net
SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";
--
-- Table structure for table `users`
--
CREATE TABLE IF NOT EXISTS `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_name` varchar(128) NOT NULL,
  `password` varchar(128) NOT NULL,
  `role` varchar(128) NOT NULL,
  PRIMARY KEY (`id`)
  ) ENGINE=MyISAM DEFAULT CHARSET = utf8 AUTO_INCREMENT = 3;
--
-- Dumping data for table users
--
INSERT INTO `users` (`id`, `user_name`, `password`, `role`)
VALUES (1, 'reg_user', 'bbb8aae57c104cda40c93843ad5e6db8', 'regular_user'), (2, 'admin_user', '0d777e9e30b918e9034ab610712c90cf', 'admin_user');</pre></div></div><div class="section" title="The login_view view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec29"/>The login_view view file</h2></div></div></div><p>The <code class="literal">login_view</code> view is rendered by the <code class="literal">application/auth/index</code> index method in order to show non-logged in web visitors to a login page, to enable to challenge them with a login stage.</p><p>Following a user entering the user name and password and submitting the login_view view form the <code class="literal">application/auth/login</code> will be called and will check the credentials using the users model. In case of a successful login, and based on the logged in user category fetch from the users model, one of the <code class="literal">auth</code> methods will be called as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">auth/admin_main_menu</code>: In case the user has the admin role to render the successful login view for the admin user</li><li class="listitem" style="list-style-type: disc"><code class="literal">auth/user_main_menu</code>: In case the user has the admin role to render the successful login view for the regular user</li></ul></div><p>The view is located at <code class="literal">application/views/login_view.php</code>. This view uses many of the CI form helper functions loaded by the <code class="literal">auth</code> controller. When a user issues a submission, the input is initially checked at the client side before issuing a submission call to <code class="literal">application/auth</code>.</p><p>The following is the code:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html"&gt;
&lt;meta http-equiv = "Content-type" content = "text/html; charset=utf-8"/&gt;
&lt;html&gt;
&lt;head&gt;
&lt;script src = http://code.jquery.com/jquery-latest.js type = 'text/javascript'&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;H1&gt;Login Here&lt;/H1&gt;
&lt;!—Building the login form using the form helper--&gt;
&lt;?php
// Define the form attributes
// We will use the 'form' helper 'auth' will // be called on submission only, if check_if_valid()// will return true!
$submit_attributes = array('onsubmit' =&gt;"return check_if_valid();", 'id' =&gt; 'auth');
echoform_open('auth', $submit_attributes);
echo "&lt;table&gt;&lt;tr&gt;&lt;td&gt;";
// The attributes of the &lt;input tag&gt;
echoform_label("User Name");
echo "&lt;/td&gt;&lt;td&gt;";
echoform_input(array('name' =&gt; 'user_name', 'value' =&gt; ''));
echo "&lt;/td&gt;&lt;td&gt;";

// The error message holders – hidden by default echo
&lt;label id='user_name_err' style = 'color:red; display:none'&gt;name is too short &lt;/label&gt;";
echo "&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;';
echoform_label("Password");
echo "&lt;/td&gt;&lt;td&gt;";
echoform_password("password","");
echo "&lt;/td&gt;&lt;td&gt;";
// The error message holders – hidden by default echo
&lt;label id='password_err' style = 'color: red; display: none'&gt; password is too short &lt;/label&gt;";
echo "&lt;/td&gt;&lt;/tr&gt;";
echo "&lt;/table&gt;";
// The submit button echo
form_input(array('type' =&gt; 'submit', 'value' =&gt;'Login'));
echoform_close(); ?&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;!-- Server Credentials failure message --&gt;
&lt;p style = "color: red"&gt;&lt;?php echo $msg; ?&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;!-- Local JavaScript service --&gt;
&lt;script type='text/javascript'&gt;
functioncheck_if_valid() {
  var submit = true;
  varuser_name = $('[name="user_name"]').val();
  var password = $('[name="password"]').val();
  if (user_name.length&lt; 2) {
    $('#user_name_err').show();
    submit = false;
    }
  else $('#user_name_err').hide();
  if (password.length&lt; 6) {
    $('#password_err').show();
    submit = false;
    }
  else $('#password_err').hide();
  return submit;
  }
&lt;/script&gt;
&lt;/html&gt;</pre></div></div><div class="section" title="The login_in_view view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec30"/>The login_in_view view file</h2></div></div></div><p>The <code class="literal">login_in_view</code> view is rendered following a successful login by either <code class="literal">application/auth/admin_main_menu</code> controller method or <code class="literal">application/auth/user_main_menu</code> method base on the user category with the info of the logged in user.</p><p>Both the controllers uses the <code class="literal">users_model</code> model to validate the login attempt and fetch the  logged in user. The view shows the logged in user some information about its account, such as the user name and role as well as the menu available for its user category.</p><p>The view is located at <code class="literal">application/views/login_in_view.php</code>. This view is using parameters provided by the <code class="literal">$user_nam</code>, <code class="literal">$uid</code>, <code class="literal">$role</code>, and <code class="literal">$menu</code> controller to be shown to the logged in user. From this view, the user may issue a logout anchor that calls <code class="literal">auth/logout</code> to destroy the session and redirect the logged in user to the login view.</p><p>Many of the <a id="id113" class="indexterm"/>CI form <a id="id114" class="indexterm"/>helper functions are loaded by the <code class="literal">auth</code> controller. When user issues are submitted, the input is initially checked at the client side before issuing a submission call to <code class="literal">application/auth</code>.</p><p>The following is the code:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html"&gt;
&lt;meta http-equiv = "Content-type" content = "text/html; charset&lt;!DOCTYPE html"&gt;
&lt;meta http-equiv = "Content-type" content = "text/html; charset=utf-8"/&gt;
&lt;html&gt;
&lt;body&gt;
&lt;H1&gt;Welcome &lt;? = $user_name; ?&gt;!&lt;/H1&gt;
&lt;H1&gt;You are logged in!&lt;/H1&gt;
&lt;HR&gt;&lt;/HR&gt;
&lt;H3&gt;Your User ID is: &lt;? = $uid; ?&gt;&lt;/H3&gt;
&lt;H3&gt;Your System Role is:&lt;? = $role; ?&gt;&lt;/H3&gt;
&lt;H3&gt;Your Menu options: &lt;? = $menu; ?&gt;&lt;/H3&gt;
&lt;?php echo anchor ('auth/logout', 'Logout') ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Summary</h1></div></div></div><p>In this chapter, we have reviewed the CI controller scope and the different controller usage categories targeting view rendering and serve AJAX client requests or apache crontab scheduled processing requests. We have reviewed the various resources that the controller can be assisted with, such as the helpers, libraries, and models. Eventually, we have made several usage examples as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example 1: default home page controller</li><li class="listitem" style="list-style-type: disc">Example 2: sending e-mails with attachments</li><li class="listitem" style="list-style-type: disc">Example 3: admin and regular user log in</li></ul></div></div></body></html>