<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Building Your First FuelPHP Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Building Your First FuelPHP Application</h1></div></div></div><p>Throughout the book, we will use the <span class="strong"><strong>FuelPHP</strong></span>
<a id="id0" class="indexterm"/> framework to build different types of projects. The objective of this chapter is to make you familiar with the basics of the framework and create your first project as quickly as possible. We won't create anything exceptional in this chapter and there will be very little coding, but we will go through the whole process from installing FuelPHP to publishing your project on a production server. You will learn the necessary basics for the other projects as well.</p><p>By the end of the chapter, you should know the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A common development process of a FuelPHP application</li><li class="listitem" style="list-style-type: disc">How to install FuelPHP (the latest or a specific version)</li><li class="listitem" style="list-style-type: disc">The FuelPHP file system hierarchy</li><li class="listitem" style="list-style-type: disc">Two different ways to configure Apache to access your application</li><li class="listitem" style="list-style-type: disc">How to configure FuelPHP to connect to a database</li><li class="listitem" style="list-style-type: disc">The oil command line and how to use it for scaffolding your application</li><li class="listitem" style="list-style-type: disc">How does an application respond to a URL requested by a visitor</li><li class="listitem" style="list-style-type: disc">What are the FuelPHP templates</li><li class="listitem" style="list-style-type: disc">How to publish your project to a host</li></ul></div><p>Since this book is intended for intermediate developers, we will assume that you have already installed Apache and MySQL on your system. Some prior knowledge of Git and Composer is an added advantage as you might need it, but you should be fine in this book if you are not familiar with these tools. However, for advanced applications that need collaboration between several developers mastering them is highly recommended.</p><p>In this chapter, we will go from installing the FuelPHP framework to having a functional – though limited – web application. As our objective here is to introduce the framework and create a sample application as quickly as possible, we won't address important topics such as the ORM, which will be addressed in <a class="link" href="ch02.html" title="Chapter 2. Building a To-do List Application">Chapter 2</a>, <span class="emphasis"><em>Building a To-do List Application</em></span>.</p><div class="section" title="About FuelPHP"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>About FuelPHP</h1></div></div></div><p>Dan Horrigan started the <a id="id1" class="indexterm"/>FuelPHP framework in late 2010, and was later joined by Phil Sturgeon, Jelmer Schreuder, Harro Verton, Frank de Jonge, Steve West and Márk Sági-Kazár. The first stable version was released on July 31st, 2011 and this book is based on FuelPHP 1.7.2, the latest stable version available as of writing this book. With over 300 contributors, its community is large and active.</p><p>The core team is currently working on the second version of FuelPHP; several alpha versions of it have already been released.</p><p>If you want to know more about the FuelPHP team and the framework philosophy, I recommend you to read the <span class="strong"><strong>About FuelPHP</strong></span> section of the <a id="id2" class="indexterm"/>official website at:</p><p>
<a class="ulink" href="http://fuelphp.com/about">http://fuelphp.com/about</a>
</p><p>You can read the latest news about the <a id="id3" class="indexterm"/>framework on its official blog at:</p><p>
<a class="ulink" href="http://fuelphp.com/blogs">http://fuelphp.com/blogs</a>
</p><p>The <a id="id4" class="indexterm"/>official documentation can be found at: <a class="ulink" href="http://fuelphp.com/docs/">http://fuelphp.com/docs/</a>
</p><p>If you have any questions about FuelPHP or encounter any issues, you can search the <a id="id5" class="indexterm"/>official forum (<a class="ulink" href="http://fuelphp.com/forums/">http://fuelphp.com/forums/</a>) and start a new discussion if you don't find any answer. In a general manner, the official website (<a class="ulink" href="http://fuelphp.com">http://fuelphp.com</a>) is an <a id="id6" class="indexterm"/>excellent resource.</p></div></div>
<div class="section" title="Development process of a FuelPHP application"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Development process of a FuelPHP application</h1></div></div></div><p>The development process<a id="id7" class="indexterm"/> of a FuelPHP application<a id="id8" class="indexterm"/> generally contains the steps shown in the following image:</p><div class="mediaobject"><img src="graphics/5401OS_01_01.jpg" alt="Development process of a FuelPHP application"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Install FuelPHP</strong></span>: Since we are <a id="id9" class="indexterm"/>using <a id="id10" class="indexterm"/>this framework, this first step is quite obvious.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Config</strong></span> (<span class="strong"><strong>configuration</strong></span>): At the <a id="id11" class="indexterm"/>beginning, you will generally need to specify how to connect to the database and which package you will use. Later on, you might also need to create and use your own configuration files to improve the maintainability of your application.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Scaffold</strong></span>: The oil command <a id="id12" class="indexterm"/>line of FuelPHP allows you to easily generate code files ready to be used. This step is not necessary, but we will often use this functionality in this book because it really speeds up the implementation of your application.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Dev</strong></span> (<span class="strong"><strong>development</strong></span>): This is <a id="id13" class="indexterm"/>where you, as a developer, step in. You customize the generated code to get exactly what you want. When you want to add new features (for instance a new model), you go back to the scaffolding step.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Tests</strong></span>: Functional and <a id="id14" class="indexterm"/>unit testing are important if you want large applications to stay maintainable. When bugs are discovered, you go back to the development step in order to fix them. Unlike the other steps, we won't approach this subject in this chapter for the sake of its conciseness. It will be addressed in <a class="link" href="ch05.html" title="Chapter 5. Building Your Own Restful API">Chapter 5</a>, <span class="emphasis"><em>Building Your Own RESTful API</em></span>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Prod</strong></span> (<span class="strong"><strong>production</strong></span>): Having a<a id="id15" class="indexterm"/> project working locally is nice, but the final objective is generally to publish it online. We will give you some directions about this step at the end of this chapter, but we won't get too much into the details, given the diversity of available hosting services.</li></ul></div><p>Just to be clear, this is a very general guideline, and of course the order of the steps is not rigid. For instance, developers using the test-driven development process could merge the fourth and fifth steps, or a preproduction step could be added. The development process should only depend on each developer and institution's standards.</p></div>
<div class="section" title="Installing the environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Installing the environment</h1></div></div></div><p>The FuelPHP framework needs the <a id="id16" class="indexterm"/>following three components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Web server</strong></span>: The <a id="id17" class="indexterm"/>most common <a id="id18" class="indexterm"/>solution is Apache</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>PHP interpreter</strong></span>: The <a id="id19" class="indexterm"/>5.3.3 version<a id="id20" class="indexterm"/> or greater</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database</strong></span>: We will use <a id="id21" class="indexterm"/>MySQL<a id="id22" class="indexterm"/></li></ul></div><p>FuelPHP works on <span class="strong"><strong>Unix-like</strong></span>
<a id="id23" class="indexterm"/> and <span class="strong"><strong>Windows</strong></span>
<a id="id24" class="indexterm"/> operating systems, but the installation and configuration procedures of these components will depend on the operating system used. In the following sections we will provide some directions to get you started in case you are not used to installing your development environment. Please note that these are very generic guidelines, so you might need to search the web for complimentary information. There are countless resources on the topic.</p><div class="section" title="Windows"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Windows</h2></div></div></div><p>A complete and very <a id="id25" class="indexterm"/>popular <a id="id26" class="indexterm"/>solution is to install <a id="id27" class="indexterm"/>
<span class="strong"><strong>WAMP</strong></span>. This will install Apache, MySQL, and PHP, in other words everything you need to get started. It can be <a id="id28" class="indexterm"/>accessed at <a class="ulink" href="http://www.wampserver.com/en/">http://www.wampserver.com/en/</a>.</p></div><div class="section" title="Mac"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Mac</h2></div></div></div><p>PHP and Apache are generally installed on the latest version of the OS, so you just have to install MySQL. To do this, you are recommended to read the official documentation<a id="id29" class="indexterm"/> at <a class="ulink" href="http://dev.mysql.com/doc/refman/5.1/en/macosx-installation.html">http://dev.mysql.com/doc/refman/5.1/en/macosx-installation.html</a>.</p><p>A very convenient solution for those who have the least system administration skills is to install<a id="id30" class="indexterm"/> <span class="strong"><strong>MAMP</strong></span>, the equivalent of WAMP, but for the Mac operating system. It can be <a id="id31" class="indexterm"/>downloaded from <a class="ulink" href="http://www.mamp.info/en/downloads/">http://www.mamp.info/en/downloads/</a>.</p></div><div class="section" title="Ubuntu"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Ubuntu</h2></div></div></div><p>As this is the most popular Linux distribution, we <a id="id32" class="indexterm"/>will limit our instructions <a id="id33" class="indexterm"/>to Ubuntu.</p><p>You can install a complete environment by executing the following command lines: </p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># Apache, MySQL, PHP</strong></span>
<span class="strong"><strong>sudo apt-get install lamp-server^</strong></span>

<span class="strong"><strong># PHPMyAdmin allows you to handle the administration of MySQL DB</strong></span>
<span class="strong"><strong>sudo apt-get install phpmyadmin</strong></span>

<span class="strong"><strong># Curl is useful for doing web requests</strong></span>
<span class="strong"><strong>sudo apt-get install curl libcurl3 libcurl3-dev php5-curl </strong></span>

<span class="strong"><strong># Enabling the rewrite module as it is needed by FuelPHP</strong></span>
<span class="strong"><strong>sudo a2enmod rewrite </strong></span>

<span class="strong"><strong># Restarting Apache to apply the new configuration</strong></span>
<span class="strong"><strong>sudo service apache2 restart</strong></span>
</pre></div></div><div class="section" title="Recommended modules and extensions"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Recommended modules and extensions</h2></div></div></div><p>The <a id="id34" class="indexterm"/>Apache <span class="strong"><strong>mod_rewrite</strong></span> module<a id="id35" class="indexterm"/> and some additional PHP <a id="id36" class="indexterm"/>extensions are also recommended, but not required:</p><p>
<a class="ulink" href="http://fuelphp.com/docs/requirements.html">http://fuelphp.com/docs/requirements.html</a> (can be accessed through the FuelPHP website by navigating to<a id="id37" class="indexterm"/> <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Basic</strong></span> | <span class="strong"><strong>Requirements</strong></span>)</p></div><div class="section" title="Getting the FuelPHP framework"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Getting the FuelPHP framework</h2></div></div></div><p>As this book is being written, there are four <a id="id38" class="indexterm"/>common ways to download FuelPHP:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading and unzipping the compressed package which can be found on the FuelPHP website.</li><li class="listitem" style="list-style-type: disc">Executing the FuelPHP quick command-line installer.</li><li class="listitem" style="list-style-type: disc">Downloading and installing FuelPHP using Composer.</li><li class="listitem" style="list-style-type: disc">Cloning the FuelPHP GitHub repository, it is a little bit more complicated but allows you to select exactly the version (or even the commit) you want to install.</li></ul></div><p>These approaches are very well-documented on <a id="id39" class="indexterm"/>the website installation instructions page at <a class="ulink" href="http://fuelphp.com/docs/installation/instructions.html">http://fuelphp.com/docs/installation/instructions.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Installation</strong></span> | <span class="strong"><strong>Instructions</strong></span>)</p></div><div class="section" title="Installing FuelPHP 1.7.2"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Installing FuelPHP 1.7.2 </h2></div></div></div><p>FuelPHP is always <a id="id40" class="indexterm"/>evolving and<a id="id41" class="indexterm"/> will continue to evolve even after this book is published. As we used FuelPHP 1.7.2 in this book, you might want to install the same version in order to prevent any conflict. You can do this by either downloading the appropriate ZIP file, cloning the 1.7/master branch of the GitHub repository, or using Composer.</p><div class="section" title="Downloading the appropriate ZIP file"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Downloading the appropriate ZIP file</h3></div></div></div><p>This is the simplest <a id="id42" class="indexterm"/>solution. You should be able to download it by requesting the URL <a class="ulink" href="http://fuelphp.com/files/download/28">http://fuelphp.com/files/download/28</a>.</p><p>Alternatively, you can access all the compressed packages<a id="id43" class="indexterm"/> of important FuelPHP releases at <a class="ulink" href="http://fuelphp.com/docs/installation/download.html">http://fuelphp.com/docs/installation/download.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> |<span class="strong"><strong> TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Installation</strong></span> | <span class="strong"><strong>Download</strong></span>)</p></div><div class="section" title="Using Composer"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Using Composer</h3></div></div></div><p>First, if you didn't do it yet, you need to <a id="id44" class="indexterm"/>install <span class="strong"><strong>Composer</strong></span>. You can find out how by reading the official<a id="id45" class="indexterm"/> website at <a class="ulink" href="https://getcomposer.org/">https://getcomposer.org/</a>.</p><p>The installation instructions for major operating systems are given in the <span class="strong"><strong>Getting Started</strong></span> guide. Please note that you can install Composer either globally or locally.</p><p>From now on, we will generally assume that you have installed Composer globally. If Composer is installed locally into your working directory, our instructions will work if you replace <code class="literal">composer</code> by <code class="literal">php composer.phar</code>.</p><p>In order to specifically install FuelPHP 1.7, you can simply execute the following command line (replace <code class="literal">TARGET</code> by the directory in which you want to download FuelPHP):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>composer create-project fuel/fuel:dev-1.7/master TARGET</strong></span>
</pre></div></div></div><div class="section" title="Updating FuelPHP"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Updating FuelPHP</h2></div></div></div><p>If you have downloaded<a id="id46" class="indexterm"/> FuelPHP by cloning the GitHub repository, or if you simply want to update FuelPHP and its dependencies, you have to enter the following command line at the location you installed your instance of FuelPHP:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php composer.phar update</strong></span>
</pre></div><p>As you can see, Composer is locally installed in the FuelPHP root directory.</p></div><div class="section" title="Installation directory and apache configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Installation directory and apache configuration</h2></div></div></div><p>Now that you know how to install FuelPHP in a given directory, <a id="id47" class="indexterm"/> we will give you the two main ways you can integrate <a id="id48" class="indexterm"/>the framework in your environment.</p><div class="section" title="The simplest way"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>The simplest way </h3></div></div></div><p>Assuming you have activated the <span class="strong"><strong>mod_rewrite</strong></span>
<a id="id49" class="indexterm"/> Apache module, the simplest way is to install FuelPHP in the root folder of your web server (generally the <code class="literal">/var/www directory</code> on Linux systems). If you install FuelPHP in the <code class="literal">DIR</code> directory of the root folder (<code class="literal">/var/www/DIR</code>), you will be able to access your project at the following URL:</p><p>
<code class="literal">http://localhost/DIR/public/</code>
</p><p>However, be warned that FuelPHP has not been implemented to support this, and if you publish your project this way in the production server, it will introduce security issues you will have to handle. In such cases, you are recommended to use the second way we will explain in the upcoming section, although, for instance if you plan to use a shared host to publish your project, you might not have the choice. A complete and up-to-date documentation about this issue can be found in the FuelPHP<a id="id50" class="indexterm"/> installation instruction page at <a class="ulink" href="http://fuelphp.com/docs/installation/instructions.html">http://fuelphp.com/docs/installation/instructions.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Installation</strong></span> | <span class="strong"><strong>Instructions</strong></span>)</p></div><div class="section" title="By setting up a virtual host"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>By setting up a virtual host</h3></div></div></div><p>Another way is to create a <a id="id51" class="indexterm"/>virtual host to access your application. You will need a little bit more Apache and system administration skills, but the benefit is that it is more secure and you will be able to choose your working directory. You will need to change two files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Your Apache virtual host file(s) in order to link a virtual host to your application</li><li class="listitem" style="list-style-type: disc">Your system host file in order to redirect the wanted URL to your virtual host</li></ul></div><p>In both cases, the files' location will be dependent on your operating system and the server environment you are using; therefore, you will have to figure out their location yourself (if you are using a common configuration, you won't have any problem to finding instructions on your preferred search engine).</p><p>In the following example, we will set up your system to call your application when requesting the <code class="literal">my.app</code> URL on your local environment (*nix system recommended).</p><p>Let's first edit the virtual host file(s). Add the following code at the end:</p><div class="informalexample"><pre class="programlisting">&lt;VirtualHost *:80&gt;
    ServerName my.app
    DocumentRoot YOUR_APP_PATH/public
    SetEnv FUEL_ENV "development"
    &lt;Directory YOUR_APP_PATH/public&gt;
        DirectoryIndex index.php
        AllowOverride All
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre></div><p>Then, open your system host file and add the following line at the end:</p><div class="informalexample"><pre class="programlisting">127.0.0.1 my.app</pre></div><p>Depending on your <a id="id52" class="indexterm"/>environment, you might need to restart Apache after this. You can now access your website at: <code class="literal">http://my.app/</code>.</p><div class="mediaobject"><img src="graphics/5401OS_01_02.jpg" alt="By setting up a virtual host"/></div><p>Congratulations! You just have successfully installed the FuelPHP framework. The welcome page shows some recommended directions to continue your project.</p></div></div></div>
<div class="section" title="FuelPHP basics"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>FuelPHP basics</h1></div></div></div><p>Now that we have installed a<a id="id53" class="indexterm"/> working version of FuelPHP, let's analyze, on a very basic level, how the framework works. We won't go into the details here; the idea is to only understand the necessary information to use the framework. In this section, you are recommended to follow and check our explanations on your installed instance; don't hesitate to explore files and folders, this will make you more comfortable when we will begin our project's implementation. In this section, we will approach the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The FuelPHP file system hierarchy</li><li class="listitem" style="list-style-type: disc">MVC, HMVC, and how it works on FuelPHP</li><li class="listitem" style="list-style-type: disc">The oil utility</li></ul></div><div class="section" title="The FuelPHP file system hierarchy"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>The FuelPHP file system hierarchy</h2></div></div></div><p>Let's dive into the directory<a id="id54" class="indexterm"/> where we have installed FuelPHP. You might want to follow along using a file browser. As this book is being written, the current version of FuelPHP has the following directory hierarchy:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/docs</code>: contains an HTML version of the framework documentation</li><li class="listitem" style="list-style-type: disc">/<code class="literal">fuel</code>, which contains:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">/<code class="literal">fuel/app</code>: Everything related to your application. This is where you will work most of the time. We will look into this directory in the upcoming <span class="emphasis"><em>The app directory</em></span> section.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">fuel/core</code>: The core classes and configuration. You should not change anything inside it, unless of course you want to contribute to the FuelPHP core.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">fuel/packages</code>: Packages are core extensions, they are bundles containing reusable classes and configuration files. Using the FuelPHP default configuration, this is the only directory where you can install packages (your own as well as from external sources). Notice that there are already five installed packages. We will use each of them in this book.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">vendor</code>: This directory contains third-party packages and libraries that are generally not FuelPHP-specific.</li></ul></div></li><li class="listitem" style="list-style-type: disc">/<code class="literal">public</code>: This directory is accessible by external visitors. You want to put here files publicly available, as CSS or JS files for instance.</li></ul></div><div class="section" title="The app directory"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>The app directory</h3></div></div></div><p>As written earlier, the app <a id="id55" class="indexterm"/>directory <a id="id56" class="indexterm"/>is where you will work most of the time. Thus, you should be familiar with its hierarchy, which is given as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">/<code class="literal">cache</code>: This directory is used to store cache files that improve your application's performance.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">classes</code>: Classes used by your application:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">/<code class="literal">classes/controller</code>: Where you have to implement your controllers (see the <span class="emphasis"><em>MVC, HMVC, and how it works on FuelPHP</em></span> section)</li><li class="listitem" style="list-style-type: disc">/<code class="literal">classes/model</code>: Where you have to implement your models (see the <span class="emphasis"><em>MVC, HMVC, and how it works on FuelPHP</em></span> section)</li><li class="listitem" style="list-style-type: disc">/<code class="literal">classes/presenter</code>: Where you have to implement your presenters (see the <span class="emphasis"><em>MVC, HMVC, and how it works on FuelPHP</em></span> section).</li></ul></div></li><li class="listitem" style="list-style-type: disc">/<code class="literal">config</code>: Every <a id="id57" class="indexterm"/>configuration file. Since <a id="id58" class="indexterm"/>some files are important, we will list them as well:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">/<code class="literal">config/config.php</code>: Defines important FuelPHP configuration items such as activated packages or security settings.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">config/db.php</code>: Defines database connection information.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">config/routes.php</code>: Defines the application's routes (we will approach them later in this chapter).</li><li class="listitem" style="list-style-type: disc">/<code class="literal">config/development</code>, <code class="literal">config/production</code>, <code class="literal">config/staging</code>, <code class="literal">config/test</code>: All configuration files in the <code class="literal">config/ENV</code> directory, <code class="literal">ENV</code> being the current environment, are merged with the ones in the <code class="literal">config</code> folder. For instance, if the FuelPHP environment is set to <code class="literal">development</code> (as it is by default), the <code class="literal">config/development/db.php</code> file will be recursively merged with the <code class="literal">config/db.php</code> file. In concrete terms, this means that configuration items defined in the <code class="literal">config/ENV/db.php</code> file overwrite those in the <code class="literal">config/db.php</code> file. We will illustrate this through an example in <span class="emphasis"><em>The oil utility and the oil console</em></span> section.</li></ul></div></li><li class="listitem" style="list-style-type: disc">/<code class="literal">lang</code>: Contains the translation files.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">logs</code>: Contains the log files. The log file path depends on the day it is written. For instance, if you log a message on July 1, 2015, it will be saved in the file located in <code class="literal">logs/2015/07/01.php</code>.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">migrations</code>: Contains the migration files, which allow you to easily alter your database in a structured manner. For instance, if many people are working on the same project, or if there are many instances of the same project (development/production), they make the database change easier. We will often use them in the book.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">modules</code>: Contains your application's modules. Each module can be described as a bundle of code that can respond to requests and be easily reused on other projects. We will create a module for the blog project in <a class="link" href="ch03.html" title="Chapter 3. Building a Blog Application">Chapter 3</a>, <span class="emphasis"><em>Building a Blog Application</em></span>.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">tasks</code>: Contains task files, which are classes that can be executed from the command line (for cron jobs for instance).</li><li class="listitem" style="list-style-type: disc">/<code class="literal">tests</code>: Contains test files, which can be used to automatically test your application. We will approach them in <a class="link" href="ch05.html" title="Chapter 5. Building Your Own Restful API">Chapter 5</a>, <span class="emphasis"><em>Building Your Own RESTful API</em></span>, to test our application.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">tmp</code>: Contains temporary files.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">vendor</code>: This <a id="id59" class="indexterm"/>directory contains third-party <a id="id60" class="indexterm"/>libraries and packages only used by your application.</li><li class="listitem" style="list-style-type: disc">/<code class="literal">views</code>: Contains the view files used by your application (see the <span class="emphasis"><em>MVC, HMVC, and how it works on FuelPHP </em></span>section).</li></ul></div></div><div class="section" title="The packages"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec06"/>The packages</h3></div></div></div><p>The <code class="literal">fuel/packages</code> directory contains <a id="id61" class="indexterm"/>five <a id="id62" class="indexterm"/>default packages that, when activated, can add interesting features to FuelPHP:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">auth</code> package provides a standardized interface for user authentication. We will use this package in <a class="link" href="ch05.html" title="Chapter 5. Building Your Own Restful API">Chapter 5</a>, <span class="emphasis"><em>Building Your Own RESTful API</em></span>.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">email</code> package provides an interface to send e-mails using different drivers. We will use this package in <a class="link" href="ch03.html" title="Chapter 3. Building a Blog Application">Chapter 3</a>, <span class="emphasis"><em>Building a Blog Application</em></span>.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">oil</code> package allows you to speed up your application's implementation by generating code files, launching tests and tasks, or providing a CLI PHP console. We will use this package in all chapters and we will explore its features in<span class="emphasis"><em> The oil utility and the oil console </em></span>section.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">orm</code>: This package is an improvement of the FuelPHP's core models; it allows them to fetch complex queries and to define the relations between them. We will use this package in <a class="link" href="ch02.html" title="Chapter 2. Building a To-do List Application">Chapter 2</a>, <span class="emphasis"><em>Building a To-do List Application</em></span>.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">parser</code>: This package allows your application to render view files in common template systems such as Twig or Smarty. We will use this package in <a class="link" href="ch05.html" title="Chapter 5. Building Your Own Restful API">Chapter 5</a>, <span class="emphasis"><em>Building Your Own RESTful API</em></span>.</li></ul></div><p>We will also create <a id="id63" class="indexterm"/>our own <a id="id64" class="indexterm"/>package in <a class="link" href="ch04.html" title="Chapter 4. Creating and Using Packages">Chapter 4</a>, <span class="emphasis"><em>Creating and Using Packages</em></span>.</p></div><div class="section" title="Class name, paths, and coding standard"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Class name, paths, and coding standard</h3></div></div></div><p>In FuelPHP, there are five constants that <a id="id65" class="indexterm"/>define the location of the <a id="id66" class="indexterm"/>most important directories as <a id="id67" class="indexterm"/>follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>APPPATH</strong></span>: The application directory (<code class="literal">fuel/app</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>COREPATH</strong></span>: The core directory (<code class="literal">fuel/core</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>PKGPATH</strong></span>: The packages directory (<code class="literal">fuel/packages</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>DOCROOT</strong></span>: The public directory (<code class="literal">public</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>VENDORPATH</strong></span>: The vendor directory (<code class="literal">fuel/vendor</code>)</li></ul></div><p>You are recommended to read the official documentation about these constants<a id="id68" class="indexterm"/> at <a class="ulink" href="http://fuelphp.com/docs/general/constants.html">http://fuelphp.com/docs/general/constants.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> |<span class="strong"><strong> TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>General</strong></span> | <span class="strong"><strong>Constants</strong></span>)</p><p>Please keep in mind, that we will often use these constants in the book to shorten file paths.</p><p>An interesting point is that FuelPHP allows you to change quite easily the folder structure: for instance, you can change in the <code class="literal">public/index.php</code> file the value of the constants that we just introduced, or you can change the directory where FuelPHP will load modules by changing the <code class="literal">module_paths</code> key in the <code class="literal">APPPATH/config/config.php</code> configuration file.</p><p>You might also have noticed that class names are related to their own path, as given in the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In the app directory, the <code class="literal">classes/controller/welcome.php</code> class is named <code class="literal">Controller_Welcome</code></li><li class="listitem" style="list-style-type: disc">The <code class="literal">classes/model/welcome.php</code> class is named <code class="literal">Model_Welcome</code></li><li class="listitem" style="list-style-type: disc">You can notice that classes are named the same way in the <code class="literal">fuel/core</code> directory</li></ul></div><p>This result was not achieved by accident; FuelPHP follows by default the PSR-0 standard. You are recommended to read the official documentation<a id="id69" class="indexterm"/> about this standard at <a class="ulink" href="http://www.php-fig.org/psr/psr-0/">http://www.php-fig.org/psr/psr-0/</a>.</p></div></div><div class="section" title="MVC, HMVC, and how it works on FuelPHP"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>MVC, HMVC, and how it works on FuelPHP</h2></div></div></div><p>We will now look into one major aspect of the FuelPHP framework – the MVC and HMVC software architecture patterns.</p><div class="section" title="What is MVC?"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec08"/>What is MVC?</h3></div></div></div><p>
<span class="strong"><strong>Model-view-controller</strong></span> (<span class="strong"><strong>MVC</strong></span>)<a id="id70" class="indexterm"/> is a software architecture pattern that states that the code should be separated in three categories: models, views, and controllers.</p><p>For those who are not familiar with it, let's illustrate this through an example:</p><div class="mediaobject"><img src="graphics/5401OS_01_03.jpg" alt="What is MVC?"/></div><p>Suppose a user tries to access your website. The following are some URLs he/she might request:</p><p>
<code class="literal">http://my.app/</code>
</p><p>
<code class="literal">http://my.app/welcome/</code>
</p><p>
<code class="literal">http://my.app/welcome/hello</code>
</p><p>Depending on the requested <a id="id71" class="indexterm"/>URL, your website is generally expected to return some HTML code and it also sometimes needs to update the database, for instance when you want to save the users' comments.</p><p>The returned HTML code is generated by the views, because this is what is received by the browser and indirectly seen by the user.</p><p>The database is generally updated through models. In concrete terms, instead of executing raw SQL code to access and update the database, the best practice is to use classes and instances to do so. Each class represents a model that is related to a specific table: for example, the <code class="literal">car</code> model would access the <code class="literal">cars</code> table. Each class' instance is a model instance linked to a specific row in a table: for example, your car's information can be saved as a <code class="literal">car</code> instance that will be linked to a specific row in the <code class="literal">cars</code> table. As we use classes instead of raw SQL code, the framework has already implemented frequently needed features such as reading, creating, saving, or deleting model's instances. A further advantage is that, as we used packaged and well-implemented methods to access our database, it can prevent most unintended security breaches that we can create when requesting the database using raw SQL.</p><p>The controllers allow the website to handle the user's request by selecting the correct view to send back (the response) and updating the database (through models) if necessary. Controllers handle a specific section of the website: for instance, the <code class="literal">car</code> controller will handle everything that is related to cars. Controllers are subdivided by actions that will handle specific features: for instance, the <code class="literal">list</code> action of the <code class="literal">car</code> controller will return a list of cars in HTML code. In practice, controllers are classes and actions are methods.</p><p>When the user requests a URL, the framework will select an action inside a controller to handle it. Those are generally chosen by convention; for instance, when requesting <code class="literal">http://my.app/welcome/hello</code>, the framework will choose the <code class="literal">hello</code> action inside the <code class="literal">welcome</code> controller. Sometimes, they can also be chosen using a routes configuration file that matches URLs to actions and controllers.</p><p>The views sometimes need to access models; for example, we need to access the <code class="literal">car</code> model's instances when we want to display a list of cars. However, views should never update models or the database; only the controllers and preferably models should do that.</p><p>Please note that additional code components as helpers or presenters can be added to ease the development process, but if you understood this section, you got the most important points.</p></div><div class="section" title="How it works on FuelPHP"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec09"/>How it works on FuelPHP</h3></div></div></div><p>Let's illustrate how<a id="id72" class="indexterm"/> it works by testing our newly created website. We suppose that your application is available at the following URL:</p><p>
<code class="literal">http://my.app/</code>
</p><div class="section" title="Actions and controllers"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec01"/>Actions and controllers</h4></div></div></div><p>If you request <a id="id73" class="indexterm"/>a random URL, you will probably get a 404 <a id="id74" class="indexterm"/>exception. For instance: </p><p>
<code class="literal">http://my.app/should_display_404</code>
</p><p>But, if you request the following URL, you will display the same page as the home page:</p><p>
<code class="literal">http://my.app/welcome/index</code>
</p><p>If you request the following URL, you will display a different page:</p><p>
<code class="literal">http://my.app/welcome/hello</code>
</p><p>Let's first explain how the last two requests worked. You can notice that both URLs contain the <span class="emphasis"><em>welcome</em></span> word just after the base URL. You can also find this word in the file name <code class="literal">fuel/app/classes/controller/welcome.php</code>; it turns out that <span class="emphasis"><em>welcome</em></span> is a controller. Now, open this file using your preferred text editor. You will then read the following:</p><div class="informalexample"><pre class="programlisting">//...
class Controller_Welcome extends Controller
{
    //...
    public function action_index()
    {
        //...
    }
    
    //...
    public function action_hello()
    {
        //...
    }
    //...
}</pre></div><p>You can notice the <code class="literal">action_index</code> and <code class="literal">action_hello</code> methods. These functions are called actions. Now, as you have probably guessed, when you request <code class="literal">http://my.app/welcome/index</code>, the <code class="literal">action_index</code> method will be called. In a more general manner, if you request <code class="literal">http://my.app/CONTROLLER/ACTION</code>, the <code class="literal">action_ACTION</code> method of the <code class="literal">CONTROLLER</code> controller will be called. Let's test that. Edit the <code class="literal">action_index</code> function to add a simple echo at the beginning:</p><div class="informalexample"><pre class="programlisting">public function action_index()
{
  echo 'Test 1 - Please never print anything inside an action';
  //...
}</pre></div><p>Now, if you request <code class="literal">http://my.app/welcome/index</code>, you will read the printed content at the beginning of the <a id="id75" class="indexterm"/>web page. Though this is an easy<a id="id76" class="indexterm"/> way to test how things work, never print <a id="id77" class="indexterm"/>anything in your action or controller. When you print a message, you are already implementing the view entity; thus, printing something in the controller breaks the MVC pattern.</p></div><div class="section" title="Views"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec02"/>Views</h4></div></div></div><p>But then how are the <a id="id78" class="indexterm"/>pages rendered? Let's analyze the only line of code in our <code class="literal">index</code> action:</p><div class="informalexample"><pre class="programlisting">public function action_index()
{
  return Response::forge(View::forge('welcome/index'));
}</pre></div><p>
<code class="literal">View::forge('welcome/index')</code> returns a <code class="literal">View</code> object generated from the <code class="literal">fuel/app/views/welcome/index.php</code> view file. We will use this function a lot in this chapter and this book, and will cover all its parameters, but you can read its official documentation in the FuelPHP website:</p><p>
<a class="ulink" href="http://fuelphp.com/docs/classes/view.html#/method_forge">http://fuelphp.com/docs/classes/view.html#/method_forge</a>. (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>View</strong></span>)</p><p>
<code class="literal">Response::forge(View::forge('welcome/index'));</code> returns a response object created from the <code class="literal">View</code> object. Additional parameters allow us to change headers or the page status. A response object contains all the necessary information that will be sent to the browser: the headers and the body (generally the HTML code). You are recommended to read the official documentation on the FuelPHP website at <a class="ulink" href="http://fuelphp.com/docs/classes/response.html#method_forge">http://fuelphp.com/docs/classes/response.html#method_forge</a> (It can be accessed through the FuelPHP website navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>Response</strong></span>)</p><p>Since the view is generated from the <code class="literal">fuel/app/views/welcome/index.php</code> file, open it to discover its content. You can notice that this is the same HTML code as the one displayed when requesting the URL. Just after <code class="literal">&lt;h1&gt;Welcome!&lt;/h1&gt;</code>, add <code class="literal">&lt;p&gt;This is my first view change.&lt;/p&gt;</code>. Now, if you refresh your browser, you will see this message appear under the <span class="strong"><strong>Welcome!</strong></span> title.</p></div><div class="section" title="Parameters"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec03"/>Parameters</h4></div></div></div><p>It is possible to indicate <a id="id79" class="indexterm"/>parameters, both to the actions and to the views. For instance, replace your <code class="literal">index</code> action by the following code:</p><div class="informalexample"><pre class="programlisting">public function action_index($name = 'user', $id = 0)
{
    return Response::forge(
        View::forge(
            'welcome/index',
            array(
                'name' =&gt; $name,
                'id' =&gt; $id,
            )
        )
    );
}</pre></div><p>And in the <code class="literal">fuel/app/views/welcome/index.php</code> view file, replace</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;Welcome!&lt;/h1&gt;</pre></div><p>by</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;Welcome &lt;?php echo ($name.' (id: '.$id.')'); ?&gt;!&lt;/h1&gt;</pre></div><p>Now, if you request the following URL:</p><p>
<code class="literal">http://my.app/welcome/index</code>
</p><p>the title will display <span class="strong"><strong>Welcome user (id: 0)!</strong></span>
</p><p>If you request the following URL:</p><p>
<code class="literal">http://my.app/welcome/index/Jane</code>
</p><p>the title will display <span class="strong"><strong>Welcome Jane (id: 0)!</strong></span>
</p><p>And if you request the following URL:</p><p>
<code class="literal">http://my.app/welcome/index/Jane/34</code>
</p><p>the title will display <span class="strong"><strong>Welcome Jane (id: 34)!</strong></span>
</p><p>You might have understood that if you request the following URL:</p><p>
<code class="literal">http://my.app/CONTROLLER/ACTION/PARAM_1/PARAM_2/PARAM3</code>
</p><p>The <code class="literal">action_ACTION</code> <a id="id80" class="indexterm"/>method of <code class="literal">CONTROLLER</code> will be called with the <code class="literal">PARAM_1</code>, <code class="literal">PARAM_2</code>, and <code class="literal">PARAM_3</code> parameters. If there are less parameters defined in the URL than required in the method, either, if defined, the parameters take their default values (as illustrated previously), or, if no default value is defined, it will trigger a 404 error.</p><p>You can notice that we replaced</p><div class="informalexample"><pre class="programlisting">View::forge('welcome/index')</pre></div><p>By</p><div class="informalexample"><pre class="programlisting">View::forge('welcome/index', array(
        'name' =&gt; $name,
        'id' =&gt; $id,
    )
)</pre></div><p>View parameters are sent by the second parameter of <code class="literal">\View::forge</code> in an associative array. Here, the associative array has two keys, <code class="literal">name</code> and <code class="literal">id</code>, and their values are available inside the view file through the <code class="literal">$name</code> and <code class="literal">$id</code> variables.</p><p>In a more general manner, if you call the following:</p><div class="informalexample"><pre class="programlisting">View::forge('YOUR_VIEW', array(
        'param_1' =&gt; 1,
        'param_2' =&gt; 2,
    )
)</pre></div><p>When the view file will be executed, parameters will be available through the <code class="literal">$param_1</code> and <code class="literal">$param_2</code> variables.</p></div><div class="section" title="Routes"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec04"/>Routes</h4></div></div></div><p>Though what we <a id="id81" class="indexterm"/>previously observed explains how the standard cases operate</p><p>
<code class="literal">http://my.app/CONTROLLER/ACTION</code>
</p><p>we haven't explained why the two following URLs return content though no associated controller and action can be found:</p><p>
<code class="literal">http://my.app/</code>
</p><p>
<code class="literal">http://my.app/should_display_404</code>
</p><p>For understanding why we have to open the <code class="literal">fuel/app/config/routes.php</code> configuration file:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
  '_root_'  =&gt; 'welcome/index',  // The default route
  '_404_'   =&gt; 'welcome/404',    // The main 404 route
  
  'hello(/:name)?' =&gt; array('welcome/hello', 'name' =&gt; 'hello'),
);</pre></div><p>You can first notice the following two special keys:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">_root_</code>: This defines which controller and action should be called when requesting the website root URL. Note that the value is <code class="literal">welcome/index</code>, you can now understand why <code class="literal">http://my.app</code> and <code class="literal">http://my.app/welcome/index</code> are returning the same content.</li><li class="listitem" style="list-style-type: disc"><code class="literal">_404_</code>: This defines which controller and action should be called when throwing a 404 error.</li></ul></div><p>Beside specials keys, you can define the custom URLs you want to handle. Let's add a simple example at the end of the array:</p><div class="informalexample"><pre class="programlisting">'my/welcome/page'  =&gt; 'welcome/index',</pre></div><p>Now, if you request the following URL:</p><p>
<code class="literal">http://my.app/my/welcome/page</code>
</p><p>it will display the same content as in the following URL:</p><p>
<code class="literal">http://my.app/welcome/index</code>
</p><p>You have probably noticed that there is also another key already defined: <code class="literal">hello(/:name)?</code>. The routing system is quite advanced, and to fully understand it you are recommended to take a look at the official documentation:</p><p>
<a class="ulink" href="http://fuelphp.com/docs/general/routing.html">http://fuelphp.com/docs/general/routing.html</a> (It can be accessed through the FuelPHP website by <a id="id82" class="indexterm"/>navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Routing</strong></span>)</p></div><div class="section" title="Presenters"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec05"/>Presenters</h4></div></div></div><p>You might have seen <a id="id83" class="indexterm"/>that the <code class="literal">hello</code> action doesn't use the <code class="literal">View</code> class to display its content, but instead it uses the <code class="literal">Presenter</code> class:</p><div class="informalexample"><pre class="programlisting">public function action_hello()
{
   return Response::forge(Presenter::forge('welcome/hello'));
}</pre></div><p>Let's analyze what is happening in this case. First, you can notice that, as for the views, a view file exists at the following path: <code class="literal">fuel/app/views/welcome/hello.php</code>. If you open this file, you will see that the code is the same as the one displayed when requesting the URL <code class="literal">http://my.app/welcome/hello</code>, except for one tiny difference. You can find the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;Hello, &lt;?php echo $name; ?&gt;!</pre></div><p>In a normal view, we would have to define the <code class="literal">name</code> parameter, except here we didn't. Though, when displaying the web page, this parameter seems to have a defined value (it displays <span class="strong"><strong>Hello, World!</strong></span>). Where could it be defined then?</p><p>Probing a little further, you can find another file located at <code class="literal">fuel/app/classes/presenter/welcome/hello.php</code>. It contains the following:</p><div class="informalexample"><pre class="programlisting">class Presenter_Welcome_Hello extends Presenter
{
    //...
    public function view()
    {
        $this-&gt;name = $this-&gt;request()-&gt;param('name', 'World');
    }
}</pre></div><p>This file contains a <code class="literal">Presenter</code> class. The <code class="literal">view</code> function is called before rendering the view and it is here that the <code class="literal">name</code> parameter is set. It tries to get the name from the request parameter, <code class="literal">name</code>, but if it is not defined, the default value is <code class="literal">World</code>.</p><p>If you wonder how to change this parameter, refer to the routes. For instance, request the URL<code class="literal"> http://my.app/hello/Jane</code>.</p><p>One could then wonder the use of <code class="literal">Presenter</code> classes, since we could change the previous code into a more classic view and controller approach.</p><p>Let's show its <a id="id84" class="indexterm"/>usefulness by an illustration. Suppose you have created an internal website managing the clients of your corporation. Each client is associated to a client category. In your creation, edition, and other forms, you thus display a selectable list of client categories. Each time you display the exact same selectable list, though you access it by using different controllers and actions. You can come up with three solutions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can create a classic view for your selectable list, load the list of client categories inside each of your actions, and pass this list to each view until you reach the location where you want to display your list. The problem is that it would induce a lot of code repetition.</li><li class="listitem" style="list-style-type: disc">You can create a classic view and load the list of clients inside this view. This way, you wouldn't have to pass along the necessary parameter. The problem is that you would break the MVC pattern by mixing models and views.</li><li class="listitem" style="list-style-type: disc">You can create a <code class="literal">Presenter</code> class, load the list inside the <code class="literal">Presenter</code> class, use it inside the view file, and display the view file using <code class="literal">Presenter::forge</code>. This solution is the best because it doesn't mix views and models but still limits the code duplication.</li></ul></div></div></div><div class="section" title="What is HMVC?"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>What is HMVC?</h3></div></div></div><p>FuelPHP is a <span class="strong"><strong>Hierarchical Model-View-Controller</strong></span> (<span class="strong"><strong>HMVC</strong></span>)<a id="id85" class="indexterm"/> framework, meaning that it allows you to request internal controllers from your application. In concrete terms, the following code:</p><div class="informalexample"><pre class="programlisting">echo Request::forge('welcome/index')-&gt;execute();</pre></div><p>will print exactly what the following URL would return:</p><p>
<code class="literal">http://my.app/welcome/index</code>
</p><p>Though we suggest you to use this feature in moderation, it can come handy when you want to implement and display widgets on several web pages.</p><p>You are recommended to read the following <a id="id86" class="indexterm"/>resources if you want to learn more about this pattern:</p><p><a class="ulink" href="http://en.wikipedia.org/wiki/Hierarchical_model-view-controller">http://en.wikipedia.org/wiki/Hierarchical_model-view-controller</a>
</p><p><a class="ulink" href="http://stackoverflow.com/questions/2263416/what-is-the-hmvc-pattern">http://stackoverflow.com/questions/2263416/what-is-the-hmvc-pattern</a>
</p></div></div><div class="section" title="The oil utility and the oil console"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>The oil utility and the oil console</h2></div></div></div><p>The <code class="literal">oil</code> utility <a id="id87" class="indexterm"/>is a very handy command-line tool. As the <code class="literal">rails</code> utility of Ruby on Rails, oil allows you to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Easily generate code files: models, controllers, migrations, and entire scaffoldings</li><li class="listitem" style="list-style-type: disc">Run tasks and migrations</li><li class="listitem" style="list-style-type: disc">Easily install, update, or remove packages</li><li class="listitem" style="list-style-type: disc">Test your code using PHPUnit test or a real-time console</li><li class="listitem" style="list-style-type: disc">Even run a PHP-built-in web server hosting your FuelPHP application (for PHP &gt;= 5.4)</li></ul></div><p>Though we will use all <a id="id88" class="indexterm"/>these features, except the last one in this book, we recommend that you take a look at the official documentation at:</p><p>
<a class="ulink" href="http://fuelphp.com/docs/packages/oil/intro.html">http://fuelphp.com/docs/packages/oil/intro.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Oil</strong></span> | <span class="strong"><strong>Introduction</strong></span>)</p><p>In this section, we are going to use the oil console, which is an important tool if you want to test your website, or, as in this case, a FuelPHP feature.</p><p>First, open your command-line utility and go to the root of your website directory. Then, enter the following line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php oil console</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>If you use a web development platform such as WAMP or MAMP, you are recommended to use the PHP executable inside the platform directory for launching the oil utility (it might not work otherwise). As I wrote this book, this executable is located at <code class="literal">WAMP_DIRECTORY\bin\php\phpVERSION\php.exe</code> for WAMP, and at <code class="literal">MAMP_DIRECTORY/bin/php/phpVERSION/bin/php</code> for MAMP (VERSION depends on the version of PHP you installed, the best is to check this directory by yourself using a file explorer).</p></div></div><p>This will open the<a id="id89" class="indexterm"/> command-line interface oil provides. When you press <span class="emphasis"><em>Enter</em></span>, something similar to the following should appear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Fuel 1.7.2 - PHP 5.4.24 (cli) (Jan 19 2014 21:18:21) [Darwin]</strong></span>
<span class="strong"><strong>&gt;&gt;&gt;</strong></span>
</pre></div><p>You can now type any PHP code and it will be executed. Let's start with something simple:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; $a = 2</pre></div><p>If you press <span class="emphasis"><em>Enter</em></span>, nothing will be printed, but the <code class="literal">$a</code> variable will be set to <code class="literal">2</code>. Now, if you want to check a variable value, simply enter its name and then press <span class="emphasis"><em>Enter</em></span>:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; $a
2</pre></div><p>It also works for more complex variables:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; $a = array('a' =&gt; 'b', 'c' =&gt; 'd')
&gt;&gt;&gt; $a
array (
  'a' =&gt; 'b',
  'c' =&gt; 'd',
)</pre></div><p>But be aware, that you might have trouble displaying complex objects.</p><p>Let's now test a FuelPHP feature. Earlier, when discussing the <code class="literal">app</code> directory structure, we explained that the configuration files in the <code class="literal">fuel/app/config</code> directory were merged with the ones with the same filenames in the <code class="literal">fuel/app/config/ENV</code> directory, <code class="literal">ENV</code> being FuelPHP's current environment. We will now test this behavior.</p><p>First, let's check FuelPHP's current environment:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; Fuel::$env
development</pre></div><p>The environment should be set to <code class="literal">development</code>.</p><p>Now, create a PHP file located at <code class="literal">fuel/app/config/test.php</code> where you will write:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
    'this_is_the_root_config_file' =&gt; true,
);</pre></div><p>Then create another PHP file located at <code class="literal">fuel/app/config/development/test.php</code> and write the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
    'this_is_the_dev_config_file' =&gt; true,
);</pre></div><p>and an additional one located at <code class="literal">fuel/app/config/production/test.php,</code> where you will write the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
    'this_is_the_prod_config_file' =&gt; true,
);</pre></div><p>Now, if you return to the command-line interface, you can load the <code class="literal">test</code> configuration file by writing the following:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; $conf = Config::load('test', true)</pre></div><p>You are recommended to read the <code class="literal">Config::load</code> official <a id="id90" class="indexterm"/>documentation for more information at:</p><p>
<a class="ulink" href="http://fuelphp.com/docs/classes/config.html#/method_load">http://fuelphp.com/docs/classes/config.html#/method_load</a>. (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>Config</strong></span>)</p><p>As explained before, the value returned will be a mix of the <code class="literal">fuel/app/config/test.php</code> and the <code class="literal">fuel/app/config/development/test.php</code> configuration files:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; $conf
array (
  'this_is_the_root_config_file' =&gt; true,
  'this_is_the_dev_config_file' =&gt; true,
)</pre></div><p>If we change the FuelPHP environment to <code class="literal">production</code>:</p><div class="informalexample"><pre class="programlisting">Fuel::$env = 'production'; // only do that for testing purposes</pre></div><p>And load again the <code class="literal">test</code> configuration file:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; Config::load('test', true, true)
array (
  'this_is_the_root_config_file' =&gt; true,
  'this_is_the_prod_config_file' =&gt; true,
)</pre></div><p>The merging will be done with the configuration file in the <code class="literal">production</code> folder.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>You have probably noticed that we added a third parameter for <code class="literal">Config::load</code>. This parameter allows you to clear the configuration cache. If we didn't set it to <code class="literal">true</code>, the method would have returned the old configuration we loaded when we were in the <code class="literal">development</code> environment.</p></div></div><p>But what happens when the <code class="literal">fuel/app/config/production/test.php</code> and <code class="literal">fuel/app/config/test.php</code> configuration files contain the same key? The console can find the answer for us.</p><p>Change the content of the <code class="literal">fuel/app/config/test.php</code> configuration file to the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
    'complex_value' =&gt; array(
        'root' =&gt; true,
    ),
    'this_is_the_root_config_file' =&gt; true,
);</pre></div><p>and change the content of the <code class="literal">fuel/app/config/production/test.php</code> configuration file to the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
    'complex_value' =&gt; array(
        'prod' =&gt; true,
    ),
    'this_is_the_root_config_file' =&gt; false, 
    'this_is_the_prod_config_file' =&gt; true,
);</pre></div><p>Let's now reload the <code class="literal">test</code> configuration files as follows:</p><div class="informalexample"><pre class="programlisting">&gt;&gt;&gt; Config::load('test', true, true)
array (
  'complex_value' =&gt; 
  array (
    'root' =&gt; true,
    'prod' =&gt; true,
  ),
  'this_is_the_root_config_file' =&gt; false,
  'this_is_the_prod_config_file' =&gt; true,
)</pre></div><p>It is interesting to analyze how the preceding two configuration files have been merged:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">this_is_the_root_config_file</code> key shared by the two configuration files is associated in both cases to a simple value. In the resulting configuration, it is the value from the production file that prevails.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">complex_value</code> key is associated in both cases to an array. The two arrays seem to have been merged in the resulting configuration.</li></ul></div><p>This is because the configuration files are not merged by the <code class="literal">array_merge</code> native PHP function, but instead by the <code class="literal">Arr::merge</code> FuelPHP function, which merges arrays recursively. You are recommended to take a look at its official documentation at <a class="ulink" href="http://fuelphp.com/docs/classes/arr.html#/method_merge">http://fuelphp.com/docs/classes/arr.html#/method_merge</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>Arr</strong></span>)</p><p>It should be clear now that the console is a great tool that allows you to test your application. It can also be used as a great complement to the documentation, as you can try FuelPHP methods and their parameters without changing any files in your application.</p></div></div>
<div class="section" title="Building your first application"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Building your first application</h1></div></div></div><p>Now that we had a quick overview of the <a id="id91" class="indexterm"/>FuelPHP framework, let's build our first tiny application.</p><p>Suppose that you are a zoo manager and you want to keep track of the monkeys you are looking after. For each monkey, you want to save the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Its name</li><li class="listitem" style="list-style-type: disc">If it is still in the zoo</li><li class="listitem" style="list-style-type: disc">Its height</li><li class="listitem" style="list-style-type: disc">A description input where you can enter custom information</li></ul></div><p>You want a very simple interface with the following five major features:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You want to create a new monkey</li><li class="listitem" style="list-style-type: disc">You want to edit existing ones</li><li class="listitem" style="list-style-type: disc">You want to list all monkeys</li><li class="listitem" style="list-style-type: disc">You want to view a detailed file for each monkey</li><li class="listitem" style="list-style-type: disc">You want to delete monkeys from the system</li></ul></div><p>The preceding five major features, very common in computer applications, are part of the <span class="strong"><strong>Create, Read, Update and Delete </strong></span>(<span class="strong"><strong>CRUD</strong></span>)<a id="id92" class="indexterm"/> basic operations. This is a perfect example to use the oil utility to generate a scaffold. Oil will quickly generate for us the controllers, models, views, and migrations to handle our monkeys. All we will have to do, then, is to refine the generated code and adapt it to our needs.</p><div class="section" title="Database configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Database configuration</h2></div></div></div><p>As we will store our <a id="id93" class="indexterm"/>monkeys into a MySQL database, it is time to configure FuelPHP to use our local database. If you open <code class="literal">fuel/app/config/db.php</code>, all you will see is an empty array, but, as we demonstrated it in the <span class="emphasis"><em>FuelPHP basics</em></span> section, this configuration file is merged to <code class="literal">fuel/app/config/ENV/db.php</code>, <code class="literal">ENV</code> being the current FuelPHP's environment, which in that case is <code class="literal">development</code>.</p><p>You should, therefore, open <code class="literal">fuel/app/config/development/db.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
//...
return array(
  'default' =&gt; array(
    'connection'  =&gt; array(
      'dsn'        =&gt; 'mysql:host=localhost;dbname=fuel_dev',
      'username'   =&gt; 'root',
      'password'   =&gt; 'root',
    ),
  ),
);</pre></div><p>This is the generated default configuration, which you should adapt to your local configuration, particularly the database name (currently set to <code class="literal">fuel_dev</code>), the username, and password. You must create the database of your project manually.</p></div><div class="section" title="Scaffolding"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Scaffolding</h2></div></div></div><p>Now that the<a id="id94" class="indexterm"/> database configuration is set, we will be able to generate a scaffold. We will use the <code class="literal">generate</code> feature of the oil utility.</p><p>Open the command-line utility and go to your website root directory. To generate a scaffold for a new model, you will need to enter the following line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php oil generate scaffold/crud MODEL ATTR_1:TYPE_1 ATTR_2:TYPE_2 ...</strong></span>
</pre></div><p>where:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MODEL</code> is the model name</li><li class="listitem" style="list-style-type: disc"><code class="literal">ATTR_1</code>, <code class="literal">ATTR_2</code>… are the model's attribute names</li><li class="listitem" style="list-style-type: disc"><code class="literal">TYPE_1</code>, <code class="literal">TYPE_2</code>… are attribute types</li></ul></div><p>In our case, it should be as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php oil generate scaffold/crud monkey name:string still_here:bool height:float description:text</strong></span>
</pre></div><p>Here we are telling oil to generate a scaffold for the <code class="literal">monkey</code> model with the following attributes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: The name of the monkey. Its type is string and the associated MySQL column type will be VARCHAR(255).</li><li class="listitem" style="list-style-type: disc"><code class="literal">still_here</code>: Whether or not the monkey is still in the facility. Its type is boolean and the associated MySQL column type will be TINYINT(1).</li><li class="listitem" style="list-style-type: disc"><code class="literal">height</code>: Height of the monkey. Its type is float and the associated MySQL column type will be FLOAT.</li><li class="listitem" style="list-style-type: disc"><code class="literal">description</code>: Description of the monkey. Its type is text and the associated MySQL column type will be TEXT.</li></ul></div><p>You can do much more using the oil generate feature, such as generating models, controllers, migrations, tasks, packages, and so on. We will see some of these later in the book, but you are recommended to take a look at the official documentation at <a class="ulink" href="http://fuelphp.com/docs/packages/oil/generate.html">http://fuelphp.com/docs/packages/oil/generate.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Oil</strong></span> | <span class="strong"><strong>Generate</strong></span>)</p><p>When you press <span class="emphasis"><em>Enter</em></span>, you will see the following lines appear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Creating migration: APPPATH/migrations/001_create_monkeys.php</strong></span>
<span class="strong"><strong>Creating model: APPPATH/classes/model/monkey.php</strong></span>
<span class="strong"><strong>Creating controller: APPPATH/classes/controller/monkey.php</strong></span>
<span class="strong"><strong>Creating view: APPPATH/views/monkey/index.php</strong></span>
<span class="strong"><strong>Creating view: APPPATH/views/monkey/view.php</strong></span>
<span class="strong"><strong>Creating view: APPPATH/views/monkey/create.php</strong></span>
<span class="strong"><strong>Creating view: APPPATH/views/monkey/edit.php</strong></span>
<span class="strong"><strong>Creating view: APPPATH/views/monkey/_form.php</strong></span>
<span class="strong"><strong>Creating view: APPPATH/views/template.php</strong></span>
</pre></div><p>Oil has generated for us nine files, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A migration file, containing all the necessary information to create the model's associated table</li><li class="listitem" style="list-style-type: disc">The model</li><li class="listitem" style="list-style-type: disc">A controller</li><li class="listitem" style="list-style-type: disc">Five view files and a template file</li></ul></div><p>We will take a <a id="id95" class="indexterm"/>closer look at these files in the next sections.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>You might have noticed that we used the <code class="literal">scaffold/crud</code> command, and, if you read the official documentation, we could have typed only <code class="literal">scaffold</code>. This is because two types of scaffold can be generated: <code class="literal">scaffold/crud</code>, which uses simple models, and <code class="literal">scaffold/orm</code> alias <code class="literal">scaffold,</code> which uses the <code class="literal">orm</code> models. Since using FuelPHP's native ORM was out of the scope of this chapter, and we didn't have to use complex model features such as relations, we chose to use <code class="literal">scaffold/crud</code>.</p></div></div></div><div class="section" title="Migrating"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Migrating</h2></div></div></div><p>One of the generated files <a id="id96" class="indexterm"/>was <code class="literal">APPPATH/migrations/001_create_monkeys.php</code>. It is a migration file and contains the required information to create our monkey table. Notice that the name is structured as <code class="literal">VER_NAME,</code> where <code class="literal">VER</code> is the version number and <code class="literal">NAME</code> is the name of the migration.</p><p>If you execute the following command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php oil refine migrate</strong></span>
</pre></div><p>All migration files that have not yet been executed will be executed from the oldest version to the latest version (001, 002, 003, and so on). Once all migration files are executed, oil will display the latest version number.</p><p>Once executed, if you take a look at your database, you will observe that not one but two tables have been created:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">monkeys</code>: As expected, a table <a id="id97" class="indexterm"/>has been created to handle your monkeys. Notice that the table name is the plural version of the word we typed for generating the scaffold; such a transformation was internally done using the <code class="literal">Inflector::pluralize</code> method. The table will contain the specified columns (<code class="literal">name</code>, <code class="literal">still_here</code>), the <code class="literal">id</code> column, and also <code class="literal">created_at</code> and <code class="literal">updated_at</code>. These columns store the time an object was created and updated, and are added by default each time you generate your models. It is possible to not generate them with the <code class="literal">--no-timestamp</code> argument.</li><li class="listitem" style="list-style-type: disc"><code class="literal">migration</code>: This table is automatically created the first time you execute migrations. It keeps track of the migrations that were executed. If you look into its content, you will see that it already contains one row; this is the migration you just executed. You can notice that the row does not only indicate the name of the migration, but also a type and a name. This is because migration files can be placed at many places such as modules or packages (see <a class="link" href="ch03.html" title="Chapter 3. Building a Blog Application">Chapter 3</a>, <span class="emphasis"><em>Building a Blog Application</em></span>).</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>It is important to note that the <code class="literal">migration</code> table is not the only location where FuelPHP keeps track of the already executed migrations. This information is also stored in <code class="literal">fuel/app/config/ENV/migrations.php</code>, <code class="literal">ENV</code> being FuelPHP's environment. If you decide to edit the <code class="literal">migration</code> table, you might want to also edit or delete this file, as it might prevent the execution of your migrations.</p></div></div><p>The <code class="literal">refine migrate</code> feature of oil allows you to have much more control on migrations than simply executing all the new ones. For instance, you can also revert to a previous version using the following command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php oil refine migrate:down</strong></span>
</pre></div><p>Or revert to a specified version using the following command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php oil refine migrate --version=3</strong></span>
</pre></div><p>Or even choose which modules or packages you want to update using the <code class="literal">--modules</code> or <code class="literal">--package</code> arguments. To have a complete overview, you are recommended to take a look at the official documentation at <a class="ulink" href="http://fuelphp.com/docs/general/migrations.html">http://fuelphp.com/docs/general/migrations.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Migrations</strong></span>)</p><p>But how do migration files<a id="id98" class="indexterm"/> allow such complex manipulations? Let's open our migration file located at <code class="literal">APPPATH/migrations/001_create_monkeys.php</code> to find out. You should see the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php

namespace Fuel\Migrations;

class Create_monkeys
{
    public function up()
    {
        \DBUtil::create_table('monkeys', array(
            'id' =&gt; array(
                'constraint' =&gt; 11,
                'type' =&gt; 'int',
                'auto_increment' =&gt; true,
                'unsigned' =&gt; true
            ),
            'name' =&gt; array(
                'constraint' =&gt; 255,
                'type' =&gt; 'varchar'
            ),
            'still_here' =&gt; array(
                'type' =&gt; 'bool'
            ),
            'height' =&gt; array(
                'type' =&gt; 'float'
            ),
            'description' =&gt; array(
                'type' =&gt; 'text'
            ),
            'created_at' =&gt; array(
                'constraint' =&gt; 11,
                'type' =&gt; 'int',
                'null' =&gt; true
            ),
            'updated_at' =&gt; array(
                'constraint' =&gt; 11,
                'type' =&gt; 'int',
                'null' =&gt; true
            ),
        ), array('id'));
    }
    
    public function down()
    {
        \DBUtil::drop_table('monkeys');
    }
}</pre></div><p>The file contains a class<a id="id99" class="indexterm"/> named <code class="literal">Create_monkeys</code> that has the following two methods:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">up</code>: This method defines how to update your data structure. Note that this migration file creates the monkey table using the <code class="literal">DBUtil::create_table</code> method, but you could perfectly execute a handmade SQL request to do that. Though migrations are generally used to update your database, you can also use them to update custom data files or old configuration files.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>In some cases, if you want to implement your own migrations, you might find the idea of using your application's methods (in models or helpers) attractive. Though it can allow you to limit your code duplication, it is not recommended. This is because, for compatibility reasons, the migration files are intended to stay in your application indefinitely, whereas your application's code can evolve a lot. Therefore, by changing or deleting a method in your application, you might unexpectedly break some migration files (that use this method) without even noticing it, making the future installation of your application complicated.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">down</code>: This method defines how to cancel all changes that were made by the <code class="literal">up</code> method. Suppose you realize that the feature was a mistake and you want to revert to an older version: this is when this method will be executed. In our case, the method simply deletes the monkey table.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>If the information contained in the table is important, it might be a good idea to instead move the table, for instance, to an archive database. A human mistake could have disastrous consequences otherwise.</p></div></div></li></ul></div><p>The migration files are a powerful tool and their usefulness increase tenfold as the number of instances and the number of developers working on the same project rise. Using them from scratch is always a good decision.</p></div><div class="section" title="Using your application"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>Using your application</h2></div></div></div><p>Now that we have generated the <a id="id100" class="indexterm"/>code and migrated the database, our application is ready to be used. You might have noticed during the generation that a controller was created at <code class="literal">APPPATH/classes/controller/monkey.php</code> and that the route configuration file was not changed, meaning that the controller must be accessible through the default URL.</p><p>Let's request, then, the URL <code class="literal">http://my.app/monkey</code>.</p><p>As you can notice, this web page is intended to display the list of all monkeys, but since none have been added, the list is empty:</p><div class="mediaobject"><img src="graphics/5401OS_01_04.jpg" alt="Using your application"/></div><p>Then, let's add a new monkey by clicking on the <span class="strong"><strong>Add new Monkey</strong></span> button. The following web page should appear:</p><div class="mediaobject"><img src="graphics/5401OS_01_05.jpg" alt="Using your application"/></div><p>You can enter your <a id="id101" class="indexterm"/>monkey's information here. There are, however, several inconsistencies:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All fields are required, meaning that you can't leave any field empty, otherwise errors will be triggered preventing you from adding the monkey. This is not what we might want for the description field.</li><li class="listitem" style="list-style-type: disc">Though you can enter anything you want in the <span class="strong"><strong>Height</strong></span> field without triggering any error, if you enter anything other than a float, it will be replaced by 0. We might want to trigger an error in such a case.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Still here</strong></span> can only have two values: 0 or 1 (false or true). Though the type of the associated database column is correct, the generated form uses a standard input where we might want a checkbox. </li></ul></div><p>The form is certainly not perfect, but it is a great start. All we will have to do is refine the code a little bit.</p><p>Once you have added several monkeys, you can again take a look at the listing page as follows:</p><div class="mediaobject"><img src="graphics/5401OS_01_06.jpg" alt="Using your application"/></div><p>Again, this is a great start, though<a id="id102" class="indexterm"/> we might want to refine it a little bit: display <span class="strong"><strong>Yes</strong></span> and <span class="strong"><strong>No</strong></span> instead of <span class="strong"><strong>1</strong></span> and <span class="strong"><strong>0</strong></span>, respectively, for the <span class="strong"><strong>Still here</strong></span> column, and remove the <span class="strong"><strong>Description</strong></span> column because there might be too much text to display.</p><p>Each item on the list has three associated actions: <span class="strong"><strong>View</strong></span>, <span class="strong"><strong>Edit</strong></span>, and <span class="strong"><strong>Delete</strong></span>.</p><p>Let's first click on <span class="strong"><strong>View</strong></span>:</p><div class="mediaobject"><img src="graphics/5401OS_01_10.jpg" alt="Using your application"/></div><p>Again this is a great start, though we will also refine this web page.</p><p>You can return back to the listing by clicking on <span class="strong"><strong>Back</strong></span> or edit the monkey by clicking on <span class="strong"><strong>Edit</strong></span>. Accessed from either the listing page or the view page, it will display the same form as when creating a new monkey, except that the form will be prefilled of course.</p><p>Finally, if you click on <span class="strong"><strong>Delete</strong></span>, a confirmation box will appear to prevent any miss clicking:</p><div class="mediaobject"><img src="graphics/5401OS_01_09.jpg" alt="Using your application"/></div></div><div class="section" title="Refining the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Refining the application</h2></div></div></div><p>Now that we took a <a id="id103" class="indexterm"/>look at our interface, let's refine our application so that it becomes more user-friendly. In this section, we will explore the files that have been generated by oil and try to adapt them to our needs.</p><div class="section" title="Refining the monkey listing"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Refining the monkey listing</h3></div></div></div><p>During the previous <a id="id104" class="indexterm"/>section, two small issues bothered us for the monkey's listing:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We wanted more explicit values than 0 and 1 for the <code class="literal">Still here</code> column</li><li class="listitem" style="list-style-type: disc">We wanted to remove the <code class="literal">Description</code> column</li></ul></div><p>We know that the list appears when requesting the following URL:</p><p>
<code class="literal">http://my.app/monkey</code>
</p><p>You have probably noticed that in this URL we indicated a controller, but no action. It is important to know that, by default and without any routing configuration involved, this URL is equivalent to <code class="literal">http://my.app/monkey/index</code></p><p>So, in fact, we are calling the <code class="literal">index</code> action of the <code class="literal">monkey</code> controller. If we open the generated controller at <code class="literal">APPPATH/classes/controller/monkey.php</code>, we will read the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class Controller_Monkey extends Controller_Template{
    //...
}</pre></div><p>First, you can notice that <code class="literal">Controller_Monkey</code> extends <code class="literal">Controller_Template</code> instead of <code class="literal">Controller,</code> as we saw before in <code class="literal">Controller_Welcome</code>. <code class="literal">Controller_Template</code> is an extension of <code class="literal">Controller</code> that adds template support. The idea is that most of the time your web pages will have the same layout: the headers, footers, and menus generally stay the same, regardless of the web pages you are in. Templates allow you to achieve this by limiting the code duplication.</p><p>By default, <code class="literal">Controller_Template</code> is associated with the <code class="literal">APPPATH/views/template.php</code> template that was generated by oil. If you open this file, you will see <a id="id105" class="indexterm"/>that it generates the HTML code around the page content. You will also probably notice that it prints the <code class="literal">$title</code> and <code class="literal">$content</code> variables. We will find out how to set their values by exploring the <code class="literal">index</code> action. If you go back to the <span class="strong"><strong>Monkey</strong></span> controller, the <code class="literal">action_index</code> method should contain the following:</p><div class="informalexample"><pre class="programlisting">public function action_index()
{
    $data['monkeys'] = Model_Monkey::find_all();
    $this-&gt;template-&gt;title = "Monkeys";
    $this-&gt;template-&gt;content = View::forge('monkey/index', $data);
}</pre></div><p>The first line stores all the monkeys' instances into the <code class="literal">$data['monkeys']</code> variable. In a general manner, <code class="literal">MODEL::find_all()</code> returns all a model's instances, but it is definitely not the only method that retrieve instances. These methods will be discussed more thoroughly in <a class="link" href="ch02.html" title="Chapter 2. Building a To-do List Application">Chapter 2</a>, <span class="emphasis"><em>Building a To-do List Application</em></span>.</p><p>The second and third lines set the <code class="literal">$title</code> and <code class="literal">$content</code> variables displayed in the template file. If you change the second line by <code class="literal">$this-&gt;template-&gt;title = "My monkeys";</code> and then refresh the web page, you will see that its title has changed accordingly.</p><p>The third line sets the <code class="literal">$content</code> variable to a view instance that, from what we have observed in the previous sections, executes the view file located at <code class="literal">APPPATH/views/monkey/index.php</code> with the <code class="literal">$monkey</code> variable set to all monkeys' instances. Let's open this view file. You should see the following:</p><div class="informalexample"><pre class="programlisting">&lt;h2&gt;Listing Monkeys&lt;/h2&gt;
&lt;br&gt;
&lt;?php if ($monkeys): ?&gt;
&lt;table class="table table-striped"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Still here&lt;/th&gt;
      &lt;th&gt;Height&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    
  &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
&lt;?php foreach ($monkeys as $item): ?&gt;    &lt;tr&gt;

      &lt;td&gt;&lt;?php echo $item-&gt;name; ?&gt;&lt;/td&gt;
      &lt;td&gt;&lt;?php echo $item-&gt;still_here; ?&gt;&lt;/td&gt;
      &lt;td&gt;&lt;?php echo $item-&gt;height; ?&gt;&lt;/td&gt;
      &lt;td&gt;&lt;?php echo $item-&gt;description; ?&gt;&lt;/td&gt;
      &lt;td&gt;
        &lt;?php /* Action buttons */ ?&gt;

      &lt;/td&gt;
    &lt;/tr&gt;
&lt;?php endforeach; ?&gt;  &lt;/tbody&gt;
&lt;/table&gt;

&lt;?php else: ?&gt;
&lt;p&gt;No Monkeys.&lt;/p&gt;

&lt;?php endif; ?&gt;&lt;p&gt;
  &lt;?php /* Add new Monkey button */ ?&gt;

&lt;/p&gt;</pre></div><p>We have found where<a id="id106" class="indexterm"/> the table is displayed, so it is time to make our changes.</p><p>First, remove the <code class="literal">Description</code> column by removing the following:</p><div class="informalexample"><pre class="programlisting">&lt;th&gt;Description&lt;/th&gt;</pre></div><p>and</p><div class="informalexample"><pre class="programlisting">&lt;td&gt;&lt;?php echo $item-&gt;description; ?&gt;&lt;/td&gt;</pre></div><p>Then, let's refine how the <code class="literal">Still here</code> attribute is displayed by replacing the following:</p><div class="informalexample"><pre class="programlisting">&lt;td&gt;&lt;?php echo $item-&gt;still_here; ?&gt;&lt;/td&gt;</pre></div><p>by</p><div class="informalexample"><pre class="programlisting">&lt;td&gt;&lt;?php echo $item-&gt;still_here ? 'Yes' : 'No'; ?&gt;&lt;/td&gt;</pre></div><p>The <span class="strong"><strong>Still here</strong></span> column <a id="id107" class="indexterm"/>should now display <span class="strong"><strong>Yes</strong></span> and <span class="strong"><strong>No</strong></span> instead of <span class="strong"><strong>1</strong></span> and <span class="strong"><strong>0</strong></span>, respectively.</p></div><div class="section" title="Refining the monkey detailed view"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Refining the monkey detailed view</h3></div></div></div><p>On the list, when<a id="id108" class="indexterm"/> clicking on an item's <span class="strong"><strong>View</strong></span> link, a detailed view of the monkey appears. We would like to change two details here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">As in the previous section, display more explicit values for the <span class="strong"><strong>Still here</strong></span> attribute</li><li class="listitem" style="list-style-type: disc">Currently, if you save a monkey with a multiline description, it is displayed on one line only</li></ul></div><p>First, if you are on a detailed view page, you can notice that the URL is similar to <code class="literal">http://my.app/monkey/view/1</code>
</p><p>This means we are calling the <code class="literal">view</code> action of the <code class="literal">monkey</code> controller with the first and only parameter set to <code class="literal">1</code>. The <code class="literal">view</code> action is quite similar to the <code class="literal">index</code> action, as you can see in the following snippet:</p><div class="informalexample"><pre class="programlisting">public function action_view($id = null)
{
    is_null($id) and Response::redirect('monkey');

    $data['monkey'] = Model_Monkey::find_by_pk($id);

    $this-&gt;template-&gt;title = "Monkey";
    $this-&gt;template-&gt;content = View::forge('monkey/view', $data);
}</pre></div><p>The first line simply checks if the parameter of the action (associated to the <code class="literal">$id</code> variable) is actually set, and otherwise redirects the user (using the <code class="literal">Response::redirect</code> method) to the listing page.</p><p>The second line stores the monkey with ID <code class="literal">$id</code> into the <code class="literal">$data['monkey']</code> variable. The <code class="literal">find_by_pk</code> (<code class="literal">pk</code> for primary key) method of a model finds one of its instances by its primary key. As we explained earlier, models' methods will be discussed more thoroughly in <a class="link" href="ch02.html" title="Chapter 2. Building a To-do List Application">Chapter 2</a>, <span class="emphasis"><em>Building a To-do List Application</em></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Just to be perfectly clear, requesting the URL <code class="literal">http://my.app/monkey/view/ID</code> will load the monkey instance with <code class="literal">id = ID</code>.</p></div></div><p>The third and fourth<a id="id109" class="indexterm"/> lines, as in the previous section, set the template variables. The template content is set to the view located at <code class="literal">APPPATH/views/monkey/view.php</code>.</p><div class="informalexample"><pre class="programlisting">&lt;h2&gt;Viewing #&lt;?php echo $monkey-&gt;id; ?&gt;&lt;/h2&gt;

&lt;p&gt;
  &lt;strong&gt;Name:&lt;/strong&gt;
  &lt;?php echo $monkey-&gt;name; ?&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;strong&gt;Still here:&lt;/strong&gt;
  &lt;?php echo $monkey-&gt;still_here; ?&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;strong&gt;Height:&lt;/strong&gt;
  &lt;?php echo $monkey-&gt;height; ?&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;strong&gt;Description:&lt;/strong&gt;
  &lt;?php echo $monkey-&gt;description; ?&gt;&lt;/p&gt;

&lt;?php /* Edit button */ ?&gt; |
&lt;?php /* Back button */ ?&gt;</pre></div><p>It is time to do some changes.</p><p>Replace:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo $monkey-&gt;still_here; ?&gt;</pre></div><p>By:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo $monkey-&gt;still_here ? 'Yes' : 'No'; ?&gt;</pre></div><p>And replace:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo $monkey-&gt;description; ?&gt;</pre></div><p>By:</p><div class="informalexample"><pre class="programlisting">&lt;div&gt;&lt;?php echo nl2br($monkey-&gt;description); ?&gt;&lt;/div&gt;</pre></div></div><div class="section" title="Allowing an empty description"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Allowing an empty description</h3></div></div></div><p>One of the issues we <a id="id110" class="indexterm"/>pointed out previously, is that the description field is required, though we want to be able to enter an empty value.</p><p>First, open your browser and request the following URL:</p><p>
<code class="literal">http://my.app/monkey</code></p><p>Click on the <span class="strong"><strong>Add a new Monkey</strong></span> button, and you can see you are redirected to <code class="literal">http://my.app/monkey/create</code></p><p>If you take a look at the page source, you will find that the form's <code class="literal">action</code> attribute is actually the same URL:</p><div class="informalexample"><pre class="programlisting">&lt;form class="form-horizontal" action="http://my.app/monkey/create" accept-charset="utf-8" method="post"&gt;</pre></div><p>It means that whether we are opening the monkey's creation form or submitting it, we will always call the <code class="literal">create</code> action of the <code class="literal">monkey</code> controller. We should then read how this action is implemented:</p><div class="informalexample"><pre class="programlisting">public function action_create()
{
    if (Input::method() == 'POST')
    {
        $val = Model_Monkey::validate('create');
        
        if ($val-&gt;run())
        {
            // Saves the model (out of this chapter scope)
        }
        else
        {
            Session::set_flash('error', $val-&gt;error());
        }
    }

    $this-&gt;template-&gt;title = "Monkeys";
    $this-&gt;template-&gt;content = View::forge('monkey/create');

}</pre></div><p>As you can notice, the action is able to know whether or not it is accessed through a POST request by using <code class="literal">Input::method()</code>. You are recommended to take a look at the official documentation of the <code class="literal">Input</code> class at <a class="ulink" href="http://fuelphp.com/docs/classes/input.html">http://fuelphp.com/docs/classes/input.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>Input</strong></span>)</p><p>
<code class="literal">Model_Monkey::validate('create')</code> returns an object that seems to define whether or not the object can be saved (depending on what <code class="literal">$val-&gt;run()</code> returns). This is a method from the <a id="id111" class="indexterm"/>
<span class="strong"><strong>Monkey</strong></span> model, so we should look into it. Open <code class="literal">APPPATH/classes/model/monkey.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class Model_Monkey extends Model_Crud
{
    protected static $_table_name = 'monkeys';
    
    public static function validate($factory)
    {
        $val = Validation::forge($factory);
        $val-&gt;add_field('name', 'Name', 'required|max_length[255]');
        $val-&gt;add_field('still_here', 'Still Here', 'required');
        $val-&gt;add_field('height', 'Height', 'required');
        $val-&gt;add_field('description', 'Description', 'required');

        return $val;
    }

}</pre></div><p>The file contains the <code class="literal">Model_Monkey</code> class that extends <code class="literal">Model_Crud</code> and allows us to handle the monkey instances.</p><p>First, you can notice the <code class="literal">$_table_name</code> static attribute that defines the table name where the objects are saved (here, all our monkeys are saved into the <code class="literal">monkeys</code> table).</p><p>And then there is the <code class="literal">validate</code> static method we are looking for. It returns a <code class="literal">Validation</code> object, that in our case will check that:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">name</code> attribute is not empty and its length is less than 255 characters</li><li class="listitem" style="list-style-type: disc"><code class="literal">still_here</code>, <code class="literal">height</code>, and <code class="literal">description</code> are not empty</li></ul></div><p>For more detail about this class, you are recommended to read the official documentation at <a class="ulink" href="http://fuelphp.com/docs/classes/validation/validation.html">http://fuelphp.com/docs/classes/validation/validation.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>Validation</strong></span> | <span class="strong"><strong>Introduction</strong></span>)</p><p>In our case, simply <a id="id112" class="indexterm"/>comment or remove the following line:</p><div class="informalexample"><pre class="programlisting">$val-&gt;add_field('description', 'Description', 'required');</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>You might have read <code class="literal">Session::set_flash</code> several times in the <code class="literal">Controller_Monkey</code> controller and <code class="literal">Session::get_flash</code> several times in the template. Session flash variables have a very limited life span and are generally used to store temporary information, such as notices or errors displayed to the user.</p></div></div></div><div class="section" title="Checking whether the height is a float"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec14"/>Checking whether the height is a float</h3></div></div></div><p>It is now easy to check <a id="id113" class="indexterm"/>if the height is a float. As we know that monkeys are generally not taller than 4 feet, we can even add a numerical constraint. In the <code class="literal">validate</code> method of <code class="literal">Model_Monkey</code>, replace the following line:</p><div class="informalexample"><pre class="programlisting">$val-&gt;add_field('height', 'Height', 'required');</pre></div><p>by</p><div class="informalexample"><pre class="programlisting">$val-&gt;add_field(
    'height',
    'Height',
    'required|numeric_between[0,6]'
);</pre></div></div><div class="section" title="Using a checkbox instead of an input for the still_here attribute"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec15"/>Using a checkbox instead of an input for the still_here attribute</h3></div></div></div><p>This change will be a <a id="id114" class="indexterm"/>bit more complex. First, still in the <code class="literal">validate</code> method of <code class="literal">Model_Monkey</code>, remove the following line as we won't need this validation:</p><div class="informalexample"><pre class="programlisting">$val-&gt;add_field('still_here', 'Still Here', 'required');</pre></div><p>Now, if you go back to our <code class="literal">create</code> action in <code class="literal">Controller_Monkey</code> (located at <code class="literal">APPPATH/classes/controller/monkey.php</code>), you will see that the template content is set to the view located at <code class="literal">APPPATH/views/monkey/create.php</code>. If you look at the file content, it is pretty simple:</p><div class="informalexample"><pre class="programlisting">&lt;h2&gt;New Monkey&lt;/h2&gt;
&lt;br&gt;

&lt;?php echo render('monkey/_form'); ?&gt;

&lt;p&gt;&lt;?php echo Html::anchor('monkey', 'Back'); ?&gt;&lt;/p&gt;</pre></div><p>For your information, the <code class="literal">render</code> method is an alias of <code class="literal">View::render</code>, and in this case equivalent to <code class="literal">View::forge</code>. This illustrates that it is possible to render views inside other views. It can be convenient to prevent code repetition; the view located at <code class="literal">APPPATH/views/monkey/edit.php</code> also renders the same view (<code class="literal">monkey/_form</code>), and this makes sense since the forms displayed are exactly the same, whether you create a new monkey or edit an existing one.</p><p>Since we want to edit<a id="id115" class="indexterm"/> the form to replace the <code class="literal">still_here</code> input by a checkbox, open the view located at <code class="literal">APPPATH/views/monkey/_form.php</code> and replace the following lines:</p><div class="informalexample"><pre class="programlisting">&lt;?php 
echo Form::input(
    'still_here',
    Input::post(
        'still_here',
        isset($monkey) ? $monkey-&gt;still_here : ''
    ),
    array(
        'class' =&gt; 'col-md-4 form-control',
        'placeholder' =&gt; 'Still here'
    )
);
?&gt;</pre></div><p>By</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo Form::checkbox(
    'still_here',
    1,
    Input::post(
        'still_here',
        isset($monkey) ? $monkey-&gt;still_here : true
    )
);
?&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>In the code above, the first parameter is the name attribute of the checkbox. The second parameter is the value attribute of the checkbox. The third parameter determines whether the checkbox is checked or not. You can notice that, when we create a new monkey (and therefore no monkey is set), the checkbox will be checked by default. You are recommended to read the official documentation for more information about the <code class="literal">Form</code> class at <a class="ulink" href="http://fuelphp.com/docs/classes/form.html">http://fuelphp.com/docs/classes/form.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>Core</strong></span> | <span class="strong"><strong>Form</strong></span>)</p></div></div><p>Finally, you are <a id="id116" class="indexterm"/>probably aware that the <code class="literal">still_here</code> POST attribute won't be defined if the checkbox is unchecked when submitting the form. Thus, we need to define a default value when retrieving the <code class="literal">still_here</code> POST attribute, not only in the <code class="literal">create</code> action but also in the <code class="literal">edit</code> action. In both the methods, replace the following:</p><div class="informalexample"><pre class="programlisting">Input::post('still_here')</pre></div><p>by</p><div class="informalexample"><pre class="programlisting">Input::post('still_here', 0)</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>Our solution works, but, in most cases, hard-coding a default value is not a good idea. When indicating a default value, for a request parameter or a configuration item, the best is to define this value inside a centralized configuration file and load it from there. Always avoid hard-coding constants, even for default values.</p></div></div></div><div class="section" title="Setting custom routes"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec16"/>Setting custom routes</h3></div></div></div><p>Last but not least, we don't <a id="id117" class="indexterm"/>want to display FuelPHP's welcome screen when requesting the root URL, but instead the monkeys' listing. For doing that we will have to change the routes' configuration file located at <code class="literal">APPPATH/config/routes.php</code>.</p><p>Replace:</p><div class="informalexample"><pre class="programlisting">'_root_'  =&gt; 'welcome/index',</pre></div><p>By:</p><div class="informalexample"><pre class="programlisting">'_root_'  =&gt; 'monkey/index',</pre></div><p>When requesting:</p><p>
<code class="literal">http://my.app/</code>
</p><p>You should now see <a id="id118" class="indexterm"/>your monkey listing.</p></div><div class="section" title="Removing useless routes and files"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec17"/>Removing useless routes and files</h3></div></div></div><p>Now that our project is<a id="id119" class="indexterm"/> working as intended, it might be a good<a id="id120" class="indexterm"/> idea to clean it:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remove <code class="literal">APPPATH/classes/controller/welcome.php</code> as we don't need this controller anymore</li><li class="listitem" style="list-style-type: disc">Remove the <code class="literal">APPPATH/classes/presenter</code> folder</li><li class="listitem" style="list-style-type: disc">Remove the <code class="literal">APPPATH/views/welcome</code> folder</li><li class="listitem" style="list-style-type: disc">And remove the <code class="literal">_404_</code>, <code class="literal">hello(/:name)?</code>, <code class="literal">my/welcome/page</code> keys from the routes' configuration file located at <code class="literal">APPPATH/config/routes.php</code>.</li></ul></div></div></div></div>
<div class="section" title="A few notes about deploying your application"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>A few notes about deploying your application</h1></div></div></div><p>Now that you have a <a id="id121" class="indexterm"/>working application, you might want to publish it on hosts. Handling this is quite easy, the longer part being sending the project's files (using FTP, Git, or any other tool depending on your hosting service), but there are a couple of things you should know.</p><p>First, you have to set your apache <code class="literal">FUEL_ENV</code> environment to <code class="literal">production</code>. An easy way to do that is to edit <code class="literal">public/.htaccess</code> and uncomment the second line:</p><div class="informalexample"><pre class="programlisting">SetEnv FUEL_ENV production</pre></div><p>Keep in mind, that in this case you will have two different files between your local environment and your production environment, so it will be prone to human error. You are recommended to read the official documentation at <a class="ulink" href="http://fuelphp.com/docs/general/environments.html">http://fuelphp.com/docs/general/environments.html</a> (It can be accessed through the FuelPHP website by navigating to <span class="strong"><strong>DOCS</strong></span> | <span class="strong"><strong>TABLE OF CONTENTS</strong></span> | <span class="strong"><strong>FuelPHP</strong></span> | <span class="strong"><strong>Environments</strong></span>)</p><p>If you are using a shared hosting solution, keep in mind that, as explained in <span class="emphasis"><em>The simplest way</em></span> section,<span class="emphasis"><em> </em></span>you should take additional security precautions</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Summary</h1></div></div></div><p>In this chapter, we have seen the very basics of the FuelPHP framework and we have built our first project. We have learnt how to install FuelPHP, used the oil command line to generate code files and migrate our application, understood how routes work, and seen how models, views, presenters, and controllers interact with each other.</p><p>Though you are now able to create an application and implement basic features, you might not be yet ready for more complex projects. In the next chapter, we will improve your skills by using FuelPHP's Object Relational Mapper (ORM).</p></div></body></html>