<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Up and Running  with Drupal 8</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will get introduced to Drupal 8 and cover the following recipes:</p>
<ul>
<li>Installing Drupal</li>
<li>Using a distribution with Drupal</li>
<li>Installing modules and themes</li>
<li>Using multisites in Drupal 8</li>
<li>Tools for setting up an environment</li>
<li>Running tests: Simpletest and PHPUnit</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>This chapter will kick off with an introduction to installing a Drupal 8 site. We will walk through Drupal's interactive installer. We will cover installing Drupal using a command-line tool called Drush. Drupal provides two installation types: standard and minimal. Throughout this book, we will use the standard installation.</p>
<p>Once we have installed our Drupal 8 site, we will cover the basics of extending Drupal. We will discuss using distributions and installing contributed projects, such as modules and themes. We will also include uninstalling modules, as the process for uninstalling modules has changed in Drupal 8.</p>
<p>This book will involve a hands-on example for working with Drupal 8, and this chapter will provide information on setting up a local development environment. This chapter will also provide recipes on how to set up a Multisite installation in Drupal 8 and run the available test suites.</p>
<p>Before we get started, you should install Composer. Composer is the de facto package management tool for PHP. In case you are unfamiliar with Composer, it is just like using Gems for Ruby, npm for Node.js, and Bower for frontend libraries. Go to the Composer documentation to learn how to install Composer globally on your system:</p>
<ul>
<li>Linux / Unix / macOS: <a href="https://getcomposer.org/doc/00-intro.md#installation-linux-unix-osx"><span class="URLPACKT">https://getcomposer.org/doc/00-intro.md#installation-linux-unix-osx</span></a></li>
<li>Windows: <a href="https://getcomposer.org/doc/00-intro.md#installation-windows"><span class="URLPACKT">https://getcomposer.org/doc/00-intro.md#installation-windows</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Drupal</h1>
                </header>
            
            <article>
                
<p>There are many different methods to download Drupal and install it. In this recipe, we will focus on downloading Drupal from <a href="https://www.drupal.org/"><span class="URLPACKT">https://www.drupal.org/</span></a> and setting it up on a basic Linux, Apache, MySQL, or PHP (LAMP) server.</p>
<p>In this recipe, we will set up the files for Drupal 8 and step through the installation process.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Before we start, you will need a development environment that meets the new system requirements for Drupal 8:</p>
<ul>
<li>Apache 2.0 (or higher) or Nginx 1.1 (or higher) web server</li>
<li>PHP 5.5.9 or higher, but PHP 5.6 or PHP 7 is recommended, as PHP 5.5 has reached its end-of-life support</li>
<li>MySQL 5.5 or MariaDB 5.5.20 for your database</li>
</ul>
<div class="packt_infobox">You will need a user with privileges to create databases or a created database with a user who has privileges to make tables in that database.</div>
<ul>
<li>Access to upload or move files to the server</li>
<li class="mce-root"><span>While a default installation of PHP</span> will <span>work with Drupal, it does require certain PHP extensions, such as mbstring. Check out</span> <a href="https://www.drupal.org/requirements/php"><span class="URLPACKT">https://www.drupal.org/requirements/php</span></a> <span>for up-to-date</span> requirement <span>information.</span></li>
</ul>
<div class="packt_infobox">Drupal 8 ships with Symfony (<a href="https://symfony.com/">https://symfony.com/</a>) components. One of the new dependencies in Drupal 8, to support the Symfony routing system, is the Drupal <kbd>Clean URL</kbd> functionality. If the server is using Apache, ensure that <kbd>mod_rewrite</kbd> is enabled. If the server is using Nginx, the <kbd>ngx_http_rewrite_module</kbd> must be enabled.</div>
<p>We will download Drupal 8 and place its files in your web server's document root. This is the <kbd>/var/www</kbd> folder. If you used a tool, such as XAMPP, WAMP, or MAPP, consult the proper documentation to know your document root.</p>
<p>For full system requirements for Drupal 8, check out <a href="https://www.drupal.org/docs/8/system-requirements/"><span class="URLPACKT">https://www.drupal.org/docs/8/system-requirements/</span></a><span class="URLPACKT">. The Drupal.org</span> documentation is currently being migrated. Also, review the Drupal 7 requirements page on <a href="https://www.drupal.org/docs/7/system-requirements/overview">https://www.drupal.org/docs/7/system-requirements/overview</a>, which highlights Drupal 8 items, as well<span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We need to follow these steps to install Drupal 8:</p>
<ol>
<li>First, we will need to navigate to <a href="https://www.drupal.org/download">https://www.drupal.org/download</a> and download the latest release of Drupal 8.x. You can find the most recent and recommended release on the <a href="https://www.drupal.org/project/drupal">https://www.drupal.org/project/drupal</a> page for Drupal 8 (8.3.1, 8.4.0, and so on). Extract the archive and place the files in your document root as the <kbd>drupal8</kbd> <span>folder</span> :</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img height="204" width="410" class="image-border" src="assets/1e2ed62e-6edf-4ee9-81ac-6656bdab7c2c.png"/></div>
<ol start="2">
<li>Open your browser and visit your web server, for example, <kbd>http://localhost/drupal8</kbd>, which will then take you to the Drupal installation wizard. You will land on the new multilingual options install screen. Select your language and click on <span class="packt_screen">Save and continue</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="assets/73e14053-ff4e-47c1-a917-7514a82ef907.png"/></div>
<ol start="3">
<li>On the next screen, select the default <span class="packt_screen">Standard</span> option for the installation profile. This will provide us with a standard configuration with the most commonly used modules installed.</li>
<li>The next step will verify your system requirements. If your system does not have any reportable issues, the screen will be skipped. If you do have any requirement conflicts, you can resolve them and click on the button to try again.</li>
</ol>
<div class="packt_infobox"><span>If you have requirement issues, the installer will report the specific issues. Nearly every requirement will link to a</span> <span class="URLPACKT">Drupal.org</span> <span>handbook page with solution steps.</span></div>
<ol start="5">
<li>Enter the database information for Drupal. In most cases, you will only need to supply the username, password, and database name and leave others as defaults. If your database does not exist, the installer will attempt to create the database:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="assets/ccd32a82-ecf9-4a95-9fd0-9b86e3676bd8.png"/></div>
<div class="packt_infobox">See the <em>There's more...</em> section of this recipe for information on setting up your database.</div>
<ol start="6">
<li>Your Drupal 8 site will begin installing. When it is done installing the base modules, you will be taken to a site configuration screen.</li>
</ol>
<p> </p>
<ol start="7">
<li>The configure site form provides the base configuration for your Drupal site. Enter your site name and the email address for the site. The site email will be used to send administrative notifications and has the originating email for outgoing emails from the Drupal site. This form allows you to set regional information regarding the country and time zone of the site. Setting the timezone ensures that time values display correctly.</li>
<li>Fill in the site maintenance account information, also known as user 1, which acts in a similar way to the root on Unix-based systems. The site maintenance account is crucial. As stated, this acts as the first user and is given the user ID of 1. In Drupal, the user with the user ID of 1 often can bypass permission checks automatically and have global access.</li>
<li>Enter the site's regional information, and check whether the site should check for updates available for modules enabled and Drupal itself. By checking for updates automatically, your site will report anonymous usage statistics to <span class="URLPACKT">Drupal</span> along with providing a summary of your version status. You have the option to also opt-in for the site to email you notifications of new releases, including security releases.</li>
<li>When the information is satisfied, click on <span class="packt_screen">Save and continue</span>, and congratulations, you installed Drupal! The next screen will provide you a link to your installed Drupal site.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The Drupal installation process will provide a Drupal installation for the selected language and install modules and configuration based on the installation profile (standard or minimal in this recipe.)</p>
<p>When you visit the installer, it reads the language code from the browser. With this language code, it will then select a supported language. If you choose a non-English installation, the translation files will be automatically downloaded from <a href="https://localize.drupal.org/"><span class="URLPACKT">https://localize.drupal.org/</span></a>. Previous versions of Drupal did not support automated multilingual installs. More on multilingual will be covered in <a href="459ccdb8-7d36-44a8-b476-e34649e310a2.xhtml"><em>Chapter 8</em></a>, <em>Multilingual and Internationalization</em>.</p>
<p>The installation profile instructs Drupal what modules to install by default. Contributed install profiles are termed distributions; we will discuss this more in the next recipe.</p>
<p>When verifying requirements, Drupal checks application versions and PHP configurations. For example, if your server has the PHP Xdebug (<a href="https://xdebug.org">https://xdebug.org</a>) extension installed, the minimum <kbd>max_nesting_level</kbd> must be 256 or else Drupal will not be installed (<a href="https://www.drupal.org/node/2393531">https://www.drupal.org/node/2393531</a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The Drupal installation process is straightforward, but there are a few things worth discussing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a database user and a database</h1>
                </header>
            
            <article>
                
<p>As mentioned earlier, to install Drupal, you will need to have access to a database server <span>(or the ability to create one)</span> and an existing database (or the ability to create one). This process will depend on your environment setup.</p>
<p>If you are working with a hosting provider, there is more than likely a web-based control panel. This should allow you to create databases and users. Refer to your hosting provider's documentation for more information on this topic.</p>
<p>If you are using <strong>phpMyAdmin</strong> (<a href="https://www.phpmyadmin.net/">https://www.phpmyadmin.net/</a>) on your server, often installed by MAMP, WAMP, and XAMPP, and have root access, you can create your databases and users by following these steps:</p>
<ol>
<li>Sign in to phpMyAdmin as the root user.</li>
<li>Click on <span class="packt_screen">Add a new User</span> from the bottom of the privileges page.</li>
<li>Fill in the user's information.</li>
<li>Select to create a database for the user with all privileges granted.</li>
<li>You can now use that user's information to connect Drupal to your database.</li>
</ol>
<p>If you do not have a user interface but have a command-line access, you can set up your database and user using the MySQL command line. These instructions can be found in the <kbd>core/INSTALL.mysql.txt</kbd> file. From the command line of your site, perform the following:</p>
<ol>
<li>Log in to MySQL:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ mysql -u username -p</strong></pre>
<ol start="2">
<li>Create the database; you will use the following command to create the <kbd>my_database</kbd> database:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ CREATE DATABASE my_database CHARACTER SET utf8 COLLATE utf8_general_ci;</strong></pre>
<ol start="3">
<li>Create a new user to access the database:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ CREATE USER username@localhost IDENTIFIED BY 'password';</strong></pre>
<ol start="4">
<li>Grant the new user permissions on the database, as follows:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, CREATE TEMPORARY TABLES ON databasename.* TO 'username'@'localhost' IDENTIFIED BY 'password';</strong></pre>
<div class="packt_infobox">If you are installing Drupal with a PostgreSQL or SQLite database, check out the appropriate installation instructions, either <kbd>INSTALL.pgsql.txt</kbd> or <kbd>INSTALL.sqlite.txt</kbd>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Database prefixes</h1>
                </header>
            
            <article>
                
<p>Drupal, like other content management systems, allows you to prefix its database tables from the database set-up form. This prefix will be placed before table names to help make them unique. Although it is not recommended, this would allow multiple installations to share one database. Utilizing table prefixes can, however, provide some level of security through obscurity since the tables will not be their default names:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img height="212" width="279" class="image-border" src="assets/1441d718-6ef2-49c2-ab51-a26dfec36d65.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Downloading and installing with Drush</h1>
                </header>
            
            <article>
                
<p>You may also install Drupal using the PHP command-line tool, Drush. Drush is a command-line tool created by the Drupal community and must be installed if you wish to use it. Drush is covered in <a href="099b7376-2149-4af8-9649-45445745f068.xhtml"><em>Chapter 13</em></a>, <em>The Drupal CLI</em>.</p>
<div class="packt_infobox"><span>As of Drush 9, which supports Drupal 8.3+, this section is deprecated. Using Drush to download Drupal core or contributed modules will throw a warning to use Composer instead.</span></div>
<p>The <kbd>pm-download</kbd> command will download packages from Drupal.org. The <kbd>site-install</kbd> command will allow you to specify an installation profile and other options to install a Drupal site. The installation steps in this recipe could be run through Drush, as follows:</p>
<pre><strong>$ cd /path/to/web</strong>
<strong>$ drush pm-download drupal-8 drupal8</strong>
<strong>$ cd drupal8</strong>
<strong>$ drush site-install standard -locale=en-US --account-name=admin --account-pass=admin -account-email=demo@example.com -db-url=mysql://user:pass@localhost/database</strong>
  </pre>
<p>We used Drush to download the latest Drupal 8 and place it in a folder named <kbd>drupal8</kbd>. Then, the <kbd>site-install</kbd> command instructs Drush to use the standard install profile, configure the maintenance account, and provide a database URI string so that Drupal can connect to its database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Composer to create a Drupal site</h1>
                </header>
            
            <article>
                
<p>You can download Drupal using Composer, the de facto PHP package manager. The preferred method is to use the Drupal Composer project template provided by the community.</p>
<p>To build your Drupal 8 site, run the following commands:</p>
<pre><strong>$ cd /path/to/document/root</strong>
<strong>$ composer create-project drupal-composer/drupal-project drupal8 --stability dev</strong></pre>
<p>Wait for the commands to finish--it may take some time, as it downloads all the required dependencies. You can feel free to grab a coffee (the first time takes a while; it primes caches. Have faith, it will be much faster the next time.)</p>
<p>When finished, you will find a different directory structure inside your <kbd>drupal8</kbd> directory. The <kbd>vendor</kbd> directory contains all third-party PHP libraries, and the <kbd>web</kbd> directory contains your Drupal 8 site. You will need to modify your web server to use the <kbd>web</kbd> directory as the new docroot within your <kbd>drupal8</kbd> directory.</p>
<p>The project and its details can be found at <a href="https://github.com/drupal-composer/drupal-project"><span class="URLPACKT">https://github.com/drupal-composer/drupal-project</span></a>, along with its full documentation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Security updates</h1>
                </header>
            
            <article>
                
<p>If you choose to disable the update options, you will have to check manually for module upgrades. While most upgrades are for bug fixes or features, some are for security updates. It is highly recommended that you subscribe to the Drupal security team's updates. These updates are available on Twitter at <kbd>@drupalsecurity</kbd> (<a href="https://twitter.com/drupalsecurity">https://twitter.com/drupalsecurity</a>) or the feeds on<br/>
<a href="https://www.drupal.org/security"><span class="URLPACKT">https://www.drupal.org/security</span></a><span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>For more on multilingual, check out <span class="ChapterrefPACKT"><a href="459ccdb8-7d36-44a8-b476-e34649e310a2.xhtml"><em>Chapter 8</em></a>, <em>Multilingual and Internationalization</em></span></li>
<li>For more on using the command line and Drupal, <span>check out</span> <span class="ChapterrefPACKT"><a href="099b7376-2149-4af8-9649-45445745f068.xhtml"><em>Chapter 13</em></a>, <em>The Drupal CLI</em></span></li>
<li><span>Check out</span> the <span class="URLPACKT">Drupal.org</span> handbook on installing Drupal at <a href="https://www.drupal.org/documentation/install"><span class="URLPACKT">https://www.drupal.org/documentation/install</span></a></li>
<li><span>Check out</span> the Drupal.org handbook that discusses Drupal 8 and Composer at <a href="https://www.drupal.org/docs/develop/using-composer/using-composer-with-drupal"><span class="URLPACKT">https://www.drupal.org/docs/develop/using-composer/using-composer-with-drupa</span>l</a></li>
<li>Check out more information on Drush site install at <a href="https://drushcommands.com/drush-8x/core/site-install/">https://drushcommands.com/drush-8x/core/site-install/</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using a distribution with Drupal</h1>
                </header>
            
            <article>
                
<p>Why would you want to use a distribution? A distribution is a contributed installation profile that is not provided by Drupal core. Distributions provide a specialized version of Drupal with specific installed modules and themes along with specific configurations (content types, and blocks.) On Drupal.org, when you download an installation profile, it not only includes the profile and its modules but a version of Drupal core, hence the name distribution. You can find a list of all Drupal distributions at <a href="https://www.drupal.org/project/project_distribution"><span class="URLPACKT">https://www.drupal.org/project/project_distribution</span></a><span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will follow these steps to download a distribution to use as a customized version of Drupal 8:</p>
<ol>
<li>Download a distribution from <span class="URLPACKT">Drupal.org</span>. For this recipe, let's use the Demo Framework provided by Acquia at <a href="https://www.drupal.org/project/df"><span class="URLPACKT">https://www.drupal.org/project/df</span></a><span class="URLPACKT">.</span></li>
<li>Select the recommended version for the 8.x branch.</li>
<li>Extract the folder contents to your web server's document root--you'll note that there is Drupal core; within the <kbd>profiles</kbd> folder, there's the installation profile's folder--<kbd>df</kbd>.</li>
<li>Due to current Drupal.org packaging limitations, there is a manual step that you will need to run in order to install additional dependencies. Run the following command using your terminal inside of the extracted contents:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ composer require "commerceguys/intl: ~0.7" "commerceguys/addressing: ~1.0" "commerceguys/zone: ~1.0" "embed/embed: ~2.2</strong></pre>
<ol start="5">
<li class="mce-root">Install Drupal as you would normally, by navigating to your Drupal site in your browser.</li>
<li class="mce-root">Follow the installation instructions in the site to install the distribution.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Installation profiles work by including additional modules that are part of the contributed project realm or custom modules. The profile will then define them as dependencies to be installed with Drupal. When you select an installation profile, you are instructing Drupal to install a set of modules on installation.</p>
<p>Demo Framework declares itself as an exclusive installation profile. Distributions that declare this are automatically selected and assumed to be the default installation option. The exclusive flag was added with Drupal 7.22 to improve the experience of using a Drupal distribution (<a href="http://drupal.org/node/1961012">http://drupal.org/node/1961012</a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Distributions provide a specialized version of Drupal with specific feature sets, but there are a few items worth discussing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Makefiles</h1>
                </header>
            
            <article>
                
<p>The current standard for generating a built distribution is the utilization of Drush and makefiles. Makefiles allow a user to define a specific version of Drupal core and other projects (such as themes, modules, and third-party libraries) that will make up a Drupal code base. It is not a dependency management workflow, like Composer, but is a build tool.</p>
<p>If you take a look at the Demo Framework's <kbd>profile</kbd> folder, you will see <kbd>drupal-org.make</kbd> and <kbd>drupal-org-core.make</kbd>. These are parsed by the <span class="URLPACKT">Drupal.org</span> packager to compile the code base and package it as a <kbd>.zip</kbd> or <kbd>.tar.gz</kbd>, like the one you downloaded.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing with Drush</h1>
                </header>
            
            <article>
                
<p><span>As discussed in the first recipe's</span> <em>There's more...</em> <span>section, you can install a Drupal site through the Drush command-line tool. You can instruct Drush to use a specific installation profile by providing it as the first argument.</span></p>
<div class="packt_infobox">As of Drush 9, which supports Drupal 8.3+, this section is deprecated. Using Drush to download Drupal core or contributed modules will throw a warning to use Composer instead.</div>
<p>The following command would install the Drupal 8 site using the Demo Framework:</p>
<pre><strong>    $ cd /path/to/drupal8</strong><br/>    <strong>$ drush pm-download df</strong>
    <strong>$ drush site-install df -db-url=mysql://user:pass@localhost/database</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Composer</h1>
                </header>
            
            <article>
                
<p>Currently, Drupal.org does not package distributions using Composer, which is why there was an extra step to add dependencies when installing the distribution. Many distributions provide project templates to make scaffolding projects simpler.</p>
<p>For example, the following command will set up a Demo Framework site with <kbd>docroot</kbd> as the directory for the web server document root, which contains Drupal 8:</p>
<pre><strong>$ composer create-project acquia/df-project df</strong></pre>
<p>The project template is available on Acqua's GitHub at <a href="https://github.com/acquia/df-project/">https://github.com/acquia/df-project/</a>.</p>
<p>Another distribution, Open Social, provides a template of its own:</p>
<pre><strong>$ composer create-project goalgorilla/social_template<br/></strong></pre>
<p>The project template is available at <a href="https://github.com/goalgorilla/social_template">https://github.com/goalgorilla/social_template</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also...</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to <span class="ChapterrefPACKT"><a href="099b7376-2149-4af8-9649-45445745f068.xhtml"><em>Chapter 13</em></a>, <em>The Drupal CLI</em>,</span> for information on makefiles.<a href="http://www.drush.org/en/master/make/"/></li>
<li><span>Refer to</span> Distribution documentation on <span class="URLPACKT">Drupal at</span> <a href="https://www.drupal.org/documentation/build/distributions"><span class="URLPACKT">https://www.drupal.org/documentation/build/distributions</span></a>.</li>
<li>Refer to <em>Managing Your Drupal Project with Composer</em> at <a href="https://glamanate.com/blog/managing-your-drupal-project-composer">https://glamanate.com/blog/managing-your-drupal-project-composer</a>.</li>
<li><span>Refer to</span> Managing your Drupal platform with Drush at <a href="https://glamanate.com/blog/managing-your-drupal-platform-drush">https://glamanate.com/blog/managing-your-drupal-platform-drush</a>.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing modules and themes</h1>
                </header>
            
            <article>
                
<p>Drupal 8 provides more functionality out-of-the-box than previous versions of Drupal, allowing you to do more with less. However, one of the more appealing aspects of Drupal is the ability to extend and customize.</p>
<p>In this recipe, we will download and enable the Honeypot module (<a href="https://www.drupal.org/project/honeypot">https://www.drupal.org/project/honeypot</a>) and tell Drupal to use the Bootstrap theme (<a href="https://www.drupal.org/project/bootstrap">https://www.drupal.org/project/bootstrap</a>). The Honeypot module provides Honeypot and timestamps antispam measures on Drupal sites. This module helps protect forms from spam submissions. The Bootstrap theme implements the Bootstrap frontend framework and supports using Bootswatch styles to theme your Drupal site.</p>
<div class="packt_infobox">This chapter's recipe will use the standard way of installing modules, by downloading archives available on <span class="URLPACKT">Drupal.org</span>. As of Drupal 8.2.0, installing modules through Composer has been possible and is the required method for some modules. Installing modules and themes using Composer is covered in the <em>There's more...</em> section of this recipe and is highly recommended.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you have used Drupal before, note that the folder structure has changed. Modules, themes, and profiles are now placed in their respective folders in the <kbd>root</kbd> directory and no longer under <kbd>sites/all</kbd>. For more information about the developer experience change, refer to <a href="https://www.drupal.org/node/22336"><span class="URLPACKT">https://www.drupal.org/node/22336</span></a><span class="URLPACKT">.</span></p>
<div class="packt_tip"><span class="packt_screen">Downloading the example code</span>: You can download the example code files for all Packt books you have purchased from your account at <a href="http://www.packtpub.com"><span class="URLPACKT">http://www.packtpub.com</span></a><span class="URLPACKT">.</span> If you have purchased this book from elsewhere, you can go to <a href="http://www.packtpub.com/support"><span class="URLPACKT">http://www.packtpub.com/support</span></a> and register yourself to have the files emailed directly to you.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Let's install modules and themes:</p>
<ol>
<li>Visit <a href="https://www.drupal.org/project/honeypot"><span class="URLPACKT">https://www.drupal.org/project/honeypot</span></a> and download the latest 8.x release for Honeypot.</li>
<li>Extract the archive and place the <kbd>honeypot</kbd> folder inside the <kbd>modules</kbd> folder, <span>which is</span> inside of your Drupal core installation:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><span class="packt_screen"><img height="329" width="394" class="image-border" src="assets/94b95366-ac39-43c8-9d00-04ffe7f1beb5.png"/></span></div>
<div class="packt_figure"/>
<ol start="3">
<li>In Drupal, log in and select the <span class="packt_screen">Extend</span> option to access the list of available modules.</li>
<li>Using the search text field, type in <kbd>Honeypot</kbd>. Check the checkbox and click on <span class="packt_screen">Install</span>.</li>
</ol>
<p> </p>
<ol start="5">
<li>Once enabled, search for it again. Clicking on the module's description will expand the row and expose links to configure permissions and module settings:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><span class="packt_screen"><img class="image-border" src="assets/652eb39e-937f-4346-bcd6-a0e75b4bc773.png"/></span></div>
<ol start="6">
<li>Visit <a href="https://www.drupal.org/project/bootstrap"><span class="URLPACKT">https://www.drupal.org/project/bootstrap</span></a> <span>and download the latest 8.x release for Bootstrap.</span></li>
<li>Extract the archive and place the <kbd>bootstrap</kbd> folder inside the <kbd>themes</kbd> folder, which is inside your Drupal core installation:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><span class="packt_screen"><span class="packt_screen"><img height="321" width="386" class="image-border" src="assets/94680f06-9b25-4e69-9d8a-798505482308.png"/></span></span></div>
<ol start="8">
<li>In Drupal, select the <span class="packt_screen">Appearance</span> option to manage your Drupal themes.</li>
<li>Scroll down the page and click on <span class="packt_screen">Install and set as default</span> under <span class="packt_screen">Bootstrap</span> to enable and set the theme as default:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><span class="packt_screen"><img height="237" width="287" class="image-border" src="assets/bfb2612f-3cad-47a2-851c-b2809a64d5d3.png"/></span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The following sections outline the procedure for installing a module or theme and how Drupal discovers these extensions.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Discovering modules and themes</h1>
                </header>
            
            <article>
                
<p>Drupal scans specific folder locations to identify modules and themes defined by the <kbd>.info.yml</kbd> file in their directory. The following is the order in which projects will be discovered:</p>
<ul>
<li>Their respective core folders (modules, or themes)</li>
<li>The currently installed profile</li>
<li>The root <kbd>modules</kbd> or <kbd>themes</kbd> folder</li>
<li>The current site directory (default or current domain)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Module installation</h1>
                </header>
            
            <article>
                
<p>By placing the module inside the root <kbd>modules</kbd> folder, we are allowing Drupal to discover the module and allow it to be installed. When a module is installed, Drupal will register its code with the system through the <kbd>module_installer</kbd> service. The service will check for required dependencies and prompt them to be enabled if required. The configuration system will run any configuration definitions provided by the module on installation. If there are conflicting configuration items, the module <em>will not be installed</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Theme installation</h1>
                </header>
            
            <article>
                
<p>A theme is installed through the <kbd>theme_installer</kbd> service and sets any default configuration by the theme along with rebuilding the theme registry. Setting a theme to default is a configuration change in <kbd>system.theme.default</kbd> to the theme's machine name (in the recipe, it would be <kbd>bootstrap</kbd>)<span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The following section outlines the procedure for installing a module or theme and includes some additional information for installing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing a module or theme using Composer</h1>
                </header>
            
            <article>
                
<p>Although it is not the required way to install an extension, this should become your default method. Why? Because each module is a dependency in your project, and each of those may have its own dependencies. Composer can manage dependencies for you, or you can manage them manually. Your time and capabilities probably will not grow to scale as well as Composer will. Not to mention, it also provides a standard way for PHP projects to interoperate and load classes.</p>
<p>You can get the Honeypot module and Bootstrap using the following two commands:</p>
<pre><strong>$ cd /path/to/drupal8</strong><br/><strong>$ composer require drupal/honeypot</strong>
<strong>$ composer require drupal/bootstrap</strong>
  </pre>
<p>Here is an example of contributed projects, which require Composer for installation, because they leverage existing libraries in the PHP community at large:</p>
<ul>
<li>Drupal Commerce</li>
<li>GeoIP</li>
<li>Search API Solr</li>
<li>Entity Print</li>
</ul>
<p>As more and more modules integrate existing SDK libraries, the requirement to use Composer will increase.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing a module with Drush</h1>
                </header>
            
            <article>
                
<p>Modules can be downloaded and enabled through the command line using <kbd>drush</kbd>. The command to replicate the recipe would resemble the following:</p>
<pre>    <strong>$ drush pm-download honeypot</strong>
    <strong>$ drush pm-enable honeypot</strong></pre>
<div class="packt_infobox">As of Drush 9, which supports Drupal 8.3+, this section is deprecated. Using Drush to download Drupal core or contributed modules will throw a warning to use Composer instead.</div>
<p> </p>
<p>It will prompt you to confirm your action. If there were dependencies for the module, it would ask whether you will like to enable those, too.</p>
<div class="packt_infobox">Drush simply downloads the archive available from Drupal.org. If the module or theme requires third-party PHP library dependencies, these will not be downloaded or be available in Drupal's class autoloading process.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Uninstalling a module</h1>
                </header>
            
            <article>
                
<p>One of the substantial changes in Drupal 8 is the module disable and uninstall process. Previously, modules were first disabled and then uninstalled once disabled. This created a confusing process, which would disable its features, but not clean up any database schema changes. In Drupal 8, modules cannot just be disabled but must be uninstalled. This ensures that when a module is uninstalled it can safely be removed from the code base.</p>
<p>A module can only be uninstalled if it is not a dependency of another module or does not have a configuration item in use--such as a field type--which could disrupt the installation's integrity.</p>
<div class="packt_infobox">With a standard installation, the <kbd>Comment</kbd> module cannot be uninstalled until you delete all the <kbd>Comment</kbd> fields on the article <kbd>content</kbd> type. This is because the <kbd>field</kbd> type is in use.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ChapterrefPACKT">Refer to <a href="a634af62-2148-4382-9121-b8500df169ed.xhtml"><em>Chapter 4</em></a>, <em>Extending Drupal</em></span>, to learn about setting defaults on enabling a module.</li>
<li><span class="ChapterrefPACKT"><span>Refer to</span> <a href="b2659986-a8dc-4503-a043-6071ab7b6722.xhtml"><em>Chapter 9</em></a>, <em>Configuration Management - Deploying in Drupal 8.</em></span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using multisites in Drupal 8</h1>
                </header>
            
            <article>
                
<p>Drupal provides the ability to run multiple sites from one single Drupal code base instance. This feature is referred to as multisite. Each site has a separate database; however, extensions stored in <em>modules</em>, <em>profiles</em>, and <em>themes</em> can be installed by all of the sites. Site folders can also contain their own modules and themes. When provided, these can only be used by that one site.</p>
<p>The <kbd>default</kbd> folder is the default folder used if there is no matching domain name.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>If you are going to work with multisite functionality, you should have an understanding of how to set up virtual host configurations with your web server. In this recipe, we will use two subdomains under localhost, called <kbd>dev1</kbd> and <kbd>dev2</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will use multisites in Drupal 8 by two subdomains under localhost:</p>
<ol>
<li>Copy <kbd>sites/example.sites.php</kbd> to <kbd>sites/sites.php</kbd>.</li>
<li>Create a <kbd>dev1.localhost</kbd> and <kbd>dev2.localhost</kbd> folder inside the <kbd>sites</kbd> folder.</li>
<li>Copy the <kbd>sites/default/default.settings.php</kbd> file into <kbd>dev1.localhost</kbd> and <kbd>dev2.localhost</kbd> as <kbd>settings.php</kbd> in their respective folder:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><span class="packt_screen"><img height="296" width="490" class="image-border" src="assets/e4f64b42-01bd-49e0-9ba4-588514f69700.png"/></span></div>
<ol start="4">
<li>Got to <kbd>dev1.localhost</kbd> and run the installation wizard.</li>
<li><span>Got to</span> <kbd>dev2.localhost</kbd> and verify that you still have the option to install a site!</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>sites.php</kbd> must exist for the multisite functionality to work. By default, you do not need to modify its contents. The <kbd>sites.php</kbd> file provides a way to map aliases to specific site folders. The file contains the documentation for using aliases.</p>
<p>The <kbd>DrupalKernel</kbd> class provides <kbd>findSitePath</kbd> and <kbd>getSitePath</kbd> methods to discover the site folder path. On Drupal's Bootstrap, this is initiated and reads the incoming HTTP host to load the proper <kbd>settings.php</kbd> file from the appropriate folder. The <kbd>settings.php</kbd> file is then loaded and parsed into a <kbd>\Drupal\Core\Site\Settings</kbd> instance. This allows Drupal to connect to the appropriate database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Let's understand the security concerns of using multisite.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Security concerns</h1>
                </header>
            
            <article>
                
<p>There can be cause for concern if you are using multisite. Arbitrary PHP code executed on a Drupal site might be able to affect other sites sharing the same code base. Drupal 8 marked the removal of the PHP filter (<a href="https://www.drupal.org/docs/8/modules/php/overview">https://www.drupal.org/docs/8/modules/php/overview</a>) module that allowed site administrators to use PHP code in the administrative interface. Although this mitigates the various ways an administrator had easy access to run PHP through an interface, it does not mitigate the risk wholesale. For example, the PHP filter module is now a contributed project and could be installed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Domain aliases</h1>
                </header>
            
            <article>
                
<p>The <kbd>sites.php</kbd> file provides a way to add domain aliases. This can be useful when you use a multisite functionality and need to develop it locally. A simple example would be providing a <kbd>local.alias</kbd> to each site.</p>
<p>If you had <kbd>example.com</kbd> and <kbd>mycompany.com</kbd> as different site directories, the following mapping would allow <kbd>local.example.com</kbd> and <kbd>local.mycompany.com</kbd> to map to those directories:</p>
<pre><strong>&lt;?php</strong>
<strong>$sites['example.com'] = 'example.com';</strong>
<strong>$sites['local.example.com'] = 'example.com';</strong>
<strong>$sites['mycompany.com'] = 'mycompany.com';</strong>
<strong>$sites['local.mycompany.com'] = 'mycompany.com';</strong>
  </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also...</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to Multisite documentation on <span class="URLPACKT">Drupal at</span> <a href="https://www.drupal.org/documentation/install/multi-site"><span class="URLPACKT">https://www.drupal.org/documentation/install/multi-site</span></a>.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Tools for setting up an environment</h1>
                </header>
            
            <article>
                
<p>One of the initial hurdles to getting started with Drupal is a local development environment. This recipe will cover how to set up the DrupalVM project by Jeff Geerling. DrupalVM is a VirtualBox virtual machine run through Vagrant, provisioned and configured with Ansible. It will set up all of your services and build a Drupal installation for you.</p>
<p>Luckily, you will only need to have VirtualBox and Vagrant installed on your machine, and DrupalVM works on Windows, macOS X, and Linux.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To get started, you will need to install the two dependencies required for DrupalVM:</p>
<ul>
<li><strong>VirtualBox</strong>: <a href="https://www.virtualbox.org/wiki/Downloads"><span class="URLPACKT">https://www.virtualbox.org/wiki/Downloads</span></a></li>
<li><strong>Vagrant</strong>: <a href="http://www.vagrantup.com/downloads.html"><span class="URLPACKT">http://www.vagrantup.com/downloads.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Let's set up the DrupalVM project by Jeff Geerling by following these steps:</p>
<ol>
<li>Download the DrupalVM archive from <a href="https://github.com/geerlingguy/drupal-vm/archive/master.zip"><span class="URLPACKT">https://github.com/geerlingguy/drupal-vm/archive/master.zip</span></a><span class="URLPACKT">.</span></li>
<li>Extract the archive and place the project in the directory of your choice.</li>
<li>Copy <kbd>example.drupal.make.yml</kbd> to <kbd>drupal.make.yml</kbd>.</li>
<li>Copy <kbd>default.config.yml</kbd> to <kbd>config.yml</kbd>.</li>
</ol>
<p> </p>
<p> </p>
<ol start="5">
<li>Edit <kbd>config.yml</kbd> and modify the <kbd>local_path</kbd> setting to be the directory where you've placed the DrupalVM project. This will be synchronized into the virtual machine:</li>
</ol>
<pre style="padding-left: 60px">vagrant_synced_folders: 
local_path: /path/to/drupalvm 
destination: /var/www 
type: nfs 
create: true </pre>
<ol start="6">
<li>Open a terminal and navigate to the directory where you have placed the<br/>
DrupalVM project.</li>
<li>Enter the <kbd>vagrant up</kbd> <span>command</span> to tell Vagrant to build the virtual machine and begin the provisioning process.</li>
<li>While this process is ongoing, modify your host file to provide easy access to the development site. Add the <kbd>192.168.88.88 drupalvm.dev</kbd> <span>line</span> to your host file.</li>
<li>Open your browser and access <a href="http://www.drupalvm.com/"><span class="URLPACKT">http://www.drupalvm.com/</span></a><span class="URLPACKT">.</span></li>
<li>Log in to your Drupal site with the username <kbd>admin</kbd> and password <kbd>admin</kbd>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>DrupalVM is a development project that utilizes the Vagrant tool to create a VirtualBox virtual machine. Vagrant is configured through the project's <kbd>Vagrantfile</kbd>. Vagrant then uses Ansible--an open source IT automation platform<span>--</span>to install Apache, PHP, MySQL, and other services on the virtual machine.</p>
<p>The <kbd>config.yml</kbd> file has been set up to provide a simple way to customize variables for the virtual machine and provisioning process. It also uses Drush to create and install a Drupal 8 site, or whatever components are specified in <kbd>drupal.make.yml</kbd>. This file is a Drush <kbd>make</kbd> file, which contains a definition for Drupal core by default and can be modified to include other contributed projects.</p>
<p>The <kbd>vagrant up</kbd> command tells Vagrant to either launch an existing virtual machine or create one anew in a headless manner. When Vagrant creates a new virtual machine, it triggers the provisioning process. In this instance, Ansible will read the <kbd>provisioning/playbook.yml</kbd> file and follow each step to create the final virtual machine. The only files that need to be modified, however, are the <kbd>config.yml</kbd> and <kbd>drupal.make.yml</kbd> files.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The topic of automating and streamlining a local environment is quite popular right now with quite a few different options. If you are not comfortable with using Vagrant, there are a few other options that provide a server installation and Drupal.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Acquia Dev Desktop</h1>
                </header>
            
            <article>
                
<p>Acquia Dev Desktop is developed by Acquia and can be found at <a href="https://docs.acquia.com/dev-desktop2"><span class="URLPACKT">https://docs.acquia.com/dev-desktop2</span></a><span class="URLPACKT">.</span> It is an automated environment installer for Windows and Mac. It is a xAMP stack (or DAMP stack) installer that provides a full Drupal-specific stack that includes Apache, MySQL, and PHP. The Dev Desktop application allows you to create a regular Drupal installation or select from a distribution.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">XAMPP + Bitnami</h1>
                </header>
            
            <article>
                
<p>XAMPP - Apache + MySQL + PHP + Perl - is a cross-platform environment installation. XAMPP is an open source project from Apache Friends. XAMPP has partnered with Bitnami (<a href="https://bitnami.com/">https://bitnami.com/</a>) to provide free all-in-one installations for common applications, including Drupal 8. You can download XAMPP at <a href="https://www.apachefriends.org/download.html"><span class="URLPACKT">https://www.apachefriends.org/download.html</span></a><span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Kalabox</h1>
                </header>
            
            <article>
                
<p>Kalabox is developed by the Kalamuna group and intends to be a robust workflow solution for Drupal development. Kalabox is cross-platform compatible, allowing you to easily work on Windows machines. It is based on the command line and provides application binaries for you to install. You can learn more about Kalabox at <a href="http://www.kalamuna.com/products/kalabox/"><span class="URLPACKT">http://www.kalamuna.com/products/kalabox/</span></a><span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to <span class="ChapterrefPACKT"><a href="099b7376-2149-4af8-9649-45445745f068.xhtml"><em>Chapter 13</em></a>, <em>The Drupal CLI</em>,</span> for information on makefiles.</li>
<li>DrupalVM documentation <a href="http://docs.drupalvm.com/en/latest/"><span class="URLPACKT">http://docs.drupalvm.com/en/latest/</span></a>.</li>
<li><span class="URLPACKT">Refer to Drupal.org</span> community documentation on local environment setup at <a href="https://www.drupal.org/node/157602"><span class="URLPACKT">https://www.drupal.org/node/157602</span></a>.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running tests - Simpletest and PHPUnit</h1>
                </header>
            
            <article>
                
<p>Drupal 8 ships with two testing suites. Previously, Drupal only supported Simpletest. Now, there are PHPUnit tests as well. In the official change record, PHPUnit was added to provide testing without requiring a full Drupal Bootstrap, which occurs with each Simpletest test. You can read the change record at <a href="https://www.drupal.org/node/2012184"><span class="URLPACKT">https://www.drupal.org/node/2012184</span></a><span class="URLPACKT">.</span></p>
<p>There is currently a PHPUnit initiative active in Drupal core development. The goal is to fully remove the Simpletest framework by Drupal 9. No new Simpletest tests are being written, at least since 8.2. All current tests are currently being converted by contributors. More about the initiative can be found in this issue, <a href="https://www.drupal.org/node/2807237"><span class="URLPACKT">https://www.drupal.org/node/2807237</span></a>, where it is being coordinated.</p>
<p>We will be running tests using the <kbd>run-tests.sh</kbd> test runner. This is a test runner provided by Drupal that supports concurrency and running all of the various test suites. Running tests directly with PHPUnit will be covered in the following <em>There's more...</em> section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Drupal 8.1.0 introduced the ability to perform JavaScript browser tests. This is powered using PhantomJS (<a href="http://phantomjs.org/">http://phantomjs.org/</a>), which uses a browser emulator powered by the Mink PHP library (<a href="http://mink.behat.org/">http://mink.behat.org/</a>). In order to run the FunctionalJavascript test suite, you must have PhantomJS running.</p>
<p>To install PhantomJS, refer to the official installation instructions at <span class="URLPACKT"><a href="http://phantomjs.org/download.html">http://phantomjs.org/download.html</a>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>First, install the <kbd>Simpletest</kbd> module. Even though you might only want to run PHPUnit, this is a soft dependency for running the test runner script.</li>
<li>Open a command-line terminal and navigate to your Drupal installation directory.</li>
<li>Next, we will run the test runner script. We will pass it a <kbd>url</kbd> option so that the Functional tests can run the browser emulator properly. We will also specify the test suites to run. This allows us to skip FunctionalJavascript tests due to PhantomJS not handling concurrency properly in the test runner:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ php core/scripts/run-tests.sh <strong>--url </strong>http://localhost--types Simpletest,PHPUnit-Unit,PHPUnit-Kernel,PHPUnit-Functional<strong> --concurrency 20 --all</strong></strong></pre>
<ol start="4">
<li>Running <kbd>FunctionalJavascripts</kbd> tests require PhantomJS to be running. Since PhantomJS prints output to the terminal, open a new tab or terminal and run the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>phantomjs --ssl-protocol=any --ignore-ssl-errors=true vendor/jcalderonzumba/gastonjs/src/Client/main.js 8510 1024 768</strong> </pre>
<ol start="5">
<li>With PhantomJS running, we can now execute the FunctionalJavascript test suite:</li>
</ol>
<pre style="padding-left: 60px"><strong><strong>php core/scripts/run-tests.sh --url </strong>http://localhost--types PHPUnit-FunctionalJavascript --concurrency 1 --all</strong></pre>
<ol start="6">
<li>Review test output from each test suite run.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>run-tests.sh</kbd> script has been shipped with Drupal since 2008, then named<br/>
<kbd>run-functional-tests.php</kbd>. This command interacts with the test suites in Drupal to run all or specific tests and sets up other configuration items.</p>
<p>There are several different test suites that operate in specific ways:</p>
<ul>
<li><strong>Simpletest</strong>: The deprecated test system, full bootstraps and installs Drupal and uses its own browser emulator pattern using curl and XPath.</li>
<li><strong>PHPUnit-Unit</strong>: Unit tests backed by PHPUnit. These are intended to test specific classes and not interact with the database.</li>
<li><strong>PHPUnit-Kernel</strong>: Integration-level tests backed by PHPUnit. It is a test that has the ability to install schema and configuration to the database, minimally bootstrapping Drupal for basic integration testing.</li>
<li><strong>PHPUnit-Functional</strong>: Functional tests are tests that require a fully bootstrapped Drupal and provide browser emulation via Mink. These can be considered a direct replacement of Simpletest tests but leveraging third-party testing libraries.</li>
<li><strong>PHPUnit-FunctionalJavascript</strong>: Functional tests that have the ability to interact with PhantomJS in order to test JavaScript, such as AJAX operations and specific user interface interactions.</li>
</ul>
<p>The following are some of the useful options:</p>
<ul>
<li><kbd>--help</kbd>: This displays the items covered in the following bullets</li>
<li><kbd>--list</kbd>: This displays the available test groups that can be run</li>
<li><kbd>--url</kbd>: This is required unless the Drupal site is accessible through <kbd>http://localhost:80</kbd></li>
<li><kbd>--sqlite</kbd>: This allows you to run tests without having Drupal installed</li>
<li><kbd>--concurrency</kbd>: This allows you to define how many tests run in parallel</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We will now discuss more techniques and information for running Drupal's test suites.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Is run-tests a shell script?</h1>
                </header>
            
            <article>
                
<p>The <kbd>run-tests.sh</kbd> isn't actually a shell script. It is a PHP script--which is why you must execute it with PHP. In fact, within <kbd>core/scripts</kbd>, each file is a PHP script file meant to be executed using the command line. These scripts are not intended to be run through a web server, which is one of the reasons for the <kbd>.sh</kbd> extension.</p>
<p>There can be issues with PHP across platforms that prevent providing a shebang line to allow executing the file as a normal <kbd>bash</kbd> or <kbd>bat</kbd> script. For more information, refer to this <span class="URLPACKT">Drupal.org</span> issue at <a href="https://www.drupal.org/node/655178"><span class="URLPACKT">https://www.drupal.org/node/655178</span></a><span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running tests without Drupal installed</h1>
                </header>
            
            <article>
                
<p>With Drupal 8, tests can also be run from SQLlite and no longer requires an installed database. This can be accomplished by passing the <kbd>sqlite</kbd> and <kbd>dburl</kbd> options to the<br/>
<kbd>run-tests.sh</kbd> script. This requires the PHP SQLite extension to be installed.</p>
<p>Here is an example adapted from the DrupalCI test runner for Drupal core. DrupalCI is the continuous integration service, which runs on Drupal.org for all submitted patches and commits:</p>
<pre><strong>php core/scripts/run-tests.sh --sqlite /tmp/.ht.sqlite --die-on-fail --dburl sqlite://tmp/.ht.sqlite --all</strong>
  </pre>
<p>Combined with the built-in PHP web server for debugging, you can run test suites without a full-fledged environment.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running specific tests</h1>
                </header>
            
            <article>
                
<p>Each example so far has used the <kbd>all</kbd> option to run every <kbd>Simpletest</kbd> available. There are various ways to run specific tests:</p>
<ul>
<li><kbd>--module</kbd>: This allows you to run all the tests of a specific module</li>
<li><kbd>--class</kbd>: This runs a specific path, identified by a full namespace path</li>
<li><kbd>--file</kbd>: This runs tests from a specified file</li>
<li class="mce-root"><kbd>--directory</kbd><span>: This run tests within a specified directory</span></li>
</ul>
<div class="packt_infobox">Previously in Drupal, tests were grouped inside the <kbd>module.test</kbd> files, which is where the file option derives from. Drupal 8 utilizes the <kbd>PSR-4 autoloading</kbd> method and requires one class per file.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">PhpStorm - Drupal Test Runner</h1>
                </header>
            
            <article>
                
<p>Drupal 8 has seen a surge in test coverage for both Drupal core and contributed projects, most likely due to PHPUnit adoption. In response to this, the author has written a PhpStorm plugin called Drupal Test Runner that simplifies executing the <kbd>run-tests.sh</kbd> script runner.</p>
<p>The plugin's page can be found at <a href="https://plugins.jetbrains.com/plugin/8384-drupal-test-runner"><span class="URLPACKT">https://plugins.jetbrains.com/plugin/8384-drupal-test-runner</span></a>, and it's public source code can be found at <span class="URLPACKT"><a href="https://github.com/mglaman/intellij-drupal-run-tests">https://github.com/mglaman/intellij-drupal-run-tests</a>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">DrupalCI</h1>
                </header>
            
            <article>
                
<p>With Drupal 8 came a new initiative to upgrade the testing infrastructure on <span class="URLPACKT">Drupal.org</span>. The outcome was DrupalCI. DrupalCI is open source and can be downloaded and run locally. The project page for DrupalCI is <a href="https://www.drupal.org/project/drupalci"><span class="URLPACKT">https://www.drupal.org/project/drupalci</span></a>.</p>
<p>The test bot utilizes Docker and can be downloaded locally to run tests. The project ships with a Vagrant file that allows it to be run within a virtual machine or locally. Learn more on the testbot's project page at <a href="https://www.drupal.org/project/drupalci_testbot"><span class="URLPACKT">https://www.drupal.org/project/drupalci_testbot</span></a><span class="URLPACKT">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also...</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to the PHPUnit manual at <a href="https://phpunit.de/manual/4.8/en/writing-tests-for-phpunit.html"><span class="URLPACKT">https://phpunit.de/manual/4.8/en/writing-tests-for-phpunit.html</span></a>.</li>
<li><span>Refer to the</span> Drupal PHPUnit handbook at <a href="https://drupal.org/phpunit"><span class="URLPACKT">https://drupal.org/phpunit</span></a>.</li>
<li><span>Refer to</span> Running tests from the command line at <a href="https://www.drupal.org/node/645286"><span class="URLPACKT">https://www.drupal.org/node/645286</span></a>.</li>
</ul>
<ul>
<li><span>Refer to</span> Commerce 2.x: Unit, Kernel, and Functional Tests Oh My! Authors blog post and tutorial for running tests in Drupal 8 for Drupal Commerce at <a href="https://drupalcommerce.org/blog/45322/commerce-2x-unit-kernel-and-functional-tests-oh-my"><span class="URLPACKT">https://drupalcommerce.org/blog/45322/commerce-2x-unit-kernel-and-functional-tests-oh-my</span></a>.</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    </body></html>