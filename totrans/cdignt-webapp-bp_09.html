<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Creating a Job Board"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Creating a Job Board</h1></div></div></div><p>There are some quite complex job boards out there and some that are woefully designed. There are some that I can think of that <a id="id763" class="indexterm"/>simply don't work as you would think they should and some that don't function properly at all. I'm sure they all have a heap of VC funding and probably turn some sort of profit, so it is beyond me why they don't manage to get it together and make something that actually works; the thing is that it's not actually that difficult a thing to do.</p><p>The job board in this project is small and concise, but there is scope to expand upon—if you skip ahead to the <span class="emphasis"><em>Summary</em></span> section, you'll see some things you can add to make it more feature-rich, but I'm sure you have your own.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Design and wireframes</li><li class="listitem" style="list-style-type: disc">Creating the database</li><li class="listitem" style="list-style-type: disc">Creating the model</li><li class="listitem" style="list-style-type: disc">Creating views</li><li class="listitem" style="list-style-type: disc">Creating the controller</li><li class="listitem" style="list-style-type: disc">Putting it all together</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Introduction</h1></div></div></div><p>So what are we going to do for this project anyway? We'll create an application that allows users to create job adverts that will be displayed on a "board". Users can search for specific terms and some results will be returned.</p><p>Other users can create adverts that will be displayed in these boards.</p><p>To create this app, we will create<a id="id764" class="indexterm"/> one controller; this will handle the display of jobs, creation of new jobs, and applying for jobs.</p><p>We'll create a language file to store text, allowing you to have multiple language support should that be required.</p><p>We'll create all the necessary view files and a model to interface with the database.</p><p>However, this app along with all the others in this book relies on the basic setup we did in <a class="link" href="ch01.html" title="Chapter 1. Introduction and Shared Project Resources">Chapter 1</a>, <span class="emphasis"><em>Introduction and Shared Project Resources</em></span>; although you can take large sections of the code and drop it into pretty much any app you might already have, please keep in mind that the <a id="id765" class="indexterm"/>setup done in the first chapter acts as a foundation for this chapter.</p><p>So without further ado, let's get on with it.</p></div></div>
<div class="section" title="Design and wireframes"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Design and wireframes</h1></div></div></div><p>As always, before we start building, we should take a look at what we plan to build.</p><p>Firstly, a brief description<a id="id766" class="indexterm"/> of our intent: we plan to build an app that will allow people to browse job adverts in the form of a job board.</p><p>People will be able to create job<a id="id767" class="indexterm"/> adverts that will appear on search listings. Others will be allowed to apply for these advertised jobs, and applications are sent in an e-mail to the advertiser with details of the job and applicant.</p><p>Anyway, to get a better idea of what's happening, let's take a look at the following site map:</p><div class="mediaobject"><img src="graphics/7093OS_09_04.jpg" alt="Design and wireframes"/></div><p>So that was the site map; the first thing to notice is how simple the site is. There are only three main areas to this project. Let's go over each item<a id="id768" class="indexterm"/> and get a brief idea of what it does:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Jobs/Search</strong></span>: Imagine this as the start point. The user is presented with a list of active jobs available on<a id="id769" class="indexterm"/> the site. The user is able to view the job details and apply (taking them to point <span class="strong"><strong>2</strong></span> of the site map), or click on <span class="strong"><strong>Create</strong></span> on the navigation bar and go to point <span class="strong"><strong>3</strong></span> (the Create item) of the site map.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Detail/Apply</strong></span>: The user is <a id="id770" class="indexterm"/>presented with the details of the job advertised, such as the start date, location and the job description, and advertiser's contact details. There is also a form below the job details that allows a user to apply for the job. Details of the application are sent in an e-mail to the job advertiser (<code class="literal">jobs.job_advertiser_email</code>).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Create</strong></span>: This will display a form to <a id="id771" class="indexterm"/>the user, allowing them to create a job advert. Once that advert is created, it will be displayed in <a id="id772" class="indexterm"/>search listings.</li></ul></div><p>Now that we have a fairly good idea of the structure and form of the site, let's take a look at some wireframes of each page.</p><div class="section" title="Job/Search"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec76"/>Job/Search</h2></div></div></div><p>The following screenshot<a id="id773" class="indexterm"/> shows you a wireframe from point <span class="strong"><strong>1</strong></span> (the Create item) in the site map. Initially, the user is shown a<a id="id774" class="indexterm"/> list of current jobs. The job title and description are shown. The description is kept at a set length—that of the first 50 words of a job description. They are able to click on the job title or an <span class="strong"><strong>Apply</strong></span> link to go to point <span class="strong"><strong>2</strong></span> (the Detail/Apply item) of the site map.</p><div class="mediaobject"><img src="graphics/7093OS_09_01.jpg" alt="Job/Search"/></div></div><div class="section" title="Detail/Apply"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec77"/>Detail/Apply</h2></div></div></div><p>The following screenshot shows <a id="id775" class="indexterm"/>you a wireframe from point <span class="strong"><strong>2</strong></span> (the Detail/Apply item) in the site map. The user views the detailed description of the job advertised and a form that<a id="id776" class="indexterm"/> enables the user to enter their details and send off an application for the job—the details of this application are e-mailed to the job advertiser.</p><div class="mediaobject"><img src="graphics/7093OS_09_03.jpg" alt="Detail/Apply"/></div></div><div class="section" title="Create"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec78"/>Create</h2></div></div></div><p>The following screenshot<a id="id777" class="indexterm"/> shows you a wireframe from point <span class="strong"><strong>3</strong></span> (the Create item) of the site map. Any user <a id="id778" class="indexterm"/>can post a job advert. This displays a form to the user, allowing them to enter the details of their job advert and save it to the database.</p><div class="mediaobject"><img src="graphics/7093OS_09_02.jpg" alt="Create"/></div></div><div class="section" title="File overview"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec79"/>File overview</h2></div></div></div><p>This is a relatively small <a id="id779" class="indexterm"/>project, and all-in-all, we're only going to create seven files; these are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/models/jobs_model.php</code>: This provides read/write access to<a id="id780" class="indexterm"/> the <code class="literal">jobs</code> database table.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/jobs/apply.php</code>: This provides us an interface that<a id="id781" class="indexterm"/> allows the user to view a job advert's details and also a form that allows any user to apply for a job.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/jobs/create.php</code>: This displays a form to the user, allowing<a id="id782" class="indexterm"/> the user to create a job advert.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/jobs/view.php</code>: This is the view for the <code class="literal">jobs</code><a id="id783" class="indexterm"/> controller's <code class="literal">index()</code> function. It displays the search form and lists any results.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/nav/top_nav.php</code>: This provides a<a id="id784" class="indexterm"/> navigation bar at the top of the page.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/controllers/jobs.php</code>: This contains<a id="id785" class="indexterm"/> three main functions: <code class="literal">index()</code>, <code class="literal">apply()</code> and <code class="literal">create()</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/language/english/en_admin_lang.php</code>: This provides language <a id="id786" class="indexterm"/>support for the application.</li></ul></div><p>The file structure of the preceding seven files is as follows:</p><div class="informalexample"><pre class="programlisting">application/
├── controllers/
│   ├── jobs.php
├── models/
│   ├── jobs_model.php
├── views/create/
│   ├── create.php
│   ├── apply.php
│   ├── view.php
├── views/nav/
│   ├── top_nav.php
├── language/english/
│   ├── en_admin_lang.php</pre></div></div></div>
<div class="section" title="Creating the database"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec96"/>Creating the database</h1></div></div></div><p>Okay, you should have already set up CodeIgniter and Bootstrap as described in <a class="link" href="ch01.html" title="Chapter 1. Introduction and Shared Project Resources">Chapter 1</a>, <span class="emphasis"><em>Introduction and Shared Project Resources</em></span>; if not, then you should know that the code in this chapter is specifically built with<a id="id787" class="indexterm"/> the setup from <a class="link" href="ch01.html" title="Chapter 1. Introduction and Shared Project Resources">Chapter 1</a>, <span class="emphasis"><em>Introduction and Shared Project Resources</em></span>, in mind. However, it's not the end of the world if <a id="id788" class="indexterm"/>you haven't—the code can easily be applied to other situations.</p><p>First, we'll build the database. Copy the following MySQL code to your database:</p><div class="informalexample"><pre class="programlisting">CREATE DATABASE `jobboarddb`;
USE `jobboarddb`;

DROP TABLE IF EXISTS `categories`;
CREATE TABLE `categories` (
  `cat_id` int(11) NOT NULL AUTO_INCREMENT,
  `cat_name` varchar(25) NOT NULL,
  PRIMARY KEY (`cat_id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

INSERT INTO `categories` VALUES (1,'IT'),(2,'Legal'),(3,'Management'),(4,'Purchasing');

DROP TABLE IF EXISTS `ci_sessions`;
CREATE TABLE `ci_sessions` (
  `session_id` varchar(40) COLLATE utf8_bin NOT NULL DEFAULT '0',
  `ip_address` varchar(16) COLLATE utf8_bin NOT NULL DEFAULT '0',
  `user_agent` varchar(120) COLLATE utf8_bin DEFAULT NULL,
  `last_activity` int(10) unsigned NOT NULL DEFAULT '0',
  `user_data` text COLLATE utf8_bin NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `job_id` int(11) NOT NULL AUTO_INCREMENT,
  `job_title` varchar(50) NOT NULL,
  `job_desc` text NOT NULL,
  `cat_id` int(11) NOT NULL,
  `type_id` int(11) NOT NULL,
  `loc_id` int(11) NOT NULL,
  `job_start_date` datetime NOT NULL,
  `job_rate` int(5) NOT NULL,
  `job_advertiser_name` varchar(50) NOT NULL,
  `job_advertiser_email` varchar(50) NOT NULL,
  `job_advertiser_phone` varchar(20) NOT NULL,
  `job_sunset_date` datetime NOT NULL,
  `job_created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`job_id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;

INSERT INTO `jobs` VALUES (1,'PHP Developer','PHP Developer required for a large agency based in London.  Must have MVC experience\n',1,1,1,'2014-09-24 00:00:00',400,'Rob Foster','rob@bluesuncreative.com','01234123456','2015-09-26 00:00:00','2014-09-17 09:00:18'),(2,'CodeIgniter Developer','Small London agency urgently requires a CodeIgniter developer to work on small eCommerce project.',1,1,1,'0000-00-00 00:00:00',350,'Lucy','lucy@londonagencycomain.com','01234123456','2015-09-26 00:00:00','2014-09-17 11:22:19'),(3,'Flash Developer','Paris based agency requires Flash Developer to work on new built project',1,1,2,'0000-00-00 00:00:00',350,'Brian','brian@frenchdesignagenct.fr','01234123456','2015-09-26 00:00:00','2014-09-17 11:23:39');

DROP TABLE IF EXISTS `locations`;

CREATE TABLE `locations` (
  `loc_id` int(11) NOT NULL AUTO_INCREMENT,
  `loc_name` varchar(25) NOT NULL,
  PRIMARY KEY (`loc_id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

INSERT INTO `locations` VALUES (1,'England'),(2,'France'),(3,'Germany'),(4,'Spain');

DROP TABLE IF EXISTS `types`;
CREATE TABLE `types` (
  `type_id` int(11) NOT NULL AUTO_INCREMENT,
  `type_name` varchar(25) NOT NULL,
  PRIMARY KEY (`type_id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;

INSERT INTO `types` VALUES (1,'Contract'),(2,'Full Time'),(3,'Part Time');</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip14"/>Tip</h3><p>Now, take a look at that last bit of SQL code, it's quite big and fiddly. Don't panic, all SQL code is available online from this book's support page on the Packt website.</p></div></div><p>You'll see that the first table we create is <code class="literal">ci_sessions</code>. We need this to allow CodeIgniter to manage sessions, specifically, logged-in users. However, this is just the standard session table<a id="id789" class="indexterm"/> available from <span class="emphasis"><em>CodeIgniter User Guide</em></span>, so I'll not include a description of that table as it's not technically specific to this application. However, if you're interested, there's a description at <a class="ulink" href="http://ellislab.com/codeigniter/user-guide/libraries/sessions.html">http://ellislab.com/codeigniter/user-guide/libraries/sessions.html</a>.</p><p>Right, let's take a look at each item in each table, and see what it means. First, we will take a look at the <code class="literal">categories</code> table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th colspan="2" style="text-align: center" valign="bottom">
<p>Table: categories</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Element</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Description</strong></span>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cat_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id790" class="indexterm"/> the primary key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cat_name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This stores<a id="id791" class="indexterm"/> the name of the category.</p>
</td></tr></tbody></table></div><p>Next up, we will see the <code class="literal">types</code> table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th colspan="2" style="text-align: center" valign="bottom">
<p>Table: types</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Element</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Description</strong></span>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">type_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id792" class="indexterm"/> the primary key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">type_name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This stores the<a id="id793" class="indexterm"/> name of the type.</p>
</td></tr></tbody></table></div><p>Now, let's see the <code class="literal">locations</code> table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th colspan="2" style="text-align: center" valign="bottom">
<p>Table: locations</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Element</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Description</strong></span>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">loc_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id794" class="indexterm"/> the primary key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">loc_name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This stores<a id="id795" class="indexterm"/> the name of the location.</p>
</td></tr></tbody></table></div><p>Finally, we will see the <code class="literal">jobs</code> table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th colspan="2" style="text-align: center" valign="bottom">
<p>Table: jobs</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Element</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Description</strong></span>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id796" class="indexterm"/> the primary key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_title</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id797" class="indexterm"/> title of the position advertised.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_desc</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id798" class="indexterm"/> general job specification for the position advertised.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cat_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id799" class="indexterm"/> foreign key from the <code class="literal">categories</code> table, indicating the category of the position—IT, Management, Manufacturing, Health Care, and so on</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">type_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id800" class="indexterm"/>foreign key from the <code class="literal">types</code> table, indicating the type of the position—full time, part time, contract, and so on</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">loc_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id801" class="indexterm"/> foreign key from the <code class="literal">locations</code> table, indicating the location that the position is to be based in.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_start_date</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id802" class="indexterm"/> starting date of the position advertised.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_rate</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id803" class="indexterm"/> the money offered (remuneration)—salary, day rate, and so on.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_advertiser_name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the name<a id="id804" class="indexterm"/> of the person advertising the position so that the applicant knows who to contact to chase their application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_advertiser_email</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the contact<a id="id805" class="indexterm"/> e-mail of the person who is advertising the position. It is to this e-mail address that an application is sent. The application is sent when a user fills in and submits the form in <code class="literal">views/jobs/apply.php</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_advertiser_phone</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id806" class="indexterm"/>phone number of the person advertising the position. This is included if the applicant wishes to call the job advertiser. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_sunset_date</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the date<a id="id807" class="indexterm"/> at which the job will no longer be displayed in searches. This is required as jobs will not be advertised forever and applying a date that limits the time jobs can be applied for prevents people from applying for jobs that have either been filled or no longer exist.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">job_created_at</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the MySQL<a id="id808" class="indexterm"/> timestamp that's applied when a new record is added to the database.</p>
</td></tr></tbody></table></div><p>We'll also need to make amends to the <code class="literal">config/database.php</code> file, namely setting the database access details, username<a id="id809" class="indexterm"/> password and so on.</p><p>Open the <code class="literal">config/database.php</code> file and find the following lines:</p><div class="informalexample"><pre class="programlisting">$db['default']['hostname'] = 'localhost';
$db['default']['username'] = 'your username';
$db['default']['password'] = 'your password';
$db['default']['database'] = 'jobboarddb';</pre></div><p>Edit the values in the preceding lines, ensuring you substitute these values with ones more specific to your setup and situation; so, enter your username, password, and so on.</p></div>
<div class="section" title="Adjusting the config.php file"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec97"/>Adjusting the config.php file</h1></div></div></div><p>There are a few things in this file<a id="id810" class="indexterm"/> that we'll need to configure to support sessions and encryption. So, open the <code class="literal">config/config.php</code> file and make the<a id="id811" class="indexterm"/> following changes.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will need to set an encryption key; both sessions and CodeIgniter's encryption functionality require an encryption key to be set in the <code class="literal">$config</code> array, so find the following line:<div class="informalexample"><pre class="programlisting">$config['encryption_key'] = '';</pre></div><p>Change it to the following:</p><div class="informalexample"><pre class="programlisting">$config['encryption_key'] = 'a-random-string-of-alphanum-characters';</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip15"/>Tip</h3><p>Now obviously, don't actually change this value to literally a-random-string-of-alphanum-characters but change it to, er, a random string of alphanum characters instead—if that makes sense? Yeah, you know what I mean.</p></div></div></li><li class="listitem">Find these lines:<div class="informalexample"><pre class="programlisting">$config['sess_cookie_name'] = 'ci_session';
$config['sess_expiration'] = 7200;
$config['sess_expire_on_close'] = FALSE;
$config['sess_encrypt_cookie'] = FALSE;
$config['sess_use_database'] = FALSE;
$config['sess_table_name'] = 'ci_sessions';
$config['sess_match_ip'] = FALSE;
$config['sess_match_useragent'] = TRUE;
$config['sess_time_to_update'] = 300;</pre></div><p>Change them to the following:</p><div class="informalexample"><pre class="programlisting">$config['sess_cookie_name'] = 'ci_session';
$config['sess_expiration'] = 7200;
$config['sess_expire_on_close'] = TRUE;
$config['sess_encrypt_cookie'] = TRUE;
$config['sess_use_database'] = TRUE;
$config['sess_table_name'] = 'ci_sessions';
$config['sess_match_ip'] = TRUE;
$config['sess_match_useragent'] = TRUE;
$config['sess_time_to_update'] = 300;</pre></div></li></ol></div></div>
<div class="section" title="Adjusting the routes.php file"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec98"/>Adjusting the routes.php file</h1></div></div></div><p>We want to redirect the user to the <code class="literal">jobs</code> controller rather than the default CodeIgniter <code class="literal">welcome</code> controller. To <a id="id812" class="indexterm"/>do this, we will need to amend the default <a id="id813" class="indexterm"/>controller setting in the <code class="literal">routes.php</code> file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">config/routes.php</code> file for editing and find the following lines (near the bottom of the file):<div class="informalexample"><pre class="programlisting">$route['default_controller'] = "welcome";
$route['404_override'] = '';</pre></div></li><li class="listitem">First, we need to change the default controller. Initially in a CodeIgniter application, the default controller is set to <code class="literal">welcome</code>; however, we don't need this—instead, we want the default controller to be <code class="literal">jobs</code>. So, find the following line:<div class="informalexample"><pre class="programlisting">$route['default_controller'] = "welcome";</pre></div><p>Replace it with the following:</p><div class="informalexample"><pre class="programlisting">$route['default_controller'] = "jobs";
$route['404_override'] = '';</pre></div></li></ol></div></div>
<div class="section" title="Creating the model"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec99"/>Creating the model</h1></div></div></div><p>There is only one <a id="id814" class="indexterm"/>model in this project—<code class="literal">jobs_model.php</code>— that contains functions that are specific to searching and <a id="id815" class="indexterm"/>writing job adverts to the database.</p><p>This is our one and only model for this project, so let's create the model and discuss how it functions.</p><p>Create the <code class="literal">/path/to/codeigniter/application/models/jobs_model.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Jobs_model extends CI_Model {
  function __construct() {
    parent::__construct();
  }

  function get_jobs($search_string) {
    if ($search_string == null) {
      $query = "SELECT * FROM `jobs` WHERE DATE(NOW()) &lt; DATE(`job_sunset_date`) ";
    } else {
      $query = "SELECT * FROM `jobs` WHERE `job_title` LIKE '%$search_string%' 
                OR `job_desc` LIKE '%$search_string%' AND DATE(NOW()) &lt; DATE(`job_sunset_date`)";
    }

    $result = $this-&gt;db-&gt;query($query);
    if ($result) {
      return $result;
    } else {
      return false;
    }
  }

  function get_job($job_id) {
    $query = "SELECT * FROM `jobs`, `categories`, `types`, `locations` WHERE 
              `categories`.`cat_id` = `jobs`.`cat_id` AND
              `types`.`type_id` = `jobs`.`type_id` AND
              `locations`.`loc_id` = `jobs`.`loc_id` AND
              `job_id` = ? AND
              DATE(NOW()) &lt; DATE(`job_sunset_date`) ";

    $result = $this-&gt;db-&gt;query($query, array($job_id));
    if ($result) {
      return $result;
    } else {
      return flase;
    }
  } 

  function save_job($save_data) {
    if ($this-&gt;db-&gt;insert('jobs', $save_data)) {
      return $this-&gt;db-&gt;insert_id();
    } else {
      return false;
    }
  }

  function get_categories() {
    return $this-&gt;db-&gt;get('categories');
  }

  function get_types() {
    return $this-&gt;db-&gt;get('types');
  }

  function get_locations() {
    return $this-&gt;db-&gt;get('locations');
  }
}</pre></div><p>There are six main functions in this model, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">get_jobs()</code>: This serves two<a id="id816" class="indexterm"/> functions: firstly, displaying all jobs—for example, when a user first visits the site—and secondly, when a user<a id="id817" class="indexterm"/> enters a search term, the query is then changed to look for the specific search term in <code class="literal">job_title</code> and <code class="literal">job_desc</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">get_job()</code>: This fetches the <a id="id818" class="indexterm"/>details of a specific job advert for point <span class="strong"><strong>2</strong></span> (the Details/Apply item) of the site map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">save_job()</code>: This saves a job <a id="id819" class="indexterm"/>advert to the database when a user submits the form from point <span class="strong"><strong>3</strong></span> (the Create item) of the site map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">get_categories()</code>: This fetches<a id="id820" class="indexterm"/> categories from the <code class="literal">categories</code> table. It is used to populate the categories dropdown for the create process.</li><li class="listitem" style="list-style-type: disc"><code class="literal">get_types()</code>: This fetches<a id="id821" class="indexterm"/> types from the <code class="literal">types</code> table. It is used to populate the types dropdown for the create process.</li><li class="listitem" style="list-style-type: disc"><code class="literal">get_locations()</code>: This fetches<a id="id822" class="indexterm"/> locations from the <code class="literal">locations</code> table. It is used to populate the locations dropdown for the create process.</li></ul></div><p>Taking the <code class="literal">get_jobs()</code> function first, as mentioned, this function has two purposes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To return all results, that is, to list all jobs</li><li class="listitem" style="list-style-type: disc">To return results (jobs) that match a user's search</li></ul></div><p>When a user visits the site, they are routed to <code class="literal">jobs/index</code>. This will cause the <code class="literal">get_jobs()</code> model function to search the database. On this initial visit, the <code class="literal">$search_string</code> variable will be empty (as the user isn't searching for anything). This will cause the first part of the <code class="literal">if</code> statement to be run, basically returning every valid job.</p><p>However, if the user is searching for something, then the <code class="literal">$search_string</code> variable will not be empty; it will contain the search term the user entered in the <code class="literal">views/jobs/view.php</code> form.</p><p>This will cause the second part of the <code class="literal">if</code> statement to run, adding <code class="literal">$search_term</code> to the database query:</p><div class="informalexample"><pre class="programlisting">function get_jobs($search_string) {
  if ($search_string == null) {
    $query = "SELECT * FROM `jobs` WHERE DATE(NOW()) &lt; DATE(`job_sunset_date`) ";
  } else {
    $query = "SELECT * FROM `jobs` WHERE `job_title` LIKE '%$search_string%' 
              OR `job_desc` LIKE '%$search_string%' AND DATE(NOW()) &lt; DATE(`job_sunset_date`)";
  }

  $result = $this-&gt;db-&gt;query($query);
  if ($result) {
    return $result;
  } else {
    return false;
  }
}</pre></div><p>Both queries will only return results whose sunset date has not passed. The <code class="literal">jobboarddb.job_sunset_date</code> field contains <a id="id823" class="indexterm"/>a date on which the job advert will stop being displayed in search terms.</p><p>Next, we'll look at the <code class="literal">get_job()</code> function. This function is passed the <code class="literal">$job_id</code> value from the <code class="literal">jobs</code> controller. The <code class="literal">jobs</code> controller gets the ID of the job advert from <code class="literal">$this-&gt;uri-&gt;segment(3)</code> when the user clicks on the <span class="strong"><strong>Apply</strong></span> link in <code class="literal">views/jobs/view.php</code>.</p><p>The <code class="literal">get_job()</code> function simply returns all the data for point <span class="strong"><strong>2</strong></span> (the Details/Apply item) of the site map.</p><p>It joins the <code class="literal">categories</code>, <code class="literal">types</code>, and <code class="literal">locations</code> tables to the <code class="literal">jobs</code> table in order to ensure that the correct category, type, and location is displayed in the <code class="literal">views/jobs/apply.php</code> view along with the specific job advert details.</p><p>We then move down to<a id="id824" class="indexterm"/> the <code class="literal">save_job()</code> function. This accepts an array of data from the <code class="literal">jobs</code> controller. The <code class="literal">jobs</code> controller's <code class="literal">create()</code> function sends the <code class="literal">$save_data</code> array to the <code class="literal">save_job()</code> model function. The <code class="literal">$save_data</code> array contains the input from the form in the <code class="literal">views/jobs/create.php</code> view file.</p><p>On a successful save, the primary key of the insert is returned.</p><p>Now we will cover the three functions—<code class="literal">_categories()</code>, <code class="literal">get_types()</code> and <code class="literal">get_locations()</code>—at the same time (as they do pretty similar things). These three functions fetch all categories, types, and locations from their respective tables. These functions are called by the <code class="literal">jobs</code> controller's <code class="literal">create()</code> function to ensure that the dropdowns are populated with the correct data.</p></div>
<div class="section" title="Creating views"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec100"/>Creating views</h1></div></div></div><p>There are four <a id="id825" class="indexterm"/>views in this project, and<a id="id826" class="indexterm"/> these are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/jobs/view.php</code>: This displays a list of current jobs<a id="id827" class="indexterm"/> to the user.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/jobs/create.php</code>: This view allows the job advertiser to enter the job advert details. The form submits to the <code class="literal">jobs</code> controller's <code class="literal">create()</code> function.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/jobs/apply.php</code>: This displays a form to the user allowing them to enter information to apply for the job. It also displays validation errors.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/nav/top_nav.php</code>: This displays the top-level menu. In this project, this is very simple as it contains a project name and<a id="id828" class="indexterm"/> link to go to the <code class="literal">jobs</code> controller.</li></ul></div><p>These are our four view files. Now, let's go<a id="id829" class="indexterm"/> over each one, build the code, and discuss how it functions.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/jobs/view.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;div class="page-header"&gt;
  &lt;h1&gt;
    &lt;?php echo form_open('jobs/index') ; ?&gt;
      &lt;div class="row"&gt;
        &lt;div class="col-lg-12"&gt;
          &lt;div class="input-group"&gt;
            &lt;input type="text" class="form-control" name="search_string" placeholder="&lt;?php echo $this-&gt;lang-&gt;line('jobs_view_search'); ?&gt;"&gt;
            &lt;span class="input-group-btn"&gt;
              &lt;button class="btn btn-default" type="submit"&gt;&lt;?php echo $this-&gt;lang-&gt;line('jobs_view_search'); ?&gt;&lt;/button&gt;
            &lt;/span&gt;
          &lt;/div&gt;&lt;!-- /input-group --&gt;
        &lt;/div&gt;&lt;!-- /.col-lg-6 --&gt;
      &lt;/div&gt;&lt;!-- /.row --&gt;
    &lt;?php echo form_close() ; ?&gt;
  &lt;/h1&gt;
&lt;/div&gt;

&lt;table class="table table-hover"&gt;
  &lt;?php foreach ($query-&gt;result() as $row) : ?&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;?php echo anchor ('jobs/apply/'.$row-&gt;job_id, $row-&gt;job_title) ; ?&gt;&lt;br /&gt;&lt;?php echo word_limiter($row-&gt;job_desc, 50) ; ?&gt;
    &lt;/td&gt;
    &lt;td&gt;Posten on &lt;?php echo $row-&gt;job_created_at ; ?&gt;&lt;br /&gt;Rate is &amp;pound;&lt;?php echo $row-&gt;job_rate ; ?&gt;
    &lt;/td&gt;
    &lt;td&gt;&lt;?php echo anchor ('jobs/apply/'.$row-&gt;job_id, $this-&gt;lang-&gt;line('jobs_view_apply')) ; ?&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;?php endforeach ; ?&gt;
&lt;/table&gt;</pre></div><p>This view serves two<a id="id830" class="indexterm"/> functions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To display a simple search form at the top of the page. This is where a user can search for jobs that match a search term.</li><li class="listitem" style="list-style-type: disc">To display a list of jobs in an HTML table. These are the current active jobs in the database. A job is considered active if the job's sunset date (<code class="literal">jobs.job_sunset_date</code>) has not passed.</li></ul></div><p>The search form is submitted to the <code class="literal">jobs</code> controller's <code class="literal">index()</code> function—this controller function will pass the search term to the <code class="literal">get_jobs($search_term)</code> function of <code class="literal">Jobs_model</code>. It will be added to the database query; this query will look in <code class="literal">jobs.job_title</code> and <code class="literal">jobs.job_desc</code> for text that matches the term.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/jobs/create.php</code> file and add the following <a id="id831" class="indexterm"/>code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if ($this-&gt;session-&gt;flashdata('flash_message')) : ?&gt;
  &lt;div class="alert alert-info" role="alert"&gt;&lt;?php echo $this-&gt;session-&gt;flashdata('flash_message');?&gt;&lt;/div&gt;
 &lt;?php endif ; ?&gt;

  &lt;p class="lead"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_create_form_instruction_1');?&gt;&lt;/p&gt;
  &lt;div class="span8"&gt; 
  &lt;?php echo form_open('jobs/create','role="form" class="form"') ; ?&gt;
    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('job_title'); ?&gt;
      &lt;label for="job_title"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_title');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($job_title); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('job_desc'); ?&gt;
      &lt;label for="job_desc"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_desc');?&gt;&lt;/label&gt;
      &lt;?php echo form_textarea($job_desc); ?&gt;
    &lt;/div&gt;</pre></div><p>The type dropdown is populated by the <code class="literal">get_types()</code> function in <code class="literal">Jobs_model</code>. It returns a result object that we loop over, allowing the user to select the type:</p><div class="informalexample"><pre class="programlisting">&lt;div class="form-group"&gt;
  &lt;?php echo form_error('type_id'); ?&gt;
  &lt;label for="type_id"&gt;&lt;?php echo $this-&gt;lang-&gt;line('type');?&gt;&lt;/label&gt;
  &lt;select name="type_id" class="form-control"&gt;
  &lt;?php foreach ($types-&gt;result() as $row) : ?&gt;
    &lt;option value="&lt;?php echo $row-&gt;type_id ; ?&gt;"&gt;&lt;?php echo $row-&gt;type_name ; ?&gt;&lt;/option&gt;
  &lt;?php endforeach ; ?&gt;
  &lt;/select&gt;
&lt;/div&gt;</pre></div><p>The category dropdown is populated by the <code class="literal">get_categories()</code> function in <code class="literal">Jobs_model</code>. It returns a<a id="id832" class="indexterm"/> result object that we loop over, allowing the user to select the category:</p><div class="informalexample"><pre class="programlisting">&lt;div class="form-group"&gt;
  &lt;?php echo form_error('cat_id'); ?&gt;
  &lt;label for="cat_id"&gt;&lt;?php echo $this-&gt;lang-&gt;line('cat');?&gt;&lt;/label&gt;
  &lt;select name="cat_id" class="form-control"&gt;
  &lt;?php foreach ($categories-&gt;result() as $row) : ?&gt;
    &lt;option value="&lt;?php echo $row-&gt;cat_id ; ?&gt;"&gt;&lt;?php echo $row-&gt;cat_name ; ?&gt;&lt;/option&gt;
  &lt;?php endforeach ; ?&gt;
  &lt;/select&gt;
&lt;/div&gt;</pre></div><p>The location dropdown is populated by the <code class="literal">get_locations()</code> function in <code class="literal">Jobs_model</code>. It returns a result object that we loop over, allowing the user to select the location:</p><div class="informalexample"><pre class="programlisting">    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('loc_id'); ?&gt;
      &lt;label for="loc_id"&gt;&lt;?php echo $this-&gt;lang-&gt;line('loc');?&gt;&lt;/label&gt;
      &lt;select name="loc_id" class="form-control"&gt;
      &lt;?php foreach ($locations-&gt;result() as $row) : ?&gt;
        &lt;option value="&lt;?php echo $row-&gt;loc_id ; ?&gt;"&gt;&lt;?php echo $row-&gt;loc_name ; ?&gt;&lt;/option&gt;
      &lt;?php endforeach ; ?&gt;
      &lt;/select&gt;
    &lt;/div&gt;
    &lt;label for="sunset_d"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_start_date');?&gt;&lt;/label&gt;
    &lt;div class="row"&gt;
      &lt;div class="form-group"&gt;
        &lt;div class="col-md-2"&gt;
          &lt;?php echo form_error('startd'); ?&gt;
          &lt;select name="startd" class="form-control"&gt;
          &lt;?php for ( $i = 1; $i &lt;= 30; $i++) : ?&gt;
            &lt;?php if (date('j', time()) == $i) : ?&gt; 
              &lt;option selected value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('jS', mktime($i,0,0,0, $i, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php else : ?&gt;
              &lt;option value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('jS', mktime($i,0,0,0, $i, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php endif ; ?&gt;
          &lt;?php endfor ; ?&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        &lt;div class="col-md-2"&gt;
          &lt;?php echo form_error('startm'); ?&gt;
          &lt;select name="startm" class="form-control"&gt;
          &lt;?php for ( $i = 1; $i &lt;= 12; $i++) : ?&gt;
            &lt;?php if (date('m', time()) == $i) : ?&gt; 
              &lt;option selected value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('F', mktime(0,0,0,$i, 1, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php else : ?&gt;
              &lt;option value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('F', mktime(0,0,0,$i, 1, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php endif ; ?&gt;
          &lt;?php endfor ; ?&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        &lt;div class="col-md-2"&gt;
          &lt;?php echo form_error('starty'); ?&gt;
          &lt;select name="starty" class="form-control"&gt;
          &lt;?php for ($i = date("Y",strtotime(date("Y"))); $i &lt;= date("Y",strtotime(date("Y").' +3 year')); $i++) : ?&gt;
            &lt;option value="&lt;?php echo $i;?&gt;"&gt;&lt;?php echo $i;?&gt;&lt;/option&gt;
          &lt;?php endfor ; ?&gt;
          &lt;/select&gt;
        &lt;/div&gt; 
      &lt;/div&gt;
    &lt;/div&gt; 

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('job_rate'); ?&gt;
      &lt;label for="job_rate"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_rate');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($job_rate); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('job_advertiser_name'); ?&gt;
      &lt;label for="job_advertiser_name"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_advertiser_name');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($job_advertiser_name); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('job_advertiser_email'); ?&gt;
      &lt;label for="job_advertiser_email"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_advertiser_email');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($job_advertiser_email); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('job_advertiser_phone'); ?&gt;
      &lt;label for="job_advertiser_phone"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_advertiser_phone');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($job_advertiser_phone); ?&gt;
    &lt;/div&gt;

    &lt;label for="sunset_d"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_sunset_date');?&gt;&lt;/label&gt;
    &lt;div class="row"&gt;
      &lt;div class="form-group"&gt;
        &lt;div class="col-md-2"&gt;
          &lt;?php echo form_error('sunset_d'); ?&gt;
          &lt;select name="sunset_d" class="form-control"&gt;
          &lt;?php for ( $i = 1; $i &lt;= 30; $i++) : ?&gt;
            &lt;?php if (date('j', time()) == $i) : ?&gt; 
              &lt;option selected value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('jS', mktime($i,0,0,0, $i, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php else : ?&gt;
              &lt;option value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('jS', mktime($i,0,0,0, $i, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php endif ; ?&gt;
          &lt;?php endfor ; ?&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        &lt;div class="col-md-2"&gt; 
          &lt;?php echo form_error('sunset_m'); ?&gt;
          &lt;select name="sunset_m" class="form-control"&gt;
          &lt;?php for ( $i = 1; $i &lt;= 12; $i++) : ?&gt;
            &lt;?php if (date('m', time()) == $i) : ?&gt; 
              &lt;option selected value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('F', mktime(0,0,0,$i, 1, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php else : ?&gt;
              &lt;option value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('F', mktime(0,0,0,$i, 1, date('Y'))) ; ?&gt;&lt;/option&gt;
            &lt;?php endif ; ?&gt;
          &lt;?php endfor ; ?&gt;
          &lt;/select&gt;
        &lt;/div&gt;

        &lt;div class="col-md-2"&gt;
          &lt;?php echo form_error('sunset_y'); ?&gt;
          &lt;select name="sunset_y" class="form-control"&gt;
          &lt;?php for ($i = date("Y",strtotime(date("Y"))); $i &lt;= date("Y",strtotime(date("Y").' +3 year')); $i++) : ?&gt;
            &lt;option value="&lt;?php echo $i;?&gt;"&gt;&lt;?php echo $i;?&gt;&lt;/option&gt;
          &lt;?php endfor ; ?&gt;
          &lt;/select&gt;
        &lt;/div&gt; 
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;span class="help-block"&gt;&lt;?php echo $this-&gt;lang-&gt;line('job_sunset_date_help') ; ?&gt;&lt;/div&gt;
    &lt;div class="form-group"&gt;
      &lt;button type="submit" class="btn btn-success"&gt;&lt;?php echo $this-&gt;lang-&gt;line('common_form_elements_go');?&gt;&lt;/button&gt;  or &lt;? echo anchor('jobs',$this-&gt;lang-&gt;line('common_form_elements_cancel'));?&gt;
    &lt;/div&gt;
&lt;?php echo form_close() ; ?&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div><p>Any error messages related to the validation process—such as a missing form field that's required—are also displayed in this view file next to the form field, triggering an error. To do this, we use the <code class="literal">form_error()</code> CodeIgniter validation function.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/jobs/apply.php</code> file and add the following<a id="id833" class="indexterm"/> code to it:</p><div class="informalexample"><pre class="programlisting">  &lt;?php if ($this-&gt;session-&gt;flashdata('flash_message')) : ?&gt;
    &lt;div class="alert alert-info" role="alert"&gt;&lt;?php echo $this-&gt;session-&gt;flashdata('flash_message');?&gt;&lt;/div&gt;
  &lt;?php endif ; ?&gt;

  &lt;div class="row"&gt;
    &lt;div class="col-sm-12 blog-main"&gt;
      &lt;div class="blog-post"&gt;
        &lt;?php foreach ($query-&gt;result() as $row) : ?&gt;
          &lt;h2 class="blog-post-title"&gt;&lt;?php echo $row-&gt;job_title ; ?&gt;&lt;/h2&gt;
          &lt;p class="blog-post-meta"&gt;Posted by &lt;?php echo $row-&gt;job_advertiser_name . ' on ' . $row-&gt;job_created_at ; ?&gt;&lt;/p&gt; 
          &lt;table class="table"&gt;
            &lt;tr&gt;
              &lt;td&gt;Start Date
              &lt;/td&gt;
              &lt;td&gt;&lt;?php echo $row-&gt;job_start_date ; ?&gt;
              &lt;/td&gt;
              &lt;td&gt;Contact Name
              &lt;/td&gt;
              &lt;td&gt;&lt;?php echo $row-&gt;job_advertiser_name ; ?&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
              &lt;td&gt;Location
              &lt;/td&gt;
              &lt;td&gt;&lt;?php echo $row-&gt;loc_name ; ?&gt;
              &lt;/td&gt;
              &lt;td&gt;Contact Phone
              &lt;/td&gt;
              &lt;td&gt;&lt;?php echo $row-&gt;job_advertiser_phone ; ?&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
              &lt;td&gt;Type
              &lt;/td&gt;
              &lt;td&gt;&lt;?php echo $row-&gt;type_name ; ?&gt;
              &lt;/td&gt;
              &lt;td&gt;Contact Email
              &lt;/td&gt;
              &lt;td&gt;&lt;?php echo $row-&gt;job_advertiser_email ; ?&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
          &lt;/table&gt;
          &lt;p&gt;&lt;?php echo $row-&gt;job_desc ; ?&gt;&lt;/p&gt;
        &lt;?php endforeach ; ?&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;p class="lead"&gt;&lt;?php echo $this-&gt;lang-&gt;line('apply_instruction_1') . $job_title ;?&gt;&lt;/p&gt;
  &lt;div class="span12"&gt; 
  &lt;?php echo form_open('jobs/apply','role="form" class="form"') ; ?&gt;
    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('app_name'); ?&gt;
      &lt;label for="app_name"&gt;&lt;?php echo $this-&gt;lang-&gt;line('app_name');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($app_name); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('app_email'); ?&gt;
      &lt;label for="app_email"&gt;&lt;?php echo $this-&gt;lang-&gt;line('app_email');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($app_email); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('app_phone'); ?&gt;
      &lt;label for="app_phone"&gt;&lt;?php echo $this-&gt;lang-&gt;line('app_phone');?&gt;&lt;/label&gt;
      &lt;?php echo form_input($app_phone); ?&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;?php echo form_error('app_cover_note'); ?&gt;
      &lt;label for="app_cover_note"&gt;&lt;?php echo $this-&gt;lang-&gt;line('app_cover_note');?&gt;&lt;/label&gt;
      &lt;?php echo form_textarea($app_cover_note); ?&gt;
    &lt;/div&gt;

    &lt;input type="hidden" name="job_id" value="&lt;?php echo $this-&gt;uri-&gt;segment(3) ; ?&gt;" /&gt;

    &lt;div class="form-group"&gt;
      &lt;button type="submit" class="btn btn-success"&gt;&lt;?php echo $this-&gt;lang-&gt;line('common_form_elements_go');?&gt;&lt;/button&gt;  or &lt;? echo anchor('jobs',$this-&gt;lang-&gt;line('common_form_elements_cancel'));?&gt;
    &lt;/div&gt;
  &lt;?php echo form_close() ; ?&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div><p>Take a look at the top of the view file, specifically, the code in the <code class="literal">foreach($query-&gt;result() as $row)</code> loop that displays the details of the job. It is arranged as an HTML table, clearly separating<a id="id834" class="indexterm"/> the main points of the job advert, such as the start date, job location, and contact details. The only thing that's not in the table is the job description.</p><p>Below the <code class="literal">foreach()</code> loop is an HTML form that allows the user to enter their contact details and a small cover note explaining their interest in the role. The form is submitted when the user clicks on <span class="strong"><strong>Go</strong></span>.</p><p>There is a hidden field element called <code class="literal">job_id</code>, and it looks like this:</p><div class="informalexample"><pre class="programlisting">&lt;input type="hidden" name="job_id" value="&lt;?php echo $this-&gt;uri-&gt;segment(3) ; ?&gt;" /&gt;</pre></div><p>This hidden field that's populated with the ID of the job advert ensures that when the form is submitted, the <code class="literal">jobs/apply()</code> function can query the database with the correct ID and fetch the correct e-mail address (<code class="literal">jobs.job_advertiser_email</code>) associated with the job, and using PHP's <code class="literal">mail()</code> function, it will send an e-mail to the job advertiser with the applicants details.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/nav/top_nav.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">    &lt;!-- Fixed navbar --&gt;
&lt;div class="navbar navbar-inverse navbar-fixed-top" role="navigation"&gt;
  &lt;div class="container"&gt;
    &lt;div class="navbar-header"&gt;
      &lt;button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"&gt;
        &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
      &lt;/button&gt;
      &lt;a class="navbar-brand" href="&lt;?php echo base_url() ; ?&gt;"&gt;&lt;?php echo $this-&gt;lang-&gt;line('system_system_name'); ?&gt;&lt;/a&gt;
    &lt;/div&gt;
    &lt;div class="navbar-collapse collapse"&gt;
      &lt;ul class="nav navbar-nav"&gt;
        &lt;li class="active"&gt;&lt;?php echo anchor('jobs/create', 'Create') ; ?&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;&lt;!--/.nav-collapse --&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class="container theme-showcase" role="main"&gt;</pre></div><p>This view is quite basic but still serves an important role. It displays an option to return to the <code class="literal">jobs</code> controller's <code class="literal">index()</code> function.</p></div>
<div class="section" title="Creating the controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec101"/>Creating the controller</h1></div></div></div><p>We're going to create only <a id="id835" class="indexterm"/>one controller in this project, which is <code class="literal">/path/to/codeigniter/application/controllers/jobs.php</code>.</p><p>There is only one controller in<a id="id836" class="indexterm"/> this project, so let's go over it now. We will look at the code and discuss how it functions.</p><p>There are three main functions in this controller, and these are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">index()</code>: This displays<a id="id837" class="indexterm"/> the initial list of job adverts to the user. It also displays the search box and displays any results that might be returned.</li><li class="listitem" style="list-style-type: disc"><code class="literal">create()</code>: This displays<a id="id838" class="indexterm"/> a form to the any user, allowing the users create a job advert.</li><li class="listitem" style="list-style-type: disc"><code class="literal">apply()</code>: This is <a id="id839" class="indexterm"/>accessed if the user clicks on the <span class="strong"><strong>Apply</strong></span> button or the job title.</li></ul></div><p>Create the <code class="literal">/path/to/codeigniter/application/controllers/jobs.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Jobs extends MY_Controller {
  function __construct() {
  parent::__construct();
    $this-&gt;load-&gt;helper('string');
    $this-&gt;load-&gt;helper('text');
    $this-&gt;load-&gt;model('Jobs_model');
    $this-&gt;load-&gt;library('form_validation');
    $this-&gt;form_validation-&gt;set_error_delimiters('&lt;div class="alert alert-danger"&gt;', '&lt;/div&gt;');
  }</pre></div><p>Looking at <code class="literal">index()</code> first, you'll see that one of the first things this function does is call the <code class="literal">get_jobs()</code> function of <code class="literal">Jobs_model</code>, passing to it the search string. If no search string was entered by the user in the search box, then this post array item will be empty, but that's okay because we test for it in the model.</p><p>The result of this query is stored in <code class="literal">$page_data['query']</code>, which is ready to be passed to the <code class="literal">views/jobs/view.php</code> file, where<a id="id840" class="indexterm"/> a <code class="literal">foreach()</code> loop will display each job advert:</p><div class="informalexample"><pre class="programlisting">public function index() {
  $this-&gt;form_validation-&gt;set_rules('search_string', $this-&gt;lang-&gt;line('search_string'), 'required|min_length[1]|max_length[125]');
  $page_data['query'] = $this-&gt;Jobs_model-&gt;get_jobs($this-&gt;input-&gt;post('search_string'));</pre></div><p>We set the validation rules for <code class="literal">search_string</code>. If this is the first time the page is viewed or if the validation fails, then <code class="literal">$this-&gt;form_validation()</code> will return a false value:</p><div class="informalexample"><pre class="programlisting">if ($this-&gt;form_validation-&gt;run() == FALSE) {
  $page_data['search_string'] = array('name' =&gt; 'search_string', 'class' =&gt; 'form-control', 'id' =&gt; 'search_string', 'value' =&gt; set_value('search_string', $this-&gt;input-&gt;post('search_string')), 'maxlength'   =&gt; '100', 'size' =&gt; '35');</pre></div><p>To display a list of jobs to the user, we call the <code class="literal">get_jobs()</code> function of <code class="literal">Jobs_model</code>, passing to it any search string entered by the user and storing the database result object in the <code class="literal">$page_data</code> array's item query. We pass the <code class="literal">$page_data</code> array to the <code class="literal">views/jobs/view.php</code> file:</p><div class="informalexample"><pre class="programlisting">    $page_data['query'] = $this-&gt;Jobs_model-&gt;get_jobs($this-&gt;input-&gt;post('search_string'));
    $this-&gt;load-&gt;view('common/header');
    $this-&gt;load-&gt;view('nav/top_nav');
    $this-&gt;load-&gt;view('jobs/view', $page_data);
    $this-&gt;load-&gt;view('common/footer');
  } else {
    $this-&gt;load-&gt;view('common/header');
    $this-&gt;load-&gt;view('nav/top_nav');
    $this-&gt;load-&gt;view('jobs/view', $page_data);
    $this-&gt;load-&gt;view('common/footer');
  }
}</pre></div><p>The <code class="literal">create()</code> function is a little more meaty; initially, we set out the form validation rules—nothing really interesting to see there—but just after, we call three model functions: <code class="literal">get_categories()</code>, <code class="literal">get_types()</code>, and <code class="literal">get_locations()</code>, the results of which are stored in their own <code class="literal">$save_data</code> array items, as follows:</p><div class="informalexample"><pre class="programlisting">$page_data['categories'] = $this-&gt;Jobs_model-&gt;get_categories();
$page_data['types'] = $this-&gt;Jobs_model-&gt;get_types();
$page_data['locations'] = $this-&gt;Jobs_model-&gt;get_locations(); </pre></div><p>We'll loop over these results in the <code class="literal">view/jobs/create.php</code> file and populate the HTML select dropdowns.</p><p>Anyway, after this, we check whether the form has been submitted and if so, whether it's submitted with errors. We build the form elements, specifying each element's settings and sending them in the <code class="literal">$page_data</code> array to the <code class="literal">views/jobs/create.php</code> view.</p><p>If there were no errors after the form was submitted, we package up all the post inputs and send them to the <code class="literal">save_job()</code> function of <code class="literal">Jobs_model</code>.</p><p>If the save operation worked, we'll set a success message flash data, indicating to the user that their job has been saved so that they<a id="id841" class="indexterm"/> know it will now appear in searches. However, if it hasn't, we'll return an error message:</p><div class="informalexample"><pre class="programlisting">public function create() {
  $this-&gt;form_validation-&gt;set_rules('job_title', $this-&gt;lang-&gt;line('job_title'), 'required|min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('job_desc', $this-&gt;lang-&gt;line('job_desc'), 'required|min_length[1]|max_length[3000]');
  $this-&gt;form_validation-&gt;set_rules('cat_id', $this-&gt;lang-&gt;line('cat_id'), 'required|min_length[1]|max_length[11]');
  $this-&gt;form_validation-&gt;set_rules('type_id', $this-&gt;lang-&gt;line('type_id'), 'required|min_length[1]|max_length[11]');
  $this-&gt;form_validation-&gt;set_rules('loc_id', $this-&gt;lang-&gt;line('loc_id'), 'required|min_length[1]|max_length[11]');
  $this-&gt;form_validation-&gt;set_rules('start_d', $this-&gt;lang-&gt;line('start_d'), 'min_length[1]|max_length[2]');
  $this-&gt;form_validation-&gt;set_rules('start_m', $this-&gt;lang-&gt;line('start_m'), 'min_length[1]|max_length[2]');
  $this-&gt;form_validation-&gt;set_rules('start_y', $this-&gt;lang-&gt;line('start_y'), 'min_length[1]|max_length[4]');
  $this-&gt;form_validation-&gt;set_rules('job_rate', $this-&gt;lang-&gt;line('job_rate'), 'required|min_length[1]|max_length[6]');
  $this-&gt;form_validation-&gt;set_rules('job_advertiser_name', $this-&gt;lang-&gt;line('job_advertiser_name'), 'required|min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('job_advertiser_email', $this-&gt;lang-&gt;line('job_advertiser_email'), 'min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('job_advertiser_phone', $this-&gt;lang-&gt;line('job_advertiser_phone'), 'min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('sunset_d', $this-&gt;lang-&gt;line('sunset_d'), 'min_length[1]|max_length[2]');
  $this-&gt;form_validation-&gt;set_rules('sunset_m', $this-&gt;lang-&gt;line('sunset_m'), 'min_length[1]|max_length[2]');
  $this-&gt;form_validation-&gt;set_rules('sunset_y', $this-&gt;lang-&gt;line('sunset_y'), 'min_length[1]|max_length[4]');

  $page_data['categories'] = $this-&gt;Jobs_model-&gt;get_categories();
  $page_data['types'] = $this-&gt;Jobs_model-&gt;get_types();
  $page_data['locations'] = $this-&gt;Jobs_model-&gt;get_locations();

  if ($this-&gt;form_validation-&gt;run() == FALSE) {
    $page_data['job_title']            = array('name' =&gt; 'job_title', 'class' =&gt; 'form-control', 'id' =&gt; 'job_title', 'value' =&gt; set_value('job_title', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['job_desc']             = array('name' =&gt; 'job_desc', 'class' =&gt; 'form-control', 'id' =&gt; 'job_desc', 'value' =&gt; set_value('job_desc', ''), 'maxlength'   =&gt; '3000', 'rows' =&gt; '6', 'cols' =&gt; '35');
    $page_data['start_d']              = array('name' =&gt; 'start_d', 'class' =&gt; 'form-control', 'id' =&gt; 'start_d', 'value' =&gt; set_value('start_d', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['start_m']              = array('name' =&gt; 'start_m', 'class' =&gt; 'form-control', 'id' =&gt; 'start_m', 'value' =&gt; set_value('start_m', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['start_y']              = array('name' =&gt; 'start_y', 'class' =&gt; 'form-control', 'id' =&gt; 'start_y', 'value' =&gt; set_value('start_y', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['job_rate']             = array('name' =&gt; 'job_rate', 'class' =&gt; 'form-control', 'id' =&gt; 'job_rate', 'value' =&gt; set_value('job_rate', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['job_advertiser_name']  = array('name' =&gt; 'job_advertiser_name', 'class' =&gt; 'form-control', 'id' =&gt; 'job_advertiser_name', 'value' =&gt; set_value('job_advertiser_name', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['job_advertiser_email'] = array('name' =&gt; 'job_advertiser_email', 'class' =&gt; 'form-control', 'id' =&gt; 'job_advertiser_email', 'value' =&gt; set_value('job_advertiser_email', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['job_advertiser_phone'] = array('name' =&gt; 'job_advertiser_phone', 'class' =&gt; 'form-control', 'id' =&gt; 'job_advertiser_phone', 'value' =&gt; set_value('job_advertiser_phone', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['sunset_d']             = array('name' =&gt; 'sunset_d', 'class' =&gt; 'form-control', 'id' =&gt; 'sunset_d', 'value' =&gt; set_value('sunset_d', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['sunset_m']             = array('name' =&gt; 'sunset_m', 'class' =&gt; 'form-control', 'id' =&gt; 'sunset_m', 'value' =&gt; set_value('sunset_m', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
    $page_data['sunset_y']             = array('name' =&gt; 'sunset_y', 'class' =&gt; 'form-control', 'id' =&gt; 'sunset_y', 'value' =&gt; set_value('sunset_y', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');

    $this-&gt;load-&gt;view('common/header');
    $this-&gt;load-&gt;view('nav/top_nav');
    $this-&gt;load-&gt;view('jobs/create', $page_data);
    $this-&gt;load-&gt;view('common/footer');
  } else {</pre></div><p>At this point, the data has<a id="id842" class="indexterm"/> passed validation and is stored in the <code class="literal">$save_data</code> array in preparation for saving it to the database:</p><div class="informalexample"><pre class="programlisting">$save_data = array(
  'job_title' =&gt; $this-&gt;input-&gt;post('job_title'),
  'job_desc' =&gt; $this-&gt;input-&gt;post('job_desc'),
  'cat_id' =&gt; $this-&gt;input-&gt;post('cat_id'),
  'type_id' =&gt; $this-&gt;input-&gt;post('type_id'),
  'loc_id' =&gt; $this-&gt;input-&gt;post('loc_id'),
  'job_start_date' =&gt; $this-&gt;input-&gt;post('start_y') .'-'.$this-&gt;input-&gt;post('start_m').'-'.$this-&gt;input-&gt;post('start_d'),
  'job_rate' =&gt; $this-&gt;input-&gt;post('job_rate'),
  'job_advertiser_name' =&gt; $this-&gt;input-&gt;post('job_advertiser_name'),
  'job_advertiser_email' =&gt; $this-&gt;input-&gt;post('job_advertiser_email'),
  'job_advertiser_phone' =&gt; $this-&gt;input-&gt;post('job_advertiser_phone'),
  'job_sunset_date' =&gt; $this-&gt;input-&gt;post('sunset_y') .'-'.$this-&gt;input-&gt;post('sunset_m').'-'.$this-&gt;input-&gt;post('sunset_d'),
  );</pre></div><p>The <code class="literal">$save_data</code> array is then sent to the <code class="literal">save_job()</code> function of <code class="literal">Jobs_model</code>, which will use <code class="literal">set_flashdata()</code> to generate a confirmation message if the save operation was successful or an error message if it failed:</p><div class="informalexample"><pre class="programlisting">    if ($this-&gt;Jobs_model-&gt;save_job($save_data)) {
      $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('save_success_okay'));
      redirect ('jobs/create/'); 
    } else {
      $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('save_success_fail'));
      redirect ('jobs'); 
    }
  }
} </pre></div><p>Finally, we arrive at the <code class="literal">apply()</code> function. This is a little simpler. Like <code class="literal">create()</code>, we start off by defining our form item validation rules, and then we check whether the form is being posted (submitted) or not. We do this because the job ID can be passed to it in two ways.</p><p>The first way is using <code class="literal">$this-&gt;uri-&gt;segment(3)</code>. The ID is passed to the <code class="literal">apply()</code> function via the third <code class="literal">uri</code> segment if a<a id="id843" class="indexterm"/> user clicks on the <span class="strong"><strong>Apply</strong></span> link or the job title in the <code class="literal">views/jobs/view.php</code> file.</p><p>The second way is <code class="literal">$this-&gt;input-&gt;post('job_id')</code>. The ID is passed to the <code class="literal">apply()</code> function via the post array if the form has been submitted. There is a hidden form element in the <code class="literal">views/jobs/view.php</code> file named <code class="literal">job_id</code>, the value of which is populated with the actual ID of the job being viewed:</p><div class="informalexample"><pre class="programlisting">public function apply() {
  $this-&gt;form_validation-&gt;set_rules('job_id', $this-&gt;lang-&gt;line('job_title'), 'required|min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('app_name', $this-&gt;lang-&gt;line('app_name'), 'required|min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('app_email', $this-&gt;lang-&gt;line('app_email'), 'required|min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('app_phone', $this-&gt;lang-&gt;line('app_phone'), 'min_length[1]|max_length[125]');
  $this-&gt;form_validation-&gt;set_rules('app_cover_note', $this-&gt;lang-&gt;line('app_cover_note'), 'required|min_length[1]|max_length[3000]');

  if ($this-&gt;input-&gt;post()) {</pre></div><p>The ID is stored in the <code class="literal">$page_data</code> array's <code class="literal">job_id</code> item and passed to the <code class="literal">get_job()</code> function of <code class="literal">Jobs_model</code>:</p><div class="informalexample"><pre class="programlisting">  $page_data['job_id'] = $this-&gt;input-&gt;post('job_id');
} else {
  $page_data['job_id'] = $this-&gt;uri-&gt;segment(3);
}

$page_data['query'] = $this-&gt;Jobs_model-&gt;get_job($page_data['job_id']);</pre></div><p>We then test to see whether anything is returned. We use the <code class="literal">num_rows()</code> CodeIgniter function to see whether there are any rows in the returned database object. If there aren't, then we just set a flash message saying that the job is no longer available. </p><p>It might be that in the time between the user clicking on the <span class="strong"><strong>Apply</strong></span> link and the time when they actually submit their application, the job<a id="id844" class="indexterm"/> advert has become unavailable; that is, its <code class="literal">job_sunset_date</code> has passed, or someone might have manually typed a random ID and it just so happens that that ID doesn't exist. Anyway, whatever the reason, if no results are returned, a flash message is shown to the user. If, however, it is been found, we pull out the data from the database and store it as local variables:</p><div class="informalexample"><pre class="programlisting">if ($page_data['query']-&gt;num_rows() == 1) {
  foreach ($page_data['query']-&gt;result() as $row) {
    $page_data['job_title'] = $row-&gt;job_title;
    $page_data['job_id'] = $row-&gt;job_id;
    $job_advertiser_name = $row-&gt;job_advertiser_name;
    $job_advertiser_email = $row-&gt;job_advertiser_email;
  }
} else {
  $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('app_job_no_longer_exists'));
  redirect('jobs');
}</pre></div><p>We then move on to the form validation process. If this is the initial page view or if there were errors with the submit, then <code class="literal">$this-&gt;form_validation-&gt;run()</code> will have retuned <code class="literal">FALSE</code>; if so, then we build our form items, defining their settings:</p><div class="informalexample"><pre class="programlisting">if ($this-&gt;form_validation-&gt;run() == FALSE) {
  $page_data['job_id']         = array('name' =&gt; 'job_id', 'class' =&gt; 'form-control', 'id' =&gt; 'job_id', 'value' =&gt; set_value('job_id', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
  $page_data['app_name']       = array('name' =&gt; 'app_name', 'class' =&gt; 'form-control', 'id' =&gt; 'app_name', 'value' =&gt; set_value('app_name', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
  $page_data['app_email']      = array('name' =&gt; 'app_email', 'class' =&gt; 'form-control', 'id' =&gt; 'app_email', 'value' =&gt; set_value('app_email', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
  $page_data['app_phone']      = array('name' =&gt; 'app_phone', 'class' =&gt; 'form-control', 'id' =&gt; 'app_phone', 'value' =&gt; set_value('app_phone', ''), 'maxlength'   =&gt; '100', 'size' =&gt; '35');
  $page_data['app_cover_note'] = array('name' =&gt; 'app_cover_note', 'class' =&gt; 'form-control', 'id' =&gt; 'app_cover_note', 'value' =&gt; set_value('app_cover_note', ''), 'maxlength'   =&gt; '3000', 'rows' =&gt; '6', 'cols' =&gt; '35');

  $this-&gt;load-&gt;view('common/header');
  $this-&gt;load-&gt;view('nav/top_nav');
  $this-&gt;load-&gt;view('jobs/apply', $page_data);
  $this-&gt;load-&gt;view('common/footer');</pre></div><p>If there was no error with the submit, then we will build an e-mail to be sent to the advertiser of the job; this e-mail will be sent to the e-mail address contained in <code class="literal">jobs.job_advertiser_email</code>.</p><div class="informalexample"><pre class="programlisting">    } else {</pre></div><p>We substitute the variables in the e-mail using the <code class="literal">str_replace();</code> PHP function, replacing the variables with the details pulled from the database or form submit, such as the applicant's contact details and cover note:</p><div class="informalexample"><pre class="programlisting">$body = "Dear %job_advertiser_name%,\n\n";
$body .= "%app_name% is applying for the position of %job_title%,\n\n";
$body .= "The details of the application are:\n\n";
$body .= "Applicant:  %app_name%,\n\n";
$body .= "Job Title:  %job_title%,\n\n";
$body .= "Applicant Email:  %app_email%,\n\n";
$body .= "Applicant Phone:  %app_phone%,\n\n";
$body .= "Cover Note:  %app_cover_note%,\n\n";

$body = str_replace('%job_advertiser_name%', $job_advertiser_name, $body);
$body = str_replace('%app_name%', $this-&gt;input-&gt;post('app_name'), $body);
$body = str_replace('%job_title%', $page_data['job_title'], $body);
$body = str_replace('%app_email%', $this-&gt;input-&gt;post('app_email'), $body);
$body = str_replace('%app_phone%', $this-&gt;input-&gt;post('app_phone'), $body);
$body = str_replace('%app_cover_note%', $this-&gt;input-&gt;post('app_cover_note'), $body);</pre></div><p>If the e-mail is sent successfully, we send a flash message to the applicant, informing them that their application<a id="id845" class="indexterm"/> has been sent as shown in the following code; this isn't the same as a validation error. Validation errors have been handled earlier and we wouldn't be this far into the processing of the form if validating had not been passed. Really, what we're saying is if the e-mail had not been sent correctly—perhaps <code class="literal">mail()</code> failed for some reason—the application would not have been sent. This is what we are indicating:</p><div class="informalexample"><pre class="programlisting">      if (mail($job_advertiser_email, 'Application for ' . $page_data['job_title'], $body)) {
        $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('app_success_okay'));
      } else {
        $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('app_success_fail'));
      }

      redirect ('jobs/apply/'.$page_data['job_id']);
    }
  }
}</pre></div></div>
<div class="section" title="Creating the language file"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec102"/>Creating the language file</h1></div></div></div><p>As with all the projects in this book, we're making use of the language file to serve text to users. This way, you can<a id="id846" class="indexterm"/> enable multiple region/multiple language <a id="id847" class="indexterm"/>support. Let's create the language file.</p><p>Create the <code class="literal">/path/to/codeigniter/application/language/english/en_admin_lang.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');

// General
$lang['system_system_name'] = "Job Board";

// Jobs - view.php
$lang['jobs_view_apply'] = "Apply";
$lang['jobs_view_search'] = "Search";

// Jobs - create.php
$lang['job_create_form_instruction_1'] = "Enter the information about your job advert below...";

$lang['job_title'] = "Title";
$lang['job_desc'] = "Description";
$lang['type'] = "Job type";
$lang['cat'] = "Category";
$lang['loc'] = "Location";
$lang['job_start_date'] = "Start date";
$lang['job_rate'] = "Rate";
$lang['job_advertiser_name'] = "Your name (or company name)";
$lang['job_advertiser_email'] = "Your email address";
$lang['job_advertiser_phone'] = "Your phone number";
$lang['job_sunset_date'] = "Sunset date";
$lang['job_sunset_date_help'] = "Your job advert will be live up to this date, after which it will not appear in searches and cannot be applied for";

$lang['save_success_okay'] = "Your advert has been saved";
$lang['save_success_fail'] = "Your advert cannot be saved at this time";

// Jobs - Apply
$lang['apply_instruction_1'] = "Fill out the form below to apply for ";
$lang['app_name'] = "Your name ";
$lang['app_email'] = "Your email ";
$lang['app_phone'] = "Your phone number ";
$lang['app_cover_note'] = "Cover note ";
$lang['app_success_okay'] = "Your application has been sent ";
$lang['app_success_fail'] = "Your application cannot be sent at this time ";
$lang['app_job_no_longer_exists'] = "Unfortunately we are unable to process your application as the job is no longer active";</pre></div></div>
<div class="section" title="Putting it all together"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec103"/>Putting it all together</h1></div></div></div><p>Okay, here are a couple of <a id="id848" class="indexterm"/>examples that will help put everything together.</p><div class="section" title="User creates a job advert"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec80"/>User creates a job advert</h2></div></div></div><p>Let's see<a id="id849" class="indexterm"/> how the process of <a id="id850" class="indexterm"/>creating a job advert exactly works:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The user visits the site and is presented with a list of jobs, a search box, and a navigation bar.</li><li class="listitem">The user wishes to create a new job so they click on the <span class="strong"><strong>Create</strong></span> link contained in the <code class="literal">views/nav/top_nav.php</code> file.</li><li class="listitem">CodeIgniter loads the <code class="literal">jobs</code> controller's <code class="literal">create()</code> function.</li><li class="listitem">The <code class="literal">create()</code> function displays the form in the <code class="literal">views/jobs/create.php</code> view file. There are three HTML dropdown form elements that allow the user to choose a job type, category, and location. These dropdowns are populated by the <code class="literal">get_types()</code>, <code class="literal">get_categories()</code> and <code class="literal">get_locations()</code> functions of <code class="literal">Jobs_model</code>, respectively.</li><li class="listitem">The user fills in the form and clicks on <span class="strong"><strong>Go</strong></span> to submit the form.</li><li class="listitem">The form is submitted to the <code class="literal">jobs</code> controller's <code class="literal">create()</code> function; it is validated and passed.</li><li class="listitem">The <code class="literal">jobs</code> controller's <code class="literal">create()</code> function sends the validated form input to the <code class="literal">save_job()</code> function of <code class="literal">Jobs_model</code> where it is saved to the <code class="literal">jobs</code> database table.</li></ol></div></div><div class="section" title="User looks at a job"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec81"/>User looks at a job</h2></div></div></div><p>Now we will see how does a<a id="id851" class="indexterm"/> user looks at a job:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The user <a id="id852" class="indexterm"/>visits the site and is presented with a list of jobs, a search box, and a navigation bar.</li><li class="listitem">The user clicks on the job title of the first job in the list.</li><li class="listitem">CodeIgniter loads the <code class="literal">jobs</code> controller's <code class="literal">apply()</code> function.</li><li class="listitem">The <code class="literal">apply()</code> function looks at the third segment in the URI (this is the <code class="literal">job_id</code> value passed in the URL of the job title in the previous step) and passes this to the <code class="literal">get_job()</code> function in <code class="literal">Jobs_model</code>.</li><li class="listitem">The <code class="literal">get_job()</code> function pulls the details of the job from the database and returns a database result object to the <code class="literal">jobs</code> controller.</li><li class="listitem">The <code class="literal">jobs</code> controller <a id="id853" class="indexterm"/>sends the database result object to the <code class="literal">views/jobs/apply.php</code> view file where a <code class="literal">foreach()</code> loop runs over the object, echoing out the details of the job.</li></ol></div></div><div class="section" title="User searches for a job"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec82"/>User searches for a job</h2></div></div></div><p>The flow of steps followed<a id="id854" class="indexterm"/> when a user searches for a job is as<a id="id855" class="indexterm"/> follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The user visits the site and is presented with a list of jobs, a search box, and a navigation bar.</li><li class="listitem">The user types the word <code class="literal">CodeIgniter</code> into the search box and hits the <span class="emphasis"><em>Enter</em></span> key.</li><li class="listitem">The CodeIgniter framework then calls the <code class="literal">jobs</code> controller's <code class="literal">index()</code> function.</li><li class="listitem">The <code class="literal">index()</code> function calls the <code class="literal">get_jobs</code> function of <code class="literal">Jobs_model</code> and passes to it the <code class="literal">search_string</code> post item:<div class="informalexample"><pre class="programlisting">$page_data['query'] = $this-&gt;Jobs_model-&gt;get_jobs($this-&gt;input-&gt;post('search_string'));</pre></div></li><li class="listitem">The <code class="literal">get_jobs()</code> function of <code class="literal">Jobs_model</code> recognizes that there is a search string as input and runs the correct database query, looking at <code class="literal">jobs.job_title</code> and <code class="literal">jobs.job_desc</code> to see whether a string of text matches the user's search string.</li><li class="listitem">A job advert is found to match.</li><li class="listitem">The result object is returned to the <code class="literal">views/jobs/view.php</code> file, where a <code class="literal">foreach()</code> loop runs over the result object, displaying the summary details of the job.</li><li class="listitem">The user is free<a id="id856" class="indexterm"/> to click on the <span class="strong"><strong>Apply</strong></span> link to study the details further or apply for the job.</li></ol></div></div><div class="section" title="User applies for a job"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec83"/>User applies for a job</h2></div></div></div><p>When a user <a id="id857" class="indexterm"/>wants to apply for a job, the following <a id="id858" class="indexterm"/>steps are performed:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The user visits the site and is presented with a list of jobs, a search box and navigating bar.</li><li class="listitem">The user clicks on the job title of the first job in the list.</li><li class="listitem">CodeIgniter loads the <code class="literal">jobs</code> controller's <code class="literal">apply()</code> function.</li><li class="listitem">The <code class="literal">apply()</code> function looks at the third segment in the URI (this is the <code class="literal">job_id</code> value passed in the URL of the job title in the previous step) and passes this to the <code class="literal">get_job()</code> function in <code class="literal">Jobs_model</code>.</li><li class="listitem">The <code class="literal">get_job()</code> function pulls the details of the job from the database and returns a database result object to the <code class="literal">jobs</code> controller.</li><li class="listitem">The <code class="literal">jobs</code> controller sends the database result object to the <code class="literal">views/jobs/apply.php</code> view file where a <code class="literal">foreach()</code> loop runs over the object, echoing out the<a id="id859" class="indexterm"/> details of the job.</li><li class="listitem">The user enters their details in the form below the job description and clicks on <span class="strong"><strong>Go</strong></span>.</li><li class="listitem">The form is <a id="id860" class="indexterm"/>submitted to the <code class="literal">jobs</code> controller's <code class="literal">apply()</code> function where it is validated; once passed, the <code class="literal">jobs</code> controller queries the <code class="literal">get_job()</code> function of <code class="literal">Jobs_model</code> to find the <code class="literal">jobs.job_advertiser_email</code> and <code class="literal">jobs.job_advertiser_name</code> values in order to e-mail the application to the advertiser.</li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec104"/>Summary</h1></div></div></div><p>So, here we have a basic job board application; it is capable of allowing people to create jobs, displaying those jobs, searching for jobs, and it also allows people to apply for these jobs. However, there are still areas of improvement and scope to add greater functionality; perhaps you could do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add e-mail confirmation for the applicant. You could add a functionality to the <code class="literal">jobs/apply()</code> function to send a confirmation e-mail to the applicant when they apply for a job.</li><li class="listitem" style="list-style-type: disc">Limit the number of applications. You could add a functionality to limit the number of job applications per job; logic would be needed to calculate which came first: the sunset date or the application limit.</li><li class="listitem" style="list-style-type: disc">You could paginate the results. Currently, all active jobs are displayed in the <code class="literal">jobs/index()</code> function. You might wish to add pagination to this, limiting the number of jobs per page to a set number—25 per page, for example.</li><li class="listitem" style="list-style-type: disc">You can have detailed search options. You could add a more complex search, perhaps a dropdown specifying locations or job types, and so on.</li><li class="listitem" style="list-style-type: disc">You can delete old job adverts. You could create a small Cron script, deleting jobs that are beyond their sunset date (<code class="literal">jobs.job_sunset_date</code>). This would reduce the database to a more reasonable size and ensure that only jobs that are active are kept there.</li></ul></div><p>So there we are, then—we're at the end! What have we learned… erm, well, you should have a whole bunch of projects to be ready to work with—best of all, they're all really simple, so you can easily expand upon them and build more features and functions as you require; at the very least, you should have a <span class="emphasis"><em>base</em></span> platform on which you can build any number of applications.</p><p>Be sure to check out the CodeIgniter website (<a class="ulink" href="http://www.codeigniter.com/">http://www.codeigniter.com/</a>) for regular updates and new releases. Don't forget that the code in this book is available online from the Packt website, so you don't have to painfully copy from page to screen, and the SQL for each project is there too.</p><p>Right—that's it, the end!</p></div></body></html>