<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;XML and JSON"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. XML and JSON</h1></div></div></div><p>So far, we have been using HTML everywhere. It is the format for web pages, so we have used it to create static web pages. As a consequence, HTML is the format of the data that is exchanged between the server and the client during the page load<a id="id665" class="indexterm"/> of the <span class="strong"><strong>.html</strong></span> file.</p><p>When we create web pages dynamically, our PHP code will compose lines of HTML by the time data is sent across, which will be the true data that is exchanged, not the original content of your <span class="strong"><strong>.php</strong></span> file. When <a id="id666" class="indexterm"/>we used Ajax, we did not specify a data format as a parameter in our jQuery Ajax methods, <code class="literal">.post()</code> or <code class="literal">.ajax()</code>, because it was implicitly understood that it would be HTML.</p><p>In this chapter, we introduce two different data formats, XML and JSON. In web development, we can use them in different ways. First, they can be an alternative to your database. For simple projects, your data can be stored in a text file, rather than in a full blown database. You could even store it as plain text.</p><p>The next, and better, level up would be to use an XML file or JSON for your data. They are plain text as well, but formatted in a special way. Data stored in that format can be easily converted to HTML, bringing us back to the previous scenario.</p><p>On the other hand, we can first send the data to the client and then process it there to create the content of our pages. We will cover both scenarios in this chapter.</p><div class="section" title="XML"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec73"/>XML</h1></div></div></div><p>
<span class="strong"><strong>eXtensible Markup Language </strong></span>(<span class="strong"><strong>XML</strong></span>) is a format that has been widely adopted to exchange information between companies, documents, and programs. It has a notation similar to HTML, using tags. As a matter of fact, HTML is a <a id="id667" class="indexterm"/>special case of XML. With HTML, tags have meanings and are meant to be interpreted by a browser. In XML, tags can mean anything or nothing at all, but the rules are stricter. Of course, if you are the creator of the XML file, we hope that the tags have some meaning to you.</p><p>You, as a web developer, may never use XML, but it is important that you know that it exists. It has been created to be a data format that is both machine readable and human readable. Humans will be able to read the content that is inside, as XML files are basically text files; computer programs can read them because they are well structured. There are several areas where the XML format is applied. We only mention a few of them here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Web services</strong></span>: Some people or companies give access to information from their database by providing a web service. How to create web services is beyond the scope of this <a id="id668" class="indexterm"/>book. What web services typically offer you is the ability to go to a certain web address, with a query string indicating the kind of information you are seeking. The result of visiting this (virtual) site is an output stream in the XML format, which you can then process. We will teach you how to do the processing, not the creation of the service.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Alternative to a database</strong></span>: For simple<a id="id669" class="indexterm"/> applications, or parts thereof, using a full blown database might be overkill. As we have mentioned, you could use a plain text file or, as often occurs, a <code class="literal">.csv</code> file. It is far better to use an XML file for this, as it has more structure and it may well be the structure that the customer wants from you.</li></ul></div><div class="section" title="XML format"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec114"/>XML format</h2></div></div></div><p>The format of an XML file is actually quite simple. It is a text file than begins with a line like this:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;</pre></div><p>This line mentions the version<a id="id670" class="indexterm"/> of XML, and so far this is only 1.0 or 1.1. The rules are so simple that there is hardly room for changes and encoding. This is called the<a id="id671" class="indexterm"/> <span class="strong"><strong>XML declaration</strong></span>. Everything that follows is the actual XML document, which consists of tags, or elements, a closing tag for each opening tag, and text in between them. Look at this first example:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"encoding="UTF-8"?&gt;
&lt;!— A list of people that like California —&gt;
&lt;californiapeople&gt;
  &lt;person id="1"&gt;
    &lt;name&gt;Adams&lt;/name&gt;
    &lt;first&gt;Ansel&lt;/first&gt;
    &lt;profession&gt;photographer&lt;/profession&gt;
    &lt;born&gt;San Francisco&lt;/born&gt;
    &lt;picture/&gt;
  &lt;/person&gt;
  &lt;person&gt;
    &lt;name&gt;Muir&lt;/name&gt;
    &lt;first&gt;John&lt;/first&gt;
    &lt;profession&gt;photographer&lt;/profession&gt;
    &lt;born&gt;Scotland&lt;/born&gt;
  &lt;/person&gt;
  &lt;person&gt;
    &lt;name&gt;Schwarzenegger&lt;/name&gt;
    &lt;first&gt;Arnold&lt;/first&gt;
    &lt;profession&gt;governator&lt;/profession&gt;
    &lt;born&gt;Germany&lt;/born&gt;
  &lt;/person&gt;
  &lt;person&gt;
    &lt;name&gt;Rowell&lt;/name&gt;
    &lt;first&gt;Galen&lt;/first&gt;
    &lt;profession&gt;photographer&lt;/profession&gt;
    &lt;born&gt;Oakland CA&lt;/born&gt;
  &lt;/person&gt;
  &lt;person&gt;
    &lt;name&gt;Wellens&lt;/name&gt;
    &lt;first&gt;Paul&lt;/first&gt;
    &lt;profession&gt;travel guide&lt;/profession&gt;
    &lt;born&gt;Antwerp Belgium&lt;/born&gt;
  &lt;/person&gt;
&lt;/californiapeople&gt;</pre></div><p>As you can tell, there is a closing tag for each opening tag, and one tag, <code class="literal">&lt;californiapeople&gt;</code> appears first and only once. This is the <span class="strong"><strong>root</strong></span>. Tags can have tags in between them, but they must be properly nested. I have given the first person tag an <span class="strong"><strong>attribute</strong></span> and I have also<a id="id672" class="indexterm"/> included an<a id="id673" class="indexterm"/> <span class="strong"><strong>empty</strong></span> tag there. Just like the <code class="literal">&lt;br/&gt;</code> tag in HTML, <code class="literal">&lt;picture/&gt;</code> is a<a id="id674" class="indexterm"/> shorthand notation for <code class="literal">&lt;picture&gt;&lt;/picture&gt;</code>. Such an element is <a id="id675" class="indexterm"/>called <span class="strong"><strong>self-closing</strong></span>.</p><p>Because I use XML from time to time, I have a habit of always using a closing tag in HTML files, even where it is not mandatory, for example in HTML5. Other noticeable differences are that in an XML file, white space is not truncated and names of elements are case sensitive, so <code class="literal">&lt;Person&gt;</code> is not the same as <code class="literal">&lt;person&gt;</code>.</p><p>Finally, as can be expected, there are a number of characters you cannot use inside the text of your XML file: <code class="literal">&lt;</code> and <code class="literal">&amp;</code>. XML is going to think it reached the beginning of an opening tag. If you need the <code class="literal">&lt;</code> sign , use <code class="literal">&amp;lt;</code> instead. You should remember this from when we discussed HTML entities a few chapters ago. Other entities used in XML are <code class="literal">&amp;amp</code>, which solves the chicken and egg problem, that if <code class="literal">&amp;lt;</code> means <code class="literal">&lt;</code>, then using <code class="literal">&amp;</code> by itself cannot be allowed either. <code class="literal">&amp;gt;</code>, <code class="literal">&amp;apos;</code>, and <code class="literal">&amp;quot;</code> can be used as well, even though <code class="literal">&gt;</code>, <code class="literal">'</code>, and <code class="literal">"</code> are legal characters. If you need them as part of your text, we recommend that you use the entities instead. Oh, by the way, did you notice that the syntax for comments is also the same as in HTML? There are more similarities, and we can even style an XML file!</p></div><div class="section" title="Displaying XML files"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec115"/>Displaying XML files</h2></div></div></div><p>The first time you look at an XML file, you may not see what you expect. The best way to display an XML file is to use a browser, and the browser will treat the file as it does HTML files; therefore, you will not see the tags, only the text in between them. This is another reason why I like to<a id="id676" class="indexterm"/> use Firefox as a browser.</p><p>Firefox and Chrome <a id="id677" class="indexterm"/>display the entire XML file, including the tags. The tag names are in a different color and everything is nicely indented. Firefox will also check to see whether it is a well-formed XML file and, if it is not, produce a meaningful error message pointing you to the offending line in the file.</p><p>Sometimes Firefox displays: "This XML file does not appear to have any style information associated with it. The document tree is shown below." Well, this Firefox message suggests that there can be a stylesheet for an XML file, does it not? Could that even be a CSS file? Yes it could. Just add the following line after the XML declaration:</p><div class="informalexample"><pre class="programlisting">&lt;?xml-stylesheet type="text/css" href="california.css"?&gt;</pre></div><p>Then, create a CSS file with the following content. Firefox will now display only the contents of your file, not the tags, using some funky colors. Later in this chapter, you will learn that there can be other style sheets that are not CSS files.</p><p>Due to the nature of XML, all the code examples that follow are rather long. You may want to consider going to the online pages for this book on Packt Publishing's website and picking them up there:</p><div class="informalexample"><pre class="programlisting">californiapeople {
  background-color: #FFDEAD;
}
name, first {
  color:teal;
  font-size:20px;
  margin-top:30px;
}
name {
margin-left:25px;
}
profession, born
{
  display:block;
  margin-left:50px;
  font-size:16px;
  font-family:Baskerville, "Times New Roman",  serif;
  color:blue;
}</pre></div></div><div class="section" title="XML editors"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec116"/>XML editors</h2></div></div></div><p>As XML files are<a id="id678" class="indexterm"/> text files, you can use any text editor to create and edit them. <span class="strong"><strong>Textastic</strong></span> is <a id="id679" class="indexterm"/>a fantastic <a id="id680" class="indexterm"/>editor that only costs a few bucks, which I like using, and there is a version for MacOS, as well <a id="id681" class="indexterm"/>as iOS. <span class="strong"><strong>Dreamweaver</strong></span><a id="id682" class="indexterm"/> users <a id="id683" class="indexterm"/>will benefit from its feature of validating XML files for the correct syntax.</p><p>However, in the world of XML, validation can be done beyond simple syntax.</p></div><div class="section" title="XML Schema"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec117"/>XML Schema</h2></div></div></div><p>Imagine you are working with several customers that need to provide you with data, employee records, for example, and you request that they do so using XML as the format. You have just requested yourself a big mess! As data comes in, you realize that one customer used the element <code class="literal">&lt;name&gt;</code> for the last name, whereas another one decided to go with <code class="literal">&lt;last&gt;</code>. Not only that, they<a id="id684" class="indexterm"/> probably used a different order and mix of things.</p><p>What you should have done first was to give them a definition of how you wanted the XML file to look. Then, you could have already started to write your application that will process the data before you even received that data.</p><p>There are several conventions used to define the structure of an XML file. One is called <span class="strong"><strong>Document Type Definition</strong></span> (<span class="strong"><strong>DTD</strong></span>) and <a id="id685" class="indexterm"/>another one is <span class="strong"><strong>XML Schema</strong></span>. The nice thing about the XML Schema format is that the file that describes the structure of your XML file is also an XML file. Teaching<a id="id686" class="indexterm"/> you about either method is beyond the scope of this book. A few examples of XML Schema files are provided however.</p><p>As a start, here is the XML Schema definition for XML files that are structured like the one in our previous example:</p><div class="informalexample"><pre class="programlisting">&lt;xs:schema &gt;
  &lt;xs:element name="californiapeople"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name="person" maxOccurs="unbounded"&gt;
          &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
              &lt;xs:element type="xs:string" name="name"/&gt;
              &lt;xs:element type="xs:string" name="first"/&gt;
              &lt;xs:element type="xs:string" name="profession"/&gt;
              &lt;xs:element type="xs:string" name="born"/&gt;
              &lt;xs:element type="xs:string" name="photograph"/&gt;
            &lt;/xs:sequence&gt;
           &lt;xs:attribute type="xs:byte" name="id" use="optional"/&gt;
          &lt;/xs:complexType&gt;
        &lt;/xs:element&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;</pre></div><p>As you can probably <a id="id687" class="indexterm"/>decipher, this is a description of all the elements that can be inside the XML file, which attributes they can have, in which order they should occur, and so on.</p></div><div class="section" title="SimpleXML"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec118"/>SimpleXML</h2></div></div></div><p>Assume we have an XML file on the server containing data that we want to use to dynamically generate a web page, as was done previously by extracting the data from a MySQL database in a PHP program. How can this be done?</p><p>There are several ways. In this<a id="id688" class="indexterm"/> example, <span class="strong"><strong>SimpleXML</strong></span> is used. It consists of a few PHP classes with several methods to process existing XML files, or create new ones. The following example is taken from an older version of my website, which contains many galleries of photographs. The information about the photographs was stored in an XML file, one for each gallery. Each time a photograph had to be added to the site, all that needed to be done was to add a <code class="literal">node</code> to the appropriate XML file.</p><p>I have abbreviated the text inside the XML file, otherwise this part of the chapter would have turned into a travel guide.</p><div class="section" title="The XML file"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec51"/>The XML file</h3></div></div></div><p>Use your favorite <a id="id689" class="indexterm"/>editor and create <code class="literal">practical.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;photocollection&gt;
&lt;title&gt;June Lake&lt;/title&gt;
&lt;overview&gt;
The June Lake Loop begins just five miles south of Lee Vining, on US 395, ...
&lt;/overview&gt;
&lt;photo&gt;
&lt;scaption&gt;June Lake in the Fall&lt;/scaption&gt;
&lt;caption&gt;June Lake and Carson Peak in the fall&lt;/caption&gt;
&lt;id&gt;Juneinthefall-31-21&lt;/id&gt;
&lt;story&gt;
Each time that unfortunate day arrives that I have to leave June Lake ...
&lt;/story&gt;
&lt;thumbnail&gt;&lt;/thumbnail&gt;
&lt;smallimg&gt;imagessmall/junelakefall.jpg&lt;/smallimg&gt;
&lt;largeimg&gt;imagespng/junelakeinthefall.png&lt;/largeimg&gt;
&lt;photoshop&gt;&lt;/photoshop&gt;
&lt;date&gt;&lt;/date&gt;
&lt;camera&gt;Nikon F6&lt;/camera&gt;
&lt;/photo&gt;
&lt;photo&gt;
&lt;scaption&gt;Aspen by Silver Lake&lt;/scaption&gt;
&lt;caption&gt;Aspen trees by Silver Lake&lt;/caption&gt;
&lt;id&gt;silverlakeaspenfall98&lt;/id&gt;
&lt;story&gt;In 1998, I hit the right week of the year for fall colors. I parked by Silver Lake ...
&lt;/story&gt;
&lt;smallimg&gt;imagessmall/silverlakeaspenfall98.jpg&lt;/smallimg&gt;
&lt;largeimg&gt;imagespng/silverlakeaspenfall98.png&lt;/largeimg&gt;
&lt;photoshop&gt;&lt;/photoshop&gt;
&lt;date&gt;&lt;/date&gt;
&lt;camera&gt;Hasselblad&lt;/camera&gt;
&lt;/photo&gt;
&lt;photo&gt;
&lt;scaption&gt;Gull Lake in the Fall&lt;/scaption&gt;
&lt;caption&gt;Gull Lake in the Fall - Happy fishermen !&lt;/caption&gt;
&lt;id&gt;gullake-648&lt;/id&gt;
&lt;story&gt;
If you take the north shore road around June Lake there is a turnoff, ...
&lt;/story&gt;
&lt;smallimg&gt;imagessmall/gulllake648.jpg&lt;/smallimg&gt;
&lt;largeimg&gt;imageslarge/gulllake648.jpg&lt;/largeimg&gt;
&lt;photoshop&gt;&lt;/photoshop&gt;
&lt;date&gt;&lt;/date&gt;
&lt;camera&gt;Nikon D1&lt;/camera&gt;
&lt;/photo&gt;
&lt;photo&gt;
&lt;scaption&gt;Silver Lake&lt;/scaption&gt;
&lt;caption&gt;Silver Lake - June Lake Loop&lt;/caption&gt;
&lt;id&gt;silver2&lt;/id&gt;
&lt;story&gt;
Any time of the year, there can be snow in June Lake. That year there was fresh snow ...
&lt;/story&gt;
&lt;smallimg&gt;imagessmall/silver2.jpg&lt;/smallimg&gt;
&lt;largeimg&gt;imagespng/silver2.png&lt;/largeimg&gt;
&lt;photoshop&gt;&lt;/photoshop&gt;
&lt;date&gt;&lt;/date&gt;
&lt;camera&gt;Hasselblad&lt;/camera&gt;
&lt;/photo&gt;
&lt;/photocollection&gt;</pre></div></div><div class="section" title="The XML Schema file"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec52"/>The XML Schema file</h3></div></div></div><p>This is the <a id="id690" class="indexterm"/>XML Schema file <code class="literal">photocollection.xs</code>, in case you are interested what it will look like:</p><div class="informalexample"><pre class="programlisting">&lt;xs:schema &gt;
  &lt;xs:element name="photocollection"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element type="xs:string" name="title"/&gt;
        &lt;xs:element type="xs:string" name="overview"/&gt;
        &lt;xs:element name="photo" maxOccurs="unbounded"/&gt;
          &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
              &lt;xs:element type="xs:string" name="scaption"/&gt;
              &lt;xs:element type="xs:string" name="caption"/&gt;
              &lt;xs:element type="xs:string" name="id"/&gt;
              &lt;xs:element type="xs:string" name="story"/&gt;
              &lt;xs:element type="xs:string" name="thumbnail"/&gt;
              &lt;xs:element type="xs:string" name="smallimg"/&gt;
              &lt;xs:element type="xs:string" name="largeimg"/&gt;
              &lt;xs:element type="xs:string" name="photoshop"/&gt;
              &lt;xs:element type="xs:string" name="date"/&gt;
              &lt;xs:element type="xs:string" name="camera"/&gt;
            &lt;/xs:sequence&gt;
          &lt;/xs:complexType&gt;
        &lt;/xs:element&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;</pre></div></div><div class="section" title="The CSS file"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec53"/>The CSS file</h3></div></div></div><p>This is<a id="id691" class="indexterm"/> <code class="literal">practical.css</code>, the style sheet for the HTML that will be generated from the XML file:</p><div class="informalexample"><pre class="programlisting">@charset "utf-8";
body {
background-color:#FFDEAD;
margin-top:10px;
color: teal;
}
#overview h1
{
  text-align:center;
}
div.simage img
{
border:3px white solid;
align:center;
}
#mysite
{
margin:auto;
width:980px;
}
div.smallmat {

  width:300px;
  float: left;
}
div.scaption {
  padding:5px;
}
div.story {
  width:500px;
  float: left;
}

div.storybook {
  width:850px;
  float:left;
  margin:20px;
}</pre></div></div><div class="section" title="The PHP file"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec54"/>The PHP file</h3></div></div></div><p>This is the PHP file to generate the HTML of a small picture gallery with as many photographs as there <a id="id692" class="indexterm"/>are referenced in the XML:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html &gt;
&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
&lt;title&gt;June Lake Gallery&lt;/title&gt;
&lt;link href="styles/practical.css" rel="stylesheet" type="text/css" media="screen"/&gt;
&lt;/head&gt;
&lt;?php
$xmlfile = "practical.xml";
if (!file_exists($xmlfile)) {
   exit('Failed to open practical.xml.');
}
$xml =  simplexml_load_file($xmlfile);
?&gt;
&lt;body&gt;&lt;div id="mysite"&gt;&lt;div id="overview"&gt;&lt;h1&gt;
&lt;?php
echo $xml-&gt;title;
?&gt;
&lt;/h1&gt;&lt;p&gt;
&lt;?php echo $xml-&gt;overview; ?&gt;
&lt;/p&gt;&lt;/div&gt;&lt;div id="gallery"&gt;
&lt;?php
$photos = $xml-&gt;xpath("//photo");
$photocount = count($photos);
$count = 0;
while ($count &lt; $photocount) {
$htmlstring = '&lt;div class="storybook"&gt;&lt;div class="smallmat"&gt;&lt;div class="simage"&gt;&lt;a href="';
$htmlstring .= $photos[$count]-&gt;largeimg;
$htmlstring .= '"&gt;&lt;img class="sphoto" src="';
$htmlstring .= $photos[$count]-&gt;smallimg;
$htmlstring .= '" title="';
$htmlstring .=  $photos[$count]-&gt;caption;
$htmlstring .= '"&gt;&lt;/img&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="scaption"&gt;';
$htmlstring .=  $photos[$count]-&gt;scaption;
$htmlstring .= '&lt;/div&gt;&lt;/div&gt;&lt;div class="story"&gt;';
$htmlstring .=  $photos[$count]-&gt;story;
$htmlstring .=  '&lt;/div&gt;&lt;/div&gt;';
echo $htmlstring;
$count++;   }
?&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</pre></div><p>As the name suggests, SimpleXML is simple to use. <code class="literal">simplexml_load_file()</code> returns an object that<a id="id693" class="indexterm"/> contains the entire XML tree of the file that is passed as an argument. There is a companion method, called <code class="literal">simplexml_load_string()</code>, which takes a string that contains XML as argument. Every element inside this tree can be accessed using a simple syntax.</p><p>To access the collection of all photo nodes, the <span class="strong"><strong>xpath()</strong></span> method was used. It supports the syntax of XPath, a query <a id="id694" class="indexterm"/>language for XML files. All you need to remember here is the meaning of <code class="literal">//photo</code>. It gives us all photo nodes back, even if they are not in the top level of the tree.</p></div><div class="section" title="Creating XML files with SimpleXML"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec55"/>Creating XML files with SimpleXML</h3></div></div></div><p>You can also use SimpleXML to create XML files from within a program. You start with the root element as a string, and then build up your XML file by adding nodes using the <code class="literal">addChild()</code> method, which takes one or two arguments. The first one is the name of the node, and the optional<a id="id695" class="indexterm"/> second one, its value. When you are all done, you finish it off with the <code class="literal">asXML()</code> method, which will return a string containing all the XML, or store it into a file if you give it an argument. In the example that follows, we call it <code class="literal">xmlfiles/new.xml</code>.</p><p>To conclude this section on SimpleXML, here is a tiny program that recreates our XML file, but with only one photo node, and saves it as <code class="literal">xmlfiles/new.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$xml =  simplexml_load_string('&lt;photocollection&gt;&lt;/photocollection&gt;');
$xml-&gt;addChild("title", "June Lake");
$xml-&gt;addChild("overview", "The June Lake Loop begins just five miles south of Lee Vining, on US 395, ...");
$photo = $xml-&gt;addChild("photo");
$photo-&gt;addChild("scaption", "June Lake in the Fall");
$photo-&gt;addChild("caption", "June Lake and Carson Peak");
$photo-&gt;addChild("story", "Each time that unfortunate day  ...");
$photo-&gt;addChild("smallimg", "imagessmall/junelakefall.jpg");
$photo-&gt;addChild("largeimg", "imagespng/junelakeinthefall.png");
$xml-&gt;asXML("xmlfiles/new.xml");
?&gt;</pre></div></div><div class="section" title="Generating our HTML on the client side"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec56"/>Generating our HTML on the client side</h3></div></div></div><p>It is not necessary to<a id="id696" class="indexterm"/> always generate the final HTML on the server and then send it to the client when we use XML or JSON as the data format and use Ajax calls. As more and more powerful devices are used to access the web and run a browser inside them, generating the HTML code might as well be done inside the client.</p><p>We could use the <code class="literal">.post()</code> jQuery Ajax call and execute a PHP program, with SimpleXML, to pass the entire XML file as a string and then process it. Even that part is not necessary because the jQuery Ajax methods know what XML and JSON are all about. We can simply specify the path of the XML file to the <code class="literal">.ajax()</code> method, and jQuery will take care of the rest. This is a great candidate to use the <code class="literal">.get()</code> method, as we only have to retrieve data, our XML, from the server, and not send any data to it.</p><p>The following<a id="id697" class="indexterm"/> example will generate the exact same photo gallery but it is all done with Ajax and JavaScript, no PHP code is involved. The HTML file is:</p><div class="informalexample"><pre class="programlisting">&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8" /&gt;
&lt;title&gt;June Lake Gallery&lt;/title&gt;
&lt;link href="styles/practical.css" rel="stylesheet" type="text/css" media="screen"/&gt;
&lt;/head&gt;
&lt;script src="./js/jquery-1.10.1.js"&gt;&lt;/script&gt;
&lt;body&gt;
&lt;div id="mysite"&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;script src="./js/practical.js"&gt;&lt;/script&gt;</pre></div><p>The JavaScript file is:</p><div class="informalexample"><pre class="programlisting">$(document).ready (function () {
$.get( "practical.xml", function( xml ) {
var jQueryxml = $(xml);  // Turn XML object into a jQuery object
var html = '&lt;div id="overview"&gt;&lt;h1&gt;' + jQueryxml.find('title').text() + '&lt;/h1&gt;';
html += '&lt;p&gt;' + jQueryxml.find('overview').text() + '&lt;/p&gt;&lt;/div&gt;';
html += '&lt;div id="gallery"&gt;';
jQueryxml.find('photo').each(function(){
html += '&lt;div class="storybook"&gt;&lt;div class="smallmat"&gt;&lt;div class="simage"&gt;&lt;a href="';
var scaption = $(this).find('scaption').text();
var caption = $(this).find('caption').text();
var largeimg = $(this).find('largeimg').text();
var smallimg = $(this).find('smallimg').text();
var story = $(this).find('story').text();
html += largeimg;
html += '"&gt;&lt;img class="sphoto" src="';
html += smallimg;
html += '" title="';
html +=  caption;
html += '"&gt;&lt;/img&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="scaption"&gt;';
html +=  scaption;
html += '&lt;/div&gt;&lt;/div&gt;&lt;div class="story"&gt;';
html +=  story;
html +=  '&lt;/div&gt;&lt;/div&gt;';
    }); //close each()
html += '&lt;/div&gt;';
$('#mysite').html(html);
}, "xml");
});</pre></div></div></div><div class="section" title="XSLT"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec119"/>XSLT</h2></div></div></div><p>Hang on in there just a little longer. JSON is just around the corner. Only one more XML technology to add to our arsenal!</p><p>Imagine two banks that create a lot of data, as banks do. Both banks use XML, and both have crafted an XML Schema file so that the formats of the XML files are extremely well defined. Now, imagine that one<a id="id698" class="indexterm"/> bank acquires the other one and inherits all that data that is in the other XML format: this is a disaster in the making. Not to worry, XSLT to the rescue!</p><p>
<span class="strong"><strong>eXtensible Stylesheet Language Transformation</strong></span> (<span class="strong"><strong>XSLT</strong></span>) is a language that can be used to translate an XML<a id="id699" class="indexterm"/> file into another XML file. What is required is an XSLT engine and an XSL file, which describes how the one file has to be transformed into the other. All kinds of calculations can occur in the process of transforming as it is a full blown programming language. The thickest book I have on a single web development topic is an XSLT guide.</p><p>XSL files are referred to as stylesheets. They are not CSS files, but the term stylesheet is not misplaced at all. If we take an XML file and transform it to an HTML file, then we actually created a view for the XML file that goes beyond what we can do with only a CSS file. Rather than creating an XSL file for the <code class="literal">california.xml</code> example, here is an XSL stylesheet that translates the <code class="literal">practical.xml</code> file into the exact same HTML as the SimpleXML example. If you analyze what is inside, you could dissect it into three parts: which parts of the file to apply a rule (template) to, what the rules are, and inside all that, plain HTML.</p><p>Here is an XSLT example:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;xsl:stylesheet version="1.0"
  &gt;
  &lt;xsl:output method="html"/&gt;
  &lt;xsl:template match="/"&gt;
  &lt;div id="overview"&gt;
       &lt;xsl:apply-templates select="/photocollection"/&gt;
  &lt;/div&gt;
  &lt;div id="gallery"&gt;
  &lt;xsl:apply-templates select="/photocollection/photo"/&gt;
   &lt;/div&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="photocollection"&gt;
  &lt;h1&gt;
  &lt;xsl:value-of select="title"/&gt;
  &lt;/h1&gt;
  &lt;p&gt;
  &lt;xsl:value-of select="overview"/&gt;
  &lt;/p&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:template match="photo"&gt;
  &lt;div class="storybook"&gt;
  &lt;div class="smallmat"&gt;
    &lt;div class="simage"&gt;
    &lt;a&gt;
    &lt;xsl:attribute name="href"&gt;
    &lt;xsl:value-of select="largeimg"/&gt;
    &lt;/xsl:attribute&gt;
    &lt;img class="sphoto"&gt;
    &lt;xsl:attribute name="src"&gt;
    &lt;xsl:value-of select="smallimg"/&gt;
    &lt;/xsl:attribute&gt;
     &lt;xsl:attribute name="title"&gt;
    &lt;xsl:value-of select="caption"/&gt;
    &lt;/xsl:attribute&gt;
    &lt;/img&gt;
    &lt;/a&gt;
    &lt;/div&gt;
    &lt;div class="scaption"&gt;
    &lt;xsl:value-of select="scaption"/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="story"&gt;
    &lt;xsl:value-of select="story"/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></div><p>This is the <a id="id700" class="indexterm"/>PHP file to handle<a id="id701" class="indexterm"/> the transformation:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="utf-8" /&gt;
&lt;title&gt;June Lake Gallery&lt;/title&gt;
&lt;link href="styles/practical.css" rel="stylesheet" type="text/css" media="screen"/&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="mysite"&gt;
&lt;?php
$xslt = new XSLTProcessor;
$xmlfile = "practical.xml";
$xslfile = "practical.xsl";
if (!file_exists($xmlfile)) {

    exit('Failed to open practical.xml.');
}
$xml = new DOMdocument;
$xml-&gt;load($xmlfile);
$xsl = new DOMdocument;
$xsl-&gt;load($xslfile);
$xslt-&gt;importStyleSheet($xsl);
printf("%s",$xslt-&gt;transformToXML($xml));
?&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></div></div></div>
<div class="section" title="JSON"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec74"/>JSON</h1></div></div></div><p>
<span class="strong"><strong>JavaScript Object Notation</strong></span> (<span class="strong"><strong>JSON</strong></span>) is the other data interchange format discussed in this chapter. Like XML, it is text-based and human readable, but it also more lightweight than its counterpart. Data<a id="id702" class="indexterm"/> sent in the JSON format will take up a lot less bandwidth when data is sent over a network connection. It is used more and more in web applications today. XML files are heavier - just notice how many pages we needed to provide some examples, and requires a parser of some sort to process the data.</p><p>JSON is derived from JavaScript, and JSON code looks a lot like JavaScript objects, but there are subtle differences. However, JavaScript can be used to process JSON data, so you would not need a separate parser, as is the case with XML. Here is the same data from the <code class="literal">california.xml</code> example, but in the JSON format:</p><div class="informalexample"><pre class="programlisting">[
   {
    "name":"Adams",
     "first":"Ansel",
     "profession":"photographer",
     "born":"San Francisco"
  },
  {
    "name":"Muir",
     "first":"John",
     "profession":"naturalist",
     "born":"Scotland"
  },
  {
    "name":"Schwarzenegger",
     "first":"Arnold",
     "profession":"governator",
     "born":"Germany"

  },
  {
    "name":"Rowell",
     "first":"Galen",
     "profession":"photographer",
     "born":"Oakland CA"
  },
  {
    "name":"Wellens",
     "first":"Paul",
     "profession":"author",
     "born":"Belgium"

  }
]</pre></div><p>Notice first of all how much easier to read this is compared to its XML counterpart. It looks like an array of JavaScript objects containing key:value pairs, and that is almost what this is. In the <a id="id703" class="indexterm"/>discussion on objects in <a class="link" href="ch04.html" title="Chapter 4. JavaScript">Chapter 4</a>, <span class="emphasis"><em>JavaScript</em></span>, we had an example with the name of John Williams in it, and a hint to the JSON format. The key difference (<span class="emphasis"><em>key</em></span> being a key word here) is that, in JSON, the keys also have to be surrounded by double quotes. So, in the land of JSON, <code class="literal">name:"Williams"</code> would be incorrect. Let's go over the simple structure of the JSON data format. You may want to take a piece of paper and draw a little diagram for each rule.</p><div class="section" title="JSON syntax"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec120"/>JSON syntax</h2></div></div></div><p>JSON data is plain text. JSON text consists of a sequence of characters that is encoded in Unicode and that conforms to the<a id="id704" class="indexterm"/> <span class="strong"><strong>JSON value syntax</strong></span>. So, simply said, every piece of JSON data has to be a <a id="id705" class="indexterm"/>valid JSON value. There are six tokens that have a special meaning in JSON: <code class="literal">[</code>, <code class="literal">{</code>, <code class="literal">]</code>, <code class="literal">}</code> , <code class="literal">:</code>, and<code class="literal">,</code>. There are also three name tokens that have a special meaning to JSON: <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>. These tokens are use to compose correct JSON values.</p><div class="section" title="JSON values"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec57"/>JSON values</h3></div></div></div><p>A JSON <span class="strong"><strong>value</strong></span> can be an <a id="id706" class="indexterm"/>object, array, number, or string or one of true, false, or null. These are the building blocks of well-formatted JSON data.</p></div><div class="section" title="JSON objects"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec58"/>JSON objects</h3></div></div></div><p>A JSON <span class="strong"><strong>object</strong></span> begins with a left curly brace and ends with a right curly brace. Inside, there will be zero or<a id="id707" class="indexterm"/> more key:value pairs, separated by commas. The key or name is a JSON string. There is a semicolon in between the key and the value. The value itself can be any valid JSON value.</p></div><div class="section" title="JSON strings"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec59"/>JSON strings</h3></div></div></div><p>A JSON <span class="strong"><strong>string</strong></span> begins<a id="id708" class="indexterm"/> and ends with double quotes. Single quotes cannot be used to delimit strings. However, you could have a single quote in the middle of a string. If you need a double quote, you will have to escape it with a backslash ( <code class="literal">\</code> ). Other two-character escape sequences are, inevitably, <code class="literal">\\</code>, <code class="literal">\/</code>, <code class="literal">\b</code>, <code class="literal">\f</code>, <code class="literal">\n</code>, <code class="literal">\r</code>, and <code class="literal">\t</code>. You can also use a 4-digit Unicode code of any character by having it preceded by <code class="literal">\u</code>.</p></div><div class="section" title="JSON arrays"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec60"/>JSON arrays</h3></div></div></div><p>A JSON <span class="strong"><strong>array</strong></span> is a<a id="id709" class="indexterm"/> pair of square brackets surrounding zero or more values, separated by a comma. The example seen previously is actually a JSON array that contains four JSON objects, in turn containing four key:value pairs each.</p></div><div class="section" title="JSON numbers"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec61"/>JSON numbers</h3></div></div></div><p>A JSON <span class="strong"><strong>number</strong></span> is always<a id="id710" class="indexterm"/> decimal without a leading zero. There can be a minus sign in front and a <code class="literal">.</code> as the floating point. It may have an exponent of ten, prefixed by <code class="literal">e</code> or <code class="literal">E</code>.</p></div></div><div class="section" title="JSON and PHP"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec121"/>JSON and PHP</h2></div></div></div><p>If you use PHP <a id="id711" class="indexterm"/>on the server side, for example, to retrieve your data from a MySQL database, and you <a id="id712" class="indexterm"/>would like to convert the data to the JSON format, this can be done easily. Simply create a PHP array containing the data. A very convenient function, <code class="literal">json_encode()</code>, is available, which takes a PHP array and converts it into a string that contains JSON data (notice I did not write a JSON string). There is also a function that does the opposite and translates JSON data into a PHP array: <code class="literal">json_decode()</code>.</p><p>Here is some sample PHP code that will convert a PHP array into a PHP string that contains the same JSON array as the one in our <code class="literal">californiapeople</code> example. If this is part of a <code class="literal">.php</code> file <a id="id713" class="indexterm"/>you access from a jQuery Ajax call, you can process it as JSON on the client side. Just make sure you specify <code class="literal">json</code> as the datatype:</p><div class="informalexample"><pre class="programlisting">$californiapeople =  array  (
     array
     (
     "name"=&gt;"Adams",
     "first"=&gt;"Ansel",
    "profession" =&gt; "photographer",
    "born" =&gt; "San Francisco"),
     array
    (
     "name"=&gt;"Muir",
     "first"=&gt;"John",
     "profession" =&gt; "naturalist",
    "born" =&gt; "Scotland"),
    array
    (
     "name"=&gt;"Schwarzenegger",
     "first"=&gt;"Arnold",
     "profession" =&gt; "governator",
     "born" =&gt; "Germany"),
    array
    (
     "name"=&gt;"Wellens",
     "first"=&gt;"Paul",
     "profession" =&gt; "author",
    "born" =&gt; "Belgium")
  );
echo   json_encode($californiapeople);</pre></div></div><div class="section" title="JSON with Ajax and jQuery"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec122"/>JSON with Ajax and jQuery</h2></div></div></div><p>To conclude this chapter, we <a id="id714" class="indexterm"/>will recreate our photo gallery example<a id="id715" class="indexterm"/> that we used to demonstrate how XML can be processed on the client site to dynamically<a id="id716" class="indexterm"/> generate HTML. This<a id="id717" class="indexterm"/> time, we will use JSON as the data format. Let's start with our meaner and leaner data, which will reside on the server as <code class="literal">practical.json</code>. Note that it consists of a JSON object with a single key:value pair, with another object as the value with four key:value pairs, of which the last one is an array.</p><p>Once again, this<a id="id718" class="indexterm"/> is easier to read than its XML counterpart:</p><div class="informalexample"><pre class="programlisting">{
  "photocollection": {
    "title": "June Lake",
    "overview": "The June Lake Loop begins  ...",
    "photo": [
      {
        "scaption": "June Lake in the Fall",
        "caption": "June Lake and Carson Peak in the fall",
        "story": "Each time that unfortunate day  ...",
        "smallimg": "imagessmall/junelakefall.jpg",
        "largeimg": "imagespng/junelakeinthefall.png"
      },
      {
        "scaption": "Aspen by Silver Lake",
        "caption": "Aspen trees by Silver Lake",
        "story": "In 1998, I hit the right week of the ...",
        "smallimg": "imagessmall/silverlakeaspenfall98.jpg",
        "largeimg": "imagespng/silverlakeaspenfall98.png"
      },
      {
        "scaption": "Gull Lake in the Fall",
        "caption": "Gull Lake in the Fall - Happy fishermen !",
        "story": "If you take the north shore road around ...",
        "smallimg": "imagessmall/gulllake648.jpg",
        "largeimg": "imageslarge/gulllake648.jpg"
      },
      {
        "scaption": "Silver Lake",
        "caption": "Silver Lake - June Lake Loop",
        "story": "Any time of the year, there ...",
        "smallimg": "imagessmall/silver2.jpg",
        "largeimg": "imagespng/silver2.png"
      }
    ]
  }
}</pre></div><p>The HTML file for<a id="id719" class="indexterm"/> this is the same as for the XML example: we only need to change what is inside the<a id="id720" class="indexterm"/> JavaScript file. Here we will use a convenient jQuery<a id="id721" class="indexterm"/> function, <code class="literal">.getJSON()</code>, another shortcut of <code class="literal">.ajax()</code>. It returns a JSON object, which we can can in turn process with regular JavaScript, making the code itself simpler:</p><div class="informalexample"><pre class="programlisting">$(document).ready (function () {
$.getJSON( "practical.json", function( json ) {
// For debugging:
//var jsonString = JSON.stringify(json)
//alert(jsonString);
var html = '&lt;div id="overview"&gt;&lt;h1&gt;' + json.photocollection.title + '&lt;/h1&gt;';
html += '&lt;p&gt;' + json.photocollection.overview + '&lt;/p&gt;&lt;/div&gt;';
html += '&lt;div id="gallery"&gt;';
// Use jQuery .each() function to loop through array
$(json.photocollection.photo).each(function()
{
html += '&lt;div class="storybook"&gt;&lt;div class="smallmat"&gt;&lt;div class="simage"&gt;&lt;a href="';
var scaption = this.scaption;
var caption = this.caption;
var largeimg = this.largeimg;
var smallimg = this.smallimg;
var story = this.story;
html += largeimg;
html += '"&gt;&lt;img class="sphoto" src="';
html += smallimg;
html += '" title="';
html +=  caption;
html += '"&gt;&lt;/img&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class="scaption"&gt;';
html +=  scaption;
html += '&lt;/div&gt;&lt;/div&gt;&lt;div class="story"&gt;';
html +=  story;
html +=  '&lt;/div&gt;&lt;/div&gt;';
}
);
html += '&lt;/div&gt;';
$('#mysite').html(html);
});
});</pre></div><p>Rather than <a id="id722" class="indexterm"/>using the<a id="id723" class="indexterm"/> jQuery <code class="literal">.each()</code> function, we could also have<a id="id724" class="indexterm"/> used a plain JavaScript <code class="literal">for</code>
<a id="id725" class="indexterm"/> loop:</p><div class="informalexample"><pre class="programlisting">for (var i in json.photocollection.photo)
{
. . .
var scaption = json.photocollection.photo[i].scaption;
. . .
}</pre></div></div><div class="section" title="Two useful JSON methods"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec123"/>Two useful JSON methods</h2></div></div></div><p>To conclude, we will mention two JavaScript methods that are part of the JSON object, and are supported by <a id="id726" class="indexterm"/>most browsers.</p><p>To convert a JSON string<a id="id727" class="indexterm"/> into a JavaScript object, you simply pass the JSON string into the <code class="literal">JSON.parse()</code> method, like this:</p><div class="informalexample"><pre class="programlisting">var jsObject = JSON.parse(jsonString);</pre></div><p>
<code class="literal">JSON.stringify()</code> can<a id="id728" class="indexterm"/> be used to do the opposite and convert a JavaScript object into a JSON string. In our example, we could have used the following, which is handy for debugging purposes:</p><div class="informalexample"><pre class="programlisting">var jsonString = JSON.stringify(json)
alert(jsonString);</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec75"/>Summary</h1></div></div></div><p>In this chapter, we introduced two data formats that are used in web development. XML is used throughout in the industry to exchange data in a format that both humans and computers can read. We can use an XML file as a small database and several XML-based technologies exist to assist us, such as XML Schema, to firmly define the structure of an XML file, and XSLT to create a stylesheet to convert an XML file into another XML file, which might well be a web page. XML files can also be processed and created in PHP using SimpleXML.</p><p>JSON is the leaner and meaner format in vogue with web developers. It requires less bandwidth than XML, which is extremely beneficial when the amount of data increases. As JSON data can be processed like JavaScript objects, no additional processing code or engine is required when JSON is used.</p><p>Now, wouldn't it be nice if our data could be stored on the server in JSON as well, so none of these conversions from one format to another are needed? Yes, it would. Can we do this? Yes, we can. Just go to the next chapter.</p></div></body></html>