<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">The Drupal CLI</h1>
                </header>
            
            <article>
                
<p>There are two command-line tools for Drupal 8: <strong>Drupal Console</strong> and <strong>Drush</strong>. In this chapter, we will discuss how they make working with Drupal easier by covering the following recipes:</p>
<ul>
<li>Rebuilding cache in Drupal Console or Drush</li>
<li>Using Drush to interact with the database</li>
<li>Debugging Drupal using Drupal Console</li>
<li>Scaffolding code through Drupal Console</li>
<li>Making a Drush command</li>
<li>Making a Drupal Console command</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>In the previous chapters of this book, there have been recipes that provide ways of using command-line tools to simplify working with Drupal. There are two contributed projects that provide Drupal with a command-line interface experience.</p>
<p>First, there is Drush. Drush was first created for Drupal 4.7 and has become an integral tool used for day-to-day Drupal operations. However, with Drupal 8 and its integration with Symfony, there came Drupal Console. Drupal Console is a Symfony Console-based application that allows it to reuse more components and integrate more easily with contributed modules.</p>
<p>This chapter contains recipes that will highlight operations that can be simplified using Drush or Console. By the end of this chapter, you will be able to work with your Drupal sites through the command line.</p>
<div class="packt_infobox">
<p>At the time of writing this book, Drush was still the primary tool of choice for Drupal 8; however, Drupal Console is earning more market share. Drupal Console is rapidly being developed. Due to this rapid development, the commands will still exist, but the output may differ.</p>
</div>
<p>Both Drush and Drupal Console support global installation, but both projects are migrating to per-project installation using Composer. To get started, refer to the following installation guides for each tool for up-to-date installation information:</p>
<ul>
<li><strong>Drush</strong>: <a href="http://docs.drush.org/en/master/install/">http://docs.drush.org/en/master/install/</a></li>
<li><strong>Drupal Console</strong>: <a href="https://docs.drupalconsole.com/en/getting/project.html">https://docs.drupalconsole.com/en/getting/project.html</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Rebuilding cache in Drupal Console or Drush</h1>
                </header>
            
            <article>
                
<p>Drupal utilizes caching to store plugin definitions, routes, and so on. When you add a new plugin definition or a new route, you need to rebuild Drupal's cache for it to be recognized.</p>
<p>Rebuilding the cache over the command line is also more performant than using the user interface since it does not use web server resources to execute the cache rebuild.</p>
<p>In this recipe, we will walk you through using both Drush and Drupal Console to clear various cache bins in Drupal. It is important to know how to clear specific cache bins so that you do not need to rebuild everything, if possible.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<ol>
<li>Open a terminal and navigate to an installed Drupal directory.</li>
<li>We use the <kbd>cache-rebuild</kbd> command in Drush to rebuild all of Drupal's caches, including routes:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush cache-rebuild</strong><br/>Cache rebuild complete.</pre>
<ol start="3">
<li>In Drupal Console, we use the <kbd>cache:rebuild</kbd> command to clear specific cache bins. The input uses autocomplete to help specify a specific cache bin to clear. In this example, we clear the render cache:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drupal cache:rebuild all</strong><br/><strong> Select cache. [all]:</strong><br/><strong> &gt; render</strong><br/> Rebuilding cache(s), wait a moment please.<br/> [OK] Done clearing cache(s). </pre>
<ol start="4">
<li>If we only need to rebuild our routes in Drupal, we can use the <kbd>router:rebuild</kbd> command in Console. This will keep render, discovery, and other caches, but expose new routes:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drupal router:rebuild</strong><br/> Rebuilding routes, wait a moment please<br/> [OK] Done rebuilding route(s).</pre>
<ol start="5">
<li>Drush provides <kbd>twig-compile</kbd> to rebuild templates. Passing the verbose option displays templates being compiled:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush twig-compile --verbose</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>Both Drush and Drupal Console will load files from the Drupal installation and bootstrap the application. This allows the commands to invoke functions and methods found in Drupal.</p>
<p>For Drush 8.x, Drush does not implement the dependency injection container and still needs to rely on procedural functions in Drupal.</p>
<p>Drupal Console, however, harnesses the dependency injection container, allowing it to reuse Drupal's container and services.</p>
<p>The <em>Making a Drush command</em> and <em>Making a Drupal Console command</em> recipes will describe the differences in more detail.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span>The</span> Drush documentation at <a href="http://docs.drush.org/en/master/">http://docs.drush.org/en/master/</a></li>
<li>The Drupal Console documentation at <a href="https://docs.drupalconsole.com/">https://docs.drupalconsole.com/</a></li>
<li><span>The</span> Drush command cheat sheet at <a href="https://drushcommands.com/">https://drushcommands.com/</a></li>
<li><span>The</span> Drupal Console command cheat sheet at <a href="http://drupalconsole.com/cheatsheet/">http://drupalconsole.com/cheatsheet/</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Drush to interact with the database</h1>
                </header>
            
            <article>
                
<p>When working with any application that utilizes a database, there are times when you will need to export a database and import it elsewhere. Most often, you would do this with a production site to work on it locally. This way, you can create a new configuration that can be exported and pushed to production, as discussed in <a href="b2659986-a8dc-4503-a043-6071ab7b6722.xhtml"><em>Chapter 9</em></a>, <em>Configuration Management – Deploying in Drupal 8</em>.</p>
<p>In this recipe, we will export a database dump from a production site in order to set up the local development. The database dump will be imported over the command line and sanitized. We will then execute an SQL query through Drush to verify sanitization.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Drush has the ability to use site aliases. Site aliases are configuration items that allow you to interact with a remote Drupal site. In this recipe, we will use the following alias to interact with a fictional remote site to show how a typical workflow will go to fetch a remote database.</p>
<p>Note that you do not need to use a Drush alias to download the database dump created in the recipe; you can use any method you are familiar with (manually from the command line with <kbd>mysqldump</kbd> or <kbd>phpMyAdmin</kbd>):</p>
<p> </p>
<pre><strong>$aliases['drupal.production'] = [<br/>  'uri' =&gt; 'example.com',<br/>  'remote-host' =&gt; 'example.com',<br/>  'remote-user' =&gt; 'someuser',<br/>  'ssh-options' =&gt; '-p 2222',<br/>];</strong></pre>
<div class="packt_infobox">
<p>Read the Drush documentation for more information on site aliases at <a href="http://docs.drush.org/en/master/usage/#site-aliases">http://docs.drush.org/en/master/usage/#site-aliases</a>. Site aliases allow you to interact with remote Drupal installations.</p>
</div>
<p>We will also assume that the local development site has not yet been configured to connect it to the database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>We will use the <kbd>sql-dump</kbd> command to export the database into a file. The command returns the output that needs to be redirected to a file:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush @drupal.production sql-dump &gt; ~/prod-dump.sql </strong></pre>
<ol start="2">
<li>Navigate to your local Drupal site's directory and copy <kbd>sites/default/default.settings.php</kbd> to <kbd>sites/default/settings.php</kbd>.</li>
<li>Edit the new <kbd>settings.php</kbd> file and add a database configuration array at the end of the file; this will be the database used by Drupal:</li>
</ol>
<pre style="padding-left: 60px"><span>// Database configuration.<br/></span><strong>$databases['default']['default'] = [<br/>  'driver' =&gt; 'mysql',<br/>  'host' =&gt; 'localhost',<br/>  'username' =&gt; 'mysql',<br/>  'password' =&gt; 'mysql',<br/>  'database' =&gt; 'data',<br/>  'prefix' =&gt; '',<br/>  'port' =&gt; 3306,<br/>  'namespace' =&gt; 'Drupal\\Core\\Database\\Driver\\mysql',<br/>];</strong></pre>
<ol start="4">
<li>Using the <kbd>sql-cli</kbd> command, we can import the database dump that we created:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush sql-cli &lt; ~/prod-dump.sql</strong> </pre>
<ol start="5">
<li>The <kbd>sql-sanitize</kbd> command allows you to obfuscate user emails and passwords in the database:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush sql-sanitize</strong></pre>
<ol start="6">
<li>To verify that our information is imported sanitized, we will use the <kbd>sql-query</kbd> command to run a query against the database:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush sql-query "SELECT uid, name, mail FROM users_field_data;"</strong> </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>When working with Drush, we have the ability to use Drush aliases. A Drush alias contains a configuration that allows the tool to connect to a remote server and interact with that server's installation of Drush.</p>
<div class="packt_infobox">
<p>You need to have Drush installed on your remote server in order to use a site alias for it.</p>
</div>
<p>The <kbd>sql-dump</kbd> command executes the proper dump command for the database driver, which is typically MySQL and the <kbd>mysqldump</kbd> command. It streams to the terminal and must be piped to a destination. When piped to a local SQL file, we can import it and execute the create commands to import our database schema and data.</p>
<div class="packt_tip">The <kbd>sql-dump</kbd> command supports a <kbd>--result-file</kbd> option; however, that saves the file relative to the Drupal installation.</div>
<p>With the <kbd>sql-cli</kbd> command, we will be able to execute SQL commands to the database through Drush. This allows us to redirect the file contents to the <kbd>sql-cli</kbd> command and run the set of SQL commands. With the data imported, the <kbd>sql-sanitize</kbd> command replaces usernames and passwords.</p>
<p>Finally, the <kbd>sql-query</kbd> command allows us to pass an SQL command directly to the database and return its results. In our recipe, we will query the <kbd>users_field_data</kbd> to verify that we imported our users and that emails have been sanitized.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more…</h1>
                </header>
            
            <article>
                
<p style="margin-bottom: .0001pt" class="NormalPACKT">Working with Drupal over the command line simplifies working with the database. We will explore this in more detail in the following sections.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using gzip with sql-dump</h1>
                </header>
            
            <article>
                
<p>Sometimes, databases can be quite large. The <kbd>sql-dump</kbd> command has a <kbd>gzip</kbd> option that will output the SQL dump using the <kbd>gzip</kbd> command. In order to run the command, you would simply:</p>
<pre><strong>$ drush sql-dump –-gzip dump.sql.gz</strong></pre>
<p>The end result provides a reduction in the dump file:</p>
<pre>-rw-r--r--   1 user  group  3058522 Jan 14 16:10 dump.sql<br/>-rw-r--r--   1 user  group   285880 Jan 14 16:10 dump.sql.gz</pre>
<div class="packt_tip">
<p>If you create a gzipped database dump, ensure that you unarchive it before attempting an import with the <kbd>sql-cli</kbd> command.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Console to interact with the database</h1>
                </header>
            
            <article>
                
<p>At the time of writing this book, Console does not provide a command for sanitizing the database. The feature is currently documented in this issue; refer to <a href="https://github.com/hechoendrupal/drupal-console/issues/3192">https://github.com/hechoendrupal/drupal-console/issues/3192</a>.</p>
<p>The <kbd>database:connect</kbd> and <kbd>database:client</kbd> commands will launch a database client. This allows you to be logged into the database's command-line interface:</p>
<pre><strong>$ drupal database:client</strong><br/><strong>$ drupal database:connect</strong> </pre>
<p>These commands are similar to the <kbd>sql-cli</kbd> and <kbd>sql-connect</kbd> commands from Drush. The client command will bring you to the database's command-line tool, where connect shows the connection string.</p>
<p>Drupal Console also provides the <kbd>database:dump</kbd> command. Unlike Drush, this will write the database dump for you in the Drupal directory:</p>
<pre><strong>$ drupal database:dump</strong><br/>  [OK] Database exported to: /path/to/drupal/www/data.sql </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Drush to manage users</h1>
                </header>
            
            <article>
                
<p>When you need to add an account to Drupal, you will visit the <kbd>People</kbd> page and manually add a new user. Drush provides the complete user management for Drupal, from creation to role assignment, password recovery, and deletion. This workflow allows you to create users easily and provides them with a login without having to enter your Drupal site.</p>
<p>In this recipe, we will create a <kbd>staff</kbd> role with a <kbd>staffmember</kbd> user and log in as that user through Drush.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<ol>
<li>Use the <kbd>role-create</kbd> command to create a new role labeled <kbd>staff</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush role-create staff</strong><br/> Created "staff" </pre>
<ol start="2">
<li>Use the <kbd>role-lists</kbd> command to verify that the role was created in Drupal:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush role-list</strong><br/><strong>ID Role Label </strong><br/><strong>anonymous Anonymous user </strong><br/><strong>authenticated Authenticated user </strong><br/><strong>administrator Administrator </strong><br/><strong>staff Staff</strong></pre>
<ol start="3">
<li>The <kbd>user-create</kbd> command will create our user:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush user-create staffmember</strong><br/><strong>User ID : 2 </strong><br/><strong>User name : staffmember </strong><br/><strong>User roles : authenticated </strong><br/><strong>User status : 1</strong> </pre>
<ol start="4">
<li>In order to add the role, we will need to use the <kbd>user-add-role</kbd> command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush user-add-role staff staffmember</strong><br/>Added role staff role to staffmember</pre>
<ol start="5">
<li>We will now log in as the <kbd>staffmember</kbd> user using the <kbd>user-login</kbd> command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush user-login staffmember --uri=http://example.com</strong><br/><strong>http://example.com/user/reset/2/1452810532/Ia1nJvbr2UQ3Pi_QnmITlVgcCWzDtnKmHxf-I2eAqPE</strong></pre>
<ol start="6">
<li>Copy the link and paste it in your browser to log in as that user:</li>
</ol>
<p class="packt_figref CDPAlignCenter CDPAlign"><img class="image-border" src="assets/b3a686e6-bda2-4ac7-ad43-563d2efd7b06.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>When you reset a password in Drupal, a special one-time login link is generated. The login link is based on a generated hash. The Drush command validates the given user, which exists in the Drupal site, and then passes it to the <kbd>user_pass_reset_url</kbd> function from the User module.</p>
<p>The URL is made up of the user's ID, the timestamp when the link was generated, and a hash based on the user's last login time, link generation, and email. When the link is loaded, this hash is rebuilt and verified. For example, if the user has logged in since the time it was generated, the link will become invalid.</p>
<p>When used on a machine that has a web browser installed, Drush will make an attempt to launch the link in a web browser for you. The browser option allows you to specify which browser should be launched. Additionally, you can use no-browser to prevent one from being launched.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more…</h1>
                </header>
            
            <article>
                
<p style="margin-bottom: .0001pt" class="NormalPACKT">The command line offers the ability to simplify user management and user administration. Next, we will explore more on this topic in detail.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Advanced user-login use cases</h1>
                </header>
            
            <article>
                
<p>The <kbd>user-login</kbd> command is a useful tool that allows some advanced use cases. For instance, you can append a path after the username and be launched to that path. You can pass a UID or email instead of a username in order to log in as a user.</p>
<p>You can use the <kbd>user-login</kbd> to secure your admin user account. In Drupal, the user with the identifier of 1 is treated as the root and can bypass all permissions. Many times, this is the default maintenance account used to work on the Drupal site. Instead of logging in manually, you can set the account to a very robust passphrase and use the <kbd>user-login</kbd> command when you need to access your site. With this, the only users who should be able to log in as the administrator account are those with access to run the Drush commands on the website.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Drupal Console</h1>
                </header>
            
            <article>
                
<p>Drupal Console also provide commands to interact with users. Although they do not allow the creation of users or roles, they provide a basic user management.</p>
<p>The <kbd>user:login:url</kbd> command will generate a one-time login link for the specified user ID. This uses the same methods as the Drush command:</p>
<pre><strong>$ drupal user:login:url 2</strong></pre>
<p>The <kbd>user:password:reset</kbd> command allows you to reset a user's password to the new provided password. You can provide the user ID and new password as arguments, but if missing, the values will be prompted for interactively:</p>
<pre><strong>$ drupal user:password:reset 2 newpassword</strong></pre>
<p>The <kbd>create:users</kbd> command provides an interactive way to generate bulk users, which are useful for debugging. However, it cannot create individual users with specific passwords like Drush.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scaffolding code through Console</h1>
                </header>
            
            <article>
                
<p>When Drupal Console was first introduced, one of the biggest highlights was its ability to scaffold code. The project has turned into a much larger Drupal runner over the command-line interface, but much of its resourcefulness is code generation.</p>
<p>As you may have noted in the previous chapters and recipes, there can be a few mundane tasks and a bit of boilerplate code. Drupal Console enables Drupal developers to create various components without having to write all of the boilerplate code.</p>
<p>In <a href="2f5fe169-0ba6-4746-9586-896f00f0bb28.xhtml">Chapter 10</a>, <em>The Entity API</em>, we covered the creation of a custom entity type. In this recipe, we will automate most of that process using Drupal Console to generate our content entity.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p style="margin-bottom: .0001pt" class="NormalPACKT">For this recipe, you will need to have Drupal Console installed. The tool will generate everything else for us. You will need to have a Drupal 8 site installed. Many of Console's commands will not work (or be listed) unless they can access an installed Drupal site. This is because of the way it interacts with Drupal's service container.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<ol>
<li>From the root of your Drupal site, generate a module with the <kbd>generate:module</kbd> command and follow the interactive process. Use the defaults prompted as well as giving it a module name:</li>
</ol>
<pre style="padding-left: 60px" class="p1"><span class="s1">$ drupal generate:module<br/></span><span class="s1"> // Welcome to the Drupal module generator<br/></span><span class="s2"> </span><span class="s1">Enter the new module name</span><span class="s2">:<br/></span><span class="s1"> &gt; Content Entity Provider<br/></span><span class="s2"><br/> </span><span class="s1">Enter the module machine name</span><span class="s2"> [</span><span class="s3">content_entity_provider</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Enter the module Path</span><span class="s2"> [</span><span class="s3">/modules/custom</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Enter module description</span><span class="s2"> [</span><span class="s3">My Awesome Module</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Enter package name</span><span class="s2"> [</span><span class="s3">Custom</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Enter Drupal Core version</span><span class="s2"> [</span><span class="s3">8.x</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Do you want to generate a .module file (yes/no)</span><span class="s2"> [</span><span class="s3">yes</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Define module as feature (yes/no)</span><span class="s2"> [</span><span class="s3">no</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Do you want to add a composer.json file to your module (yes/no)</span><span class="s2"> [</span><span class="s3">yes</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Would you like to add module dependencies (yes/no)</span><span class="s2"> [</span><span class="s3">no</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Do you want to generate a unit test class (yes/no)</span><span class="s2"> [</span><span class="s3">yes</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Do you want to generate a themeable template (yes/no)</span><span class="s2"> [</span><span class="s3">yes</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s2"> </span><span class="s1">Do you confirm generation? (yes/no)</span><span class="s2"> [</span><span class="s3">yes</span><span class="s2">]:<br/></span><span class="s1"> &gt; <br/><br/></span><span class="s1">Generated or updated files<br/></span><span class="s4"> 1 -</span><span class="s1"> modules/custom/content_entity_provider/content_entity_provider.info.yml<br/></span><span class="s4"> 2 -</span><span class="s1"> modules/custom/content_entity_provider/content_entity_provider.module<br/></span><span class="s4"> 3 -</span><span class="s1"> modules/custom/content_entity_provider/composer.json<br/></span><span class="s4"> 4 -</span><span class="s1"> modules/custom/content_entity_provider/tests/src/Functional/LoadTest.php<br/></span><span class="s4"> 5 -</span><span class="s1"> modules/custom/content_entity_provider/content_entity_provider.module<br/></span><span class="s4"> 6 -</span><span class="s1"> modules/custom/content_entity_provider/templates/content-entity-provider.html.twig</span></pre>
<ol start="2">
<li>Next, we will generate our <kbd>content</kbd> entity. Specify the module name that will provide the entity:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root">$ drupal generate:entity:content<br/>Enter the module name [devel]:<br/>&gt; content_entity_provider<br/><br/>Enter the class of your new content entity [DefaultEntity]:<br/>&gt; CustomContentEntity<br/><br/>Enter the machine name of your new content entity [custom_content_entity]:<br/>&gt;<br/><br/>Enter the label of your new content entity [Custom content entity]:<br/>&gt;<br/><br/>Enter the base-path for the content entity routes [/admin/structure]:<br/>&gt; <br/><br/>Do you want this (content) entity to have bundles (yes/no) [no]:<br/>&gt;<br/><br/>Is your entity translatable (yes/no) [yes]:<br/>&gt;<br/><br/>Is your entity revisionable (yes/no) [yes]:<br/>&gt;<br/><br/>Generated or updated files<br/>1 - modules/custom/content_entity_provider/content_entity_provider.permissions.yml<br/>2 - modules/custom/content_entity_provider/content_entity_provider.links.menu.yml<br/>3 - modules/custom/content_entity_provider/content_entity_provider.links.task.yml<br/>4 - modules/custom/content_entity_provider/content_entity_provider.links.action.yml<br/>5 - modules/custom/content_entity_provider/src/CustomContentEntityAccessControlHandler.php<br/>6 - modules/custom/content_entity_provider/src/CustomContentEntityTranslationHandler.php<br/>7 - modules/custom/content_entity_provider/src/Entity/CustomContentEntityInterface.php<br/>8 - modules/custom/content_entity_provider/src/Entity/CustomContentEntity.php<br/>9 - modules/custom/content_entity_provider/src/CustomContentEntityHtmlRouteProvider.php<br/>10 - modules/custom/content_entity_provider/src/Entity/CustomContentEntityViewsData.php<br/>11 - modules/custom/content_entity_provider/src/CustomContentEntityListBuilder.php<br/>12 - modules/custom/content_entity_provider/src/Form/CustomContentEntitySettingsForm.php<br/>13 - modules/custom/content_entity_provider/src/Form/CustomContentEntityForm.php<br/>14 - modules/custom/content_entity_provider/src/Form/CustomContentEntityDeleteForm.php<br/>15 - modules/custom/content_entity_provider/custom_content_entity.page.inc<br/>16 - modules/custom/content_entity_provider/templates/custom_content_entity.html.twig<br/>17 - modules/custom/content_entity_provider/src/Form/CustomContentEntityRevisionDeleteForm.php<br/>18 - modules/custom/content_entity_provider/src/Form/CustomContentEntityRevisionRevertTranslationForm.php<br/>19 - modules/custom/content_entity_provider/src/Form/CustomContentEntityRevisionRevertForm.php<br/>20 - modules/custom/content_entity_provider/src/CustomContentEntityStorage.php<br/>21 - modules/custom/content_entity_provider/src/CustomContentEntityStorageInterface.php<br/>22 - modules/custom/content_entity_provider/src/Controller/CustomContentEntityController.php</pre>
<ol start="3">
<li>Install your module using Drupal Console:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root">$ drupal module:install content_entity_provider<br/> Installing module(s) "content_entity_provider"<br/><br/> [OK] The following module(s) were installed successfully: "content_entity_provider" <br/>                                                               // cache:rebuild<br/>Rebuilding cache(s), wait a moment please.<br/> [OK] Done clearing cache(s).</pre>
<ol start="4">
<li>View Structure and find your <span class="packt_screen">Custom content entity settings</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="231" width="342" class="image-border" src="assets/fc4536b3-1e4d-440f-8c35-2a4edfedc896.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>One of the biggest features of Console is its ability to reduce the time spent by developers to create code for Drupal 8. Console utilizes the Twig templating engine to provide code generation. These Twig templates contain variables and logic that are compiled into the end result code.</p>
<p>A set of generator classes receives specific parameters, which are received through the appropriate command, and pass them to Twig for rendering. This allows Console to easily stay up to date with changes in Drupal core and still provide valuable code generation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making a Drush command</h1>
                </header>
            
            <article>
                
<p>Drush provides an API that allows developers to write their own commands. These commands can be part of a module and loaded through a Drupal installation, or they can be placed in the local user's Drush folder for general purposes.</p>
<p>Often, contributed modules create commands to automate user interface operations. However, creating a custom Drush command can be useful for specific operations. In this recipe, we will create a command that loads all the users who have not logged in in the last 10 days and resets their password.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>For this recipe, you will need Drush available. We will be creating a command in a local user directory.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<ol>
<li>Create a file named <kbd>disable_users.drush.inc</kbd> in the <kbd>~/.drush</kbd> folder for your user:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;?php<br/></span><span><br/></span><span>/**<br/></span><span> * </span><span>@file<br/></span><span> </span><span>* Loads all users who have not logged in within 10 days and disables them.<br/></span><span> */<br/></span></pre>
<ol start="2">
<li>Add the Drush command hook that will allow Drush to discover our commands provided by the file:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * Implements hook_drush_command().<br/></span><span> */<br/></span><span>function </span><span>disable_users_drush_command</span><span>() {<br/></span><span>  </span><span>$items </span><span>= []</span><span>;<br/></span><span>  </span><span>$items</span><span>[</span><span>'disable-users'</span><span>] = [<br/></span><span>    </span><span>'description' </span><span>=&gt; </span><span>'Disables users after 10 days of inactivity'</span><span>,<br/></span><span>  </span><span>]</span><span>;<br/></span><span>  </span><span>return </span><span>$items</span><span>;<br/></span><span>}</span></pre>
<ol start="3">
<li>Next, we will create the command callback function, which will end up holding all of our logic. Since our filename is <kbd>disable_users.drush.inc</kbd> and our command is <kbd>disable-users</kbd>, the hook turns out to be <kbd>drush_disable_users_disable_users</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * Implements drush_hook_COMMAND().<br/></span><span> */<br/></span><span>function </span><span>drush_disable_users_disable_users</span><span>() {<br/></span><span><br/></span><span>}</span></pre>
<ol start="4">
<li>Update the function to create a <kbd>DateTime</kbd> object, representing 10 days ago. We will use this to generate a timestamp for our query:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * Implements drush_hook_COMMAND().<br/></span><span> */<br/></span><span>function </span><span>drush_disable_users_disable_users</span><span>() {<br/></span><span>  </span><span>// Get the default timezone and make a DateTime object for 10 days ago.<br/></span><span>  </span><span>$system_date </span><span>= \Drupal::</span><span>config</span><span>(</span><span>'system.date'</span><span>)</span><span>;<br/></span><span>  </span><span>$default_timezone </span><span>= </span><span>$system_date</span><span>-&gt;</span><span>get</span><span>(</span><span>'timezone.default'</span><span>) ?: date_default_timezone_get()</span><span>;<br/></span><span>  </span><span>$now </span><span>= </span><span>new </span><span>DateTime(</span><span>'now'</span><span>, </span><span>new </span><span>DateTimeZone(</span><span>$default_timezone</span><span>))</span><span>;<br/></span><span>  </span><span>$now</span><span>-&gt;</span><span>modify</span><span>(</span><span>'-10 days'</span><span>)</span><span>;<br/></span><span>}</span></pre>
<ol start="5">
<li>Now, we will add our query, which will query all the user entities who have a login timestamp greater than 10 days:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * Implements drush_hook_COMMAND().<br/></span><span> */<br/></span><span>function </span><span>drush_disable_users_disable_users</span><span>() {<br/></span><span>  </span><span>// Get the default timezone and make a DateTime object for 10 days ago.<br/></span><span>  </span><span>$system_date </span><span>= \Drupal::</span><span>config</span><span>(</span><span>'system.date'</span><span>)</span><span>;<br/></span><span>  </span><span>$default_timezone </span><span>= </span><span>$system_date</span><span>-&gt;</span><span>get</span><span>(</span><span>'timezone.default'</span><span>) ?: date_default_timezone_get()</span><span>;<br/></span><span>  </span><span>$now </span><span>= </span><span>new </span><span>DateTime(</span><span>'now'</span><span>, </span><span>new </span><span>DateTimeZone(</span><span>$default_timezone</span><span>))</span><span>;<br/></span><span>  </span><span>$now</span><span>-&gt;</span><span>modify</span><span>(</span><span>'-10 days'</span><span>)</span><span>;<br/></span><span><br/></span><span>  </span><span>$query </span><span>= \Drupal::</span><span>entityQuery</span><span>(</span><span>'user'</span><span>)-&gt;</span><span>condition</span><span>(</span><span>'login'</span><span>, </span><span>$now</span><span>-&gt;</span><span>getTimestamp</span><span>()</span><span>, </span><span>'&gt;'</span><span>)</span><span>;<br/></span><span>  </span><span>$results </span><span>= </span><span>$query</span><span>-&gt;</span><span>execute</span><span>()</span><span>;<br/></span><span>  </span><span>if </span><span>(</span><span>empty</span><span>(</span><span>$results</span><span>)) {<br/></span><span>    drush_print(</span><span>'No users to disable!'</span><span>)</span><span>;<br/></span><span>  </span><span>}<br/></span><span><br/></span><span>}</span></pre>
<ol start="6">
<li>Next, we will iterate over the results and mark the user as disabled:</li>
</ol>
<pre style="padding-left: 60px"><span><br/></span><span>/**<br/></span><span> * Implements drush_hook_COMMAND().<br/></span><span> */<br/></span><span>function </span><span>drush_disable_users_disable_users</span><span>() {<br/></span><span>  </span><span>// Get the default timezone and make a DateTime object for 10 days ago.<br/></span><span>  </span><span>$system_date </span><span>= \Drupal::</span><span>config</span><span>(</span><span>'system.date'</span><span>)</span><span>;<br/></span><span>  </span><span>$default_timezone </span><span>= </span><span>$system_date</span><span>-&gt;</span><span>get</span><span>(</span><span>'timezone.default'</span><span>) ?: date_default_timezone_get()</span><span>;<br/></span><span>  </span><span>$now </span><span>= </span><span>new </span><span>DateTime(</span><span>'now'</span><span>, </span><span>new </span><span>DateTimeZone(</span><span>$default_timezone</span><span>))</span><span>;<br/></span><span>  </span><span>$now</span><span>-&gt;</span><span>modify</span><span>(</span><span>'-10 days'</span><span>)</span><span>;<br/></span><span><br/></span><span>  </span><span>$query </span><span>= \Drupal::</span><span>entityQuery</span><span>(</span><span>'user'</span><span>)-&gt;</span><span>condition</span><span>(</span><span>'login'</span><span>, </span><span>$now</span><span>-&gt;</span><span>getTimestamp</span><span>()</span><span>, </span><span>'&gt;'</span><span>)</span><span>;<br/></span><span>  </span><span>$results </span><span>= </span><span>$query</span><span>-&gt;</span><span>execute</span><span>()</span><span>;<br/></span><span>  </span><span>if </span><span>(</span><span>empty</span><span>(</span><span>$results</span><span>)) {<br/></span><span>    drush_print(</span><span>'No users to disable!'</span><span>)</span><span>;<br/></span><span>  </span><span>}<br/></span><span><br/></span><span>  </span><span>foreach </span><span>(</span><span>$results </span><span>as </span><span>$uid</span><span>) {<br/></span><span>    </span><span>/** </span><span>@var </span><span>\Drupal\user\Entity\User $user */<br/></span><span>    </span><span>$user </span><span>= \Drupal\user\Entity\User::</span><span>load</span><span>(</span><span>$uid</span><span>)</span><span>;<br/></span><span>    </span><span>$user</span><span>-&gt;</span><span>block</span><span>()</span><span>;<br/></span><span>    </span><span>$user</span><span>-&gt;</span><span>save</span><span>()</span><span>;<br/></span><span>  </span><span>}<br/></span><span><br/></span><span>  drush_print(dt(</span><span>'Disabled !count users'</span><span>, </span><span>[</span><span>'!count' </span><span>=&gt; count(</span><span>$results</span><span>)]))</span><span>;<br/></span><span>}</span></pre>
<ol start="7">
<li>Drush's cache will need to be cleared in order to discover your new command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush cache-clear drush</strong> </pre>
<ol start="8">
<li>Check whether the command exists:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drush disable-users --help</strong><br/> Disables users after 10 days of inactivity </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>Drush works by scanning specific directories for files that follow the <kbd>COMMANDFILE.drush.inc</kbd> pattern. You can think of <kbd>COMMANDFILE</kbd> for Drush as a representation of a module name in Drupal's hook system. When implementing a Drush hook, in the <kbd>HOOK_drush</kbd> format, you will need to replace HOOK with your <kbd>COMMANDFILE</kbd> name, just as you would do in Drupal with a module name.</p>
<p>In this recipe, we created a <kbd>disable_users.drush.inc</kbd> file. This means that all hooks and commands in the file need to use <kbd>disable_users</kbd> for hook invocations. Drush uses this to load the <kbd>hook_drush_command</kbd> hook that returns our command information.</p>
<p>We then provided the functionality of our logic in the <kbd>drush_hook_command</kbd> hook. For this hook, we replaced hook with our <kbd><span>COMMANDFILE</span></kbd> name, which was <kbd>disable_users</kbd>, giving us <kbd>drush_disable_users_command</kbd>. We replaced command with the command that we defined in <kbd>hook_drush_command</kbd>, which was <kbd>disable-users</kbd>. We then had our final <kbd>drush_disable_users_disable_users</kbd> hook.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more…</h1>
                </header>
            
            <article>
                
<p style="margin-bottom: .0001pt" class="NormalPACKT">Drush commands have additional options that can be specified in their definitions. We explore their abilities to control the required level of Drupal integration for a command.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Specifying the level of Drupal's bootstrap</h1>
                </header>
            
            <article>
                
<p>Drush commands have the ability to specify the level of Drupal's bootstrap before being executed. Drupal has several bootstrap levels in which only specific parts of the system are loaded. By default, a command's bootstrap is at <kbd>DRUSH_BOOTSTRAP_DRUPAL_LOGIN</kbd>, which is at the same level as accessing Drupal over the Web.</p>
<p>Commands, depending on their purpose, can choose to avoid bootstrapping Drupal at all or only until the database system is loaded. Drush commands that are utilities, such as the Git release notes module, provide a Drush command that does not interact with Drupal. It specifies a bootstrap of <kbd>DRUSH_BOOTSTRAP_DRUSH</kbd>, as it only interacts with repositories to generate change logs based on Git tags and commits.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to how to creating custom Drush commands at <a href="http://docs.drush.org/en/master/commands/">http://docs.drush.org/en/master/commands/</a>.</li>
<li>Refer to how to install Drush at <a href="http://docs.drush.org/en/master/install/">http://docs.drush.org/en/master/install/</a>.</li>
<li>Refer to the Drush Bootstrap process at <a href="http://docs.drush.org/en/master/bootstrap/">http://docs.drush.org/en/master/bootstrap/</a>.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making a Console command</h1>
                </header>
            
            <article>
                
<p>Drupal Console makes use of the Symfony Console project and other third-party libraries to utilize modern PHP best practices. In doing so, it follows Drupal 8 practices as well. This allows Console to use namespaces for the command detection and interaction with Drupal by reading its class loader.</p>
<p>This allows developers to easily create a Console command by implementing a custom class in a module.</p>
<p>In this recipe, we will create a command that loads all the users who have not logged in in the last 10 days and resets their password. We will generate the base of our command using the scaffolding commands.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p style="margin-bottom: .0001pt" class="NormalPACKT">For this recipe, you will need to have Drupal Console installed. The tool will generate everything else for us. You will need to have a Drupal 8 site installed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it…</h1>
                </header>
            
            <article>
                
<ol>
<li>Create a new module that will hold your Drupal Console command, such as<br/>
<kbd>console_commands</kbd>:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root">drupal generate:module<br/><br/>// Welcome to the Drupal module generator<br/>Enter the new module name:<br/> &gt; Console Commands<br/><br/>Enter the module machine name [console_commands]:<br/> &gt;<br/><br/>Enter the module Path [/modules/custom]:<br/> &gt;<br/><br/>Enter module description [My Awesome Module]:<br/> &gt;<br/><br/>Enter package name [Custom]:<br/> &gt;<br/><br/>Enter Drupal Core version [8.x]:<br/> &gt;<br/><br/>Do you want to generate a .module file (yes/no) [yes]:<br/> &gt;<br/><br/>Define module as feature (yes/no) [no]:<br/> &gt;<br/><br/>Do you want to add a composer.json file to your module (yes/no) [yes]:<br/> &gt;<br/><br/>Would you like to add module dependencies (yes/no) [no]:<br/> &gt;<br/><br/>Do you want to generate a unit test class (yes/no) [yes]:<br/> &gt;<br/><br/>Do you want to generate a themeable template (yes/no) [yes]:<br/> &gt; <br/><br/>Do you confirm generation? (yes/no) [yes]:<br/> &gt;<br/><br/>Generated or updated files<br/>1 - modules/custom/console_commands/console_commands.info.yml<br/> 2 - modules/custom/console_commands/console_commands.module<br/> 3 - modules/custom/console_commands/composer.json<br/> 4  modules/custom/console_commands/tests/src/Functional/LoadTest.php<br/> 5 - modules/custom/console_commands/console_commands.module<br/> 6 - modules/custom/console_commands/templates/console-commands.html.twig</pre>
<ol start="2">
<li>Next, we will generate the command's base files using the <kbd>generate:command</kbd> command. Call it the <kbd>disable_users</kbd> command:</li>
</ol>
<pre style="padding-left: 60px" class="mce-root">drupal generate:command<br/><br/>// Welcome to the Drupal Command generator<br/> Enter the extension name [devel]:<br/> &gt; console_commands<br/><br/>Enter the Command name. [console_commands:default]:<br/> &gt; console_commands:disable_users<br/><br/>Enter the Command Class. (Must end with the word 'Command'). [DefaultCommand]:<br/> &gt; DisableUsersCommand<br/><br/>Is the command aware of the drupal site installation when executed?. (yes/no) [no]:<br/> &gt; yes <br/><br/>Do you confirm generation? (yes/no) [yes]:<br/> &gt;<br/><br/>Generated or updated files<br/> 1 - modules/custom/console_commands/src/Command/DisableUsersCommand.php<br/> 2 - modules/custom/console_commands/console.services.yml<br/> 3 - modules/custom/console_commands/console/translations/en/console_commands.disable_users.yml</pre>
<ol start="3">
<li>Edit the created <kbd>DisableUsersCommand.php</kbd> file and remove the boilerplate example code from the execute method:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * {</span><span>@inheritdoc</span><span>}<br/></span><span> */<br/></span><span>protected function </span><span>execute</span><span>(InputInterface </span><span>$input</span><span>, </span><span>OutputInterface </span><span>$output</span><span>) {<br/></span><span>}</span></pre>
<ol start="4">
<li>Update the function to create a <kbd>DateTime</kbd> object, representing 10 days ago. We will use this to generate a timestamp for our query:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * {</span><span>@inheritdoc</span><span>}<br/></span><span> */<br/></span><span>protected function </span><span>execute</span><span>(InputInterface </span><span>$input</span><span>, </span><span>OutputInterface </span><span>$output</span><span>) {<br/></span><span>  </span><span>// Get the default timezone and make a DateTime object for 10 days ago.<br/></span><span>  </span><span>$system_date </span><span>= \Drupal::</span><span>config</span><span>(</span><span>'system.date'</span><span>)</span><span>;<br/></span><span>  </span><span>$default_timezone </span><span>= </span><span>$system_date</span><span>-&gt;</span><span>get</span><span>(</span><span>'timezone.default'</span><span>) ?: date_default_timezone_get()</span><span>;<br/></span><span>  </span><span>$now </span><span>= </span><span>new </span><span>\DateTime(</span><span>'now'</span><span>, </span><span>new </span><span>\DateTimeZone(</span><span>$default_timezone</span><span>))</span><span>;<br/></span><span>  </span><span>$now</span><span>-&gt;</span><span>modify</span><span>(</span><span>'-10 days'</span><span>)</span><span>;<br/></span><span>}</span></pre>
<ol start="5">
<li>Now, we will add our query, which will query all the user entities who have a login timestamp greater than 10 days:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * {</span><span>@inheritdoc</span><span>}<br/></span><span> */<br/></span><span>protected function </span><span>execute</span><span>(InputInterface </span><span>$input</span><span>, </span><span>OutputInterface </span><span>$output</span><span>) {<br/></span><span>  </span><span>// Get the default timezone and make a DateTime object for 10 days ago.<br/></span><span>  </span><span>$system_date </span><span>= \Drupal::</span><span>config</span><span>(</span><span>'system.date'</span><span>)</span><span>;<br/></span><span>  </span><span>$default_timezone </span><span>= </span><span>$system_date</span><span>-&gt;</span><span>get</span><span>(</span><span>'timezone.default'</span><span>) ?: date_default_timezone_get()</span><span>;<br/></span><span>  </span><span>$now </span><span>= </span><span>new </span><span>\DateTime(</span><span>'now'</span><span>, </span><span>new </span><span>\DateTimeZone(</span><span>$default_timezone</span><span>))</span><span>;<br/></span><span>  </span><span>$now</span><span>-&gt;</span><span>modify</span><span>(</span><span>'-10 days'</span><span>)</span><span>;<br/></span><span><br/></span><strong>  $query = \Drupal::entityQuery('user')-&gt;condition('login', $now-&gt;getTimestamp(), '&gt;');<br/>  $results = $query-&gt;execute();<br/><br/>  if (empty($results)) {<br/>    $output-&gt;writeln('&lt;info&gt;No users to disable!&lt;/info&gt;');<br/>  </strong><span><strong>}</strong><br/></span><span>}</span></pre>
<ol start="6">
<li>Next, we will iterate over the results and mark the user as disabled:</li>
</ol>
<pre style="padding-left: 60px"><span>/**<br/></span><span> * {</span><span>@inheritdoc</span><span>}<br/></span><span> */<br/></span><span>protected function </span><span>execute</span><span>(InputInterface </span><span>$input</span><span>, </span><span>OutputInterface </span><span>$output</span><span>) {<br/></span><span>  </span><span>// Get the default timezone and make a DateTime object for 10 days ago.<br/></span><span>  </span><span>$system_date </span><span>= \Drupal::</span><span>config</span><span>(</span><span>'system.date'</span><span>)</span><span>;<br/></span><span>  </span><span>$default_timezone </span><span>= </span><span>$system_date</span><span>-&gt;</span><span>get</span><span>(</span><span>'timezone.default'</span><span>) ?: date_default_timezone_get()</span><span>;<br/></span><span>  </span><span>$now </span><span>= </span><span>new </span><span>\DateTime(</span><span>'now'</span><span>, </span><span>new </span><span>\DateTimeZone(</span><span>$default_timezone</span><span>))</span><span>;<br/></span><span>  </span><span>$now</span><span>-&gt;</span><span>modify</span><span>(</span><span>'-10 days'</span><span>)</span><span>;<br/></span><span><br/></span><span>  </span><span>$query </span><span>= \Drupal::</span><span>entityQuery</span><span>(</span><span>'user'</span><span>)-&gt;</span><span>condition</span><span>(</span><span>'login'</span><span>, </span><span>$now</span><span>-&gt;</span><span>getTimestamp</span><span>()</span><span>, </span><span>'&gt;'</span><span>)</span><span>;<br/></span><span>  </span><span>$results </span><span>= </span><span>$query</span><span>-&gt;</span><span>execute</span><span>()</span><span>;<br/></span><span><br/></span><span>  </span><span>if </span><span>(</span><span>empty</span><span>(</span><span>$results</span><span>)) {<br/></span><span>    </span><span>$output</span><span>-&gt;</span><span>writeln</span><span>(</span><span>'&lt;info&gt;No users to disable!&lt;/info&gt;'</span><span>)</span><span>;<br/></span><span>  </span><span>}<br/></span><span><br/></span><strong>  foreach ($results as $uid) {<br/>    /** @var \Drupal\user\Entity\User $user */<br/>    $user = \Drupal\user\Entity\User::load($uid);<br/>    $user-&gt;block();<br/>    $user-&gt;save();<br/>  }<br/><br/>  $total = count($results);<br/>  $output-&gt;writeln("Disabled $total users")</strong><span><strong>;</strong><br/></span><span>}</span></pre>
<ol start="7">
<li>Enable the module in order to access the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ drupal module:install console_commands</strong> </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works…</h1>
                </header>
            
            <article>
                
<p>Drupal Console provides integration with modules using namespace discovery methods. When Console is run in a Drupal installation, it will discover all the available projects. It then discovers any files in the <kbd>\Drupal\{ a module }\Command</kbd> namespace that implements <kbd>\Drupal\Console\Command\Command</kbd>.</p>
<p>Drupal Console will rescan the Drupal directory for available commands every time it is invoked, as it does not keep a cache of available commands.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more…</h1>
                </header>
            
            <article>
                
<p>Drupal Console provides a much more intuitive developer experience as it follows Drupal core's coding formats. We will touch on how Console can be used to create entities.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using a Console command to create entities</h1>
                </header>
            
            <article>
                
<p>A benefit of Console is its ability to utilize Symfony Console's question helpers for a robust interactive experience. Drupal Commerce utilizes Console to provide a <kbd>commerce:create:store</kbd> command to generate stores. The purpose of the command is to simplify the creation of a specific entity.</p>
<p>The <kbd>\Drupal\commerce_store\Command\CreateStoreCommand</kbd> class overrides the default interact method that is executed to prompt data from the user. It will prompt users to enter the store's name, email, country, and currency.</p>
<p>Developers can implement similar commands to give advanced users a simpler way to work with modules and configuration.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to how to create custom commands at <a href="https://docs.drupalconsole.com/en/extending/creating-custom-commands.html">https://docs.drupalconsole.com/en/extending/creating-custom-commands.html</a><a href="https://hechoendrupal.gitbooks.io/drupal-console/content/en/extending/creating-custom-commands.html"/></li>
</ul>


            </article>

            
        </section>
    </body></html>