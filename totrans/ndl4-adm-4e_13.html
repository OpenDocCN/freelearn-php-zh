<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer369">
<h1 class="chapter-number" id="_idParaDest-251" lang="en-GB"><a id="_idTextAnchor251"/>13</h1>
<h1 id="_idParaDest-252" lang="en-GB"><a id="_idTextAnchor252"/>Ensuring Moodle Security</h1>
<p lang="en-GB">Moodle, like any other web application, has the potential to be misused. Moodle has dedicated an entire section to security settings that administrators can use to fine-tune its safety. After an overview of Moodle’s security, you will learn about the <span class="No-Break" lang="">following topics:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Security notifications</strong>: You will learn how to set up Moodle’s notification mechanisms that warn you about potential security issues and inspect the built-in <span class="No-Break" lang="">security report.</span></li>
<li lang="en-GB"><strong class="bold" lang="">User security</strong>: We will look at the configuration of Moodle passwords, protection of user details, and <span class="No-Break" lang="">spam prevention.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Content security</strong>: We will deal with potential issues in content created within Moodle and the visibility thereof. You will learn how to restrict content created within Moodle, set up content visibility, and configure the <span class="No-Break" lang="">antivirus scanner.</span></li>
<li lang="en-GB"><strong class="bold" lang="">System security</strong>: We will discuss configuration settings (location of the data <strong class="source-inline" lang="">root</strong> directory and cron execution), supporting HTTPS, and working with the <span class="No-Break" lang="">IP blocker.</span></li>
</ul>
<p lang="en-GB">Before we cover the four aforementioned topics, let’s provide an overview of Moodle security, touching upon all layers of the <span class="No-Break" lang="">technology stack.</span></p>
<h1 id="_idParaDest-253" lang="en-GB"><a id="_idTextAnchor253"/>Moodle security – an overview</h1>
<p lang="en-GB">Moodle takes <a id="_idIndexMarker1284"/>security extremely seriously, and any potential issues are given the highest priority. Fixed vulnerabilities of serious issues usually trigger the release of minor versions, emphasizing the <span class="No-Break" lang="">subject’s importance.</span></p>
<p lang="en-GB">The following diagram illustrates the layers of a typical Moodle setup where the security of each component has to <span class="No-Break" lang="">be ensured:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer357">
<img alt="Figure 13.1 – Moodle security " height="750" src="image/Figure_13.01_B18779.jpg" width="979"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.1 – Moodle security</p>
<p lang="en-GB">The security of a <a id="_idIndexMarker1285"/>system is as good as its weakest link. Since Moodle relies on underlying software, hardware, and network infrastructure, security can potentially be compromised in several areas. As this book focuses on Moodle administration, we only cover the security elements of Moodle per se. The following areas are <strong class="bold" lang="">not</strong> dealt with, and it is necessary to consult the respective documentation and experts on <span class="No-Break" lang="">security issues:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Software</strong>: As <a id="_idIndexMarker1286"/>described in <a href="B18779_02.xhtml#_idTextAnchor039"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 2</em></span></a>, <em class="italic" lang="">Exploring the Moodle System</em>, Moodle’s key components<a id="_idIndexMarker1287"/> comprise a <strong class="bold" lang="">web server</strong> (usually Apache or Microsoft IIS), a <strong class="bold" lang="">database server</strong> (MySQL, Microsoft SQL <a id="_idIndexMarker1288"/>Server, PostgreSQL, MariaDB, or Oracle), and a programming<a id="_idIndexMarker1289"/> language (<strong class="bold" lang="">PHP</strong>). Additional PHP and operating system extensions are required, for instance, to support the aforementioned <span class="No-Break" lang="">database systems.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Operating system</strong>: An operating system’s security is under the constant threat of exploitation for malicious purposes. The hardening of the operating system is a crucial task of a <span class="No-Break" lang="">system administrator.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Hardware</strong>: Moodle runs on (physical or virtual) servers hosted internally or externally. There are ongoing safety and security improvements in such systems, reflected by ever-extending precautions taken by data centers and <span class="No-Break" lang="">hosting providers.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Network</strong>: Any system that is part of a network is potentially vulnerable. Configuration of firewalls, proxy servers, and routers, as well as general network security, are<a id="_idIndexMarker1290"/> key aspects of protecting your system <span class="No-Break" lang="">from attacks.</span></li>
</ul>
<p lang="en-GB">A number of these topics are covered <span class="No-Break" lang="">at </span><a href="http://docs.moodle.org/en/Security"><span class="No-Break" lang="">docs.moodle.org/en/Security</span></a><span class="No-Break" lang="">.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">One rule that applies to all elements is that the latest software updates should be <span class="No-Break" lang="">installed regularly.</span></p>
<p lang="en-GB">With the <a id="_idIndexMarker1291"/>increasing complexity and growing popularity of Moodle, it is imperative that you ensure that all possible measures are taken to prevent any security issues. Let’s get started with <span class="No-Break" lang="">security notifications.</span></p>
<h1 id="_idParaDest-254" lang="en-GB"><a id="_idTextAnchor254"/>Configuring security notifications</h1>
<p lang="en-GB">Moodle has set <a id="_idIndexMarker1292"/>up a dedicated site at <a href="http://moodle.org/security">moodle.org/security</a> that deals with security issues. If you register your Moodle instance, which is highly recommended, your email address will automatically be added to the security alerts mailing list, which gives you advanced notice of vulnerabilities and updates a couple of days prior to public release. To set this up, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Registration</strong>, fill in the required information, and click on the <strong class="bold" lang="">Register your </strong><span class="No-Break" lang=""><strong class="bold" lang="">site</strong></span><span class="No-Break" lang=""> button.</span></p>
<p lang="en-GB">Alternatively, follow the <a href="mailto:@moodlesecurity">@moodlesecurity</a> Twitter handle to be notified of any Moodle <span class="No-Break" lang="">security announcements.</span></p>
<p lang="en-GB">Once you are up to date with general security issues, it is time to focus on being aware of any potential issues on your Moodle system. In the remainder of this section, we will deal with setting <a id="_idIndexMarker1293"/>up Moodle notifications and inspecting the built-in <span class="No-Break" lang="">system report.</span></p>
<h2 id="_idParaDest-255" lang="en-GB"><a id="_idTextAnchor255"/>Setting up Moodle notifications</h2>
<p lang="en-GB">When you <a id="_idIndexMarker1294"/>navigate to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Notifications</strong>, Moodle will display any potential issues with your site. This link also initiates the installed Moodle updates and plugins (refer to <a href="B18779_08.xhtml#_idTextAnchor168"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 8</em></span></a>, <em class="italic" lang="">Understanding </em><span class="No-Break" lang=""><em class="italic" lang="">Moodle Plugins</em></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">Four messages are displayed in the following screenshot; the second and third issues would clearly fall into the <span class="No-Break" lang="">security category:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer358">
<img alt="Figure 13.2 – Moodle notifications " height="469" src="image/Figure_13.02_B18779.jpg" width="1389"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.2 – Moodle notifications</p>
<p lang="en-GB">Moodle monitors failed login attempts in its log file, as described in <a href="B18779_12.xhtml#_idTextAnchor233"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 12</em></span></a>,<em class="italic" lang=""> Gaining Insights through Moodle Reporting and Analytics</em>. Repeated login failures can indicate that unauthorized users are trying to access your system. In addition to checking your log files regularly, you should consider monitoring these activities by configuring the settings when you navigate to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> |<strong class="bold" lang=""> Security</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Notifications</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer359">
<img alt="Figure 13.3 – Security notifications " height="804" src="image/Figure_13.03_B18779.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.3 – Security notifications</p>
<p lang="en-GB">You can specify whether users will see messages displayed on their screens about previously failed logins and who will be emailed about login failures. You can further set the number of failed logins from the same IP address that will trigger <span class="No-Break" lang="">these notifications.</span></p>
<p lang="en-GB">While this is not a foolproof threat alert, it can potentially highlight some problems within your system, and it is therefore recommended that you activate it. Another benefit of receiving<a id="_idIndexMarker1295"/> these notifications by email is the customer care aspect of getting back to legitimate users who have felt frustrated when trying to access <span class="No-Break" lang="">your site.</span></p>
<h2 id="_idParaDest-256" lang="en-GB"><a id="_idTextAnchor256"/>Inspecting security checks</h2>
<p lang="en-GB">Another <a id="_idIndexMarker1296"/>mechanism that we already mentioned in <a href="B18779_12.xhtml#_idTextAnchor233"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 12</em></span></a>, <em class="italic" lang="">Gaining Insights through Moodle Reporting and Analytics</em>, is the security report you find at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Security checks</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer360">
<img alt="Figure 13.4 – Security checks " height="1067" src="image/Figure_13.04_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.4 – Security checks</p>
<p lang="en-GB">The report shows <a id="_idIndexMarker1297"/>several potential key security issues, their status (<strong class="bold" lang="">OK</strong>, <strong class="bold" lang="">Info</strong>, <strong class="bold" lang="">Warning</strong>, <strong class="bold" lang="">Critical</strong>, or <strong class="bold" lang="">Error</strong>), and a summary. When you click on an issue name, you will be redirected to a page that provides more information about the problem and, if available, a further <strong class="bold" lang="">Action</strong> link to the settings page where you can rectify <span class="No-Break" lang="">the situation.</span></p>
<p lang="en-GB">The <strong class="bold" lang="">Security checks</strong> page is a good starting point to identify some potential issues. However, it does not replace a full security audit, penetration test, or health check offered by some <span class="No-Break" lang="">Moodle Partners.</span></p>
<p lang="en-GB">Awareness of what is going on in your Moodle system is as critical as ensuring the security of critical <a id="_idIndexMarker1298"/>components. Let’s start with the weakest link in any IT setup – <span class="No-Break" lang="">users.</span></p>
<h1 id="_idParaDest-257" lang="en-GB"><a id="_idTextAnchor257"/>Ensuring user security</h1>
<p lang="en-GB">A critical security <a id="_idIndexMarker1299"/>aspect lies in ensuring that only privileged users can access your system and, once they are authenticated, they only have access to their privileged areas <span class="No-Break" lang="">in Moodle.</span></p>
<p lang="en-GB">Here is a quick recap of the key elements concerning security in the magic Moodle triangle – users, courses, <span class="No-Break" lang="">and roles:</span></p>
<ul>
<li lang="en-GB">Ensuring <a id="_idIndexMarker1300"/>the correct <strong class="bold" lang="">authentication</strong> setup is critical to ensuring a secure Moodle system, especially when self-registration or guest access has been activated. We dealt with internal, external, provider-based, and system authentication methods in <a href="B18779_05.xhtml#_idTextAnchor092"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 5</em></span></a>, <em class="italic" lang="">Managing Users, Cohorts, </em><span class="No-Break" lang=""><em class="italic" lang="">and Authentication</em></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">Once users have authenticated with Moodle, you have to ensure that they can only enrol in courses where they should have permission to do so, which is controlled by <strong class="bold" lang="">enrolment</strong> methods, as discussed in detail in <a href="B18779_04.xhtml#_idTextAnchor074"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 4</em></span></a>, <em class="italic" lang="">Managing Courses </em><span class="No-Break" lang=""><em class="italic" lang="">and Enrolments</em></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">When users are enrolled in courses or access any other area of Moodle, it is crucial that they are granted the correct <strong class="bold" lang="">permissions</strong>, which are controlled via roles and capabilities, a topic covered at length in <a href="B18779_06.xhtml#_idTextAnchor116"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 6</em></span></a>, <em class="italic" lang="">Managing Permissions, Roles, and Capabilities</em>. The six risk types of capabilities – <strong class="bold" lang="">Trust</strong>, <strong class="bold" lang="">Configuration</strong>, <strong class="bold" lang="">XSS</strong>, <strong class="bold" lang="">Personal</strong>, <strong class="bold" lang="">Spam</strong>, and <strong class="bold" lang="">Data loss </strong> – provide a good indication of the damage that can <span class="No-Break" lang="">be caused.</span></li>
</ul>
<p lang="en-GB">In this section, we will focus on three topics impacting <span class="No-Break" lang="">users’ security:</span></p>
<ul>
<li lang="en-GB">Moodle passwords, dealing with password policies, and recovering the <span class="No-Break" lang="">admin password</span></li>
<li lang="en-GB">Protection of <span class="No-Break" lang="">user details</span></li>
<li lang="en-GB">Prevention <span class="No-Break" lang="">of spam</span></li>
</ul>
<p lang="en-GB">Let’s start with Moodle passwords, a topic impacting all <span class="No-Break" lang="">Moodle users.</span></p>
<h2 id="_idParaDest-258" lang="en-GB"><a id="_idTextAnchor258"/>Configuring Moodle passwords</h2>
<p lang="en-GB">Moodle offers <a id="_idIndexMarker1301"/>a password policy feature that applies to manual accounts, which can be configured by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <strong class="bold" lang="">Site security policies</strong>, as shown in the <span class="No-Break" lang="">following screenshots:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer361">
<img alt="Figure 13.5 – Password policy " height="1117" src="image/Figure_13.05_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.5 – Password policy</p>
<p lang="en-GB">Moodle’s password policy supports the following configuration <span class="No-Break" lang="">option types:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Complexity</strong>: All common password requirements are supported, namely <strong class="bold" lang="">Password length</strong>, <strong class="bold" lang="">Digits</strong>, <strong class="bold" lang="">Lowercase letters</strong>, <strong class="bold" lang="">Uppercase letters</strong>, <strong class="bold" lang="">Non-alphanumeric characters</strong>, and <strong class="bold" lang="">Consecutive </strong><span class="No-Break" lang=""><strong class="bold" lang="">identical characters</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Validity</strong>: Password expiry can be specified for manual accounts at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Authentication</strong> | <strong class="bold" lang="">Manual accounts</strong>, where you can configure <strong class="bold" lang="">Enable password expiry</strong>, <strong class="bold" lang="">Password duration</strong>, and <strong class="bold" lang="">Notification threshold</strong>. Related settings are <strong class="bold" lang="">Password rotation limit</strong> (the number of times before a user can reuse a password), <strong class="bold" lang="">Maximum time to validate password reset request</strong> (when password recovery is being triggered), and <strong class="bold" lang="">Log out after password change</strong> (all browser sessions except the <span class="No-Break" lang="">current one).</span></li>
<li lang="en-GB"><strong class="bold" lang="">Consequences</strong>: You can lock out user accounts after too many failed logins. <strong class="bold" lang="">Account lockout threshold</strong> lets you specify the number of failed logins required to trigger a reactivation email to the user, the <strong class="bold" lang="">Account lockout observation window</strong> setting lets you specify the period during which further failed logins will be included in the current suspension, and <strong class="bold" lang="">Account lockout duration</strong> lets you specify the time after which the account will be <span class="No-Break" lang="">unlocked automatically.</span></li>
</ul>
<p lang="en-GB">Bear in mind that the <a id="_idIndexMarker1302"/>password policy only applies to manual accounts. If you use a different authentication method, the lockout thresholds will be defined<a id="_idIndexMarker1303"/> elsewhere – for instance, within the <strong class="bold" lang="">Lightweight directory access protocol</strong> (<span class="No-Break" lang=""><strong class="bold" lang="">LDAP</strong></span><span class="No-Break" lang="">) instance.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">It is highly recommended that you use a strong password (long, complex, and random) for the Moodle administrator account(s), even if the password policy has <span class="No-Break" lang="">been deactivated.</span></p>
<p lang="en-GB">Moodle stores passwords in a cryptographic hash using <strong class="source-inline" lang="">bcrypt</strong> (Blowfish). To further improve password security, Moodle<a id="_idIndexMarker1304"/> supports <strong class="bold" lang="">password salting</strong>, which adds a separate random string to the hash of each user’s password. The password stored in the Moodle database has the <span class="No-Break" lang="">following format:</span></p>
<pre class="source-code" lang="en-GB">$&lt;hash_id&gt;$&lt;cost&gt;$&lt;secure salt&gt;&lt;hash&gt;</pre>
<p lang="en-GB"><strong class="source-inline" lang="">&lt;hash_id&gt;</strong> is the ID of the hashing algorithm used (<strong class="source-inline" lang="">2y</strong> for bcrypt), and <strong class="source-inline" lang="">&lt;cost&gt;</strong> is the cost of using that algorithm (two digits). <strong class="source-inline" lang="">&lt;secure salt&gt;</strong> is a randomly generated 22-character salt; you can find more details on salting at <a href="http://docs.moodle.org/en/Password_salting">docs.moodle.org/en/Password_salting</a>. <strong class="source-inline" lang="">&lt;hash&gt;</strong> is a 31-character hash of the <span class="No-Break" lang="">actual password.</span></p>
<p lang="en-GB">If you ever lose your<a id="_idIndexMarker1305"/> admin password and have no means of recovering it, you have <span class="No-Break" lang="">two options:</span></p>
<ol>
<li lang="en-GB"><strong class="bold" lang="">Overriding the password in the database</strong>: You can manually override the password field in the <strong class="source-inline" lang="">mdl_user</strong> table in the SQL database by manually replacing the old hash with the <strong class="source-inline" lang="">MD5</strong> value of the new password; it will be upgraded to the strong hash value after the first login. For example, to set the password to <strong class="source-inline" lang="">'newpassword'</strong>, you need to use the following <span class="No-Break" lang="">SQL statement:</span><p class="source-code" lang="en-GB">UPDATE mdl_user</p><p class="source-code" lang="en-GB">    SET password = MD5('newpassword')</p><p class="source-code" lang="en-GB">    WHERE username = 'admin';</p></li>
</ol>
<p lang="en-GB">If your <a id="_idIndexMarker1306"/>database does not support the <strong class="source-inline" lang="">MD5</strong> function, you must set the password to the actual <strong class="source-inline" lang="">MD5</strong> hash tag. For example, this would be <strong class="source-inline" lang="">5e9d11a14ad1c8dd77e98ef9b53fd1ba</strong> for '<strong class="source-inline" lang="">newpassword</strong>'. Use one of the many available online generators to find out <span class="No-Break" lang="">the tag.</span></p>
<ol>
<li lang="en-GB" value="2"><strong class="bold" lang="">Overriding the password via the command line</strong>: The <strong class="source-inline" lang="">reset_password.php</strong> CLI <a id="_idIndexMarker1307"/>script sets the correctly salted password for any given user. The syntax to change the admin password to <strong class="source-inline" lang="">'newpassword'</strong> is <span class="No-Break" lang="">as follows:</span><p class="source-code" lang="en-GB">sudo -u www-data /usr/bin/php admin/cli/reset_password.php --username=admin --password=newpassword --ignore-password-policy</p></li>
</ol>
<p lang="en-GB">The passwords prevent users from unauthorized access to Moodle. Once users have identified <a id="_idIndexMarker1308"/>themselves, the next step is to protect their user details, which is the topic of the <span class="No-Break" lang="">following subsection.</span></p>
<h2 id="_idParaDest-259" lang="en-GB"><a id="_idTextAnchor259"/>Protecting user details</h2>
<p lang="en-GB">Identity theft is a<a id="_idIndexMarker1309"/> common problem on the internet, and Moodle is no exception. To avoid the possibility of fraudsters gathering details about authenticated users, a number of settings can be seen by navigating to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> |<strong class="bold" lang=""> Site </strong><span class="No-Break" lang=""><strong class="bold" lang="">security policies</strong></span><span class="No-Break" lang="">:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Protect usernames</strong>: If users cannot remember their username or password, Moodle provides a <strong class="bold" lang="">Forgotten password</strong> screen. By default, the message displayed reads <strong class="bold" lang="">If you supplied a correct username or email address then an email should have been sent to you</strong>. If the protection is turned off, however, the message reads <strong class="bold" lang="">An email should have been sent to your address at ******@&lt;domain name&gt;</strong>, which could allow a guess at <span class="No-Break" lang="">the username.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Force users to login</strong>: By default, Moodle’s front page is visible to everyone, even if they are not logged in to the site. Change this parameter if you wish to force users to log in before they see the front page. As a result, your users will only see the login screen when they enter <span class="No-Break" lang="">your site.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Force users to login for profiles</strong>: When set to <strong class="bold" lang="">Yes</strong> (the default setting), users will have to log in with an authentic account before accessing other users’ <span class="No-Break" lang="">profile pages.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Force users to login to view user pictures</strong>: If disabled (default), guests will be able to see pictures of other users in their profile. Otherwise, the default user image will be shown. Some organizations disable user profile images altogether, which can be achieved via the <strong class="bold" lang="">Disable user profile </strong><span class="No-Break" lang=""><strong class="bold" lang="">images</strong></span><span class="No-Break" lang=""> option.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Open to search engines</strong>: Moodle can be configured to allow search engines to crawl through courses with guest access and add content to its search engine database. This functionality is turned off <span class="No-Break" lang="">by default.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Allow indexing by search engines</strong>: The self-explanatory options are <strong class="bold" lang="">Everywhere except login and signup pages</strong>, <strong class="bold" lang="">Everywhere</strong>, and <strong class="bold" lang="">Nowhere</strong>. Note that these settings cannot be enforced because a tag header is added to each site to ask search engines to <span class="No-Break" lang="">respect it.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Profile visible roles</strong>: Any selected role will be visible on user profiles and <span class="No-Break" lang="">participation pages.</span></li>
</ul>
<p lang="en-GB">There are two more related parameters further down in the <strong class="bold" lang="">Site security settings</strong> screen. You can activate <strong class="bold" lang="">Email change confirmation</strong>. If set to <strong class="bold" lang="">Yes</strong>, users will be sent an email to confirm that their change of email address in their profile is genuine. Moodle offers a means to remember usernames via cookies, which will be entered in the login form when opened. While this is convenient for the end user, it poses a potential security risk. To prevent this feature from being supported, configure the <strong class="bold" lang="">Remember username</strong> parameter by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> |<strong class="bold" lang=""> Security</strong> | <strong class="bold" lang="">Site security policies</strong>. Since usernames are stored in a permanent cookie, this potentially infringes user privacy (see <a href="B18779_14.xhtml#_idTextAnchor271"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 14</em></span></a>, <em class="italic" lang="">Complying with Data </em><span class="No-Break" lang=""><em class="italic" lang="">Protection Regulations</em></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">By default, Moodle triggers a notification when a login has taken place by a user from a new device. To avoid users deactivating this security measure, you might want to change the <strong class="bold" lang="">New Login notifications</strong> status to <strong class="bold" lang="">Locked</strong> in <strong class="bold" lang="">Site administration</strong> |<strong class="bold" lang=""> General</strong> | <strong class="bold" lang="">Messaging</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Notification settings</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Related to<a id="_idIndexMarker1310"/> the protection of user details is the prevention of profile spam, which we will cover in the last topic of the user <span class="No-Break" lang="">security section.</span></p>
<h2 id="_idParaDest-260" lang="en-GB"><a id="_idTextAnchor260"/>Preventing spam</h2>
<p lang="en-GB">If Moodle is <a id="_idIndexMarker1311"/>not configured correctly, it allows spammers to insert content into user profiles of accounts created <span class="No-Break" lang="">via self-registration.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Only use email-based self-registration if it <span class="No-Break" lang="">is indispensable.</span></p>
<p lang="en-GB">If you must use self-registration, ensure to undertake the <span class="No-Break" lang="">following measures:</span></p>
<ul>
<li lang="en-GB">Enable <strong class="bold" lang="">reCAPTCHA</strong> in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Authentication</strong> |<strong class="bold" lang=""> Manage authentication</strong>. On the same page, configure <strong class="bold" lang="">Allowed email domains</strong> and <strong class="bold" lang="">Denied email domains</strong>. Refer to the <em class="italic" lang="">Common authentication settings</em> section in <a href="B18779_05.xhtml#_idTextAnchor092"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 5</em></span></a>, <em class="italic" lang="">Managing Users, Cohorts, and Authentication</em>. Many public online lists contain domains for disposable and temporary email addresses, which you might want to use for <span class="No-Break" lang="">the denylist.</span></li>
<li lang="en-GB">Keep <strong class="bold" lang="">Email change confirmation</strong> enabled in <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <strong class="bold" lang="">Site </strong><span class="No-Break" lang=""><strong class="bold" lang="">security policies</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">Configure the IP blocker, as described further on in <span class="No-Break" lang="">this chapter.</span></li>
</ul>
<p lang="en-GB">To <a id="_idIndexMarker1312"/>prevent <strong class="bold" lang="">profile spam</strong>, also make <a id="_idIndexMarker1313"/>sure that the following settings in <strong class="bold" lang="">General</strong> |<strong class="bold" lang=""> Security</strong> | <strong class="bold" lang="">Site security policies</strong> are set correctly (which they are, <span class="No-Break" lang="">by default):</span></p>
<ul>
<li lang="en-GB">Keep the <strong class="bold" lang="">Force users to login for profiles</strong> parameter enabled (refer to the <em class="italic" lang="">Protection of user details</em> section). This way, you can prevent anonymous visitors and search engines from seeing <span class="No-Break" lang="">user profiles.</span></li>
<li lang="en-GB">You further limit access to changing profiles to only those users who are enrolled in a course via the <strong class="bold" lang="">Profiles for enrolled users </strong><span class="No-Break" lang=""><strong class="bold" lang="">only</strong></span><span class="No-Break" lang=""> setting.</span></li>
</ul>
<p lang="en-GB">Also, be aware that legit users can be the cause of spam. Ensure that no user has any unnecessary capabilities in their roles that allow for this (refer to spam risk in <a href="B18779_06.xhtml#_idTextAnchor116"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 6</em></span></a>, <em class="italic" lang="">Managing Permissions, Roles, </em><span class="No-Break" lang=""><em class="italic" lang="">and Capabilities</em></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">If your site has been victim to spam, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Spam cleaner</strong>. You can either let Moodle autodetect common spam patterns (the list makes for some interesting reading!) or search for your <span class="No-Break" lang="">own keywords:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer362">
<img alt="Figure 13.6 – Spam cleaner " height="764" src="image/Figure_13.06_B18779.jpg" width="1643"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.6 – Spam cleaner</p>
<p lang="en-GB">Any user profiles where the <strong class="bold" lang="">Description</strong> field contains any of the listed keywords are shown. You then have the option to delete the user account(s). For more information on spam prevention in Moodle, check <span class="No-Break" lang="">out </span><a href="http://docs.moodle.org/en/Reducing_spam_in_Moodle"><span class="No-Break" lang="">docs.moodle.org/en/Reducing_spam_in_Moodle</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">This concludes<a id="_idIndexMarker1314"/> the section on user security, where we have covered the configuration of Moodle passwords, protection of user details, and spam prevention. Next up is <span class="No-Break" lang="">content security.</span></p>
<h1 id="_idParaDest-261" lang="en-GB"><a id="_idTextAnchor261"/>Ensuring content security</h1>
<p lang="en-GB">Content by learners <a id="_idIndexMarker1315"/>and teachers can potentially contain malicious code, and once created, it needs to be protected from unauthorized access. This section will ensure content security (namely, content created within Moodle), content visibility, and <span class="No-Break" lang="">antivirus scanners.</span></p>
<h2 id="_idParaDest-262" lang="en-GB"><a id="_idTextAnchor262"/>Limiting content created within Moodle</h2>
<p lang="en-GB">Users can <a id="_idIndexMarker1316"/>create Moodle content<a id="_idIndexMarker1317"/> by using the Atto editor or uploading files. Two settings are available in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <strong class="bold" lang="">Site security policies</strong> to partly prevent the misuse <span class="No-Break" lang="">of these:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer363">
<img alt="Figure 13.7 – Content security settings " height="392" src="image/Figure_13.07_B18779.jpg" width="1405"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.7 – Content security settings</p>
<p lang="en-GB">The two parameters are <span class="No-Break" lang="">as follows:</span></p>
<ul>
<li lang="en-GB">HTML allows embedding code that uses the explicit <strong class="source-inline" lang="">&lt;EMBED&gt;</strong> and <strong class="source-inline" lang="">&lt;OBJECT&gt;</strong> tags. Potentially, malicious code can be put in embedded scripts, which is why its support is<a id="_idIndexMarker1318"/> deactivated by <a id="_idIndexMarker1319"/>default. To activate it, enable the <strong class="bold" lang="">Allow EMBED and OBJECT </strong><span class="No-Break" lang=""><strong class="bold" lang="">tags</strong></span><span class="No-Break" lang=""> parameter.</span></li>
<li lang="en-GB">The Atto editor automatically removes any unwanted HTML elements and attributes. You can bypass this cleansing mechanism for individual users. First, you must set the <strong class="bold" lang="">Enable trusted content</strong> parameter, as shown in the preceding screenshot. Second, you will have to allow the <strong class="source-inline" lang="">moodle/site:trustcontent</strong> capability for each user you trust to submit JavaScript and other potentially malicious code. Texts created or uploaded by those users will be marked as trusted and will not be cleaned <span class="No-Break" lang="">before display.</span></li>
</ul>
<p lang="en-GB">If you wish to censor obscene or other unwanted words entered by learners in activities such as forums, Moodle has developed a <strong class="bold" lang="">Word censorship</strong> filter and made it available as a plugin (<a href="http://moodle.org/plugins/filter_censor">moodle.org/plugins/filter_censor</a>). Once installed and enabled, you can enter a list of censored words and phrases to be blacked out in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Filters</strong> | <strong class="bold" lang="">Word censorship</strong>. Alternatively, you can edit the <strong class="source-inline" lang="">badwords</strong> language string in <strong class="source-inline" lang="">filter_censor.php</strong> (be careful, as this list is far from G-rated). Also, bear in mind that the filter picks up words within words and marks valid terms, such as<a id="_idIndexMarker1320"/> cocktail, sextant, sparse, <span class="No-Break" lang="">and</span><span class="No-Break" lang=""><a id="_idIndexMarker1321"/></span><span class="No-Break" lang=""> altitude.</span></p>
<p lang="en-GB">Okay, before your imagination runs completely wild, let’s set up content <span class="No-Break" lang="">visibility next.</span></p>
<h2 id="_idParaDest-263" lang="en-GB"><a id="_idTextAnchor263"/>Setting up content visibility</h2>
<p lang="en-GB">Blogging, tagging, and<a id="_idIndexMarker1322"/> commenting are Moodle social networking activities. Blog entries, tags, and comments are harnessed for searching, sharing, and performing other collaborative activities to match interests. The potential issue is that the content is visible to users who should not be able to share or view entries. Moodle has catered for this by providing several settings, which we have already dealt with in the <em class="italic" lang="">Configuring collaboration tools</em> section in <a href="B18779_09.xhtml#_idTextAnchor181"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 9</em></span></a>, <em class="italic" lang="">Configuring Educational Features</em>. Here is a list of areas where the respective functionalities need to be turned on <span class="No-Break" lang="">and off:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Appearance</strong> | <strong class="bold" lang="">Blog</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Blog visibility</strong></span></li>
<li lang="en-GB"><strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Advanced features</strong> | <strong class="bold" lang="">Enable </strong><span class="No-Break" lang=""><strong class="bold" lang="">tags functionality</strong></span></li>
<li lang="en-GB"><strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Appearance</strong> | <strong class="bold" lang="">Blog</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Enable comments</strong></span></li>
</ul>
<p lang="en-GB">If you deactivate any mechanisms, tags, comments, and blog entries that are already on the system or kept hidden, they will reappear when the functionality is turned on again. In other words, there is no risk of data loss when turning the functionality off and <span class="No-Break" lang="">back on.</span></p>
<p lang="en-GB">You might also consider creating a dedicated role on your system – for example, a Blogger role utilizing the <strong class="source-inline" lang="">moodle/blog:create</strong> capability. This will limit blogging to specific users only – those who have been assigned the new role. You can find more details on the Blogger role in the Moodle Docs <span class="No-Break" lang="">at </span><a href="http://docs.moodle.org/en/Blogger_role"><span class="No-Break" lang="">docs.moodle.org/en/Blogger_role</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">The last component of content security is the configuration of virus scanners, which is dealt with in the <span class="No-Break" lang="">following subsection.</span></p>
<h2 id="_idParaDest-264" lang="en-GB"><a id="_idTextAnchor264"/>Configuring antivirus scanners</h2>
<p lang="en-GB">Moodle<a id="_idIndexMarker1323"/> supports <a id="_idIndexMarker1324"/>the scanning of uploaded files for viruses, which can be configured at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Antivirus plugins</strong> | <strong class="bold" lang="">Manage </strong><span class="No-Break" lang=""><strong class="bold" lang="">antivirus plugins</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer364">
<img alt="Figure 13.8 – Managing antivirus plugins " height="1069" src="image/Figure_13.08_B18779.jpg" width="1391"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.8 – Managing antivirus plugins</p>
<p lang="en-GB">There are some<a id="_idIndexMarker1325"/> common antivirus settings applicable<a id="_idIndexMarker1326"/> to all antivirus plugins. The three-step process behind Moodle’s (and most other) antivirus scanning mechanism is <span class="No-Break" lang="">as follows:</span></p>
<ol>
<li lang="en-GB" value="1"><strong class="bold" lang="">Detection</strong>: Files are scanned for potential threats, where the antivirus plugin determines the <span class="No-Break" lang="">detection method.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Quarantine</strong>: Any potentially malicious or infected files will be isolated. They are placed in the <strong class="source-inline" lang="">$CFG-&gt;dataroot/antivirus_quarantine</strong> quarantine folder for <span class="No-Break" lang="">later inspection.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Removal</strong>: Detected files will be deleted immediately after detection when quarantine is disabled, after inspection of the quarantine folder, or when the maximum quarantine time has <span class="No-Break" lang="">been exceeded.</span></li>
</ol>
<p lang="en-GB"><strong class="bold" lang="">ClamAV</strong> is available <a id="_idIndexMarker1327"/>as a standard scanner; more antivirus plugins are available from the Moodle plugins <a id="_idIndexMarker1328"/>directory at <a href="http://moodle.org/plugins/?q=type:antivirus">moodle.org/plugins/?q=type:antivirus</a>. ClamAV <a href="http://www.clamav.net/">is an open-sou</a>rce antivirus engine. Refer <a id="_idIndexMarker1329"/>to <a href="http://www.clamav.net">www.clamav.net</a> for more details, downloads for different operating systems, and how to keep the virus definition database up to date. You must install ClamAV on your system before the scanner can be configured via the <span class="No-Break" lang=""><strong class="bold" lang="">Settings</strong></span><span class="No-Break" lang=""> link.</span></p>
<p lang="en-GB">There are two running methods <span class="No-Break" lang="">for ClamAV:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Via command line</strong>: This is the default method for which you need to specify the path where <a id="_idIndexMarker1330"/>ClamAV has <span class="No-Break" lang="">been installed.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Via system sockets</strong>: On Unix systems, better performance can be obtained using either a Unix domain socket or a TCP socket. You need to contact your system administrator for configuration details on <span class="No-Break" lang="">these parameters.</span></li>
</ul>
<p lang="en-GB">ClamAV has two limitations. First, ClamAV does not exist for Windows servers, and you will need to install a Windows-based virus scanner to provide this functionality and monitor any quarantined files separately. Second, ClamAV will impact your system’s performance, which becomes an issue if the file upload facility is plentifully used. If this is the case, you <a id="_idIndexMarker1331"/>might have to allocate 10–20% more <a id="_idIndexMarker1332"/>RAM to <span class="No-Break" lang="">your server(s).</span></p>
<p lang="en-GB">This concludes the section on content security, where we covered content created within Moodle, content visibility, and antivirus scanners. The last section deals with ensuring <span class="No-Break" lang="">system security.</span></p>
<h1 id="_idParaDest-265" lang="en-GB"><a id="_idTextAnchor265"/>Ensuring system security</h1>
<p lang="en-GB">In the last section<a id="_idIndexMarker1333"/> of this Moodle security chapter, we deal with configuration settings impacting system security, covering access to dataroot, cron execution, secure HTTP, and the <span class="No-Break" lang="">IP blocker.</span></p>
<h2 id="_idParaDest-266" lang="en-GB"><a id="_idTextAnchor266"/>Configuring access to dataroot</h2>
<p lang="en-GB">In the <strong class="bold" lang="">Notifications</strong> screenshot<a id="_idIndexMarker1334"/> earlier in the <a id="_idIndexMarker1335"/>chapter, you probably spotted the warning that the <strong class="source-inline" lang="">dataroot</strong> directory is directly accessible via the internet. Moodle requires additional space on a server to store uploaded files, such as course documents and user pictures. The directory is called <strong class="source-inline" lang="">dataroot</strong> and must not be accessible via the web. If this directory is accessible directly, unauthorized users can get access <span class="No-Break" lang="">to content.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB"><strong class="source-inline" lang="">$CFG-&gt;dataroot</strong> must not be accessible via <span class="No-Break" lang="">the web!</span></p>
<p lang="en-GB">To prevent <strong class="source-inline" lang="">dataroot</strong> from being accessible, move the directory outside the web directory (ensure not to mangle permissions) and modify <strong class="source-inline" lang="">config.php</strong> accordingly by changing the <strong class="source-inline" lang="">$</strong><span class="No-Break" lang=""><strong class="source-inline" lang="">CFG-&gt;dataroot</strong></span><span class="No-Break" lang=""> entry.</span></p>
<p lang="en-GB">In externally hosted environments, it is often not possible to locate the directory outside the web directory. If this is the case, create a file called <strong class="source-inline" lang="">.htaccess</strong> in the data directory and add a line <span class="No-Break" lang="">containing </span><span class="No-Break" lang=""><strong class="source-inline" lang="">denyfromall</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">The second system security measure is the protection of the execution of the cron process, which is <span class="No-Break" lang="">covered next.</span></p>
<h2 id="_idParaDest-267" lang="en-GB"><a id="_idTextAnchor267"/>Protecting cron execution</h2>
<p lang="en-GB">We have <a id="_idIndexMarker1336"/>already <a id="_idIndexMarker1337"/>described the <strong class="bold" lang="">cron</strong> process in <a href="B18779_01.xhtml#_idTextAnchor020"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 1</em></span></a>, <em class="italic" lang="">Installing Moodle</em>, and will go into more detail about this in <a href="B18779_15.xhtml#_idTextAnchor289"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 15</em></span></a>, <em class="italic" lang="">Optimizing Moodle Performance</em>. cron is a script that regularly runs to perform certain operations, such as sending notifications, processing statistics, and cleaning up temporary files. Scripts that run at the operating system level can potentially contain <span class="No-Break" lang="">malicious code.</span></p>
<p lang="en-GB">It is possible to run a script via a web browser by simply typing in the following URL: <strong class="source-inline" lang="">&lt;yourMoodlesite&gt;/admin/cron.php</strong>. Two mutually exclusive settings can be set in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <strong class="bold" lang="">Site policies</strong> to <span class="No-Break" lang="">prevent this:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer365">
<img alt="Figure 13.9 – Configuring cron execution " height="391" src="image/Figure_13.09_B18779.jpg" width="1388"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.9 – Configuring cron execution</p>
<p lang="en-GB">If you only allow the cron process to be executed from the command line, running the script via a web browser will be disabled, and a message will be displayed, saying <strong class="bold" lang="">Sorry, internet access to this page has been disabled by the administrator</strong>. The cron process can still be executed automatically if it’s set <span class="No-Break" lang="">up correctly.</span></p>
<p lang="en-GB">If the <strong class="bold" lang="">Cron password for remote access</strong> parameter is set, Moodle requires that executing the cron script via a web browser requires the provision of a password in the form of a parameter, such as <strong class="source-inline" lang="">&lt;yourMoodlesite&gt;/admin/cron.php?password=yourpassword</strong>. If the password is not provided or is<a id="_idIndexMarker1338"/> incorrect, an error message, which<a id="_idIndexMarker1339"/> is the same as the one we saw earlier, <span class="No-Break" lang="">is displayed.</span></p>
<p lang="en-GB">Next up is the configuration of <span class="No-Break" lang="">HTTP security.</span></p>
<h2 id="_idParaDest-268" lang="en-GB"><a id="_idTextAnchor268"/>Configuring HTTP security</h2>
<p lang="en-GB">Moodle offers<a id="_idIndexMarker1340"/> full HTTPS support, which runs <a id="_idIndexMarker1341"/>HTTP requests over SSL (a more secure but slightly slower socket layer). Given the rapid advance in hacking technology and the negligible cost of SSL certificates, every public-facing web page containing user data should run <span class="No-Break" lang="">over HTTPS.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Repeat after me: every public-facing Moodle site should run over HTTPS, with <span class="No-Break" lang="">no exception.</span></p>
<p lang="en-GB">To ensure that all data transferred from a user’s browser to the server that hosts Moodle is encrypted, HTTPS must be enabled on your web server. You will also have to purchase or generate an SSL certificate. Every web server has a different method to enable HTTPS, so you should consult your server’s documentation. A good starting point for setting up SSL/TSL for Apache can be found <span class="No-Break" lang="">at </span><a href="http://httpd.apache.org/docs/current/ssl/ssl_howto.xhtml"><span class="No-Break" lang="">httpd.apache.org/docs/current/ssl/ssl_howto.xhtml</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once the web server has been configured to work with HTTPS, the Moodle installation script will work with those details (see <a href="B18779_01.xhtml#_idTextAnchor020"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 1</em></span></a>, <em class="italic" lang="">Installing Moodle</em>). If you need to transition<a id="_idIndexMarker1342"/> from <a id="_idIndexMarker1343"/>HTTP to HTTPS, we recommend that you follow the instructions on Moodle Docs (<a href="http://docs.moodle.org/en/Transitioning_to_HTTPS">docs.moodle.org/en/Transitioning_to_HTTPS</a>) and make use of the <strong class="bold" lang="">HTTPS conversion tool</strong> provided <a id="_idIndexMarker1344"/>by Moodle at the bottom of <strong class="bold" lang="">Site administration </strong>| <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">HTTP security</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer366">
<img alt="Figure 13.10 – HTTPS conversion tool " height="745" src="image/Figure_13.10_B18779.jpg" width="1381"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.10 – HTTPS conversion tool</p>
<p lang="en-GB">The tool performs two tasks. First, it scans any course content and notifies you if there are any potential issues or conflicts. Second, once you have ticked the confirmation box, an irreversible conversion is performed; all HTTP links are changed <span class="No-Break" lang="">to HTTPS.</span></p>
<p lang="en-GB">The tool can also be executed in CLI mode using the <span class="No-Break" lang="">following syntax:</span></p>
<pre class="source-code" lang="en-GB">sudo -u www-data /usr/bin/php admin/tool/httpsreplace/cli/url_replace.php --replace --confirm</pre>
<p lang="en-GB">For more details on the tool, <span class="No-Break" lang="">consult </span><a href="http://docs.moodle.org/en/HTTPS_conversion_tool"><span class="No-Break" lang="">docs.moodle.org/en/HTTPS_conversion_tool</span></a><span class="No-Break" lang="">.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">If you turn on HTTPS without the relevant system components installed – that is, the PHP extension added along with the correct web server configuration – you will lock yourself out of <span class="No-Break" lang="">your system!</span></p>
<p lang="en-GB">There are a <a id="_idIndexMarker1345"/>number<a id="_idIndexMarker1346"/> of related settings in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <strong class="bold" lang="">HTTP security</strong> that you <span class="No-Break" lang="">should double-check:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Secure cookies only</strong>: Web servers can be configured in a way that they only accept HTTPS URLs. If this is the case on your system, you should enable <span class="No-Break" lang="">this parameter.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Only http cookies</strong>: Moodle supports instructing web browsers to send cookies only with real requests, which prevents some <span class="No-Break" lang="">XSS attacks.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Allow frame embedding</strong>: See the tip in the <em class="italic" lang="">Moodle as LTI tool</em> section in <a href="B18779_09.xhtml#_idTextAnchor181"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 9</em></span></a>, <em class="italic" lang="">Configuring </em><span class="No-Break" lang=""><em class="italic" lang="">Educational Features</em></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB"><strong class="bold" lang="">cURL blocked hosts list</strong>: Block hosts for Moodle’s cURL implementation – for example, <span class="No-Break" lang=""><strong class="source-inline" lang="">localhost</strong></span><span class="No-Break" lang=""> variants.</span></li>
<li lang="en-GB"><strong class="bold" lang="">cURL allowed ports list</strong>: Restrict Moodle’s cURL implementation to specific web ports. The defaults are the standard ports, <strong class="source-inline" lang="">80</strong> <span class="No-Break" lang="">and </span><span class="No-Break" lang=""><strong class="source-inline" lang="">443</strong></span><span class="No-Break" lang="">.</span></li>
</ul>
<p lang="en-GB">HTTP security defines over what protocol your Moodle instance is accessed and the related settings. The last system security topic deals with allowing and blocking IP addresses <a id="_idIndexMarker1347"/>accessing<a id="_idIndexMarker1348"/> <span class="No-Break" lang="">your site.</span></p>
<h2 id="_idParaDest-269" lang="en-GB"><a id="_idTextAnchor269"/>Allowing and blocking IP addresses</h2>
<p lang="en-GB">Users will <a id="_idIndexMarker1349"/>access <a id="_idIndexMarker1350"/>your <a id="_idIndexMarker1351"/>system from stationary and <a id="_idIndexMarker1352"/>mobile devices. What they all have in common is that they will access your site via an IP address. You can limit this access by specifying an allowlist and a denylist at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> |<strong class="bold" lang=""> </strong><span class="No-Break" lang=""><strong class="bold" lang="">IP blocker</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer367">
<img alt="Figure 13.11 – IP blocker " height="715" src="image/Figure_13.11_B18779.jpg" width="1360"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.11 – IP blocker</p>
<p lang="en-GB">The allowlist (<strong class="bold" lang="">Allowed IP list</strong>) can contain IP addresses in several formats (the full IP address, partial address, ranges of IPs, and the CDIR notation). The same applies to the denylist (<strong class="bold" lang="">Blocked IP list</strong>). By default, the denylist has priority over the allowlist. If you wish to reverse this, select <strong class="bold" lang="">Allowed list will be </strong><span class="No-Break" lang=""><strong class="bold" lang="">processed first</strong></span><span class="No-Break" lang="">.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Be aware that with any entries in the allowlist, the effect is to allow ONLY those IP addresses and block all others. Exercise care with this setting, as it is possible to lock yourself out <span class="No-Break" lang="">of Moodle.</span></p>
<p lang="en-GB">For example, you might want to add <strong class="source-inline" lang="">192.168.*.*</strong> to your allowlist, and denylist a particular IP – say, <strong class="source-inline" lang="">192.168.123.45</strong> – that was trying to guess your admin password <span class="No-Break" lang="">multiple times.</span></p>
<p lang="en-GB">This <a id="_idIndexMarker1353"/>concludes<a id="_idIndexMarker1354"/> the<a id="_idIndexMarker1355"/> section<a id="_idIndexMarker1356"/> on system security, in which we dealt with access to <strong class="source-inline" lang="">dataroot</strong>, cron execution, HTTPS, and <span class="No-Break" lang="">IP blockers.</span></p>
<h1 id="_idParaDest-270" lang="en-GB"><a id="_idTextAnchor270"/>Summary</h1>
<p lang="en-GB">This chapter taught you how to protect your Moodle system from potential misuse and to keep a regular check on its security. To summarize, here is a short list of best practices in the following checklist. While this list is by no means complete, it gives an indication of the elements you are responsible for as a <span class="No-Break" lang="">Moodle administrator:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer368">
<img alt="Figure 13.12 – Moodle security best practices " height="764" src="image/Figure_13.12_B18779.jpg" width="1378"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.12 – Moodle security best practices</p>
<p lang="en-GB">It is important to stress that Moodle’s security is only a single variable in the overall equation. Ensure that all other underlying software, infrastructure, and hardware components are set up correctly <span class="No-Break" lang="">as well.</span></p>
<p lang="en-GB">It is also important to stress the importance of an emergency plan if a security threat arises. This includes a strategy for identifying the problem, measures to resolve the situation, and a list of users to notify, <span class="No-Break" lang="">among others.</span></p>
<p lang="en-GB">Most Moodle systems run on the LAMP platform, which has proven to be very secure if configured correctly. Moodle’s developers are very conscious that security is vital when dealing with personal user data, such as grades, assignments, and competencies. Hence, the topic has been given the highest priority. However, there is no guarantee that your system is 100% protected against misuse. New hacking techniques will emerge in today’s world of cyber threats, and users will continue to be careless with their credentials (you have all seen the Post-it notes under the keyboard). So, ensure security patches and updates on your entire system, not just Moodle, are always up to date, and keep educating your users about the dangers. Also, consider undergoing a regular security audit or health check, which some Moodle <span class="No-Break" lang="">Partners offer.</span></p>
<p lang="en-GB">Now that your system is secure, let’s ensure that its privacy setup complies with data <span class="No-Break" lang="">protection regulations.</span></p>
</div>
</div></body></html>