<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Using the Core Helpers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Using the Core Helpers</h1></div></div></div><p>In this chapter we will cover the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loading a helper class</li><li class="listitem" style="list-style-type: disc">Using the Date helper</li><li class="listitem" style="list-style-type: disc">Using the Encryption helper</li><li class="listitem" style="list-style-type: disc">Loading an RSS feed with the Feed helper</li><li class="listitem" style="list-style-type: disc">Managing files and directories with the File helper</li><li class="listitem" style="list-style-type: disc">Creating custom forms with the Form helper</li><li class="listitem" style="list-style-type: disc">Including a WYSIWYG editor on a form</li><li class="listitem" style="list-style-type: disc">Generating HTML code with the HTML helper</li><li class="listitem" style="list-style-type: disc">Generating and caching thumbnails with the Image helper</li><li class="listitem" style="list-style-type: disc">Encoding and decoding JSON with the JSON helper</li><li class="listitem" style="list-style-type: disc">Sending e-mails with the Mail helper</li><li class="listitem" style="list-style-type: disc">Determining the MIME type of a file extension using the MIME helper</li><li class="listitem" style="list-style-type: disc">Getting page URLs and breadcrumbs with the Navigation helper</li><li class="listitem" style="list-style-type: disc">Working with strings using the Text helper</li><li class="listitem" style="list-style-type: disc">Generating URLs with the URL helper</li><li class="listitem" style="list-style-type: disc">Validating input data using the Validation helpers</li><li class="listitem" style="list-style-type: disc">Preventing spam using the Captcha helper</li><li class="listitem" style="list-style-type: disc">Getting a list of countries</li><li class="listitem" style="list-style-type: disc">Getting a list of states and provinces</li><li class="listitem" style="list-style-type: disc">Showing a color picker on a form</li><li class="listitem" style="list-style-type: disc">Showing a date/time selector on a form</li><li class="listitem" style="list-style-type: disc">Showing a rating widget on a form</li><li class="listitem" style="list-style-type: disc">Using the banned words list</li><li class="listitem" style="list-style-type: disc">Reading and writing to the system cache</li><li class="listitem" style="list-style-type: disc">Writing to the debug log</li><li class="listitem" style="list-style-type: disc">Reading and writing to the configuration registry</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec70"/>Introduction</h1></div></div></div><p>During the course of developing custom applications within the concrete5 content management system, you will likely find yourself having to perform certain tasks multiple times. Tasks such as creating custom forms, sending e-mails, or parsing RSS feeds can all be sped up by utilizing the Core helper classes included with concrete5.</p><p>The concept of helpers in concrete5 might be familiar to developers who have previously worked with other popular MVC frameworks. Helpers are classes that provide miscellaneous, repeatable functionalities that can be used anywhere in your code. We will begin by showing how to load a helper class.</p><div class="section" title="A note about the code in this chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec231"/>A note about the code in this chapter</h2></div></div></div><p>As we've done in a few prior chapters, we will be making use of the <code class="literal">/config/site_post.php</code> file to run some arbitrary code. concrete5 doesn't have a great place to try out the API, so we will use <code class="literal">site_post</code> as our playground. Be sure to empty any experimental code before starting a new recipe, and perform all of these lessons on a development server.</p><p>We will continue using the custom debugging function that we created in <a class="link" href="ch01.html" title="Chapter 1. Pages and Page Types">Chapter 1</a>, <span class="emphasis"><em>Pages and Page Types</em></span>. Place the following function at the top of <code class="literal">site_post.php</code> if you'd like to follow along too:</p><div class="informalexample"><pre class="programlisting">function my_debug($var) {
   echo '&lt;pre&gt;';
   print_r($var);
   echo '&lt;/pre&gt;';
   exit;
}</pre></div><p>Of course, you're more than welcome to substitute our custom debugger with whatever you prefer.</p></div></div></div>
<div class="section" title="Loading a helper class"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec71"/>Loading a helper class</h1></div></div></div><p>The <code class="literal">Loader</code> class <a id="id256" class="indexterm"/>in concrete5 is useful for loading many different types of files in concrete5. We will use the <code class="literal">Loader</code> class to include and instantiate the Form helper.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec232"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Make sure you know the "handle" of the helper that you wish to load. The handle is the name of the file that contains the helper class without the <code class="literal">.php</code> extension. As we want to load the Form helper, which exists at <code class="literal">/concrete/helpers/form.php</code>, the handle will be <code class="literal">form</code>:<div class="informalexample"><pre class="programlisting">$handle = 'form';</pre></div></li><li class="listitem">Load the helper using the handle:<div class="informalexample"><pre class="programlisting">$formHelper = Loader::helper($handle);</pre></div></li><li class="listitem">Let's double-check that the helper was loaded correctly by dumping the contents of the <code class="literal">$formHelper</code> variable:<div class="informalexample"><pre class="programlisting">my_debug($formHelper);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec233"/>How it works...</h2></div></div></div><p>The <code class="literal">Loader</code> class includes PHP <a id="id257" class="indexterm"/>scripts, making it available for use. Also, when loading helpers, the included file will also be instantiated and returned, making it immediately available to use in your code.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec234"/>There's more...</h2></div></div></div><p>If you need to load a helper that is included in an add-on package, simply provide the package handle as a second parameter when loading the helper:</p><div class="informalexample"><pre class="programlisting">$helper = Loader::helper($handle, $packageHandle);</pre></div></div></div>
<div class="section" title="Using the Date helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec72"/>Using the Date helper</h1></div></div></div><p>There are a number of date-related <a id="id258" class="indexterm"/>tasks that are simplified with the Date helper. We will look at a couple of ways to use the Date helper to assist in handling dates in your custom code.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec235"/>Getting ready</h2></div></div></div><p>In this recipe, we will explore a couple of the functions of the Date helper.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec236"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your editor.</li><li class="listitem">Load the Date helper:<div class="informalexample"><pre class="programlisting">$date = Loader::helper('date');</pre></div></li><li class="listitem">Get the user's time:<div class="informalexample"><pre class="programlisting">$userTime = $date-&gt;getLocalDateTime();</pre></div></li><li class="listitem">Get the system time:<div class="informalexample"><pre class="programlisting">$systemTime = $date-&gt;getSystemDateTime();</pre></div></li><li class="listitem">Get an array of timezones:<div class="informalexample"><pre class="programlisting">$timezones = $date-&gt;getTimezones();</pre></div></li><li class="listitem">Output each of these values to the screen:<div class="informalexample"><pre class="programlisting">echo 'User time: ' . $userTime . '&lt;br /&gt;';
echo 'System time: ' . $systemTime . '&lt;br /&gt;';
my_debug($timezones);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec237"/>How it works...</h2></div></div></div><p>concrete5 wraps functions from both <a id="id259" class="indexterm"/>PHP and the Zend framework to create single-line tasks that would normally take several lines of code.</p></div></div>
<div class="section" title="Using the Encryption helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec73"/>Using the Encryption helper</h1></div></div></div><p>concrete5 makes it easy for <a id="id260" class="indexterm"/>developers to encrypt and decrypt strings using the included Encryption helper. In this recipe, we will use the Encryption helper to encrypt and decrypt some strings.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec238"/>Getting ready</h2></div></div></div><p>The majority of web servers come built-in with it, but it is important to make sure your web server has <code class="literal">mcrypt</code> installed as it is required for this helper to work.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec239"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Load the helper:<div class="informalexample"><pre class="programlisting">$eh = Loader::helper('encryption');</pre></div></li><li class="listitem">Encrypt a basic string:<div class="informalexample"><pre class="programlisting">$encrypted = $eh-&gt;encrypt('hello');</pre></div></li><li class="listitem">Output the encrypted string:<div class="informalexample"><pre class="programlisting">echo $encrypted . '&lt;br /&gt;';</pre></div></li><li class="listitem">Decrypt the encrypted string:<div class="informalexample"><pre class="programlisting">$decrypted = $eh-&gt;decrypt($encrypted);</pre></div></li><li class="listitem">Output the decrypted string:<div class="informalexample"><pre class="programlisting">echo $decrypted;
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec240"/>How it works...</h2></div></div></div><p>The Encryption helper wraps the <code class="literal">mcrypt</code> <a id="id261" class="indexterm"/>PHP extension, and encodes the encrypted text in a Base64 encoded string.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec241"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Loading an RSS feed with the Feed helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec74"/>Loading an RSS feed with the Feed helper</h1></div></div></div><p>concrete5 comes with a <a id="id262" class="indexterm"/>third-party library called <code class="literal">SimplePie</code> that assists with <a id="id263" class="indexterm"/>parsing RSS feeds. The Feed helper wraps around the <code class="literal">SimplePie</code> library to provide a more convenient way to load RSS feeds.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec242"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the Feed helper:<div class="informalexample"><pre class="programlisting">$rss = Loader::helper('feed');</pre></div></li><li class="listitem">Define the URL of the RSS feed to load. We will load the news feed from Packt Publishing:<div class="informalexample"><pre class="programlisting">$url = 'http://www.packtpub.com/rss.xml';</pre></div></li><li class="listitem">Load the feed:<div class="informalexample"><pre class="programlisting">$feed = $rss-&gt;load($url);</pre></div></li><li class="listitem">Dump the contents of the feed object to verify that it loaded correctly:<div class="informalexample"><pre class="programlisting">my_debug($feed);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec243"/>How it works...</h2></div></div></div><p>The <code class="literal">load</code> function simply creates a new instance of the <code class="literal">SimplePie</code> class and loads the feed specified in the parameter. The <code class="literal">load</code> function then returns a <code class="literal">SimplePie</code> object based on the feed that was loaded.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec244"/>There's more...</h2></div></div></div><p>You can learn more <a id="id264" class="indexterm"/>about <code class="literal">SimplePie</code> <a id="id265" class="indexterm"/>and how to use the feed objects by visiting <a class="ulink" href="http://simplepie.org">http://simplepie.org</a>.</p></div></div>
<div class="section" title="Managing files and directories with the File helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec75"/>Managing files and directories with the File helper</h1></div></div></div><p>Working with files and <a id="id266" class="indexterm"/>
<a id="id267" class="indexterm"/>directories that exist on the web server can sometimes be a tedious task. The concrete5 File helper provides convenience methods to make working with files and directories a much simpler task.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec245"/>Getting ready</h2></div></div></div><p>This exercise will <a id="id268" class="indexterm"/>deal a lot with <a id="id269" class="indexterm"/>hypothetical files and filenames. This is meant more as an exploration of the File helper API, so feel free to substitute some of the filenames here for actual files that exist in your system.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec246"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the File helper:<div class="informalexample"><pre class="programlisting">$fh = Loader::helper('file');</pre></div></li><li class="listitem">Sanitize a filename so that it is suitable for saving:<div class="informalexample"><pre class="programlisting">$filename = 'Make This Eligible!';
$cleanName = $fh-&gt;sanitize($filename);
echo $cleanName; // outputs 'make_this_eligible'</pre></div></li><li class="listitem">Get the extension of a filename:<div class="informalexample"><pre class="programlisting">$ext = $fh-&gt;getExtension('image.png');
echo $ext; // outputs 'png'</pre></div></li><li class="listitem">Change the extension of a file:<div class="informalexample"><pre class="programlisting">$newFilename = $fh-&gt;replaceExtension('image.png', 'jpeg');
echo $newFilename; // outputs 'image.jpeg' </pre></div></li><li class="listitem">Get a file's contents:<div class="informalexample"><pre class="programlisting">$contents = $fh-&gt;getContents('data.txt');</pre></div></li><li class="listitem">Force a file to download to the user's computer:<div class="informalexample"><pre class="programlisting">$fh-&gt;forceDownload('/path/to/file.zip');</pre></div></li><li class="listitem">Copy a directory's contents to another directory:<div class="informalexample"><pre class="programlisting">$fh-&gt;copyAll('/source', '/target');</pre></div></li><li class="listitem">Delete all of the files in a directory:<div class="informalexample"><pre class="programlisting">$fh-&gt;removeAll('/directory/to/delete');</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec247"/>How it works...</h2></div></div></div><p>The File helper makes <a id="id270" class="indexterm"/>use of <a id="id271" class="indexterm"/>many of the built-in functions of PHP, such as <code class="literal">file_get_contents</code>, <code class="literal">unlink</code>, and <code class="literal">copy</code>. The helper takes these functions several steps further by wrapping <a id="id272" class="indexterm"/>them with <a id="id273" class="indexterm"/>additional logic to make most of these operations only require a single line of code.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec248"/>There's more...</h2></div></div></div><p>There are some other functions that the File helper provides, which can be discovered by viewing the source code of the file in <code class="literal">concrete/core/helpers/file.php</code>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec249"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating custom forms with the Form helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec76"/>Creating custom forms with the Form helper</h1></div></div></div><p>Creating forms is one of the <a id="id274" class="indexterm"/>most common tasks that web <a id="id275" class="indexterm"/>developers are faced with on a regular basis. concrete5 provides the Form helper to make creating forms easy. In this recipe, we will create a feedback form using the Form helper.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec250"/>Getting ready</h2></div></div></div><p>The code in this recipe will be inserted into a <code class="literal">&lt;form&gt;</code> element on our website. See the complete example code on the website for this book. Our form will contain the following fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Name</strong></span> (text input)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Email Address</strong></span> (text input)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Reason for Contacting</strong></span> (select box)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Message</strong></span> (textarea)</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec251"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new single page by adding a new file located at <code class="literal">/single_pages/example_form.php</code>.</li><li class="listitem">Install the single page by visiting <code class="literal">/dashboard/pages/single</code> on your concrete5 website. Enter <code class="literal">example_form</code> as the path for the new page.</li><li class="listitem">Load the Form helper:<div class="informalexample"><pre class="programlisting">$form = Loader::helper('form');</pre></div></li><li class="listitem">Output the field for the <span class="strong"><strong>Name</strong></span> input:<div class="informalexample"><pre class="programlisting">echo $form-&gt;text('name');</pre></div></li><li class="listitem">Output the field for the <span class="strong"><strong>Email Address</strong></span> input:<div class="informalexample"><pre class="programlisting">echo $form-&gt;email('email');</pre></div></li><li class="listitem">Create an associative <a id="id276" class="indexterm"/>array <a id="id277" class="indexterm"/>containing the options that will appear in the <span class="strong"><strong>Reason for Contacting</strong></span> select box:<div class="informalexample"><pre class="programlisting">$options = array(
   'general' =&gt; 'General Feedback',
   'support' =&gt; 'Technical Support',
   'return' =&gt; 'Returns / Refunds'
);</pre></div></li><li class="listitem">Output the <span class="strong"><strong>Reason for Contacting</strong></span> select box:<div class="informalexample"><pre class="programlisting">echo $form-&gt;select('reason_for_contacting', $options);</pre></div></li><li class="listitem">Show the <span class="strong"><strong>Message</strong></span> textarea:<div class="informalexample"><pre class="programlisting">echo $form-&gt;textarea('message');</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec252"/>How it works...</h2></div></div></div><p>The Form helper's functions return HTML that can be directly inserted into your forms on the website. If you provide an extra parameter to these functions, you can pre-fill the field's value with whatever you like (unless the value is present in the HTTP request parameters, which in that case concrete5 will fill the field with that value). There are many benefits to creating forms this way, and one can save a lot of time by following the simple conventions presented here.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec253"/>There's more...</h2></div></div></div><p>There are many form elements that can be generated using the Form helper. Radio buttons, checkboxes, select elements, text inputs, and more. Refer to the Form helper class at <code class="literal">concrete/core/helpers/form.php</code> or visit the concrete5 developer's documentation at <a class="ulink" href="http://www.concrete5.org/documentation/developers/forms/">http://www.concrete5.org/documentation/developers/forms/</a>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec254"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Including a WYSIWYG editor on a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec77"/>Including a WYSIWYG editor on a form</h1></div></div></div><p>concrete5, being a content management <a id="id278" class="indexterm"/>system, comes with built-in <span class="strong"><strong>What You See Is What You Get</strong></span> (<span class="strong"><strong>WYSIWYG</strong></span>) editors, specifically, a popular open source editor called <a id="id279" class="indexterm"/>
<span class="strong"><strong>TinyMCE</strong></span>. Developers can include this editor in their custom HTML forms. <a id="id280" class="indexterm"/>In this recipe, we will add a WYSIWYG editor to the form that we created in the previous recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec255"/>Getting ready</h2></div></div></div><p>We will be building upon the form that was created in the previous recipe. The free code download from this book's website will give you a good starting point if you need to catch up.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec256"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/single_pages/example_form.php</code>.</li><li class="listitem">At the top of the file, include the JavaScript element to initialize the editor:<div class="informalexample"><pre class="programlisting">Loader::element('editor_init');</pre></div></li><li class="listitem">Below that, include the default TinyMCE configuration element:<div class="informalexample"><pre class="programlisting">Loader::element('editor_config');</pre></div></li><li class="listitem">Above the existing textarea output, load the element containing the editor's controls:<div class="informalexample"><pre class="programlisting">Loader::element('editor_controls');</pre></div></li><li class="listitem">Replace the existing textarea output with a new one:<div class="informalexample"><pre class="programlisting">echo $form-&gt;textarea('content', '', array('style' =&gt; 'width:100%;', 'class' =&gt; 'ccm-advanced-editor'));</pre></div><div class="mediaobject"><img src="graphics/4548OS_04_01.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec257"/>How it works...</h2></div></div></div><p>The modified TinyMCE editor that concrete5 uses requires a lot of JavaScript to be in place before it can be included on a <a id="id281" class="indexterm"/>web page. concrete5 elements contain repeatable blocks of HTML, (or CSS and JavaScript in the form of <code class="literal">&lt;style&gt;</code> and <code class="literal">&lt;script&gt;</code> tags). At the top of our form, we include the elements with the TinyMCE JavaScript and the configuration settings.</p><p>It's optional, but it's a good idea to include the editor's control elements right above the textarea that will become the <a id="id282" class="indexterm"/>WYSIWYG editor. These controls have concrete5-specific functions, such as inserting links to pages in the site map or including images from the file manager. Note that as these controls mainly provide functionality relevant to site editors, these controls are better suited for backend forms, rather than use by end users.</p><p>Finally, we output a regular textarea element, but with a class of <code class="literal">ccm-advanced-editor</code>, which tells TinyMCE to turn this into a WYSIWYG editor.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec258"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating custom forms with the Form helper</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Generating HTML code with the HTML helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec78"/>Generating HTML code with the HTML helper</h1></div></div></div><p>In many situations, you will <a id="id283" class="indexterm"/>want to avoid writing HTML strings in your <a id="id284" class="indexterm"/>PHP server-side code, as it can really clutter your code and make it harder to read. The HTML helper in concrete5 can help you avoid that by providing a nice, object oriented way to generate HTML code.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec259"/>Getting ready</h2></div></div></div><p>This recipe assumes that <code class="literal">/css/example.css</code>, <code class="literal">/js/example.js</code>, and <code class="literal">/images/icon.png</code> all exist on your site. You can perform this recipe without those files existing, concrete5 will simply output a path to those non-existent files.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec260"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make the HTML helper available for use:<div class="informalexample"><pre class="programlisting">$html = Loader::helper('html');</pre></div></li><li class="listitem">Output a CSS <code class="literal">&lt;link&gt;</code> tag, linking to a CSS file stored at <code class="literal">/css/example.css</code>:<div class="informalexample"><pre class="programlisting">echo $html-&gt;css('example.css');</pre></div></li><li class="listitem">Output a JavaScript <code class="literal">&lt;script&gt;</code> tag, setting the <code class="literal">src</code> attribute to a file that exists at <code class="literal">/js/example.js</code>:<div class="informalexample"><pre class="programlisting">echo $html-&gt;javascript('example.js');</pre></div></li><li class="listitem">Output an image <code class="literal">&lt;img&gt;</code> tag, showing an image that is stored at <code class="literal">/images/icon.png</code>:<div class="informalexample"><pre class="programlisting">echo $html-&gt;image('icon.png');
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec261"/>How it works...</h2></div></div></div><p>concrete5 will recursively look through several directories to find the appropriate files that you need. It will then wrap the source path in the appropriate tag, whether it is a script, a CSS link, or an image.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec262"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Generating and caching thumbnails with the Image helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec79"/>Generating and caching thumbnails with the Image helper</h1></div></div></div><p>Many types <a id="id285" class="indexterm"/>of applications <a id="id286" class="indexterm"/>make use of thumbnails to display representations of larger images. This <a id="id287" class="indexterm"/>allows users to see many images <a id="id288" class="indexterm"/>on one page without having to wait for several large file sizes of images to load.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec263"/>Getting ready</h2></div></div></div><p>The Image helper's thumbnail generator accepts a <code class="literal">File</code> object, so make sure to refer to <a class="link" href="ch03.html" title="Chapter 3. Files and File Sets">Chapter 3</a>, <span class="emphasis"><em>Files and File Sets</em></span>, to know how to get those loaded.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec264"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Load the Image helper:<div class="informalexample"><pre class="programlisting">$ih = Loader::helper('image');</pre></div></li><li class="listitem">Load the <code class="literal">File</code> object that we want to create a thumbnail of. This should be an image (JPEG, PNG, or GIF) and should exist in the File Manager. We will use the ID of <code class="literal">1</code> for our example image:<div class="informalexample"><pre class="programlisting">$fileId = 1;
$image = File::getByID($fileId);</pre></div></li><li class="listitem">Generate a thumbnail with a height and width of 100 pixels, and crop the image to fit:<div class="informalexample"><pre class="programlisting">$thumbnail = $ih-&gt;getThumbnail($image, 100, 100, true);</pre></div></li><li class="listitem">Echo the thumbnail image's source location:<div class="informalexample"><pre class="programlisting">echo $thumbnail-&gt;src;
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec265"/>How it works...</h2></div></div></div><p>The Image helper will take the <code class="literal">File</code> object (or file path string) and first check to see if a thumbnail of that size has already been created. If it has, it will serve that thumbnail from the cache. If the thumbnail does not exist, concrete5 will use the <code class="literal">gd</code> PHP extension to resize and crop the image (if the fourth parameter is specified and set to <code class="literal">true</code>) and then save the new copy to the cache.</p><p>The helper returns a standard class object that has a few properties, <code class="literal">src</code>, <code class="literal">height</code>, and <code class="literal">width</code>. In this example, we are interested in the <code class="literal">src</code> property.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec266"/>There's more...</h2></div></div></div><p>You can have the <a id="id289" class="indexterm"/>Image helper applications <a id="id290" class="indexterm"/>output a thumbnail already wrapped in an <code class="literal">&lt;img&gt;</code> tag <a id="id291" class="indexterm"/>by <a id="id292" class="indexterm"/>simply calling the following:</p><div class="informalexample"><pre class="programlisting">echo $ih-&gt;outputThumbnail($image, 100, 100);</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec267"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a file by its ID</em></span> recipe in <a class="link" href="ch03.html" title="Chapter 3. Files and File Sets">Chapter 3</a>, <span class="emphasis"><em>Files and File Sets</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Encoding and decoding JSON with the JSON helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec80"/>Encoding and decoding JSON with the JSON helper</h1></div></div></div><p>Most PHP <a id="id293" class="indexterm"/>installations <a id="id294" class="indexterm"/>include handy JSON functions such as <code class="literal">encode_json</code> and <code class="literal">decode_json</code>, which allows developers to easily generate JSON data to pass through to the user's browser. concrete5 includes the JSON helpers to allow you to encode and decode JSON <a id="id295" class="indexterm"/>even on systems that do not have those functions available. This is particularly useful if you are developing an add-on that will run on <a id="id296" class="indexterm"/>several different types of environments.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec268"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the JSON helper:<div class="informalexample"><pre class="programlisting">$json = Loader::helper('json');</pre></div></li><li class="listitem">Create an array that will be converted to a JSON string:<div class="informalexample"><pre class="programlisting">$data = array(
   'name' =&gt; 'John Doe',
   'age' =&gt; '31'
);</pre></div></li><li class="listitem">Encode the array into a JSON string:<div class="informalexample"><pre class="programlisting">$jsonStr = $json-&gt;encode($data);</pre></div></li><li class="listitem">Decode the JSON string back to an object:<div class="informalexample"><pre class="programlisting">$newObject = $json-&gt;decode($jsonStr);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec269"/>How it works...</h2></div></div></div><p>If the native JSON functions are <a id="id297" class="indexterm"/>present, these helper functions will simply wrap around those. On environments where the <a id="id298" class="indexterm"/>JSON encode and decode functions are unavailable, concrete5 will use a third-party <a id="id299" class="indexterm"/>JSON library to facilitate the encoding <a id="id300" class="indexterm"/>and decoding of the JSON strings.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec270"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Sending e-mails with the Mail helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec81"/>Sending e-mails with the Mail helper</h1></div></div></div><p>The ability to send e-mails <a id="id301" class="indexterm"/>from your web app can add a great layer of <a id="id302" class="indexterm"/>functionality to the end user. In this recipe, we will send an e-mail out with a simple subject and body.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec271"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the Mail helper:<div class="informalexample"><pre class="programlisting">$mail = Loader::helper('mail');</pre></div></li><li class="listitem">Specify the e-mail address that we wish to send the e-mail to:<div class="informalexample"><pre class="programlisting">$mail-&gt;to('test@example.com');</pre></div></li><li class="listitem">Specify the e-mail address that this e-mail is from (and who the recipient can reply to):<div class="informalexample"><pre class="programlisting">$mail-&gt;from('noreply@example.com');</pre></div></li><li class="listitem">Set the subject line of the e-mail:<div class="informalexample"><pre class="programlisting">$mail-&gt;setSubject('Hello from your concrete5 website!');</pre></div></li><li class="listitem">Set the message body:<div class="informalexample"><pre class="programlisting">$mail-&gt;setBody('This email was sent from your webserver!');</pre></div></li><li class="listitem">Send the e-mail:<div class="informalexample"><pre class="programlisting">$mail-&gt;sendMail();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec272"/>How it works...</h2></div></div></div><p>The Mail helper wraps around the <code class="literal">Zend_Mail</code> object, which is part of the Zend framework that concrete5 is built upon. The Mail helper will obey the concrete5 installation's settings, to send mails <a id="id303" class="indexterm"/>either by using PHP's built-in mail function, or by using an external SMTP server.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec273"/>There's more...</h2></div></div></div><p>You can send e-mails with templates, HTML text, and more with the Mail helper. Mail templates can be stored in the <code class="literal">/mail</code> directory of your concrete5 website. The following an example template that would exist at <code class="literal">/mail/test.php</code>:</p><div class="informalexample"><pre class="programlisting">$subject = 'Hello from your website!';
$body = 'This is the body! Hello, '.$name;</pre></div><p>Notice how in this template, we refer to a <a id="id304" class="indexterm"/>variable called <code class="literal">$name</code>. To pass that variable into the template, call the <code class="literal">addParameter</code> function of the Mail helper:</p><div class="informalexample"><pre class="programlisting">$mail-&gt;addParameter('name', 'John Doe');</pre></div><p>To load the template and apply extra <a id="id305" class="indexterm"/>parameters, call the <code class="literal">load</code> function just before sending. Remember that our template exists at <code class="literal">/mail/test.php</code>:</p><div class="informalexample"><pre class="programlisting">$mail-&gt;load('test');</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec274"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Determining the MIME type of a file extension using the MIME helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec82"/>Determining the MIME type of a file extension using the MIME helper</h1></div></div></div><p>concrete5 can easily <a id="id306" class="indexterm"/>determine the <span class="strong"><strong>Multipurpose Internet Mail Extensions</strong></span> (<span class="strong"><strong>MIME</strong></span>) type of a file using the MIME helper.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec275"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the MIME helper:<div class="informalexample"><pre class="programlisting">$mime = Loader::helper('mime');</pre></div></li><li class="listitem">Determine the MIME type of a JavaScript file:<div class="informalexample"><pre class="programlisting">$jsMime = $mime-&gt;mimeFromExtension('js');</pre></div></li><li class="listitem">Verify that the MIME type is correct:<div class="informalexample"><pre class="programlisting">echo $jsMime; // outputs 'application/x-javascript'
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec276"/>How it works...</h2></div></div></div><p>The MIME helper contains an array of several common MIME types and their related extensions. When you give the MIME helper an extension to find, it will simply find the related MIME type and return it to you.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec277"/>There's more...</h2></div></div></div><p>The MIME helper can also return the file <a id="id307" class="indexterm"/>extension of a given MIME type:</p><div class="informalexample"><pre class="programlisting">$jsExt = $mime-&gt;mimeToExtension('application/x-javascript');
echo $jsExt;</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec278"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting page URLs and breadcrumbs with the Navigation helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec83"/>Getting page URLs and breadcrumbs with the Navigation helper</h1></div></div></div><p>The Navigation <a id="id308" class="indexterm"/>helper can <a id="id309" class="indexterm"/>assist with two very important functions: getting accurate page URLs <a id="id310" class="indexterm"/>and <a id="id311" class="indexterm"/>generating a breadcrumb trail for a given <code class="literal">Page</code> object.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec279"/>Getting ready</h2></div></div></div><p>We will need to load a <code class="literal">Page</code> object and pass it to the Navigation helper, so make sure you are familiar with that.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec280"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the Navigation helper:<div class="informalexample"><pre class="programlisting">$nav = Loader::helper('navigation');</pre></div></li><li class="listitem">Load the <code class="literal">Page</code> object that we are going to work with. In this example, we will use a page located at <code class="literal">example.com/about-us</code>:<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about-us');</pre></div></li><li class="listitem">Get the URL for the page:<div class="informalexample"><pre class="programlisting">$url = $nav-&gt;getCollectionURL($page);</pre></div></li><li class="listitem">Get an array of breadcrumb items (as <code class="literal">Page</code> objects) for the given page:<div class="informalexample"><pre class="programlisting">$breadcrumbs = $nav-&gt;getTrailToCollection($page);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec281"/>How it works...</h2></div></div></div><p>The Navigation helper checks your <a id="id312" class="indexterm"/>configuration <a id="id313" class="indexterm"/>settings and appends any base URLs or rewriting logic to the page's <a id="id314" class="indexterm"/>collection path. For breadcrumbs, the helper recursively travels up the <a id="id315" class="indexterm"/>sitemap from the given page to find all of the parent pages above it.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec282"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Pages and Page Types">Chapter 1</a>, <span class="emphasis"><em>Pages and Page Types</em></span></li></ul></div></div></div>
<div class="section" title="Working with strings using the Text helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec84"/>Working with strings using the Text helper</h1></div></div></div><p>Another useful helper that <a id="id316" class="indexterm"/>concrete5 provides is the Text helper. The Text <a id="id317" class="indexterm"/>helper lets you perform several common (and sometimes complex) operations on strings with very little code.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec283"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the Text helper:<div class="informalexample"><pre class="programlisting">$text = Loader::helper('text');</pre></div></li><li class="listitem">Create a string to use for the example:<div class="informalexample"><pre class="programlisting">$str = 'This is a test';</pre></div></li><li class="listitem">CamelCase a string (CamelCase):<div class="informalexample"><pre class="programlisting">$camelCased = $text-&gt;camelcase($str);
echo $camelCased; // outputs "ThisIsATest"</pre></div></li><li class="listitem">Un-CamelCase that string:<div class="informalexample"><pre class="programlisting">$uncamelcased = $text-&gt;uncamelcase($camelCased);
echo $uncamelcased; // outputs 'this_is_a_test'</pre></div></li><li class="listitem">Create a URL-friendly string with hyphens:<div class="informalexample"><pre class="programlisting">$url = $text-&gt;urlify($str);
echo $url; // outputs 'this-is-a-test'</pre></div></li><li class="listitem">Create an underscored handle:<div class="informalexample"><pre class="programlisting">$handle = $text-&gt;handle($str);
echo $handle; // outputs 'this_is_a_test'</pre></div></li><li class="listitem">Remove all non-alphanumeric characters:<div class="informalexample"><pre class="programlisting">$alphaNum = $text-&gt;alphanum($str);
echo $alphaNum; // outputs 'This is a test'
Truncate a string and append an ellipsis at the end.
$trunc = $text-&gt;short$trunc = $text-&gt;short$trunc = $text-&gt;short
echo $trunc; // outputs 'This...'
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec284"/>How it works...</h2></div></div></div><p>The Text helper wraps around several <a id="id318" class="indexterm"/>built-in PHP functions, as well as some third-party libraries to provide convenient, <a id="id319" class="indexterm"/>one-line functions that allow you to modify your text quickly and easily.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec285"/>There's more...</h2></div></div></div><p>The Text helper has a few other useful functions that are beyond the scope of this recipe, such as automatically creating links out of any URLs in a string or even automatically linking to Twitter handles. It is recommended that developers explore the source code of the Text helper to see some of the more niche functionality that it provides.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec286"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Generating URLs with the URL helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec85"/>Generating URLs with the URL helper</h1></div></div></div><p>The URL helper can <a id="id320" class="indexterm"/>generate URLs using some simple <a id="id321" class="indexterm"/>functions.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec287"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the URL helper:<div class="informalexample"><pre class="programlisting">$uh = Loader::helper('url');</pre></div></li><li class="listitem">Create an array that contains the URL parameters that we want to pass in. We will just make some stuff up for this example:<div class="informalexample"><pre class="programlisting">$params = array(
   'page' =&gt; '1',
   'filter' =&gt; 'events'
);</pre></div></li><li class="listitem">Build the URL:<div class="informalexample"><pre class="programlisting">$url = $uh-&gt;buildQuery('http://example.com', $params);</pre></div></li><li class="listitem">Output the URL to see the result:<div class="informalexample"><pre class="programlisting">echo $url; // outputs http://example.com?page=1&amp;filter=events
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec288"/>How it works...</h2></div></div></div><p>This function makes use of PHP's <code class="literal">http_build_query</code> function that can generate valid URLs when given an array of <a id="id322" class="indexterm"/>parameters.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec289"/>There's more...</h2></div></div></div><p>The URL helper also has a <a id="id323" class="indexterm"/>function to create a shortened URL using the TinyURL service.</p><div class="informalexample"><pre class="programlisting">$short = $uh-&gt;shortenURL('http://example.com');
echo $short; // outputs http://tinyurl.com/123abc</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec290"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Validating input data using the Validation helpers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec86"/>Validating input data using the Validation helpers</h1></div></div></div><p>When building an application <a id="id324" class="indexterm"/>that accepts user data, it is definitely a <a id="id325" class="indexterm"/>good idea to make sure that users are filling out all of the required fields on a form.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec291"/>Getting ready</h2></div></div></div><p>Consider a comment form that has the following fields: Name, Email, Website, and Comment content. The name, e-mail, and content fields are required, but the website field is optional. We will use the Validation helper to determine if the user filled out all of the required fields.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec292"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the Validation helper:<div class="informalexample"><pre class="programlisting">$val = Loader::helper('validation/form');</pre></div></li><li class="listitem">Let's create an array to simulate the data that would be contained in the <code class="literal">POST</code> request (via the <code class="literal">$_POST</code> super global). We will intentionally leave <code class="literal">email</code> blank to see how the Validation helper behaves when a test fails:<div class="informalexample"><pre class="programlisting">$data = array(
   'name' =&gt; 'Jane Doe',
   'email' =&gt; '',
   'website' =&gt; 'http://example.com',
   'content' =&gt; 'Great post!'
);</pre></div></li><li class="listitem">Pass the array to the Validation helper so that it knows what to validate against:<div class="informalexample"><pre class="programlisting">$val-&gt;setData($data);</pre></div></li><li class="listitem">Specify the fields that are required, with error messages for each one:<div class="informalexample"><pre class="programlisting">$val-&gt;addRequired('name', 'Please enter a name.');
$val-&gt;addRequiredEmail('email', 'Please enter an email address.');
$val-&gt;addRequired('content', 'Please enter some content.');</pre></div></li><li class="listitem">Test the array to see if it passes the requirements.<div class="informalexample"><pre class="programlisting">$passed = $val-&gt;test();
Output the list of errors so the user knows what fields are missing.
 if ($passed === false) {
   foreach ($val-&gt;getError()-&gt;getList() as $error) {
      echo $error . '&lt;br /&gt;';
   }
 }
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec293"/>How it works...</h2></div></div></div><p>The Validation helper is pretty basic in <a id="id326" class="indexterm"/>terms of functionality, it essentially checks for the presence of a given variable in the data <a id="id327" class="indexterm"/>array, and makes sure that it has some sort of value. Notice the use of <code class="literal">addRequiredEmail</code> in step 4. This function makes sure the e-mail address is present and also verifies that it is a proper e-mail address (not just any string).</p><p>The <code class="literal">getError</code> function on the Validation helper returns a <code class="literal">ValidationErrorHelper</code> object that has a function called <code class="literal">getList</code> that can provide an easy-to-use array of error messages.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec294"/>There's more...</h2></div></div></div><p>In addition to testing for regular strings and e-mails, you can also test for integer values:</p><div class="informalexample"><pre class="programlisting">$val-&gt;addRequiredInteger('age', 'Please enter your age.');</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec295"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Preventing spam using the Captcha helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec87"/>Preventing spam using the Captcha helper</h1></div></div></div><p>As most web developers who <a id="id328" class="indexterm"/>have ever published a form online know, <a id="id329" class="indexterm"/>spam is an annoying and potentially damaging issue for site owners. concrete5 can help mitigate this problem with a built-in Captcha helper that can verify that form submissions are coming from humans, rather than automated scripts.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec296"/>Getting ready</h2></div></div></div><p>This recipe will explain how to use the Captcha helper. Typically, you will use this helper in the HTML views that your end-user would see (single page views, block views, and so on). An example of this helper in the context of a single page is included in the book's code download.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec297"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the Captcha helper:<div class="informalexample"><pre class="programlisting">$captcha = Loader::helper('validation/captcha');</pre></div></li><li class="listitem">At the bottom of your form, display the CAPTCHA image and the input to allow the user to solve it:<div class="informalexample"><pre class="programlisting">&lt;?php echo $captcha-&gt;display(); ?&gt; &lt;br /&gt;
&lt;?php echo $captcha-&gt;showInput(); ?&gt;</pre></div></li><li class="listitem">In the server-side code that processes the form submission, verify that the CAPTCHA was solved correctly:<div class="informalexample"><pre class="programlisting">if ($captcha-&gt;check()) {
   // User passed, continue processing.
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec298"/>How it works...</h2></div></div></div><p>The Captcha helper takes advantage of a third-party library called <code class="literal">SecureImage</code> to generate the CAPTCHA images and related logic. If the user types the word in the image correctly, the <code class="literal">check</code> function will return <code class="literal">true</code>, and you can continue processing the form submission.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec299"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a list of countries"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec88"/>Getting a list of countries</h1></div></div></div><p>Many times, web developers find <a id="id330" class="indexterm"/>themselves needing to provide a list of countries to users. Rather than hunt down this data or even manually assemble the data, concrete5 provides a helper to generate a list of all of the countries of the world. In this recipe, we will take the country list and create a <code class="literal">&lt;select&gt;</code> element that can be placed in a form, allowing users to select a country.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec300"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a single page at <code class="literal">/single_pages/example_form.php</code>.</li><li class="listitem">Install the single page by visiting <code class="literal">/dashboard/pages/single</code> and typing <code class="literal">example_form</code> in the path input.</li><li class="listitem">Open <code class="literal">/single_pages/example_form.php</code> in your code editor.</li><li class="listitem">At the top of the file, load the country list helper:<div class="informalexample"><pre class="programlisting">$list = Loader::helper('lists/countries');</pre></div></li><li class="listitem">Get the array of the available countries:<div class="informalexample"><pre class="programlisting">$countries = $list-&gt;getCountries();</pre></div></li><li class="listitem">Load the Form helper:<div class="informalexample"><pre class="programlisting">$form = Loader::helper('form');</pre></div></li><li class="listitem">Create an HTML form that contains a select element with all of the countries:<div class="informalexample"><pre class="programlisting">&lt;form&gt;
   &lt;?php echo $form-&gt;select('country', $countries); ?&gt;
&lt;/form&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec301"/>How it works...</h2></div></div></div><p>concrete5 takes the heavy lifting of assembling and maintaining a list of countries and builds it into the core list helper. The country's two-character code is provided as the array key, and the full name string as the value.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec302"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating custom forms with the Form helper</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a list of states and provinces"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec89"/>Getting a list of states and provinces</h1></div></div></div><p>In addition to providing <a id="id331" class="indexterm"/>lists of countries, concrete5 can also provide lists of states, provinces, and counties, for the countries in which such a list is applicable.</p><p>In this recipe, we will get a list of all of <a id="id332" class="indexterm"/>the counties of the United Kingdom and present them in a <code class="literal">&lt;select&gt;</code> input.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec303"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If it doesn't exist, create a single page at <code class="literal">/single_pages/example_form.php</code>.</li><li class="listitem">Load the List helper:<div class="informalexample"><pre class="programlisting">$list = Loader::helper('lists/states_provinces');</pre></div></li><li class="listitem">Get the list of counties in the UK:<div class="informalexample"><pre class="programlisting">$counties = $list-&gt;getStateProvinceArray('UK');</pre></div></li><li class="listitem">Load the Form helper:<div class="informalexample"><pre class="programlisting">$form = Loader::helper('form');</pre></div></li><li class="listitem">Create an HTML form that has a <code class="literal">&lt;select&gt;</code> element containing the list of counties:<div class="informalexample"><pre class="programlisting">&lt;form&gt;
   &lt;?php echo $form-&gt;select('county', $counties); ?&gt;
&lt;/form&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec304"/>How it works...</h2></div></div></div><p>The state/province List helper works much like the Country helper, in that the concrete5 team has assembled a list of states/counties/provinces for various counties that can be accessed by providing the two-character code.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec305"/>There's more...</h2></div></div></div><p>If you want to get all of the states and provinces stored in the helper, you can use the following code:</p><div class="informalexample"><pre class="programlisting">$allProvinces = $list-&gt;getAll();</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec306"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The c<span class="emphasis"><em>Loading a helper class</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating custom forms with the Form helper</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Showing a color picker on a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec90"/>Showing a color picker on a form</h1></div></div></div><p>concrete5 provides helpers to <a id="id333" class="indexterm"/>generate standard HTML form elements, but what about applications that need to allow users to pick a color? For those applications, concrete5 includes a color picker helper as well!</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec307"/>Getting ready</h2></div></div></div><p>The color picker relies on jQuery UI, <a id="id334" class="indexterm"/>which isn't automatically included in concrete5, unless you are logged in as an administrator. Be sure to include jQuery UI's JavaScript and CSS files on the page if you use the color picker on the frontend of the site.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec308"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If it doesn't already exist, create a single page at <code class="literal">/single_pages/example_form.php</code>.</li><li class="listitem">Install this single page on the dashboard if need be.</li><li class="listitem">Load the color picker helper at the top of the file:<div class="informalexample"><pre class="programlisting">$color = Loader::helper('form/color');</pre></div></li><li class="listitem">Output the color picker widget in an HTML form element:<div class="informalexample"><pre class="programlisting">&lt;form&gt;
   &lt;?php echo $color-&gt;output('color', 'Choose a color...') ?&gt;
&lt;/form&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec309"/>How it works...</h2></div></div></div><p>concrete5 will generate the HTML and JavaScript necessary to provide an interactive color picker widget. The first parameter passed to the <code class="literal">output</code> function is the name of the field, which is how the value will be accessed once the form is submitted. The second parameter is the text that will appear in a <code class="literal">&lt;label&gt;</code> element next to the color picker.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec310"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Showing a date/time selector on a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec91"/>Showing a date/time selector on a form</h1></div></div></div><p>A very <a id="id335" class="indexterm"/>common <a id="id336" class="indexterm"/>user <a id="id337" class="indexterm"/>experience <a id="id338" class="indexterm"/>when using web apps that require date inputs is to have the users choose the date on an interactive calendar, rather than typing the full date. concrete5 provides a helper to generate such widgets with ease. In this recipe, we will generate a date picker that will show a mini-calendar to allow users to choose a date.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec311"/>Getting ready</h2></div></div></div><p>concrete5 only automatically includes the JavaScript files for jQuery UI when users are logged in as administrators. If you wish to use the date picker in areas of the site where non-administrators can use it, be sure to include the jQuery UI JavaScript and CSS files in the page.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec312"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a single page at <code class="literal">/single_pages/example_form.php</code> if it doesn't already exist.</li><li class="listitem">Be sure to install <a id="id339" class="indexterm"/>the single <a id="id340" class="indexterm"/>page on the dashboard by visiting <code class="literal">/dashboard/pages/single</code>.</li><li class="listitem">Load the date/time <a id="id341" class="indexterm"/>helper:<div class="informalexample"><pre class="programlisting">$datePicker = Loader::helper('form/date_time');</pre></div></li><li class="listitem">Output the date <a id="id342" class="indexterm"/>picker into an HTML form:<div class="informalexample"><pre class="programlisting">&lt;form&gt;
   &lt;?php echo $datePicker-&gt;date('date') ?&gt;
&lt;/form&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec313"/>How it works...</h2></div></div></div><p>concrete5 makes use of the jQuery UI library to generate the JavaScript and CSS necessary to create an interactive date picker. The date/time helper generates all of the necessary boilerplate HTML and JavaScript, which makes using date pickers a very simple process.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec314"/>There's more...</h2></div></div></div><p>Sometimes developers will need to provide users with an interface to also select a time to go along with the date. This is simply a matter of calling a different function on the date/time helper:</p><div class="informalexample"><pre class="programlisting">echo $datePicker-&gt;datetime('date')</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec315"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Showing a rating widget on a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec92"/>Showing a rating widget on a form</h1></div></div></div><p>Modern web <a id="id343" class="indexterm"/>applications provide a set of star icons for users to click on, providing a "rating" of a given item. It is simple to include these types of UI components in concrete5 <a id="id344" class="indexterm"/>applications using the Rating helper.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec316"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a single page at <code class="literal">/single_pages/example_form.php</code> if it does not exist.</li><li class="listitem">Install the single page by visiting <code class="literal">/dashboard/pages/single</code> and entering <code class="literal">example_form</code> as the page location.</li><li class="listitem">Load the Rating form helper:<div class="informalexample"><pre class="programlisting">$rh = Loader::helper('form/rating');</pre></div></li><li class="listitem">Output the rating widget:<div class="informalexample"><pre class="programlisting">&lt;form&gt;
   &lt;?php echo $rh-&gt;rating('rating', 60) ?&gt;
&lt;/form&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec317"/>How it works...</h2></div></div></div><p>The Rating helper makes use of a third-party jQuery plugin to provide an interactive rating chooser. The helper will take care of generating all HTML and JavaScript required to use this widget.</p><p>The output function requires two parameters: the name of the input and the initial value (an integer that is either 20, 40, 60, 80, or 100).</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec318"/>There's more...</h2></div></div></div><p>If you'd like to just simply provide a read-only way to display a rating, the Rating helper can do that:</p><div class="informalexample"><pre class="programlisting">$rating = Loader::helper('rating');
$rating-&gt;outputDisplay(84);</pre></div><p>Simply call the <code class="literal">outputDisplay</code> method and provide a value between 0 and 100.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec319"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Using the banned words list"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec93"/>Using the banned words list</h1></div></div></div><p>concrete5 comes bundled with a <a id="id345" class="indexterm"/>list of profane and inappropriate English words that <a id="id346" class="indexterm"/>site owners can use to remove inappropriate content from their website. In this example, we will check a word to see if it is in the banned words list.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec320"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the banned words helper:<div class="informalexample"><pre class="programlisting">$bannedWords = Loader::helper('validation/banned_words');</pre></div></li><li class="listitem">Check a word to see if it is in the banned words list:<div class="informalexample"><pre class="programlisting">$isBanned = $bannedWords-&gt;isBannedWord('friendly');</pre></div></li><li class="listitem">If the word is in the banned words list, then <code class="literal">$isBanned</code> will be equal to <code class="literal">true</code>:<div class="informalexample"><pre class="programlisting">var_dump($isBanned);
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec321"/>How it works...</h2></div></div></div><p>concrete5 checks the list of banned words (stored at <code class="literal">/concrete/config/banned_words.txt</code>) to see if it contains the word provided in the parameter.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec322"/>There's more...</h2></div></div></div><p>Site owners can customize and <a id="id347" class="indexterm"/>edit the <a id="id348" class="indexterm"/>banned words list by copying it to <code class="literal">/config/banned_words.txt</code> and adding or removing entries there.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec323"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Reading and writing to the system cache"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec94"/>Reading and writing to the system cache</h1></div></div></div><p>Responsible developers will <a id="id349" class="indexterm"/>take extra steps to make sure their application is optimized for <a id="id350" class="indexterm"/>maximum performance. concrete5 has a built-in cache API that developers can hook into to cache their own custom data and improve performance, especially on large database lookups.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec324"/>Getting ready</h2></div></div></div><p>We will load a large amount of rows from the database (something that can impact performance in a negative way), and then store the resulting array in the cache to prevent future, resource-heavy data calls. This recipe will load from a hypothetical table called <code class="literal">Customers</code> that contains thousands of rows.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec325"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load a large set of records from the database that will tax the server's resources. We will use a hypothetical table called <code class="literal">Customers</code>:<div class="informalexample"><pre class="programlisting">$db = Loader::db();
$customers = $db-&gt;getAll('SELECT * FROM Customers');</pre></div></li><li class="listitem">Store the results in the system cache:<div class="informalexample"><pre class="programlisting">Cache::set('customerList', false, $customers);</pre></div></li><li class="listitem">Read the results from the cache, preventing another intense database query:<div class="informalexample"><pre class="programlisting">$cachedCustomers = Cache::get('customerList', false);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec326"/>How it works...</h2></div></div></div><p>concrete5's cache library is a <a id="id351" class="indexterm"/>custom <a id="id352" class="indexterm"/>implementation of the <code class="literal">Zend_Cache</code> library, which comes with the Zend framework, upon which concrete5 is built. Calling the <code class="literal">set</code> function, you will specify the type of item that you are saving (in this case, we call it <code class="literal">customerList</code>), and an ID of the item we are saving (this is useful if you are saving several different objects of the same type—in this case we are not, so we just set this variable to <code class="literal">false</code>).</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec327"/>There's more...</h2></div></div></div><p>You can delete an item that you have saved in the cache by sending in the type and the ID of the item that was stored. To delete our preceding customer list, you would write the following:</p><div class="informalexample"><pre class="programlisting">Cache::delete('customerList', false);</pre></div><p>You can also flush the entire cache, removing all of the items that are stored inside:</p><div class="informalexample"><pre class="programlisting">Cache::flush();</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec328"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a helper class</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading the database object</em></span> recipe in <a class="link" href="ch05.html" title="Chapter 5. Working with Databases and Models">Chapter 5</a>, <span class="emphasis"><em>Working with Databases and Models</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Retrieving data from the database</em></span> recipe in <a class="link" href="ch05.html" title="Chapter 5. Working with Databases and Models">Chapter 5</a>, <span class="emphasis"><em>Working with Databases and Models</em></span></li></ul></div></div></div>
<div class="section" title="Writing to the debug log"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec95"/>Writing to the debug log</h1></div></div></div><p>Logging is a common practice in <a id="id353" class="indexterm"/>application development, but sometimes you might want to separate errors in your concrete5 app from errors that are specific to PHP or Apache. For this, you can write to concrete5's internal log that can be viewed from the dashboard by site administrators. In this recipe, we will simply write a couple of basic strings to the site's internal log.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec329"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Come up with the message string that you would like to write to the log:<div class="informalexample"><pre class="programlisting">$message = 'Hello, log!';</pre></div></li><li class="listitem">Write the message to the log:<div class="informalexample"><pre class="programlisting">Log::addEntry($message);</pre></div></li></ol></div></div></div>
<div class="section" title="Reading and writing to the configuration registry"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec96"/>Reading and writing to the configuration registry</h1></div></div></div><p>Storing key and value pairs in <a id="id354" class="indexterm"/>data dictionaries is a common task in any modern programming language. concrete5 allows you to store configuration settings using the <code class="literal">Config</code> class, rather than storing key/value settings in the database or elsewhere. In this recipe, <a id="id355" class="indexterm"/>we will write a configuration preference that signifies if the site administrator wants to allow comments on the site or not.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec330"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Write the preference to the system configuration dictionary:<div class="informalexample"><pre class="programlisting">Config::save('allow_comments', true);</pre></div></li><li class="listitem">Read the value of the preference item:<div class="informalexample"><pre class="programlisting">$allowComments = Config::get('allow_comments');</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec331"/>How it works...</h2></div></div></div><p>concrete5 stores the key and value pairs in the <code class="literal">Config</code> table of the database. The <code class="literal">Config</code> class presents a clean and simple API to make writing and reading configuration values as easy as possible. These configuration <a id="id356" class="indexterm"/>keys persist throughout concrete5, so developers <a id="id357" class="indexterm"/>should take extra caution to prevent clashes with other configuration values of the same name. It's a good idea to prefix configuration keys with something unique to your own code, such as <code class="literal">cookbook_allow_comments</code>, in this case.</p></div></div></body></html>