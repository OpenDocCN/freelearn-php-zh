<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Creating a To-do List"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Creating a To-do List</h1></div></div></div><p>This is a good little project; it's something nearly everyone might need in their day-to-day work: a to-do list. This project will give you a small application to create tasks and set them as complete. There's also a good level of scope for you to expand on the project and really make it your own.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Design and wireframes</li><li class="listitem" style="list-style-type: disc">Creating the database</li><li class="listitem" style="list-style-type: disc">Creating the model</li><li class="listitem" style="list-style-type: disc">Creating views</li><li class="listitem" style="list-style-type: disc">Creating the controller</li><li class="listitem" style="list-style-type: disc">Putting it all together</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec82"/>Introduction</h1></div></div></div><p>Right; in this project, we will create an application that allows users to create tasks and view these tasks as a list. Tasks can also have a due date; late tasks will appear in red so that you know it's important to execute that task as soon as possible.</p><p>To create this app, we will create <a id="id684" class="indexterm"/>one controller; this will handle the displaying of tasks, creating these tasks, setting these tasks as done or still to do, and handling the deletion of these tasks.</p><p>We'll create a language file to store the text, allowing you to have multiple language support should that be required.</p><p>We'll create all the necessary view files and a model to interface with the database.</p><p>However, this app along with all the others in this book, relies on the basic setup we did in <a class="link" href="ch01.html" title="Chapter 1. Introduction and Shared Project Resources">Chapter 1</a>, <span class="emphasis"><em>Introduction and Shared Project Resources</em></span>; although you can take large sections of the code and drop it into pretty much any app you might already have, please keep in mind that the setup done in the first chapter acts as a foundation for this chapter.</p><p>So without further ado, let's get on with it.</p></div></div>
<div class="section" title="Design and wireframes"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec83"/>Design and wireframes</h1></div></div></div><p>As always, before we<a id="id685" class="indexterm"/> start building, we should take a look at what we plan to build.</p><p>Firstly, a brief<a id="id686" class="indexterm"/> description of our intent: we plan to build an app that will allow people to add tasks that they need to do. It will also allow users to view these tasks as a list and set them as done. They can also delete old or unneeded tasks should they wish.</p><p>Anyway, to get a better idea of what's happening, let's take a look at the following site map:</p><div class="mediaobject"><img src="graphics/7093OS_08_01.jpg" alt="Design and wireframes"/></div><p>So that's the site map; the <a id="id687" class="indexterm"/>first thing to notice is how simple the site is. There are only four main areas to this project. Let's go over each item and get a brief idea of what it does:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View All</strong></span>: This displays a form<a id="id688" class="indexterm"/> to create a task and also displays all tasks in a list</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Create</strong></span>: This processes the<a id="id689" class="indexterm"/> creation of tasks <a id="id690" class="indexterm"/>saved to the database</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Done/Not Done</strong></span>: This sets <a id="id691" class="indexterm"/>a task to either done or to-do</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Delete</strong></span>: This removes<a id="id692" class="indexterm"/> the task from the database</li></ul></div><p>Now that we have a fairly good idea of the structure and form of the site, let's take a look at some wireframes of each page.</p><div class="section" title="View All/Create"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec71"/>View All/Create</h2></div></div></div><p>The following screenshot<a id="id693" class="indexterm"/> shows you a wireframe from point <span class="strong"><strong>1</strong></span> (the View All item) and point <span class="strong"><strong>2</strong></span> (the Create item) of the preceding site map. Initially, the user is shown a list of<a id="id694" class="indexterm"/> tasks. They<a id="id695" class="indexterm"/> are able to click on the <span class="strong"><strong>It's Done</strong></span> or <span class="strong"><strong>Still Todo</strong></span> button to go to point <span class="strong"><strong>3</strong></span> (the Done/Not Done item) shown in the site map.</p><div class="mediaobject"><img src="graphics/7093OS_08_02.jpg" alt="View All/Create"/></div></div><div class="section" title="Delete"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec72"/>Delete</h2></div></div></div><p>The following screenshot<a id="id696" class="indexterm"/> shows you a wireframe from point <span class="strong"><strong>4</strong></span> (the Delete item) in the site map. The user views the task description (<code class="literal">tasks.task_desc</code>) and is given the<a id="id697" class="indexterm"/> option to delete (to process the deletion of the task from the database) or cancel to return to point <span class="strong"><strong>1</strong></span> (the View All item) of the site map.</p><div class="mediaobject"><img src="graphics/7093OS_08_03.jpg" alt="Delete"/></div></div><div class="section" title="File overview"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec73"/>File overview</h2></div></div></div><p>This is a relatively <a id="id698" class="indexterm"/>small project, and all in all, we're only going to create six files; these are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/models/tasks_model.php</code>: This provides read/write access<a id="id699" class="indexterm"/> to the <code class="literal">tasks</code> database table.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/tasks/delete.php</code>: This displays a form to the user, asking<a id="id700" class="indexterm"/> them to confirm the deletion of a task.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/tasks/view.php</code>: This is the view for<a id="id701" class="indexterm"/> the <code class="literal">tasks</code> controller's <code class="literal">index()</code> function. It displays a list of tasks to the user.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/nav/top_nav.php</code>: This provides a navigation bar at the top<a id="id702" class="indexterm"/> of the page.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/controllers/tasks.php</code>: This contains three <a id="id703" class="indexterm"/>main functions: <code class="literal">index()</code>, <code class="literal">apply()</code> and <code class="literal">create()</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/language/english/en_admin_lang.php</code>: This provides<a id="id704" class="indexterm"/> language support for the application.</li></ul></div><p>The file structure of the preceding six files is as follows:</p><div class="informalexample"><pre class="programlisting">application/
├── controllers/
│   ├── tasks.php
├── models/
│   ├── tasks_model.php
├── views/tasks/
│   ├── view.php
│   ├── delete.php
├── views/nav/
│   ├── top_nav.php
├── language/english/
│   ├── en_admin_lang.php</pre></div></div></div>
<div class="section" title="Creating the database"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec84"/>Creating the database</h1></div></div></div><p>Okay, you should have<a id="id705" class="indexterm"/> already setup CodeIgniter and Bootstrap, as described in <a class="link" href="ch01.html" title="Chapter 1. Introduction and Shared Project Resources">Chapter 1</a>, <span class="emphasis"><em>Introduction and Shared Project Resources</em></span>. If not, then you should know<a id="id706" class="indexterm"/> that the code in this chapter is specifically built with the setup from <a class="link" href="ch01.html" title="Chapter 1. Introduction and Shared Project Resources">Chapter 1</a>, <span class="emphasis"><em>Introduction and Shared Project Resources</em></span>, in mind. However, it's not the end of the world if you haven't—the code can easily be applied to other situations.</p><p>Firstly, we'll build the database. Copy the<a id="id707" class="indexterm"/> following MySQL code to your database:</p><div class="informalexample"><pre class="programlisting">CREATE DATABASE `tasksdb`;
USE DATABASE `tasksdb`;

CREATE TABLE `ci_sessions` (
  `session_id` varchar(40) COLLATE utf8_bin NOT NULL DEFAULT '0',
  `ip_address` varchar(16) COLLATE utf8_bin NOT NULL DEFAULT '0',
  `user_agent` varchar(120) COLLATE utf8_bin DEFAULT NULL,
  `last_activity` int(10) unsigned NOT NULL DEFAULT '0',
  `user_data` text COLLATE utf8_bin NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

CREATE TABLE `tasks` (
  `task_id` int(11) NOT NULL AUTO_INCREMENT,
  `task_desc` varchar(255) NOT NULL,
  `task_due_date` datetime DEFAULT NULL,
  `task_created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `task_status` enum('done','todo') NOT NULL,
  PRIMARY KEY (`task_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>Now, take a look at that last bit of SQL code, it's quite big and fiddly. Don't panic; all SQL code is available online from this book's support page on the Packt website.</p></div></div><p>You'll see that the<a id="id708" class="indexterm"/> first table we create is <code class="literal">ci_sessions</code>, which we need to allow CodeIgniter to manage sessions, specifically logged-in users. However, this is just the standard session table available from the <span class="emphasis"><em>CodeIgniter User Guide</em></span>, so I'll not include a description of that table as it's not technically specific to this application. However, if you're interested, there's a description at <a class="ulink" href="http://ellislab.com/codeigniter/user-guide/libraries/sessions.html">http://ellislab.com/codeigniter/user-guide/libraries/sessions.html</a>.</p><p>Right, let's take a look at each item in each table, and see what it means:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th colspan="2" style="text-align: center" valign="bottom">
<p>Table: tasks</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Element</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Description</strong></span>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">task_id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id709" class="indexterm"/>primary key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">task_desc</code>
</p>
</td><td style="text-align: left" valign="top">
<p>There is no title field<a id="id710" class="indexterm"/> or body to our tasks as such—only a brief description of what needs to be done; this is that description.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">task_due_date</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the date<a id="id711" class="indexterm"/> by which the task needs to be done. If a task is late, we will color the background of the table row red to indicate that a particular task remains to be done and is late.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">task_created_at</code>
</p>
</td><td style="text-align: left" valign="top">
<p>as such MySQL<a id="id712" class="indexterm"/> timestamp of the date on which the row was created in the database.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">task_status</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This indicates whether the task still remains to be done or not. This is an <code class="literal">enum</code> field with the<a id="id713" class="indexterm"/> two values: <code class="literal">done</code> and <code class="literal">todo</code>. If a task is set to <code class="literal">done</code>, then we will use the <code class="literal">&lt;strike&gt;</code> HTML markup to strike through the text; if, however, is it set to <code class="literal">todo</code> (as it is by default), then the task isn't struck through and remains to be done.</p>
</td></tr></tbody></table></div><p>We'll also need to make amends to the <code class="literal">config/database.php</code> file, namely setting the database access details, username password, and so on.</p><p>Open the <code class="literal">config/database.php</code> file and find the following lines:</p><div class="informalexample"><pre class="programlisting">$db['default']['hostname'] = 'localhost';
$db['default']['username'] = 'your username';
$db['default']['password'] = 'your password';
$db['default']['database'] = 'tasksdb';</pre></div><p>Edit the values in<a id="id714" class="indexterm"/> the preceding lines, ensuring you substitute these values with ones more specific to your setup and situation; so, enter your username, password, and so on.</p></div>
<div class="section" title="Adjusting the config.php file"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec85"/>Adjusting the config.php file</h1></div></div></div><p>There are a few things in this <a id="id715" class="indexterm"/>file that we'll need to configure to<a id="id716" class="indexterm"/> support sessions and encryption. So, open the <code class="literal">config/config.php</code> file and make the following changes:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will need to set an encryption key—both sessions and CodeIgniter's encryption functionality require an encryption key to be set in the <code class="literal">$config</code> array, so find the following line:<div class="informalexample"><pre class="programlisting">$config['encryption_key'] = '';</pre></div><p>Replace the preceding line with the following:</p><div class="informalexample"><pre class="programlisting">$config['encryption_key'] = 'a-random-string-of-alphanum-characters';</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>Now obviously, don't actually change the preceding value to literally a-random-string-of-alphanum-characters but change it to, er, a random string of alphanum characters instead—if that makes<a id="id717" class="indexterm"/> sense? Yeah, you know what I mean.</p></div></div></li><li class="listitem">Find the following lines:<div class="informalexample"><pre class="programlisting">$config['sess_cookie_name'] = 'ci_session';
$config['sess_expiration'] = 7200;
$config['sess_expire_on_close'] = FALSE;
$config['sess_encrypt_cookie'] = FALSE;
$config['sess_use_database'] = FALSE;
$config['sess_table_name'] = 'ci_sessions';
$config['sess_match_ip'] = FALSE;
$config['sess_match_useragent'] = TRUE;
$config['sess_time_to_update'] = 300;</pre></div><p>Replace the preceding line with the following:</p><div class="informalexample"><pre class="programlisting">$config['sess_cookie_name'] = 'ci_session';
$config['sess_expiration'] = 7200;
$config['sess_expire_on_close'] = TRUE;
$config['sess_encrypt_cookie'] = TRUE;
$config['sess_use_database'] = TRUE;
$config['sess_table_name'] = 'ci_sessions';
$config['sess_match_ip'] = TRUE;
$config['sess_match_useragent'] = TRUE;
$config['sess_time_to_update'] = 300;</pre></div></li></ol></div></div>
<div class="section" title="Adjusting the routes.php file"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec86"/>Adjusting the routes.php file</h1></div></div></div><p>We want to redirect the user to the <code class="literal">tasks</code> controller rather than the default CodeIgniter <code class="literal">welcome</code> controller. To do<a id="id718" class="indexterm"/> this, we will need to amend the default<a id="id719" class="indexterm"/> controller settings in the <code class="literal">routes.php</code> file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">config/routes.php</code> file for editing and find the following lines (near the bottom of the file):<div class="informalexample"><pre class="programlisting">$route['default_controller'] = "welcome";
$route['404_override'] = '';</pre></div></li><li class="listitem">First, we need to change the default controller. Initially in a CodeIgniter application, the default controller is set to <code class="literal">welcome</code>; however, we don't need this—instead, we want the default controller to be <code class="literal">tasks</code>. So find the following line:<div class="informalexample"><pre class="programlisting">$route['default_controller'] = "welcome";</pre></div><p>Change it to the following:</p><div class="informalexample"><pre class="programlisting">$route['default_controller'] = "tasks";
$route['404_override'] = '';</pre></div></li></ol></div></div>
<div class="section" title="Creating the model"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec87"/>Creating the model</h1></div></div></div><p>There is only one <a id="id720" class="indexterm"/>model in this project, <code class="literal">tasks_model.php</code>, that contains<a id="id721" class="indexterm"/> functions that are specific to searching and writing tasks to the database.</p><p>This is our one and only model for this project. Let's briefly go over each function in it to give us a general idea of what it does, and then we will go into more detail in the code.</p><p>There are five main functions in this model, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">get_tasks()</code>: This serves<a id="id722" class="indexterm"/> two functions: firstly, to display all tasks—for example, when a user first visits the site and when a<a id="id723" class="indexterm"/> user enters a new task in the form.</li><li class="listitem" style="list-style-type: disc"><code class="literal">change_task_status()</code>: This changes the <code class="literal">tasks.task_status</code> value in the database from either <code class="literal">todo</code> or <code class="literal">done</code>. A task that is set to <code class="literal">done</code> appears struck through in the list, whereas tasks<a id="id724" class="indexterm"/> that are <a id="id725" class="indexterm"/>set to <code class="literal">todo</code> are not struck through and are displayed normally; this way, a user can easily work out what is done and not done.</li><li class="listitem" style="list-style-type: disc"><code class="literal">save_task()</code>: This saves a<a id="id726" class="indexterm"/> task to the database <a id="id727" class="indexterm"/>when a user submits the form from point <span class="strong"><strong>3</strong></span> (the Create item) of the site map.</li><li class="listitem" style="list-style-type: disc"><code class="literal">get_task()</code>: This fetches<a id="id728" class="indexterm"/> an individual task from<a id="id729" class="indexterm"/> the <code class="literal">tasks</code> table.</li><li class="listitem" style="list-style-type: disc"><code class="literal">delete()</code>: This deletes a<a id="id730" class="indexterm"/> task from the <code class="literal">tasks</code><a id="id731" class="indexterm"/> table.</li></ul></div><p>That was a quick overview, so let's create the model and discuss how it functions.</p><p>Create the <code class="literal">/path/to/codeigniter/application/models/tasks_model.php</code> file and add the<a id="id732" class="indexterm"/> following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Tasks_model extends CI_Model {
  function __construct() {
    parent::__construct();
  }</pre></div><p>The <code class="literal">get_tasks()</code> function takes <a id="id733" class="indexterm"/>no argument. It returns all tasks from the<a id="id734" class="indexterm"/> database and returns it to the <code class="literal">tasks</code> controller's <code class="literal">index()</code> function. The <code class="literal">tasks/view.php</code> view file will loop over the database result object and display tasks in an HTML table:</p><div class="informalexample"><pre class="programlisting">function get_tasks() {
  $query = "SELECT * FROM `tasks` ";

  $result = $this-&gt;db-&gt;query($query);
  if ($result) {
    return $result;
  } else {
    return false;
  }
}</pre></div><p>The <code class="literal">change_task_status()</code> function <a id="id735" class="indexterm"/>changes the status of a task from either <code class="literal">todo</code> or <code class="literal">done</code>.</p><p>It takes two arguments: <code class="literal">$task_id</code> and <code class="literal">$save_data</code>. The <code class="literal">$task_id</code> and <code class="literal">$save_data</code> values are passed from the <code class="literal">tasks</code> controller's <code class="literal">status()</code> function.</p><p>The value of <code class="literal">$task_id</code> is set when the user<a id="id736" class="indexterm"/> clicks on either <span class="strong"><strong>It's Done</strong></span> or <span class="strong"><strong>Still Todo</strong></span> in the <code class="literal">views/tasks/view.php</code> view file; the fourth parameter of the <code class="literal">uri</code> segment of either option is the primary key (<code class="literal">tasks.task_id</code>) of the task in the <code class="literal">tasks</code> table and by using the CodeIgniter function <code class="literal">$this-&gt;uri-&gt;segment(4)</code>, we grab<a id="id737" class="indexterm"/> the value and store in a <code class="literal">$task_id</code> local variable.</p><p>The <code class="literal">$save_data</code> value is populated in the <code class="literal">tasks</code> controller. It contains only one item, <code class="literal">task_status</code>, that is populated in the <code class="literal">status()</code> function with the third parameter of the <code class="literal">uri</code> segment:</p><div class="informalexample"><pre class="programlisting">function change_task_status($task_id, $save_data) {
  $this-&gt;db-&gt;where('task_id', $task_id);
  if ($this-&gt;db-&gt;update('tasks', $save_data)) {
    return true;
  } else {
    return false;
  }
}</pre></div><p>The <code class="literal">save_task()</code> function <a id="id738" class="indexterm"/>accepts one argument—an array of data. This data is supplied by the <code class="literal">tasks</code> controller's <code class="literal">index()</code> function. The function will save a task to the <code class="literal">tasks</code> table, returning <code class="literal">true</code> if successful and <code class="literal">false</code> if an error occurs:</p><div class="informalexample"><pre class="programlisting">function save_task($save_data) {
  if ($this-&gt;db-&gt;insert('tasks', $save_data)) {
    return true;
  } else {
    return false;
  }
}</pre></div><p>The <code class="literal">get_task()</code> function takes one argument—<code class="literal">$task_id</code> (that is, the primary key of the task in the database). It is<a id="id739" class="indexterm"/> supplied by the <code class="literal">tasks</code> controller's <code class="literal">delete()</code> function, which uses it to supply information about the task in the delete confirmation form.</p><p>The user clicks on <span class="strong"><strong>Delete</strong></span> in the <code class="literal">views/tasks/view.php</code> file, the third parameter of which is the task's primary key. The <code class="literal">tasks</code> controller's <code class="literal">delete()</code> function will then grab that ID from the URI with the <code class="literal">$this-&gt;uri-&gt;segment(3)</code> CodeIgniter function. This ID is passed to the <code class="literal">get_task()</code>model function, which will return the details of the task in the database or <code class="literal">false</code> if no ID was found:</p><div class="informalexample"><pre class="programlisting">function get_task($id) {
  $this-&gt;db-&gt;where('task_id', $id);
  $result = $this-&gt;db-&gt;get('tasks');
  if ($result) {
    return $result;
  } else {
    return false;
  }
}</pre></div><p>The <code class="literal">delete()</code> function <a id="id740" class="indexterm"/>performs an operation on the database to remove a task. It accepts one argument—the ID <a id="id741" class="indexterm"/>of the task, which is the primary key of that task:</p><div class="informalexample"><pre class="programlisting">  function delete($id) {
    $this-&gt;db-&gt;where('task_id', $id);
    $result = $this-&gt;db-&gt;delete('tasks');
    if ($result) {
      return true;
    } else {
      return false;
    }
  }
}</pre></div></div>
<div class="section" title="Creating views"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec88"/>Creating views</h1></div></div></div><p>There are three views<a id="id742" class="indexterm"/> in this project, which <a id="id743" class="indexterm"/>are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/tasks/view.php</code>: This displays a list of current tasks<a id="id744" class="indexterm"/> to the user as well as a form that allows the user to create new tasks.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/tasks/delete.php</code>: This displays a confirmation <a id="id745" class="indexterm"/>message to the users, asking them to confirm whether they really want to delete the task.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/nav/top_nav.php</code>: This displays<a id="id746" class="indexterm"/> the top-level menu. In this project, this is very simple; it contains a project name and link to go to the <code class="literal">tasks</code> controller.</li></ul></div><p>These are our three view files. Now<a id="id747" class="indexterm"/> let's go over each one, build the code, and discuss how they function.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/tasks/view.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;div class="page-header"&gt;
    &lt;?php echo form_open('tasks/index') ; ?&gt;
      &lt;div class="row"&gt;
        &lt;div class="col-lg-12"&gt;
          &lt;?php echo validation_errors() ; ?&gt;
          &lt;div class="input-group"&gt;
            &lt;input type="text" class="form-control" name="task_desc" placeholder="&lt;?php echo $this-&gt;lang-&gt;line('tasks_add_task_desc'); ?&gt;"&gt;
            &lt;span class="input-group-btn"&gt;
              &lt;button class="btn btn-default" type="submit"&gt;&lt;?php echo $this-&gt;lang-&gt;line('tasks_add_task'); ?&gt;&lt;/button&gt;
            &lt;/span&gt;
          &lt;/div&gt;&lt;!-- /input-group --&gt;
        &lt;/div&gt;&lt;!-- /.col-lg-6 --&gt;
      &lt;/div&gt;&lt;!-- /.row --&gt;

      &lt;div class="row"&gt;
        &lt;div class="form-group"&gt;
          &lt;div class="col-md-2"&gt;
            &lt;?php echo form_error('task_due_d'); ?&gt;
            &lt;select name="task_due_d" class="form-control"&gt;
              &lt;option&gt;&lt;/option&gt;
              &lt;?php for ( $i = 1; $i &lt;= 30; $i++) : ?&gt;
                  &lt;option value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('jS', mktime($i,0,0,0, $i, date('Y'))) ; ?&gt;&lt;/option&gt;
              &lt;?php endfor ; ?&gt;
            &lt;/select&gt;
          &lt;/div&gt;

          &lt;div class="col-md-2"&gt;
            &lt;?php echo form_error('task_due_m'); ?&gt;
            &lt;select name="task_due_m" class="form-control"&gt;
              &lt;option&gt;&lt;/option&gt;
              &lt;?php for ( $i = 1; $i &lt;= 12; $i++) : ?&gt;
                  &lt;option value="&lt;?php echo $i ; ?&gt;"&gt;&lt;?php echo date('F', mktime(0,0,0,$i, 1, date('Y'))) ; ?&gt;&lt;/option&gt;
              &lt;?php endfor ; ?&gt;
            &lt;/select&gt;
          &lt;/div&gt;

          &lt;div class="col-md-2"&gt;
            &lt;?php echo form_error('task_due_y'); ?&gt;
            &lt;select name="task_due_y" class="form-control"&gt;
              &lt;option&gt;&lt;/option&gt;
              &lt;?php for ($i = date("Y",strtotime(date("Y"))); $i &lt;= date("Y",strtotime(date("Y").' +5 year')); $i++) : ?&gt;
                &lt;option value="&lt;?php echo $i;?&gt;"&gt;&lt;?php echo $i;?&gt;&lt;/option&gt;
              &lt;?php endfor ; ?&gt;
            &lt;/select&gt;
          &lt;/div&gt; 
        &lt;/div&gt;
      &lt;/div&gt; 
    &lt;?php echo form_close() ; ?&gt;
&lt;/div&gt;</pre></div><p>The preceding<a id="id748" class="indexterm"/> block of code is the form that the user can use to create a new task. Also in this block is the validation error code (<code class="literal">validation_errors()</code>) where we will display any errors with the data submitted form the form:</p><div class="informalexample"><pre class="programlisting">&lt;table class="table table-hover"&gt;
  &lt;?php foreach ($query-&gt;result() as $row) : ?&gt; 
  &lt;?php if (date("Y-m-d",mktime(0, 0, 0, date('m'), date('d'), date('y'))) &gt; $row-&gt;task_due_date) {echo ' &lt;tr class="list-group-item-danger"&gt;';} ?&gt;
  &lt;?php if ($row-&gt;task_due_date == null) {echo ' &lt;tr&gt;';} ?&gt;
    &lt;td width="80%"&gt;&lt;?php if ($row-&gt;task_status == 'done') {echo '&lt;strike&gt;'.$row-&gt;task_desc.'&lt;/strike&gt;' ;} else {echo $row-&gt;task_desc;} ?&gt;

    &lt;/td&gt;
    &lt;td width="10%"&gt;
      &lt;?php if ($row-&gt;task_status == 'todo') {echo anchor ('tasks/status/done/'.$row-&gt;task_id, 'It\'s Done');} ?&gt;
      &lt;?php if ($row-&gt;task_status == 'done') {echo anchor ('tasks/status/todo/'.$row-&gt;task_id, 'Still Todo');} ?&gt;
    &lt;/td&gt;
    &lt;td width="10%"&gt;&lt;?php echo anchor ('tasks/delete/'.$row-&gt;task_id, $this-&gt;lang-&gt;line('common_form_elements_action_delete')) ; ?&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;?php endforeach ; ?&gt;
&lt;/table&gt;</pre></div><p>The preceding table echoes<a id="id749" class="indexterm"/> out any tasks in the database. The actions are also in this block, that is, the PHP ternary operator that switches the status from <span class="strong"><strong>It's Done</strong></span> to <span class="strong"><strong>Still Todo</strong></span> and the <span class="strong"><strong>Delete</strong></span> link.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/tasks/delete.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;h2&gt;&lt;?php echo $page_heading ; ?&gt;&lt;/h2&gt;
&lt;p class="lead"&gt;&lt;?php echo $this-&gt;lang-&gt;line('delete_confirm_message');?&gt;&lt;/p&gt;
&lt;?php echo form_open('tasks/delete'); ?&gt;
    &lt;?php if (validation_errors()) : ?&gt;
        &lt;h3&gt;Whoops! There was an error:&lt;/h3&gt;
        &lt;p&gt;&lt;?php echo validation_errors(); ?&gt;&lt;/p&gt;
    &lt;?php endif; ?&gt;
    &lt;?php foreach ($query-&gt;result() as $row) : ?&gt;
        &lt;?php echo $row-&gt;task_desc; ?&gt;
        &lt;br /&gt;&lt;br /&gt;
        &lt;?php echo form_submit('submit', $this-&gt;lang-&gt;line('common_form_elements_action_delete'), 'class="btn btn-success"'); ?&gt;
        or &lt;?php echo anchor('tasks',$this-&gt;lang-&gt;line('common_form_elements_cancel'));?&gt;
        &lt;?php echo form_hidden('id', $row-&gt;task_id); ?&gt;
    &lt;?php endforeach; ?&gt;
&lt;?php echo form_close() ; ?&gt;</pre></div><p>The preceding block of code contains the form that asks the user to confirm whether they really wish to delete the task.</p><p>Create the <code class="literal">/path/to/codeigniter/application/views/nav/top_nav.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;!-- Fixed navbar --&gt;
&lt;div class="navbar navbar-inverse navbar-fixed-top" role="navigation"&gt;
  &lt;div class="container"&gt;
    &lt;div class="navbar-header"&gt;
      &lt;button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"&gt;
        &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
      &lt;/button&gt;
      &lt;?php echo anchor('tasks', $this-&gt;lang-&gt;line('system_system_name'),'class="navbar-brand"') ; ?&gt;
    &lt;/div&gt;
    &lt;div class="navbar-collapse collapse"&gt;
      &lt;ul class="nav navbar-nav navbar-right"&gt;
      &lt;/ul&gt;
    &lt;/div&gt;&lt;!--/.nav-collapse --&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class="container theme-showcase" role="main"&gt;</pre></div><p>This view is quite<a id="id750" class="indexterm"/> basic but still serves an important role. It displays an option to return to the <code class="literal">tasks</code> controller's <code class="literal">index()</code> function.</p></div>
<div class="section" title="Creating the controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec89"/>Creating the controller</h1></div></div></div><p>We're going to create only<a id="id751" class="indexterm"/> one controller in this project, which is <code class="literal">/path/to/codeigniter/application/controllers/tasks.php</code>.</p><p>Let's go over that <a id="id752" class="indexterm"/>controller now, look at the code, and discuss how it functions.</p><p>Create the <code class="literal">/path/to/codeigniter/application/controllers/tasks.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Tasks extends MY_Controller {
  function __construct() {
  parent::__construct();
    $this-&gt;load-&gt;helper('string');
    $this-&gt;load-&gt;helper('text');
    $this-&gt;load-&gt;model('Tasks_model');
    $this-&gt;load-&gt;library('form_validation');
    $this-&gt;form_validation-&gt;set_error_delimiters('&lt;div class="alert alert-danger"&gt;', '&lt;/div&gt;');
  }</pre></div><p>The <code class="literal">index()</code> function performs a couple of tasks: displaying a list of tasks and handling the form submission (validation, error checking, and so on).</p><p>Initially, we set the validation rules for the form, as follows:</p><div class="informalexample"><pre class="programlisting">public function index() {
  $this-&gt;form_validation-&gt;set_rules('task_desc', $this-&gt;lang-&gt;line('tasks_task_desc'), 'required|min_length[1]|max_length[255]');
  $this-&gt;form_validation-&gt;set_rules('task_due_d', $this-&gt;lang-&gt;line('task_due_d'), 'min_length[1]|max_length[2]');
  $this-&gt;form_validation-&gt;set_rules('task_due_m', $this-&gt;lang-&gt;line('task_due_m'), 'min_length[1]|max_length[2]');
  $this-&gt;form_validation-&gt;set_rules('task_due_y', $this-&gt;lang-&gt;line('task_due_y'), 'min_length[4]|max_length[4]');</pre></div><p>If there were errors in the form or if it is the first time the page is accessed, then we'll build the form elements, defining their settings and be ready to draw them in the view:</p><div class="informalexample"><pre class="programlisting">if ($this-&gt;form_validation-&gt;run() == FALSE) {
  $page_data['job_title'] = array('name' =&gt; 'job_title', 'class' =&gt; 'form-control', 'id' =&gt; 'job_title', 'value' =&gt; set_value('job_title', ''), 'maxlength' =&gt; '100', 'size' =&gt; '35');
  $page_data['task_desc'] = array('name' =&gt; 'task_desc', 'class' =&gt; 'form-control', 'id' =&gt; 'task_desc', 'value' =&gt; set_value('task_desc', ''), 'maxlength' =&gt; '255', 'size' =&gt; '35');
  $page_data['task_due_d'] = array('name' =&gt; 'task_due_d', 'class' =&gt; 'form-control', 'id' =&gt; 'task_due_d', 'value' =&gt; set_value('task_due_d', ''), 'maxlength' =&gt; '100', 'size' =&gt; '35');
  $page_data['task_due_m'] = array('name' =&gt; 'task_due_m', 'class' =&gt; 'form-control', 'id' =&gt; 'task_due_m', 'value' =&gt; set_value('task_due_m', ''), 'maxlength' =&gt; '100', 'size' =&gt; '35');
  $page_data['task_due_y'] = array('name' =&gt; 'task_due_y', 'class' =&gt; 'form-control', 'id' =&gt; 'task_due_y', 'value' =&gt; set_value('task_due_y', ''), 'maxlength' =&gt; '100', 'size' =&gt; '35');</pre></div><p>Next, we'll fetch<a id="id753" class="indexterm"/> all tasks in the database and store them in the <code class="literal">$page_data['query']</code> array. We will send this array to the <code class="literal">tasks/view.php</code> file where it will be looped over using <code class="literal">foreach($query-&gt;result as $row)</code>—where each task will be written out in a table along with the <span class="strong"><strong>It's Done</strong></span>, <span class="strong"><strong>Still Todo</strong></span>, and <span class="strong"><strong>Delete</strong></span> options:</p><div class="informalexample"><pre class="programlisting">  $page_data['query'] = $this-&gt;Tasks_model-&gt;get_tasks();

  $this-&gt;load-&gt;view('common/header');
  $this-&gt;load-&gt;view('nav/top_nav');
  $this-&gt;load-&gt;view('tasks/view', $page_data);
  $this-&gt;load-&gt;view('common/footer');
} else {</pre></div><p>If there were no errors with the form, then we try to create the task in the database. First, we look to see whether the<a id="id754" class="indexterm"/> user has tried to set a due date for the task. We do this by looking for the date fields in the <code class="literal">post</code> array.</p><p>We require all three (day, month, and year) items to create a due date, so we check to see whether all three have been set. If all three are set, then we build a string that will be the date. This is saved in the <code class="literal">$task_due_date</code> variable. If all three date items haven't been set (perhaps only two were), then we just set the <code class="literal">$task_due_date</code> value to <code class="literal">null</code>:</p><div class="informalexample"><pre class="programlisting">if ($this-&gt;input-&gt;post('task_due_y') &amp;&amp; $this-&gt;input-&gt;post('task_due_m') &amp;&amp; $this-&gt;input-&gt;post('task_due_d')) {
  $task_due_date = $this-&gt;input-&gt;post('task_due_y') .'-'. $this-&gt;input-&gt;post('task_due_m') .'-'. $this-&gt;input-&gt;post('task_due_d');
} else {
  $task_due_date = null;
}</pre></div><p>We then create an array to pass to the <code class="literal">save_task()</code> function of <code class="literal">Tasks_model</code>. The <code class="literal">$save_data</code> array contains the task description, any date that might have been applied (or <code class="literal">null</code> value), and a default value for <code class="literal">task_status</code>; this is initially set to <code class="literal">todo</code>:</p><div class="informalexample"><pre class="programlisting">$save_data = array(
  'task_desc' =&gt; $this-&gt;input-&gt;post('task_desc'),
  'task_due_date' =&gt; $task_due_date,
  'task_status' =&gt; 'todo'
);</pre></div><p>The <code class="literal">$save_data</code> array is then sent to the <code class="literal">save_task()</code> function of <code class="literal">Tasks_model</code>. This function will return <code class="literal">true</code> if the save operation was successful or <code class="literal">false</code> if there was an error. Whatever the outcome, we'll set a message using the <code class="literal">$this-&gt;session-&gt;set_flashdata()</code>CodeIgniter function with a success message or an error message (the content for these messages is in the language file) and redirect to the <code class="literal">tasks</code> controller's <code class="literal">index()</code> function, which will display all tasks (and hopefully, the one just created) to the user:</p><div class="informalexample"><pre class="programlisting">    if ($this-&gt;Tasks_model-&gt;save_task($save_data)) {
      $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('create_success_okay'));
    } else {
      $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('create_success_fail'));
    }
    redirect ('tasks'); 
  }
}</pre></div><p>The <code class="literal">status()</code> function is used to change a task status from <code class="literal">done</code> to <code class="literal">todo</code>. If you hover over either the <span class="strong"><strong>It's Done</strong></span> or <span class="strong"><strong>Still Todo</strong></span> links, you'll see the URI. The format will look something like <code class="literal">http://www.domain.com/tasks/status/todo/1</code> (if the task is set to <code class="literal">done</code> in the database) or <code class="literal">http://www.domain.com/tasks/status/done/1</code> (if the task is set to <code class="literal">todo</code> in the database). The third parameter is always the opposite to whatever is the current status of the task, so if a task is set to <code class="literal">done</code>, the URI will display <code class="literal">todo</code>, and if it is set to <code class="literal">todo</code>, the URI will display <code class="literal">done</code>.</p><p>The fourth parameter is the primary key (in the preceding example, this is <code class="literal">1</code>).</p><p>When the user clicks on <a id="id755" class="indexterm"/>either <span class="strong"><strong>It's Done</strong></span> or <span class="strong"><strong>Still Todo</strong></span>, the <code class="literal">status()</code> function grabs the third and fourth parameters and sends them to the <code class="literal">status()</code> function of <code class="literal">Tasks_model</code>:</p><div class="informalexample"><pre class="programlisting">public function status() {
  $page_data['task_status'] = $this-&gt;uri-&gt;segment(3);
  $task_id = $this-&gt;uri-&gt;segment(4);</pre></div><p>We take the third and fourth parameters and send them to the <code class="literal">change_task_status()</code> function of <code class="literal">Tasks_model</code>. The <code class="literal">change_task_status()</code> function will return <code class="literal">true</code> if the update was successful or <code class="literal">false</code> if there was an error. We set a message to the user using the <code class="literal">$this-&gt;session-&gt;set_flashdata()</code>CodeIgniter function and redirect to the <code class="literal">tasks</code> controller's <code class="literal">index()</code> function:</p><div class="informalexample"><pre class="programlisting">  if ($this-&gt;Tasks_model-&gt;change_task_status($task_id, $page_data)) {
    $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('status_change_success'));
  } else {
    $this-&gt;session-&gt;set_flashdata('flash_message', $this-&gt;lang-&gt;line('status_change_fail'));
  }
  redirect ('tasks');
}</pre></div><p>The <code class="literal">delete()</code> function does two things. It displays information about the task to the user so that they are able to decide whether they really want to delete the task, and it also processes the deletion of that task should it be confirmed by the user. First off, we set the validation rules for the form. This is the form that the user uses to confirm the deletion:</p><div class="informalexample"><pre class="programlisting">public function delete() {
  $this-&gt;form_validation-&gt;set_rules('id', $this-&gt;lang-&gt;line('task_id'), 'required|min_length[1]|max_length[11]|integer|is_natural');</pre></div><p>Because the function can be accessed by the user by clicking on <span class="strong"><strong>Delete</strong></span> or submitting the form, the task ID can be supplied either from the URI (in the case of <span class="strong"><strong>Delete</strong></span>) or in a hidden form element in the form. So, we check whether the form is being posted or accessed for the first time and grab the ID from either <code class="literal">post</code> or <code class="literal">get</code>:</p><div class="informalexample"><pre class="programlisting">if ($this-&gt;input-&gt;post()) {
  $id = $this-&gt;input-&gt;post('id');
} else {
  $id = $this-&gt;uri-&gt;segment(3);
}

$data['page_heading'] = 'Confirm delete?';
if ($this-&gt;form_validation-&gt;run() == FALSE) {</pre></div><p>We then send the ID to the <code class="literal">get_task()</code> function of <code class="literal">Tasks_model</code>, which will return the details of the task as a database object. This is saved in <code class="literal">$data['query']</code> and sent to the <code class="literal">tasks/delete.php</code> view file, where the user is asked to confirm whether they wish to really delete the task:</p><div class="informalexample"><pre class="programlisting">  $data['query'] = $this-&gt;Tasks_model-&gt;get_task($id);
  $this-&gt;load-&gt;view('common/header', $data);
  $this-&gt;load-&gt;view('nav/top_nav', $data);
  $this-&gt;load-&gt;view('tasks/delete', $data);
  $this-&gt;load-&gt;view('common/footer', $data);
} else {</pre></div><p>If there were no errors with<a id="id756" class="indexterm"/> the form submission, then we call the <code class="literal">delete()</code> function of <code class="literal">Tasks_model</code> so that the task is deleted:</p><div class="informalexample"><pre class="programlisting">      if ($this-&gt;Tasks_model-&gt;delete($id)) {
        redirect('tasks');
      }
    }
  }
}</pre></div></div>
<div class="section" title="Creating the language file"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec90"/>Creating the language file</h1></div></div></div><p>As with all the projects<a id="id757" class="indexterm"/> in this book, we're making use of the language file to serve text to users. This way, you can enable multiple region/multiple language<a id="id758" class="indexterm"/> support. Let's create the language file.</p><p>Create the <code class="literal">/path/to/codeigniter/application/language/english/en_admin_lang.php</code> file and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');

// General
$lang['system_system_name'] = "Todo";

// Tasks - view.php
$lang['tasks_add_task'] = "Add";
$lang['tasks_add_task_desc'] = "What have you got to do?";
$lang['tasks_task_desc'] = "Task Description";
$lang['tasks_set_done'] = "Mark as done";
$lang['tasks_set_todo'] = "Mark as todo";
$lang['task_due_d'] = "Due Day";
$lang['task_due_m'] = "Due Month";
$lang['task_due_y'] = "Due Year";
$lang['status_change_success'] = "Task updated";
$lang['status_change_fail'] = "Task not updated";</pre></div></div>
<div class="section" title="Putting it all together"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec91"/>Putting it all together</h1></div></div></div><p>Okay, here are a few examples that will help <a id="id759" class="indexterm"/>put everything together.</p><div class="section" title="User adds a task"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec74"/>User adds a task</h2></div></div></div><p>The sequence of events in<a id="id760" class="indexterm"/> order to add a task is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The user visits the site and CodeIgniter routes them to the <code class="literal">tasks</code> controller.</li><li class="listitem">The <code class="literal">tasks</code> controller loads (by default) the <code class="literal">index()</code> function. The <code class="literal">index()</code> function checks whether the form validation is false:<div class="informalexample"><pre class="programlisting">if ($this-&gt;form_validation-&gt;run() == FALSE) {
...</pre></div></li><li class="listitem">As this is the first load and the form has not been submitted, it will equal <code class="literal">false</code>. The <code class="literal">index()</code> function then defines the settings for the <code class="literal">task_desc</code> text field, calls the <code class="literal">get_tasks()</code> function of <code class="literal">Tasks_model</code> (which returns all tasks from the database), and then loads the view files, passing the database object to the <code class="literal">views/tasks/view.php</code> file.</li><li class="listitem">The user enters the <code class="literal">Chase meeting room booking</code> string, selects a date three days into the future, and clicks on <span class="strong"><strong>Add</strong></span> to submit the form.</li><li class="listitem">The form is submitted and <code class="literal">index()</code> validates the <code class="literal">task_desc</code> form elements and the three date dropdowns' values. The validation is now passed.<p>The three date fields are strung together to form a date string to be entered into the database and saved as <code class="literal">$task_due_date</code>:</p><div class="informalexample"><pre class="programlisting">$task_due_date = $this-&gt;input-&gt;post('task_due_y') .'-'. $this-&gt;input-&gt;post('task_due_m') .'-'. $this-&gt;input-&gt;post('task_due_d');</pre></div></li><li class="listitem">These <code class="literal">$task_due_date</code> and <code class="literal">task_desc</code> values are saved to an array called <code class="literal">$save_data</code>. Also saved is a default value for the <code class="literal">task_status</code> field in the <code class="literal">tasks</code> table. This value is set to <code class="literal">todo</code>.</li><li class="listitem">After a successful save operation to the database. the user is redirected to <code class="literal">index()</code>, where their new task is displayed.</li></ol></div></div><div class="section" title="User changes the task status"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec75"/>User changes the task status</h2></div></div></div><p>The events performed while a <a id="id761" class="indexterm"/>user changes the task status are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The user visits the site and CodeIgniter routes them to the <code class="literal">tasks</code> controller.</li><li class="listitem">The <code class="literal">tasks</code> controller loads (by default) the <code class="literal">index()</code> function. The <code class="literal">index()</code> function checks whether the form validation is false:<div class="informalexample"><pre class="programlisting">if ($this-&gt;form_validation-&gt;run() == FALSE) {
...</pre></div></li><li class="listitem">As this is the first load and the form has not been submitted, it will equal false. The <code class="literal">index()</code> function then defines the settings for the <code class="literal">task_desc</code> text field, calls the <code class="literal">get_tasks()</code> function of <code class="literal">Tasks_model</code> (which returns all tasks from the database), and then loads the view files, passing the database object to the <code class="literal">views/tasks/view.php</code> file.</li><li class="listitem">The user sees the task "Chase meeting room booking" and (knowing that this task is done) clicks on <span class="strong"><strong>It's Done</strong></span>.</li><li class="listitem">CodeIgniter loads the <code class="literal">status()</code> task function.</li><li class="listitem">The <code class="literal">status()</code> function takes the third (<code class="literal">todo</code> or <code class="literal">done</code>) and fourth (the task's primary key) parameters of the URI and sets them to the <code class="literal">$page_data[' task_status']</code> and <code class="literal">$task_id</code> local variables.</li><li class="listitem">These two variables are sent to the <code class="literal">change_task_status()</code> function of <code class="literal">Tasks_model</code>.</li><li class="listitem">The <code class="literal">change_task_status()</code> function takes the <code class="literal">$task_id</code> value and the new status and performs an Active Record update on this task, returning true or false values<a id="id762" class="indexterm"/> if successful or if an error occurred.</li><li class="listitem">The <code class="literal">status()</code> function looks at the return value and sets a session flash message accordingly: a success message if successful and an error if not.</li><li class="listitem">The user is then redirected to <code class="literal">index()</code>, where they can see the updated task status.</li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec92"/>Summary</h1></div></div></div><p>So. this is a fairly small application—perhaps one of the smallest in the book—but it's by no means not useful. You can use this to-do list as a really easy way to manage any tasks you might have on your plate; however, there's always room for improvement. There are a few things that you can do to add greater functionalities to the project, and these might include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Adding a sorting feature</strong></span>: You could add sorting functions to only display late (overdue), done, or still-to-do tasks.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Adding a category</strong></span>: You could add a dropdown to the form that creates the tasks. This dropdown could (for example) have the colors Red, Green, Blue, Yellow, Orange, and so on. A task can be assigned a color and this color could be displayed in the table that displays each task. You could use the Bootstrap label markup; for example, the <code class="literal">span</code> warning label (<code class="literal">&lt;span class="label label-warning"&gt;Warning&lt;/span&gt;</code>) would give you a great block of color—change the word <code class="literal">Warning</code>, though!</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Adding progress and progress bar</strong></span>: You could add an HTML dropdown with set percentage values: 25 percent, 50 percent 75 percent, 100 percent, and so on, which allow you to define how much of the task has been completed.</li></ul></div></div></body></html>