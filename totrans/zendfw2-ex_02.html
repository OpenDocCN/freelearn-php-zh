<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Building Your First Zend Framework Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Building Your First Zend Framework Application</h1></div></div></div><p>
<span class="emphasis"><em>In this chapter, we are going to create our first Zend Framework 2.0 project; we will be reviewing some of the key aspects of building a ZF2 MVC Application by creating modules, controllers, and views. We will be creating our own custom module in Zend Framework which will be enhanced further in subsequent chapters of this book. </em></span>
</p><div class="section" title="Prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Prerequisites</h1></div></div></div><p>Before<a id="id43" class="indexterm"/> you get started with setting up your first ZF2 Project, make sure that you have the following software installed and configured in your development environment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">PHP Command Line Interface</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Git</strong></span>: Git<a id="id44" class="indexterm"/> is needed to <a id="id45" class="indexterm"/>check out source code from various <a class="ulink" href="http://github.com">github.com</a> repositories</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Composer</strong></span>: Composer <a id="id46" class="indexterm"/>is the dependency management tool used for managing PHP dependencies</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>The following commands will be useful for installing the necessary tools to setup a ZF2 Project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To install<a id="id47" class="indexterm"/> PHP Command Line Interface:<p><span class="strong"><strong>$ sudo apt-get install php5-cli</strong></span>
</p></li><li class="listitem" style="list-style-type: disc">To<a id="id48" class="indexterm"/> install Git:<p><span class="strong"><strong>$ sudo apt-get install git</strong></span>
</p></li><li class="listitem" style="list-style-type: disc">To <a id="id49" class="indexterm"/>install Composer:<p><span class="strong"><strong>$ curl -s https://getcomposer.org/installer | php</strong></span>
</p></li></ul></div></div></div></div></div>
<div class="section" title="ZendSkeletonApplication"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>ZendSkeletonApplication</h1></div></div></div><p>
<code class="literal">ZendSkeletonApplication</code><a id="id50" class="indexterm"/> provides a sample skeleton application that can be used by developers as a starting point to get started with Zend Framework 2.0. The skeleton application makes use of ZF2 MVC, including a new module system.</p><p>
<code class="literal">ZendSkeletonApplication</code> can <a id="id51" class="indexterm"/>be downloaded from GitHub (<a class="ulink" href="https://github.com/zendframework/ZendSkeletonApplication">https://github.com/zendframework/ZendSkeletonApplication</a>).</p></div>
<div class="section" title="Time for action &#x2013; creating a Zend Framework project"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Time for action – creating a Zend Framework project</h1></div></div></div><p>To set <a id="id52" class="indexterm"/>up a new Zend Framework project, we will need to download the latest version of <code class="literal">ZendSkeletonApplication</code> and set up a virtual host to point to the newly created Zend Framework project. The steps are given as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to a folder location where you want to set up the new Zend Framework project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd /var/www/</strong></span>
</pre></div></li><li class="listitem">Clone the <code class="literal">ZendSkeletonApplication</code> app from GitHub:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git clone git://github.com/zendframework/ZendSkeletonApplication.git CommunicationApp</strong></span>
</pre></div><div class="mediaobject"><img src="graphics/1929OS_02_08.jpg" alt="Time for action – creating a Zend Framework project"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>In some Linux configurations, necessary permissions may not be available to the current user for writing to <code class="literal">/var/www</code>. In such cases, you can use any folder that is writable and make necessary changes to the virtual host configuration.</p></div></div></li><li class="listitem">Install<a id="id53" class="indexterm"/> dependencies using Composer:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd CommunicationApp/</strong></span>
<span class="strong"><strong>$ php composer.phar self-update</strong></span>
<span class="strong"><strong>$ php composer.phar install</strong></span>
</pre></div><p>The following screenshot shows how Composer downloads and installs the necessary dependencies:</p><div class="mediaobject"><img src="graphics/1929OS_02_01.jpg" alt="Time for action – creating a Zend Framework project"/></div></li><li class="listitem">Before adding a virtual host entry we need to set up a hostname entry in our hosts <a id="id54" class="indexterm"/>file so that the system points to the local machine whenever the new hostname is used. In Linux this can be done by adding an entry to the <code class="literal">/etc/hosts</code> file:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo vim /etc/hosts</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>In Windows, this file can be accessed at <code class="literal">%SystemRoot%\system32\drivers\etc\hosts</code>.</p></div></div></li><li class="listitem">Add the following line to the <code class="literal">hosts</code> file:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>127.0.0.1    comm-app.local</strong></span>
</pre></div><p>The final <code class="literal">hosts</code> file should look like the following:</p><div class="mediaobject"><img src="graphics/1929OS_02_02.jpg" alt="Time for action – creating a Zend Framework project"/></div></li><li class="listitem">Our <a id="id55" class="indexterm"/>next step would be to add a virtual host entry on our web server; this can be done by creating a new virtual host's configuration file:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo vim /usr/local/zend/etc/sites.d/vhost_comm-app-80.conf</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>This new virtual host filename could be different for you depending upon the web server that you use; please check out your web server documentation for setting up new virtual hosts.</p><p>For example, if you have Apache2 running on Linux, you will need to create the new virtual host file in <code class="literal">/etc/apache2/sites-available</code> and enable the site using<a id="id56" class="indexterm"/> the command <code class="literal">a2ensite comm-app.local</code>.</p></div></div></li><li class="listitem">Add the following configuration to the virtual host file:<div class="informalexample"><pre class="programlisting">&lt;VirtualHost *:80&gt;
  ServerName comm-app.local
  DocumentRoot /var/www/CommunicationApp/public
  SetEnv APPLICATION_ENV "development"
  &lt;Directory /var/www/CommunicationApp/public&gt;
    DirectoryIndex index.php
    AllowOverride All
    Order allow,deny
    Allow from all
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>If you are using a different path for checking out the <code class="literal">ZendSkeletonApplication</code> project <a id="id57" class="indexterm"/>make sure that you include that path for both <code class="literal">DocumentRoot</code> and <code class="literal">Directory</code> directives.</p></div></div></li><li class="listitem">After<a id="id58" class="indexterm"/> configuring the virtual host file, the web server needs to be restarted:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo service zend-server restart</strong></span>
</pre></div></li><li class="listitem">Once the installation is completed, you should be able to open <code class="literal">http://comm-app.local</code> on your web browser. This should take you to the following test page :<div class="mediaobject"><img src="graphics/1929OS_02_03.jpg" alt="Time for action – creating a Zend Framework project"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>
<span class="strong"><strong>Test rewrite rules</strong></span>
</p><p>In some cases, <code class="literal">mod_rewrite</code><a id="id59" class="indexterm"/> may not have been enabled in your web server by default; to check if the URL redirects are working properly, try to navigate to an invalid URL such as <code class="literal">http://comm-app.local/12345</code>; if you get an Apache 404 page, then the <code class="literal">.htaccess</code> rewrite<a id="id60" class="indexterm"/> rules are not working; they will need to<a id="id61" class="indexterm"/> be fixed, otherwise if you get a page like the following one, you can be sure of the URL working as expected.</p></div></div><div class="mediaobject"><img src="graphics/1929OS_02_04.jpg" alt="Time for action – creating a Zend Framework project"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have successfully created a new ZF2 project by checking out <code class="literal">ZendSkeletonApplication</code><a id="id62" class="indexterm"/> from GitHub and have used<a id="id63" class="indexterm"/> Composer to download the necessary dependencies including Zend Framework 2.0. We have also created a virtual host configuration that points to the project's <code class="literal">public</code> folder and tested the project in a web browser.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code </strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip14"/>Tip</h3><p>
<span class="strong"><strong>Alternate installation options</strong></span>
</p><p>We have seen just one of the methods of installing <code class="literal">ZendSkeletonApplication</code>; there are other ways of doing this.</p><p>You can use Composer to directly download the skeleton application and create the project using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar create-project --repository-url="http://packages.zendframework.com" zendframework/skeleton-application path/to/install</strong></span>
</pre></div><p>You can also<a id="id64" class="indexterm"/> use a recursive Git clone to create the same project:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git clone git://github.com/zendframework/ZendSkeletonApplication.git --recursive</strong></span>
</pre></div><p>Refer to:</p><p>
<a class="ulink" href="http://framework.zend.com/downloads/skeleton-app">http://framework.zend.com/downloads/skeleton-app</a>
</p></div></div></div></div>
<div class="section" title="Zend Framework 2.0 &#x2013; modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Zend Framework 2.0 – modules</h1></div></div></div><p>In Zend Framework, a module can be defined as a unit of software that is portable and reusable and can be interconnected to other modules to construct a larger, complex application.</p><p>Modules<a id="id65" class="indexterm"/> are not new<a id="id66" class="indexterm"/> in Zend Framework, but with ZF2, there is a complete overhaul in the way modules are used in Zend Framework. With ZF2, modules can be shared across various systems, and they can be repackaged and distributed with relative ease. One of the other major changes coming into ZF2 is that even the main application is now converted into a module; that is, the application module.</p><p>Some of <a id="id67" class="indexterm"/>the key advantages of Zend Framework 2.0 modules are listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Self-contained, portable, reusable</li><li class="listitem" style="list-style-type: disc">Dependency management</li><li class="listitem" style="list-style-type: disc">Lightweight and fast</li><li class="listitem" style="list-style-type: disc">Support for Phar packaging and Pyrus distribution</li></ul></div><div class="section" title="Zend Framework 2.0 – project folder structure"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Zend Framework 2.0 – project folder structure</h2></div></div></div><p>The folder<a id="id68" class="indexterm"/> layout of a ZF2 project is shown as follows:</p><div class="mediaobject"><img src="graphics/1929OS_02_05.jpg" alt="Zend Framework 2.0 – project folder structure"/></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Folder name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">config</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used <a id="id69" class="indexterm"/>for managing application configuration.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">data</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used as a temporary storage location for storing application data including cache files, session files, logs, and indexes.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">module</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used to manage all application code.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">module/Application</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id70" class="indexterm"/>is the default application module that is provided with <code class="literal">ZendSkeletonApplication</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">public</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Serves as an entry point to the application; the website's document root points here. All web resources including CSS files, images, and JavaScripts are stored here.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">vendor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used<a id="id71" class="indexterm"/> to manage common libraries that are used by the application. Zend Framework is also installed in this folder.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">vendor/zendframework</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Zend Framework 2.0 is installed here.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Time for action &#x2013; creating a module"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Time for action – creating a module</h1></div></div></div><p>Our next <a id="id72" class="indexterm"/>activity will be about creating a new <code class="literal">Users</code> module in Zend Framework 2.0. The <code class="literal">Users</code> module<a id="id73" class="indexterm"/> will be used for managing users including user registration,<a id="id74" class="indexterm"/> authentication, and so on. We<a id="id75" class="indexterm"/> will be making use of <code class="literal">ZendSkeletonModule</code> provided by Zend, shown as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the application's <code class="literal">module</code> folder:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd /var/www/CommunicationApp/</strong></span>
<span class="strong"><strong>$ cd module/</strong></span>
</pre></div></li><li class="listitem">Clone <code class="literal">ZendSkeletonModule</code><a id="id76" class="indexterm"/> into a desired module name, in this case it is <code class="literal">Users</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git clone git://github.com/zendframework/ZendSkeletonModule.git Users</strong></span>
</pre></div></li><li class="listitem">After the checkout is complete, the folder structure should look like the following screenshot:<div class="mediaobject"><img src="graphics/1929OS_02_09.jpg" alt="Time for action – creating a module"/></div></li><li class="listitem">Edit <code class="literal">Module.php</code><a id="id77" class="indexterm"/>; this file will be located in the <code class="literal">Users</code> folder under modules (<code class="literal">CommunicationApp/module/Users/module.php</code>) and change the namespace<a id="id78" class="indexterm"/> to <code class="literal">Users</code>. Replace <code class="literal">namespace ZendSkeletonModule;</code> with <code class="literal">namespace Users;</code>.</li><li class="listitem">The following folders can be removed because we will not be using them in our project:<p>
<code class="literal">* Users/src/ZendSkeletonModule</code>
</p><p>
<code class="literal">* Users/view/zend-skeleton-module</code>
</p></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have installed a skeleton module for Zend Framework; this is just an empty module, and we <a id="id79" class="indexterm"/>will need to extend this by creating custom<a id="id80" class="indexterm"/> controllers and views. In our next activity, we will focus on creating new controllers and views for this module.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>
<span class="strong"><strong>Creating a module using ZFTool</strong></span>
</p><p>
<code class="literal">ZFTool</code><a id="id81" class="indexterm"/> is a utility for managing Zend Framework applications/projects, and <a id="id82" class="indexterm"/>it can also be used for creating new modules; in order to do that, you will need to install <code class="literal">ZFTool</code> and<a id="id83" class="indexterm"/> use the <code class="literal">create module</code> command<a id="id84" class="indexterm"/> to create the module using <code class="literal">ZFTool</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar require zendframework/zftool:dev-master</strong></span>
<span class="strong"><strong>$ cd vendor/zendframework/zftool/</strong></span>
<span class="strong"><strong>$ php zf.php create module Users2 /var/www/CommunicationApp</strong></span>
</pre></div><p>Read more about ZFTool <a id="id85" class="indexterm"/>at the following link:</p><p>
<a class="ulink" href="http://framework.zend.com/manual/2.0/en/modules/zendtool.introduction.html">http://framework.zend.com/manual/2.0/en/modules/zendtool.introduction.html</a>
</p></div></div></div></div>
<div class="section" title="MVC layer"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>MVC layer</h1></div></div></div><p>The fundamental <a id="id86" class="indexterm"/>goal of any MVC Framework is to enable easier segregation of three layers of the MVC, namely, model, view, and controller. Before we get to the details of creating modules, let's quickly try to understand how these three layers work in an MVC Framework:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Model</strong></span>: The model<a id="id87" class="indexterm"/> is a representation of data; the model <a id="id88" class="indexterm"/>also holds the business logic for various application transactions.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View</strong></span>: The view <a id="id89" class="indexterm"/>contains the display logic that is used to<a id="id90" class="indexterm"/> display the various user interface elements in the web browser.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Controller</strong></span>: The <a id="id91" class="indexterm"/>controller controls the application<a id="id92" class="indexterm"/> logic in any MVC application; all actions and events are handled at the controller layer. The controller layer serves as a communication interface between the model and the view by controlling the model state and also by representing the changes to the view. The controller also provides an entry point for accessing the application.</li><li class="listitem" style="list-style-type: disc">In the new ZF2 MVC structure, all the models, views, and controllers are grouped by modules. Each module will have its own set of models, views, and controllers, and will share <a id="id93" class="indexterm"/>some components with other modules.</li></ul></div></div>
<div class="section" title="Zend Framework module &#x2013; folder structure"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Zend Framework module – folder structure</h1></div></div></div><p>The folder structure of Zend Framework 2.0 module has three vital components—the configurations, the module logic, and the views. The following table describes how contents in a module are organized:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Folder name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">config</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used<a id="id94" class="indexterm"/> for managing <a id="id95" class="indexterm"/>module configuration</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">src</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Contains <a id="id96" class="indexterm"/>all module source<a id="id97" class="indexterm"/> code, including all controllers and models</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">view</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Used<a id="id98" class="indexterm"/> to store all the views<a id="id99" class="indexterm"/> used in the module</p>
</td></tr></tbody></table></div></div>
<div class="section" title="Time for action &#x2013; creating controllers and views"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Time for action – creating controllers and views</h1></div></div></div><p>Now that<a id="id100" class="indexterm"/> we have created the module, our next step would be having our own controllers and views defined. In this section, we will create two simple views and will write a controller to switch between them:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the module location:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd /var/www/CommunicationApp/module/Users</strong></span>
</pre></div></li><li class="listitem">Create the folder for controllers:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mkdir -p src/Users/Controller/</strong></span>
</pre></div></li><li class="listitem">Create<a id="id101" class="indexterm"/> a new <code class="literal">IndexController</code> file, <code class="literal">&lt; ModuleName &gt;/src/&lt;ModuleName&gt;/Controller/</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd src/Users/Controller/</strong></span>
<span class="strong"><strong>$ vim IndexController.php</strong></span>
</pre></div></li><li class="listitem">Add the<a id="id102" class="indexterm"/> following code to the <code class="literal">IndexController</code> file:<div class="informalexample"><pre class="programlisting">&lt;?php
namespace Users\Controller;
use Zend\Mvc\Controller\AbstractActionController;
use Zend\View\Model\ViewModel;
class IndexController extends AbstractActionController
{
    public function indexAction()
    {
        $view = new ViewModel();
        return $view;
    }
    public function registerAction()
    {
        $view = new ViewModel();
        $view-&gt;setTemplate('users/index/new-user');
        return $view;
    }
    public function loginAction()
    {
        $view = new ViewModel();
        $view-&gt;setTemplate('users/index/login');
        return $view;
    }
}</pre></div></li><li class="listitem">The <a id="id103" class="indexterm"/>preceding code will do the following actions; if the user visits the home page, the user is shown the default view; if the user arrives with an action <code class="literal">register</code>, the user is shown the <code class="literal">new-user</code> template; and if the user arrives with an action set to <code class="literal">login</code>, then the <code class="literal">login</code> template is rendered.</li><li class="listitem">Now that we have created the controller, we will have to create necessary views to render for each of the controller actions.</li><li class="listitem">Create the folder for views:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd /var/www/CommunicationApp/module/Users</strong></span>
<span class="strong"><strong>$ mkdir -p view/users/index/</strong></span>
</pre></div></li><li class="listitem">Navigate to the views folder, <code class="literal">&lt;Module&gt;/view/&lt;module-name&gt;/index</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd view/users/index/</strong></span>
</pre></div></li><li class="listitem">Create the following view files:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">index</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">login</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">new-user</code></li></ul></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For creating the <code class="literal">view/users/index/index.phtml</code> file, use the following code:<div class="informalexample"><pre class="programlisting">&lt;h1&gt;Welcome to Users Module&lt;/h1&gt;
&lt;a href="/users/index/login"&gt;Login&lt;/a&gt; | &lt;a href="/users/index/register"&gt;New User Registration&lt;/a&gt;</pre></div></li><li class="listitem">For<a id="id104" class="indexterm"/> creating the <code class="literal">view/users/index/login.phtml</code> file, use the following code:<div class="informalexample"><pre class="programlisting">&lt;h2&gt; Login &lt;/h2&gt;
&lt;p&gt; This page will hold the content for the login form &lt;/p&gt;
&lt;a href="/users"&gt;&lt;&lt; Back to Home&lt;/a&gt;</pre></div></li><li class="listitem">For creating the <code class="literal">view/users/index/new-user.phtml</code> file, use the following code:<div class="informalexample"><pre class="programlisting">&lt;h2&gt; New User Registration &lt;/h2&gt;
&lt;p&gt; This page will hold the content for the registration form &lt;/p&gt;
&lt;a href="/users"&gt;&lt;&lt; Back to Home&lt;/a&gt;</pre></div></li></ol></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have now created a new controller and views for our new Zend Framework module; the module is still not in a shape to be tested. To make the module fully functional we will need to make changes to the module's configuration, and also enable the module in the application's configuration.</p></div></div>
<div class="section" title="Zend Framework module &#x2013; configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Zend Framework module – configuration</h1></div></div></div><p>Zend Framework 2.0 module configuration is spread across a series of files which can be found in <a id="id105" class="indexterm"/>the skeleton module. Some of the configuration files are described as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Module.php</code>: The Zend <a id="id106" class="indexterm"/>Framework 2 module manager looks for the <code class="literal">Module.php</code> file in the module's root folder. The module manager uses the <code class="literal">Module.php</code> file to <a id="id107" class="indexterm"/>configure the module and<a id="id108" class="indexterm"/> invokes the <code class="literal">getAutoloaderConfig()</code><a id="id109" class="indexterm"/> and <code class="literal">getConfig()</code> methods.</li><li class="listitem" style="list-style-type: disc"><code class="literal">autoload_classmap.php</code>: The <code class="literal">getAutoloaderConfig()</code> method in the skeleton<a id="id110" class="indexterm"/> module loads <code class="literal">autoload_classmap.php</code> to include any custom overrides other than the classes<a id="id111" class="indexterm"/> loaded using the standard autoloader format. Entries can be added or removed to the <code class="literal">autoload_classmap.php</code> file to manage these custom overrides.</li><li class="listitem" style="list-style-type: disc"><code class="literal">config/module.config.php</code>: The <code class="literal">getConfig()</code> method loads <code class="literal">config/module.config.php</code>; this<a id="id112" class="indexterm"/> file is used for <a id="id113" class="indexterm"/>configuring <a id="id114" class="indexterm"/>various module configuration options including routes, controllers, layouts, and various other configurations.</li></ul></div></div>
<div class="section" title="Time for action &#x2013; modifying module configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Time for action – modifying module configuration</h1></div></div></div><p>In this <a id="id115" class="indexterm"/>section will make configuration changes to the <code class="literal">Users</code> module to enable it to work with the newly created controller and views using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Autoloader configuration</strong></span> – The default autoloader configuration provided by<a id="id116" class="indexterm"/> the <code class="literal">ZendSkeletonModule</code> needs to be disabled;<a id="id117" class="indexterm"/> this can be done by editing <code class="literal">autoload_classmap.php</code> and replacing it with the following content:<div class="informalexample"><pre class="programlisting">&lt;?php
return array();</pre></div></li><li class="listitem"><span class="strong"><strong>Module configuration</strong></span> – The module configuration file can be found in <code class="literal">config/module.config.php</code>; this file needs to be updated to reflect the new controllers<a id="id118" class="indexterm"/> and views that have been created, as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Controllers</strong></span> – The <a id="id119" class="indexterm"/>default controller mapping<a id="id120" class="indexterm"/> points to the <code class="literal">ZendSkeletonModule</code>; this needs to be replaced with the mapping shown in the following snippet:<div class="informalexample"><pre class="programlisting">    'controllers' =&gt; array(
        'invokables' =&gt; array(
<span class="strong"><strong>            'Users\Controller\Index' =&gt; 'Users\Controller\IndexController',</strong></span>
        ),
    ),</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Views</strong></span> – The views for the module have to be mapped to the appropriate <a id="id121" class="indexterm"/>view location. Make sure<a id="id122" class="indexterm"/> that the view uses lowercase names separated by a hyphen (for example, <code class="literal">ZendSkeleton</code> will be referred to as zend-skeleton):<div class="informalexample"><pre class="programlisting">    'view_manager' =&gt; array(
        'template_path_stack' =&gt; array(
<span class="strong"><strong>            'users' =&gt; __DIR__ . '/../view',</strong></span>
        ),
    ),</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Routes</strong></span> – The last module configuration is to define a route for accessing<a id="id123" class="indexterm"/> this module from the <a id="id124" class="indexterm"/>browser; in this case we<a id="id125" class="indexterm"/> are defining the route as <code class="literal">/users</code>, which will point to the <code class="literal">index</code> action<a id="id126" class="indexterm"/> in the <code class="literal">Index</code> controller<a id="id127" class="indexterm"/> of the <code class="literal">Users</code> module:<div class="informalexample"><pre class="programlisting">    'router' =&gt; array(
        'routes' =&gt; array(
<span class="strong"><strong>            'users' =&gt; array(</strong></span>
                'type'    =&gt; 'Literal',
                'options' =&gt; array(
<span class="strong"><strong>                    'route'    =&gt; '/users',</strong></span>
                    'defaults' =&gt; array(
<span class="strong"><strong>                        '__NAMESPACE__' =&gt; 'Users\Controller',</strong></span>
<span class="strong"><strong>                        'controller'    =&gt; 'Index',</strong></span>
<span class="strong"><strong>                        'action'        =&gt; 'index',</strong></span>
                    ),
                ),</pre></div></li></ul></div></li><li class="listitem">After making all the configuration changes as detailed in the previous sections, the final configuration file, <code class="literal">config/module.config.php</code>, should look like the following:<div class="informalexample"><pre class="programlisting">&lt;?php
return array(
    'controllers' =&gt; array(
        'invokables' =&gt; array(
            'Users\Controller\Index' =&gt; 'Users\Controller\IndexController',
        ),
    ),
    'router' =&gt; array(
        'routes' =&gt; array(
            'users' =&gt; array(
                'type'    =&gt; 'Literal',
                'options' =&gt; array(
                    // Change this to something specific to your module
                    'route'    =&gt; '/users',
                    'defaults' =&gt; array(
                        // Change this value to reflect the namespace in which
                        // the controllers for your module are found
                        '__NAMESPACE__' =&gt; 'Users\Controller',
                        'controller'    =&gt; 'Index',
                        'action'        =&gt; 'index',
                    ),
                ),
                'may_terminate' =&gt; true,
                'child_routes' =&gt; array(
                    // This route is a sane default when developing a module;
                    // as you solidify the routes for your module, however,
                    // you may want to remove it and replace it with more
                    // specific routes.
                    'default' =&gt; array(
                        'type'    =&gt; 'Segment',
                        'options' =&gt; array(
                            'route'    =&gt; '/[:controller[/:action]]',
                            'constraints' =&gt; array(
                                'controller' =&gt; '[a-zA-Z][a-zA-Z0-9_-]*',
                                'action'     =&gt; '[a-zA-Z][a-zA-Z0-9_-]*',
                            ),
                            'defaults' =&gt; array(
                            ),
                        ),
                    ),
                ),
            ),
        ),
    ),
    'view_manager' =&gt; array(
        'template_path_stack' =&gt; array(
            'users' =&gt; __DIR__ . '/../view',
        ),
    ),
);</pre></div></li><li class="listitem"><span class="strong"><strong>Application configuration</strong></span> – Enable the module in the application's configuration—this<a id="id128" class="indexterm"/> can be done by modifying the application's <code class="literal">config/application.config.php</code> file, and adding<a id="id129" class="indexterm"/> <code class="literal">Users</code> to the list of enabled modules:<div class="informalexample"><pre class="programlisting">    'modules' =&gt; array(
        'Application',
        'Users',
    ),</pre></div></li><li class="listitem">To test the module in a web browser, open <code class="literal">http://comm-app.local/users/</code> in your web browser; you should be able to navigate within the module.</li></ol></div><p>The module home page is shown as follows:</p><div class="mediaobject"><img src="graphics/1929OS_02_06.jpg" alt="Time for action – modifying module configuration"/></div><p>The registration page is shown as follows:</p><div class="mediaobject"><img src="graphics/1929OS_02_07.jpg" alt="Time for action – modifying module configuration"/></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have modified<a id="id130" class="indexterm"/> the configuration of <code class="literal">ZendSkeletonModule</code><a id="id131" class="indexterm"/> to work with the new controller and views created for the <code class="literal">Users</code> module. Now we have a fully-functional module up and running using the new ZF module system.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Have a go hero</h2></div></div></div><p>Now that we have the knowledge to create and configure own modules, your next task would be to set up a new <code class="literal">CurrentTime</code> module<a id="id132" class="indexterm"/>. The requirement <a id="id133" class="indexterm"/>for this module is to render the current time and date in the following format:</p><p>
<span class="strong"><strong>Time: 14:00:00 GMT      Date: 12-Oct-2012</strong></span>
</p></div><div class="section" title="Pop quiz – Zend Framework 2.0"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>Pop quiz – Zend Framework 2.0</h2></div></div></div><p>Q1. What is the tool used by <code class="literal">ZendSkeletonApplication</code> for managing dependencies in PHP?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Git</li><li class="listitem">Composer</li><li class="listitem">PHP Command Line Interface</li><li class="listitem">Pyrus</li></ol></div><p>Q2. What is the filename of a module's configuration file?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">&lt;App&gt;/module/&lt;Module&gt;/config.inc</code></li><li class="listitem"><code class="literal">&lt;App&gt;/&lt;Module&gt;/config/config.php</code></li><li class="listitem"><code class="literal">&lt;App&gt;/module/&lt;Module&gt;/module.config.php</code></li><li class="listitem"><code class="literal">&lt;App&gt;/module/&lt;Module&gt;/config/module.config.php</code></li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Summary</h1></div></div></div><p>We have now learned about setting up a new Zend Framework project using Zend's skeleton application and module. In our next chapters, we will be focusing on further development on this module and extending it into a fully-fledged application.</p></div></body></html>