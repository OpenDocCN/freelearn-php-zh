<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;PHP"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. PHP</h1></div></div></div><p>In the previous chapter, we discussed client-side programming using JavaScript as the language. This chapter is all about <a id="id407" class="indexterm"/>
<span class="strong"><strong>server-side programming</strong></span> and the programming language we will learn for that purpose is PHP.</p><p>PHP was originally developed by Rasmus Lerdorf, who called it<a id="id408" class="indexterm"/> <span class="strong"><strong>Personal Home Pages</strong></span>. Today the three letters refer to <span class="strong"><strong>PHP: Hypertext Preprocessor</strong></span>. It is a full-featured programming language that is interpreted, not compiled (we now know what that means).</p><p>When, in that 6 month class I keep mentioning, we finally reached the PHP part, I was expecting a new and unexplored topic, a new frontier. I was prepared to, as a programmer, boldly go where no one—me in particular—had gone before. Instead, all elements were utterly familiar to me.</p><p>When I explain this experience to people, I compare it to running into a girlfriend you have not seen in 15 years and realizing you still like her. Strangely enough, something similar happened to me last year, and this time it was a girlfriend.</p><p>That familiarity with PHP involved not just the language itself, being similar to the C programming language, but, in particular, all the functions that come with the language. Many of those are the same utility functions that you find in the standard C library for UNIX systems.</p><div class="section" title="Introduction to PHP"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Introduction to PHP</h1></div></div></div><p>As we mentioned, PHP, like<a id="id409" class="indexterm"/> JavaScript, is a language that is interpreted. So, we need an interpreter first. With JavaScript, that was easy, the interpreter is inside any browser. With PHP, you need a separate program to interpret your code. Assume you have such a program called <code class="literal">php</code> on your computer (I have one on my Mac) where you can type in PHP code or supply a file with the code inside it, then we could write our first program.</p><p>Our first, not so useful, example: using your favorite editor, create a file called <code class="literal">first.php</code> and enter the following text:</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo "Hello, world";
?&gt;</pre></div><p>Notice the strings <code class="literal">&lt;?php</code> and <code class="literal">?&gt;</code>. Typically, PHP code is placed in between those strings. So both examples really contain only a single line of PHP code.</p><p>So, if you have that <code class="literal">php</code> program<a id="id410" class="indexterm"/> on your computer (don't panic if you don't, you are not going to need one), you can type <code class="literal">php first.php</code> and you will see <code class="literal">Hello, world</code> appear on your screen.</p><p>As PHP is a full-featured language, you could use it this way to create standalone programs for your projects. However, this is not why you bought this book and this is not how we are going to teach you the language.</p><div class="section" title="Our first real PHP program"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec74"/>Our first real PHP program</h2></div></div></div><p>We are going to use PHP to create <a id="id411" class="indexterm"/>
<span class="strong"><strong>dynamic webpages</strong></span>. In simple terms, these are HTML pages with PHP code<a id="id412" class="indexterm"/> embedded in them. The PHP interpreter will take your code, interpret it, and replace it with the result of your program. The resulting modified HTML document will have no more PHP code in it; that pure HTML file will be what the browser sees. Here is a good example:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8"/&gt;
&lt;title&gt;&lt;?php echo "Hello, world"; ?&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;?php
echo '&lt;h1&gt;Hello, World&lt;/h1&gt;' ;
?&gt;
&lt;/body&gt;
&lt;html&gt;</pre></div><p>Once the interpreter has done its thing, the contents of this file will have transformed into the exact lines of our first example in <a class="link" href="ch02.html" title="Chapter 2. HTML">Chapter 2</a>, <span class="emphasis"><em>HTML</em></span>, and this will be what the browser sees.</p><p>Notice that in the line with the <code class="literal">&lt;title&gt;</code> tag, we embedded PHP code inside the HTML tag. You can do that. The second line with PHP code in our example is part of a PHP statement block. That makes it a lot more readable.</p><p>So, how can this be useful? You are pulling my leg. We are three chapters further down the road and all you can do is tell me how to write <code class="literal">Hello, world</code> in ten different ways?</p><p>Of course PHP<a id="id413" class="indexterm"/> is going to be useful. The PHP code embedded in your HTML file could be a while loop (yes, PHP has that too) that pulls data out of a file or a database, and constructs clean HTML code using that data to generate multiple pages of HTML. All of this can be done with just a few lines of PHP code. But how do we get it to work? Well, we first need to set ourselves up with a thing or two.</p></div></div></div>
<div class="section" title="PHP and web hosting"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>PHP and web hosting</h1></div></div></div><p>So far, everything has been done by the browser, except for loading files down from the server into the browser, which the <a id="id414" class="indexterm"/>
<span class="strong"><strong>web server</strong></span> does at the browser's request - an HTTP request to be more precise.</p><p>The file that needs to be <a id="id415" class="indexterm"/>downloaded is determined by the URL, the address of a web page the user has typed in, or the link they clicked on; in this case, <code class="literal">www.sitename.com/demo.html</code> (or <code class="literal">demo.php</code>).</p><p>Once that HTML file is loaded into the browser, everything in it is read, including <code class="literal">&lt;img&gt;</code>, <code class="literal">&lt;script&gt;</code>, and <code class="literal">&lt;link&gt;</code> tags with <code class="literal">href</code> and <code class="literal">src</code> attributes. The browser will come up with a list of more files it needs and turn into a little Oliver Twist by going <span class="emphasis"><em>Please Server, can I have some more?</em></span>
</p><p>Once all of that code is present, the browser knows what to do with it and renders the web page on the user's<a id="id416" class="indexterm"/> computer or tablet. The <code class="literal">script</code> and <code class="literal">style</code> tags help you to distinguish which part is plain HTML and which is CSS or JavaScript.</p><p>Now, how the hell did all these files get up there, and where is <span class="emphasis"><em>there</em></span>? They got there, and back down, because behind the name <code class="literal">www.sitename.com</code>, there is a computer and a service called <a id="id417" class="indexterm"/>
<span class="strong"><strong>web hosting</strong></span>.</p><div class="section" title="Web hosting 101"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec75"/>Web hosting 101</h2></div></div></div><p>We have been holding off explaining this part because so far, we could use our examples without needing a true <a id="id418" class="indexterm"/>website. With PHP, this is going to be different, so this is the place to outline which steps you need to take if you want a website of your own that people can visit.</p></div><div class="section" title="Domain name"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec76"/>Domain name</h2></div></div></div><p>The first thing you need is a name for your website. What you really need is a <span class="strong"><strong>domain name</strong></span>. Websites cannot have any name you pick and no two websites can have the same name. So, if you want to <a id="id419" class="indexterm"/>call your plumbing company's site <code class="literal">joe.theplumber.com</code>, that is not going to happen by itself.</p><p>You want to use a web hosting company to do that for you.</p></div><div class="section" title="Web hosting companies"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec77"/>Web hosting companies</h2></div></div></div><p>Web hosting companies cannot only provide you with a domain name and the registration for it, they will also (for a fee) set you up on one of their computers that run 7 days a week, 24 hours a day - 24/7 in short. That way, everybody in the world with an internet connection can visit your website anytime.</p><p>Can't I use my own<a id="id420" class="indexterm"/> computer to set up my website? Yes, you could, but as soon as you shut it down and leave the house, nobody can visit your site, and that is not what you want.</p><p>A domain name is typically <code class="literal">www.</code> followed by a string that represents a person or a company, and then one of the available endings representing the type of organization involved, or the country where it is located. Early on, there were only a few of these endings available: <code class="literal">.com</code>, <code class="literal">.orig</code>, <code class="literal">.net</code>, <code class="literal">.gov</code>, and so on. The list is still expanding.</p><p>There are sites you can visit, for example, <code class="literal">dns.be</code> for domain names in Belgium, to see whether the domain name you picked is still available. I went with <a class="ulink" href="http://paulpwellens.com">paulpwellens.com</a> because <code class="literal">paulwellens.com</code> was already taken by a British rugby player. Well, I am neither British, nor a rugby player.</p><p>A few years later, after I moved back to Belgium, <code class="literal">paulwellens.be</code> became available. I registered it on my name for a year but then released it as I saw no point in having two different names, and worse, two different hosting companies. But you can have more than one domain name for a single site, if you like.</p></div><div class="section" title="Server-side setup"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec78"/>Server-side setup</h2></div></div></div><p>Once your web hosting<a id="id421" class="indexterm"/> company has set you up, it will provide you with essential information to allow you to transfer your web page files to your website. This typically involves:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The domain name of your website (of course)</li><li class="listitem" style="list-style-type: disc">An FTP address (an IP address or simply the same domain name)</li><li class="listitem" style="list-style-type: disc">A login and password</li><li class="listitem" style="list-style-type: disc">The name of a folder, for example <code class="literal">public_html</code></li></ul></div><p>With this information, you can transfer the web pages you have developed on your computer to your own site using the FTP protocol. This means that you need to have a program on your computer or tablet that can handle that. To most UNIX-based systems (Mac OS, Linux) that comes naturally, there are cool FTP apps for tablets, and FTP clients for Windows exist as well.</p><p>FTP stands for <span class="strong"><strong>File Transfer Protocol</strong></span>. Use or<a id="id422" class="indexterm"/> install a so-called FTP client on your computer or tablet and it will let you transfer files in between it and the host, typically one file at a time. FileZilla is something to look into if you want to transfer files in bulk. And, to continue with more good news, a lot of the cool HTML editors and other tools have FTP built in.</p><p>The folder on the server that holds the home page of your site, <code class="literal">public_html</code> in our example, is often referred to as your document root.</p></div><div class="section" title="Additional server-side services"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec79"/>Additional server-side services</h2></div></div></div><p>What we just described is <a id="id423" class="indexterm"/>exactly what you need, and nothing else, to set up a static website. If you plan to use other things, and you do, it is important that you check which additional services the web hosting company you consider offers. The minimal setup connects you to a Web Server with support for the HTTP and the FTP protocol. You also need to make sure that the following is available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">PHP - check which version of PHP</li><li class="listitem" style="list-style-type: disc">MySQL server - also check the version</li><li class="listitem" style="list-style-type: disc">PHPMyAdmin - a tool to easily to manage MySQL databases</li></ul></div><p>Most vendors will supply some kind of panel, CPanel being a popular one, to access and configure these services. The servers themselves typically run Linux or MacOS as the operating system, Apache as the web server, and support MySQL and PHP. In <code class="literal">www</code> land, this combination is often referred to as the LAMP stack. How about having a LAMP of your own?</p></div><div class="section" title="PHP development environment"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec80"/>PHP development environment</h2></div></div></div><p>There is nothing basically<a id="id424" class="indexterm"/> wrong with the setup we just described, but it holds one major inconvenience: your website will always look like work in progress. With this environment, the only way you can test the result of your work is by uploading your changes to your website using FTP and being a visitor of your own site. There is likely going to be something wrong from time to time; even the tiniest typo can do a great deal of damage.</p><p>For that reason, you want a local development environment on your computer. This allows you to only update your website periodically, when milestones of stable, tested code have arrived. In the meantime, you can develop new features, experiment, learn new things, and all of that <a id="id425" class="indexterm"/>good stuff.</p><p>To be able to develop your PHP application and test it locally you need:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A computer running MacOS, Linux, or Windows (at the time of writing, there was not a viable PHP environment on a tablet)</li><li class="listitem" style="list-style-type: disc">An Apache web server with PHP support</li><li class="listitem" style="list-style-type: disc">A good code editor, a full blown<a id="id426" class="indexterm"/> <span class="strong"><strong>Integrated Development Environment</strong></span> (<span class="strong"><strong>IDE</strong></span>), or something in between</li></ul></div><p>I personally like Adobe Dreamweaver. It does everything I need and not a single thing more. It lets me look at my pages/applications and test them locally, FTP to the server with a mouse click, and its editor recognizes HTML tags, CSS properties, and JavaScript and PHP keywords. But it is not free. There are several IDEs that are free.</p><p>Either way, you should have all the files that make up your website stored in a local directory, your local document root (for example, <code class="literal">$HOME/Sites/mysitename</code>), and do your testing locally using a URL that begins with <code class="literal">localhost</code>. On a Mac, that would be <code class="literal">http://localhost/~username/sitename/filename.php</code>
</p><p>Now, let's go back to the language itself. Just as we did with JavaScript, we will go through all the available ingredients in PHP that you can use to cook up a PHP program. To avoid duplication, we will not repeat what is the same in both languages, but point you to the differences. Where appropriate, we will do so in the same order.</p></div></div>
<div class="section" title="PHP as a web development language"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>PHP as a web development language</h1></div></div></div><p>So, now we are ready to use PHP to<a id="id427" class="indexterm"/> write web programs, run and test them locally, and place them on a server that your web hosting company manages; in brief—to develop and deploy.</p><p>We focus on the use of PHP to generate web pages dynamically. After the PHP code is interpreted, what remains is HTML, which you should think of as strings of text that are generated on the server and rendered by the client. The data that is used to generate these pages either comes out of an external file or a database.</p><p>When invited to, the visitor of your site will interact with it. There may be a form to fill out, a button to click, a selection to be made out of several choices, and so on. The result of that intervention by the visitor needs to somehow make its way back to the server and be processed there, and all can be thought of as strings of text again. After processing, it either goes back to the client to inform the visitor and/or it needs to be stored somewhere. That somewhere is going<a id="id428" class="indexterm"/> to also be a file on the server or database.</p><p>Although I keep claiming, and I mean it, that this book is not to be used as a reference, we include a short reference on things related to strings and files, as you need them everyday. Databases are the topic of the next chapter.</p><div class="section" title="Variables, values, operators, and expressions"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec81"/>Variables, values, operators, and expressions</h2></div></div></div><p>Well, you could say that in PHP, every variable will cost you a dollar, because every variable name has to begin<a id="id429" class="indexterm"/> with a <code class="literal">$</code>, a dollar sign. If this little word game helps us<a id="id430" class="indexterm"/> remember the important difference between JavaScript and PHP variables, we will<a id="id431" class="indexterm"/> all save quite a few dollars over time.</p><div class="informalexample"><pre class="programlisting">&lt;?php
$counter = 0;
$hello = "Hello, world";
?&gt;</pre></div><p>There is no <code class="literal">var</code> keyword<a id="id432" class="indexterm"/> in PHP to declare variables. You can just start using them when you initialize them. Just like in JavaScript, there are no strict types, you can use numeric and string values; PHP also uses functions, and the operators are the same unless you want to glue strings together. However, the story on the scope of variables is different.</p><div class="section" title="Scope of variables"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec27"/>Scope of variables</h3></div></div></div><p>As is the case in JavaScript, the scope of a variable, the area inside a program where the variable is known and can be accessed, is a very important thing to understand. Compared to JavaScript, different<a id="id433" class="indexterm"/> keywords are used. I already mentioned that there is no <code class="literal">var</code> keyword. Instead, we have two new ones—global and static.</p><div class="section" title="Local variables"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec14"/>Local variables</h4></div></div></div><p>Local variables can be accessed<a id="id434" class="indexterm"/> inside the function they are declared. It's like in JavaScript, but without the <code class="literal">var</code> keyword. Let's, once more, produce the number 3 in at least three lines:</p><div class="informalexample"><pre class="programlisting">&lt;?php
function three()
{
$a = 1;
$b = 2;
$c = $a + $b ;
echo $c;
}
?&gt;</pre></div><p>This simply produces <code class="literal">3</code>. If we were to use the variable <code class="literal">$c</code> outside the function in an <code class="literal">echo</code> statement, it would <a id="id435" class="indexterm"/>produce nothing. Yes, you heard me, nothing - not undefined, not 0, no error message, just nothing, but in a way, it is the empty string.</p><p>Here is another example. This time it does not even calculate <code class="literal">3</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$a = 1;
$b = 2;
function nothing() {
$c = $a + $b;
echo $c;
echo $d;
}
nothing();
?&gt;</pre></div><p>Remember the JavaScript example where we declared a variable outside a function and initialized it, and then modified its value by mistake inside a function? The declaration outside the function turned that variable into a global, without using that word in the program. Variables with the same name inside a function would hide those globals, but only if they were explicitly declared.</p><p>In PHP, we have the opposite. When we declare variables outside a function and then introduce a function in our code where we try to access them, they will simply disappear from our program horizon. So, in our example, in the statement inside the <code class="literal">nothing()</code> function:</p><div class="informalexample"><pre class="programlisting">$c = $a + $b;</pre></div><p>
<code class="literal">$a</code> and <code class="literal">$b</code> are undeclared variables, and when used inside an expression, their value usually becomes the empty string. That is why nothing will appear on the screen when we use the statement:</p><div class="informalexample"><pre class="programlisting">echo $d;</pre></div><p>The previous line however will produce the number <code class="literal">0</code>. This is because it is the result of an expression containing the <code class="literal">+</code> operator. The operands of the expression are first converted to numeric values, so we end up adding nothing to nothing, which is the same as adding zero to zero<a id="id436" class="indexterm"/> and the result still being zero. So, how do we get access inside the function to <code class="literal">$a</code> and <code class="literal">$b</code> that we declared outside?</p></div><div class="section" title="Global variables"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec15"/>Global variables</h4></div></div></div><p>It is a common practice in many <a id="id437" class="indexterm"/>programming languages to take a frequently used sequence of statements and place them together in a reusable function, for example:</p><div class="informalexample"><pre class="programlisting">getProductList();</pre></div><p>Depending on the programming language, a function may technically not be called a function but a subroutine, a procedure, and so on. In a typical web development scenario where you need to get data out of a database, such an operation occurs frequently, so you want to organize your code that way.</p><p>Many times, I was flabbergasted because my perfectly working code stopped working once I grouped it inside a function. The reason being: my global <code class="literal">$mysqli</code> object that I initialized outside everything else was not reached inside my function. What appeared global to me was not treated as global by PHP. Here is the remedy:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$a = 1;
$b = 2;
function nothing() {
<span class="strong"><strong>global $a, $b;</strong></span>
$c = $a + $b;
echo $c;
}
nothing();
?&gt;</pre></div><p>Not until you use the global keyword inside the function will your <span class="emphasis"><em>global</em></span> variables be treated as such.</p><p>Another remedy would be to make your <code class="literal">$a</code> and <code class="literal">$b</code> variables parameters of the function, but I would not recommend this. Using global variables declared as global inside the functions where you need them is the global best practice.</p></div><div class="section" title="Static variables"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec16"/>Static variables</h4></div></div></div><p>There is a third kind of<a id="id438" class="indexterm"/> variable scope that could be very useful in some programming situations. Consider this:</p><div class="informalexample"><pre class="programlisting">&lt;?php
function listNextPrice ($price)  {
// Yes, arguments cost a dollar too
$article = 0;
$article++;
echo  'Article number ' . $article . 'costs  $' . $price  ;
//Analyze this carefully
?&gt;</pre></div><p>It is probably clear what the intent is. Each time we use this function, we want to list the price we pass as an<a id="id439" class="indexterm"/> argument, but we expect the article number to be one higher as well. However, each time we re-enter the function, the <code class="literal">$article</code> variable is reset to 0. Now, pay attention to this slightly different version:</p><div class="informalexample"><pre class="programlisting">&lt;?php
function listNextPrice ($price)  {
static $article = 0;
$article++;
echo  'Article number ' . $article . 'costs  $' . $price  ;
}
?&gt;</pre></div><p>This will provide the intended result because we declared <code class="literal">$article</code> as a static. The line with the keyword static where the variable is assigned its initial value is only used once and is ignored from that point forward when the program returns to the function. Each time it does that, however, the variable's value from the previous visit is remembered. The declaration with the static keyword cannot use an expression to initialize the variable, though.</p><p>The same selection of expressions and operators that we used in the <a class="link" href="ch04.html" title="Chapter 4. JavaScript">Chapter 4</a>, <span class="emphasis"><em>JavaScript</em></span>, are valid in PHP, with one major, extremely important, exception.</p></div><div class="section" title="String operators"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec17"/>String operators</h4></div></div></div><p>In JavaScript, you learned<a id="id440" class="indexterm"/> that you could not only use the <code class="literal">+</code> sign to add numbers but also to glue strings together - concatenate them, as it is also called. In PHP, there is a separate operator to do that. It comes in two flavors, which we illustrate here:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$a = "Hello";
$a =  $a   .   "World";
?&gt;</pre></div><p>Or:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$a = "Hello";
$a  .=  "World";
?&gt;</pre></div><p>Most of your PHP code will be like this: concatenating strings to build up the final HTML of a dynamic page. Typically, you would start with a variable, initialize it with an opening<a id="id441" class="indexterm"/> tag, build up from there until you reach the final HTML tag, and then <code class="literal">echo</code> the whole lot:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$htmlstring     = '&lt;div&gt;';
$htmlstring    .= '&lt;h1&gt;Hello, World &lt;/h1&gt;';
$htmlstring    .= '&lt;/div&gt;';
echo $htmlstring;
?&gt;</pre></div><p>Once we start adding attributes to the HTML tags, which require quotes, and start using PHP variables that contain dollar signs, it is important to pay careful attention, not only to properly use quotes, but also to which quotes to use.</p></div><div class="section" title="To double quote or to single quote, that is the question"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec18"/>To double quote or to single quote, that is the question</h4></div></div></div><p>I am a single quote guy, I start with single <a id="id442" class="indexterm"/>quotes for every string, then switch to double quotes inside when I need them. What is the difference between them? Everything inside single quotes is taken literally, so <code class="literal">$name</code> reads as <code class="literal">$name</code>. In text between double quotes, variables are evaluated, so <code class="literal">$name</code> would read as whatever the value <a id="id443" class="indexterm"/>of that variable is. If you use single quotes and need variables, place them outside the quotes and use the concatenation operator to compose your text, like this:</p><div class="informalexample"><pre class="programlisting">$htmlstring .= '&lt;h2 class="blue"&gt;'.$hello.'&lt;/h2&gt;';</pre></div><p>If you want to use double quotes, the same statement has to look like this.</p><div class="informalexample"><pre class="programlisting">$htmlstring .= "&lt;h2 class=\"blue\"&gt;$hello&lt;/h2&gt;";</pre></div><p>You can leave <code class="literal">$hello</code> inside as it will be evaluated, but you have to escape the double quotes of the class attributes with a backslash to lift its special meaning.</p><p>My preference is to use single quotes. Just avoid mixing the two methods. On the other hand, if you have to work with code from others, make sure you pay attention to these, not always subtle, differences.</p></div></div></div><div class="section" title="Control flow"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec82"/>Control flow</h2></div></div></div><p>In <a class="link" href="ch04.html" title="Chapter 4. JavaScript">Chapter 4</a>, <span class="emphasis"><em>JavaScript</em></span>, we listed the principle<a id="id444" class="indexterm"/> control flow statements of the language: if, if/else, while, and switch. The same are available in PHP with the same syntax. Don't forget your dollars in<a id="id445" class="indexterm"/> the variable names, though!</p></div><div class="section" title="Functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec83"/>Functions</h2></div></div></div><p>The syntax for user-defined functions is also the same as in JavaScript.</p><p>PHP also comes with <a id="id446" class="indexterm"/>quite a few functions predefined. Some of these are so useful that we decided to include the description and syntax of them. Most of them remind me of the C library<a id="id447" class="indexterm"/> functions from my UNIX days.</p></div><div class="section" title="String functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec84"/>String functions</h2></div></div></div><p>As you will be using strings all the<a id="id448" class="indexterm"/> time, and will often have to manipulate those strings before the final output, it is good to know that PHP comes with a nice <a id="id449" class="indexterm"/>group of string functions. For your convenience, we<a id="id450" class="indexterm"/> include the most useful ones here.</p><div class="section" title="strpos()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec28"/>strpos()</h3></div></div></div><p>The <code class="literal">strpos()</code> function<a id="id451" class="indexterm"/> finds the position of the first occurrence<a id="id452" class="indexterm"/> of a string inside another string. It returns the position (starts at <code class="literal">0</code>, not <code class="literal">1</code>) or <code class="literal">FALSE</code> when the string is not found. The function takes two arguments: the string to look in and the string to look for:</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo strpos("Hello, World","World");  // this wil print 7
?&gt;</pre></div></div><div class="section" title="strlen()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec29"/>strlen()</h3></div></div></div><p>
<code class="literal">strlen()</code> returns the<a id="id453" class="indexterm"/> length of the string that is the only argument for this<a id="id454" class="indexterm"/> function or <code class="literal">0</code> if the string is empty.</p></div><div class="section" title="substr()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec30"/>substr()</h3></div></div></div><p>
<code class="literal">substr()</code> returns a<a id="id455" class="indexterm"/> substring of a string. Its typical use is <code class="literal">substr($string,$start,$length)</code>. <code class="literal">$string</code> is the string used to examine, <code class="literal">$start</code> is the<a id="id456" class="indexterm"/> start position in that string, and the optional <code class="literal">$length</code> is used to specify the length of the string we want returned. The default is to the end of the string.</p><p>We can also combine<a id="id457" class="indexterm"/> these functions. What would you<a id="id458" class="indexterm"/> think the following will do?</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo substr("Hello,world", strpos("Hello, world","world"));
?&gt;</pre></div></div></div><div class="section" title="Date functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec85"/>Date functions</h2></div></div></div><p>It is hard to imagine a web application that never has to do anything with the time or date. Moreover, you will often<a id="id459" class="indexterm"/> have the need to use a different date format, not only because date formats differ in different <a id="id460" class="indexterm"/>parts of the world, 07/19 is correct in the US but<a id="id461" class="indexterm"/> has to be 19/07 in Europe, dates in databases use a different format as well. There are three very convenient functions to help you with that.</p><p>So, what is a date? Well it can be something that grows in warm countries and hangs on trees; I used to buy dates in Death Valley and give them to my friends. Date is also another word for an appointment, and people, young and old, can get all excited when they go on a date.</p><p>In PHP, however, the definition of date or time also comes from UNIX, and is equal to the number of seconds between now and January 1, 1970 00:00:00 GMT. Here are the three functions and how to use them.</p><div class="section" title="time()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec31"/>time()</h3></div></div></div><p>This will return the time<a id="id462" class="indexterm"/> of now in seconds. So, in the following code, you can<a id="id463" class="indexterm"/> store this in a variable:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$rightnow = time();
?&gt;</pre></div><p>Please note this will be the date and time on your hosting server, which may be sitting in a different part of the world than your computer or that of the visitor of your site. You always want to specify what the correct time zone for your program is with the <code class="literal">date_default_timezone_set</code> function, for example:</p><div class="informalexample"><pre class="programlisting">&lt;?php
date_default_timezone_set('Europe/Brussels');
?&gt;</pre></div><p>If the date and time of your visitor needs to be determined, then that will have to happen on the client side, i.o.w. in <a id="id464" class="indexterm"/>JavaScript using its <code class="literal">date</code> object.</p></div><div class="section" title="date()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec32"/>date()</h3></div></div></div><p>The <code class="literal">date()</code> function is used<a id="id465" class="indexterm"/> to take a timestamp, for example, a number of seconds, or right now by default, and convert it<a id="id466" class="indexterm"/> into the format you want. The first argument it takes is a format string. Check out a good reference for a complete list of items you can use in that string. The most commonly used are <code class="literal">m</code> for a two digit representation of the month, <code class="literal">d</code> for the day, and <code class="literal">Y</code> for the four digit representation of the year. So, to get today's date in the European format with slashes:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$eurodate = date('d/m/Y');
//or, same thing
$eurodate = date('d/m/Y', time());
?&gt;</pre></div><p>Of course, you will, from time to time, need the date and time of right now, but it is more common that you need to work with dates in the past (order dates) and the future (agenda items). So, how do we calculate the exact number of seconds between the time an order was placed and midnight of the last day in 1969? You don't. There is one more function to help us with that.</p></div><div class="section" title="strtotime()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec33"/>strtotime()</h3></div></div></div><p>The <code class="literal">strtotime()</code> function will, in turn, return a timestamp based on the string that is passed as an argument - for<a id="id467" class="indexterm"/> instance, the format coming out of a<a id="id468" class="indexterm"/> database. Look up a good <code class="literal">strtotime</code> reference for a list of all valid formats. So, in practice, you will often combine the two, as in:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$htmlstring .= '&lt;td&gt;'.date("d/m/Y", strtotime($dbdate)).'&lt;/td&gt;';
?&gt;</pre></div></div></div><div class="section" title="Arrays"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec86"/>Arrays</h2></div></div></div><p>An array is a collection <a id="id469" class="indexterm"/>of data elements stored in a single variable. In most programming languages that I knew before PHP, these elements would be referenced by a number, its index, starting at number 0 for the first one. What was a revelation to me, during the training<a id="id470" class="indexterm"/> I keep mentioning, is a different type of array that you can use in PHP: an associative array. More about that very soon.</p><div class="section" title="Numeric arrays or indexed arrays"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec34"/>Numeric arrays or indexed arrays</h3></div></div></div><p>The traditional array<a id="id471" class="indexterm"/> with a numeric index can be declared and initialized at <a id="id472" class="indexterm"/>once, like this:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$beatles  = array ("John", "Paul", "George", "Ringo" );
echo  $beatles[0]. " Lennon:;
?&gt;
&lt;?php
/* different way to do the same */
$beatles = array();
$beatles[]= "John';
$beatles[]= "Paul";
$beatles[]= "George";
$beatles[]="Ringo";
?&gt;</pre></div><p>In both examples, we create a <code class="literal">4</code> element array that contains the first names of the Beatles. In the first example, we do<a id="id473" class="indexterm"/> it all at once, using the <code class="literal">array()</code> constructor - similar to what we used in JavaScript to create objects. As a matter of fact, JavaScript has arrays as well, but we are not going to need them as often as we do in PHP.</p><p>The second example first tells Mr. PHP that <code class="literal">$beatles</code> is supposed to be an array, and then we start filling it up. The first <code class="literal">$beatles[]="John"</code> assignment is equivalent to:</p><div class="informalexample"><pre class="programlisting">$beatles[0] = "John";</pre></div><p>The next ones will<a id="id474" class="indexterm"/> initialize the element with an index one higher. However, we could have written this:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$beatles[6] = "George";
$beatles[] = "Ringo";
?&gt;</pre></div><p>Then George would have become the value of <code class="literal">$beatles[6]</code> and Ringo that of <code class="literal">$beatles[7]</code>. It is perfectly okay for there not to be any elements with index 2, 3, 4, and 5. People who like to collect things probably hate that. They cannot stand having 0 and 1 and 6 and 7 of something and not the ones in between. They will probably love associative arrays, just like I do.</p></div><div class="section" title="Associative arrays"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec35"/>Associative arrays</h3></div></div></div><p>With what is called <a id="id475" class="indexterm"/>associative arrays in PHP, an index can be a string rather than a number. This is how it works:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$employee = array();
$employee['first'] =  "John";
$employee['last'] = "Williams";
$employee['profession'] = "conductor";
?&gt;</pre></div><p>We have basically recreated the JavaScript object from the previous chapter as an associative array. There is also a way to initialize this all in one statement. Its syntax is new and different <a id="id476" class="indexterm"/>and introduces key/value pairs. These key/value pairs will prove very useful when we start extracting data from a database such as MySQL, because we can have MySQL return the data to us as a...guess what...associative array.</p><p>So, here is the single statement version using the special <code class="literal">=&gt;</code> operator:</p><div class="informalexample"><pre class="programlisting">$employee = array(
"first" =&gt; "John",
"last" =&gt; "Williams",
"profession" =&gt; "conductor"
);</pre></div></div><div class="section" title="Cool control statements for associative arrays"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec36"/>Cool control statements for associative arrays</h3></div></div></div><p>There are more control statements than the ones we described in this and the previous chapter. The <code class="literal">foreach</code> statement is<a id="id477" class="indexterm"/> extremely useful to loop through an array, as you can easily walk through the keys and the values. The following statement loops through the array of our example:</p><div class="informalexample"><pre class="programlisting">foreach ($employee as $key =&gt; $value) {
echo $key. ' is '.$value. '&lt;br /&gt;';
}</pre></div><p>Now that you've learned what associative arrays are, we are ready to explain some important array variables that we do not create ourselves, but are generated by the system<code class="literal">: $_POST</code> and <code class="literal">$_GET</code>. The most common scenario where we will have access to those is when a visitor of our site fills out a form and pushes a button.</p></div></div><div class="section" title="Sending data back to the server – forms"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec87"/>Sending data back to the server – forms</h2></div></div></div><p>You already know one <a id="id478" class="indexterm"/>way to obtain information from the server, and you will learn other ones when we discuss files and databases but let's first reverse it. We are going to show you how we can catch and process the information that the visitor of our site provided us with.</p><p>The most common way is when the visitor fills out fields in a form and submits it. This takes us back to <a class="link" href="ch02.html" title="Chapter 2. HTML">Chapter 2</a>, <span class="emphasis"><em>HTML</em></span>, where we discussed the <code class="literal">&lt;form&gt;</code> and <code class="literal">&lt;input&gt;</code> elements. The <code class="literal">&lt;form&gt;</code> tag has more attributes than we discussed because we could not explain them at the time. In order to validate the user input, for example, to see whether a ZIP code contains only numbers before it is sent to the server, we were required to know JavaScript. We are still postponing that gig, because there is a very nice jQuery plugin to do that for us. Nor could we<a id="id479" class="indexterm"/> explain the <span class="emphasis"><em>action</em></span> and <span class="emphasis"><em>method</em></span> attributes, because that involved PHP. The time to do that is now.</p><p>Take a look at the following chunk of HTML, a relatively simple, partial form people can use to sign up for a newsletter.</p><div class="informalexample"><pre class="programlisting">&lt;form id="myform" action="process.php" method="POST"&gt;
&lt;label&gt; First name &lt;/label&gt;
&lt;input type="text" name="first" /&gt;&lt;br /&gt;
&lt;label&gt;Last name &lt;/label&gt;
&lt;input  type="text" name="last" /&gt;&lt;br /&gt;
&lt;label&gt;Tell me about your hobbies:&lt;/label&gt;&lt;br /&gt;
&lt;input type="checkbox" name="hobbies[]" value="Photography"&gt;Photography&lt;/input&gt;&lt;br /&gt;
&lt;input type="checkbox" name="hobbies[]" value="Music"&gt;Music&lt;/input&gt;&lt;br /&gt;
&lt;input type="checkbox" name="hobbies[]" value="Theatre"&gt;Theatre&lt;/input&gt;&lt;br /&gt;
&lt;input type="checkbox" name="hobbies[]" value="Tennis"&gt;Tennis&lt;/input&gt;&lt;br /&gt;
&lt;button&gt;Submit&lt;/button&gt;
&lt;/form&gt;</pre></div><p>Imagine this code being part of a website where a visitor fills out the form and pushes the submit button. The data the user has filled in will be sent to the server and can be processed in the PHP module that is supplied with the <code class="literal">action</code> attribute, <code class="literal">process.php</code> in our example. On the other side, what has been entered as a value for the input fields will be stored in an array, named either <code class="literal">$_POST</code> or <code class="literal">$_GET</code>, depending on which method was chosen.</p><div class="section" title="POST or GET, what should we get?"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec37"/>POST or GET, what should we get?</h3></div></div></div><p>My personal preference is to <a id="id480" class="indexterm"/>always use <span class="strong"><strong>POST</strong></span>, unless I need to use <span class="strong"><strong>GET</strong></span>. So, what is the difference?</p><p>With the <code class="literal">GET</code> method, the data is<a id="id481" class="indexterm"/> passed along with the URL, the address of the web page you can see inside the browser. You will see things like: <code class="literal">process.php?first=John&amp;last=Williams&amp;profession=conductor</code> in the URL address bar. The string behind the question mark is called the query string.</p><p>With this method, visitors (assuming you gave them instructions) can pass along parameters that you can then process in your PHP code. It can also be useful to bookmark an interesting article that is part of large website and that you can revisit because the creator has added<a id="id482" class="indexterm"/> support for that through, for example, a query string <code class="literal">article=number</code>.</p><p>The two major <a id="id483" class="indexterm"/>downsides of using <code class="literal">GET</code> is that there is an implementation-dependent size limit (could be 1024 bytes) and that everything is visible. This is not how you want to display the login and password:</p><div class="informalexample"><pre class="programlisting">login.php?login=paul&amp;password=mysecret.</pre></div><p>So, in general, you want to use the <code class="literal">POST</code> method; there is virtually no size limit, and nothing is revealed in the URL bar of the browser:</p><div class="section" title="$_POST and $_GET arrays"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl4sec19"/>$_POST and $_GET arrays</h4></div></div></div><p>It is quite simple; you<a id="id484" class="indexterm"/> can find all the values that were filled out in the form in an associative array <code class="literal">$_POST</code>. In the case of input tags, key/value pairs are the values of the <code class="literal">name</code> attribute and either the <code class="literal">value</code> attribute or what was filled out.</p><p>We cannot be sure whether a<a id="id485" class="indexterm"/> user has filled out every required field and whether we have even done validation on the client side, which we are going to learn in a later chapter, there still needs to be validation on the server side. Otherwise, we might stuff a file or database with empty or incomplete employee records.</p><p>Note the square brackets used in the name attribute for the checkboxes. How can they all have the same name? They don't. The result of a user selecting hobbies will be an indexed array, which will be <code class="literal">$_POST['hobbies']</code>.</p><p>When processing your <code class="literal">POST</code> variables, you may want to use the <code class="literal">isset()</code> function. This checks to see whether the variable actually exists, which is different than checking to see whether it exists and has a value other than <code class="literal">0</code> or the empty string.</p><p>What follows is what could be code in our <code class="literal">process.php</code> module. In it, we introduce, <code class="literal">&amp;&amp;</code>, a logical operator. Think of it as a logical <code class="literal">AND</code> operator, which returns true if both what is on its left and right is true. Its counterpart is <code class="literal">||</code>, logical <code class="literal">OR</code>, which is true if at least one of its operands is true.</p><div class="informalexample"><pre class="programlisting">&lt;?php
if((isset($_POST['first'])))&amp;&amp; ($_POST != "")){
$first = $_POST['first'];
}
if((isset($_POST['last']))&amp;&amp; (4_POST['last'] != "")) {
$last = $_POST['last'];
}
if(isset($_POST['hobbies']){
$totalhobbies = count($_POST['hobbies']);
}
?&gt;</pre></div><p>The <code class="literal">count()</code> function is a function<a id="id486" class="indexterm"/> that counts how many elements there are in an array, i.o.w. what its size is, and<a id="id487" class="indexterm"/> returns it. In our example, this would<a id="id488" class="indexterm"/> amount to the number of hobbies selected, not the number to choose from.</p></div></div></div><div class="section" title="Files"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec88"/>Files</h2></div></div></div><p>In the previous chapters, we were dealing with inline CSS or JavaScript or, by using the correct tag and attribute, we could reference external files that contain our code. No such tags or attributes for our <a id="id489" class="indexterm"/>PHP code exist, though. But there is a different way to do that.</p><p>Let's assume that you have<a id="id490" class="indexterm"/> written a bunch of cool functions that you plan on reusing in other projects. There is no point in repeating them in between <code class="literal">&lt;?php</code> and <code class="literal">?&gt;</code> in every <code class="literal">.html</code> file where you want to use them. It is a far better idea to keep them in a separate file that you can reference. We have some PHP keywords to do exactly that.</p><div class="section" title="include, require, and require_once"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec38"/>include, require, and require_once</h3></div></div></div><p>When used in a PHP<a id="id491" class="indexterm"/> statement, all three will do the same. The statement containing the keyword followed by a filename will be replaced by the contents of the file. There are nuances: if <code class="literal">include</code> is<a id="id492" class="indexterm"/> used and the file is not found, the program will <a id="id493" class="indexterm"/>continue, whereas if you use <code class="literal">require</code>, the program will stop.</p><p>The difference between <code class="literal">require</code> and <code class="literal">require_once</code> is that with <code class="literal">require_once</code>, a file that has already been loaded will not be loaded again. Make sure that you put your PHP code inside the files you include in between <code class="literal">&lt;?php</code> and <code class="literal">?&gt;</code> again. In the statement itself you can use parentheses or not, for example:</p><div class="informalexample"><pre class="programlisting">include "morecode.php"
require ("includes/functions.php");</pre></div></div><div class="section" title="Regular files"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec39"/>Regular files</h3></div></div></div><p>So far, we have been <a id="id494" class="indexterm"/>using all kinds of files that are stored on the server: programs (<code class="literal">.php</code> and <code class="literal">.js</code>), stylesheets (<code class="literal">.css</code>) plain web pages (<code class="literal">.html</code>), and images, used with the <code class="literal">&lt;img&gt;</code> tag. Those last ones can be in different kinds of format: <code class="literal">.png</code>, <code class="literal">.gif</code>, <code class="literal">.png</code>, even <code class="literal">.tiff</code>. The links in our web pages can reference even more files that reside on the server such as all kind of documents in a PDF format, or even Word. All of these files will be downloaded for the visitor of our site by the browser when needed and will have arrived on that server because we put them there, probably using FTP.</p><p>However, there are different kinds of files you could access from within your program, as well as creating or modifying new ones. After all, a well-structured file can act as a small database. There is a whole family of ready-to-use functions to handle files. Most of them take a path to a file, which is nothing else but the name itself or a number of directory names separated by a <code class="literal">/</code> and followed by the filename.</p><p>Those functions then return or use a file handle or file pointer. This is the part where I got <span class="emphasis"><em>deja vu</em></span> in the training course. UNIX folks will remember that everything is treated like a file: a file proper, a printer, a hard disk, any device, and that the basic operations for files are: create, delete, open, close, read and write. For true files, text files, or binaries, there was a collection of convenient functions, all with a name beginning with an <span class="emphasis"><em>f</em></span>. We rediscover these in PHP.</p></div></div><div class="section" title="File functions or f-functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec89"/>File functions or f-functions</h2></div></div></div><p>There are functions to access existing files or create new ones, to check whether files even exist, and are actually<a id="id495" class="indexterm"/> files and not directories, and<a id="id496" class="indexterm"/> functions to read from and write to files. The first one is a little bit of a study; the rest is easy.</p><div class="section" title="fopen"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec40"/>fopen</h3></div></div></div><p>There is no <code class="literal">fcreate!</code>, so <code class="literal">fopen</code> is used to either create a file or open an existing one, but for what purpose? You have to <a id="id497" class="indexterm"/>carefully study the options for the second argument of<a id="id498" class="indexterm"/> this function, as that determines what happens to your file. This can go from creating a new file for writing and an existing one for reading to taking a file, destroying what is already in it and starting anew. It is also important to realize where the file pointer is pointing to. We will give you just three of these options, but they should suffice for 95% of your work. Note that we expect the value of <code class="literal">$filename</code> to be a pathname to a file.</p><div class="informalexample"><pre class="programlisting">$fp = fopen($filename, "r");</pre></div><p>This will open the file for reading and the file pointer will point to the beginning of the file. This is typically<a id="id499" class="indexterm"/> what you want if you want to extract information from an existing file.</p><div class="informalexample"><pre class="programlisting">$fp = fopen($filename,"a");</pre></div><p>The <code class="literal">a</code> stands for append. So, this will open a file for writing, starting at the end. So the end will be where the<a id="id500" class="indexterm"/> file pointer points to, and everything you write to this file will be added at the end.</p><div class="informalexample"><pre class="programlisting">$fp = fopen($filename, "x");</pre></div><p>This is the closest to create. If the file does already exist, it will stay intact, and <code class="literal">fopen()</code> will return <code class="literal">FALSE</code> rather than a file pointer. Otherwise, you just created a file you can write to.</p><p>Most other options, as I mentioned, will potentially destroy the contents of your file by truncating it and you do not want that. It is like executing the command on a UNIX system - for example: <code class="literal">&gt; filename</code>
</p></div><div class="section" title="file_exists(), is_file(), and is_dir()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec41"/>file_exists(), is_file(), and is_dir()</h3></div></div></div><p>To avoid<a id="id501" class="indexterm"/> surprises, you <a id="id502" class="indexterm"/>may want to check whether a file you want to <a id="id503" class="indexterm"/>open exists.</p><div class="informalexample"><pre class="programlisting">&lt;?php
if (file_exists($filename)) {
echo "$filename exists";
}
else
{
echo "$filename nowhere to be found";
}
?&gt;</pre></div><p>The <code class="literal">file_exists()</code> function<a id="id504" class="indexterm"/> returns <code class="literal">TRUE</code> if <code class="literal">$filename</code> exists and <code class="literal">FALSE</code> otherwise. It does<a id="id505" class="indexterm"/> not tell us whether it is a file or directory. For that<a id="id506" class="indexterm"/> purpose, we have the functions <code class="literal">is_dir()</code> and <code class="literal">is_file()</code>.</p></div><div class="section" title="fread and fwrite"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec42"/>fread and fwrite</h3></div></div></div><p>Now, let's assume<a id="id507" class="indexterm"/> that we have files open and pointers that point to somewhere inside those files where we can read from and write<a id="id508" class="indexterm"/> to. For that purpose, we use <code class="literal">fread</code> and <code class="literal">fwrite</code>. Assume we have <code class="literal">$fpin</code> to read from and <code class="literal">$fpout</code> to write to; this would be a<a id="id509" class="indexterm"/> simple file copy piece of code, using these functions:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$filecontents = fread($fpin, filesize($filename));
$success = fwrite($fpout, $filecontents);
?&gt;</pre></div><p>The second argument of <code class="literal">fread</code> is used to specify how many bytes you want to read. Of course, we cut it short here and said: let's read the whole file at once. For that purpose, the <code class="literal">filesize()</code> function <a id="id510" class="indexterm"/>comes in handy. With <code class="literal">fwrite</code> you can use the number of bytes you want written as an optional third argument. We did not do this in our example, we simply used the string that contains the entire file as the second argument.</p></div><div class="section" title="One line at a time – fgets()"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec43"/>One line at a time – fgets()</h3></div></div></div><p>We used the two previous functions<a id="id511" class="indexterm"/> to read the contents of a file all in one chunk, and then wrote that chunk to another file. Many files we may use instead of a database will have lines of information<a id="id512" class="indexterm"/> organized as fixed length records that are nothing other than strings or numbers of a fixed length. Wouldn't it be nice if we could handle files line by? Well, we can. <code class="literal">fgets()</code> is a function that returns one line at a time:</p><div class="informalexample"><pre class="programlisting">&lt;?php
while ($line = fgets($fp)) {
/* do something with $line */
}
?&gt;</pre></div></div><div class="section" title="The printf family"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec44"/>The printf family</h3></div></div></div><p>The <code class="literal">printf</code> function is the one that gave me that <span class="emphasis"><em>long time no see</em></span> feeling in the, by-now notorious, six month class. It is <a id="id513" class="indexterm"/>wonderfully powerful, and if you master how to compose a good format string, you can create excellent structured<a id="id514" class="indexterm"/> output in just a few statements.</p><p>Unfortunately, you will probably discover that <code class="literal">printf</code>, the PHP version, is not going to be used a lot to produce HTML, because HTML is very far away from output of fields with a fixed length. First of all, subsequent spaces are stripped out, and by the time you see the output, the HTML tags are not shown either.</p><p>The instructor never used <code class="literal">printf</code> for two reasons - one of which is very valid. <code class="literal">printf</code> is a function, whereas<a id="id515" class="indexterm"/> <code class="literal">echo</code> is built in. So, most of the time, what you echo will be faster than what you <code class="literal">printf</code>.</p><p>So, why mention it at all? There are functions very similar to <code class="literal">printf</code> to read from or write to strings or files, and having <a id="id516" class="indexterm"/>an easy way to deal with a structured format is wickedly useful. They are: <code class="literal">sscanf</code>, <code class="literal">fscanf</code>, <code class="literal">sprintf</code>, and <code class="literal">fprintf</code>. What they all have in common is the use of a format string. First, we show you the syntax; next, we explain the format string itself.</p></div><div class="section" title="Syntax of printf family of functions"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec45"/>Syntax of printf family of functions</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">printf($format, $arg1, $arg2, ... );</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sprintf($string,$format,$arg1,$arg2, ...);</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">sscanf($string, $format, $arg1, $arg2, ...);</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">fprintf($fp, $format, $arg1, $arg2, ...);</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">fscanf($fp,$format, $arg1, $arg2, ...);</code></li></ul></div><p>In this syntax, <code class="literal">$fp</code> represents a file pointer that was previously created using <code class="literal">fopen()</code> and a <code class="literal">$string</code> variable to <a id="id517" class="indexterm"/>contain a string; <code class="literal">$arg1</code>, <code class="literal">$arg2</code> and so on, are variables to store the data that we retrieve, or hold the data that we want to use. <code class="literal">$format</code> holds the magic on how it is all going to be formatted:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$product ="Stereo receiver";
$price = 499;
printf("Item purchased: %20s - Price:%7.2\n", $product, $price);
?&gt;</pre></div><p>This will output:</p><div class="informalexample"><pre class="programlisting">Item purchased: Stereo receiver     - Price:0000499.00</pre></div><p>This makes the product name exactly 20 characters, the price 7 digits before, and 2 after the floating point. I know, that when displayed in a browser, these extra spaces will be reduced to just one, but if <code class="literal">fprintf</code> was used to write this to a file, and we repeat the same statement in a loop, we would end up with a file with all the lines nicely lined up. It is all contained by the strings with a <code class="literal">%</code> sign. Typically, you have one extra argument for every <code class="literal">%</code> string used. Here is a selection of what they can contain:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Format values</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%%</code>
</p>
</td><td style="text-align: left" valign="top">
<p>What if you need a <code class="literal">%</code> sign—use two, only one will be shown</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%b</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows the<a id="id518" class="indexterm"/> value as a binary number, that is, only zeroes and ones</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%c</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The character <a id="id519" class="indexterm"/>according to the ASCII value</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%d</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows the value as a decimal number</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%f</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Floating-point number</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%o</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Octal number</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%x</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Hexadecimal number (lowercase letters)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%X</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Hexadecimal number (uppercase letters)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">%s</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Treat the value as a string. You will use this the most, combined with additional format values, which are placed between the <code class="literal">%</code> and the letter (example <code class="literal">%.2f</code>):</p>
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">[0-9] (Specifies the minimum width held of to the variable value)</li><li class="listitem" style="list-style-type: disc">[0-9] (Specifies the number of decimal digits or maximum string length)</li></ul></div>
</td></tr></tbody></table></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Summary</h1></div></div></div><p>In this chapter, we introduced the PHP programming language and what it takes to get you up and running to use it in your web pages. That was exactly the focus of this chapter - not to give you an in-depth coverage of everything that the language can do, even in the context of web development. We did not address the object-oriented aspects of the language, nor did we cover website-specific things, such as cookies and sessions.</p><p>We immediately zoomed into what everyone would need in PHP. We ended the chapter with a discussion on how to exchange data between client and server and use files to store that data. The functions allow us to add structure to these files. There can be even more structure in a file if you use a format such as XML, which is very similar to HTML. There are cool PHP libraries to deal with those, such as <span class="strong"><strong>SimpleXML</strong></span>, which we will discuss in <a class="link" href="ch10.html" title="Chapter 10. XML and JSON">Chapter 10</a>, <span class="emphasis"><em>XML and JSON</em></span>.</p><p>Ultimately, you want to go beyond the use of files to hold your data and use a true database. The most commonly used database in the world of PHP-based web development is MySQL and that is the topic of our next chapter.</p></div></body></html>