<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;11.&#xA0;Internationalization and Localization" id="20R681-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11" class="calibre1"/>Chapter 11. Internationalization and Localization</h1></div></div></div><p class="calibre9">When developing modern web applications, we often find the need to ensure that our language is readable to users who speak and read languages different from our own. To help facilitate this, Yii2 provides built-in support for both internationalization (i18n) and localization (l10n). <span class="strong"><strong class="calibre2">Internationalization</strong></span> is the process of planning and implementing messages <a id="id598" class="calibre1"/>and views such that they can be easily adapted into<a id="id599" class="calibre1"/> other languages. On the other hand, <span class="strong"><strong class="calibre2">localization</strong></span> is the process of adapting our applications to a particular language or culture, and including things such as the look and feel of our application to match the accepted presentation of information to speakers of a given language or users in a given region or market. In this chapter, we'll discover how we can use Yii2's built-in features to translate and localize our applications into multiple languages.</p><div class="note" title="Note"><h3 class="title2"><a id="tip178" class="calibre1"/>Tip</h3><p class="calibre9">i18n and l10n are <a id="id600" class="calibre1"/>numeronyms, not acronyms. Internationalization<a id="id601" class="calibre1"/> is abbreviated to i18n because it begins with the letter "I", is followed by 18 more characters, and ends with the letter "N". Similarly, localization shortens to l10n because it starts with the letter "L", has 10 more letters, and then ends with the letter "N". These abbreviations simply exist to shorten the word and have no other meaning. In this chapter, we'll use both the full and abbreviated versions to refer to both words.</p></div></div>

<div class="book" title="Chapter&#xA0;11.&#xA0;Internationalization and Localization" id="20R681-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Configuring Yii2 and PHP"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch11lvl1sec62" class="calibre1"/>Configuring Yii2 and PHP</h1></div></div></div><p class="calibre9">Before we <a id="id602" class="calibre1"/>can<a id="id603" class="calibre1"/> start using Yii2's localization features, we first need to make sure the <code class="email">intl</code> PHP extension is installed. This extension is used to provide Yii2 with the majority of the i18n features, including Yii2's message and date formatters. While Yii2 has some built-in fallbacks in case this extension is not installed, it is highly recommended that you install it beforehand.</p></div></div>

<div class="book" title="Chapter&#xA0;11.&#xA0;Internationalization and Localization" id="20R681-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Configuring Yii2 and PHP">
<div class="book" title="The intl extension"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch11lvl2sec128" class="calibre1"/>The intl extension</h2></div></div></div><p class="calibre9">Many<a id="id604" class="calibre1"/> default PHP installations come with the <code class="email">intl</code> extension built into the PHP package, but many do not. Fortunately, there are several ways to check whether the <code class="email">intl</code> extension is installed. For those who prefer viewing this information in a web browser, simply create a blank PHP file in your webroot containing the following and scan the output to check whether the <code class="email">intl</code> extension exists and is enabled:</p><div class="note"><pre class="programlisting">
<code class="email">&lt;?php phpinfo();</code>
</pre></div><p class="calibre9">If you prefer using the command line, you can run the following command to check whether intl is installed with your PHP instance:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">php –m | grep intl</strong></span>
</pre></div><p class="calibre9">If the <code class="email">intl</code> extension does not appear in any output, you can either install it through your systems package manager (<code class="email">apt</code> or <code class="email">yum</code> depending upon your OS), or you can install it manually. Generally speaking, the extension can be compiled and installed manually through the <code class="email">pecl</code> command:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">sudo pecl install intl</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip179" class="calibre1"/>Tip</h3><p class="calibre9">If you're<a id="id605" class="calibre1"/> installing the <code class="email">intl</code> extension from the source, you'll need to make sure that you have the <code class="email">intl</code> library installed, preferably version 49 or higher. If your system has an outdated version of the <code class="email">intl</code> library, you can download and compile a newer version from <a class="calibre1" href="http://site.icu-project.org/download">http://site.icu-project.org/download</a>. Additionally, the time zone data shipped with your <code class="email">intl</code> library may be outdated. Ensure that you refer to the <code class="email">intl</code>
<a id="id606" class="calibre1"/> documentation for information on how to update your <code class="email">intl</code> time zone data at <a class="calibre1" href="http://userguide.icu-project.org/datetime/timezone#TOC-Updating-the-Time-Zone-Data">http://userguide.icu-project.org/datetime/timezone#TOC-Updating-the-Time-Zone-Data</a>.</p></div><p class="calibre9">After the compilation finishes, you can then add the following to your <code class="email">php.ini</code> configuration file:</p><div class="note"><pre class="programlisting">
<code class="email">extension=intl.so</code>
</pre></div><p class="calibre9">After restarting your web server and PHP process, you should see the <code class="email">intl</code> extension appear using one of the previously listed commands.</p><div class="note" title="Note"><h3 class="title2"><a id="tip180" class="calibre1"/>Tip</h3><p class="calibre9">More<a id="id607" class="calibre1"/> information on how to install the <code class="email">intl</code> extension can <a id="id608" class="calibre1"/>be found on the PHP manual page at <a class="calibre1" href="https://secure.php.net/manual/en/intl.installation.php">https://secure.php.net/manual/en/intl.installation.php</a>.</p></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="The application language" id="21PMQ1-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11lvl1sec63" class="calibre1"/>The application language</h1></div></div></div><p class="calibre9">Before <a id="id609" class="calibre1"/>we can start using Yii2's translation features, we need to define the application our language is written in. Application languages in Yii2 are defined by a unique ID consisting of a language ID as defined by the ISO-639 format and a region ID defined by the ISO-3166 format. As an example, <code class="email">en-US</code> represents English as the spoken language in the United States of America.</p><div class="note" title="Note"><h3 class="title2"><a id="tip181" class="calibre1"/>Tip</h3><p class="calibre9">Details <a id="id610" class="calibre1"/>on ISO-639 can be found at <a class="calibre1" href="http://www.loc.gov/standards/iso639-2/">http://www.loc.gov/standards/iso639-2/</a>, and details on IISO-3166 can be<a id="id611" class="calibre1"/> found at <a class="calibre1" href="https://www.iso.org/obp/ui/#search">https://www.iso.org/obp/ui/#search</a>.</p></div><p class="calibre9">Yii2 defines<a id="id612" class="calibre1"/> two language properties within our configuration file that we can define. The first <code class="email">sourceLanguage</code> property represents the language or locale our application is written in and generally does not change during the request life cycle of our application. The second, <code class="email">language</code>, represents the language or locale that our user is using, and it can be changed by the end user at any point in time (typically through the use of a <code class="email">language</code> selector widget placed somewhere on the page). Combined, these two configuration options allow us to inform Yii2 about how it should treat messages we wish to be translated. Within our <code class="email">config/web.php</code> or <code class="email">config/console.php</code> configuration files, these two options can be set as follows:</p><div class="note"><pre class="programlisting">return [
    'language' =&gt; 'ru-RU',
    'sourceLanguage' =&gt; 'en-US',
];</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip182" class="calibre1"/>Tip</h3><p class="calibre9">By default, Yii2 will set the <code class="email">sourceLanguage</code> property to <code class="email">en-US</code>.</p></div></div>

<div class="book" title="The application language" id="21PMQ1-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Programmatically setting the application language"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch11lvl2sec129" class="calibre1"/>Programmatically setting the application language</h2></div></div></div><p class="calibre9">If you're <a id="id613" class="calibre1"/>developing a multilingual site, rather than specifying a single default language, you may want to allow the user to select their language from a drop-down list and change your language programmatically. To do this, simply define the <code class="email">Yii::$app-&gt;language</code> property within your code with the language code of your choice.</p><p class="calibre9">When setting the language property programmatically, you'll typically want to store the user's language setting either with their user information or as a session variable. Additionally, you'll want to ensure that you apply the language setting before Yii2 begins processing your messages. A good place to set this would be early in your controller flow, such as in the <code class="email">init()</code> method of our controller.</p></div></div>

<div class="book" title="The application language" id="21PMQ1-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Dynamically setting the application language"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch11lvl2sec130" class="calibre1"/>Dynamically setting the application language</h2></div></div></div><p class="calibre9">In addition to<a id="id614" class="calibre1"/> manually setting the application language within our controller, we can also use the content negotiator filter (<code class="email">yii\filters\ContentNegotiator</code>) to determine the user's language from their <code class="email">Accept-Language</code> headers sent by their browser. To use the content negotiator filter, we simply need to add <code class="email">yii\filters\ContentNegotiator</code> to the <code class="email">bootstrap</code> section of your <code class="email">config/web.php</code> configuration file and specify the languages that we want to support automatically:</p><div class="note"><pre class="programlisting">return [
    // [...],
    'bootstrap' =&gt; [
        <span class="strong"><strong class="calibre2">[</strong></span>
<span class="strong"><strong class="calibre2">            'class' =&gt; 'yii\filters\ContentNegotiator',</strong></span>
<span class="strong"><strong class="calibre2">            'languages' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">                'en',</strong></span>
<span class="strong"><strong class="calibre2">                'de',</strong></span>
<span class="strong"><strong class="calibre2">            ],</strong></span>
<span class="strong"><strong class="calibre2">        ],</strong></span>
    ],
];</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip183" class="calibre1"/>Tip</h3><p class="calibre9">The languages property specifies which languages Yii2 will automatically set <code class="email">Yii::$app-&gt;language</code> to if they are present in the <code class="email">Accept-Language</code> headers. In the previous example, we only set the language to <code class="email">en</code> or <code class="email">de</code>. If a language other than the ones listed in our application configuration is present in our <code class="email">Accept-Language</code> headers, we'll default to the language specified in our <code class="email">sourceLanguage</code> property.</p></div><p class="calibre9">Rather than being set globally, we can also set a content negotiator within our controller's <code class="email">behaviors()</code> methods and specify the languages we want to support within that controller. This is <a id="id615" class="calibre1"/>beneficial when you have a module that may support more or different languages than your base application. Within our controllers, we can configure <code class="email">yii\filters\ContentNegotiator</code> as follows:</p><div class="note"><pre class="programlisting">public function behaviors()
{
    return [
        [
            'class' =&gt; 'yii\filters\ContentNegotiator',
            'languages' =&gt; [
                'en',
                'de',
            ],
        ],
    ];
}</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip184" class="calibre1"/>Tip</h3><p class="calibre9">This <code class="email">yii\filters\ContentNegotiator</code> path can provide more features than just setting the application language. For more information on the content negotiation<a id="id616" class="calibre1"/> filter, ensure that you check out the Yii2 documentation at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/yii-filters-contentnegotiator.html">http://www.yiiframework.com/doc-2.0/yii-filters-contentnegotiator.html</a>.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Message translations"><div class="book" id="22O7C2-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11lvl1sec64" class="calibre1"/>Message translations</h1></div></div></div><p class="calibre9">Yii2's message<a id="id617" class="calibre1"/> translation service translates a given text message from the source language to another by looking up the message to be translated in a message source file. If a message is found in a source for the target language, that string is returned instead of the original message. If the translated text is not found, Yii2 will return the original message.</p><p class="calibre9">The use of Yii2's message translation service is extremely straightforward. The first step toward translating messages in Yii2 is to wrap any and all messages you want translated in the <code class="email">Yii::t()</code> static method, which can be called as follows:</p><div class="note"><pre class="programlisting">Yii::t('app', 'My message to be translated');</pre></div><p class="calibre9">The first parameter indicates the category we want to store our messages in, and the second parameter <a id="id618" class="calibre1"/>indicates the message we wanted to be translated.</p></div>

<div class="book" title="Message translations">
<div class="book" title="Message sources"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch11lvl2sec131" class="calibre1"/>Message sources</h2></div></div></div><p class="calibre9">Before <a id="id619" class="calibre1"/>Yii2 can translate our messages, however, we first need to define a message source that will store our base messages and our translated message files. Yii2 provides three distinct message source options:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">yii\i18n\PhpMessageSource</code> stores message files in a key value array format</li><li class="listitem"><code class="email">yii\i18n/DbMessageSource</code> stores messages in a database table</li><li class="listitem"><code class="email">yii\i18n\GettextMessageSource</code> uses GNU Gettext MO or PO files to store translated messages</li></ul></div><p class="calibre9">The message source we wish to use can be declared in your application configuration file within the components section, as follows:</p><div class="note"><pre class="programlisting">&lt;?php return [
    // [...],
    'components' =&gt; [
        // [...],
        <span class="strong"><strong class="calibre2">'i18n' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">            'translations' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">                'app*' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">                    'class' =&gt; 'yii\i18n\PhpMessageSource',</strong></span>
<span class="strong"><strong class="calibre2">                ],</strong></span>
<span class="strong"><strong class="calibre2">            ],</strong></span>
        ],
    ]
];</pre></div><p class="calibre9">In the previous code block, the message source is provided by <code class="email">yii\i18n\PhpMessageSource</code>. The <code class="email">app*</code> pattern indicates that all messages that begin with <code class="email">app</code> should be handled by the specified message source. By default, Yii2 will store messages within the <code class="email">@app/messages</code> folder and will default the source language to <code class="email">en-US</code>; however, this behavior can be changed by specifying the <code class="email">basePath</code> and <code class="email">sourceLanguage</code> properties within the category block, respectively, as shown here:</p><div class="note"><pre class="programlisting">&lt;?php return [
    // [...],
    'components' =&gt; [
        // [...],
        'i18n' =&gt; [
            'translations' =&gt; [
                'app*' =&gt; [
                    'class' =&gt; 'yii\i18n\PhpMessageSource',
                    //'basePath' =&gt; '@app/messages',
                    //'sourceLanguage' =&gt; 'en-US',
                ],
            ],
        ],
    ]
];</pre></div><p class="calibre9">Furthermore, Yii2 <a id="id620" class="calibre1"/>will create message files with the same name as the category. This behavior can be altered by specifying the <code class="email">fileMap</code> property within the category configuration. Unless otherwise specified with the <code class="email">fileMap</code> property, all messages will be stored in <code class="email">@app/messages/&lt;language&gt;/&lt;category&gt;.php</code>. </p></div></div>

<div class="book" title="Message translations">
<div class="book" title="Default translations"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch11lvl2sec132" class="calibre1"/>Default translations</h2></div></div></div><p class="calibre9">Yii2 also<a id="id621" class="calibre1"/> allows us to create fallback messages for categories that don't match other translations. This can be set by declaring a <code class="email">*</code> category within our configuration file, as shown in the following example:</p><div class="note"><pre class="programlisting">&lt;?php return [
    // [...],
    'components' =&gt; [
        // [...],
        'i18n' =&gt; [
            'translations' =&gt; [
<span class="strong"><strong class="calibre2">                '*' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">                'class' =&gt; 'yii\i18n\PhpMessageSource'</strong></span>
<span class="strong"><strong class="calibre2">            ],</strong></span>
            ],
        ],
    ]
];</pre></div></div></div>

<div class="book" title="Message translations">
<div class="book" title="Framework messages"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch11lvl2sec133" class="calibre1"/>Framework messages</h2></div></div></div><p class="calibre9">In <a id="id622" class="calibre1"/>addition to specifying default messages, we can also modify the built-in messages that Yii2 provides natively. By default, Yii2 comes with several translations for things such as validation errors and other basic strings, all of which are stored within the <code class="email">yii</code> category. As there may be times where the default Yii messages may not be appropriate or accurate, you can redefine the default message by setting the <code class="email">yii</code> category within your configuration file:</p><div class="note"><pre class="programlisting">&lt;?php return [
    // [...],
    'components' =&gt; [
        // [...],
        'i18n' =&gt; [
            'translations' =&gt; [
                <span class="strong"><strong class="calibre2">'yii' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">                'class' =&gt; 'yii\i18n\PhpMessageSource',</strong></span>
<span class="strong"><strong class="calibre2">                'sourceLanguage' =&gt; 'en-US',</strong></span>
<span class="strong"><strong class="calibre2">                'basePath' =&gt; '@app/messages'</strong></span>
<span class="strong"><strong class="calibre2">            ],</strong></span>
            ],
        ],
    ]
];</pre></div></div></div>

<div class="book" title="Message translations">
<div class="book" title="Handling missing translations"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch11lvl2sec134" class="calibre1"/>Handling missing translations</h2></div></div></div><p class="calibre9">If a message <a id="id623" class="calibre1"/>translation is missing from the source file, Yii2 will display the original message content by default. While it's convenient to ensure that our site displays at least something, this behavior can be troublesome to debug and identify. Moreover, we may want to perform additional processing in the event of missing translations. Fortunately, we can accomplish this by creating an event handler for the <code class="email">missingTranslation</code> event triggered by <code class="email">yii\i18n\MessageSource</code>, as shown in the following example:</p><div class="note"><pre class="programlisting">&lt;?php return [
    // [...],
    'components' =&gt; [
        // [...],
        'i18n' =&gt; [
            'translations' =&gt; [
                'app*' =&gt; [
                    'class' =&gt; 'yii\i18n\PhpMessageSource',
                <span class="strong"><strong class="calibre2">'on missingTranslation' =&gt; ['app\components\TranslationEventHandler', 'handleMissingTranslation']</strong></span>
                ],
            ],
        ],
    ]
];</pre></div><p class="calibre9">As an<a id="id624" class="calibre1"/> example, we can write an event handler to output something notable:</p><div class="note"><pre class="programlisting">&lt;?php

namespace app\components;

use yii\i18n\MissingTranslationEvent;

class TranslationEventHandler
{
    public static function handleMissingTranslation(MissingTranslationEvent $event)
    {
        $event-&gt;translatedMessage = "@{$event-&gt;category}.{$event-&gt;message}-{$event-&gt;language}@";
    }
}</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip185" class="calibre1"/>Tip</h3><p class="calibre9">The event handler is only processed for messages in that category. If you wish to handle the same event for multiple categories, you must assign the event handler to each category or, alternatively, assign it to the <code class="email">*</code> category.</p></div></div></div>

<div class="book" title="Message translations">
<div class="book" title="Generating message files"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch11lvl2sec135" class="calibre1"/>Generating message files</h2></div></div></div><p class="calibre9">After <a id="id625" class="calibre1"/>configuring our message sources, we need to generate our message files. To do this, we will use the <code class="email">message</code> command:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The first step toward generating our messages files is to create a configuration file that will define what languages we want to support as well as specific paths for where the messages should be stored. This can be done by running the following command:<div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii message/config path/to/messagesconfig.php</strong></span>
</pre></div></li><li class="listitem" value="2">Depending<a id="id626" class="calibre1"/> upon the languages we previously specified in our web or console configuration file, this will generate something similar to the following:<div class="note"><pre class="programlisting">&lt;?php return [
    // string, required, root directory of all source files
    <span class="strong"><strong class="calibre2">'sourcePath' =&gt; __DIR__ . DIRECTORY_SEPARATOR . '..',</strong></span>
    
    // array, required, list of language codes that the extracted messages
    // should be translated to. For example, ['zh-CN', 'de'].
    
    <span class="strong"><strong class="calibre2">'languages' =&gt; ['de'],</strong></span>
    // string, the name of the function for translating messages.
    // Defaults to 'Yii::t'. This is used as a mark to find the messages to be
    // translated. You may use a string for single function name or an array for
    // multiple function names.
    <span class="strong"><strong class="calibre2">'translator' =&gt; 'Yii::t',</strong></span>
    
    // boolean, whether to sort messages by keys when merging new messages
    // with the existing ones. Defaults to false, which means the new (untranslated)
    // messages will be separated from the old (translated) ones.
    <span class="strong"><strong class="calibre2">'sort' =&gt; false,</strong></span>
    
    // boolean, whether to remove messages that no longer appear in the source code.
    // Defaults to false, which means each of these messages will be enclosed with a pair of '@@' marks.
<span class="strong"><strong class="calibre2">    'removeUnused' =&gt; false,</strong></span>
    
    // array, list of patterns that specify which files/directories should NOT be processed.
    // If empty or not set, all files/directories will be processed.
    // A path matches a pattern if it contains the pattern string at its end. For example,
    // '/a/b' will match all files and directories ending with '/a/b';
    // the '*.svn' will match all files and directories whose name ends with '.svn'.
    // and the '.svn' will match all files and directories named exactly '.svn'.
    // Note, the '/' characters in a pattern matches both '/' and '\'.
    // See helpers/FileHelper::findFiles() description for more details on pattern matching rules.
<span class="strong"><strong class="calibre2">    'only' =&gt; ['*.php'],</strong></span>

    // array, list of patterns that specify which files (not directories) should be processed.
    // If empty or not set, all files will be processed.
    // Please refer to "except" for details about the patterns.
    // If a file/directory matches both a pattern in "only" and "except", it will NOT be processed.
    <span class="strong"><strong class="calibre2">'except' =&gt; [</strong></span>
<span class="strong"><strong class="calibre2">        '.svn',</strong></span>
<span class="strong"><strong class="calibre2">        '.git',</strong></span>
<span class="strong"><strong class="calibre2">        '.gitignore',</strong></span>
<span class="strong"><strong class="calibre2">        '.gitkeep',</strong></span>
<span class="strong"><strong class="calibre2">        '.hgignore',</strong></span>
<span class="strong"><strong class="calibre2">        '.hgkeep',</strong></span>
<span class="strong"><strong class="calibre2">        '/messages',</strong></span>
<span class="strong"><strong class="calibre2">         '/vendor,</strong></span>
<span class="strong"><strong class="calibre2">    ],</strong></span>
    
    // 'php' output format is for saving messages to php files.
    <span class="strong"><strong class="calibre2">'format' =&gt; 'php',</strong></span>

    // Root directory containing message translations.
    <span class="strong"><strong class="calibre2">'messagePath' =&gt; __DIR__,</strong></span>
    
    // boolean, whether the message file should be overwritten with the merged messages
    <span class="strong"><strong class="calibre2">'overwrite' =&gt; true</strong></span>
];</pre></div></li><li class="listitem" value="3">For the most part, the default values provided by Yii2 in this file should be sufficient. The only values you should consider changing are the <code class="email">languages</code> option and the <code class="email">format</code> option. Ensure that you set these values appropriately before proceeding.</li><li class="listitem" value="4">After<a id="id627" class="calibre1"/> making the required changes to our <code class="email">messagesconfig.php</code> file, we can generate our message files by running the message command directly, as shown in the following example:<div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii message path/to/messagesconfig.php</strong></span>
</pre></div></li><li class="listitem" value="5">The <code class="email">message</code> command is an extremely powerful tool that allows us to quickly generate messages files that can be handed off to translators. Several options exist within the configuration file to make message translation easier. For example, the <code class="email">removedUnused</code> parameter can be set to <code class="email">true</code> to automatically remove strings from our message file if they are no longer listed in our source code. Additionally, by setting the <code class="email">overwrite</code> parameter to <code class="email">true</code>, we can run the <code class="email">message</code> command over and over again to regenerate our translation files.<div class="note1" title="Note"><h3 class="title2"><a id="tip186" class="calibre1"/>Tip</h3><p class="calibre9">Note that the <code class="email">message</code> command doesn't support all path aliases. When working with a messages file, it's recommended that you use absolute paths. Additionally, it's recommended that you store your <code class="email">messagesconfig.php</code> file within the <code class="email">messages/</code> directory of your application.</p></div></li></ol><div class="calibre15"/></div></div></div>

<div class="book" title="Message translations">
<div class="book" title="Message formatting"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch11lvl2sec136" class="calibre1"/>Message formatting</h2></div></div></div><p class="calibre9">When <a id="id628" class="calibre1"/>translating messages, you may want to inject variables or data from your models into the message. To do this, we simply need to embed a <code class="email">placeholder</code> within our message and then define what the <code class="email">placeholder</code> is as a parameter within the third property of our <code class="email">Yii::t()</code> method. For example, if we want to greet our user using their name, we can do that as follows:</p><div class="note"><pre class="programlisting">&lt;?php 
// $model = User::find(1)-&gt;one();
echo Yii::t('app', 'Good Morning {name}', [
    'name' =&gt; $model-&gt;first_name
]);</pre></div><p class="calibre9">As an alternative to named parameters, we can also use positional parameters, as shown in the following example:</p><div class="note"><pre class="programlisting">$price = 500;
$count = 2;
$subtotal = 1000;
echo \Yii::t('app', 'Price: ${0}, Count: {1}, Subtotal: ${2}', [
    $price, 
    $count, 
    $subtotal
]);</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip187" class="calibre1"/>Tip</h3><p class="calibre9">Yii2 also <a id="id629" class="calibre1"/>supports parameter formatting for numbers, currency, dates, times, original, and plural data. More information<a id="id630" class="calibre1"/> can be found on the Yii2 API at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/yii-i18n-formatter.html">http://www.yiiframework.com/doc-2.0/yii-i18n-formatter.html</a> and under the parameter formatting section of the Yii2 guide at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html#parameter-formatting">http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html#parameter-formatting</a>.</p></div></div></div>
<div class="book" title="Viewing file translations" id="23MNU1-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11lvl1sec65" class="calibre1"/>Viewing file translations</h1></div></div></div><p class="calibre9">As an<a id="id631" class="calibre1"/> alternative to translating individual messages, we can also translate entire view files by saving a translated view file within the subdirectory of our <code class="email">views</code> folder. As an example, supposing that we had a view script located at <code class="email">views/site/login.php</code>, we could create a Spanish view file for <code class="email">es-MX</code> by placing a translated message file in <code class="email">views/site/es-MX/login.php</code>. Assuming that our target and source language is appropriately set, Yii2 will automatically render the translated file instead of the base file when our target language is set to <code class="email">es-MX</code>.</p><div class="note" title="Note"><h3 class="title2"><a id="tip188" class="calibre1"/>Tip</h3><p class="calibre9">Note that if the source and target language are the same, the original view will be rendered regardless of the existence of a translated view file.</p><p class="calibre9">Additionally, the use of view file translations doesn't follow the DRY pattern we've emphasized throughout this book. Also, handing off complete HTML files with PHP code to your translators may make the translation of these files difficult, as the translation industry is based upon string translations rather than strings within code translations. To keep your application DRY and avoid any issues that may arise during the translation process, it is highly recommended that you use the previously mentioned message translation method rather than view file translations.</p></div></div>
<div class="book" title="Module translations" id="24L8G1-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11lvl1sec66" class="calibre1"/>Module translations</h1></div></div></div><p class="calibre9">As separate<a id="id632" class="calibre1"/> entities, modules should contain their own message files separate from your application message files. The recommended way to use messages within modules is as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Within the <code class="email">init()</code> method of your module, define a new translation section for your module:<div class="note"><pre class="programlisting">parent::init();Yii::$app-&gt;i18n-&gt;translations['modules/mymodule*'] = [
    'class' =&gt; 'yii\i18n\PhpMessageSource',
    'sourceLanguage' =&gt; 'en-US',
    'basePath' =&gt; '@app/modules/mymodule/messages'
];</pre></div></li><li class="listitem" value="2">Create a static method wrapper for <code class="email">Yii::t()</code>:<div class="note"><pre class="programlisting">public static function t($category, $message, $params = [], $language = null)
{
    return Yii::t('modules/mymodule/' . $category, $message, $params, $language);
}</pre></div></li><li class="listitem" value="3">Finally, create a separate message configuration file within the <code class="email">messages/</code> directory of your module that specifies the translator to be<code class="email"> &lt;ModuleName&gt;::t</code>:<div class="note"><pre class="programlisting">&lt;?php return [
    'sourcePath' =&gt; __DIR__ . DIRECTORY_SEPARATOR . '..',
    'languages' =&gt; ['de'],
    <code class="email">'translator' =&gt; 'MyModule::t',</code>
    'sort' =&gt; false,
    'removeUnused' =&gt; false,
    'only' =&gt; ['*.php'],
    'except' =&gt; [
        '.svn',
        '.git',
        '.gitignore',
        '.gitkeep',
        '.hgignore',
        '.hgkeep',
        '/messages',
        '/vendor'
    ],
    'format' =&gt; 'php',
    'messagePath' =&gt; __DIR__,
    'overwrite' =&gt; true
];</pre></div></li></ol><div class="calibre15"/></div><p class="calibre9">Messages <a id="id633" class="calibre1"/>within our module can then be translated by calling <code class="email">MyModule::t()</code>. Additionally, translated message files can be generated by running the following command:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii message modules/mymodule/messages/messages.php</strong></span>
</pre></div></div>
<div class="book" title="Widget translations" id="25JP21-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11lvl1sec67" class="calibre1"/>Widget translations</h1></div></div></div><p class="calibre9">In a<a id="id634" class="calibre1"/> similar vein, widgets can also have their own message translation files by following the same process outlined for modules. Using our <code class="email">GreetingWidget</code> class we created in <a class="calibre1" title="Chapter 5. Modules, Widgets, and Helpers" href="part0035_split_000.html#11C3M2-ad3e09b384df46aea690d9c8897d5fe7">Chapter 5</a>, <span class="strong"><em class="calibre13">Modules, Widgets, and Helpers</em></span> would look as follows:</p><div class="note"><pre class="programlisting">&lt;?php
namespace app\components;

use yii\base\Widget;
use yii\helpers\Html;

use Yii;
class GreetingWidget extends Widget
{
    public $name = null;
    
    public $greeting;
    
    public function init()
    {
        parent::init();
        
        <span class="strong"><strong class="calibre2">Yii::$app-&gt;i18n-&gt;translations['widgets/GreetingWidget*'] = [</strong></span>
<span class="strong"><strong class="calibre2">            'class' =&gt; 'yii\i18n\PhpMessageSource',</strong></span>
<span class="strong"><strong class="calibre2">            'sourceLanguage' =&gt; 'en-US',</strong></span>
<span class="strong"><strong class="calibre2">            'basePath' =&gt; '@app/components/widgets/GreetingWidget'</strong></span>
<span class="strong"><strong class="calibre2">        ];</strong></span>
        
        $hour = date('G');
        
        if ( $hour &gt;= 5 &amp;&amp; $hour &lt;= 11 )
           $this-&gt;greeting = <code class="email">GreetingWidget::t("Good Morning");</code>
        else if ( $hour &gt;= 12 &amp;&amp; $hour &lt;= 18 )
           $this-&gt;greeting = <code class="email">GreetingWidget::t("Good Afternoon");</code>
        else if ( $hour &gt;= 19 || $hours &lt;= 4 )
           $this-&gt;greeting <code class="email">= GreetingWidget::t("Good Evening");</code>
    }
    
    public function run()
    {
        if ($this-&gt;name === null)
            return HTML::encode($this-&gt;greeting);
        else
            return HTML::encode($this-&gt;greeting . ', ' . $this-&gt;name);
    }
    
    <span class="strong"><strong class="calibre2">public static function t($category, $message, $params = [], $language = null)</strong></span>
<span class="strong"><strong class="calibre2">    {</strong></span>
<span class="strong"><strong class="calibre2">        return Yii::t('widgets/GreetingWidget/' . $category, $message, $params, $language);</strong></span>
<span class="strong"><strong class="calibre2">    }</strong></span>
} </pre></div><p class="calibre9">Consequently, a<a id="id635" class="calibre1"/> call to <code class="email">GreetingWidget::t()</code> will render a translated message that's specific to our widget. Additionally, because widgets support view rendering, they can also support completely translated view files by following the same process outlined previously.</p></div>
<div class="book" title="Summary" id="26I9K1-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch11lvl1sec68" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">Yii2 provides powerful tools to support internationalization and localization within our application. In this chapter, we covered how to generate and store message source files, how to generate message and view translations, and how to support translations within modules and widgets. In the next chapter, we'll cover Yii2's performance feature, as well as explore several built-in security features that Yii2 offers.</p></div></body></html>