<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Custom Module Development"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Custom Module Development</h1></div></div></div><p><span class="emphasis"><em>We have setup our development environment in <a class="link" href="ch01.html" title="Chapter 1. Setting Up a Drupal Development Environment">Chapter 1</a>, <span class="emphasis"><em>Setting Up a Drupal Development Environment</em></span>. Now let's get started and create a new content type and create a basic custom module to change one of the fields on our content type. We will also explore the concept of test driven development as good programming practice.</em></span></p><p>In this chapter, we will learn about the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Defining a custom content type (Recipe)</li><li class="listitem" style="list-style-type: disc">Basics of object-oriented programming in Drupal 8</li><li class="listitem" style="list-style-type: disc">Introduction of Symfony with Drupal 8</li><li class="listitem" style="list-style-type: disc">Basics of Drupal 8 module development</li><li class="listitem" style="list-style-type: disc">Field formatter API</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Test-driven development</strong></span> (<span class="strong"><strong>TDD</strong></span>)</li><li class="listitem" style="list-style-type: disc">Writing and running functional tests for custom module functionality using an inbuilt PHPUnit test framework</li><li class="listitem" style="list-style-type: disc">Configuring and running unit tests with code coverage reports from within the PHPStorm IDE</li></ul></div><div class="section" title="Creating custom Recipe content type"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec33"/>Creating custom Recipe content type</h1></div></div></div><p>In the <a class="indexterm" id="id108"/>previous chapter, we installed Drupal 8 on our system. Now we are going to create our custom recipe content type. Before that, we will discuss five new fields added in Drupal 8:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Date</strong></span>: The <span class="strong"><strong>Date</strong></span> field is the <span class="strong"><strong>Date</strong></span> module in Drupal 7. We can choose to record the <span class="strong"><strong>Date and time</strong></span> or <span class="strong"><strong>Date only</strong></span> as options.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Email</strong></span>: The <span class="strong"><strong>Date</strong></span> module is simple but the <span class="strong"><strong>Email</strong></span> field is even simpler. There are no settings at all for the <span class="strong"><strong>Email</strong></span> field.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Link</strong></span>: The <span class="strong"><strong>Link</strong></span> field allows both internal and external links, along with a link text option.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Telephone</strong></span>: The <span class="strong"><strong>Telephone</strong></span> field is disabled by default in Drupal 8, so we need to enable the module to use it. It has no settings. It really is just a text field that adds <code class="literal">&lt;a href="tel:</code> to turn the text into a telephone link.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Reference</strong></span>: The <span class="strong"><strong>Reference</strong></span> module is the most powerful field. We can link to anything that's an entity, which means we can link to comments, content, blocks, files, terms, and users.</li></ul></div><p>Now login <a class="indexterm" id="id109"/>to your Drupal 8 website. You should see a new admin toolbar.</p></div></div>
<div class="section" title="Time for action &#x2013; creating custom content type"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec34"/>Time for action – creating custom content type</h1></div></div></div><p>Let's create a <a class="indexterm" id="id110"/>custom content type by following these next steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Structure</strong></span> in the admin toolbar, and then click on <span class="strong"><strong>Content types</strong></span>.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_01.jpg"/></div></li><li class="listitem">On the <span class="strong"><strong>Content types</strong></span> screen, click on the <span class="strong"><strong>Add content type</strong></span> link.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_02.jpg"/></div></li><li class="listitem">Write <code class="literal">Recipe</code> in the <span class="strong"><strong>Name</strong></span> text field.</li><li class="listitem">In the <a class="indexterm" id="id111"/>description, enter this text <code class="literal">Simple recipe content type based on the schema.org base HTML5 Microdata schema for Recipes at: http://schema.org/Recipe/</code>.</li><li class="listitem">For the <span class="strong"><strong>Title</strong></span> field label, enter <code class="literal">name</code>.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_03.jpg"/></div></li><li class="listitem">Click on the <span class="strong"><strong>Save and manage fields</strong></span> button. For now we will go with the default content type configuration for everything else.</li><li class="listitem">Next, delete the <span class="strong"><strong>Body</strong></span> field that is automatically added to our content type, by clicking on the <span class="strong"><strong>Delete</strong></span> link, and then confirming by clicking on the <span class="strong"><strong>Delete</strong></span> button<a class="indexterm" id="id112"/> on the next screen.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_04.jpg"/></div></li><li class="listitem">Now, we will add some new fields to our Recipe content type. We will use the Recipe schema property names as our field names. The first property listed in the table at <code class="literal">http://schema.org/Recipe/</code> is <span class="strong"><strong>description</strong></span>. Once you click on the <span class="strong"><strong>Add Field</strong></span> button, you will get the option <span class="strong"><strong>Add a new field</strong></span> select box. In that you need to select <span class="strong"><strong>Text (formatted, long, with summary</strong></span>). On the label, you need to write <code class="literal">description</code>.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_05.jpg"/></div></li><li class="listitem">Then click on <span class="strong"><strong>Save and continue</strong></span>. On the next screen, set <span class="strong"><strong>Allowed number of values</strong></span> limited to <code class="literal">1</code>, and click on the <span class="strong"><strong>Save field settings</strong></span> button.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_06.jpg"/></div></li><li class="listitem">On<a class="indexterm" id="id113"/> the <span class="strong"><strong>description settings for Recipe</strong></span> page, enter <code class="literal">A short description of the item</code> as <span class="strong"><strong>Help text</strong></span>. Accept the rest of the default settings, and then click on the <span class="strong"><strong>Save settings</strong></span> button at the bottom of the page:<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_07.jpg"/></div></li><li class="listitem">Now we will move on to the image property. We are going to use an existing field for this property. In the <span class="strong"><strong>Re-use an existing field</strong></span> section, select <span class="strong"><strong>Image: field_image (Image)</strong></span>.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_08.jpg"/></div></li><li class="listitem">Click <a class="indexterm" id="id114"/>on the <span class="strong"><strong>Save and continue</strong></span> button to accept the default settings on the <span class="strong"><strong>FIELD SETTINGS</strong></span> page.</li><li class="listitem">On the next page, click on the <span class="strong"><strong>Save settings</strong></span> button to accept the <span class="strong"><strong>Image</strong></span> settings for Recipe and <span class="strong"><strong>IMAGE FIELD SETTINGS</strong></span>.</li><li class="listitem">The <span class="strong"><strong>DatePublished</strong></span> and <span class="strong"><strong>Author</strong></span> properties will be captured by the core Drupal node properties. We will skip the rest of the <span class="strong"><strong>Properties from CreativeWork</strong></span> for now.</li><li class="listitem">Now, add a new number field <code class="literal">cookTime</code>, <span class="strong"><strong>Label</strong></span> as <code class="literal">cookTime</code> field type as <span class="strong"><strong>Number(integer)</strong></span> from the dropdown.</li><li class="listitem">Click on the <span class="strong"><strong>Save and continue</strong></span> button to accept the default settings on the <span class="strong"><strong>FIELD SETTINGS</strong></span> page.</li><li class="listitem">On the next page, enter <code class="literal">The time it takes to actually cook the dish in minutes.</code> as the <span class="strong"><strong>Help text</strong></span>. Enter <code class="literal">minute|minutes</code> as the <span class="strong"><strong>Suffix</strong></span> under the <span class="strong"><strong>cookTime settings for Recipe</strong></span> page, and click on the <span class="strong"><strong>Save settings</strong></span> button.<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_09.jpg"/></div></li><li class="listitem">Along <a class="indexterm" id="id115"/>with <span class="strong"><strong>cookingMethod</strong></span>, we will also skip the <span class="strong"><strong>nutrition</strong></span>, <span class="strong"><strong>recipeCategory</strong></span>, <span class="strong"><strong>recipeCuisine</strong></span>, and <span class="strong"><strong>totalTime</strong></span> properties for now. We will add these properties later in the book.</li><li class="listitem">For the <span class="strong"><strong>ingredients</strong></span> property, the settings will be <span class="strong"><strong>label: ingredients</strong></span> from the <span class="strong"><strong>Add a new field</strong></span> dropdown you can select a <span class="strong"><strong>Field type : Text (plain)</strong></span>. Click on the <span class="strong"><strong>Save and continue</strong></span> button. On the next screen, accept the default setting of 255 for maximum length and the <span class="strong"><strong>Allowed number of values</strong></span> as <span class="strong"><strong>Unlimited</strong></span>, then click on <span class="strong"><strong>Save field settings</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>ingredients settings for Recipe</strong></span> page, enter <code class="literal">An ingredient used in the recipe</code> as the <span class="strong"><strong>Help text</strong></span>. Accept the rest of the default settings, and click on the <span class="strong"><strong>Save settings</strong></span> button at the bottom of the page.</li><li class="listitem">For the <span class="strong"><strong>prepTime</strong></span> property, the settings will be <span class="strong"><strong>label: prepTime</strong></span> and from the <span class="strong"><strong>Add a new field</strong></span> dropdown you can select a <span class="strong"><strong>Field type: Number(integer)</strong></span>.Click on the <span class="strong"><strong>Save and continue</strong></span> button to accept the default settings on the <span class="strong"><strong>FIELD SETTINGS</strong></span> page. On the next page, enter the length of time it takes to prepare the recipe in minutes as the <span class="strong"><strong>Help text</strong></span>, enter <code class="literal">minute|minute</code> as the <span class="strong"><strong>Suffix</strong></span> under the <span class="strong"><strong>prepTime settings for Recipe</strong></span> page, and then click on the <span class="strong"><strong>Save settings</strong></span> button.</li><li class="listitem">Next <a class="indexterm" id="id116"/>add the <span class="strong"><strong>recipeInstructions</strong></span> property. Click on the <span class="strong"><strong>Add field</strong></span> button. In the next screen, select <span class="strong"><strong>Field type</strong></span> as <span class="strong"><strong>Text(formatted,long)</strong></span> and <span class="strong"><strong>Label</strong></span> as <span class="strong"><strong>recipeInstructions</strong></span>. Then click on the <span class="strong"><strong>Save and continue</strong></span> button. On the next page, leave all the settings as default and click on the <span class="strong"><strong>Save</strong></span> button. In the next settings page, enter <code class="literal">The steps to make the dish.</code> as the <span class="strong"><strong>Help text</strong></span> and leave rest of the settings, and click on the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">For the <span class="strong"><strong>recipeYield</strong></span> property, the settings will be <span class="strong"><strong>label: recipeYield</strong></span> from the <span class="strong"><strong>Add a new field</strong></span> dropdown you can select a <span class="strong"><strong>Field type : Text(plain)</strong></span>. Click on the <span class="strong"><strong>Save and continue</strong></span> button. On the next screen, accept the default setting of 255 for <span class="strong"><strong>Maximum length</strong></span> and the <span class="strong"><strong>Allowed number of values</strong></span> as <span class="strong"><strong>Limited</strong></span> to <span class="strong"><strong>1</strong></span> then click on <span class="strong"><strong>Save field settings</strong></span>.</li><li class="listitem">On the <span class="strong"><strong>recipeYield settings for Recipe</strong></span> page, enter <code class="literal">The quantity produced by the recipe (for example, number of people served, number of servings, and so on).</code> as the <span class="strong"><strong>Help text</strong></span>. Accept the rest of the default settings, and click on the <span class="strong"><strong>Save settings</strong></span> button at the bottom of the page.</li><li class="listitem">You should now have a <span class="strong"><strong>Manage fields</strong></span> screen for our Recipe content type that looks similar to the following screenshot:<div class="mediaobject"><img alt="Time for action – creating custom content type" src="graphics/4659_02_10.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>You created the new Recipe content type and added new fields.</p></div></div>
<div class="section" title="Time for action &#x2013; adding a new recipe"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec35"/>Time for action – adding a new recipe</h1></div></div></div><p>Now<a class="indexterm" id="id117"/> that we have created the new recipe content type and modified its fields, let's create a new recipe by clicking on the <span class="strong"><strong>Add content</strong></span> link in the shortcut bar, and then click on the link for Recipe.</p><p>Go to the path <span class="strong"><strong>Manage</strong></span> | <span class="strong"><strong>Content</strong></span> and click on the <span class="strong"><strong>Add content</strong></span> button, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Time for action – adding a new recipe" src="graphics/4659_02_11.jpg"/></div><p>Here is <a class="indexterm" id="id118"/>my recipe for Awesome Sauce that you may use, but you are welcome to add any recipe you like:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>name</strong></span>: <code class="literal">Awesome Sauce</code></li><li class="listitem"><span class="strong"><strong>description</strong></span>: <code class="literal">A deliciously sweet and spicy sauce that makes everything you put it on that much awesome. A little goes a long way...</code></li><li class="listitem"><span class="strong"><strong>ingredients</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">One ghost pepper (optional)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Two habanera peppers</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Three Thai peppers</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Four jalapeno peppers</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Four garlic cloves</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Three cups of rice vinegar</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">One tea spoon of fish sauce</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">One cup of sugar</code></li></ul></div></li><li class="listitem"><span class="strong"><strong>recipeInstructions</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">1.  Remove the stems from the peppers.</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">2.  Add the peppers and garlic to a food processor, and blend until pureed.</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">3.  Add vinegar, sugar, fish sauce, and puree to a small saucepan, and bring to a simmer over low heat.</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">4.  Simmer sauce for 20 to 30 minutes, until the sugar has completely dissolved.</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">5.  Remove the saucepan from the burner and let it stand for 10 minutes.</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">6.  Your Awesome Sauce is ready to serve, or it can be refrigerated for up to three weeks.</code></li></ul></div><p>Thai <a class="indexterm" id="id119"/>peppers and fish sauce are typically available in most Asian markets. Ghost peppers are generally considered to be the hottest pepper in the world and may be left out for those who have a little less tolerance for heat, or if you aren't able to find them.</p></li><li class="listitem"><span class="strong"><strong>Yield</strong></span>: <code class="literal">12 servings</code></li><li class="listitem"><span class="strong"><strong>prepTime</strong></span>: <span class="strong"><strong>10 minutes</strong></span></li><li class="listitem"><span class="strong"><strong>cookTime</strong></span>: <span class="strong"><strong>30 minutes</strong></span><div class="mediaobject"><img alt="Time for action – adding a new recipe" src="graphics/4659_02_12.jpg"/></div></li></ol></div><p>When you <a class="indexterm" id="id120"/>are done, save it to view your new recipe page.</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We added our own recipe to the site.</p></div><div class="section" title="OOP concepts in Drupal"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>OOP concepts in Drupal</h2></div></div></div><p>Before we <a class="indexterm" id="id121"/>dive into developing our first custom module, let's understand the basics of the modern <a class="indexterm" id="id122"/>
<span class="strong"><strong>object-oriented programming</strong></span> (<span class="strong"><strong>OOP</strong></span>) approach which has been adopted in Drupal 8 to make it more familiar for developers using other pure PHP frameworks. The OOP design patterns have been used to implement a variety of Drupal concepts, such as fields, views, entities, and nodes.</p><p>Although OOP comes with a steep learning curve that includes mastering key programming techniques such as inheritance and polymorphism, it has been found to be easier to extend, refactor, and maintain in the long run when compared to the procedural programs. This lets you focus on the programming part instead of wasting time on maintenance issues. The Dependency Injection is one of the OOP design patterns that has been used extensively in Drupal 8. A basic understanding of this concept is crucial to gain access to and make use of some core APIs. Here they are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Objects</strong></span>: An <span class="strong"><strong>object</strong></span> is<a class="indexterm" id="id123"/> an individual instance of the<a class="indexterm" id="id124"/> data structure defined by a class. A class is defined once and then you make an object to belong to a class. In other words, a class can be represented as a type of object. It is a blueprint from which you can create an individual object. A class is composed of three primary components: attributes, name, and operations. Here is a small PHP example:<div class="informalexample"><pre class="programlisting">&lt;?php
class foo
{
    function call_foo()
    {
        echo "Calling foo."; 
   }
}
$bar = new foo;
$bar-&gt;call_foo();
?&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Abstraction</strong></span>: One<a class="indexterm" id="id125"/> of the core principles in OOP, <span class="strong"><strong>abstraction</strong></span> <a class="indexterm" id="id126"/>refers to the representation of any type of data in which you can keep the implemented details abstracted or hidden. It allows you to write code that works seamlessly with abstract data structures such as lists, arrays, and other data types. As the code remains unchanged while you work with different data types, you can write a new data type and make it work with a program without changing it. Here is a small PHP example:<div class="informalexample"><pre class="programlisting">&lt;?php
abstract class AbstractClass
{
    // Force Extending class to define this method
    abstract protected function getVal();
    abstract protected function prefixVal($prefix);

    // Common method
    public function printOut() {
        print $this-&gt;getVal() . "\n";
    }
}

class ConcreteClass1 extends AbstractClass
{
    protected function getVal() {
        return "ConcreteClass1";
    }

    public function prefixVal($prefix) {
        return "{$prefix}ConcreteClass1";
    }
}


$class1 = new ConcreteClass1;
$class1-&gt;printOut();
echo $class1-&gt;prefixVal('FOO_') ."\n";
?&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Encapsulation</strong></span>: Also<a class="indexterm" id="id127"/> synonymous for information hiding, encapsulation is basically the amalgamation of all the <a class="indexterm" id="id128"/>resources that are needed for an object to function, including the methods and the data. This process is carried out by creating classes that help you expose the public methods and properties. A class is seen as a capsule or a container that encapsulates the attributes and the properties along with a set of methods in order to provide indented functionalities to other classes. Here is a small PHP example:<div class="informalexample"><pre class="programlisting">&lt;?php
class Application {
     private static $_user;
     public function User( ) {
          if( $this-&gt;_user == null ) {
               $this-&gt;_user = new UserData();
          }
          return $this-&gt;_user;
     }
}

class UserData {
     private $_name;
     public function __construct() {
          $this-&gt;_name = "Krishna kanth";
     }
     public function GetUserName() {
          return $this-&gt;_name;
     }
}
$app = new Application();
echo $app-&gt;UserData()-&gt;GetUserName();
?&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Polymorphism</strong></span>: Polymorphism<a class="indexterm" id="id129"/> derives its <a class="indexterm" id="id130"/>name from <span class="emphasis"><em>multiple shapes</em></span> and refers to the function of requesting the same operations that can be performed by different types of things. There are three major techniques that can be used to achieve polymorphism: method overloading, method overriding, and operator overloading. Here is a small PHP example:<p>The content of file <code class="literal">ShpeInterface.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Create Shape interace with calculateArea() method.
interface Shape {
  public function calculateArea();
}
?&gt;</pre></div><p>The content of file <code class="literal">Circle.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
require ShapeInterface.php;

// Create Circle class that implement Shape interface.
class Circle implements Shape {
  private $radius;
   
  public function __construct($radius)
  {
    $this -&gt; radius = $radius;
  }
  
  // calcArea calculates the area of circles 
  public function calculateArea()
  {
    return $this -&gt; radius * $this -&gt; radius * pi();
  }
}
?&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Inheritance</strong></span>: You can create a new class from an existing class by extending it, and this process is known <a class="indexterm" id="id131"/>as <span class="strong"><strong>inheritance</strong></span>. One <a class="indexterm" id="id132"/>of the key relationships used among objects is specialization, which is implemented using the principle of inheritance. Here is a small PHP example:<div class="informalexample"><pre class="programlisting">&lt;?php
// Declare the interface 'iTemplate'
interface iTemplate
{
    public function setVariable($name, $var);
    public function getHtml($template);
}

// Implement the interface
// This will work
class Template implements iTemplate
{
    private $vars = array();
  
    public function setVariable($name, $var)
    {
        $this-&gt;vars[$name] = $var;
    }
  
    public function getHtml($template)
    {
        foreach($this-&gt;vars as $name =&gt; $value) {
            $template = str_replace('{' . $name . '}', $value, $template);
        }
 
        return $template;
    }
}

?&gt;</pre></div></li></ul></div><p>Now we will see the preceding concepts in action while developing our new custom module.</p></div></div>
<div class="section" title="Time for action &#x2013; developing a custom module in Drupal 8"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec36"/>Time for action – developing a custom module in Drupal 8</h1></div></div></div><p>Here we<a class="indexterm" id="id133"/> are going to create a custom module which will print <code class="literal">Hello World</code> in a page under the path: <code class="literal">mypage/page</code>. Follow the basics steps involved in the custom module development in Drupal 8. Before that, we will discuss the Drupal root directory structure.</p><div class="mediaobject"><img alt="Time for action – developing a custom module in Drupal 8" src="graphics/4659_02_13.jpg"/></div><p>Look at the preceding screenshot. We will see what each directory contains:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/core</code>: All the <a class="indexterm" id="id134"/>files provided by core that don't have an explicit reason to be in the / directory.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/modules</code>: The <a class="indexterm" id="id135"/>directory into which all the custom and contrib modules go. Splitting this up into the sub-directories contrib and custom can make it easier to keep track of the modules.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/profiles</code>: This <a class="indexterm" id="id136"/>folder contains contributed and custom profiles.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/themes</code>: - contributed <a class="indexterm" id="id137"/>and custom (sub)themes.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/sites/[domain OR default]/{modules,themes}</code>: Site specific modules and themes <a class="indexterm" id="id138"/>can be moved into these directories to avoid them showing up on every site.</li><li class="listitem" style="list-style-type: disc"><code class="literal">sites/[domain OR default]/files</code>: Site<a class="indexterm" id="id139"/> specific files tend to go here. This could be files uploaded by the users, such as images, but also includes the configuration, active as well as staged config. The configuration is read and written by Drupal, and should have the minimal amount of privileges required for the web server, and the only the web server, to read and modify them.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/vendor</code>: This folder <a class="indexterm" id="id140"/>contains all the backend libraries that Drupal Core depends on.</li></ul></div><p>Now, let's begin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's <a class="indexterm" id="id141"/>start by adding your module folder name. Unlike Drupal 7 where we used to keep the modules folder inside <code class="literal">site/all</code>, in Drupal 8 we have to keep our custom or contributed modules within the module available under the root directory<div class="informalexample"><pre class="programlisting">modules/contrib/
modules/custom/</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>We need to use different file structures as follows in case of multisite configuration.</p><div class="informalexample"><pre class="programlisting">sites/ site_name_a/modules/
sites/ site_name_b/modules/</pre></div></div></div><p>Let's name our module <code class="literal">d8dev</code> and create a folder name <code class="literal">d8dev</code> under the <code class="literal">modules/custom</code> directory.</p></li><li class="listitem">Create the <code class="literal">.info.yml</code> file. In Drupal 7, we used to have the <code class="literal">.info</code> file. This has been changed to <code class="literal">.info.yml</code> in Drupal 8. Now instead of the <code class="literal">.info</code> parser, we use the Symfony YML component. And the new extension <code class="literal">.info.yml</code> applies to modules, themes, and profiles.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Drupal uses some of the Symfony components for this version. By using the HTTP Kernel component, Drupal and Symfony projects became more interoperable. We will be able to easily integrate custom Symfony applications with Drupal and vice versa. You can learn more about the Symfony structure and how Drupal uses it. Follow this link <a class="ulink" href="http://symfony.com/projects/drupal">http://symfony.com/projects/drupal</a>.</p></div></div><p><span class="strong"><strong>YAML</strong></span>: Similar<a class="indexterm" id="id142"/> to PHP, YML is a simple language and there are syntaxes for simple types; for example Integers, Strings, Floats, or Booleans.</p><p>In Drupal 8, the new <code class="literal">info.yml</code> files are required to update Drupal core about different modules, themes, or any install profile. This also provides additional criteria to manage modules along with version compatibility.</p></li><li class="listitem">Create a <code class="literal">d8dev.info.yml</code> file under the <code class="literal">d8dev</code> directory we created in Step 1:<div class="informalexample"><pre class="programlisting">name: Drupal 8 custom module d8dev
type: module
description: 'Example for Drupal 8 modules.'
package: Custom
version: 8.1
core: 8.x</pre></div><p>What have we added in <code class="literal">d8dev.info.yml</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: As is obvious, the <code class="literal">name</code> field is required for our module as the identifier and will be displayed on the <code class="literal">Module</code> page. We should follow the convention of capitalized and Symantec names.</li><li class="listitem" style="list-style-type: disc"><code class="literal">description</code>: We have added a short one-liner description to help acquaint the administrator with what this module does.</li><li class="listitem" style="list-style-type: disc"><code class="literal">package</code>: We should use the name of the package if this is going to be part of other modules. Since we are developing a custom module, we have kept <code class="literal">Custom</code> or you can use <code class="literal">Other</code> if you are not sure.</li><li class="listitem" style="list-style-type: disc"><code class="literal">type</code>: This is a required property to let Drupal know if it is a module, or a theme, or an installation profile.</li><li class="listitem" style="list-style-type: disc"><code class="literal">version</code>: We should specify the version number of the module we are developing.</li><li class="listitem" style="list-style-type: disc"><code class="literal">core</code>: We need to specify the Drupal version for which this module will be used with, <code class="literal">8.x</code>. This is a mandatory property.</li></ul></div></li><li class="listitem">Create <code class="literal">.routing.yml</code><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Routing system</strong></span>: A <a class="indexterm" id="id143"/>route is a path which is defined for Drupal to return some sort of content on. For example, the default front page /node is a route. When Drupal receives a request, it tries to match the requested path to a route it knows about. If the route is found, then the route's definition is used to return the content. Otherwise, Drupal returns a 404.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Routes and controllers</strong></span>: Drupal's <a class="indexterm" id="id144"/>routing system works <a class="indexterm" id="id145"/>with the Symfony HTTP kernel. Reading a bit on Symfony will be helpful. Basic knowledge about the Symfony HTTP Kernel would be enough to do general route operations. The following diagram explains how the different components relate to each other:<div class="informalexample"><pre class="programlisting">d8dev.my_page:
  path: '/mypage/page'
  defaults:
    _controller: '\Drupal\d8dev\Controller\d8devController::myPage'
    _title: 'My first page in Drupal8'
    requirements:
    _permission: 'access content'</pre></div></li></ul></div><div class="mediaobject"><img alt="Time for action – developing a custom module in Drupal 8" src="graphics/4659_02_14.jpg"/></div><p>We are going to write the path in the <code class="literal">.routing.yml</code> file. Again, here we are going to use the Symfony2 components to handle the routing. Following is our <code class="literal">d8dev.routing.yml</code> code which includes defining routes as the configuration and managing the callback in a controller, which is a method of a Controller class:</p><p>In the <a class="indexterm" id="id146"/>preceding code, the first line <code class="literal">d8dev.my_page</code> is route, a Symfony component which maps an HTTP request in Drupal to a set of configuration variables. Route is defined as a machine name as <code class="literal">module_name.route_name</code>.</p><p>Next is path, where we specify the URL path we want this route to register. Do not forget to add a leading forward slash.</p><p>We have two configurations under defaults: <code class="literal">_controller</code>, which references a method on the <code class="literal">d8devController</code> class, and <code class="literal">_title</code>, where we add the default page title, such as <code class="literal">My first page in Drupal 8</code>.</p><p>As part of the requirements configuration we have specified the permission, who can access the page.</p><p>You can read <a class="indexterm" id="id147"/>more on the routing file at <a class="ulink" href="https://www.drupal.org/node/2092643">https://www.drupal.org/node/2092643</a>.</p></li><li class="listitem">Create the Route Controller class. We have to create our <code class="literal">ModuleController.php</code> according to the PSR-4 naming standard which has been implemented in Drupal 8 for package-based PHP namespace auto-loading by the PHP Framework Interoperability Group.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>PSR describes the specification for writing auto-loading classes from file paths. It  also describes where to place the files that will be autoloaded according to the specification. Read more about<a class="indexterm" id="id148"/> PSR-4 namespaces and auto-loading at <a class="ulink" href="http://www.php-fig.org/psr/psr-4/">http://www.php-fig.org/psr/psr-4/</a>.</p></div></div><p>Create a folder <code class="literal">modules/custom/d8dev/src/Controller</code>. Within this folder, create a file named <code class="literal">d8devController.php</code> with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;?php
/**
 * @file
 * @author My Name
 * Contains \Drupal\d8dev\Controller\d8devController.
 * Please include this file under your 
 * d8dev(module_root_folder)/src/Controller/
 */
namespace Drupal\d8dev\Controller;
/**
 * Provides route responses for the d8dev module.
 */
class d8devController {
  /**
   * Returns a simple page.
   *
   * @return array
   *   A simple renderable array.
   */
  public function myPage() {
    $element = array(
'#type' =&gt; 'markup',
'#markup' =&gt; 'Hello world!',
);
    return $element;
  }
}
?&gt;</pre></div><p>Controller<a class="indexterm" id="id149"/> is a PHP function we add which takes the information from the HTTP request and constructs and returns an HTTP response.</p><p>The controller includes all the logic our application needs to display the content of the page. Based on the matching route, the specific controller is executed and it creates and returns a response object.</p><p>For example, if the browser requests the page having the path <code class="literal">/mypage/page</code>, it will execute the <code class="literal">d8devController::myPage()</code> controller and display a page that simply prints <code class="literal">Hello world!</code>.</p></li><li class="listitem">Enable the module. Go to the path <code class="literal">admin/modules</code>.<div class="mediaobject"><img alt="Time for action – developing a custom module in Drupal 8" src="graphics/4659_02_15.jpg"/></div></li></ol></div><p>Once you <a class="indexterm" id="id150"/>have enabled the module and opened the path <code class="literal">http://localhost/d8dev/mypage/page</code> in your favorite browser, you'll see the <span class="strong"><strong>Hello world!</strong></span> text printed from our module.</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We completed our first custom module and displayed the <span class="strong"><strong>Hello World!</strong></span> message on a custom page URL. Reward yourself with one hot cup of coffee before getting deeper into module development and introduction of Drupal API.</p></div></div>
<div class="section" title="Time for action &#x2013; developing custom field formatter"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec37"/>Time for action – developing custom field formatter</h1></div></div></div><p>Let's open the recipe<a class="indexterm" id="id151"/> page we created just before developing our custom module. On our recipe page which we created using our custom content type, all time fields (<span class="strong"><strong>cookTime</strong></span> and <span class="strong"><strong>prepTime</strong></span>) values are displayed in minutes, for example, 60 minutes and 90 minutes. It would be nice if 60 minutes was displayed as 1 hour and 90 minutes was displayed as 1 1⁄2 hours.</p><p>One way we can make this happen is to develop a custom module to create a custom field formatter that will display the duration related fields of <span class="strong"><strong>cookTime</strong></span> and <span class="strong"><strong>prepTime</strong></span> as hours instead of minutes.</p><p>Following are the basic steps involved in creating a new plugin or creating a custom field formatter:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the custom formatter class. This class defines its meta information in its annotation block, which holds the ID of the formatter, label, and field type.<p>Core ones are defined either by core modules that can be found inside the <code class="literal">Drupal\Core\Field\Plugin\Field\FieldFormatter</code> and namespace plugins are placed inside the <code class="literal">src/Plugin/</code> folder of our module. In the case of field formatters, this will be the <code class="literal">src/Plugin/Field/FieldFormatter</code> directory.</p><p>For <a class="indexterm" id="id152"/>creating a formatter, you need to follow these next steps:</p><p>Create <code class="literal">RecipeFormatter.php</code>. Copy this to within our module folder as <code class="literal">d8dev/src/Plugin/Field/FieldFormatter/RecipeFormatter.php</code> and add the following lines:</p><div class="informalexample"><pre class="programlisting">&lt;?php
/**
 * @file
 * Contains \Drupal\ d8dev\Plugin\field\formatter\RecipeFormatter.
 */

namespace Drupal\d8dev\Plugin\Field\FieldFormatter;

use Drupal\Core\Field\FormatterBase;
use Drupal\Core\Field\FieldItemListInterface;</pre></div><p>In Drupal 7, we used to have <code class="literal">hook_field_formatter_info</code>. Instead of that, a new annotations system has been introduced in Drupal 8. Now, we need to define the formatter using annotations.</p><p>Add the following lines to <code class="literal">RecipeFormatter.php</code> we created in step 1:</p><div class="informalexample"><pre class="programlisting">/**
 * Plugin implementation of the 'recipe_time' formatter.
 *
 * @FieldFormatter(
 *   id = "recipe_time",
 *   label = @Translation("Duration"),
 *   field_types = {
 *     "integer",
 *     "decimal",
 *     "float"
 *   }
 * )
 */</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>The PHP comment docblock before your formatter class with the <code class="literal">@FieldFormatter</code> annotation is really important:</p><p><code class="literal">class RecipeFormatter extends FormatterBase { }</code></p><p>The annotation attributes are pretty self-explanatory. All we've done is define an ID, label, and which field type this formatter should be available on. The <code class="literal">field_types</code> attribute is the most important part, if you don't add <code class="literal">integer</code>, <code class="literal">decimal</code>, or <code class="literal">float</code>  then this formatter will not appear on the manage display page.</p></div></div><p>The <a class="indexterm" id="id153"/>last bit of work we'll do on the formatter is add the <code class="literal">viewElements()</code> method. This method will be used to display the actual formatter and it's the only method required if the formatter class extends <code class="literal">FormatterBase</code>.</p><p>Append the following lines into the <code class="literal">RecipeFormatter.php</code> class:</p><div class="informalexample"><pre class="programlisting">public function viewElements(FieldItemListInterface $items) {
        $elements = array();

        foreach ($items as $delta =&gt; $item) {

            //$hours = $item-&gt;value;
            $hours = floor($item-&gt;value / 60); 

//divide by minutes in 1 hour and get floor
            $minutes = $item-&gt;value % 60; 
//remainder of minutes
            //get greatest common denominator of minutes to convert to fraction of hours
            $minutes_gcd = gcd($minutes, 60);

            //&amp;frasl; is the html entity for the fraction separator, and 
// we use the sup and sub html element to give the 
// appearance of a  fraction.

            //$minutes_fraction = '&lt;sup&gt;' . $minutes/$minutes_gcd .'&lt;/sup&gt;&amp;frasl;&lt;sub&gt;' . 60/$minutes_gcd . '&lt;/sub&gt;';
            $minutes_fraction = $minutes/$minutes_gcd ."/" . 60/$minutes_gcd ;

            $markup = $hours &gt; 0 ? $hours . ' and ' . $minutes_fraction . ' hours' : $minutes_fraction . ' hours';
            $elements[$delta] = array(
                '#theme' =&gt; 'recipe_time_display',
                '#value' =&gt; $markup,
            );
        }

        return $elements;
    }</pre></div><p>What <a class="indexterm" id="id154"/>we're doing here is passing the processed value into a custom template that'll be used to display the embedded HTML code.</p><p>We also need to create a helper function to process the value.</p><p>Append the following lines to the <code class="literal">RecipeFormatter.php</code> class:</p><div class="informalexample"><pre class="programlisting">**
 * Simple helper function to get gcd of minutes
 */
function gcd($a, $b) {
    $b = ( $a == 0) ? 0 : $b;
    return ( $a % $b ) ? gcd($b, abs($a - $b)) : $b;
}</pre></div><p>Finally, our <code class="literal">RecipeFormatter.php</code> class looks like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?php
* @file
 * Contains \Drupal\d8dev\Plugin\field\formatter\RecipeFormatter.
 */

namespace Drupal\d8dev\Plugin\Field\FieldFormatter;

use Drupal\Core\Field\FormatterBase;
use Drupal\Core\Field\FieldItemListInterface;

/**
 * Plugin implementation of the 'number_decimal' formatter.
 *
 * The 'Default' formatter is different for integer fields on the one hand, and
 * for decimal and float fields on the other hand, in order to be able to use
 * different settings.
 *
 * @FieldFormatter(
 *   id = "recipe_time",
 *   label = @Translation("Duration"),
 *   field_types = {
 *     "integer",
 *     "decimal",
 *     "float"
 *   }
 * )
 */
class RecipeTimeFormatter extends FormatterBase {
    /**
     * {@inheritdoc}
     */
    public function viewElements(FieldItemListInterface $items) {
        $elements = array();

        foreach ($items as $delta =&gt; $item) {

            //$hours = $item-&gt;value;
            $hours = floor($item-&gt;value / 60); //divide by minutes in 1 hour and get floor
            $minutes = $item-&gt;value % 60; //remainder of minutes
            //get greatest common denominator of minutes to convert to fraction of hours
            $minutes_gcd = gcd($minutes, 60);

            //&amp;frasl; is the html entity for the fraction separator, and we use the sup and sub html element to give the appearance of a  fraction.

            //$minutes_fraction = '&lt;sup&gt;' . $minutes/$minutes_gcd .'&lt;/sup&gt;&amp;frasl;&lt;sub&gt;' . 60/$minutes_gcd . '&lt;/sub&gt;';
            $minutes_fraction = $minutes/$minutes_gcd ."/" . 60/$minutes_gcd ;

            $markup = $hours &gt; 0 ? $hours . ' and ' . $minutes_fraction . ' hours' : $minutes_fraction . ' hours';
            $elements[$delta] = array(
                '#theme' =&gt; 'recipe_time_display',
                '#value' =&gt; $markup,
            );
        }

        return $elements;
    }
}

/**
 * Simple helper function to get gcd of minutes
 */
function gcd($a, $b) {
    $b = ( $a == 0) ? 0 : $b;
    return ( $a % $b ) ? gcd($b, abs($a - $b)) : $b;
}</pre></div></li><li class="listitem">Create <a class="indexterm" id="id155"/>the template. So far, now we have created the formatter. Now we need to create a custom template to complete this module development. The template will be called <code class="literal">recipe_time_display</code> and it'll accept the <code class="literal">value</code> as the single parameter. For creating the template, we will follow these next steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open up <code class="literal">d8dev.module</code> and add the following function:<div class="informalexample"><pre class="programlisting">/**
 * Implements hook_theme().
 */
function d8dev_theme() {
    return array(
        'recipe_time_display' =&gt; array(
            'variables' =&gt; array('value' =&gt; NULL),
            'template' =&gt; 'recipe-time-display',
         ),
      );
   }</pre></div></li><li class="listitem">Create a folder in the module called <code class="literal">templates</code> and a file named <code class="literal">recipe-time-display.html.twig</code>. The path is : <code class="literal">d8dev/templates/recipe-time-display.html.twig</code>.<div class="informalexample"><pre class="programlisting">{{ value }}</pre></div></li></ol></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>You can have a brief look at<a class="indexterm" id="id156"/> Twig on <a class="ulink" href="http://symfony.com/doc/current/book/templating.html">http://symfony.com/doc/current/book/templating.html</a>.</p></div></div><p>Here we are just printing the value directly. If you want you can add more HTML to the value through this file. Add the following to <code class="literal">recipe-time-display.html.twig</code>:</p></li><li class="listitem">After saving all the files from the previous steps, go to your site on the browser and <span class="strong"><strong>Clear all caches</strong></span> from the path <code class="literal">admin/config/development/performance</code>.<div class="mediaobject"><img alt="Time for action – developing custom field formatter" src="graphics/4659_02_16.jpg"/></div></li><li class="listitem">After <a class="indexterm" id="id157"/>clearing cache, you can go to the path <code class="literal">admin/structure/types/manage/recipe/display</code> and change the <span class="strong"><strong>FORMAT</strong></span> fields <span class="strong"><strong>cookTime</strong></span> and <span class="strong"><strong>prepTme</strong></span> to the formatter from <span class="strong"><strong>Default</strong></span> to <span class="strong"><strong>Duration</strong></span>.<div class="mediaobject"><img alt="Time for action – developing custom field formatter" src="graphics/4659_02_17.jpg"/></div></li><li class="listitem">After <a class="indexterm" id="id158"/>that you click on the <span class="strong"><strong>Save</strong></span> button on the <span class="strong"><strong>Manage display</strong></span> page. Now view the Recipe content item that we created earlier, and you should see the new time format.<div class="mediaobject"><img alt="Time for action – developing custom field formatter" src="graphics/4659_02_18.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We created a <a class="indexterm" id="id159"/>custom module that allows us to format our Recipe content duration field the way we wanted it—integers converted to hours and fraction of hours.</p></div></div>
<div class="section" title="Test-driven development (TDD)"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec38"/>Test-driven development (TDD)</h1></div></div></div><p>Lot of <a class="indexterm" id="id160"/>times we hear that Drupal is not a good choice for writing complex web applications. One of the chief reasons is that Drupal doesn't support TTD or automated testing. But in Drupal 8 we have the PHPUnit tests and Simpletest tests in the core.</p><p>Drupal 8 is developed keeping in mind the use of automated tests, including unit tests as well as functional tests. Unit test is at the lower level and used primarily to test the functionality of classes, whereas functional test is done at the higher level to check the web output.</p><p>Important <a class="indexterm" id="id161"/>is run both types of tests for most of the features we develop before making any changes to the existing Drupal system to make sure no existing functionality is breaking up. We also call this regression testing.</p><div class="mediaobject"><img alt="Test-driven development (TDD)" src="graphics/4659_02_19.jpg"/></div><p>To follow TDD, we need to follow these two processes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Whenever you make a patch to fix a bug or to change an existing functionality, make sure to write a test that fails before changes have been in the code and that it passes after you make the changes in the code. The goal of this test is to help the reviewer understand the bug he/she encounters, to highlight that the code written has fixed the intended bug, and to ensure that it will not appear again whenever new changes are made to the code.</li><li class="listitem" style="list-style-type: disc">Similarly, in<a class="indexterm" id="id162"/> the case of writing code to implement a new feature, make sure to include unit and/or functional tests in your code. This will ensure that the reviewer knows the code you have written works and that the changes will not break the new functionality.</li></ul></div><div class="section" title="PHPUnit tests for Drupal classes"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>PHPUnit tests for Drupal classes</h2></div></div></div><p>We are going<a class="indexterm" id="id163"/> to use an industry standard PHPUnit framework to write a test for our Drupal classes. Generally we write PHPUnit test cases to test the functionality of a class when we do not require the Drupal environment (databases, settings, and so on) and web browser.</p><p>To write a PHPUnit test, follow these next steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define a class extending <code class="literal">\Drupal\Tests\UnitTestCase</code>. Make sure the class name ends with the word <code class="literal">test</code>.</li><li class="listitem">Place your test class file <code class="literal">ind8dev/tests/src/Unit</code> directory.</li><li class="listitem">Include a phpDoc comment with the description giving information about the test.</li><li class="listitem">Start writing your test class with names starting with <code class="literal">test</code>. Each test class should include part of the functionality to be tested.<div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Read more about PHPUnit at <a class="ulink" href="https://www.drupal.org/phpunit">https://www.drupal.org/phpunit</a>. For full documentation on how to write<a class="indexterm" id="id164"/> PHPUnit tests for Drupal go to <a class="ulink" href="http://phpunit.de">http://phpunit.de</a> and for general information on the PHPUnit framework, object-oriented programming topics, for more on PSR-4, namespaces, and where to place classes</p></div></div></li></ol></div></div><div class="section" title="Functional tests"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Functional tests</h2></div></div></div><p>We use <a class="indexterm" id="id165"/>inbuilt Simpletest as part of the Drupal <a class="indexterm" id="id166"/>core to write functional test cases. Unlike unit test cases, we use functional test to test the functionality of the different systems of Drupal when it depends on databases as well as configurations or to test the browser output.</p></div></div>
<div class="section" title="Time for action &#x2013; writing and testing functional test from our d8dev custom module"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec39"/>Time for action – writing and testing functional test from our d8dev custom module</h1></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enable the <a class="indexterm" id="id167"/>module <span class="strong"><strong>Testing</strong></span> from<a class="indexterm" id="id168"/> the path <code class="literal">admin/modules</code>:<div class="mediaobject"><img alt="Time for action – writing and testing functional test from our d8dev custom module" src="graphics/4659_02_20.jpg"/></div></li><li class="listitem">Create the <code class="literal">D8devTest</code> class in the <code class="literal">D8devTest.php</code> file under <code class="literal">d8dev/src/tests/</code> and add the following lines of code:<div class="informalexample"><pre class="programlisting">&lt;?php
/**
 * Created by PhpStorm.
 * User: Neeraj
 * Date: 8/7/15
 * Time: 10:59 AM
 */
namespace Drupal\d8dev\Tests;

use Drupal\simpletest\WebTestBase;

/**
 * Tests the d8dev module functionality
 *
 * @group d8dev
 */
class D8devTest extends WebTestBase {

    /**
     * Tests that the 'mypage/page' path returns the right content
     */
    public function testCustomPageExists() {

        $this-&gt;drupalGet('mypage/page');
        $this-&gt;assertResponse(200);
    }
}</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>In the phpDoc comment block  for the <code class="literal">Test</code> class, it is mandatory to have this block with the <code class="literal">@group</code> annotation.</p><div class="informalexample"><pre class="programlisting">       /**
         * Tests the d8dev module functionality
         *
         * @group d8dev
         */</pre></div><p><span class="strong"><strong>Test Case</strong></span>: In the <code class="literal">D8devTest</code> class, we check our custom page <code class="literal">mypage/page</code> created from our d8dev module using the function <code class="literal">testCustomPageExists()</code>.</p></div></div></li><li class="listitem">Clear<a class="indexterm" id="id169"/> the <a class="indexterm" id="id170"/>cache from the path <code class="literal">admin/config/development/performance</code>.</li><li class="listitem">Open the testing module user interface from the path <code class="literal">admin/config/development/testing</code> or you can navigate to <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Testing</strong></span>.<div class="mediaobject"><img alt="Time for action – writing and testing functional test from our d8dev custom module" src="graphics/4659_02_21.jpg"/></div></li><li class="listitem">Select <span class="strong"><strong>\Drupal\d8dev\Tests\D8devTest</strong></span> and click on the <span class="strong"><strong>Run tests</strong></span> button. You will <a class="indexterm" id="id171"/>find the result<a class="indexterm" id="id172"/> as in the following screenshot:<div class="mediaobject"><img alt="Time for action – writing and testing functional test from our d8dev custom module" src="graphics/4659_02_22.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>Congratulations! You should now be familiar with TDD approach implementation in Drupal 8. We learned how to write a functional test case for our custom module functionality. We also learned how to write and run the test in Drupal 8 by testing a module user interface.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec40"/>Summary</h1></div></div></div><p>In this chapter, we learned how to create new content type in Drupal and developed our custom module to modify one of the fields using the field formatter API. We also explored how TDD has been incorporated in the new Drupal core.</p><p>In the next chapter, we are going to learn more about newly introduced configuration management in Drupal 8 and how to use views which have been moved as core modules.</p></div></body></html>