- en: Chapter 7. Eloquent… without Laravel!
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 7 章. 无 Laravel 的 Eloquent…
- en: Our journey is close to the end, hero. You learned everything about Eloquent,
    starting from the very basics and going through models, relationships, and other
    topics. You probably started to like it and think about implementing it in your
    next project.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的旅程即将结束，英雄。你从最基础的知识学到了关于 Eloquent 的所有内容，包括模型、关系和其他主题。你可能开始喜欢它，并考虑在下一个项目中实现它。
- en: In fact, creating an application without a single SQL query is tempting. Maybe
    you also showed it to your boss and convinced him/her to use it in your next production
    project.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，创建一个不使用单个 SQL 查询的应用程序很有吸引力。也许你也向你的老板展示了它，并说服他/她将其用于下一个生产项目。
- en: I am so proud of you, hero!
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 我为你感到骄傲，英雄！
- en: However, there is a little problem. Yeah, the next project isn't so new. It
    already exists, and, despite everything, it doesn't use Laravel! You start to
    shiver. This is so sad because you passed the last week studying this new ORM,
    a really cool one, and then moving forward.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，有一个小问题。是的，下一个项目并不那么新。它已经存在了，尽管如此，它并没有使用 Laravel！你开始颤抖。这真是太遗憾了，因为你上周一直在学习这个新的
    ORM，一个非常酷的 ORM，然后继续前进。
- en: Ok, stop complaining! There is always a solution! You are a developer! Also,
    the solution is not so hard to find. If you want, you can use Eloquent without
    Laravel. Yes, seriously!
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，别抱怨了！总有解决办法！你是一名开发者！此外，解决方案并不难找到。如果你想，你可以使用 Eloquent 而不使用 Laravel。是的，真的！
- en: Actually, Laravel is not a *monolithic* framework. It is made up of several,
    separate parts, which are combined together to build something greater. However,
    nothing prevents you from using only selected packages in another application.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，Laravel 不是一个 *单体* 框架。它由几个独立的组件组成，这些组件组合在一起构建了更大的东西。然而，没有任何东西阻止你在另一个应用程序中仅使用所选的包。
- en: A really cool idea!
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 一个非常酷的想法！
- en: So, what are we going to see in this chapter?
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，我们将在本章中看到什么？
- en: First of all, we will explore the structure of the database package and see
    what is inside it. Then, you will learn how to install the `illuminate/database`
    package separately for your project and how to configure it for the first use.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将探索数据库包的结构，看看里面有什么。然后，你将学习如何为你的项目单独安装 `illuminate/database` 包，以及如何为其首次使用进行配置。
- en: Then, you will encounter some examples. First of all, we will look at the **Eloquent
    ORM**. You will learn how to define models and use them.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，你将遇到一些示例。首先，我们将查看 **Eloquent ORM**。你将学习如何定义模型并使用它们。
- en: Having done this, as a little extra, I will show you how to use the `Query Builder`
    (remember that the `"illuminate/database"` package isn't just Eloquent). Maybe
    you would also enjoy the `Schema Builder` class. I will cover it, don't worry!
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 做完这件事后，作为额外的补充，我将向你展示如何使用 `查询构建器`（记住，“illuminate/database”包不仅仅是 Eloquent）。也许你也会喜欢
    `Schema Builder` 类。我会涵盖它，不用担心！
- en: À la charge!
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 由你负责！
- en: 'We will cover the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将涵盖以下内容：
- en: Exploring the directory structure
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索目录结构
- en: Installing and configuring the database package
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装和配置数据库包
- en: Using the ORM
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 ORM
- en: Using the Query and Schema Builders
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用查询和模式构建器
- en: Summary
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 摘要
- en: Exploring the directory structure
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索目录结构
- en: As I mentioned before, the key step in order to use Eloquent in your application
    without Laravel is to use the `"illuminate/database"` package.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 如我之前所述，要在你的应用程序中使用 Eloquent 而不使用 Laravel 的关键步骤是使用 `"illuminate/database"` 包。
- en: So, before we install it, let's examine it a little.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，在我们安装它之前，让我们先稍微了解一下。
- en: 'You can see the package contents here: [https://github.com/illuminate/database](https://github.com/illuminate/database).'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这里看到包的内容：[https://github.com/illuminate/database](https://github.com/illuminate/database)。
- en: 'So, this is what you will probably see:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，你可能会看到以下内容：
- en: '| Folder | Description |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| 文件夹 | 描述 |'
- en: '| --- | --- |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `Capsule` | The **capsule manager** is a fundamental component. It instantiates
    the service container and loads some dependencies. |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| `Capsule` | **capsule 管理器**是一个基本组件。它实例化服务容器并加载一些依赖项。|'
- en: '| `Connectors` | The database package can communicate with various DB systems.
    For instance, SQLite, MySQL, or PostgreSQL. Every type of database has its own
    connector. This is the folder in which you will find them. |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| `Connectors` | 数据库包可以与各种数据库系统通信。例如，SQLite、MySQL 或 PostgreSQL。每种数据库类型都有自己的连接器。这是你将找到它们的文件夹。|'
- en: '| `Console` | The database package isn''t just Eloquent with a bunch of connectors.
    In this specific folder, you will find everything related to console commands,
    such as `artisan db:seed` or `artisan migrate`. |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
- en: '| `Eloquent` | Every single Eloquent class is placed here. |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
- en: '| `Migrations` | Don''t confuse this with the `Console` folder. Every class
    related to migrations is stored here. When you type `artisan migrate` in your
    terminal, you are calling a class that is placed here. |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
- en: '| `Query` | The Query Builder is placed here. |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
- en: '| `Schema` | Everything related to the Schema Builder is placed here. |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
- en: In the main folder, you will also find some other files. However, don't worry
    as you don't need to know what they are.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: 'If you open the `composer.json` file, take a look at the following `"require"`
    section:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As you can see, the database package has some prerequisites that you can't avoid.
    However, the container is quite small, and it is the same for `contracts` (just
    some interfaces) and `"illuminate/support"`.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Eloquent uses `Carbon` ([https://github.com/briannesbitt/Carbon](https://github.com/briannesbitt/Carbon))
    to deal with dates in a smarter way. So, if you are seeing this for the first
    time and you are confused, don't worry! Everything is all right.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: Now that you know what you can find in this package, let's see how to install
    it and configure it for the first time.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Installing and configuring the database package
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's start with the setup. First of all, we will install the package using
    composer as usual. After that, we will configure the capsule manager in order
    to get started.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Installing the package
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Installing the `"illuminate/database"` package is really easy.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: 'All you have to do is to add `"illuminate/database"` to the `"require"` section
    of your `composer.json` file, like this:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Then type `composer update` in to your terminal, and wait for a few seconds.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'Another way is to include it with the shortcut in your project folder, obviously
    from the terminal:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: No matter which method you chose, you just installed the package.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: Configuring the package
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Time to use the capsule manager! In your project, you will use something like
    this to get started:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The config syntax I used is exactly the same you can find in the `config/database.php`
    configuration file. The only difference is that this time you are explicitly using
    an instance of the capsule manager in order to do everything.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: In the second part of the code, I am setting up the event dispatcher. You must
    do this if events are required from your project.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: However, events are not included by default in this package, so you will have
    to manually add the `"illuminate/events"` dependency to your `composer.json` file.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: Now, the final step!
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: 'Add this code to your setup file:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: With `setAsGlobal()` called on the capsule manager, you can set it as a global
    component in order to use it with static methods. You may like it or not; the
    choice is yours. The final line starts up Eloquent, so you will need it.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: However, this is also an optional instruction. In some situations you may need
    the Query Builder only.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这也是一个可选的指令。在某些情况下，你可能只需要查询构建器。
- en: Then there is nothing else to do! Your application is now configured with the
    database package (and Eloquent)!
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，就没有其他事情要做了！你的应用程序现在已经配置了数据库包（以及 Eloquent）！
- en: Using the ORM
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 ORM
- en: Using the Eloquent ORM in a non-Laravel application is not a big change. All
    you have to do is to declare your model as you are used to doing. Then, you need
    to call it and use it as you are used to.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在非 Laravel 应用程序中使用 Eloquent ORM 并不是很大的变化。你所要做的就是像你习惯的那样声明你的模型。然后，你需要调用它并像你习惯的那样使用它。
- en: 'Here is a perfect example of what I am talking about:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是我所说的完美例子：
- en: '[PRE5]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Exactly as you did with Laravel, the package you are using is the same. So,
    no worries! If you want to use the model you just created, then use the following:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 就像你在 Laravel 中做的那样，你使用的包是相同的。所以，不用担心！如果你想使用你刚刚创建的模型，那么请使用以下内容：
- en: '[PRE6]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This also applies for relationships, observers, and so on. Everything is the
    same.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 这也适用于关系、观察者等等。一切都是一样的。
- en: Note
  id: totrans-69
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: In order to use the database package and ORM exactly, you would do the same
    thing you did in Laravel; remember to set up the project structure in a way that
    follows the PSR-4 autoloading convention.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 为了精确地使用数据库包和 ORM，你会做与 Laravel 中相同的事情；请记住，以遵循 PSR-4 自动加载约定的方式设置项目结构。
- en: Using the Query and Schema Builder
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用查询和模式构建器
- en: It's not just about the ORM; with the database package, you can also use the
    Query and the Schema Builders. Let's discover how!
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 这不仅仅关于 ORM；有了数据库包，你还可以使用查询和模式构建器。让我们来探索一下！
- en: The Query Builder
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 查询构建器
- en: 'The Query Builder is also very easy to use. The only difference, this time,
    is that you are passing through the capsule manager object, like this:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 查询构建器也非常容易使用。这次唯一的区别是，你将通过胶囊管理对象传递，就像这样：
- en: '[PRE7]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: However, the result is still the same.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，结果仍然是相同的。
- en: 'Also, if you like the DB facade in Laravel, you can use the capsule manager
    class in the same way:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，如果你喜欢 Laravel 中的 DB 门面，你可以以相同的方式使用胶囊管理类：
- en: '[PRE8]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The Schema Builder
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模式构建器
- en: At the beginning of this book, I showed you the Schema Builder. You learned
    how to use it with migrations, but now, without Laravel, you don't have migrations.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在这本书的开头，我向你展示了模式构建器。你学习了如何使用它与迁移一起，但现在，在没有 Laravel 的情况下，你没有迁移。
- en: 'However, you can still use the Schema Builder. Like this:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，你仍然可以使用模式构建器。就像这样：
- en: '[PRE9]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Previously, you used to call the `create()` method of the `Schema facade`.
    This time is a little different: you will use the `create()` method, chained to
    the `schema()` method of the `Capsule` class.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 之前，你通常调用`Schema facade`的`create()`方法。这次有点不同：你将使用`create()`方法，将其链接到`Capsule`类的`schema()`方法。
- en: 'Obviously, you can use any Schema class method in this way. For instance, you
    could call something like following:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，你可以以这种方式使用任何 Schema 类方法。例如，你可以调用以下内容：
- en: '[PRE10]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: And you are good to go!
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 你就可以开始了！
- en: Note
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Remember that if you want to unlock some Schema Builder-specific features you
    will need to install other dependencies.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，如果你想解锁一些 Schema Builder 特定功能，你需要安装其他依赖项。
- en: For example, do you want to rename a column? You will need the `doctrine/dbal`
    dependency package.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你想重命名一个列？你需要`doctrine/dbal`依赖包。
- en: Summary
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Yeah, this time, it was quite quick.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 嗯，这次，进展相当快。
- en: I decided to add this chapter because many people ask me how to use Eloquent
    without Laravel. Mostly because they like the framework, but they can't migrate
    an already started project in its entirety.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 我决定添加这一章，因为很多人问我如何在没有 Laravel 的情况下使用 Eloquent。主要是因为他们喜欢这个框架，但他们无法将一个已经启动的项目整体迁移。
- en: Also, I think that it's cool to know, in a certain sense, what you can find
    under the hood.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我认为了解在某种程度上你可以在引擎盖下找到什么，也是很酷的。
- en: It is always just about curiosity. Curiosity opens new paths, and you have a
    choice to solve a problem in a new and more elegant way.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这始终只是关于好奇心。好奇心开辟了新的道路，你可以选择以新的、更优雅的方式解决问题。
- en: 'In these few pages, I just scratched the surface. I want to give you some advice:
    explore the code. The best way to write good code is to read good code.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在这几页中，我只是触及了表面。我想给你一些建议：探索代码。编写好代码的最佳方式是阅读好代码。
- en: And now, to the final chapter!
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们进入最后一章！
