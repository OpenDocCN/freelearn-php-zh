<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Working with Themes and Add-ons"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Working with Themes and Add-ons</h1></div></div></div><p>In this chapter we will cover the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a custom theme</li><li class="listitem" style="list-style-type: disc">Including the concrete5 required scripts and styles</li><li class="listitem" style="list-style-type: disc">Defining editable content areas</li><li class="listitem" style="list-style-type: disc">Creating page type templates</li><li class="listitem" style="list-style-type: disc">Using elements for repeated portions of HTML</li><li class="listitem" style="list-style-type: disc">Customizing system pages</li><li class="listitem" style="list-style-type: disc">Creating a custom add-on package</li><li class="listitem" style="list-style-type: disc">Using the package controller to execute custom code</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec138"/>Introduction</h1></div></div></div><p>concrete5 is a little different from other content management systems. Of course, it has world-class inline editing capabilities and a powerful development framework, but it also is incredibly easy to create custom themes and add-ons. Developers and designers can even sell their creations in the concrete5 marketplace. In this chapter, we will learn how to create a very basic theme and also how to create a simple add-on package. Though each of these recipes has its own purpose, it might be useful for beginners to run through the recipes in order to make sure all of the required knowledge is attained.</p></div></div>
<div class="section" title="Creating a custom theme"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec139"/>Creating a custom theme</h1></div></div></div><p>Themes are an essential part of any <a id="id517" class="indexterm"/>content management system, and for good reason. Nobody wants their site to look just like all of the other websites out there. concrete5 comes with a handful of decent-looking themes, but many times you or your clients will want a custom theme developed. The subject of creating themes can actually become quite lengthy and there have been entire books dedicated to this (the book <span class="emphasis"><em>Creating concrete5 Themes</em></span>, by Remo Laubacher, Packt Publishing is highly recommended). In this recipe, we will only demonstrate the minimum requirements to create a custom theme in concrete5.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec484"/>Getting ready</h2></div></div></div><p>The complete basic theme code for this recipe is available for free on the website for this book.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec485"/>How to do it...</h2></div></div></div><p>The steps for creating a <a id="id518" class="indexterm"/>custom theme are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new directory in <code class="literal">/themes</code> called <code class="literal">basic_theme</code>.</li><li class="listitem">Create a file in <code class="literal">basic_theme</code> called <code class="literal">description.txt</code>.</li><li class="listitem">Place the title of the theme on the first line of the description file.<div class="informalexample"><pre class="programlisting">Basic Theme</pre></div></li><li class="listitem">Place a short description of the theme on the second line of the text file.<div class="informalexample"><pre class="programlisting">This theme is extremely basic</pre></div></li><li class="listitem">Save the <code class="literal">description.txt</code> file.</li><li class="listitem">Create a new file in <code class="literal">/themes/basic_theme</code> called <code class="literal">default.php</code>.</li><li class="listitem">Enter the following basic HTML code in the file:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Super Basic Theme&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hi, this is my super basic theme. It's really boring.&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Save <code class="literal">default.php</code>.</li><li class="listitem">Create a file called <code class="literal">view.php</code> and keep it empty.</li><li class="listitem">Visit the themes area of your site's dashboard at <code class="literal">http://example.com/dashboard/pages/themes</code>.</li><li class="listitem">Click on the <span class="strong"><strong>Install</strong></span> button of your new theme. The page will look like the following screenshot:<div class="mediaobject"><img src="graphics/4548OS_08_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on <span class="strong"><strong>Activate</strong></span> and then on <span class="strong"><strong>OK</strong></span> to apply the theme to all of the pages in your site.</li><li class="listitem">You website should now <a id="id519" class="indexterm"/>look like the following screenshot:</li></ol></div><div class="mediaobject"><img src="graphics/4548OS_08_02.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec486"/>How it works...</h2></div></div></div><p>concrete5 only requires that the <a id="id520" class="indexterm"/>files <code class="literal">description.txt</code>, <code class="literal">default.php</code>, and <code class="literal">view.php</code> need to exist in a theme. The file <code class="literal">description.txt</code> contains the themes title and description.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec487"/>There's more...</h2></div></div></div><p>Obviously this would be unusable for real-life use. There's nowhere to put content! Where's the concrete5 edit bar? The next few recipes will expand on this simple theme to make it a real concrete5 theme.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec488"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Including the concrete5 required scripts and styles</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using elements for repeated portions of HTML</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Defining editable content areas</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Including the concrete5 required scripts and styles"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec140"/>Including the concrete5 required scripts and styles</h1></div></div></div><p>You may have noticed that after <a id="id521" class="indexterm"/>creating the extremely simple theme in the previous recipe, the concrete5 edit bar that normally appears at the top of the screen, <a id="id522" class="indexterm"/>has gone away. This is because the theme did not include the required collection of JavaScript and CSS files, that concrete5 needs to do its job. In this recipe, we will add the necessary code to include those components in our simple theme.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec489"/>Getting ready</h2></div></div></div><p>This recipe will build upon the code of the simple theme from the previous recipe. Feel free to download the source code from the book's website to catch up, or adapt this recipe to fit your own theme.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec490"/>How to do it...</h2></div></div></div><p>The steps for including the <a id="id523" class="indexterm"/>concrete5 <a id="id524" class="indexterm"/>required scripts and styles are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">/themes/basic_theme/default.php</code> file where our theme's HTML was stored.</li><li class="listitem">Remove the <code class="literal">&lt;title&gt;</code> tag, as we will not need it any longer.</li><li class="listitem">Just before the closing <code class="literal">&lt;/head&gt;</code> tag, add the following code to the file:<div class="informalexample"><pre class="programlisting">&lt;?php Loader::element('header_required') ?&gt;</pre></div></li><li class="listitem">Just before the closing <code class="literal">&lt;/body&gt;</code> tag, add the following code to the file:<div class="informalexample"><pre class="programlisting">&lt;?php Loader::element('footer_required') ?&gt;</pre></div></li><li class="listitem">Refresh the website.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec491"/>How it works...</h2></div></div></div><p>By calling <code class="literal">Loader::element</code>, we are actually injecting a partial template of PHP code into our theme. This code contains JavaScript and CSS files, as well as additional markup.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec492"/>There's more...</h2></div></div></div><p>Now that we have the edit bar visible, there are still no ways to add content to our simple theme. The next recipe will show how to <a id="id525" class="indexterm"/>add an editable area <a id="id526" class="indexterm"/>to the theme.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec493"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a custom theme</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Defining editable content areas</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Defining editable content areas"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec141"/>Defining editable content areas</h1></div></div></div><p>One great feature of concrete5's theme conventions is the ability to specify exactly where site editors are allowed to edit content. <a id="id527" class="indexterm"/>This prevents users from messing up the design and structure of the site, but still enables them to make edits to all the necessary content. In this recipe, we will add an editable area to the simple theme that we created earlier in the chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec494"/>Getting ready</h2></div></div></div><p>We will expand on the theme created in the previous recipes. If you would like to catch up, the source code for this chapter is available for free on the book's website. You could also adapt this recipe to your own theme, if you'd like.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec495"/>How to do it...</h2></div></div></div><p>The steps for defining editable content areas are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/themes/basic_theme/default.php</code> in your preferred code editor.</li><li class="listitem">Replace the current <code class="literal">&lt;h1&gt;</code> tag with the following code:<div class="informalexample"><pre class="programlisting">&lt;?php $a = new Area('content'); $a-&gt;display($c); ?&gt;</pre></div><p>The screens will appear as shown in the following two screenshots:</p><div class="mediaobject"><img src="graphics/4548OS_08_03.jpg" alt="How to do it..."/></div><div class="mediaobject"><img src="graphics/4548OS_08_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec496"/>How it works...</h2></div></div></div><p>The snippet of code that we added in this <a id="id528" class="indexterm"/>recipe essentially tells concrete5 that this is the place where blocks can be added.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec497"/>There's more...</h2></div></div></div><p>The snippet defining content areas can be placed anywhere in your site's HTML between the <code class="literal">&lt;body&gt;</code> tags. Imagine adding an area for the sidebar, and another area for the page's header. The only thing to note is that the name of the area (in this example, <code class="literal">content</code>) needs to be different in each place where it is used on a page.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec498"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a custom theme</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Including the required concrete5 scripts and styles</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating page type templates"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec142"/>Creating page type templates</h1></div></div></div><p>concrete5 allows designers to create unlimited page templates for the pages in the website. These templates allow for <a id="id529" class="indexterm"/>different layouts, such as a sidebar, or may be a three-column layout. In this recipe, we will add a new page type template that shows a footer with a copyright statement to our existing basic theme.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec499"/>Getting ready</h2></div></div></div><p>We will be building upon the basic theme that was created in the first recipe of this chapter. The code for this chapter is freely available on the book's website, so feel free to download that for a starting point. Or, as always, you can adapt the recipe to fit your own website and theme's needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec500"/>How to do it...</h2></div></div></div><p>The steps for creating page type templates are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new file in your theme directory (/<code class="literal">themes/basic_theme</code> for our current example) called <code class="literal">with_footer.php</code>.</li><li class="listitem">Open the new file and paste the contents of <code class="literal">default.php</code>.<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;?php Loader::element('header_required') ?&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;?php $a = new Area('content'); $a-&gt;display($c); ?&gt;
  &lt;?php Loader::element('footer_required') ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Add a footer to the page, displaying the copyright symbol, the current year, and the copyright holder.<div class="informalexample"><pre class="programlisting">&lt;footer&gt;
  &amp;copy; &lt;?php echo date('Y') ?&gt; Somebody
&lt;/footer&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec501"/>How it works...</h2></div></div></div><p>concrete5 will use this template for all page types that have a handle of <code class="literal">with_footer</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>If the page type has not been added through the concrete5 dashboard interface, this template cannot be used (page types can be added by visiting <code class="literal">/dashboard/pages/types</code>).</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec502"/>There's more...</h2></div></div></div><p>Now, we have a new template, but we have violated one of the most important rules of programming: <a id="id530" class="indexterm"/>
<span class="strong"><strong>don't repeat yourself</strong></span> (<span class="strong"><strong>DRY</strong></span>). We copied the complete HTML from the default template and pasted it into the new one. If something changes in the template and we want the change to be <a id="id531" class="indexterm"/>reflected on both of these templates, the developer would need to remember to update both the locations. The next recipe will cover the solution to this problem.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec503"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a custom theme</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using elements for repeating portions of HTML</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Using elements for repeated portions of HTML"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec143"/>Using elements for repeated portions of HTML</h1></div></div></div><p>One of the fundamental rules <a id="id532" class="indexterm"/>for writing good code is summed up in the acronym, DRY. When creating themes, developers and designers will recognize that there are certain bits of code that get repeated on every page, such as a header or footer. In this recipe, we will learn how to use elements to safely repeat code between pages.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec504"/>Getting ready</h2></div></div></div><p>We are continuing to work on the very basic theme that was created in the first recipe of this chapter. The code for this chapter is available for free on the book's website if you'd like to use that as a starting point.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec505"/>How to do it...</h2></div></div></div><p>The steps for using elements for repeated portions of HTML are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new directory in your <code class="literal">themes</code> folder called <code class="literal">elements</code>.</li><li class="listitem">Create a new file in <code class="literal">elements/</code> called <code class="literal">header.php</code>.</li><li class="listitem">Insert the following code into <code class="literal">header.php</code>:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;?php Loader::element('header_required') ?&gt;
&lt;/head&gt;
&lt;body&gt;</pre></div></li><li class="listitem">Create a new file in <code class="literal">elements/</code> called <code class="literal">footer.php</code>.</li><li class="listitem">Insert the following code into <code class="literal">footer.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php Loader::element('footer_required') ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Open <code class="literal">default.php</code> from the <code class="literal">themes</code> directory.</li><li class="listitem">Replace the header and footer code with the following code snippet, so that the entire file looks like the following:<div class="informalexample"><pre class="programlisting">&lt;?php $this-&gt;inc('elements/header.php'); ?&gt;
  &lt;?php $a = new Area('content'); $a-&gt;display($c); ?&gt;
&lt;?php $this-&gt;inc('elements/footer.php'); ?&gt;</pre></div></li><li class="listitem">Repeat the preceding steps for any page type templates that have been created.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec506"/>How it works...</h2></div></div></div><p>By storing the header and footer <a id="id533" class="indexterm"/>HTML in separate files, we can then tell concrete5 to include them in all of the templates that use them. This allows us to make edits to these elements in only one place and keep our template code clean.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec507"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a custom theme</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Customizing system pages"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec144"/>Customizing system pages</h1></div></div></div><p>concrete5 makes it easy to create <a id="id534" class="indexterm"/>themes, but out of the box it does not apply themes to system pages, such as the login page. For most websites, this is fine, since only site editors will see the login page. On sites where site readers can log in and leave comments, or post in forums, it would be nice to have the login page match everything else. In this recipe, we will make the login page use the same theme as the rest of the site.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec508"/>Getting ready</h2></div></div></div><p>We will continue working with the custom theme that we built at the beginning of this chapter. As always, the code for this recipe is available to download for free from the website for this book.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec509"/>How to do it...</h2></div></div></div><p>The steps for customizing system pages are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_theme_paths.php</code> in your preferred code editor.</li><li class="listitem">Enter the following code in the <code class="literal">site_theme_paths.php</code> file:<div class="informalexample"><pre class="programlisting">$v = View::getInstance();
$v-&gt;setThemeByPath('/login', "basic_theme");</pre></div></li><li class="listitem">Open <code class="literal">/themes/basic_theme/view.php</code> in your code editor.</li><li class="listitem">Enter the following code in <code class="literal">view.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php $this-&gt;inc('elements/header.php'); ?&gt;
  &lt;?php print $innerContent ?&gt;
&lt;?php $this-&gt;inc('elements/footer.php'); ?&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec510"/>How it works...</h2></div></div></div><p>concrete5 comes with the <code class="literal">site_theme_paths.php</code> configuration file, but all of the configuration settings are commented out by default. This file lets you set the theme of any page on the site, and in this example, <a id="id535" class="indexterm"/>we tell it to use our basic theme for the login page.</p><p>You'll also notice that the <code class="literal">view.php</code> page was empty in our theme up until this point. This file is the template that concrete5 uses for single pages that do not have their own template defined. The <code class="literal">$innerContent</code> variable contains all of the PHP and HTML for the single page.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec511"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a custom theme</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating a custom add-on package"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec145"/>Creating a custom add-on package</h1></div></div></div><p>concrete5 allows developers to <a id="id536" class="indexterm"/>create modular components that can be reused and installed on any concrete5 website. These modules are called add-ons and are similar to plugins and modules in other content management systems. In this recipe, we will create a basic add-on that installs a single page to the concrete5 dashboard.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec512"/>Getting ready</h2></div></div></div><p>The complete code for this recipe is available for free from the book's website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec513"/>How to do it...</h2></div></div></div><p>The steps for creating a custom add-on package are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new directory in <code class="literal">/packages</code> called <code class="literal">basic_addon</code>.</li><li class="listitem">Create a file called <code class="literal">controller.php</code> in <code class="literal">/packages/basic_addon</code>.</li><li class="listitem"> Define the package class in <code class="literal">controller.php</code>.<div class="informalexample"><pre class="programlisting">class BasicAddonPackage extends Package {}</pre></div></li><li class="listitem">Add the member variables to the class.<div class="informalexample"><pre class="programlisting">protected $pkgHandle = 'basic_addon';
protected $appVersionRequired = '5.5.0';
protected $pkgVersion = '1.0.0';</pre></div></li><li class="listitem">Define the function to <a id="id537" class="indexterm"/>return the package's name.<div class="informalexample"><pre class="programlisting">public function getPackageName() {
  return 'Basic Add-On';
}</pre></div></li><li class="listitem">Define a function to return the package's description.<div class="informalexample"><pre class="programlisting">public function getPackageDescription() {
  return 'This is a super-simple package';
}</pre></div></li><li class="listitem">Overwrite the <code class="literal">install</code> function, telling the package controller to also install a new single page on the dashboard.<div class="informalexample"><pre class="programlisting">public function install(){
  Loader::model('single_page');
  $pkg = parent::install();
  $page = SinglePage::add('/dashboard/hello', $pkg);
}</pre></div></li><li class="listitem">Create a directory in <code class="literal">basic_addon/</code> called <code class="literal">single_pages</code>.</li><li class="listitem">Create a directory called <code class="literal">dashboard</code> in <code class="literal">single_pages/</code>.</li><li class="listitem">Create a file called <code class="literal">hello.php</code> in <code class="literal">/packages/basic_addon/single_pages/dashboard</code>.</li><li class="listitem">Enter the following code in <code class="literal">hello.php</code>.<div class="informalexample"><pre class="programlisting">&lt;h1&gt;Hello World!&lt;/h1&gt;</pre></div></li><li class="listitem">In your web browser, visit the add-ons installation page in concrete5 at <code class="literal">/dashboard/extend/install/</code>. <a id="id538" class="indexterm"/>The page will look like the following screenshot:<div class="mediaobject"><img src="graphics/4548OS_08_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <span class="strong"><strong>Install</strong></span> button by the new add-on that you have created.</li><li class="listitem">Visit <code class="literal">/dashboard/hello</code> in your web browser to see the single page that got created by the package installer. The page will look like the following screenshot:<div class="mediaobject"><img src="graphics/4548OS_08_06.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec514"/>How it works...</h2></div></div></div><p>The only required file in a package is <code class="literal">controller.php</code>. This file contains a class that provides methods for concrete5 to get the name and description of the add-on. We also modify the package installer <a id="id539" class="indexterm"/>by having it also add a new single page to the dashboard. By visiting <code class="literal">http://example.com/dashboard/hello</code>, we will see the HTML from the single page that we created.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec515"/>There's more...</h2></div></div></div><p>The structure of a package directory is very similar to the overall directory of a normal concrete5 site. Since we wanted to bundle a single page with our package, we simply had to create it and store it in a directory much like we would normally in concrete5. You can see how a package would be structured if it had to contain blocks, controllers, helpers, or any other type of file that concrete5 uses.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec516"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using the package controller to execute custom code</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Using the package controller to execute custom code"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec146"/>Using the package controller to execute custom code</h1></div></div></div><p>A unique and advanced feature of the package controller is the ability to run code automatically whenever a page is <a id="id540" class="indexterm"/>accessed. This can give add-on developers tremendous potential to tap into system events, hook into site HTTP requests, and more. In this recipe, we will show how easy it is to automatically run code from our package whenever a page is visited by redirecting all requests containing a special parameter to the home page.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec517"/>Getting ready</h2></div></div></div><p>We will use the simple add-on package that was created in the previous recipe for this example. The code for this recipe and all others is available for download on the book's website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec518"/>How to do it...</h2></div></div></div><p>The steps for using the package controller to execute custom code are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the package controller file, located at <code class="literal">/packages/basic_addon/controller.php</code>.</li><li class="listitem">Add a function called <code class="literal">on_start</code> that will redirect anyone that enters the parameter <code class="literal">redirect_me</code> in the URL.<div class="informalexample"><pre class="programlisting">public function on_start() {
if (isset($_GET['redirect_me'])) {
    header('Location: /');
  }
}</pre></div></li><li class="listitem">Test it out by adding <code class="literal">?redirect_me</code> to the URL.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec519"/>How it works...</h2></div></div></div><p>concrete5 automatically runs the function <code class="literal">on_start</code> whenever a page is loaded, so any code that you place there in your package will get automatically run. Our example in this case is pretty useless, but you can see where the opportunities are nearly endless for developers (automatically parsing page requests, intercepting form submissions, adding CSS or JavaScript to pages, and more).</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec520"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a custom add-on package</em></span> <a id="id541" class="indexterm"/>recipe</li></ul></div></div></div></body></html>