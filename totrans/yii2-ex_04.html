<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Creating a Room through Forms"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Creating a Room through Forms</h1></div></div></div><p>This chapter explains how to write a model class to store data that will be sent from View to Controller using a form, with validating input, formatting data, and uploading files. In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a Model<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – a model to store room data</li></ul></div></li><li class="listitem" style="list-style-type: disc">Using ActiveForm<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – creating a new room from the HTML form</li></ul></div></li><li class="listitem" style="list-style-type: disc">Formatting date, time, and numbers</li><li class="listitem" style="list-style-type: disc">Uploading files<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – uploading an image of the room</li></ul></div></li></ul></div><div class="section" title="Creating a Model"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Creating a Model</h1></div></div></div><p>The first step to<a id="id148" class="indexterm"/> manipulate data between View and Controller is to create a Model. A <span class="strong"><strong>Model</strong></span> is a class that extends the <code class="literal">Model</code> class located under <code class="literal">yii\base\</code>, the base used for data models.</p><p>This is a suitable class for providing simple solutions in order to encapsulate data, assign content from array (form data), and validate data using rules. The Model base class implements the following commonly used features:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Attribute declaration</strong></span>: By <a id="id149" class="indexterm"/>default, every public class member is considered a model attribute; we can access all the members using the <code class="literal">attributes</code> property of Model.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Attribute labels</strong></span>: Each<a id="id150" class="indexterm"/> attribute may be associated with a label for display purposes; we can extend the <code class="literal">attributeLabels()</code> method to return labels related to public members of Model.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Massive attribute assignment</strong></span>: We<a id="id151" class="indexterm"/> can fill the member's content of Model by passing an entire array of values. This is convenient when we need to fill a model with data from the form.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Scenario-based validation</strong></span>: Model <a id="id152" class="indexterm"/>provides rules to validate data. We can choose which ones apply according to the scenario, a keyword that defines the rules to apply.</li></ul></div><p>While performing data validation, Model also raises the following events:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">EVENT_BEFORE_VALIDATE</code>: This is an event raised at the beginning of <code class="literal">validate()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">EVENT_AFTER_VALIDATE</code>: This is an event raised at the end of <code class="literal">validate()</code></li></ul></div><p>You can <a id="id153" class="indexterm"/>directly use Model to store model data or extend it with customization.</p><div class="section" title="Example – a Model to store room data"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec21"/>Example – a Model to store room data</h2></div></div></div><p>Now, let's create Model to store room data. To create this, we choose to name all fields with words written in lowercase characters and separated by underscores.</p><p>We can identify these fields of Model as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">floor</code>: In a more generic situation, we consider this as a string member</li><li class="listitem" style="list-style-type: disc"><code class="literal">room_number</code>: This is an integer member</li><li class="listitem" style="list-style-type: disc"><code class="literal">has_conditioner</code>: This is an integer member with two values 0 and 1</li><li class="listitem" style="list-style-type: disc"><code class="literal">has_tv</code>: This is an integer member with two values 0 and 1</li><li class="listitem" style="list-style-type: disc"><code class="literal">has_phone</code>: This is an integer member with two values 0 and 1</li><li class="listitem" style="list-style-type: disc"><code class="literal">available_from</code>: This is a date member that it is represented with a string in PHP</li><li class="listitem" style="list-style-type: disc"><code class="literal">price_per_day</code>: This is a float member</li><li class="listitem" style="list-style-type: disc"><code class="literal">assistance_email</code>: This is a string member containing an e-mail address</li><li class="listitem" style="list-style-type: disc"><code class="literal">description</code>: This is a string member</li></ul></div><p>Now, create the <code class="literal">Model</code> class, named <code class="literal">Room</code> as the base class, in the previous field list, creating a file under <code class="literal">basic/models/Room.php</code> with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;?php
namespace app\models;
use Yii;
use yii\base\Model;
class Room extends Model {
    public $floor;
    public $room_number;
    public $has_conditioner;
    public $has_tv;
    public $has_phone;
    public $available_from;
    public $price_per_day;
    public $description;
}</pre></div><p>The second thing to do is to append the <code class="literal">attributeLabels()</code> method in order to give a label to every member. This is not necessary, but it is a useful method to get labels displayed in the end user frontend.</p><div class="informalexample"><pre class="programlisting">public function attributeLabels()
{
    return [
        'floor' =&gt; 'Floor',
        'room_number' =&gt; 'Room number',
        'has_condition' =&gt; 'Condition available',
        'has_tv' =&gt; 'TV available',
        'has_phone' =&gt; 'Phone available',
        'available_from' =&gt; 'Available from',
        'price_per_day' =&gt; 'Price (EUR/day)',
        'description' =&gt; 'Description',
    ];
}</pre></div><p>The last <a id="id154" class="indexterm"/>thing is to create rules to validate data. Rules are based on validators, whose defaults are listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">boolean</code>: <code class="literal">yii\validators\BooleanValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">captcha</code>: <code class="literal">yii\captcha\CaptchaValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">compare</code>: <code class="literal">yii\validators\CompareValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">date</code>: <code class="literal">yii\validators\DateValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">double</code>: <code class="literal">yii\validators\NumberValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">email</code>: <code class="literal">yii\validators\EmailValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">exist</code>: <code class="literal">yii\validators\ExistValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">file</code>: <code class="literal">yii\validators\FileValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">filter</code>: <code class="literal">yii\validators\FilterValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">image</code>: <code class="literal">yii\validators\ImageValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">in</code>: <code class="literal">yii\validators\RangeValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">integer</code>: <code class="literal">yii\validators\NumberValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">match</code>: <code class="literal">yii\validators\RegularExpressionValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">required</code>: <code class="literal">yii\validators\RequiredValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">safe</code>: <code class="literal">yii\validators\SafeValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">string</code>: <code class="literal">yii\validators\StringValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">trim</code>: <code class="literal">yii\validators\FilterValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">unique</code>: <code class="literal">yii\validators\UniqueValidator</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">url</code>: <code class="literal">yii\validators\UrlValidator</code></li></ul></div><p>A Rule <a id="id155" class="indexterm"/>is an array whose values are in the following order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A string or an array to define an attribute or list of attributes to apply the rule</li><li class="listitem" style="list-style-type: disc">The type of validator</li><li class="listitem" style="list-style-type: disc">The <code class="literal">on</code> attribute to define which scenario to use</li><li class="listitem" style="list-style-type: disc">The other parameters, depending on the validator that is used</li></ul></div><p>Write the <code class="literal">rules()</code> method of the <code class="literal">Room</code> Model class:</p><div class="informalexample"><pre class="programlisting">/**
 * @return array the validation rules.
 */
public function rules()
{
    return [
        ['floor', 'integer', 'min' =&gt; 0],
        ['room_number', 'integer', 'min' =&gt; 0],
        [['has_conditioner', 'has_tv', 'has_phone'], 'integer', 'min' =&gt; 0, 'max' =&gt; 1],
        ['available_from', 'date', 'format' =&gt; 'php:Y-m-d'],
        ['price_per_day', 'number', 'min' =&gt; 0],
        ['description', 'string', 'max' =&gt; 500]
    ];
}</pre></div><p>The preceding code is explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first rule establishes that <code class="literal">floor</code> is an integer, with <code class="literal">0</code> as the minimum value</li><li class="listitem" style="list-style-type: disc">The second rule establishes that <code class="literal">room_number</code> is an integer, with <code class="literal">0</code> as the minimum value; we can put together floor and room in a single rule, melting them into an array as the first parameter of a single rule</li><li class="listitem" style="list-style-type: disc">The third rule establishes that <code class="literal">has_condition</code>, <code class="literal">has_tv</code>, and <code class="literal">has_phone</code> are integers with possible values between 0 and 1 (formally a Boolean value)</li><li class="listitem" style="list-style-type: disc">The fourth rule establishes that <code class="literal">available_from</code> is a date</li><li class="listitem" style="list-style-type: disc">The fifth rule establishes that <code class="literal">price_per_day</code> is a number and its minimum value is 0</li><li class="listitem" style="list-style-type: disc">The last rule establishes that <code class="literal">description</code> is a string with a maximum of 500 characters</li></ul></div><p>These <a id="id156" class="indexterm"/>rules will be applied when the <code class="literal">validate()</code> method of <code class="literal">Model</code> is called. This method is automatically called when we attempt to call the <code class="literal">save()</code> method.</p></div></div></div>
<div class="section" title="Using ActiveForm"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Using ActiveForm</h1></div></div></div><p>Now we will<a id="id157" class="indexterm"/> create an HTML form in view to send data from view to controller. We could build a form in the standard way using the form tag and input fields, but Yii2 provides helper classes that simplify the building of a form and its content.</p><p>For this purpose, we will use <code class="literal">ActiveForm</code>, a widget that builds an interactive HTML form for one or multiple data models.</p><p>As for any Yii2 widget, we will indicate with the <code class="literal">begin()</code>static method, the moment we start using it, and with the <code class="literal">end()</code>static method, the moment we stop using it, from <code class="literal">yii\widgets\ActiveForm</code>. The code between these methods will be placed in the form:</p><div class="informalexample"><pre class="programlisting">$form = ActiveForm::begin();
... content here ...
ActiveForm::end();</pre></div><p>The first method, <code class="literal">begin()</code>, returns an object that we can use inside the content to create the input fields. This method accepts an array as the parameter to indicate configuration attributes to be applied. The last method, <code class="literal">end()</code>, marks the end of the widget, so this can be rendered with its content.</p><p>Now, we need some input fields to insert in the code, which is done using the <code class="literal">field()</code> method of the <code class="literal">ActiveForm</code> instance that we just created. This method requires two parameters: model and field name and returns an object of type <code class="literal">ActiveField</code>. With this method, we just demand <code class="literal">ActiveForm</code> to create a new field; however, in this case, we also need to specify the type of field we want.</p><p>This operation is made calling a method from <code class="literal">ActiveField</code> relative to the kind of input to the instance. The most common are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">label()</code>: This is used to generate a label tag</li><li class="listitem" style="list-style-type: disc"><code class="literal">textInput()</code>: This is used to generate an input field with type <code class="literal">text</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">textarea()</code>: This is used to generate a <code class="literal">textarea</code> tag</li><li class="listitem" style="list-style-type: disc"><code class="literal">radio()</code>: This is used to generate an input field with type <code class="literal">radio</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">checkbox()</code>: This is used to generate an input field with type <code class="literal">checkbox</code></li></ul></div><div class="section" title="Example – creating a new room from the HTML form"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec22"/>Example – creating a new room from the HTML form</h2></div></div></div><p>Firstly, create a new controller, <code class="literal">RoomsController</code>, under <code class="literal">basic/controllers/RoomsController.php</code> with an action named <code class="literal">create</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php

namespace app\controllers;

use Yii;
use yii\web\Controller;
use app\models\Room;


class RoomsController extends Controller
{
    public function actionCreate()
    {
        $model = new Room();
        $modelCanSave = false;

        if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) &amp;&amp; $model-&gt;validate()) {
            $modelCanSave = true;
        }
        
        return $this-&gt;render('create', [
            'model' =&gt; $model,
            'modelSaved' =&gt; $modelCanSave
        ]);
    }
}</pre></div><p>At the start of<a id="id158" class="indexterm"/> the <code class="literal">create()</code> method, we create a new instance of the <code class="literal">Room</code> class assigned to the <code class="literal">$model</code> variable. The <code class="literal">load()</code> method fills the <code class="literal">$model</code> attributes with data taken from the key position named <code class="literal">$model-&gt;formName()</code> of an array passed as parameters. By default, <code class="literal">$model-&gt;formName()</code> returns the class name of the object, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">$model-&gt;load(Yii::$app-&gt;request-&gt;post())</pre></div><p>The preceding code is equivalent to:</p><div class="informalexample"><pre class="programlisting">if (isset($_POST[$model-&gt;formName()])) {
  $this-&gt;setAttributes($_POST[$model-&gt;formName()]);
}</pre></div><p>Going back to the <code class="literal">load()&amp;&amp;validate()</code> condition, if <code class="literal">load()</code> returns true, <code class="literal">validate()</code> will also be executed and all rules in the <code class="literal">rules()</code> method of model will be evaluated.</p><p>In this case, <code class="literal">Model</code> is ready to be saved to the data store (in the database in the next chapters). Now, it is important to mark this condition with a simple variable named <code class="literal">$modelCanSave</code>, passed to the <code class="literal">create</code> view.</p><p>Create a<a id="id159" class="indexterm"/> file for the <code class="literal">create</code> view under <code class="literal">basic/views/rooms/create.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
use yii\helpers\Html;
use yii\widgets\ActiveForm;
use yii\helpers\Url;
use yii\helpers\ArrayHelper;
?&gt;

&lt;?php if($modelCanSave) { ?&gt;
&lt;div class="alert alert-success"&gt;
    Model ready to be saved!
&lt;/div&gt;
&lt;?php } ?&gt;

&lt;?php $form = ActiveForm::begin(); ?&gt;
&lt;div class="row"&gt;
    &lt;div class="col-lg-12"&gt;
        &lt;h1&gt;Room form&lt;/h1&gt;
        &lt;?= $form-&gt;field($model, 'floor')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'room_number')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'has_conditioner')-&gt;checkbox() ?&gt;
        &lt;?= $form-&gt;field($model, 'has_tv')-&gt;checkbox() ?&gt;
        &lt;?= $form-&gt;field($model, 'has_phone')-&gt;checkbox() ?&gt;
        &lt;?= $form-&gt;field($model, 'available_from')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'price_per_day')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'description')-&gt;textarea() ?&gt;
   &lt;/div&gt;
&lt;/div&gt;
&lt;div class="form-group"&gt;
    &lt;?= Html::submitButton('Create' , ['class' =&gt; 'btn btn-success']) ?&gt;
&lt;/div&gt;
&lt;?php ActiveForm::end(); ?&gt;</pre></div><p>If the <code class="literal">$modelCanSave</code> variable is true, an <code class="literal">alert</code> div with the green background will be displayed to notify that <code class="literal">$model</code> is loaded and validate (ready to be saved in database).</p><p>For the test code, point to <code class="literal">http://hostname/basic/web/rooms/create</code>. The following screen should appear:</p><div class="mediaobject"><img src="graphics/B04656_04_01.jpg" alt="Example – creating a new room from the HTML form"/><div class="caption"><p>Create room HTML form</p></div></div><p>The <a id="id160" class="indexterm"/>framework automatically takes care of the validation checks on input fields, corresponding to the rules list in the <code class="literal">rules()</code> method of Model. We can check this by typing characters in the <span class="strong"><strong>Floor</strong></span> input. We should see the following screenshot:</p><div class="mediaobject"><img src="graphics/B04656_04_02.jpg" alt="Example – creating a new room from the HTML form"/><div class="caption"><p>The validation check of the integer field</p></div></div><p>The validation informs us that <span class="strong"><strong>Floor</strong></span> must be an integer, as required in the rules list. Once all the fields are filled with correct values (date format, yyyy-mm-dd), just click on the <span class="strong"><strong>Create</strong></span> button and we should see a box with green background displaying <span class="strong"><strong>Model ready to be saved</strong></span>.</p></div></div>
<div class="section" title="Format date, time, and numbers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Format date, time, and numbers</h1></div></div></div><p>Now, let's see how to <a id="id161" class="indexterm"/>format the date, time, and numeric fields. Yii2 provides helpers<a id="id162" class="indexterm"/> for <a id="id163" class="indexterm"/>each of these types.</p><p>To format a value, we will use <code class="literal">Yii::$app-&gt;formatter</code>; this object belongs to the <code class="literal">Formatter</code> class located under <code class="literal">yii\i18n\</code> and supports many types of formatting. All the methods used for this purpose start with an <code class="literal">as</code> prefix. Therefore, the <code class="literal">asDate</code> method will be used to format dates, and the <code class="literal">asCurrency</code> method will be used to format currencies.</p><p>The first parameter of each formatting method is the value to be formatted and other fields refer to the format to be used and other optional parameters.</p><p>Let's change the view content by adding content of the Model that is ready to be saved:</p><div class="informalexample"><pre class="programlisting">&lt;?php if($modelCanSave) { ?&gt;
&lt;div class="alert alert-success"&gt;
    Model ready to be saved!
    &lt;br /&gt;&lt;br /&gt;
    These are values: &lt;br /&gt;
    Floor: &lt;?php echo $model-&gt;floor; ?&gt; &lt;br /&gt;
    Room Number: &lt;?php echo $model-&gt;room_number; ?&gt; &lt;br /&gt;
    Has conditioner: &lt;?php echo Yii::$app-&gt;formatter-&gt;asBoolean($model-&gt;has_conditioner); ?&gt; &lt;br /&gt;
    Has TV: &lt;?php echo Yii::$app-&gt;formatter-&gt;asBoolean($model-&gt;has_tv); ?&gt; &lt;br /&gt;
    Has phone: &lt;?php echo Yii::$app-&gt;formatter-&gt;asBoolean($model-&gt;has_phone); ?&gt; &lt;br /&gt;
    Available from (mm/dd/yyyy): &lt;?php echo Yii::$app-&gt;formatter-&gt;asDate($model-&gt;available_from,'php:m/d/Y'); ?&gt; &lt;br /&gt;
    Price per day: &lt;?php echo Yii::$app-&gt;formatter-&gt;asCurrency($model-&gt;price_per_day,'EUR'); ?&gt; &lt;br /&gt;
    
&lt;/div&gt;
&lt;?php } ?&gt;</pre></div><p>If <code class="literal">$model</code> is ready to be saved, in the box with the green background, we will have the output of each of the fields of Model.</p><p>In this example, we have used:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">boolean</code> formatter for <code class="literal">has_condition</code>, <code class="literal">has_tv</code>, and <code class="literal">has_phone</code> members uses the default representation of false and true values; defaults are <code class="literal">No</code> for false and <code class="literal">Yes</code> for true, but we can change this behavior setting in the <code class="literal">$booleanFormat</code> member of <code class="literal">Yii::$app-&gt;formatter</code></li><li class="listitem" style="list-style-type: disc">The <code class="literal">date</code> formatter for <code class="literal">available_from member</code> takes the date format to be used as the second parameter; this date format can be represented with PHP date function style or ICU standard</li><li class="listitem" style="list-style-type: disc">The <code class="literal">currency</code> formatter for the <code class="literal">price_per_day</code> member is the second parameter with three characters type of currency to be used</li></ul></div><p>This is how the <a id="id164" class="indexterm"/>box with the<a id="id165" class="indexterm"/> content of Model<a id="id166" class="indexterm"/> appears:</p><div class="mediaobject"><img src="graphics/B04656_04_03.jpg" alt="Format date, time, and numbers"/><div class="caption"><p>Show summary of Model content when validation is successful</p></div></div></div>
<div class="section" title="Uploading files"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Uploading files</h1></div></div></div><p>The common<a id="id167" class="indexterm"/> task when data is sent from view to controller is uploading files. Also, in this case, Yii2 provides a convenient helper to handle this task: <code class="literal">yii\web\UploadedFile</code>. This class has two important methods: <code class="literal">getInstance()</code> (in plural form <code class="literal">getInstances()</code>) and <code class="literal">saveAs()</code>.</p><p>The first method, <code class="literal">getInstance()</code>, allows us to get the file from the form's input field, while the second method, <code class="literal">saveAs()</code>, as its name implies, allows us to save file input field content to the server filesystem.</p><p>Before we start with the example, it is important to create a folder that will contain the uploaded files. The best place to create this folder is at the root directory of the application. So create a folder named <code class="literal">uploadedfiles</code> under the <code class="literal">basic/</code> folder.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>Make sure that this folder is writable.</p></div></div><p>Next, to centralize configuration, define an alias for this new folder, so that we can change this path from app configuration. Enter in <code class="literal">basic/config/web.php</code> and append the <code class="literal">aliases</code> property, if it<a id="id168" class="indexterm"/> does not exist, to the <code class="literal">$config</code> array with these lines:</p><div class="informalexample"><pre class="programlisting">'aliases' =&gt;
[
        '@uploadedfilesdir' =&gt; '@app/uploadedfiles'
],</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>
<code class="literal">@app</code> is a system aliases that defines the application's root directory.</p></div></div><div class="section" title="Example – uploading an image of a room"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec23"/>Example – uploading an image of a room</h2></div></div></div><p>In this example, we will<a id="id169" class="indexterm"/> see how to upload an image of a room.</p><p>We need to make changes in model, view, and controller. Let's start with model.</p><p>In model, we need to add a new property, named <code class="literal">fileImage</code>, with its specific rule.</p><p>This is the final version of Model:</p><div class="informalexample"><pre class="programlisting">&lt;?php
namespace app\models;
use Yii;
use yii\base\Model;
class Room extends Model
{
    public $floor; 
    public $room_number;
    public $has_conditioner;
    public $has_tv;
    public $has_phone;
    public $available_from;
    public $price_per_day;
    public $description;
    
    public $fileImage;
    
    public function attributeLabels()
    {
        return [
            'floor' =&gt; 'Floor',
            'room_number' =&gt; 'Room number',
            'has_conditioner' =&gt; 'Conditioner available',
            'has_tv' =&gt; 'TV available',
            'has_phone' =&gt; 'Phone available',
            'available_from' =&gt; 'Available from',
            'price_per_day' =&gt; 'Price (Eur/day)',
            'description' =&gt; 'Description',
            'fileImage' =&gt; 'Image'
        ];
    }
    
    /**
     * @return array the validation rules.
     */
    public function rules()
    {
        return [
            ['floor', 'integer', 'min' =&gt; 0],
            ['room_number', 'integer', 'min' =&gt; 0],
            [['has_conditioner', 'has_tv', 'has_phone'], 'integer', 'min' =&gt; 0, 'max' =&gt; 1],
            ['available_from', 'date', 'format' =&gt; 'php:Y-m-d'],
            ['price_per_day', 'number', 'min' =&gt; 0],
            ['description', 'string', 'max' =&gt; 500],
            
            ['fileImage', 'file']
        ];
    } 
}</pre></div><p>In rules, for the <code class="literal">fileImage</code> field, we can add many types of validation; for example, check if required, check mime type (<code class="literal">.gif</code>, <code class="literal">.jpeg</code>, and <code class="literal">.png</code>).</p><p>Next, we will use <a id="id170" class="indexterm"/>the static method <code class="literal">getInstance()</code> of the <code class="literal">UploadedFile</code> class in controller, to get the file from the input file field and then use <code class="literal">saveAs</code> to save in the specific folder. This is the final version of <code class="literal">RoomsController</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php

namespace app\controllers;

use Yii;
use yii\web\Controller;
use app\models\Room;

class RoomsController extends Controller
{
    public function actionCreate()
    {
        $model = new Room();
        $modelCanSave = false;

        if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) &amp;&amp; $model-&gt;validate()) {

            $model-&gt;fileImage = UploadedFile::getInstance($model, 'fileImage');

            if ($model-&gt;fileImage) { 
                $model-&gt;fileImage-&gt;saveAs(Yii::getAlias('@uploadedfilesdir/' . $model-&gt;fileImage-&gt;baseName . '.' . $model-&gt;fileImage-&gt;extension)));
            } 
            
            $modelCanSave = true;
        }
        
        return $this-&gt;render('create', [
            'model' =&gt; $model,
            'modelSaved' =&gt; $modelCanSave
        ]);
    }
}</pre></div><p>
<code class="literal">UploadedFile::getInstance</code> gets the file from the <code class="literal">$_FILES</code> array to fill the <code class="literal">fileImage</code> property of Model with its data.</p><p>The last thing to do<a id="id171" class="indexterm"/> is to update the <code class="literal">create</code> view content, by appending the <code class="literal">fileInput</code> field. This is the final version:</p><div class="informalexample"><pre class="programlisting">&lt;?php
use yii\helpers\Html;
use yii\widgets\ActiveForm;
use yii\helpers\Url;
use yii\helpers\ArrayHelper;
?&gt;

&lt;?php if($modelCanSave) { ?&gt;
&lt;div class="alert alert-success"&gt;
    Model ready to be saved!
    &lt;br /&gt;&lt;br /&gt;
    These are values: &lt;br /&gt;
    Floor: &lt;?php echo $model-&gt;floor; ?&gt; &lt;br /&gt;
    Room Number: &lt;?php echo $model-&gt;room_number; ?&gt; &lt;br /&gt;
    Has conditioner: &lt;?php echo Yii::$app-&gt;formatter-&gt;asBoolean($model-&gt;has_conditioner); ?&gt; &lt;br /&gt;
    Has TV: &lt;?php echo Yii::$app-&gt;formatter-&gt;asBoolean($model-&gt;has_tv); ?&gt; &lt;br /&gt;
    Has phone: &lt;?php echo Yii::$app-&gt;formatter-&gt;asBoolean($model-&gt;has_phone); ?&gt; &lt;br /&gt;
    Available from (mm/dd/yyyy): &lt;?php echo Yii::$app-&gt;formatter-&gt;asDate($model-&gt;available_from,'php:m/d/Y'); ?&gt; &lt;br /&gt;
    Price per day: &lt;?php echo Yii::$app-&gt;formatter-&gt;asCurrency($model-&gt;price_per_day,'EUR'); ?&gt; &lt;br /&gt;
    Image:
    &lt;?php if(isset($model-&gt;fileImage)) { ?&gt;
        &lt;img src="&lt;?php echo Url::to('@uploadedfilesdir/'.$model-&gt;fileImage-&gt;name) ?&gt;" /&gt;
    &lt;?php } ?&gt;
&lt;/div&gt;
&lt;?php } ?&gt;

&lt;?php $form = ActiveForm::begin(['options' =&gt; ['enctype' =&gt; 'multipart/form-data']]); ?&gt;  
&lt;div class="row"&gt;
    &lt;div class="col-lg-12"&gt;
        &lt;h1&gt;Room form&lt;/h1&gt;
        &lt;?= $form-&gt;field($model, 'floor')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'room_number')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'has_conditioner')-&gt;checkbox() ?&gt;
        &lt;?= $form-&gt;field($model, 'has_tv')-&gt;checkbox() ?&gt;
        &lt;?= $form-&gt;field($model, 'has_phone')-&gt;checkbox() ?&gt;
        &lt;?= $form-&gt;field($model, 'available_from')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'price_per_day')-&gt;textInput() ?&gt;
        &lt;?= $form-&gt;field($model, 'description')-&gt;textarea() ?&gt;
        
        
        &lt;?= $form-&gt;field($model, 'fileImage')-&gt;fileInput() ?&gt;
   &lt;/div&gt;
&lt;/div&gt;
&lt;div class="form-group"&gt;
    &lt;?= Html::submitButton('Create' , ['class' =&gt; 'btn btn-success']) ?&gt;
&lt;/div&gt;
&lt;?php ActiveForm::end(); ?&gt;</pre></div><p>Take care of the last<a id="id172" class="indexterm"/> row of this example, <code class="literal">ActiveForm::end()</code> that closes the body of the <code class="literal">$form</code> widget defined at the top of the file using the <code class="literal">ActiveForm::begin()</code> method.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>In this example, the <code class="literal">ActiveForm</code> widget has been created by filling the <code class="literal">enctype</code> property of the configuration array with the <code class="literal">multipart/form-data</code> value, which allows us to send the binary data other than the form text parameters. However, this does not deal with Yii or PHP, because this is an HTML requirement for notifying the browser how to send files to the server.</p></div></div><p>In this view, if the <a id="id173" class="indexterm"/>model has been validated and the <code class="literal">fileImage</code> property is filled, the corresponding image will be displayed.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Summary</h1></div></div></div><p>In this chapter, we saw how to build a Model class from scratch and send data from view to controller using form, created using Yii2 ActiveForm widget. We also looked at the common useful methods to format data and sent files from the form.</p><p>In the next chapter, you will learn how to work with databases and save model data from view form to database.</p></div></body></html>