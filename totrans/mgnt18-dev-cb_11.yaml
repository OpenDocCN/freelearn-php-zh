- en: Chapter 11. Performance Optimization
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 11 章。性能优化
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Exploring the limits of a website
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索网站的极限
- en: Optimizing the database and MySQL configuration
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优化数据库和 MySQL 配置
- en: Optimizing the Apache web server
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优化 Apache 网络服务器
- en: Tuning the Magento configurations
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整 Magento 配置
- en: Configuring APC and Memcached
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 APC 和 Memcached
- en: Optimizing the PHP configurations
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优化 PHP 配置
- en: Analyzing the page speed
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析页面速度
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: For athletes, seconds, milliseconds, or hundredths of seconds decide if they
    will win a competition or not. Every small aspect that improves the performance
    is a step in the right direction to win the competition.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 对于运动员来说，秒、毫秒或千分秒可能决定他们是否能赢得比赛。每一个提高性能的小方面都是赢得比赛正确方向上的一步。
- en: For websites, it is the same. The faster your Magento store is, the better it
    is. Magento is not one of the most efficient systems when it comes to performance.
    Especially when you are working with a lot of products and attributes, a good
    setup improves the performance of your webshop.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 对于网站来说，情况相同。您的 Magento 商店越快，效果越好。在性能方面，Magento 不是最有效的系统之一。尤其是当您处理大量产品和属性时，良好的设置可以提高您的网店性能。
- en: 'The performance of a website has a lot of impact on your visitors. Some facts
    about this statement are listed as follows:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 网站的性能对您的访客有很大影响。以下是一些关于这个陈述的事实：
- en: The page speed has a significant influence on the page ranking in search engines
    such as Google
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 页面速度对搜索引擎如 Google 的页面排名有显著影响
- en: On an e-commerce site, every second costs 1 percent of the sales total
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在电子商务网站上，每一秒都意味着销售额总量的 1% 的损失
- en: You get more visitors from search engines when you reduce the page size
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当您减少页面大小时，您可以从搜索引擎中获得更多访客。
- en: As you can see, performance is a key part to improve the SEO of your website.
    Customers will leave your website when it does not show a good performance.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，性能是提高您网站 SEO 的关键部分。当网站表现不佳时，客户会离开您的网站。
- en: Since you have finished the development, it is time to take a look at the performance
    of the whole system. In this chapter, we will explore, detect, and fix performance
    leaks in a Magento webshop by using many tools.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 既然您已经完成了开发，是时候看看整个系统的性能了。在本章中，我们将使用许多工具来探索、检测和修复 Magento 网上商店的性能泄漏。
- en: 'Some tools are delivered by Magento as standard, but we have to look at the
    whole picture. Two identical Magento installations can have different page speed
    results that are caused by the following reasons:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 一些工具是作为 Magento 标准版提供的，但我们必须全面考虑。两个相同的 Magento 安装可能会有不同的页面速度结果，这可能是以下原因造成的：
- en: Hardware
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬件
- en: Network
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络
- en: Load
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载
- en: Device of the client
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端设备
- en: Exploring the limits of a website
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索网站的极限
- en: One of the first things you need to know are the limits of the current website.
    How much capacity has my website got? What is slowing down my site? We have to
    get an overview of all these aspects to arrive at a conclusion of which optimizations
    will have the most effect.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要了解的第一件事是当前网站的局限性。我的网站有多少容量？是什么减慢了我的网站？我们必须对所有这些方面有一个全面的了解，以便得出哪种优化效果最显著的结论。
- en: 'In this recipe, we will see some tools that help to create a view of the performance.
    Some of the tools are listed as follows:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将看到一些有助于创建性能视图的工具。以下是一些工具的列表：
- en: ApacheBench
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ApacheBench
- en: Siege
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Siege
- en: Magento Profiler
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Magento Profiler
- en: YSlow
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: YSlow
- en: PageSpeed
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PageSpeed
- en: GTmetrix
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GTmetrix
- en: WebPagetest
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WebPagetest
- en: We will do some tests with all these tools to work out the pitfalls of a Magento
    store. With these results, we can find out what kind of optimizations have the
    most effect.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将对所有这些工具进行一些测试，以找出 Magento 商店的潜在问题。有了这些结果，我们可以找出哪些优化效果最显著。
- en: Some optimizations are very easy and can have a large effect. Other optimizations
    are difficult and can have less effect. It is on you to decide what you want.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一些优化非常简单，可以产生很大的效果。其他优化则比较困难，效果可能较小。决定权在您手中。
- en: Getting ready
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'To start, it is recommended to install the following tools to do some performance
    tests on a Magento installation:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，建议安装以下工具，以便对 Magento 安装进行一些性能测试：
- en: '**ApacheBench** (**ab**): This tool is automatically installed with the Apache
    web server. When you have access to the command line interface, you can run the
    following command on a Linux server:'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ApacheBench** (**ab**)：此工具与 Apache 网络服务器自动安装。当您有权访问命令行界面时，您可以在 Linux 服务器上运行以下命令：'
- en: '[PRE0]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Siege**: We will do some performance tests with Siege that is installed on
    the same server as Magento. To see if it is installed, you can run the following
    command:'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Siege**：我们将使用安装在同一个服务器上的Siege进行一些性能测试。为了查看它是否已安装，你可以运行以下命令：'
- en: '[PRE1]'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Here, make sure that `V` is uppercase. When Siege is installed, you will see
    its version number as shown in the following screenshot:![Getting ready](img/3329OS_11_01.jpg)
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这里，请确保`V`是大写字母。当Siege安装后，你将看到其版本号，如下面的截图所示：![准备中](img/3329OS_11_01.jpg)
- en: 'If it is not installed, you can run the following command when you are using
    a Debian-based Linux distribution:'
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你使用的是基于Debian的Linux发行版，并且它尚未安装，你可以运行以下命令：
- en: '[PRE2]'
  id: totrans-43
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'A second option is to download the installation file and install it by performing
    the following procedure:'
  id: totrans-44
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第二种选择是下载安装文件，并按照以下步骤进行安装：
- en: 'To download the archive, run the following command:'
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要下载存档，请运行以下命令：
- en: '[PRE3]'
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To extract the archive, run the following command:'
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要提取存档，请运行以下命令：
- en: '[PRE4]'
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Move the folder to the preferred location and change the directory.
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将文件夹移动到首选位置并更改目录。
- en: 'Install Siege with the following command:'
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装Siege：
- en: '[PRE5]'
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '**Magento Profile**: This is a standard feature in Magento. You can enable
    it in your system''s configuration.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Magento配置文件**：这是Magento中的一个标准功能。你可以在系统配置中启用它。'
- en: '**YSlow**: This is a Firefox plugin that you can download and install from
    the Add-ons store.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**YSlow**：这是一个可以从附加组件商店下载和安装的Firefox插件。'
- en: Because **GTMetrix** and **WebPagetest** are online tools, we don't have to
    install them.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 因为**GTMetrix**和**WebPagetest**是在线工具，所以我们不需要安装它们。
- en: How to do it...
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'To get an idea of the response time under a load of concurrent users, we can
    use ApacheBench. We will perform a test with the following command and save the
    results to a CSV file:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了了解在并发用户负载下的响应时间，我们可以使用ApacheBench。我们将使用以下命令进行测试，并将结果保存到CSV文件中：
- en: '[PRE6]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In the previous command, we did a load test with the following parameters:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上一个命令中，我们使用以下参数进行了负载测试：
- en: '`-c`: This parameter represents the number of concurrent users. In this test,
    there were always 10 requests running at the same time.'
  id: totrans-59
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-c`：此参数表示并发用户数。在这个测试中，始终有10个请求同时运行。'
- en: '`-n`: This parameter represents the number of requests. In this case it is
    50, so we will have 50 results in the file.'
  id: totrans-60
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-n`：此参数表示请求数量。在这种情况下是50，所以我们将有50个结果在文件中。'
- en: '`-e`: This parameter represents the output file. The output is written to the
    given CSV file.'
  id: totrans-61
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-e`：此参数表示输出文件。输出将写入给定的CSV文件。'
- en: Tip
  id: totrans-62
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: The `-g` option means the same as `-e` but `-g` will generate a **.tsv** (**tab
    separated value**) file, also known as a gnuplot file.
  id: totrans-63
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`-g`选项与`-e`选项含义相同，但`-g`会生成一个**.tsv**（制表符分隔值）文件，也称为gnuplot文件。'
- en: When you run the command, an output screen with the results will be printed
    as shown in the following screenshot:![How to do it...](img/3329OS_11_02.jpg)
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你运行命令时，一个带有结果的输出屏幕将被打印出来，如下面的截图所示：![如何做...](img/3329OS_11_02.jpg)
- en: This report shows the general statistics of the test. The specific results are
    saved in the CSV file.
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此报告显示了测试的一般统计数据。具体结果保存在CSV文件中。
- en: When you run the `ab -h` command, you will see all the available options.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你运行`ab -h`命令时，你会看到所有可用的选项。
- en: Load testing with Siege.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Siege进行负载测试。
- en: Siege is another load testing tool like ApacheBench. The difference between
    Siege and ApacheBench is that Siege has more functions than ApacheBench. It is
    designed to do a stress test with a number of concurrent users. It has the ability
    to work with HTTP authentication, cookies, sessions, and more. When you write
    a good script, you can simulate a real stress situation.
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Siege是另一个类似于ApacheBench的负载测试工具。Siege与ApacheBench的区别在于，Siege比ApacheBench有更多功能。它被设计用来进行多个并发用户的压力测试。它具有与HTTP身份验证、cookies、会话等一起工作的能力。当你编写一个好的脚本时，你可以模拟一个真实的压力情况。
- en: 'For a load test with Siege, we will use a text file, where we will set some
    URLs that will be used during the Siege load test. Doing a test with different
    URLs is better because you will test more pages on your website, which means that
    you can find more pitfalls. Create a `siege_url.txt` file and paste the following
    content in it:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于使用Siege进行的负载测试，我们将使用一个文本文件，在其中我们将设置一些在Siege负载测试期间将使用的URL。使用不同的URL进行测试更好，因为你可以测试你网站上更多的页面，这意味着你可以找到更多的陷阱。创建一个`siege_url.txt`文件，并将以下内容粘贴到其中：
- en: '`http://magento-dev.local/`'
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/bkg_body.gif`'
  id: totrans-71
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/bkg_body.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/logo.gif`'
  id: totrans-72
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/logo.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/ph_callout_left_top.gif`'
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/ph_callout_left_top.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/ph_callout_left_rebel.jpg`'
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/ph_callout_left_rebel.jpg`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/home_main_callout.jpg`'
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/home_main_callout.jpg`'
- en: '`http://magento-dev.local/index.php/electronics.html`'
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/electronics.html`'
- en: '`http://magento-dev.local/index.php/electronics.html?cat=12`'
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/electronics.html?cat=12`'
- en: '`http://magento-dev.local/index.php/checkout/cart/add/product/46/`'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/checkout/cart/add/product/46/`'
- en: '`http://magento-dev.local/index.php/checkout/cart/`'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/checkout/cart/`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/i_shipping.gif`'
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/i_shipping.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/i_discount.gif`'
  id: totrans-81
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/i_discount.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/btn_trash.gif`'
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/btn_trash.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/bkg_th.gif`'
  id: totrans-83
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/bkg_th.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/i_msg-success.gif`'
  id: totrans-84
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/i_msg-success.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/btn_checkout.gif`'
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/btn_checkout.gif`'
- en: '`http://magento-dev.local/index.php/checkout/onepage/`'
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/checkout/onepage/`'
- en: '`http://magento-dev.local/js/varien/accordion.js`'
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/js/varien/accordion.js`'
- en: '`http://magento-dev.local/skin/frontend/base/default/js/opcheckout.js`'
  id: totrans-88
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/base/default/js/opcheckout.js`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/opc-ajax-loader.gif`'
  id: totrans-89
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/opc-ajax-loader.gif`'
- en: '`http://magento-dev.local/skin/frontend/default/default/images/cvv.gif`'
  id: totrans-90
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/skin/frontend/default/default/images/cvv.gif`'
- en: '`http://magento-dev.local/index.php/checkout/onepage/progress/?toStep=billing`'
  id: totrans-91
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/checkout/onepage/progress/?toStep=billing`'
- en: '`http://magento-dev.local/index.php/electronics/cameras/accessories/universal-camera-case`'
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/electronics/cameras/accessories/universal-camera-case`'
- en: '`http://magento-dev.local/index.php/tag/product/list/tagId/185/`'
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/tag/product/list/tagId/185/`'
- en: '`http://magento-dev.local/index.php/tag/product/list/tagId/27/`'
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/tag/product/list/tagId/27/`'
- en: '`http://magento-dev.local/index.php/customer/account/login/`'
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http://magento-dev.local/index.php/customer/account/login/`'
- en: You can change the URLs so that they match your Magento configuration. Make
    sure that the domain matches your configuration and that the URLs exist.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以更改 URL，使其与您的 Magento 配置匹配。确保域名与您的配置匹配，并且 URL 存在。
- en: 'Run the following command to start the load test with 50 concurrent users:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行以下命令以启动具有 50 个并发用户的负载测试：
- en: '[PRE7]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The period for which this script will run depends on the webshop''s performance.
    The output of the command is shown as follows:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此脚本运行的周期取决于网店的性能。命令的输出如下所示：
- en: '[PRE8]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: With the Siege `-h` command, you can see all the available options.
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 Siege `-h` 命令，您可以看到所有可用选项。
- en: We continue with the configuration of Magento Profiler. To enable the Magento
    Profiler, open the backend and navigate to **System** | **Configuration** | **Advanced**
    | **Developer** | **Debug**. Configure the **Profiler** field as shown in the
    following screenshot:![How to do it...](img/3329OS_11_03.jpg)
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们继续配置 Magento Profiler。要启用 Magento Profiler，请打开后台并导航到 **系统** | **配置** | **高级**
    | **开发者** | **调试**。配置 **Profiler** 字段，如以下屏幕截图所示：![如何操作...](img/3329OS_11_03.jpg)
- en: 'To see some more statistics, uncomment the following line in the `index.php`
    file:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看更多统计信息，请在 `index.php` 文件中取消以下行的注释：
- en: '[PRE9]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: When you reload the frontend, you will see a grid as shown in the following
    screenshot:![How to do it...](img/3329OS_11_04.jpg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您重新加载前端时，您将看到以下屏幕截图所示的网格：![如何操作...](img/3329OS_11_04.jpg)
- en: In the previous screenshot, you can see the execution time and memory that is
    used for each function that is executed. This can help you to find a performance
    leak.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前面的屏幕截图中，您可以查看每个执行函数的执行时间和内存使用情况。这可以帮助您找到性能泄漏。
- en: Next, we will install YSlow in Firefox.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将安装 YSlow 到 Firefox 中。
- en: YSlow is a Firefox plugin that is installed with Firebug
  id: totrans-108
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: YSlow 是一个与 Firebug 一起安装的 Firefox 插件
- en: To open YSlow, open Firebug by pressing *F12* or by clicking on the icon in
    the Add-ons bar.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要打开YSlow，可以通过按*F12*键或点击附加组件栏中的图标来打开Firebug。
- en: After Firebug starts, open the YSlow tab.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Firebug启动后，打开YSlow标签页。
- en: Check that the **Ruleset** dropdown is set to **YSlow(V2)**.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认**规则集**下拉菜单设置为**YSlow(V2)**。
- en: Start the test by clicking on the **Run Test** button.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击**运行测试**按钮开始测试。
- en: 'YSlow performs some tests and then displays the results of these tests as shown
    in the following screenshot:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: YSlow执行一些测试，然后显示如下截图所示的测试结果：
- en: '![How to do it...](img/3329OS_11_05.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![如何做...](img/3329OS_11_05.jpg)'
- en: How it works...
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We started with ApacheBench, which is a tool that is installed with the Apache
    web server. This tool is designed to benchmark the HTTP requests.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从ApacheBench开始，这是一个与Apache Web服务器一起安装的工具。此工具旨在对HTTP请求进行基准测试。
- en: We performed a test with a number of concurrent users. When you test with a
    load of 10 concurrent users, you will simulate a continuous load of 10 requests
    during the time of the test. When a request is finished, a new one is fired, so
    there are always 10 processes running.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用多个并发用户进行了测试。当你用10个并发用户进行测试时，你将模拟测试期间持续的10个请求的负载。当一个请求完成时，会触发一个新的请求，所以总是有10个进程在运行。
- en: When you limit the time of the test to 30 seconds, you can see how many successful
    requests your Apache server has finished during that time. This can give you a
    good idea of the capacity your web server has.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 当你将测试时间限制为30秒时，你可以看到在这段时间内你的Apache服务器完成了多少个成功的请求。这可以给你一个关于你的Web服务器容量的良好印象。
- en: Siege is a tool similar to ApacheBench. The main difference is that Siege has
    more options than ApacheBench. In this recipe, we did a load test with a list
    of URLs. In this list, you can add products to the cart by creating POST requests
    to simulate a human flow on the webshop. Mostly, product pages are cached but
    session-specific flows, such as the checkout, can't be cached and will generate
    more load on your server.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: Siege是一个与ApacheBench类似的工具。主要区别在于Siege比ApacheBench有更多的选项。在这个菜谱中，我们使用URL列表进行了负载测试。在这个列表中，你可以通过创建POST请求将产品添加到购物车中，以模拟网络商店上的人类流量。通常，产品页面是缓存的，但特定于会话的流程，如结账，不能缓存，这将在你的服务器上产生更多的负载。
- en: Tip
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: With ApacheBench and Siege, you can create load on a website. While doing this
    on a remote website, it is possible that you will be blocked by a firewall because
    many requests from the same host appear like an attack.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 使用ApacheBench和Siege，你可以在网站上创建负载。在远程网站上执行此操作时，你可能会因为来自同一主机的许多请求看起来像攻击而被防火墙阻止。
- en: The performance of a web page depends on many factors. YSlow has bundled the
    most important factors and runs a test with these factors. The parameters are
    bundled in rulesets. The ruleset we used is the YSlow (V2) that contains most
    of the checks. You can choose some others or create your own.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 一个网页的性能取决于许多因素。YSlow捆绑了最重要的因素，并使用这些因素进行测试。参数捆绑在规则集中。我们使用的规则集是包含大多数检查的YSlow (V2)。你可以选择其他一些或创建自己的规则集。
- en: When the test runs, YSlow will check all the factors that are in the ruleset.
    For every factor, it will give a score. The average of all scores is multiplied
    by the weight of each factor. The weight depends on the impact of every factor
    on the performance of a website.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 当测试运行时，YSlow将检查规则集中所有的因素。对于每个因素，它都会给出一个分数。所有分数的平均值乘以每个因素的权重。权重取决于每个因素对网站性能的影响。
- en: In the report generated by YSlow, suggestions are made to get a better score
    on every specific part. It is up to you to decide which option you will choose
    to optimize your site.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在YSlow生成的报告中，针对每个特定部分提出了改进建议。选择哪种选项来优化你的网站取决于你。
- en: There's more...
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'When your site is on a public URL, you can use some online tools to show a
    report of your site''s performance. These tools will look at your site and generate
    a report on it. It will make some suggestions just like YSlow does:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的网站在公共URL上时，你可以使用一些在线工具来显示你网站性能的报告。这些工具将查看你的网站并生成报告。它们会提出一些建议，就像YSlow做的那样：
- en: '**WebPagetest**: This tool can be found at [http://www.webpagetest.org/](http://www.webpagetest.org/)'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**WebPagetest**：这个工具可以在[http://www.webpagetest.org/](http://www.webpagetest.org/)找到。'
- en: '**GTmetrix**: This tool can be found at [http://gtmetrix.com/](http://gtmetrix.com/)'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**GTmetrix**：这个工具可以在[http://gtmetrix.com/](http://gtmetrix.com/)找到。'
- en: Optimizing the database and MySQL configuration
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化数据库和MySQL配置
- en: When scaling a Magento website, you will have one part that will be a hard job
    and that is the MySQL database. You can scale your shop with multiple servers
    but the database is a central storage of all the data of the website, which is
    not so easy to scale because everything needs to be in sync. In this recipe, we
    will optimize the Magento MySQL database and the MySQL server.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 当扩展Magento网站时，您将有一个部分是件困难的工作，那就是MySQL数据库。您可以使用多个服务器来扩展您的商店，但数据库是网站所有数据的中央存储，因为它需要同步，所以并不容易扩展。在这个食谱中，我们将优化Magento
    MySQL数据库和MySQL服务器。
- en: Getting ready
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Log in to phpMyAdmin and navigate to the next page that shows the information
    about the database.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 登录phpMyAdmin并导航到显示数据库信息的下一页。
- en: How to do it...
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The first step is to optimize the table structures of the Magento database.
    Take a look at the following procedure:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是优化Magento数据库的表结构。请查看以下步骤：
- en: When you are in phpMyAdmin, click on the Magento database, and you will see
    the table overview.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您在phpMyAdmin中时，点击Magento数据库，您将看到表概览。
- en: At the bottom of this page, click on the **check all** button.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在页面底部，点击**全选**按钮。
- en: When you click on the drop-down list, you can repair the table and optimize
    it, as shown in the following screenshot:![How to do it...](img/3329OS_11_06.jpg)
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您点击下拉列表时，您可以修复表并优化它，如下面的截图所示：![如何操作...](img/3329OS_11_06.jpg)
- en: Tip
  id: totrans-138
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Make sure you run this action for all the tables in the Magento database. It
    could happen that the list is separated and presented in multiple pages.
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 确保您为Magento数据库中的所有表运行此操作。列表可能会被分隔并在多页中展示。
- en: When you have repaired and optimized everything, your MySQL database is optimized.
    You can also replicate the database with the Master/Slave setup as we have done
    in the *Configuring a Master/Slave setup* recipe in [Chapter 5](ch05.html "Chapter 5. Database
    Concepts"), *Database Concepts*.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您修复并优化了所有内容后，您的MySQL数据库已优化。您还可以使用与我们在[第5章](ch05.html "第5章。数据库概念")中*配置主/从设置*食谱中所做的相同方式，通过主/从设置来复制数据库。
- en: 'The second step is the optimization of the MySQL server. Perform the following
    steps to optimize the MySQL server:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 第二步是优化MySQL服务器。按照以下步骤优化MySQL服务器：
- en: A good server configuration starts with good hardware and the right operating
    system. To run Magento, it is recommended to use a dedicated server or a VPS.
    When you use a shared environment, the RAM and CPU load is shared among other
    users. With a VPS or dedicated server, you have a fixed number of CPUs and a fixed
    amount of RAM available.
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个好的服务器配置始于良好的硬件和正确的操作系统。为了运行Magento，建议使用专用服务器或VPS。当您使用共享环境时，RAM和CPU负载将由其他用户共享。使用VPS或专用服务器，您有固定数量的CPU和固定数量的RAM可用。
- en: When your server is equipped with enough RAM, you can turn off the swapped devices.
    Sometimes, the swap option will be automatically used even if enough memory is
    available.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您的服务器配备了足够的RAM时，您可以关闭交换设备。有时，即使有足够的内存，交换选项也会自动使用。
- en: In the `my.cnf` file, under the `[mysqld]` section, use the `skip-external-locking`
    parameter to avoid external locking.
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`my.cnf`文件中，在`[mysqld]`部分下，使用`skip-external-locking`参数来避免外部锁定。
- en: 'The following command is used to set the right value for `key_buffer` in the
    `MyISAM` tables. To see the configuration, run the following command on the MySQL
    prompt:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下命令用于在`MyISAM`表中设置`key_buffer`的正确值。要查看配置，请在MySQL提示符下运行以下命令：
- en: '[PRE10]'
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'We will set the key buffer size to 512 MB. We can do this by running the following
    command on the MySQL prompt:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将设置键缓冲区大小为512 MB。我们可以在MySQL提示符下运行以下命令来完成此操作：
- en: '[PRE11]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We will do the following optimization settings in the `my.cnf` file. This is
    the main configuration file of the MySQL server that is located in the `app/etc/mysql`
    folder:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将在`my.cnf`文件中进行以下优化设置。这是MySQL服务器的主要配置文件，位于`app/etc/mysql`文件夹中：
- en: 'Open the file and paste the following configuration under the `[mysqld]` section:'
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开文件，在`[mysqld]`部分下粘贴以下配置：
- en: '[PRE12]'
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Save the file and restart your MySQL server. You can do this by running the
    following command:'
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存文件并重新启动您的MySQL服务器。您可以通过运行以下命令来完成此操作：
- en: '[PRE13]'
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: How it works...
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: While optimizing a MySQL server, you have to know the capabilities of your server
    and the traffic you expect. With these parameters, you can calculate a good value
    for the `key_buffer`, `query_cache`, and `table_cache`. Also, think about the
    `skip-external-locking` parameter. With this parameter, you can deny external
    locking.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在优化MySQL服务器时，你必须了解你服务器的功能和预期的流量。有了这些参数，你可以计算出`key_buffer`、`query_cache`和`table_cache`的良好值。还要考虑`skip-external-locking`参数。使用此参数，你可以拒绝外部锁定。
- en: 'With the following commands, you can view the MySQL server status:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令，你可以查看MySQL服务器状态：
- en: '| Command | More information |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 更多信息 |'
- en: '| --- | --- |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| mysql> SHOW STATUS; | This command shows the current status of the MySQL
    server. This command is available in MySQL 5.0 and higher, and is the standard
    to show all the global variables. |'
  id: totrans-159
  prefs: []
  type: TYPE_TB
  zh: '| mysql> SHOW STATUS; | 此命令显示MySQL服务器的当前状态。此命令在MySQL 5.0及以上版本中可用，并且是显示所有全局变量的标准命令。
    |'
- en: '| mysql> SHOW VARIABLES; | All the MySQL variables are shown with this command.
    |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| mysql> SHOW VARIABLES; | 此命令显示所有MySQL变量。 |'
- en: '| mysql> SHOW INNODB STATUS; | This command lets you find out the current `INNODB`
    status. |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| mysql> SHOW INNODB STATUS; | 此命令让你了解当前的`INNODB`状态。 |'
- en: '| mysql> SHOW GLOBAL STATUS; | This command shows the values of the load on
    the database server for all connections. |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| mysql> SHOW GLOBAL STATUS; | 此命令显示数据库服务器对所有连接的负载值。 |'
- en: '| mysql> SHOW LOCAL STATUS; | This is the same as the `SHOW GLOBAL STATUS`
    command, but the values are calculated on the current connection. |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| mysql> SHOW LOCAL STATUS; | 这与`SHOW GLOBAL STATUS`命令相同，但值是在当前连接上计算的。 |'
- en: '| mysql> mysqladmin extended -i100 -r | Use this command to view what is happening
    currently with the MySQL server. |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| mysql> mysqladmin extended -i100 -r | 使用此命令查看MySQL服务器当前正在发生的情况。 |'
- en: The database optimization is one of the key aspects to tune your Magento webshop.
    The database optimization amounts to 50 percent of a page load.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库优化是调整你的Magento网店的关键方面之一。数据库优化占页面加载的50%。
- en: Optimizing the Apache web server
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化Apache网络服务器
- en: Magento recommends the use of Apache web server when you run a Magento website.
    There are some other web servers on the market, such as Nginx, but initially Magento
    was optimized to run on Apache.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 当运行Magento网站时，Magento推荐使用Apache网络服务器。市场上还有一些其他网络服务器，如Nginx，但最初Magento是针对Apache进行优化的。
- en: The performance of the web server depends mostly on the hardware on which the
    server is running. Network card, RAM, disk, OS, and CPU are important hardware
    to think about when you are choosing a server.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 网络服务器的性能主要取决于服务器运行的硬件。在选择服务器时，网卡、RAM、硬盘、操作系统和CPU是重要的硬件考虑因素。
- en: How to do it...
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: The first thing to think about is the OS on which the web server will run. It
    is highly recommended to use a Linux distribution. In the recipes of this book,
    we used an Ubuntu server (a Debian-based Linux distribution).
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先要考虑的是网络服务器将运行的操作系统。强烈建议使用Linux发行版。在这本书的食谱中，我们使用了Ubuntu服务器（基于Debian的Linux发行版）。
- en: Tip
  id: totrans-171
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Don't use a Windows server to run Magento. It will work but it is less efficient
    and can lead to issues with file permissions, code, and more.
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 不要使用Windows服务器来运行Magento。它可以工作，但效率较低，可能会导致文件权限、代码等问题。
- en: Update the OS to the latest stable version because the update software is faster
    and safer. Use Apache2 instead of the Apache1 series. Apache2 uses fewer CPU resources
    while delivering static content.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将操作系统更新到最新稳定版本，因为更新软件更快更安全。使用Apache2而不是Apache1系列。Apache2在提供静态内容时使用更少的CPU资源。
- en: Install only the required services on the web server. When a lot of services
    are installed, you will have background tasks that will use the resources of the
    server.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在网络服务器上仅安装所需的服务。当安装了很多服务时，你将会有一些后台任务会使用服务器的资源。
- en: Use XFS and ReiserFS as the filesystem for a better disk I/O.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用XFS和ReiserFS作为文件系统以获得更好的磁盘I/O。
- en: You have to configure the web server so that it never has to swap. When your
    web server begins to swap, all requests will be served slower. The first thing
    is to compare the volume of RAM on the server with the average memory load of
    a request and the number of requests. The second thing you can do is to configure
    the `MaxClients` setting. This setting controls the number of child processes
    when the server swaps.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你必须配置网络服务器，使其永远不会需要交换。当你的网络服务器开始交换时，所有请求都将变慢。首先，比较服务器上的RAM容量与请求的平均内存负载和请求数量。你可以做的第二件事是配置`MaxClients`设置。此设置控制服务器交换时的子进程数量。
- en: Look at the `HostnameLookups` setting and check if this is configured with the
    `Off` value.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看 `HostnameLookups` 设置并检查是否已配置为 `Off` 值。
- en: It is not recommended to use the `SymLinksIfOwnerMatch` setting. It is better
    to use `Options` `+FollowSymLinks` `+SymLinksIfOwnerMatch` for specified directories.
    For other locations, use the `Options` `+FollowSymLinks` setting to prevent that
    the system calls `lstat(2)`. The `lstat()` system calls are never cached.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不建议使用 `SymLinksIfOwnerMatch` 设置。对于指定的目录，最好使用 `Options` `+FollowSymLinks` `+SymLinksIfOwnerMatch`。对于其他位置，使用
    `Options` `+FollowSymLinks` 设置以防止系统调用 `lstat(2)`。`lstat()` 系统调用永远不会被缓存。
- en: 'Don''t use a wildcard syntax in the `DirectoryIndex` setting. The setting is
    shown as follows:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不要在 `DirectoryIndex` 设置中使用通配符语法。设置如下所示：
- en: '[PRE14]'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'It is better to use `index.php` only because Magento uses `index.php` as the
    default index. This setting is shown as follows:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最好只使用 `index.php`，因为 Magento 使用 `index.php` 作为默认索引。此设置如下所示：
- en: '[PRE15]'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Enable the `deflate` and `header` Apache modules with the following commands:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令启用 `deflate` 和 `header` Apache 模块：
- en: '[PRE16]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Open the `.htaccess` file in the Magento root and go to the `mod_deflate` configuration
    tag. Uncomment some lines so that the block looks like the following code:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Magento 根目录中打开 `.htaccess` 文件并转到 `mod_deflate` 配置标签。取消注释一些行，使块看起来像以下代码：
- en: '[PRE17]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Tip
  id: totrans-187
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: When you get an internal server error after the change, it is possible that
    the Apache `headers` module is not enabled. Run the `sudo a2enmod header` command
    and restart the server to fix this.
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在更改后遇到内部服务器错误时，可能是 Apache `headers` 模块未启用。运行 `sudo a2enmod header` 命令并重新启动服务器以修复此问题。
- en: Take a look at the `KeepAlive` setting of your Apache server. When this is on,
    the Apache server can serve multiple requests through the same TCP connection.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看您的 Apache 服务器的 `KeepAlive` 设置。当此设置为开启时，Apache 服务器可以通过相同的 TCP 连接处理多个请求。
- en: Configure the **MPM** (**Multi-Processing Modules**) for your case. The values
    of these configurations depend on the resources and load that you expect on your
    server.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的案例配置 **MPM**（**多处理模块**）。这些配置的值取决于您期望服务器上的资源和负载。
- en: '[PRE18]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: When you run some load tests again, you can compare the obtained results with
    the results before the optimization. Usually, you will see some differences.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您再次运行一些负载测试时，可以将获得的结果与优化前的结果进行比较。通常，您会看到一些差异。
- en: How it works...
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The performance of a web server depends on many factors. The key parts are the
    application, the hardware, the OS, and the network.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: Web 服务器的性能取决于许多因素。关键部分是应用程序、硬件、操作系统和网络。
- en: '**Application**: The first thing is to ensure that your application is working
    efficiently with the resources of the server. If your application expects a lot
    of resources for a request, you can optimize it here.'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序**：第一件事是确保您的应用程序能够高效地使用服务器的资源。如果您的应用程序对请求期望大量资源，您可以在这里进行优化。'
- en: '**Hardware**: The second thing is the hardware of the server. You have to make
    sure that the resources of a server are high enough to serve the expected load
    and peaks.'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**硬件**：第二项是服务器的硬件。您必须确保服务器的资源足够高，能够处理预期的负载和峰值。'
- en: '**OS**: The third thing is the OS and web server. Use a Linux server for Magento
    with an Apache or Nginx web server on it. Always use the latest version of the
    software because it is mostly faster and more secured.'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作系统**：第三项是操作系统和 Web 服务器。使用带有 Apache 或 Nginx Web 服务器的 Linux 服务器来托管 Magento。始终使用软件的最新版本，因为它通常更快且更安全。'
- en: '**Network**: The last thing is the network. The web server sends the response
    through the network to the client. When that network is slow, the download time
    of a request will be long. Host your web server with a good network connection
    and host it in the same region as that of the target audience of your webshop.
    For example, host your website in Italy for an Italian website.'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络**：最后一项是网络。Web 服务器通过网络将响应发送到客户端。当网络速度慢时，请求的下载时间会很长。将您的 Web 服务器托管在具有良好网络连接的地方，并将其托管在与您的网店目标受众相同的地区。例如，为意大利网站托管在意大利。'
- en: Optimize the configurations of the system you are using. In this recipe, we
    did some optimizations to tweak the Apache web server by defining custom settings
    in the `.htaccess` file.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 优化您所使用的系统配置。在这个菜谱中，我们对 Apache Web 服务器进行了一些优化，通过在 `.htaccess` 文件中定义自定义设置来实现。
- en: The last thing is the geographic location of your web server. It is better to
    locate your web server in the region where your target audience lives. Also, limit
    the size and number of HTTP requests.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一点是你的Web服务器的地理位置。最好将你的Web服务器放置在目标受众所在的地区。此外，限制HTTP请求的大小和数量。
- en: Tuning the Magento configurations
  id: totrans-201
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调整Magento配置
- en: Magento has some standard features for a better performance, such as caching
    and compilation. In this recipe, we will configure these features for a better
    performance of the setup.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: Magento提供了一些标准功能以提升性能，例如缓存和编译。在本教程中，我们将配置这些功能以优化设置的性能。
- en: Getting ready
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Log in to the admin panel and navigate to the configuration page at **System**
    | **Configuration**.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 登录管理面板并导航到**系统** | **配置**页面。
- en: How to do it...
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'When you perform the following steps, your Magento installation will run a
    bit faster:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 当你执行以下步骤时，你的Magento安装将运行得更快：
- en: Uninstall or disable the extensions that you are not using.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 卸载或禁用你未使用的扩展。
- en: Enable all caching systems that Magento has. They are located at **System**
    | **Cache Management**.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用Magento拥有的所有缓存系统。它们位于**系统** | **缓存管理**。
- en: Tip
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: When all caches are enabled, make sure you clear them when you are developing
    the code.
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当所有缓存都启用时，确保你在开发代码时清除它们。
- en: Compile your Magento installation. You can do this by clicking on **Run Compilation
    Process** on the compilation page at **System** | **Tools** | **Compilation**.
    When the compilation is enabled, all the Magento classes are built in one directory
    where they will be loaded faster. Compilation can increase the speed by 25 to
    50 percent.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编译你的Magento安装。你可以在**系统** | **工具** | **编译**页面点击**运行编译过程**来完成。当编译启用时，所有Magento类将在一个目录中构建，这将使它们加载更快。编译可以将速度提高25%到50%。
- en: Disable the unused modules. You can do this by disabling the frontend output
    by navigating to **System** | **Configuration** | **Advanced** | **Disable Modules
    Output**. When you're not using the `Mage_Poll` module, you can disable it here.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 禁用未使用的模块。你可以通过导航到**系统** | **配置** | **高级** | **禁用模块输出**来禁用前端输出。当你不使用`Mage_Poll`模块时，你可以在那里禁用它。
- en: Disable some developer features because you don't need them on a live site.
    Go to **System** | **Configuration** | **Advanced** | **Developers** and configure
    it as shown in the following screenshot:![How to do it...](img/3329OS_11_07.jpg)
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 禁用一些开发者功能，因为在实际网站上你不需要它们。前往**系统** | **配置** | **高级** | **开发者**并按照以下截图进行配置：![如何操作...](img/3329OS_11_07.jpg)
- en: Go to **Catalog** | **Attributes** | **Manage Attributes**. When you click on
    an attribute, you can see the **Frontend Properties** section. Set only those
    configuration parameters that you want to use in the frontend to **Yes**.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往**目录** | **属性** | **管理属性**。当你点击一个属性时，你可以看到**前端属性**部分。仅设置你希望在前端使用的配置参数为**是**。
- en: 'Go to **System** | **Configuration** | **Catalog** and enable the flat catalog
    product and flat catalog category settings, as shown in the following screenshot.
    When enabled, a part of the EAV system will be converted to flat tables:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往**系统** | **配置** | **目录**并启用扁平目录产品和平坦目录分类设置，如图所示。当启用时，EAV系统的一部分将被转换为扁平表：
- en: '![How to do it...](img/3329OS_11_08.jpg)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/3329OS_11_08.jpg)'
- en: Note
  id: totrans-217
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You can find more information about the flat catalog settings in the *Working
    with EAV tables* recipe of [Chapter 5](ch05.html "Chapter 5. Database Concepts"),
    *Database Concepts*.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在[第5章](ch05.html "第5章。数据库概念")的*使用EAV表*食谱中找到有关扁平目录设置的更多信息。
- en: How it works...
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The standard Magento configurations are not the best configurations for an optimal
    performance. Every option you enable has some impact on the flexibility of development
    and compatibility with platforms and modules.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 标准的Magento配置并不是最佳性能配置。你启用的每个选项都会对开发灵活性和与平台和模块的兼容性产生影响。
- en: When caching is enabled, you will have a better performance. However, you have
    to keep in mind that you will have to clear it frequently while developing the
    code, to see your changes in action.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 当缓存启用时，你将获得更好的性能。然而，你必须记住，在开发代码时，你需要经常清除缓存，以便看到你的更改效果。
- en: Development features are useful when developing code because it contains interesting
    information. However, when your site is live, you don't need these features as
    it will slow down your website. It is recommended that you disable this.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 开发功能在编写代码时很有用，因为它包含有趣的信息。然而，当您的网站上线时，您不需要这些功能，因为它会减慢您的网站速度。建议您禁用此功能。
- en: Compilation is a process where Magento will copy all the classes from the `app/code`
    folder into the `includes` folder. When all the classes are located in one folder,
    it is faster to load a class instead of looking into all the different module's
    folders to load a class.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 编译是一个过程，其中 Magento 将将 `app/code` 文件夹中的所有类复制到 `includes` 文件夹。当所有类都位于一个文件夹中时，加载一个类比在所有不同的模块文件夹中查找一个类要快。
- en: The advantage of compilation is that your site will be faster but a disadvantage
    is that you have to run the compilation process after every change in the code.
    When you use a module that doesn't follow the Magento standards, it can lead to
    errors when compilation is enabled.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 编译的优势是您的网站将更快，但缺点是您必须在代码的每次更改后运行编译过程。当您使用不遵循 Magento 标准的模块时，启用编译可能会导致错误。
- en: The last thing is to enable the flat catalog product and flat catalog category.
    When you enable these features, Magento will use a flat table for loading products
    and categories instead of looking in the different EAV tables.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一步是启用扁平目录产品和扁平目录分类。当您启用这些功能时，Magento 将使用扁平表来加载产品和分类，而不是在多个 EAV 表中查找。
- en: The disadvantages of using this is that you have to sync the data from the EAV
    tables to the flat tables. When working with a large amount of products and categories,
    the index process that syncs the data runs for a very long duration.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此方法的缺点是您必须从 EAV 表同步数据到扁平表。当处理大量产品和分类时，同步数据的索引过程会持续很长时间。
- en: Configuring APC and Memcached
  id: totrans-227
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 APC 和 Memcached
- en: The cache system in Magento is based on cache parts of the HTML output and some
    configuration files. In this recipe, we will configure caching on the PHP level
    that you can do with APC and Memcached. APC will cache PHP files, while Memcached
    will cache objects.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: Magento 的缓存系统基于 HTML 输出的缓存部分和一些配置文件。在本菜谱中，我们将配置 PHP 级别的缓存，您可以使用 APC 和 Memcached
    来实现。APC 将缓存 PHP 文件，而 Memcached 将缓存对象。
- en: Getting ready
  id: totrans-229
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: When configuring APC and Memcached for our Magento store, we have to make sure
    that APC is installed on the server.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 当为我们的 Magento 店铺配置 APC 和 Memcached 时，我们必须确保服务器上已安装 APC。
- en: 'To install APC, follow these instructions:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 APC，请按照以下说明操作：
- en: 'On a Debian-based Linux distribution, you can install APC with the following
    command:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在基于 Debian 的 Linux 发行版上，您可以使用以下命令安装 APC：
- en: '[PRE19]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Follow the installer and APC will be available in your PHP configuration.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照安装程序操作，APC 将会在您的 PHP 配置中可用。
- en: 'To install Memcached, you can run the following command:'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要安装 Memcached，您可以运行以下命令：
- en: '[PRE20]'
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: To test if the extensions are correctly installed, you can use the `phpinfo()`
    command. This command gives you a graphical representation of all the available
    PHP settings.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要测试扩展是否正确安装，您可以使用 `phpinfo()` 命令。此命令以图形方式显示所有可用的 PHP 设置。
- en: 'To see `phpinfo`, create a `phpinfo.php` file with the following content:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看 `phpinfo`，创建一个包含以下内容的 `phpinfo.php` 文件：
- en: '[PRE21]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: When you search on APC and Memcached, you will see a block that contains all
    the settings.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 当您在 APC 和 Memcached 上搜索时，您将看到一个包含所有设置的块。
- en: How to do it...
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'In the following steps, we will discuss the APC and Memcached configuration
    in Magento:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下步骤中，我们将讨论 Magento 中的 APC 和 Memcached 配置：
- en: Make sure APC and Memcached are installed on the server. This is described in
    the previous section of this recipe.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保服务器上已安装 APC 和 Memcached。这在本菜谱的上一节中已有描述。
- en: 'Open the `app/code/local.xml` file and add a `<cache>` block as a child of
    the `<global>` tag. Your `local.xml` file looks as follows:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 `app/code/local.xml` 文件，并将一个 `<cache>` 块作为 `<global>` 标签的子标签添加。您的 `local.xml`
    文件如下所示：
- en: '[PRE22]'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Clear all the Magento caches and restart your Apache server. When you do a
    load test with ApacheBench, you will see that there is a big improvement in the
    performance:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 清除所有 Magento 缓存并重新启动您的 Apache 服务器。当您使用 ApacheBench 进行负载测试时，您将看到性能有显著提升：
- en: '[PRE23]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'The previous configuration enables the APC configuration for Magento. With
    the next configuration, we enable Memcached. We do this by adding a `<cache>`
    tag as a child of the `<global>` tag. With Memcached, the `local.xml` file will
    look as follows:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之前的配置启用了 Magento 的 APC 配置。通过下一个配置，我们启用 Memcached。我们通过将 `<cache>` 标签作为 `<global>`
    标签的子标签来实现这一点。使用 Memcached，`local.xml` 文件将如下所示：
- en: '[PRE24]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'The last thing is to store the `var/cache` folder in memory. We can do this
    by mounting the folder using TMPFS:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一件事情是将 `var/cache` 文件夹存储在内存中。我们可以通过使用 TMPFS 挂载文件夹来实现这一点：
- en: '[PRE25]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: How it works...
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: '**APC** (**Alternative PHP Cache**) is an open source caching framework that
    optimizes the PHP code, compiles it, and caches it in the shared memory. Executing
    a precompiled code is faster than loading all the scripts. A common problem with
    APC is that you have to clear the APC cache before you see any code changes because
    some parts of the old code are cached.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '**APC**（**替代 PHP 缓存**）是一个开源的缓存框架，它优化 PHP 代码，编译它，并在共享内存中缓存它。执行预编译的代码比加载所有脚本要快。APC
    的一个常见问题是，你必须清除 APC 缓存才能看到任何代码更改，因为旧代码的一些部分被缓存了。'
- en: Memcached is another caching system in PHP. Memcached will cache objects that
    will be used in the application later. Examples are database objects, sessions,
    and API calls. Memcached runs on a server, that is, in this example, the same
    server as the web server. By setting the Magento configuration, we connect to
    the local Memcached server that runs on port 11211.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: Memcached 是 PHP 中的另一个缓存系统。Memcached 将缓存以后将在应用程序中使用的对象。例如，数据库对象、会话和 API 调用。Memcached
    在服务器上运行，即在这个例子中，与 web 服务器相同的服务器。通过设置 Magento 配置，我们连接到运行在端口 11211 的本地 Memcached
    服务器。
- en: In Magento, Memcached increases the performance. In the frontend, there is some
    effect but the largest effect is in the backend where Magento itself caches very
    few things.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Magento 中，Memcached 提高了性能。在前端，有一些效果，但最大的效果是在后端，因为 Magento 本身缓存的东西非常少。
- en: The last thing was to mount the Magento `cache` folder in the memory. When enough
    memory is available, it is faster to store the cache files in the RAM memory.
    When they are located in the RAM, it is faster to load a cache file instead of
    reading it from the disk.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一件事情是将 Magento 的 `cache` 文件夹挂载到内存中。当有足够的内存可用时，将缓存文件存储在 RAM 中会更快。当它们位于 RAM
    中时，加载缓存文件比从磁盘读取它要快。
- en: Optimizing the PHP configurations
  id: totrans-257
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化 PHP 配置
- en: When you are not using an APC such as an accelerator, think about using a PHP
    accelerator; we will see how in this recipe. When a PHP script is requested, the
    script will be read and then it will be compiled in binary, which is called opcode.
    This compiled code will be executed by the PHP engine.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 当你不使用 APC 等加速器时，考虑使用 PHP 加速器；我们将在本菜谱中看到如何做到这一点。当请求 PHP 脚本时，脚本将被读取，然后它将被编译成二进制，这被称为操作码。这个编译后的代码将由
    PHP 引擎执行。
- en: An opcode cache is simply a caching mechanism that saves the compiled code so
    that the code doesn't have to be compiled every time the script will run. In this
    recipe, we will optimize the `php.ini` settings for the best performance.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 操作码缓存只是一个简单的缓存机制，它保存编译后的代码，这样代码就不必每次脚本运行时都进行编译。在这个菜谱中，我们将优化 `php.ini` 设置以获得最佳性能。
- en: Getting ready
  id: totrans-260
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'There are a lot of PHP accelerators on the market, such as APC, eAccelerator,
    XCache, Zend Accelerator, and Zend Platform. At the following URLs, you can find
    out more information about these accelerators:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 市场上有很多 PHP 加速器，如 APC、eAccelerator、XCache、Zend Accelerator 和 Zend Platform。在以下
    URL 中，你可以找到有关这些加速器的更多信息：
- en: '**APC**: This PHP accelerator can be found at [http://pecl.php.net/package/APC](http://pecl.php.net/package/APC)'
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**APC**：这个 PHP 加速器可以在 [http://pecl.php.net/package/APC](http://pecl.php.net/package/APC)
    找到'
- en: '**eAccelerator**: This PHP accelerator can be found at [http://eaccelerator.net/](http://eaccelerator.net/)'
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**eAccelerator**：这个 PHP 加速器可以在 [http://eaccelerator.net/](http://eaccelerator.net/)
    找到'
- en: '**XCache**: This PHP accelerator can be found at [http://xcache.lighttpd.net/](http://xcache.lighttpd.net/)'
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**XCache**：这个 PHP 加速器可以在 [http://xcache.lighttpd.net/](http://xcache.lighttpd.net/)
    找到'
- en: How to do it...
  id: totrans-265
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'The following steps describe some measures that you can take to improve the
    PHP configuration:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤描述了一些你可以采取的措施来改进 PHP 配置：
- en: Use an efficient process manager, such as php-fpm, that runs on an impressive
    speed on FastCGI.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用一个高效的进程管理器，如 php-fpm，它在 FastCGI 上运行速度惊人。
- en: 'Use the `realpath_cache_size` configuration setting to configure the size of
    the real path cache in PHP. On systems where PHP opens and closes a lot of files,
    this value needs to be increased. You can use the following setting for Magento:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`realpath_cache_size`配置设置来配置PHP中真实路径缓存的大小。在PHP打开和关闭大量文件的系统上，此值需要增加。您可以为Magento使用以下设置：
- en: '[PRE26]'
  id: totrans-269
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The settings in the following table can improve the performance of the PHP
    settings:'
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下表中设置的设置可以改善PHP设置的性能：
- en: '| Setting | Description | Recommended value |'
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 设置 | 描述 | 推荐值 |'
- en: '| --- | --- | --- |'
  id: totrans-272
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `max_execution_time` | This setting sets the maximum time (in seconds) for
    which a process can live. | 120 |'
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `max_execution_time` | 此设置设置进程可以存活的最大时间（以秒为单位）。 | 120 |'
- en: '| `max_input_time` | This property sets the time (in seconds) for which a script
    will wait for input data. | 240 |'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `max_input_time` | 此属性设置脚本等待输入数据的时间（以秒为单位）。 | 240 |'
- en: '| `memory_limit` | With this setting, you can set the amount of memory a process
    can consume. | For Magento, it is recommended to use 216 MB. |'
  id: totrans-275
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `memory_limit` | 使用此设置，您可以设置进程可以消耗的内存量。 | 对于Magento，建议使用216 MB。 |'
- en: '| `output_buffering` | With this setting, you can set the amount of bytes to
    buffer before sending the response to the client. | 4096 |'
  id: totrans-276
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `output_buffering` | 使用此设置，您可以设置在向客户端发送响应之前缓冲的字节数。 | 4096 |'
- en: 'The last thing is to disable some error reporting levels when your site is
    live. This can be done by using the following setting:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，当您的网站处于活动状态时，禁用一些错误报告级别。可以通过以下设置来完成：
- en: '[PRE27]'
  id: totrans-278
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: How it works...
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The values in the `php.ini` configuration depend mostly on the application that
    you are running and the load that the application will have on your system. If
    your application has some processes that will run for a long time (this is possible
    with the re-index process when you have a large number of products), it is required
    to increase the values of `max_execution_time` and `max_input_time`. This is the
    same for the `memory_limit` parameter where the recommended value for Magento
    is 216 MB.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '`php.ini`配置文件中的值主要取决于您正在运行的应用程序以及该应用程序将对您的系统产生的负载。如果您的应用程序有一些将运行很长时间的过程（当您有大量产品时，重新索引过程就是这样），则需要增加`max_execution_time`和`max_input_time`的值。对于`memory_limit`参数也是如此，对于Magento，建议使用216
    MB。'
- en: Disabling the error reporting on a production system is recommended for warnings
    and notices but critical errors need to be reported because this information is
    required when solving the bug.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产系统上禁用错误报告对于警告和通知是推荐的，但关键错误需要报告，因为解决错误时需要这些信息。
- en: Analyzing the page speed
  id: totrans-282
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分析页面速度
- en: YSlow is a tool that analyzes the speed for a web page. It is a plugin that
    you can install in Firebug. While running a report, the site will be tested on
    some parameters. A report will be shown with an overall score of your website.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: YSlow是一个分析网页速度的工具。它是一个可以安装到Firebug的插件。在运行报告时，网站将在一些参数上进行测试。将显示一个包含您网站总体得分的报告。
- en: 'The test is based on a ruleset. You have the YSlow (V2) and YSlow (V1) ruleset.
    We will use the YSlow(V2) ruleset for this recipe, which has 22 rules. The complete
    page load (including images and static content) can be increased by 25 to 50 percent
    if you adhere to the following 22 rules:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 测试基于一组规则。您有YSlow (V2) 和 YSlow (V1) 规则集。我们将使用YSlow(V2) 规则集进行本食谱，它包含22条规则。如果您遵守以下22条规则，完整的页面加载（包括图像和静态内容）可以提高25到50%：
- en: Minimize HTTP requests
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最小化HTTP请求
- en: Use a Content Delivery Network
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用内容分发网络
- en: Avoid empty `src` or `href`
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免空的`src`或`href`
- en: Add an expires header or a cache-control header
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加过期头或缓存控制头
- en: Use Gzip for components
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为组件使用Gzip
- en: Put stylesheets at the top
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将样式表放在顶部
- en: Put scripts at the bottom
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将脚本放在底部
- en: Avoid CSS expressions
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免使用CSS表达式
- en: Make JavaScript and CSS external
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使JavaScript和CSS外部化
- en: Reduce DNS lookups
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 减少DNS查找
- en: Minify JavaScript and CSS
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 压缩JavaScript和CSS
- en: Avoid redirects
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免重定向
- en: Remove duplicate scripts
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除重复的脚本
- en: Configure ETags
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置ETags
- en: Make AJAX cacheable
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使AJAX可缓存
- en: Use GET for AJAX requests
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用GET进行AJAX请求
- en: Reduce the number of DOM elements
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 减少DOM元素的数量
- en: No 404 errors
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无404错误
- en: Reduce the cookie size
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 减少cookie大小
- en: Use cookie-free domains for components
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用无cookie域名进行组件
- en: Avoid filters
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免过滤器
- en: Do not scale images in HTML
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要在HTML中缩放图像
- en: Make `favicon.ico` small and cacheable
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使`favicon.ico`文件小并可缓存
- en: How to do it...
  id: totrans-308
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'Perform the following steps to see what we can do with a YSlow result:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以查看我们可以使用YSlow结果做什么：
- en: Run the YSlow test on the current web page. On a standard Magento webshop, the
    test normally returns an overall C score.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在当前网页上运行 YSlow 测试。在标准的 Magento 网上商店中，测试通常返回一个总体 C 级分数。
- en: The first thing is to make fewer HTTP requests. You can fix this by enabling
    CSS and JS merging. For an optimal score, it is recommended to use sprites so
    that you have only one background image.
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一件事是减少 HTTP 请求。你可以通过启用 CSS 和 JS 合并来解决这个问题。为了获得最佳分数，建议使用精灵图，这样你只有一个背景图片。
- en: To optimize the background image, you can use an image optimization tool such
    as Yahoo's Smush.it. When you upload the `images` folder of your theme and run
    it, you can download the optimized version as shown in the following screenshot:![How
    to do it...](img/3329OS_11_09.jpg)
  id: totrans-312
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了优化背景图片，你可以使用像 Yahoo 的 Smush.it 这样的图片优化工具。当你上传你的主题的 `images` 文件夹并运行它时，你可以下载如以下截图所示的优化版本：![如何操作...](img/3329OS_11_09.jpg)
- en: You can download the optimized images and replace them in the `skin` folder.
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以下载优化后的图片，并在 `skin` 文件夹中替换它们。
- en: The next bad point in the test is adding the expires header. We can fix this
    by modifying some rules in the `.htaccess` file.
  id: totrans-314
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 测试中的下一个缺点是添加过期头。我们可以通过修改 `.htaccess` 文件中的某些规则来解决这个问题。
- en: 'The following code shows how to add the `expire` headers to the static content
    of the website:'
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下代码展示了如何向网站的静态内容添加 `expire` 头：
- en: '[PRE28]'
  id: totrans-316
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'With the following code, we will compress some file types:'
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下代码将压缩一些文件类型：
- en: '[PRE29]'
  id: totrans-318
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'The last step is to use a CDN network to host your static images. You can use
    an existing CDN provider to host the static files of your site, but you can create
    a subdomain `static.magento-dev.local`, which also points to the Magento root
    and configures Magento to use this subdomain for static content. You can do this
    in the backend by navigating to **System** | **Configuration** | **General** |
    **Web**, as shown in the following screenshot:'
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一步是使用 CDN 网络托管你的静态图片。你可以使用现有的 CDN 提供商来托管你网站的静态文件，但你也可以创建一个子域名 `static.magento-dev.local`，它也指向
    Magento 根目录，并配置 Magento 使用此子域名来托管静态内容。你可以在后台通过导航到 **系统** | **配置** | **常规** | **Web**
    来完成此操作，如下面的截图所示：
- en: '![How to do it...](img/3329OS_11_10.jpg)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
  zh: '![如何操作...](img/3329OS_11_10.jpg)'
- en: How it works...
  id: totrans-321
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The documentation of all the 22 rules of YSlow is available on their website.
    If you want more information about a rule, visit the following page that contains
    all the information:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: YSlow 的所有 22 条规则的文档都可以在他们的网站上找到。如果你想了解更多关于某个规则的信息，请访问包含所有信息的以下页面：
- en: '[http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html)'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html)'
