<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Files and File Sets"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Files and File Sets</h1></div></div></div><p>In this chapter, we will cover the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loading a file by its ID</li><li class="listitem" style="list-style-type: disc">Getting a file's path</li><li class="listitem" style="list-style-type: disc">Getting a list of files</li><li class="listitem" style="list-style-type: disc">Uploading a file to the file manager</li><li class="listitem" style="list-style-type: disc">Loading a file set by its ID</li><li class="listitem" style="list-style-type: disc">Adding a file to a file set</li><li class="listitem" style="list-style-type: disc">Removing a file from a file set</li><li class="listitem" style="list-style-type: disc">Checking if a file is part of a file set</li><li class="listitem" style="list-style-type: disc">Getting all of the files in a file set</li><li class="listitem" style="list-style-type: disc">Duplicating a file</li><li class="listitem" style="list-style-type: disc">Deleting a file</li><li class="listitem" style="list-style-type: disc">Reindexing a file's search attributes</li><li class="listitem" style="list-style-type: disc">Setting passwords on file objects</li><li class="listitem" style="list-style-type: disc">Setting permissions on files</li><li class="listitem" style="list-style-type: disc">Getting the download URL for a file</li><li class="listitem" style="list-style-type: disc">Getting the download statistics for a file</li><li class="listitem" style="list-style-type: disc">Adding a file picker to a form</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec52"/>Introduction</h1></div></div></div><p>In addition to robust content editing features, <span class="strong"><strong>concrete5</strong></span> comes with a powerful tool to manage static files on your website, called the <a id="id199" class="indexterm"/>
<span class="strong"><strong>file manager</strong></span>. The file manager is where you can store any type of static document, including images, videos, PDFs, documents, and audio files. The file manager allows you to create downloadable links to the files, embed photos into your site content, and much more. You can even assign permissions to files inside the file manager to allow for greater control in deciding what files users can download.</p><p>Working with files through the concrete5 interface is a delight, but sometimes you will want to integrate the powerful <a id="id200" class="indexterm"/>functionality of the file manager into your own custom applications built in concrete5. In this chapter, we will show how to interact with files, upload new files, and even upload new files to the file manager.</p><div class="section" title="A note about the code in this chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec161"/>A note about the code in this chapter</h2></div></div></div><p>Much of the code presented in this chapter can go just about anywhere in a concrete5 application. Since we are just going to be trying out simple code snippets, it makes sense to experiment with this code in a sandbox area. There are a few places in concrete5 that make sense for this, but we will be using <code class="literal">/config/site_post.php</code> to test out our code.</p><p>It is a good idea to erase any experimental and arbitrary code from <code class="literal">site_post.php</code> after each recipe, so that your site is ready for the next exercise.</p><p>Also, we will need to dump the contents of variables from time to time. Each PHP developer has his or her own way of doing this, but in this chapter we will be using a custom debug function. You may recognize this function from <a class="link" href="ch01.html" title="Chapter 1. Pages and Page Types">Chapter 1</a>, <span class="emphasis"><em>Pages and Page Types</em></span>. We will continue using it here, as it makes the output easy to read and saves some time while developing.</p><p>Place the following PHP function at the top of <code class="literal">/config/site_post.php</code>:</p><div class="informalexample"><pre class="programlisting">function my_debug($var) {
   echo '&lt;pre&gt;';
   print_r($var);
   echo '&lt;/pre&gt;';
   exit;
}</pre></div><p>Now we can dump variable contents by calling <code class="literal">my_debug($variableName)</code> and see a nicely formatted output of the contents of the variable. Feel free to use <code class="literal">print_r</code> or <code class="literal">var_dump</code> as an alternative.</p><p>Placing debug code in <a id="id201" class="indexterm"/>
<code class="literal">site_post.php</code> is great for experimentation and trying out the concrete5 API, but it will disrupt the regular operation of a concrete5 website. It is recommended that all of the recipes in this chapter be performed on a testing copy of concrete5.</p></div></div></div>
<div class="section" title="Loading a file by its ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec53"/>Loading a file by its ID</h1></div></div></div><p>The most common interaction with files for most concrete5 developers is loading files and interacting with them. To do this, <a id="id202" class="indexterm"/>we must load a file by its ID. The code in this recipe can be placed wherever you need to load a file and retrieve or modify its attributes.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec162"/>Getting ready</h2></div></div></div><p>We will need to know the ID of the file that we <a id="id203" class="indexterm"/>are loading. In this recipe, we will load a file with the <span class="strong"><strong>ID</strong></span> of <code class="literal">17</code>. If your concrete5 site does not have a file with an <span class="strong"><strong>ID</strong></span> of <code class="literal">17</code>, upload a new file to the file manager and change the <span class="strong"><strong>ID</strong></span> in this recipe to match the <span class="strong"><strong>ID</strong></span> of the newly uploaded file. You can get the <span class="strong"><strong>ID</strong></span> of a file by visiting the file manager, clicking on a file, and choosing <span class="strong"><strong>Properties</strong></span>.</p><div class="mediaobject"><img src="graphics/4548OS_03_01.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec163"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor, or place this code, wherever it is appropriate in your own application.</li><li class="listitem">Declare the ID of the file to load and be sure to set this to something relevant for your system:<div class="informalexample"><pre class="programlisting">$fileId = 17;</pre></div></li><li class="listitem">Load the file:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Dump the contents of the file variable:<div class="informalexample"><pre class="programlisting">my_debug($file);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec164"/>How it works...</h2></div></div></div><p>concrete5 will use this function to load the <a id="id204" class="indexterm"/>relevant file from the database, based on the numeric ID that you passed in. The <a id="id205" class="indexterm"/>static <code class="literal">getByID</code> function will return a fully loaded <code class="literal">file</code> object that you can work further with.</p></div></div>
<div class="section" title="Getting a file's path"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec54"/>Getting a file's path</h1></div></div></div><p>Once you have loaded the <code class="literal">file</code> object, there are a multitude of different methods that you can call, to get all of the <a id="id206" class="indexterm"/>different attributes associated with that file. One of the most common and important attributes is that file's path.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec165"/>Getting ready</h2></div></div></div><p>In this recipe, we will get a file's path and use it to display an image stored in the file manager.</p><p>Once again, we will be referencing an image with the ID of <code class="literal">1</code>. Be sure to adapt the code in this recipe to load an image that actually exists in your concrete5 installation.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec166"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your editor.</li><li class="listitem">Declare the ID of the file to be loaded:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Get the file's path:<div class="informalexample"><pre class="programlisting">$path = $file-&gt;getRelativePath();</pre></div></li><li class="listitem">Output the path to the screen:<div class="informalexample"><pre class="programlisting">echo $path;
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec167"/>How it works...</h2></div></div></div><p>The file manager stores files in various locations through the concrete5 website, typically beneath the <code class="literal">files/</code> folder, which gets broken up into a few machine-readable folders consisting of integers. Since these paths <a id="id207" class="indexterm"/>are too hard to figure out and predict on a regular basis, the file object API allows us to get those paths with a simple function call.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec168"/>There's more...</h2></div></div></div><p>You will need the actual absolute path of a file, if you are working with the image in PHP's <code class="literal">fopen</code> function, for instance. For that, you will use the <code class="literal">getPath</code> function:</p><div class="informalexample"><pre class="programlisting">$fullPath = $file-&gt;getPath();</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec169"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a file by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a list of files"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec55"/>Getting a list of files</h1></div></div></div><p>Many times, you will need to get several files at once. For example, if you were building a photo gallery, you would want to get a <a id="id208" class="indexterm"/>list of files to display in the gallery.</p><p>In this recipe, we will get a list of the first hundred images stored in the file manager and output their file paths.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec170"/>Getting ready</h2></div></div></div><p>This recipe assumes that there is at least one image stored in concrete5's file manager. Please make sure that your own version of concrete5 has one or more images stored.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec171"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the file list model:<div class="informalexample"><pre class="programlisting">Loader::model('file_list');</pre></div></li><li class="listitem">Create a new instance of the <code class="literal">FileList</code> class:<div class="informalexample"><pre class="programlisting">$list = new FileList();</pre></div></li><li class="listitem">Filter the list to only show images:<div class="informalexample"><pre class="programlisting">$list-&gt;filterByType(FileType::T_IMAGE);</pre></div></li><li class="listitem">Get an array of images.<div class="informalexample"><pre class="programlisting">$images = $list-&gt;get();</pre></div></li><li class="listitem">Loop through the images array and output each image's path.<div class="informalexample"><pre class="programlisting">foreach ($images as $img) {
   echo $img-&gt;getRelativePath().'&lt;br /&gt;';
}
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec172"/>How it works...</h2></div></div></div><p>Much like listing pages and other object in concrete5, we loaded a <code class="literal">FileList</code> object that extends the core <code class="literal">DatabaseItemList</code> class. This afforded us an object-oriented manner in which to filter, search, and <a id="id209" class="indexterm"/>retrieve an array of files.</p><p>We called the <code class="literal">get()</code> <a id="id210" class="indexterm"/>function to return the images found in the file manager.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec173"/> There's more...</h2></div></div></div><p>concrete5 stores a few file type constants in the <a id="id211" class="indexterm"/>
<code class="literal">FileType</code> class, which you can view in <code class="literal">concrete/libraries/file/types.php</code>. The following constants are available to filter by different file types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_APPLICATION</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_AUDIO</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_DOCUMENT</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_IMAGE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_TEXT</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_UNKNOWN</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FileType::T_VIDEO</code></li></ul></div><p>There are quite a few functions available on the <code class="literal">FileList</code> class to search and filter the list of files. The following are a few more functions that you can use:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Filter the list by file extension (do not supply a period in the extension parameter):<div class="informalexample"><pre class="programlisting">$list-&gt;filterByExtension('mp3');</pre></div></li><li class="listitem" style="list-style-type: disc">Filter the list by a keyword phrase (searches by the file title, filename, and some other attributes):<div class="informalexample"><pre class="programlisting">$list-&gt;filterByKeywords('guacamole');</pre></div></li></ul></div><p>There are a few more specific filters available for the <code class="literal">FileList</code> class. You can dive into these filter functions by browsing the <code class="literal">FileList</code> class source code, or by viewing the online concrete5 developer documentation at <a class="ulink" href="http://www.concrete5.org/documentation/developers/files/searching-and/">http://www.concrete5.org/documentation/developers/files/searching-and/</a></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec174"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting all of the files in a file set</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Uploading a file to the file manager"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec56"/>Uploading a file to the file manager</h1></div></div></div><p>Sometimes you will want to <a id="id212" class="indexterm"/>store user-supplied files in the file manager, or perhaps want to migrate the existing files on the server to the file manager. There are obvious security concerns whenever you are dealing with user-generated content, but there <a id="id213" class="indexterm"/>are plenty of legitimate reasons to want to programmatically add files to the file manager.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec175"/>Getting ready</h2></div></div></div><p>This recipe requires us to create a basic HTML form with a file upload input. We will place the HTML form in a single page located at <code class="literal">/single_pages/upload.php</code>. Be sure to install the single page by visiting <code class="literal">/dashboard/pages/single</code> and adding a new page with a path of <code class="literal">/upload</code>.</p><p>Since this recipe is a little bit more complex, it may be useful to check out the free code download for this chapter on this book's website.</p><p>We also will be using the custom debug function that we discussed in the chapter introduction.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec176"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new single page at <code class="literal">/single_pages/upload.php</code>.</li><li class="listitem">Add the single page to the concrete5 website by visiting /<code class="literal">dashboard/pages/single</code> and entering the path <code class="literal">/upload</code>.</li><li class="listitem">Create a basic HTML form in the <code class="literal">upload.php</code> file with a file input:<div class="informalexample"><pre class="programlisting">&lt;form method="POST" enctype="multipart/form-data"&gt;
   File to upload: &lt;input type="file" name="example_file"&gt;&lt;br /&gt;
   &lt;input type="hidden" name="file_upload" value="yes"&gt;
   &lt;input type="submit" value="Upload!"&gt;
&lt;/form&gt;</pre></div></li><li class="listitem">Create <code class="literal">/config/site_process.php</code>, if it does not exist.</li><li class="listitem">In <code class="literal">site_process.php</code>, check to see if a file has been uploaded:<div class="informalexample"><pre class="programlisting">if ($_POST['file_upload'] == 'yes') {
}</pre></div></li><li class="listitem">Inside the <code class="literal">if</code> statement, load the <code class="literal">FileImporter</code> library:<div class="informalexample"><pre class="programlisting">Loader::library('file/importer');</pre></div></li><li class="listitem">Then, create a new instance of the <code class="literal">FileImporter</code> class:<div class="informalexample"><pre class="programlisting">$importer = new FileImporter();</pre></div></li><li class="listitem">Get the uploaded file from the <code class="literal">$_FILES</code> super global:<div class="informalexample"><pre class="programlisting">$file = $_FILES['example_file'];</pre></div></li><li class="listitem">Get the filename:<div class="informalexample"><pre class="programlisting">$name = $file['name'];</pre></div></li><li class="listitem">Get the file's current temporary location:<div class="informalexample"><pre class="programlisting">$path = $file['tmp_name'];</pre></div></li><li class="listitem">Add the file to the <a id="id214" class="indexterm"/>file manager:<div class="informalexample"><pre class="programlisting">$newFile = $importer-&gt;import($path, $name);</pre></div></li><li class="listitem">If <code class="literal">$newFile</code> is an integer, <a id="id215" class="indexterm"/>concrete5 has encountered an error. Output the error message:<div class="informalexample"><pre class="programlisting">if (is_numeric($newFile)) {
   die(FileImporter::getErrorMessage($newFile));  
}</pre></div></li><li class="listitem">Otherwise, the file upload was successful.</li><li class="listitem">Visit the site's file manager at <code class="literal">/dashboard/files/search/</code> to see the newly uploaded file.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec177"/>How it works...</h2></div></div></div><p>The <code class="literal">FileImporter</code> class takes the <a id="id216" class="indexterm"/>temporary path of the uploaded file (taken from the <code class="literal">$_FILES</code> super global) and a name for the file. The file is then added to the file manager, where it can be used throughout the concrete5 website.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec178"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding a file picker to a form</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Loading a file set by its ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec57"/>Loading a file set by its ID</h1></div></div></div><p>concrete5 allows you to group files into sets. Some developers consider file sets to be similar to using folders on your <a id="id217" class="indexterm"/>computer, except that a file can be in multiple sets (or no sets) at a time, so a more apt description would be that, these are file categories.</p><p>File sets are great to organize files used for different purposes in your concrete5 website. For example, you might have one file <a id="id218" class="indexterm"/>set for a slideshow on the home page, while there is another file set for staff photos, and another for internal documents.</p><p>In this recipe, we will load a file set using its numeric ID.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec179"/>Getting ready</h2></div></div></div><p>In this section, we assume the existence of a file set with the ID of <code class="literal">1</code>. Please adjust the code in this recipe to suit your own concrete5 environment.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec180"/>How to do it...</h2></div></div></div><p>We will assume that we want to load a file set that has an ID of <code class="literal">1</code>. Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, make sure you know the ID of the file set that you wish to load:<div class="informalexample"><pre class="programlisting">$id = 1;</pre></div></li><li class="listitem">Load the file set:<div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByID($id);</pre></div></li><li class="listitem">If you wish, you can verify that the file set has loaded correctly by dumping the <code class="literal">$fileSet</code> variable:<div class="informalexample"><pre class="programlisting">my_debug($fileSet);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec181"/>How it works...</h2></div></div></div><p>concrete5 will query the database for the file set that has the ID you supplied. Once it finds the appropriate record, it will return a <code class="literal">FileSet</code> object that you can interact with.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec182"/>There's more...</h2></div></div></div><p>You can also retrieve file sets by providing <a id="id219" class="indexterm"/>their names as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByName('File Set Name');</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec183"/> See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding a file to a file set</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a list of files</em></span> <a id="id220" class="indexterm"/>recipe</li></ul></div></div></div>
<div class="section" title="Adding a file to a file set"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec58"/>Adding a file to a file set</h1></div></div></div><p>A useful aspect of working with file <a id="id221" class="indexterm"/>sets is the ability to add files to a given set using PHP code. Fortunately, this is a very simple task.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec184"/>Getting ready</h2></div></div></div><p>You will need to know the ID of the file <a id="id222" class="indexterm"/>that you are adding, or have the <code class="literal">File</code> object already loaded. This recipe will assume the existence of a file with the ID of <code class="literal">1</code> and of a file set also with an ID of <code class="literal">1</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec185"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Declare the file ID of the file that you wish to load.<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Declare the file set ID of the file set that you wish to load:<div class="informalexample"><pre class="programlisting">$fileSetId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Load the file set by its ID:<div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByID($fileSetId);</pre></div></li><li class="listitem">Add the file to the file set:<div class="informalexample"><pre class="programlisting">$fileSetFile = $fileSet-&gt;addFileToSet($file);</pre></div></li><li class="listitem">Dump the resulting FileSetFile object:<div class="informalexample"><pre class="programlisting">my_debug($fileSetFile);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec186"/>How it works...</h2></div></div></div><p>concrete5 will create an association between the file and the file set, and then return a <code class="literal">FileSetFile</code> object once it is complete.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec187"/>There's more...</h2></div></div></div><p>Alternatively, if you don't wish to load the <a id="id223" class="indexterm"/>file object, you can just provide the ID of the file that you are adding. Have a look at <a id="id224" class="indexterm"/>the following code snippet:</p><div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByID($filesetID);
$filesetFile = $fileSet-&gt;addFileToSet($fileId);</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec188"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Removing a file from a file set</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Checking if a file is part of a file set</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Removing a file from a file set"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec59"/>Removing a file from a file set</h1></div></div></div><p>In addition to being able to add <a id="id225" class="indexterm"/>files to file sets, developers can also remove files from their file sets.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec189"/>Getting ready</h2></div></div></div><p>In this recipe, we will again assume the <a id="id226" class="indexterm"/>existence of a file with an ID of <code class="literal">1</code>, as well as a <a id="id227" class="indexterm"/>file set with an ID of <code class="literal">1</code>. Make sure to adjust the code as needed for your own concrete5 instance.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec190"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor, so that we can play with some arbitrary code.</li><li class="listitem">Declare the file ID:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Declare the file set ID:<div class="informalexample"><pre class="programlisting">$fileSetId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Load the file set by its ID:<div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByID($fileSetId);</pre></div></li><li class="listitem">Remove the file from the file set:<div class="informalexample"><pre class="programlisting">$fileSet-&gt;removeFileFromSet($file);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec191"/>How it works...</h2></div></div></div><p>concrete5 simply <a id="id228" class="indexterm"/>destroys the <a id="id229" class="indexterm"/>relationship between the file and the file set.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec192"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding a file to a file set</em></span> <a id="id230" class="indexterm"/>recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Checking if a file is part of a file set</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Checking if a file is part of a file set"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec60"/>Checking if a file is part of a file set</h1></div></div></div><p>Occasionally, developers may <a id="id231" class="indexterm"/>want to know if a file is a member of a certain file set. In this recipe, we will load a file, load a file set, and then find out if the file is a member of the given file set.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec193"/>Getting ready</h2></div></div></div><p>As usual, we will be assuming the existence of a file and a file set in this recipe. We will be using the ID of <code class="literal">1</code> for both the file and the file set, so be sure to make the necessary adjustments to the code to make this work in your own concrete5 system.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec194"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> and clear any existing code.</li><li class="listitem">Declare the ID of the file to be loaded:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Declare the ID of the file set that we will be working with:<div class="informalexample"><pre class="programlisting">$fileSetId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Load the file set by its ID:<div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByID($fileSetId);</pre></div></li><li class="listitem">If the file is a member of the file set, output a <code class="literal">yes</code> message:<div class="informalexample"><pre class="programlisting">if ($file-&gt;inFileSet($fileSet)) {
   echo 'yes!';
}</pre></div></li><li class="listitem">If the file is not a member of the set, output <code class="literal">no</code>:<div class="informalexample"><pre class="programlisting">else {
   echo 'no';
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec195"/>How it works...</h2></div></div></div><p>concrete5 will do the heavy lifting of <a id="id232" class="indexterm"/>querying the database to find out if the file is a member of the given set.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec196"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding a file to a file set</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Removing a file from a file set</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting all of the files in a file set"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec61"/>Getting all of the files in a file set</h1></div></div></div><p>Now that we know how to load file sets <a id="id233" class="indexterm"/>and add files to them, we can learn how to get all of the files from a file set. We will be using the <code class="literal">FileList</code> class, which we first <a id="id234" class="indexterm"/>described earlier in this chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec197"/>Getting ready</h2></div></div></div><p>We will continue working with the assumption that there is at least one file and one file set installed in concrete5, both with an ID of <code class="literal">1</code>. Make the necessary adjustments to the variables in this recipe to suit your own needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec198"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor, removing any existing code that might be in there.</li><li class="listitem">Load the <code class="literal">FileList</code> model:<div class="informalexample"><pre class="programlisting">Loader::model('file_list');</pre></div></li><li class="listitem">Create a new instance of the <code class="literal">FileList</code> model:<div class="informalexample"><pre class="programlisting">$list = new FileList();</pre></div></li><li class="listitem">Declare the ID of the file set to filter by:<div class="informalexample"><pre class="programlisting">$fileSetId = 1;</pre></div></li><li class="listitem">Load the file set:<div class="informalexample"><pre class="programlisting">$fileSet = FileSet::getByID($fileSetId);</pre></div></li><li class="listitem">Filter the list by the loaded file set:<div class="informalexample"><pre class="programlisting">$list-&gt;filterBySet($fileSet);</pre></div></li><li class="listitem">Get an array of files in the file set:<div class="informalexample"><pre class="programlisting">$files = $list-&gt;get();</pre></div></li><li class="listitem">Loop through the array, printing each file's path to the screen:<div class="informalexample"><pre class="programlisting">foreach ($files as $file) {
  echo $file-&gt;getRelativePath().'&lt;br /&gt;';
}
exit;</pre></div></li><li class="listitem">Refresh your website to <a id="id235" class="indexterm"/>see the results.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec199"/>How it works...</h2></div></div></div><p>In this example, we are simply instantiating the <code class="literal">FileList</code> class, which will expose several methods to filter files. The <a id="id236" class="indexterm"/>method we are interested in is <code class="literal">filterBySet</code>.</p><p>We have to pass a <code class="literal">FileSet</code> object to this function and then we can call the <code class="literal">get</code> function, which will return an array of files that belong to that file set.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec200"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a list of files</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a file set by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Duplicating a file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec62"/>Duplicating a file</h1></div></div></div><p>Just as in traditional file systems, <a id="id237" class="indexterm"/>concrete5 allows developers to duplicate files; in this recipe, we will load a file by its ID and then create a duplicate copy.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec201"/>Getting ready</h2></div></div></div><p>Be sure to adjust the file ID in this recipe to something that exists in your concrete5 database.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec202"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Declare the ID of the file to be duplicated:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Duplicate the file:<div class="informalexample"><pre class="programlisting">$newFile = $file-&gt;duplicate();</pre></div></li><li class="listitem">Dump the contents of the new copy, using our custom debugging function that we created in the chapter intro:<div class="informalexample"><pre class="programlisting">my_debug($newFile);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec203"/>How it works...</h2></div></div></div><p>concrete5 will create a carbon copy of the <a id="id238" class="indexterm"/>original file and return the new file once the function has completed.</p></div></div>
<div class="section" title="Deleting a file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec63"/>Deleting a file</h1></div></div></div><p>concrete5 allows developers to delete <a id="id239" class="indexterm"/>files through the PHP API. In this recipe, we will load a file by its ID and then delete it permanently.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec204"/>Getting ready</h2></div></div></div><p>Once a file has been deleted, it cannot be recovered. It is a good idea to experiment with a temporary or dummy file in this recipe so you do not delete anything important. This recipe will use the ID of <code class="literal">1</code> for the file to delete, but be sure to change this to something that you would be comfortable deleting.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec205"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Declare the ID of the file to delete:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Delete the file:<div class="informalexample"><pre class="programlisting">$file-&gt;delete();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec206"/>How it works...</h2></div></div></div><p>concrete5 will delete the file from your <a id="id240" class="indexterm"/>server's file system, as well as remove the reference to it in the MySQL database.</p></div></div>
<div class="section" title="Reindexing a file's search attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec64"/>Reindexing a file's search attributes</h1></div></div></div><p>When changing a file's attributes <a id="id241" class="indexterm"/>programmatically, sometimes the <a id="id242" class="indexterm"/>concrete5 search engine needs to be made aware of the new changes. In this exercise, we will reindex the search attributes for a file.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec207"/>Getting ready</h2></div></div></div><p>We will assume that a file with an ID of <code class="literal">1</code> exists in your concrete5 installation. Please adjust the ID in this recipe to a file that exists.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec208"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Declare the ID of the file to reindex:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Reindex the search attributes:<div class="informalexample"><pre class="programlisting">$file-&gt;reindex();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec209"/>How it works...</h2></div></div></div><p>concrete5 will query the database and update the search index for the given file. This will make sure that the internal search engine is able to find a file based on its most current attributes.</p></div></div>
<div class="section" title="Setting passwords on file objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec65"/>Setting passwords on file objects</h1></div></div></div><p>concrete5 supports adding <a id="id243" class="indexterm"/>passwords to individual files, so site owners can <a id="id244" class="indexterm"/>restrict the download of these files to only those people who possess the shared password.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec210"/>Getting ready</h2></div></div></div><p>This recipe will continue with the assumption of a file with the ID of <code class="literal">1</code>. Please make sure to adjust this ID to match something that exists in your own concrete5 website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec211"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> so we have a place to try out this code.</li><li class="listitem">Declare the file ID:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file by its ID:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Declare the password:<div class="informalexample"><pre class="programlisting">$password = 'secret';</pre></div></li><li class="listitem">Set the password on the file:<div class="informalexample"><pre class="programlisting">$file-&gt;setPassword($password);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec212"/>How it works...</h2></div></div></div><p>concrete5 will store the password in the database in plain text. Since this password is meant to be shared with several people, it is inherently insecure. As a result, concrete5 does not hash or encrypt the password for the file in the database. Once the password is set, the <code class="literal">on_file_set_password</code> event is fired.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec213"/>There's more...</h2></div></div></div><p>One can retrieve the password on a file by simply calling the <code class="literal">getPassword</code> function on the file:</p><div class="informalexample"><pre class="programlisting">$password = $file-&gt;getPassword();</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec214"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a file by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Setting permissions on files"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec66"/>Setting permissions on files</h1></div></div></div><p>In the previous recipe, we <a id="id245" class="indexterm"/>discussed how to set a shared password on the file. Sometimes, though, more robust security is desired. For that, we can hook into the concrete5 permissions model to provide more advanced access control.</p><p>In this recipe, we will give a user read access to a file.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec215"/>Getting ready</h2></div></div></div><p>This example will assume the existence of a file with the ID of <code class="literal">1</code> and also of a user with an ID of <code class="literal">1</code>. Adjust those IDs as needed.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec216"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Declare the ID of the file that we will be applying permissions to:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Declare the ID of the user who will be receiving these permissions:<div class="informalexample"><pre class="programlisting">$userId = 1;</pre></div></li><li class="listitem">Load the user:<div class="informalexample"><pre class="programlisting">$user = UserInfo::getByID($userId);</pre></div></li><li class="listitem">Set the permissions on the file:<div class="informalexample"><pre class="programlisting">$file-&gt;setPermissions($user, FilePermissions::PTYPE_MINE);</pre></div></li></ol></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec217"/>There's more...</h2></div></div></div><p>concrete5 uses static constants for the permission modes (none, mine, and all). These constants are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">FilePermissions::PTYPE_NONE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FilePermissions::PTYPE_MINE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FilePermissions::PTYPE_ALL</code></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec218"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="link" href="ch07.html" title="Chapter 7. Working with Users and Permissions">Chapter 7</a>, <span class="emphasis"><em>Working With Users and Permissions</em></span></li></ul></div></div></div>
<div class="section" title="Getting the download URL for a file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec67"/>Getting the download URL for a file</h1></div></div></div><p>concrete5 can enforce permissions <a id="id246" class="indexterm"/>on files as well as keep track of download statistics by funneling all download requests through a special URL. This also has the added advantage of serving the correct HTTP headers to force the download to the user's computer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec219"/>Getting ready</h2></div></div></div><p>As usual, we will have to assume the presence of a file with the ID of <code class="literal">1</code> in the file manager. Feel free to change this ID to something appropriate for your own website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec220"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your favorite code editor.</li><li class="listitem">Declare the ID of the file to load:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Get the download URL:<div class="informalexample"><pre class="programlisting">$url = $file-&gt;getDownloadURL();</pre></div></li><li class="listitem">Output the download URL to the screen:<div class="informalexample"><pre class="programlisting">echo $url;
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec221"/>How it works...</h2></div></div></div><p>concrete5 passes the download request through a special URL that is able to track permissions, downloads, and also send the correct HTTP headers for the download.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec222"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a file by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting the download statistics for a file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec68"/>Getting the download statistics for a file</h1></div></div></div><p>If you serve files using the <a id="id247" class="indexterm"/>download function described in the previous recipe, then the download numbers would be stored in the database. You can get these statistics using just a few lines of code.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec223"/>Getting ready</h2></div></div></div><p>We will assume that a file with an ID of <code class="literal">1</code> exists in the file manager. Change this variable as needed for your own concrete5 website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec224"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Declare the ID of the file of which we want to get the statistics for:<div class="informalexample"><pre class="programlisting">$fileId = 1;</pre></div></li><li class="listitem">Load the file:<div class="informalexample"><pre class="programlisting">$file = File::getByID($fileId);</pre></div></li><li class="listitem">Get the statistics array:<div class="informalexample"><pre class="programlisting">$stats = $file-&gt;getDownloadStatistics(false);</pre></div></li><li class="listitem">Dump the contents of the array:<div class="informalexample"><pre class="programlisting">my_debug($stats);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec225"/>How it works...</h2></div></div></div><p>When we call the <code class="literal">getDownloadStatistics</code> method of the file object, concrete5 will return only the 20 most recent <a id="id248" class="indexterm"/>downloads by default. By providing <code class="literal">false</code> as the parameter, we are telling concrete5 to return all of the results.</p></div></div>
<div class="section" title="Adding a file picker to a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec69"/>Adding a file picker to a form</h1></div></div></div><p>When building applications in <a id="id249" class="indexterm"/>concrete5, you will often find yourself creating <a id="id250" class="indexterm"/>
<span class="strong"><strong>CRUD</strong></span> (create, read, update, delete) interfaces on the dashboard for site editors and administrators to manage custom content. In some instances, you may have to handle file <a id="id251" class="indexterm"/>uploads on these backend forms. A useful tool on such forms would be to provide an interface to browse the file manager, rather than using the standard HTML file input. concrete5 uses the asset library widget to facilitate this for us.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec226"/>Getting ready</h2></div></div></div><p>In this recipe, we will create a basic HTML form that will send the selected file ID from the file manager along with the form submission. The full code for this recipe is available for download from the book's website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec227"/>How to do it...</h2></div></div></div><p>Have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new single page (if it doesn't already exist) at <code class="literal">/single_pages/upload.php</code>.</li><li class="listitem">If you need to, add the single page to the sitemap, by visiting <code class="literal">/dashboard/pages/single</code> and entering <code class="literal">upload</code> as the page path.</li><li class="listitem">In <code class="literal">upload.php</code>, load the asset Library helper:<div class="informalexample"><pre class="programlisting">&lt;?php $assetLibrary = Loader::helper('concrete/asset_library'); ?&gt;</pre></div></li><li class="listitem">Create an HTML form that outputs the file picker:<div class="informalexample"><pre class="programlisting">&lt;form method="POST" enctype="multipart/form-data"&gt;
   &lt;?php echo $assetLibrary-&gt;file('file_id', 'file_id', 'Select a file...') ?&gt;
   &lt;input type="hidden" name="file_upload" value="yes"&gt;
   &lt;input type="submit" value="Upload the file!"&gt;
&lt;/form&gt;</pre></div></li><li class="listitem">Create <code class="literal">/config/site_process.php</code> if it doesn't already exist.</li><li class="listitem">Check to see if a file upload has occurred:<div class="informalexample"><pre class="programlisting">if ($_POST['file_upload'] == 'yes') {
}</pre></div></li><li class="listitem">Inside the <code class="literal">if</code> statement, <a id="id252" class="indexterm"/>get the file ID of the chosen file:<div class="informalexample"><pre class="programlisting">$fileId = $_POST['file_id'];</pre></div></li><li class="listitem">Output the chosen file ID to the screen:<div class="informalexample"><pre class="programlisting">echo 'You have chosen file #'.$fileId;
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec228"/>How it works...</h2></div></div></div><p>The asset Library helper will output all of the <a id="id253" class="indexterm"/>necessary HTML and JavaScript to provide a nice, modal interface for the user to select a file from the file manager (or upload a new file to the file manager). Once the user selects a file, the file ID will be added to a hidden input which has the name that you provided in the <a id="id254" class="indexterm"/>
<code class="literal">file()</code> function's second parameter.</p><p>Once the user submits the form surrounding the file selector, the file ID will be included in the <code class="literal">$_POST</code> array (in this example, it would be in <code class="literal">$_POST['file_id']</code>), which you can then use for further storage or processing on the server side.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec229"/>There's more...</h2></div></div></div><p>You can also bring up a file manager window that is limited to only images. Use the following code to accomplish this:</p><div class="informalexample"><pre class="programlisting">&lt;form action="save" method="POST"&gt;
  &lt;p&gt;Choose a file...&lt;/p&gt;
  &lt;?php 
    $assetLibrary = Loader::helper('concrete/asset_library'); 
    $assetLibrary-&gt;image('file_id', 'file_id', 'Select a file...');
  ?&gt;
&lt;/form&gt;</pre></div><p>You may notice that the only change here is that, instead of calling <code class="literal">file()</code> on the <code class="literal">asset</code> <code class="literal">library</code> class, we call <code class="literal">image()</code>. This <a id="id255" class="indexterm"/>will do the same exact thing as <code class="literal">file()</code>, except limit the modal window to contain only images.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec230"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Uploading a file to the file manager</em></span> recipe</li></ul></div></div></div></body></html>