<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer355">
<h1 class="chapter-number" id="_idParaDest-233" lang="en-GB"><a id="_idTextAnchor233"/>12</h1>
<h1 id="_idParaDest-234" lang="en-GB"><a id="_idTextAnchor234"/>Gaining Insights through Moodle Reporting and Analytics</h1>
<p lang="en-GB">Moodle collects usage data from various activities from when users log in until they log out. This data can be utilized for a range of reporting and analytics activities, all of which will be dealt with in this chapter.</p>
<p lang="en-GB">To get an overview of the topics that will be covered, have a look at the following diagram:</p>
<div>
<div class="IMG---Figure" id="_idContainer326">
<img alt="Figure 12.1 – Reporting overview " height="714" src="image/Figure_12.01_B18779.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.1 – Reporting overview</p>
<p lang="en-GB">There are two types of reports in Moodle: <strong class="bold" lang="">custom reports</strong> created <a id="_idIndexMarker1170"/>with the report <a id="_idIndexMarker1171"/>generator and <strong class="bold" lang="">log-based reports</strong>, hardcoded in Moodle.</p>
<p lang="en-GB">The first part of this chapter will provide an overview <a id="_idIndexMarker1172"/>of the <strong class="bold" lang="">report generator</strong> and cover data sources, report building, report audiences, and schedules. We will also briefly cover a more technical third-party report generator: Configurable reports.</p>
<p lang="en-GB">The second part of this chapter deals with log-based reports. After a detailed overview of the underlying <strong class="bold" lang="">Moodle logging framework</strong> and<a id="_idIndexMarker1173"/> its components, events, and log stores, you will learn how to interact with Moodle logs.</p>
<p lang="en-GB">Finally, we<a id="_idIndexMarker1174"/> will deal with two<a id="_idIndexMarker1175"/> more reporting techniques that use logs as their basis: <strong class="bold" lang="">Moodle statistics</strong> and <strong class="bold" lang="">Moodle analytics</strong>.</p>
<p lang="en-GB">We won’t cover <strong class="bold" lang="">system reports</strong> in this chapter – that is, reports that deal with a particular topic; they will <a id="_idIndexMarker1176"/>be dealt with when the relevant topics are covered. For instance, backups reports will be described in <a href="B18779_16.xhtml#_idTextAnchor308"><em class="italic" lang="">Chapter 16</em></a>, <em class="italic" lang="">Avoiding Sleepless Nights – Moodle Backup and Restore</em>.</p>
<p lang="en-GB">In this chapter, we will cover the following topics:</p>
<ul>
<li lang="en-GB">Creating custom reports with the report generator</li>
<li lang="en-GB">Understanding Moodle’s logging framework</li>
<li lang="en-GB">Interacting with log-based reports</li>
<li lang="en-GB">Gathering statistics</li>
<li lang="en-GB">Making predictions with Moodle Analytics</li>
</ul>
<p lang="en-GB">OK, let’s start with the first part of this chapter and create custom reports with the report generator.</p>
<h1 id="_idParaDest-235" lang="en-GB"><a id="_idTextAnchor235"/>Creating custom reports with the report generator</h1>
<p lang="en-GB">The <strong class="bold" lang="">report generator</strong> was<a id="_idIndexMarker1177"/> initially implemented as part of Moodle Workplace, Moodle’s powerful and flexible learning platform for corporate training and workplace learning. Due to its popularity in Moodle’s commercial edition and its applicability across sectors, it was decided to port the report generator to Moodle 4. The stripped-down version has been adopted by Moodle and has proven to be a valuable addition to creating custom reports.</p>
<p lang="en-GB">So, before we deal with data sources and report building, let’s explore the report generator.</p>
<h2 id="_idParaDest-236" lang="en-GB"><a id="_idTextAnchor236"/>Exploring the report generator</h2>
<p lang="en-GB">You might not have<a id="_idIndexMarker1178"/> realized it, but you have already used reports in the previous 11 chapters! How? Well, Moodle has done something very smart: it uses internal reports for key features in Moodle. For example, the list of certificate templates in the <em class="italic" lang="">Skills and incentives</em> section in <a href="B18779_09.xhtml#_idTextAnchor181"><em class="italic" lang="">Chapter 9</em></a>, <em class="italic" lang="">Configuring Educational Features</em>, is a report. The report on config changes? You guessed it, yet another report. Every time you see a table list view in any Moodle tool, it is likely to be a built-in system report.</p>
<p lang="en-GB">Moodle distinguishes between two types of reports:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Internal reports</strong>: Embedded, predefined <a id="_idIndexMarker1179"/>reports that are part of Moodle. Internal reports cannot be modified or removed since Moodle relies on them.</li>
<li lang="en-GB"><strong class="bold" lang="">Custom reports</strong>: User-generated<a id="_idIndexMarker1180"/> reports made available to other users.</li>
</ul>
<p lang="en-GB">This section exclusively deals with custom reports, so let’s see how Moodle’s report builder works. The following <a id="_idIndexMarker1181"/>diagram illustrates the high-level elements of the reporting workflow:</p>
<div>
<div class="IMG---Figure" id="_idContainer327">
<img alt="Figure 12.2 – Report builder workflow " height="616" src="image/Figure_12.02_B18779.jpg" width="1384"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.2 – Report builder workflow</p>
<p lang="en-GB">Moodle<a id="_idIndexMarker1182"/> stores its data relevant to reporting in the <strong class="bold" lang="">Moodle database</strong>. External data sources might be added in future versions, but at the time of writing, this is the only data source available.</p>
<p lang="en-GB">The most flexible reporting tool would let you select individual fields from every entity in the underlying database. However, this would require users to be familiar with the entire database model, which contains well over 100 tables and even more relationships among them. Instead, Moodle offers some report sources to simplify the usage of the report builder.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">A <strong class="bold" lang="">report source</strong> contains<a id="_idIndexMarker1183"/> a predefined set of fields and relationships available when building a report.</p>
<p lang="en-GB">Based on the selected record source, a certain amount of data will be available, which can be reduced by the following mechanisms: <strong class="bold" lang="">Selecting data fields</strong> lets the report creator decide which columns are being made available – for example, student name, course name, and completion status. <strong class="bold" lang="">Applying conditions</strong> lets the report creator decide which rows will be made available – for instance, all records from a particular faculty. Access to reports is granted via audiences – for example, all users with the Manager role or all users who are members of a particular cohort.</p>
<p lang="en-GB">The report viewer <a id="_idIndexMarker1184"/>can then reduce the amount of data further via filters. A <strong class="bold" lang="">filter</strong>, which has to be configured by the report creator, allows<a id="_idIndexMarker1185"/> you to select one or more criteria – for instance, by course category or by country.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">A report isn’t static; it is an interactive view of your data.</p>
<p lang="en-GB">The following subsections are dedicated to each building block of the reporting workflow. Let’s start with the first part of the diagram: data and report sources.</p>
<h2 id="_idParaDest-237" lang="en-GB"><a id="_idTextAnchor237"/>Selecting data and report sources</h2>
<p lang="en-GB">In this subsection, we will deal with the input options for the report builder – you will learn what they are and when to use each option.</p>
<p lang="en-GB">The database is the<a id="_idIndexMarker1186"/> underlying <strong class="bold" lang="">data source</strong> where Moodle stores its data. Courses, users, course completions, grades, and other data – such as information about learning resources added by authors, forum posts contributed to by learners, and system settings configured by the administrator – are mostly stored in the database.</p>
<p lang="en-GB">A <strong class="bold" lang="">report source</strong> implicitly <a id="_idIndexMarker1187"/>defines which elements (tables and relationships) of the data source will be used in a report. The set of available report sources includes data such as user profile information, course data, or cohort membership. Additional report sources can be created by Moodle developers programmatically, and the number of record sources is expected to go up in upcoming releases.</p>
<p lang="en-GB">Before exploring the report builder, ensure the <strong class="bold" lang="">Enable custom reports</strong> setting is enabled under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Advanced features</strong>.</p>
<p lang="en-GB">Let’s look at<a id="_idIndexMarker1188"/> the report sources available in Moodle to date. You can manage reports via <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Report builder</strong> | <strong class="bold" lang="">Custom reports</strong>, where you will see a list of available reports – actually, what you will see is a report. A report of reports! In our example instance, we have already created some reports, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer328">
<img alt="Figure 12.3 – Custom reports and filters " height="1008" src="image/Figure_12.03_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.3 – Custom reports and filters</p>
<p lang="en-GB">The self-explanatory fields <a id="_idIndexMarker1189"/>shown in the report table are <strong class="bold" lang="">Name</strong>, <strong class="bold" lang="">Report source</strong>, <strong class="bold" lang="">Time created</strong>, <strong class="bold" lang="">Time modified</strong>, and <strong class="bold" lang="">Modified by</strong>. The standard actions available are <strong class="bold" lang="">Edit report content</strong>, <strong class="bold" lang="">Edit report details</strong>, <strong class="bold" lang="">View report</strong>, and <strong class="bold" lang="">Delete report</strong>. There are filters available on the right-hand side that let you limit the number of reports shown by <strong class="bold" lang="">Name</strong>, <strong class="bold" lang="">Report Source</strong>, and <strong class="bold" lang="">Time created</strong>.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Each report has one report source.</p>
<p lang="en-GB">The<a id="_idIndexMarker1190"/> selected report source cannot be changed once a report has been created. To use a different report source, a new report must be created.</p>
<p lang="en-GB">Select the <strong class="bold" lang="">New report</strong> button on the <strong class="bold" lang="">Reports</strong> page to create a new report. You will then be greeted with a pop-up screen, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer329">
<img alt="Figure 12.4 – Creating a new report " height="665" src="image/Figure_12.04_B18779.jpg" width="1395"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.4 – Creating a new report</p>
<p lang="en-GB">A report contains the following two compulsory settings: <strong class="bold" lang="">Name</strong> (displayed whenever the report is made available to users) and <strong class="bold" lang="">Report source</strong> (defines where the data for the report will come from). The following report sources are currently available in Moodle:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Badges</strong>: Badge<a id="_idIndexMarker1191"/> details linked to recipients (users) and courses</li>
<li lang="en-GB"><strong class="bold" lang="">Cohorts</strong>: Cohort <a id="_idIndexMarker1192"/>data and user membership details</li>
<li lang="en-GB"><strong class="bold" lang="">Course participants</strong>: Courses, users, and<a id="_idIndexMarker1193"/> their enrolments and course completions</li>
<li lang="en-GB"><strong class="bold" lang="">Courses</strong>: Course<a id="_idIndexMarker1194"/> and category details</li>
<li lang="en-GB"><strong class="bold" lang="">Tags</strong>: Tags<a id="_idIndexMarker1195"/> and tag categories</li>
<li lang="en-GB"><strong class="bold" lang="">Task logs</strong>: Data <a id="_idIndexMarker1196"/>regarding scheduled and ad hoc tasks</li>
<li lang="en-GB"><strong class="bold" lang="">Users</strong>: User<a id="_idIndexMarker1197"/> details</li>
</ul>
<p lang="en-GB">The following report sources are already in the pipeline and are likely to be available by the time you read this book: Notes, Blogs, Groups, Comments, and Files. Existing report sources may also be extended by adding more data fields, relations to other entities, conditions, and filters.</p>
<p lang="en-GB">There are two more settings when creating a new report<a id="_idIndexMarker1198"/> that require some attention:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Include default setup</strong>: When enabled, the report will already be populated with several predefined columns, conditions, and filters. When you get started, it is recommended that you leave this option ticked since it simplifies the process of building reports, which we will cover next.</li>
<li lang="en-GB"><strong class="bold" lang="">Remove any duplicate rows</strong>: When enabled, any duplicate rows will be removed from the report.</li>
</ul>
<p lang="en-GB">By default, there is no limit to the number of reports you or anybody with the <strong class="source-inline" lang="">reportbuilder:edit</strong> (edit your own custom reports) or <strong class="source-inline" lang="">reportbuilder:editall</strong> (edit all custom reports) capabilities can create. If you need to restrict the number of custom reports, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Report builder</strong> | <strong class="bold" lang="">Custom report settings</strong> and adjust the <strong class="bold" lang="">Custom reports limit</strong> setting accordingly.</p>
<p lang="en-GB">Another setting on the same screen that potentially improves performance is <strong class="bold" lang="">Custom reports live editing</strong>. If disabled, the preview of data while editing the report will be deactivated; otherwise, it will be kept up to date:</p>
<div>
<div class="IMG---Figure" id="_idContainer330">
<img alt="Figure 12.5 – Custom report settings " height="358" src="image/Figure_12.05_B18779.jpg" width="1407"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.5 – Custom report settings</p>
<p lang="en-GB">When you <strong class="bold" lang="">Save</strong> the report, you <a id="_idIndexMarker1199"/>will be redirected to the actual report builder, which we will cover next.</p>
<h2 id="_idParaDest-238" lang="en-GB"><a id="_idTextAnchor238"/>Building reports</h2>
<p lang="en-GB">In this<a id="_idIndexMarker1200"/> subsection, we will deal with the various facilities the report builder has to offer. You will learn what these are and how to apply them in real-world scenarios.</p>
<p lang="en-GB">The report generator allows you to build and customize reports with drag and drop, instant preview, inline column editing, grouping, and aggregation. The following annotated screenshot shows the key elements of the Moodle report generator:</p>
<div>
<div class="IMG---Figure" id="_idContainer331">
<img alt="Figure 12.6 – The report builder interface " height="540" src="image/Figure_12.06_B18779.jpg" width="1399"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.6 – The report builder interface</p>
<p lang="en-GB">The following actions are available in the report generator:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">A – Data fields panel</strong>: List of data fields, grouped by entities</li>
<li lang="en-GB"><strong class="bold" lang="">B – Data fields panel</strong>: Live search fields</li>
<li lang="en-GB"><strong class="bold" lang="">C – Preview panel</strong>: Inline editing of column names and headings</li>
<li lang="en-GB"><strong class="bold" lang="">D – Preview panel</strong>: For selecting the field aggregation method</li>
<li lang="en-GB"><strong class="bold" lang="">E – Preview panel</strong>: Preview toggle</li>
<li lang="en-GB"><strong class="bold" lang="">F – Settings panel</strong>: <strong class="bold" lang="">Conditions</strong></li>
<li lang="en-GB"><strong class="bold" lang="">G – Settings panel</strong>: <strong class="bold" lang="">Filters</strong></li>
<li lang="en-GB"><strong class="bold" lang="">H – Settings panel</strong>: <strong class="bold" lang="">Sorting</strong></li>
<li lang="en-GB"><strong class="bold" lang="">I – Settings panel</strong>: <strong class="bold" lang="">Card view</strong></li>
<li lang="en-GB"><strong class="bold" lang="">J – Report builder menu</strong>: Access to report tabs</li>
</ul>
<p lang="en-GB">For the <a id="_idIndexMarker1201"/>database boffins among you, it might be helpful to map the report elements to their SQL counterparts:</p>
<ul>
<li lang="en-GB">Selected data fields: <strong class="bold" lang="">SELECT … FROM …</strong></li>
<li lang="en-GB">Conditions: <strong class="bold" lang="">WHERE</strong></li>
<li lang="en-GB">Aggregation and grouping: <strong class="bold" lang="">GROUP BY</strong></li>
<li lang="en-GB">Sorting: <strong class="bold" lang="">ORDER BY</strong></li>
</ul>
<p lang="en-GB">Now that you have had a first glimpse of the report creation interface, let’s look closely at the various elements, which can be grouped into two categories: configuring fields (columns) and configuring settings (rows).</p>
<h3 lang="en-GB">Configuring fields (columns)</h3>
<p lang="en-GB">This <a id="_idIndexMarker1202"/>subsection deals with available options to customize the columns in a report.</p>
<p lang="en-GB">In the left-hand side panel of the Moodle report generator, you will see all available fields for the selected report source, which have been grouped into entities. Each entity can be expanded or collapsed for better usability. You can also search for field entries to limit the number of displayed items. These items have been labeled <strong class="bold" lang="">A</strong> and <strong class="bold" lang="">B</strong> in the previous screenshot.</p>
<p lang="en-GB">To add columns to the report, click on the selected field on the left list. The column will be added automatically as the rightmost column in the table. You can then rearrange the column order via the standard <strong class="bold" lang="">Move</strong> handle. To remove a column, click on the standard delete icon.</p>
<p lang="en-GB">Two field types are available that can be added as columns to a report:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Text fields</strong>: For example, surname, department, or course name</li>
<li lang="en-GB"><strong class="bold" lang="">Image fields</strong>: For example, user picture or badge image</li>
</ul>
<p lang="en-GB">Most text fields <a id="_idIndexMarker1203"/>reflect a value from the underlying Moodle database. However, some text fields are preprocessed by the report generator to support additional functionality:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Hyperlinked text fields</strong>: Mainly <a id="_idIndexMarker1204"/>to directly view data entries – for example, to a user profile or a course</li>
<li lang="en-GB"><strong class="bold" lang="">Calculated text fields</strong>: To <a id="_idIndexMarker1205"/>provide a numeric value – for instance, the number of courses in a category</li>
<li lang="en-GB"><strong class="bold" lang="">Grouped text fields</strong>: To <a id="_idIndexMarker1206"/>provide multiple data points as a single cell – for example, the members in a cohort</li>
</ul>
<p lang="en-GB">Custom fields, such as custom user profile fields or custom course fields, are fully supported by the report generator. They will appear in the list of available fields, just like any built-in variable.</p>
<p lang="en-GB">One of the most powerful features of the report generator is its support for <strong class="bold" lang="">aggregation</strong>. Have a <a id="_idIndexMarker1207"/>look at the following three reports, all with the same fields but different aggregation methods applied to the <strong class="bold" lang="">Badge recipient</strong> column:</p>
<div>
<div class="IMG---Figure" id="_idContainer332">
<img alt="Figure 12.7 – Aggregation " height="807" src="image/Figure_12.07_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.7 – Aggregation</p>
<p lang="en-GB">In the first<a id="_idIndexMarker1208"/> report, <strong class="bold" lang="">No aggregation</strong> has been applied, so all data entries are shown. In the second report, the <strong class="bold" lang="">Comma separated values</strong> option has been selected, which displays multiple usernames in a single cell. In the last report, the <strong class="bold" lang="">Count</strong> method was chosen, which shows the number of recipients per badge.</p>
<p lang="en-GB">Depending on the data field selected, different methods are at your disposal, as shown in the following table, including the SQL function used internally:</p>
<div>
<div class="IMG---Figure" id="_idContainer333">
<img alt="Figure 12.8 – Aggregation operations " height="370" src="image/Figure_12.08_B18779.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.8 – Aggregation operations</p>
<p lang="en-GB">An aggregate<a id="_idIndexMarker1209"/> function calculates a set of values and returns a single value. For example, <strong class="bold" lang="">Count</strong> takes a list of values and returns – you guessed it – the number of items. The <strong class="bold" lang="">Remove any duplicate rows</strong> setting has no effect if columns are aggregated.</p>
<p lang="en-GB">Using the <strong class="bold" lang="">Course participants</strong> record source in conjunction with aggregation methods, you can create powerful reports, such as the following:</p>
<ul>
<li lang="en-GB">Number of users enrolled in each course: <strong class="bold" lang="">Course full name</strong> (<strong class="bold" lang="">No aggregation</strong>), <strong class="bold" lang="">User Full name</strong> (<strong class="bold" lang="">Count</strong>)</li>
<li lang="en-GB">Users enrolled in each course: <strong class="bold" lang="">Course full name</strong> (<strong class="bold" lang="">No aggregation</strong>), <strong class="bold" lang="">User Full name</strong> (<strong class="bold" lang="">Comma separated distinct value</strong>)</li>
<li lang="en-GB">Number of completions of each course: <strong class="bold" lang="">Course full name</strong> (<strong class="bold" lang="">No aggregation</strong>), <strong class="bold" lang="">Course completion</strong> (<strong class="bold" lang="">Distinct count</strong>)</li>
</ul>
<p lang="en-GB">There is no system behind what methods are available for which field type. For each data field, a set of possible aggregation methods is offered by Moodle.</p>
<p lang="en-GB">Viewers also have the option to download the table data in various formats, namely CSV, XLSX, HTML, JSON, ODS, and PDF. You can reduce or rearrange the options in that list by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Data formats</strong> | <strong class="bold" lang="">Manage data formats</strong>. The XLSX format is useful for visualizing data using Excel’s charting tools.</p>
<p lang="en-GB">Now that we have exhausted all the options for customizing columns in a report, let’s look at how to configure the second dimension in a table: rows.</p>
<h3 lang="en-GB">Configuring settings (rows)</h3>
<p lang="en-GB">This<a id="_idIndexMarker1210"/> subsection deals with the available options for customizing or limiting the rows in a report. This can be done via the <strong class="bold" lang="">Settings</strong> panel on the right-hand side, where you can access the <strong class="bold" lang="">Conditions</strong>, <strong class="bold" lang="">Filters</strong>, <strong class="bold" lang="">Sorting</strong>, and <strong class="bold" lang="">Card view</strong> accordion panels. These configuration options will be described in the following four subsections.</p>
<h4 lang="en-GB">Conditions</h4>
<p lang="en-GB">Conditions<a id="_idIndexMarker1211"/> let you limit the amount of data that is being presented to the report viewer. For example, you might want to exclude any suspended users from your reports.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Conditions are a predefined set of criteria that are always applied when viewing a report. Conditions cannot be changed in viewing mode.</p>
<p lang="en-GB">Depending on the selected report source, the list of available conditions might differ slightly from the list of available fields.</p>
<p lang="en-GB">An interesting condition available in most report sources is <strong class="bold" lang="">Select user</strong>, which has three options:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Any user</strong>: All users are shown.</li>
<li lang="en-GB"><strong class="bold" lang="">Current user</strong>: The report only shows data about the report viewer. Using this powerful mode, you can create reports that display personalized data, depending on who is viewing the report. For example, if you wish to create a report showing the progress of the report viewer in each course, select the <strong class="bold" lang="">Course full name</strong> and <strong class="bold" lang="">Student progress</strong> fields and set the <strong class="bold" lang="">Select user</strong> condition to <strong class="bold" lang="">Current user</strong>. When students view the report, they will only see the progress in the courses they are enrolled in.</li>
<li lang="en-GB"><strong class="bold" lang="">Select</strong>: The same principle as <strong class="bold" lang="">Current user</strong>, but you can select one or many users.</li>
</ul>
<p lang="en-GB">Two more conditions let you select values: <strong class="bold" lang="">Select course</strong> and <strong class="bold" lang="">Select category</strong>, including an option to <strong class="bold" lang="">View all subcategories</strong>.</p>
<h4 lang="en-GB">Filters</h4>
<p lang="en-GB">The following two <a id="_idIndexMarker1212"/>screenshots show configuring filters (left) and what the first three entries look like from a user’s perspective when viewing the report (right):</p>
<div>
<div class="IMG---Figure" id="_idContainer334">
<img alt="Figure 12.9 – Report filtering " height="868" src="image/Figure_12.09_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.9 – Report filtering</p>
<p lang="en-GB">We described the <strong class="bold" lang="">Current user</strong> option in the <strong class="bold" lang="">Select user</strong> filter, which creates a unique report for each viewer. This type of filter also impacts reports created automatically and sent out to users via schedules (see the <em class="italic" lang="">Scheduling reports section</em> further down).</p>
<p lang="en-GB">You can add as <a id="_idIndexMarker1213"/>many filters as you wish. Furthermore, the list of filters is not limited to the fields shown in the report. For example, in a user report, you might add a filter to narrow the search down to individual authentication methods, even though the field is not available in the report itself.</p>
<h4 lang="en-GB">Sorting</h4>
<p lang="en-GB">The penultimate of the four settings <a id="_idIndexMarker1214"/>deals with the order in which the data is presented.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Sorting defines the initial order in which the fields are being ordered.</p>
<p lang="en-GB">In the following <a id="_idIndexMarker1215"/>screenshot, the data is ordered by <strong class="bold" lang="">Category name</strong> (in ascending order), <strong class="bold" lang="">Course short name</strong> (in descending order), and <strong class="bold" lang="">Course full name</strong> (in ascending order):</p>
<div>
<div class="IMG---Figure" id="_idContainer335">
<img alt="Figure 12.10 – Report sorting " height="547" src="image/Figure_12.10_B18779.jpg" width="700"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.10 – Report sorting</p>
<p lang="en-GB">When in viewing mode, the preceding order will initially be applied. Once a user clicks on a column name, the data will be sorted by this field; the sort order will be reversed when the same column is clicked again.</p>
<h4 lang="en-GB">Card view</h4>
<p lang="en-GB">The card view<a id="_idIndexMarker1216"/> feature supports responsive layout design in the report builder. Card view allows you to configure the report layout for narrow views when the block is in the sidebar or a smaller device is used. A report will automatically switch to card view when displayed on small screens.</p>
<h2 id="_idParaDest-239" lang="en-GB"><a id="_idTextAnchor239"/>Report audiences</h2>
<p lang="en-GB">Report <a id="_idIndexMarker1217"/>audiences indicate which users have access to the report. They can also be used as recipients in scheduled reports. To access audiences, select the <strong class="bold" lang="">Audiences</strong> tab of a report, where you can create the following audiences:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">All users</strong>: Use this audience to give access to all users</li>
<li lang="en-GB"><strong class="bold" lang="">Assigned system role</strong>: Select at least one system role</li>
<li lang="en-GB"><strong class="bold" lang="">Manually added users</strong>: Select at least one user (via name or email address)</li>
<li lang="en-GB"><strong class="bold" lang="">Member of cohort</strong>: Select at least one cohort</li>
<li lang="en-GB"><strong class="bold" lang="">Site administrators</strong>: Moodle admins – that is, you and everybody who is also an admin</li>
</ul>
<p lang="en-GB">To confirm which users now have access to the report, switch to the <strong class="bold" lang="">Access</strong> tab, which is, as you might have guessed by now, yet another system report. Now that we know who has been granted access to the report, let’s configure when a report is sent to the specified audiences.</p>
<h2 id="_idParaDest-240" lang="en-GB"><a id="_idTextAnchor240"/>Scheduling reports</h2>
<p lang="en-GB">By default, all reports are available as pull reports; that is, users have to select and view a report proactively. This section provides instructions on configuring the automatic delivery of reports via the report scheduler, known as<a id="_idIndexMarker1218"/> push reports. Having users log in to see a report is less effective than having the report land directly in their inbox.</p>
<p lang="en-GB">To access <a id="_idIndexMarker1219"/>the scheduler, select the <strong class="bold" lang="">Schedules</strong> tab of a report. And yes, the list of schedules is yet another system report with a predefined filter:</p>
<div>
<div class="IMG---Figure" id="_idContainer336">
<img alt="Figure 12.11 – Scheduling reports I " height="405" src="image/Figure_12.11_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.11 – Scheduling reports I</p>
<p lang="en-GB">Select the <strong class="bold" lang="">New schedule</strong> button at the top right to create a new report schedule. You will then be presented with a pop-up window containing the following four sections:</p>
<div>
<div class="IMG---Figure" id="_idContainer337">
<img alt="Figure 12.12 – Scheduling reports II " height="578" src="image/Figure_12.12_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.12 – Scheduling reports II</p>
<p lang="en-GB">These four sections <a id="_idIndexMarker1220"/>contain the following settings:</p>
<ul>
<li lang="en-GB">The <strong class="bold" lang="">General</strong> part of the screen contains information about the schedule, including what report to send, in which format the report should be sent, and the timing settings.</li>
</ul>
<p lang="en-GB"><strong class="bold" lang="">Name</strong> is only used in the list of schedules. The <strong class="bold" lang="">Format</strong> dropdown lets you pick the file format of the report. The options are CSV, XLSX, HTML, JSON, ODF, and PDF. You can reduce or rearrange the options in that list by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Data formats</strong> | <strong class="bold" lang="">Manage data formats</strong>.</p>
<p lang="en-GB">The <strong class="bold" lang="">Starting from</strong> setting specifies when the report will be sent for the first time. The <strong class="bold" lang="">Recurrence</strong> option lets you specify whether the report should be sent once (<strong class="bold" lang="">None</strong>) or frequently. The repeating options are <strong class="bold" lang="">Daily</strong>, <strong class="bold" lang="">Daily (Weekdays only)</strong>, <strong class="bold" lang="">Weekly</strong>, <strong class="bold" lang="">Monthly</strong>, and <strong class="bold" lang="">Annually</strong>. The <strong class="source-inline" lang="">cron</strong> process triggers the execution of the report being sent.</p>
<p lang="en-GB">The last setting in this section is <strong class="bold" lang="">View report data as</strong>, which has three options: <strong class="bold" lang="">Schedule creator</strong>, <strong class="bold" lang="">Schedule recipient</strong>, or <strong class="bold" lang="">Select user</strong>. If a user or the schedule creator is selected, the attached report data will be included as if viewed by this masquerading user; that is, all recipients will receive the same report. If left empty, the report’s recipient will be used; individual reports will be sent out, depending on how the report has been configured. The <strong class="source-inline" lang="">reportbuilder:scheduleviewas</strong> capability determines whether reports can be scheduled to be viewed as others.</p>
<ul>
<li lang="en-GB">In the <strong class="bold" lang="">Audience</strong> section, you specify who the recipients are. You need to select at least one audience, as specified previously. If no audiences have been specified yet, a warning will be shown.</li>
<li lang="en-GB">The <strong class="bold" lang="">Schedule</strong> section contains the custom message, which includes the two standard elements of any email message: <strong class="bold" lang="">Subject</strong> and <strong class="bold" lang="">Body</strong>. At the time of writing, no<a id="_idIndexMarker1221"/> placeholders are supported, so you will have to tailor the message text accordingly.</li>
<li lang="en-GB">In the <strong class="bold" lang="">Advanced</strong> section, there is only a single option, which lets you specify what happens <em class="italic" lang="">If the report is empty</em>. The self-explanatory options are <strong class="bold" lang="">Send message with empty report</strong>, <strong class="bold" lang="">Send message without report</strong>, and <strong class="bold" lang="">Don’t send message</strong> (default).</li>
</ul>
<p lang="en-GB">With that, we have provided an overview of the report generator, a potentially powerful tool for generating custom reports. However, it has some limitations, which we will discuss in the following section.</p>
<h2 id="_idParaDest-241" lang="en-GB"><a id="_idTextAnchor241"/>Report generator limitations and an alternative</h2>
<p lang="en-GB">The report builder<a id="_idIndexMarker1222"/> is a powerful tool for creating reports based on predefined report sources. At the time of writing, the number of report sources available is rather small, but it is expected that this limitation will change in the very near future. Moodle Workplace (<a href="http://docs.moodle.org/en/Report_builder">docs.moodle.org/en/Report_builder</a>) already contains significantly more report sources than Moodle, so watch out for new sources being added soon.</p>
<p lang="en-GB">We mentioned earlier that the report creator’s main advantage is that you don’t have to be familiar with Moodle’s underlying database schema. However, some administrators find the concept of report sources too <a id="_idIndexMarker1223"/>restrictive and wish to create more flexible reports. <strong class="bold" lang="">Configurable reports</strong> (<a href="http://moodle.org/plugins/block_configurable_reports">moodle.org/plugins/block_configurable_reports</a>) is a popular third-party plugin for Moodle, which appears as a block once installed. The plugin supports the following five types of reports:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Course reports</strong>: Reports that use course data</li>
<li lang="en-GB"><strong class="bold" lang="">Category reports</strong>: Reports that use category data plus optional embedded course reports</li>
<li lang="en-GB"><strong class="bold" lang="">User reports</strong>: Reports that use user data and their course activities</li>
<li lang="en-GB"><strong class="bold" lang="">Timeline reports</strong>: Reports across time for courses, users, and their activities</li>
<li lang="en-GB"><strong class="bold" lang="">SQL reports</strong>: Any valid SQL statement can be used to query the Moodle database</li>
</ul>
<p lang="en-GB">Depending on what type of report has been chosen, different selection criteria (fields, conditions, ordering, and calculations) are offered. Additionally, filters for drill-down can be specified, the layout can be created, and permissions for who is allowed to run the report can be set. Furthermore, the plugin can plot different types of graphs.</p>
<p lang="en-GB">The unique feature of Configurable reports is that you can create reports based on <strong class="bold" lang="">Custom SQL</strong>. If you are familiar with the SQL language and the underlying Moodle database schema, you <a id="_idIndexMarker1224"/>can add queries, such as the one shown in the following screenshot arrangement:</p>
<div>
<div class="IMG---Figure" id="_idContainer338">
<img alt="Figure 12.13 – Configurable reports sample" height="772" src="image/Figure_12.13_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.13 – Configurable reports sample</p>
<p lang="en-GB">In the preceding screenshot, you can also see a link to <strong class="bold" lang="">List of SQL Contributed reports</strong>, which is a very good starting point for creating reports (this is where I got the SQL query of the sample report).</p>
<p lang="en-GB">This concludes this section on custom reporting based on Moodle’s report builder, where we covered the tool’s workflow, the available data sources, and configuration. In addition to creating flexible custom reports, Moodle ships with several predefined reports that make use of the logging framework, mentioned in this chapter’s introduction.</p>
<h1 id="_idParaDest-242" lang="en-GB"><a id="_idTextAnchor242"/>Understanding Moodle’s logging framework</h1>
<p lang="en-GB">Moodle has<a id="_idIndexMarker1225"/> a powerful built-in logging framework that is, as expected, fully customizable and extensible. The idea behind the logging mechanism is as follows:</p>
<ul>
<li lang="en-GB">A user performs an action that triggers an <strong class="bold" lang="">Event</strong>. An example is a student who posts a reply on a forum.</li>
<li lang="en-GB">The <strong class="bold" lang="">Log manager</strong> entity monitors the event and decides whether it will be logged or ignored. Site-wide log manager settings determine this behavior.</li>
<li lang="en-GB">The log manager sends the data to the active <strong class="bold" lang="">Log store plugin</strong>, which filters or enriches the information. The passed-on data might be augmented with an IP address and a timestamp.</li>
<li lang="en-GB">The data is then written to the configured <strong class="bold" lang="">Log store</strong>.</li>
</ul>
<p lang="en-GB">The top half of the diagram shows this logging workflow:</p>
<div>
<div class="IMG---Figure" id="_idContainer339">
<img alt="Figure 12.14 – From events to reports" height="686" src="image/Figure_12.14_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.14 – From events to reports</p>
<p lang="en-GB">Now, let’s take a look at what happens when a user requests a report, which is represented in the bottom half of the diagram:</p>
<ul>
<li lang="en-GB">The reporting module notifies the log manager, who passes on the request to the log store plugin. If more than one log store has been set up, the user must select one.</li>
<li lang="en-GB">The log store plugin reads the relevant data from the log store and passes it back to the log manager.</li>
<li lang="en-GB">The report module<a id="_idIndexMarker1226"/> generates the report, which is then displayed to the user.</li>
</ul>
<p lang="en-GB">Now, let’s look at the individual components of Moodle’s logging framework in more detail, starting with events.</p>
<h2 id="_idParaDest-243" lang="en-GB"><a id="_idTextAnchor243"/>Understanding events</h2>
<p lang="en-GB">Two closely related elements <a id="_idIndexMarker1227"/>deal with events in Moodle – the events list and event monitoring rules:</p>
<div>
<div class="IMG---Figure" id="_idContainer340">
<img alt="Figure 12.15 – Events, events list, and event monitoring rules " height="451" src="image/Figure_12.15_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.15 – Events, events list, and event monitoring rules</p>
<p lang="en-GB">These concepts have been illustrated in the preceding diagram and will be described in detail in the remainder of this subsection, starting with the events list.</p>
<h3 lang="en-GB">Events list</h3>
<p lang="en-GB">Most actions in<a id="_idIndexMarker1228"/> Moodle trigger an event. You can look at the list of all the available events by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Events list</strong>. This list will grow over time, with internal and external events being added. Each event comprises the following elements:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Event name</strong>: The name of the event and a unique internal identifier</li>
<li lang="en-GB"><strong class="bold" lang="">Component</strong>: The Moodle component that the event belongs to; for instance, Core, a course module, or some other part, such as statistics or logs</li>
<li lang="en-GB"><strong class="bold" lang="">Education level</strong>: There are three levels: <strong class="bold" lang="">Participating</strong>, <strong class="bold" lang="">Teaching</strong>, and <strong class="bold" lang="">Other</strong></li>
<li lang="en-GB"><strong class="bold" lang="">Database query type</strong>: Four query types can occur, namely <strong class="bold" lang="">create, read, update, and delete</strong> (<strong class="bold" lang="">CRUD</strong>)</li>
<li lang="en-GB"><strong class="bold" lang="">Affected table</strong>: The database table that is being affected</li>
<li lang="en-GB"><strong class="bold" lang="">Since</strong>: The Moodle version when the event was introduced</li>
<li lang="en-GB"><strong class="bold" lang="">Legacy event</strong>: The event that was triggered in the legacy log store (this only contains events from version 2.6, when events were introduced)</li>
</ul>
<p lang="en-GB">The following screenshot shows some events filtered by <strong class="bold" lang="">user</strong>:</p>
<div>
<div class="IMG---Figure" id="_idContainer341">
<img alt="Figure 12.16 – Events list (filtered by user) " height="774" src="image/Figure_12.16_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.16 – Events list (filtered by user)</p>
<p lang="en-GB">You can filter <a id="_idIndexMarker1229"/>the list by <strong class="bold" lang="">Name</strong>, <strong class="bold" lang="">Component</strong>, <strong class="bold" lang="">Education level</strong>, and <strong class="bold" lang="">Database query type</strong>. You will see a more detailed presentation of the same information by clicking on an event name. In the screenshot arrangement, we have selected the <strong class="bold" lang="">User added to cohort</strong> event. In addition to fields already familiar from the events list, the screenshot shows two additional items of information:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Parent Event</strong>: Internally, events are organized hierarchically, but the information is relevant mainly to developers.</li>
<li lang="en-GB"><strong class="bold" lang="">Plugins observing this event</strong>: These are the plugins that monitor the event. Here, we have a log store manager (<strong class="source-inline" lang="">tool_log</strong>); the event monitor itself; the Cohort sync module, which ensures that every time a user is added to a cohort, they will also be enrolled in linked courses; and the core system itself.</li>
</ul>
<p lang="en-GB">The information about events is for administrators, mostly for information purposes. However, it is relevant when setting up event monitoring rules.</p>
<h3 lang="en-GB">Event monitoring rules</h3>
<p lang="en-GB">Administrators (and users with the <strong class="source-inline" lang="">tool/monitor:managerules</strong> capability) can define events<a id="_idIndexMarker1230"/> that you can subscribe to. These patterns of activities are represented as rules that contain an event as well as a frequency. Once such a pattern has been detected, an event will be triggered, sending a message to all subscribers.</p>
<p lang="en-GB">While users with editing teacher rights can set up their own rules at the course level, you, as the administrator, are more likely to define a set of required rules to which educators will subscribe.</p>
<p lang="en-GB">First, you must enable event monitoring by navigating to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Event monitoring rules</strong>.</p>
<p lang="en-GB">Let’s add our first event rule via the <strong class="bold" lang="">Add a new rule</strong> button. Once you have entered <strong class="bold" lang="">Rule name</strong>, select  <strong class="bold" lang="">Area to monitor</strong>. The values in the list are identical to those you came across in the <strong class="bold" lang="">Component</strong> dropdown, as seen in the preceding events list. Once chosen, the <strong class="bold" lang="">Event</strong> list will be populated with all the available events that the component supports. The description is optional, but it is recommended that you provide this for potential subscribers. The <strong class="bold" lang="">Notification threshold</strong> … <strong class="bold" lang="">in minutes</strong> combo specifies the number of events within a specified period that are required for the <strong class="bold" lang="">Notification message</strong> property to be sent. The body of this message can include any or all of the placeholders explained in the sample message text shown in the following screenshots:</p>
<div>
<div class="IMG---Figure" id="_idContainer342">
<img alt="Figure 12.17 – Events monitoring rules and subscriptions " height="1317" src="image/Figure_12.17_B18779.jpg" width="1384"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.17 – Events monitoring rules and subscriptions</p>
<p lang="en-GB">Any user with<a id="_idIndexMarker1231"/> the <strong class="source-inline" lang="">tool/monitor:subscribe</strong> capability can subscribe to event rules via the <strong class="bold" lang="">Event monitoring</strong> link in the <strong class="bold" lang="">Miscellaneous</strong> section under <strong class="bold" lang="">Preferences</strong>. Once an event rule has subscriptions, rules editing is limited.</p>
<p lang="en-GB">Before subscribing to a course, you must <strong class="bold" lang="">Select a course</strong> that is monitored (<strong class="bold" lang="">Site</strong> covers all courses). From now on, a notification message will be sent when the subscribed rule is triggered.</p>
<p lang="en-GB">Now that we have covered events in detail, let’s have a look at the logging components of our diagram.</p>
<h2 id="_idParaDest-244" lang="en-GB"><a id="_idTextAnchor244"/>Logging and log stores</h2>
<p lang="en-GB">Logging<a id="_idIndexMarker1232"/> involves three <a id="_idIndexMarker1233"/>components: the log manager, log store plugins, and physical log stores.</p>
<p lang="en-GB">The <strong class="bold" lang="">log manager</strong> is an<a id="_idIndexMarker1234"/> internal component that monitors events and passes data to all enabled log store plugins. Moodle comes with a predefined log manager; however, this may be replaced by other log manager plugins in the future. For now, as an administrator, you have no means of configuring the log manager itself.</p>
<p lang="en-GB">A <strong class="bold" lang="">log store plugin</strong> is <a id="_idIndexMarker1235"/>associated with a physical log store and determines what data is stored and read. Navigate to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Logging</strong> | <strong class="bold" lang="">Manage log stores</strong> to see Moodle’s three core log store plugins: <strong class="bold" lang="">Standard log</strong>, <strong class="bold" lang="">External database log</strong>, and <strong class="bold" lang="">Legacy log</strong>. We will ignore legacy logs as they will be discontinued over time.</p>
<p lang="en-GB">The <strong class="bold" lang="">standard log store</strong> has<a id="_idIndexMarker1236"/> replaced the legacy log; it supports all new logging concepts and provides better performance. In its <strong class="bold" lang="">Settings</strong>, you can specify whether to <strong class="bold" lang="">Log guest access</strong>, whether to store in <strong class="bold" lang="">JSON format</strong> (instead of serialized PHP), how long to <strong class="bold" lang="">Keep logs for</strong>, and its <strong class="bold" lang="">Write buffer size</strong>.</p>
<p lang="en-GB">You can configure <a id="_idIndexMarker1237"/>an <strong class="bold" lang="">external database log</strong> store if you wish to write logging information to a database separate from Moodle. This additional data storage is useful if you wish to collect data for more detailed analysis or data warehousing operations. This is shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer343">
<img alt="Figure 12.18 – Configuring the external database log store " height="908" src="image/Figure_12.18_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.18 – Configuring the external database log store</p>
<p lang="en-GB">By default, the<a id="_idIndexMarker1238"/> same databases are supported as when we installed Moodle. The database host, user, password, and name settings are identical to the ones we covered in <a href="B18779_01.xhtml#_idTextAnchor020"><em class="italic" lang="">Chapter 1</em></a>, <em class="italic" lang="">Installing Moodle</em>. Additionally, you have to specify a <strong class="bold" lang="">Database table</strong>, the structure of which has to be identical to the one stored in <strong class="source-inline" lang="">mdl_logstore_standard_log</strong>. Ensure you test the connection (the link is at the top of the screen); if successful, the check will display the columns that the external table contains. You can also specify various settings for a persistent database connection if you have a lot of logging traffic on your site and performance is an issue.</p>
<p lang="en-GB">Now comes the exciting part of the external log store plugin. You can specify filters, which will then be applied when storing the data:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Log guest actions</strong>: This tells you whether guest actions are stored or not. Usually, this is not required unless you wish to log all users’ traffic.</li>
<li lang="en-GB"><strong class="bold" lang="">Educational levels</strong>: These are the three types that we came across in the events section, namely <strong class="bold" lang="">Teaching</strong>, <strong class="bold" lang="">Participating</strong>, and <strong class="bold" lang="">Other</strong>.</li>
<li lang="en-GB"><strong class="bold" lang="">Database query types</strong>: These are the four CRUD types we came across in the events section, namely <strong class="bold" lang="">Create</strong>, <strong class="bold" lang="">Read</strong>, <strong class="bold" lang="">Update</strong>, and <strong class="bold" lang="">Delete</strong>.</li>
</ul>
<p lang="en-GB">Filtering logs is useful when privacy regulations do not allow you to store actions of certain users or types (refer to <a href="B18779_14.xhtml#_idTextAnchor271"><em class="italic" lang="">Chapter 14</em></a>, <em class="italic" lang="">Complying with Data Protection Regulations</em>) and when reporting from the log store does not require specific actions; this will also have a beneficial impact on performance.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">External database logs supplement the standard log, not replace them. Disabling the standard log will cause log-based system reports to malfunction.</p>
<p lang="en-GB">You can add<a id="_idIndexMarker1239"/> additional log stores from <a href="http://moodle.org/plugins/?q=type:logstore">moodle.org/plugins/?q=type:logstore</a>. An interesting option is <strong class="bold" lang="">Logstore xAPI</strong>, which emits xAPI statements (also known as Tin Can) to an LRS of your choice.</p>
<p lang="en-GB">This concludes this subsection on logging components, which covered the log store manager, log store plugins, and the log store itself. The last element in our process diagram covers log-based reports, which we will cover next.</p>
<h1 id="_idParaDest-245" lang="en-GB"><a id="_idTextAnchor245"/>Interacting with log-based reports</h1>
<p lang="en-GB">There are two <a id="_idIndexMarker1240"/>types of built-in reports in Moodle: ones supplied with data from a log store and others generated on the fly without log store input. You can view the list of reports by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Manage reports</strong>, as shown in the following annotated screenshot (the icons on the left indicate whether it is a course, system, or another type of report):</p>
<div>
<div class="IMG---Figure" id="_idContainer344">
<img alt="Figure 12.19 – System reports " height="1167" src="image/Figure_12.19_B18779.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.19 – System reports</p>
<p lang="en-GB">Here, you <a id="_idIndexMarker1241"/>can see when a report requires a log store and, if so, which ones are supported. We will focus on (live) logs since they form the basis for log-based reporting, before moving on to statistics and analytics.</p>
<p lang="en-GB">Remember that most information you retrieve from log-based reporting is also available to teachers at the course level. While educators use this information mainly in a pedagogical context (to monitor progress and measure performance), your role as an administrator is to view this data in a site-wide context. Furthermore, you are the one who is likely to be approached if any claims, problems, or other anomalies occur, for example, if a student insists on having submitted an assignment that is not on the system or a teacher is unable to log in from home. Given the sensitivity of such data and your organization’s policies, access to some operations has to be deactivated via roles and capabilities (added to the right of each report, if available).</p>
<p lang="en-GB">Depending on your setup and configuration, Moodle records a detailed log of each action that users perform. By default, each record (or hit) in the standard log contains data about the following:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Who</strong> (user)</li>
<li lang="en-GB"><strong class="bold" lang="">What</strong> (action)</li>
<li lang="en-GB"><strong class="bold" lang="">When</strong> (date and time)</li>
<li lang="en-GB"><strong class="bold" lang="">Where</strong> (IP address)</li>
</ul>
<p lang="en-GB">Site-wide logs can be <a id="_idIndexMarker1242"/>accessed by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Logs</strong>. At the top of the page, you can interactively drill down to the data via filters, which is useful if you need to locate data about an individual, an activity, or a course. For example, if pupils claim that they have submitted an assignment, which cannot be located, the tracking log will be able to shed light on this. The available filters are as follows:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Courses</strong>: Select a specific course or the entire Moodle site (site logs).</li>
<li lang="en-GB"><strong class="bold" lang="">Groups</strong>: Select a specific group or <strong class="bold" lang="">All groups</strong>. This filter is only displayed if group mode is enabled in the selected course.</li>
<li lang="en-GB"><strong class="bold" lang="">Participants</strong>: Select a specific user or <strong class="bold" lang="">All participants</strong>.</li>
<li lang="en-GB"><strong class="bold" lang="">Date</strong>: Specify a particular day or all days of activity. Unfortunately, it is not (yet) possible to specify date ranges.</li>
<li lang="en-GB"><strong class="bold" lang="">Activities</strong>: Select whether you wish to run a report of <strong class="bold" lang="">All activities</strong> or <strong class="bold" lang="">Site errors</strong> – this list changes when a course has been selected.</li>
<li lang="en-GB"><strong class="bold" lang="">Actions</strong>: You can choose among <strong class="bold" lang="">All actions</strong>, <strong class="bold" lang="">Create</strong>, <strong class="bold" lang="">View</strong>, <strong class="bold" lang="">Update</strong>, <strong class="bold" lang="">Delete</strong>, and <strong class="bold" lang="">All changes</strong>.</li>
<li lang="en-GB"><strong class="bold" lang="">Educational levels</strong>: You can choose from <strong class="bold" lang="">All events</strong>, <strong class="bold" lang="">Teaching</strong>, <strong class="bold" lang="">Participating</strong>, and <strong class="bold" lang="">Other</strong>. We came across the latter three options when looking at events.</li>
<li lang="en-GB"><strong class="bold" lang="">Log store</strong>: If more than one log store has been set up, you must select the one from which the data is being read.</li>
</ul>
<p lang="en-GB">Once you have selected a course and clicked on the <strong class="bold" lang="">Get these logs</strong> button, the content in each dropdown menu changes context-sensitively. For example, the <strong class="bold" lang="">Participants</strong> menu contains all the names of users who have a role in the course, and the <strong class="bold" lang="">Activities</strong> menu is populated with activities and resources. If you watch Moodle’s submenu, you will see <a id="_idIndexMarker1243"/>what happens internally. Moodle temporarily redirects the reporting tool inside the selected course where the course log viewer is called, which is identical in appearance. Once you have selected your filtering criteria, a report is displayed, as follows:</p>
<div>
<div class="IMG---Figure" id="_idContainer345">
<img alt="Figure 12.20 – Log data " height="442" src="image/Figure_12.20_B18779.jpg" width="1402"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.20 – Log data</p>
<p lang="en-GB">This tabular information is displayed in the reverse order of a user’s access date and time; that is, the last hit is displayed first. The columns of the table represent the following information:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Time</strong>: Date and time of the hit.</li>
<li lang="en-GB"><strong class="bold" lang="">User full name</strong>: Name of the user – if a particular user is selected, the same value will be displayed in each row.</li>
<li lang="en-GB"><strong class="bold" lang="">Affected user</strong>: This will display if the action impacts another user.</li>
<li lang="en-GB"><strong class="bold" lang="">Event context</strong>: The context in which the event has been triggered. A link directs you to the context, for instance, a course.</li>
<li lang="en-GB"><strong class="bold" lang="">Component</strong>: The event component (refer to the <em class="italic" lang="">Events</em> section earlier in this chapter).</li>
<li lang="en-GB"><strong class="bold" lang="">Event name</strong>: The event that has been triggered. When selected, a pop-up window containing the event will open.</li>
<li lang="en-GB"><strong class="bold" lang="">Description</strong>: A short description of what the user has been doing – this is very useful for seeing what resources are being accessed or checking whether an individual has viewed a course. Internal IDs are used, such as user ID, course ID, or forum ID.</li>
<li lang="en-GB"><strong class="bold" lang="">Origin</strong>: Indicates whether the hit came from a CLI script (<strong class="source-inline" lang="">cli</strong>), a restore operation (<strong class="source-inline" lang="">restore</strong>), Moodle itself (<strong class="source-inline" lang="">web</strong>), a web service (<strong class="source-inline" lang="">ws</strong>), or any other origin (<strong class="source-inline" lang="">other</strong>).</li>
<li lang="en-GB"><strong class="bold" lang="">IP address</strong>: The (unresolved) IP address; this is useful for identifying where the user accessed the page (for example, from home or within the organization).</li>
</ul>
<p lang="en-GB">At the <a id="_idIndexMarker1244"/>bottom of the results page, you can download table data in several formats (CSV, XLSX, HTML, JSON, ODS, or PDF). You can reduce or rearrange the options in that list by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Data formats</strong> | <strong class="bold" lang="">Manage data formats</strong>.</p>
<p lang="en-GB">When you click on the IP address in the log, a new page will open that displays the registered location of the user’s IP as a pin on the world map (this is not the case for local or private IP addresses), as shown in the following figure:</p>
<div>
<div class="IMG---Figure" id="_idContainer346">
<img alt="Figure 12.21 – Geographical location of an IP address " height="620" src="image/Figure_12.21_B18779.jpg" width="1240"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.21 – Geographical location of an IP address</p>
<p lang="en-GB">The default<a id="_idIndexMarker1245"/> lookup tool that’s used is called <strong class="bold" lang="">NetGeo</strong> (www.geoplugin.com). For <a id="_idIndexMarker1246"/>more accurate results, you will need to install a local copy of<a id="_idIndexMarker1247"/> the <strong class="bold" lang="">MaxMind GeoLite</strong> database (<a href="http://dev.maxmind.com">dev.maxmind.com</a>) or specify a Google Maps API key. Both settings can be found in the IP address lookup section at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Location</strong> | <strong class="bold" lang="">Location settings</strong>.</p>
<p lang="en-GB">Moodle provides <strong class="bold" lang="">live logs</strong> of <a id="_idIndexMarker1248"/>activities in the last hour, which can be accessed by navigating to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Live logs</strong>. It is a prepared report that shows activities that took place in the previous 60 minutes; it is updated automatically every 60 seconds. You can <strong class="bold" lang="">Pause live updates</strong> via the button beside the log reader selector. Live logs are helpful if you have changed the configuration, for instance, an authentication or enrolment plugin, and want to ensure that it is working correctly. Alternatively, you can just sit back and watch what is happening on your site. The format of the screen is identical to the preceding standard log. Note that the first entry in the live log is you looking at the live log!</p>
<p lang="en-GB">When selecting <strong class="bold" lang="">site errors</strong> from <a id="_idIndexMarker1249"/>the activities dropdown menu, all the errors (mainly failed logins) are displayed. For example, the report that is shown in the following screenshot displays two invalid logins, as well as two failed attempts to send an email to users:</p>
<div>
<div class="IMG---Figure" id="_idContainer347">
<img alt="Figure 12.22 – Error log " height="278" src="image/Figure_12.22_B18779.jpg" width="1411"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.22 – Error log</p>
<p lang="en-GB">It is a good practice to check <a id="_idIndexMarker1250"/>the error logs regularly to identify problems on your site and potential unauthorized access attempts. These reports can also be set up to be sent by email to the site administrator (refer to <a href="B18779_13.xhtml#_idTextAnchor251"><em class="italic" lang="">Chapter 13</em></a>, <em class="italic" lang="">Ensuring Moodle Security</em>).</p>
<p lang="en-GB">You should now be equipped to interact with Moodle logs fully. Statistics has been mentioned a few times in this section; we’ll look at what statistical analysis Moodle supports and how we can benefit from it in the next section.</p>
<h1 id="_idParaDest-246" lang="en-GB"><a id="_idTextAnchor246"/>Gathering statistics</h1>
<p lang="en-GB">This <a id="_idIndexMarker1251"/>section will teach you how to set up and interpret <strong class="bold" lang="">Moodle statistics</strong>.</p>
<p lang="en-GB">Moodle has a built-in Statistics module, which is deactivated by default because the component is very resource-hungry in terms of disk space usage and, more importantly, memory usage.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Only use the Statistics module if you require the information and can accept some potentially significant performance reduction.</p>
<p lang="en-GB">Select <strong class="bold" lang="">Enable statistics</strong> under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Advanced features</strong> and configure it by navigating to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Statistics</strong>, where the following parameters are available:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Maximum processing interval</strong>: After enabling the Statistics module, Moodle utilizes the logs to derive statistical information. Here, you need to specify the time that Moodle should go back by to gather the stats. Be aware that this is quite a resource-intensive operation.</li>
<li lang="en-GB"><strong class="bold" lang="">Maximum runtime</strong>: You can limit the time the statistics gathering process is allowed to run; this is another mechanism that helps you avoid putting too much burden on the system.</li>
<li lang="en-GB"><strong class="bold" lang="">Days to process</strong>: The number of days that will be processed in each statistics execution.</li>
<li lang="en-GB"><strong class="bold" lang="">User threshold</strong>: Here, the Statistics module can be instructed to ignore courses with less than a certain number of enrolled users.</li>
</ul>
<p lang="en-GB">Statistics <a id="_idIndexMarker1252"/>calculations take place in the background via the <strong class="source-inline" lang="">\core\task\stats_cron_task</strong> scheduled task. It is highly recommended that its execution time does not clash with the site backup as both operations are potentially very resource-intensive.</p>
<p lang="en-GB">Let’s look at some statistics by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Statistics</strong>. Once you have selected <strong class="bold" lang="">Course</strong>, <strong class="bold" lang="">Report type</strong> (views, posts, logins, or all of these), and <strong class="bold" lang="">Time period</strong>, a graph and some tabular information will be displayed. The data that’s shown represents the number of <em class="italic" lang="">hits</em> on a particular day, broken down by roles:</p>
<div>
<div class="IMG---Figure" id="_idContainer348">
<img alt="Figure 12.23 – Statistics report " height="1326" src="image/Figure_12.23_B18779.jpg" width="1650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.23 – Statistics report</p>
<p lang="en-GB">If no data is<a id="_idIndexMarker1253"/> displayed, you might have to readjust the settings of your statistics. Also, while statistics gathering is in progress, a message might be displayed stating that the module is in catch-up mode. If this is the case, you must wait until the processing has been completed.</p>
<p lang="en-GB">A report that shows some basic statistics on courses over a period of interest that make use of the statistics data is located at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Course overview</strong>. The options are as follows (you can find the report measure calculations at <a href="http://docs.moodle.org/en/Course_overview_report">docs.moodle.org/en/Course_overview_report</a>):</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Most active courses</strong></li>
<li lang="en-GB"><strong class="bold" lang="">Most active courses (weighted)</strong></li>
<li lang="en-GB"><strong class="bold" lang="">Most participatory courses (enrolments)</strong></li>
<li lang="en-GB"><strong class="bold" lang="">Most participatory courses (views/posts)</strong></li>
</ul>
<p lang="en-GB">Each report shows a table, and a graph visualizes the course data.</p>
<p lang="en-GB">I don’t know <a id="_idIndexMarker1254"/>about you, but the information provided by these two Statistics reports is highly unsatisfactory. Given the module’s burden on our system and the amount of available data, this seems like a very simplistic – some would say useless – way to display statistics.</p>
<p lang="en-GB">An extension to the <a id="_idIndexMarker1255"/>Statistics module is a plugin called <strong class="bold" lang="">Overview Statistics</strong> (<a href="http://moodle.org/plugins/report_overviewstats">moodle.org/plugins/report_overviewstats</a>), which provides you with more analyses on users who are logging in, user countries, preferred languages, and some course stats. While this is an improvement over the Statistics facility, it is still far from ideal.</p>
<p lang="en-GB">If the described statistics facilities do not satisfy your hunger for usage data, you might consider using tools such <a id="_idIndexMarker1256"/>as <strong class="bold" lang="">Matamo</strong>, <strong class="bold" lang="">Piwik</strong> (both privacy-focused and open source), and <strong class="bold" lang="">Google Analytics</strong>. These <a id="_idIndexMarker1257"/>web log analyzers are feature-rich services that<a id="_idIndexMarker1258"/> track any traffic to your Moodle site and offer an abundance of statistics on visitors, traffic sources, content, user-defined goals, and much more.</p>
<p lang="en-GB">You have two options for adding web traffic analysis<a id="_idIndexMarker1259"/> support to your Moodle system:</p>
<ul>
<li lang="en-GB">A <a id="_idIndexMarker1260"/>dedicated plugin that supports any or all of the tools mentioned previously, for example, <strong class="bold" lang="">Web Analytics</strong> (<a href="http://moodle.org/plugins/tool_webanalytics">moodle.org/plugins/tool_webanalytics</a>).</li>
<li lang="en-GB">A theme that supports web log analyzers. The two most popular third-party themes, which were mentioned in <a href="B18779_07.xhtml#_idTextAnchor140"><em class="italic" lang="">Chapter 7</em></a>, <em class="italic" lang="">Enhancing Moodle’s Look and Feel</em>, provide different levels of integration: while <strong class="bold" lang="">Moove</strong> only <a id="_idIndexMarker1261"/>supports your Google Analytics V4 code, <strong class="bold" lang="">Adaptable</strong> has a<a id="_idIndexMarker1262"/> dedicated <strong class="bold" lang="">Analytics</strong> tab where you can customize your Google Analytics, Matamo, and Piwik settings, respectively.</li>
</ul>
<p lang="en-GB">Piwik, Matomo, and Google Analytics run sophisticated statistics against historical browsing data. Moodle Analytics, on the other hand, applies machine learning techniques and models to make predictions of future outcomes, which is the topic of the final section of this chapter.</p>
<h1 id="_idParaDest-247" lang="en-GB"><a id="_idTextAnchor247"/>Making predictions with Moodle Analytics</h1>
<p lang="en-GB">In this section, you will <a id="_idIndexMarker1263"/>learn about <strong class="bold" lang="">Moodle Analytics</strong>, including how to create learning analytics models.</p>
<p lang="en-GB">Custom and log-based reports are descriptive; they tell viewers what happened but not why, and don’t predict outcomes or advise users on how to improve. While reporting tells us about <em class="italic" lang="">who</em>, <em class="italic" lang="">what</em>, <em class="italic" lang="">when</em>, and <em class="italic" lang="">where</em>, learning analytics aims to explain <em class="italic" lang="">why</em> and <em class="italic" lang="">how well</em>.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Moodle Analytics predicts or detects unknown aspects of learning based on (historical) log data and current behavior.</p>
<p lang="en-GB">There are two types of models that Moodle Analytics supports:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Machine learning-based models</strong>: Sophisticated models use mathematical tools to make predictions; for <a id="_idIndexMarker1264"/>instance, students with a high likelihood of failing a course</li>
<li lang="en-GB"><strong class="bold" lang="">Static models</strong>: Simple models are <a id="_idIndexMarker1265"/>based on assumptions and do not require sophisticated analyses; for example, students who have not enrolled in a course</li>
</ul>
<p lang="en-GB">The following diagram illustrates the key components of the Moodle Analytics workflow (adapted from <a href="http://docs.moodle.org/dev/Analytics_API">docs.moodle.org/dev/Analytics_API</a>):</p>
<div>
<div class="IMG---Figure" id="_idContainer349">
<img alt="Figure 12.24 – Moodle Analytics components and workflow " height="705" src="image/Figure_12.24_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.24 – Moodle Analytics components and workflow</p>
<p lang="en-GB">Let’s circle <a id="_idIndexMarker1266"/>through the <a id="_idIndexMarker1267"/>workflow, starting from the top left:</p>
<ol>
<li lang="en-GB"><strong class="bold" lang="">Log</strong> is the selected log file we covered earlier. A <strong class="bold" lang="">Subset</strong> of the log will be created based on the analytics model and the selected analysis interval.</li>
<li lang="en-GB"><strong class="bold" lang="">Indicators</strong>, also known as predictors or features, are what you think will lead to an accurate target prediction. An indicator might be forum participation or teacher availability. <strong class="bold" lang="">Targets</strong>, also known as classes, represent the event the model is attempting to predict. A popular target is “students at risk of dropping out.”</li>
<li lang="en-GB">The filtering and augmentation outcome from the first three steps results in <strong class="bold" lang="">Model Data</strong>, which is used for the prediction model at hand.</li>
<li lang="en-GB">The <strong class="bold" lang="">Model</strong> itself is created using <strong class="bold" lang="">machine learning</strong> (<strong class="bold" lang="">ML</strong>) algorithms that carry out all the heavy computation behind the scenes. We can treat this element as a black box and rely on the of the machine learning backend working correctly.</li>
<li lang="en-GB"><strong class="bold" lang="">Predictions</strong> are patterns found in data – the bigger and more diverse the model data, the more accurate the predictions. A prediction might be in the form of a rule such as “if forum participation is low and teacher availability is low, then students at risk of dropping out is high.”</li>
<li lang="en-GB"><strong class="bold" lang="">Insights</strong> are <a id="_idIndexMarker1268"/>generated by predictions when certain thresholds are met (a particular student is at risk of dropping out). Based on the insights, <strong class="bold" lang="">Actions</strong> should <a id="_idIndexMarker1269"/>then be taken.</li>
</ol>
<p lang="en-GB">One of the most popular machine learning techniques is <strong class="bold" lang="">classification</strong>. The objective of classification is to predict a target by building a model based on a training dataset and then utilizing that model to predict the target<a id="_idIndexMarker1270"/> in the test data. In our learning analytics context, a typical target is a prediction of whether students will pass or fail, or whether they are likely to drop out.</p>
<p lang="en-GB">This type of learning is known as supervised learning<a id="_idIndexMarker1271"/> because the learning process is guided toward the targets while building the model. Staying with the pass-fail scenario, the modeler (you!) would decide which data should be considered as indicators; for instance, course progress, grades, and participation levels.</p>
<p lang="en-GB">Some typical classification applications include loan approval, churn prediction, medical diagnoses, and spam detection. Learning analytics usually deals with classification problems with one target (for example, pass or fail) to be predicted. Moodle Analytics currently only supports this type of binary classification.</p>
<p lang="en-GB">We have only touched upon the very basics of the inner workings of Moodle Analytics. If you wish to dive deeper into this fascinating topic, some excellent resources are available online, such as docs.moodle.org/en/Using_analytics and docs.moodle.org/dev/Analytics_API.</p>
<p lang="en-GB">OK, enough of all the abstract machine learning and learning analytics theory. However, before we can create our first Moodle analytics model, some initial configuration is required, which we are going to cover first.</p>
<h2 id="_idParaDest-248" lang="en-GB"><a id="_idTextAnchor248"/>Setting up Moodle Analytics</h2>
<p lang="en-GB">First, ensure <a id="_idIndexMarker1272"/>that the <strong class="bold" lang="">Analytics</strong> option under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Advanced features</strong> is turned on. Setting up Moodle Analytics requires configuring two types of settings: educational domain knowledge and some technical parameters.</p>
<p lang="en-GB">Under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Analytics</strong> | <strong class="bold" lang="">Site information</strong>, you should provide information about how most educators and learners use your Moodle site. This educational <a id="_idIndexMarker1273"/>domain knowledge can be taken into account by machine learning algorithms. The self-explanatory fields to be configured are shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer350">
<img alt="Figure 12.25 – Analytics site information " height="989" src="image/Figure_12.25_B18779.jpg" width="1394"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.25 – Analytics site information</p>
<p lang="en-GB">You can find the technical configuration by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Analytics</strong> | <strong class="bold" lang="">Analytics settings</strong>, where the parameters have been explained in detail:</p>
<div>
<div class="IMG---Figure" id="_idContainer351">
<img alt="Figure 12.26 – Analytics settings " height="1189" src="image/Figure_12.26_B18779.jpg" width="1393"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.26 – Analytics settings</p>
<p lang="en-GB">Most of these <a id="_idIndexMarker1274"/>settings can easily be mapped onto the Moodle Analytics workflow presented earlier. Two scheduled tasks <strong class="source-inline" lang="">(\tool_analytics\task\train_models</strong> and <strong class="source-inline" lang="">\tool_analytics\task\predict_models</strong>) iterate through enabled models to train models and generate predictions, respectively. While you can allow these processes to be executed manually by disabling the <strong class="bold" lang="">Analytics processes execution via command line only</strong> setting, this <a id="_idIndexMarker1275"/>is only recommended for testing purposes and not in production environments.</p>
<p lang="en-GB">Once the domain and technical setup has been completed, we can create analytics models.</p>
<h2 id="_idParaDest-249" lang="en-GB"><a id="_idTextAnchor249"/>Creating analytics models</h2>
<p lang="en-GB">Analytics <a id="_idIndexMarker1276"/>models are managed under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Analytics</strong> | <strong class="bold" lang="">Analytics models</strong>, as shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer352">
<img alt="Figure 12.27 – Analytics models " height="667" src="image/Figure_12.27_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.27 – Analytics models</p>
<p lang="en-GB">For each model, the three relevant fields are <strong class="bold" lang="">Indicators</strong>, <strong class="bold" lang="">Analysis interval</strong>, and <strong class="bold" lang="">Insights</strong>:</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Indicators</strong>: There <a id="_idIndexMarker1277"/>are nearly 60 predefined indicators available, based on an empirical model of student engagement among many Moodle instances and some Moodle Partner sites. These indicators are divided into two types: cognitive depth and social breadth. You can find more details on Moodle Analytics indicators at <a href="http://docs.moodle.org/en/Learning_analytics_indicators">docs.moodle.org/en/Learning_analytics_indicators</a>.</li>
<li lang="en-GB"><strong class="bold" lang="">Analysis interval</strong>: This <a id="_idIndexMarker1278"/>time-splitting method defines when Moodle will calculate predictions and the portion of logs that will be considered for those predictions.</li>
<li lang="en-GB"><strong class="bold" lang="">Insights</strong>: These are the “interesting” prediction outcomes. The selection depends on the<a id="_idIndexMarker1279"/> model type, for instance, users who are at risk of dropping out. These insights also trigger events, for example, notifications to course teachers or messages to students. Here is an <strong class="bold" lang="">Insights</strong> sample provided to course teachers, where they can also provide feedback, which will then be taken into account <a id="_idIndexMarker1280"/>during the subsequent analysis:</li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer353">
<img alt="Figure 12.28 – Insights example " height="776" src="image/Figure_12.28_B18779.jpg" width="1393"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.28 – Insights example</p>
<p lang="en-GB">To adjust the settings of a model, select the standard <strong class="bold" lang="">Edit</strong> option in the <strong class="bold" lang="">Action</strong> menu. Here is an example of the <strong class="bold" lang="">Students at risk of dropping out</strong> model:</p>
<div>
<div class="IMG---Figure" id="_idContainer354">
<img alt="Figure 12.29 – Analytics model details " height="830" src="image/Figure_12.29_B18779.jpg" width="1393"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.29 – Analytics model details</p>
<p lang="en-GB">You can modify<a id="_idIndexMarker1281"/> the list of <strong class="bold" lang="">Indicators</strong> and <strong class="bold" lang="">Analysis interval</strong>. Additionally, you can restrict the model-building to <strong class="bold" lang="">Contexts</strong> – that is, selected course categories and courses.</p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">When a model is modified, all previous predictions will be deleted.</p>
<p lang="en-GB">You must configure the same parameters when creating a new model after selecting the target. The following targets (what the model will predict) are available in Moodle:</p>
<ul>
<li lang="en-GB">Students at risk of not achieving the competencies assigned to a course (ML)</li>
<li lang="en-GB">Students at risk of not meeting the course completion conditions (ML)</li>
<li lang="en-GB">Students at risk of dropping out (ML)</li>
<li lang="en-GB">Students at risk of not achieving the minimum grades to pass the course (ML)</li>
<li lang="en-GB">Courses at risk of not starting (static)</li>
<li lang="en-GB">Students who have not accessed the course recently (static)</li>
<li lang="en-GB">Students who have not accessed the course yet (static)</li>
<li lang="en-GB">Upcoming activities due (static)</li>
</ul>
<p lang="en-GB">At the beginning of this section, we mentioned that Moodle Analytics supports machine learning-based and static models. In static models, the indicators are fixed; you cannot modify these as you can in machine learning-based models.</p>
<p lang="en-GB">There are several other analytics-specific commands in the <strong class="bold" lang="">Actions</strong> menu (some of those options only appear if the <strong class="bold" lang="">Analytics processes execution via command line only</strong> setting under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Analytics</strong> | <strong class="bold" lang="">Analytics settings</strong> is disabled):</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Execute scheduled analysis</strong>: Train machine learning algorithms with the new data available on the system and get predictions for ongoing courses</li>
<li lang="en-GB"><strong class="bold" lang="">Insights report</strong>: Depending on the model, report insights will be shown about what insights have been found and information about the individual targets</li>
<li lang="en-GB"><strong class="bold" lang="">Export</strong>: Moodle Analytics models can be exported in JSON format and imported via the <strong class="bold" lang="">Import model</strong> option upon selecting the <strong class="bold" lang="">New model</strong> button</li>
<li lang="en-GB"><strong class="bold" lang="">Invalid site elements</strong>: A list of the elements that cannot be analyzed by this model</li>
<li lang="en-GB"><strong class="bold" lang="">Clear predictions</strong>: Clears all<a id="_idIndexMarker1282"/> the model predictions and training data</li>
</ul>
<p lang="en-GB">Moodle Analytics<a id="_idIndexMarker1283"/> is one of the most powerful tools in Moodle but also one of the least utilized. Whether it is due to its complexity or lack of trust in machine learning algorithms, I don’t know. Hopefully, we have shed some light on this topic and have equipped you with the skills to offer Moodle Analytics to your learners and educators.</p>
<h1 id="_idParaDest-250" lang="en-GB"><a id="_idTextAnchor250"/>Summary</h1>
<p lang="en-GB">Moodle offers a wide range of reporting facilities for teachers and administrators. In this chapter, we focused on reporting tools admins interact with or have to configure and provide to users. Even if you are not a data nerd, I hope the reporting facilities presented are helpful in your day-to-day administrative work.</p>
<p lang="en-GB">The newly introduced report generator is a versatile tool for creating flexible and interactive custom reports. You got to know the report generator, including data sources, report building, audiences, and schedules. The more report sources that are made available in the future, the less likely you will need third-party tools, such as Configurable reports, which we briefly dealt with.</p>
<p lang="en-GB">In the second part of this chapter, you learned everything about Moodle’s logging framework in terms of its components, events, and log stores. You also interacted with Moodle logs, one of the most often used tools in the administrator’s day-to-day job.</p>
<p lang="en-GB">The logging framework provides the foundation for statistics and learning analytics, which we covered in dedicated sections.</p>
<p lang="en-GB">Moodle reporting, particularly the newly introduced report generator, has recently undergone a significant makeover. Expect more features to be introduced shortly. Another constantly improved topic is Moodle’s security, which is the next chapter’s topic.</p>
</div>
<div>
<div id="_idContainer356">
</div>
</div>
</div></body></html>