<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Advanced Features and Modifications"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Advanced Features and Modifications</h1></div></div></div><p>We are going to start out by looking at a grab-bag of modules that showcase some of the more advanced or interesting features in Drupal in order to give you the opportunity to add that<span class="emphasis"><em> special something</em></span> to your site. Whether it is new type of content, an advertising policy to generate revenue from traffic, or even a way of providing nice, dynamic content, you should find something to add value to your site in here.</p><p>Remember though, that if what is required is not available in the default distribution or in any of the modules, you are not totally out of luck. The chances are someone else in the community has had to do something similar before, and you should get a few helpful responses on the forums explaining at least some of what you need. If at some point you do manage to create something utterly fantastic, please give back to the community by sharing your work with others.</p><p>With that said, it is often important to be able to make your own additions to a site in order to get it just right. Accordingly, we will look at some interesting embellishments using code that is freely available on the Internet. Incorporating JavaScript and other small, working units of code (commonly known as widgets) is the perfect way to enhance your site without having to learn everything about programming first.</p><p>So, as far as new modules go, we will take a look at the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Flexinode</li><li class="listitem" style="list-style-type: disc">AdSense</li></ul></div><p>The first module deals specifically with content, whereas the other one enables you to integrate your website with another online business, namely Google—hopefully to earn a bit of cash. By the end of this chapter, you will be an ace at using slightly more complex contributions.</p><p>We will also talk about some more advanced modifications to the interface. It's always fun to be able to do something out of the ordinary with your site, and working with your theme files, using HTML, PHP, and CSS, is great training for the Web in general and not just Drupal. The<span class="emphasis"><em> Advanced Site Modifications</em></span> section here will hopefully give you some ideas for your own site as well as give you an idea of what's involved in implementing them.</p><p>One final thing to remember before we begin is that you<span class="emphasis"><em> must, must, must</em></span> make backups of the whole site, including the database, from time to time (preferably each time you successfully add a new feature). Further, you should also back up each of the pages you are working on before you begin working with them. The topic of making backups is discussed in the<span class="emphasis"><em> Running your Website</em></span> chapter, which follows this one—I mention this just in case you feel it is time to make a backup of what you have now before you begin fiddling around.</p><div class="section" title="Flexinode"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec01"/>Flexinode</h1></div></div></div><p>At some point along the way you might find that none of the current content types really fit the type of content you want to be able to deliver. If this is the case, then the<span class="strong"><strong> Flexinode</strong></span> contribution might be just what you are looking for. As the module's description says:</p><div class="blockquote"><blockquote class="blockquote"><p>Flexinode is a module that allows non-programmers to create new node types (flexible content types) in Drupal when their needs are modest. Users can define the fields in the node edit form for their content type, and can either view the nodes as presented by the module or modify the presentation in their theme.<a class="indexterm" id="id331"/>
</p></blockquote></div><p>In the case of the demo site, let's assume that we would like to build up a reservoir of vital statistics pages for endangered animals. In this case, we could go to the trouble of building a rough HTML template and use the page content type, inserting the relevant data into the various cells in our table. However, this would be a pain because if a variety of people were posting this type of information, then each of them would have to learn how to use this HTML template. Let's take a look how the Flexinode contribution can help out here.</p><div class="section" title="Downloading and Installing Flexinode"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec01"/>Downloading and Installing Flexinode</h2></div></div></div><p>This process should be quite familiar to you now; so we won't spend much time looking at it too closely.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note36"/>Note</h3><p>Flexinode at the time of writing is still being upgraded for version 4.7 compatibility—be careful and ensure that you obtain a suitable, stable version if you intend to use it on your live site.</p></div></div><p>Simply go to the Drupal website and download the correct version of the Flexinode module. Extract the files to the<code class="literal"> modules</code> directory in your Drupal installation and then execute the<code class="literal"> .mysql</code> script using something like the following command (remember to modify the file path to suit your individual system):<a class="indexterm" id="id332"/>
</p><div class="informalexample"><pre class="programlisting">$ mysql udrupal p drupal &lt; C:\apache2triad\htdocs\drupal\modules\flexinode\flexinode.mysql
</pre></div><p>You will be prompted for a password and you can ensure that the relevant tables have been added by logging into the<code class="literal"> mysql</code> command-line client and looking for the new Flexinode tables as shown in the following screenshot:<a class="indexterm" id="id333"/>
</p><div class="mediaobject"><img alt="Downloading and Installing Flexinode" src="graphics/1800_09_01.jpg"/></div><p>Notice that there are now three<code class="literal"> flexinode_</code> tables present in the<code class="literal"> drupal</code> database. If you are not keen on using the command line, remember that you can use the visual interface provided by phpMyAdmin.</p><p>Funnily enough, this contribution comes with a bunch of contributions! What I mean is that there is extra functionality associated with Flexinode that is not enabled by default. Take a look at the extracted folder,<code class="literal"> flexinode</code>, on your file system (under the<code class="literal"> modules</code> directory). You will notice that there is a<code class="literal"> contrib</code> folder present, and it contains a whole bunch of<code class="literal"> .inc</code> files.</p><p>Each of these<code class="literal"> .inc</code> files is responsible for providing the functionality associated with its namesake. For example,<code class="literal"> field_textarea.inc</code> provides the code needed to include text areas into your content type, and so on. You'll also notice that there are a bunch of readme files available to help clarify what the corresponding<code class="literal"> .inc</code> file does. For example, the<code class="literal"> README.colorpicker.txt</code> file has this to say:<a class="indexterm" id="id334"/>
</p><div class="blockquote"><blockquote class="blockquote"><p>I am hoping that this will be useful in granting users control over the styles of their sites. I can imagine a flexinode with several color pickers, select boxes and check boxes that could be used to override the default styles of a theme for that particular user.</p></blockquote></div><p>Ensure that you read the readme file for each and every<code class="literal"> .inc</code> file you intend to enable, as you might be required to move files or even install other modules first. When you are ready, head on over to the<span class="strong"><strong> modules</strong></span> section under<span class="strong"><strong> administer</strong></span> in your browser and enable the Flexinode module before clicking<span class="strong"><strong> Save configuration.</strong></span>
<a class="indexterm" id="id335"/>
</p></div><div class="section" title="Creating a Custom Content Type"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec02"/>Creating a Custom Content Type</h2></div></div></div><p>Under the<span class="strong"><strong> administer</strong></span> section, navigate to<span class="strong"><strong> content</strong></span> and you will notice that there are a couple of extra content-related tabs shown on this page that allow us to specify and work with our new content types. Clicking on the<span class="strong"><strong> add content type</strong></span> tab will bring up a page like this:<a class="indexterm" id="id336"/>
</p><div class="mediaobject"><img alt="Creating a Custom Content Type" src="graphics/1800_09_02.jpg"/></div><p>Once that is<span class="strong"><strong> Submitted</strong></span>, you will be taken to the<span class="strong"><strong> content types</strong></span> page automatically, where you can now begin working with the newly created type as shown here:<a class="indexterm" id="id337"/>
</p><div class="mediaobject"><img alt="Creating a Custom Content Type" src="graphics/1800_09_03.jpg"/></div><p>From this point you can click on either of the two links presented at the top right of the content type's section (in this case, the section is entitled<span class="strong"><strong> Animal Stats)</strong></span>. The first link,<span class="strong"><strong> edit content type</strong></span>, allows you to change any of the information you supplied when you created the content type—for example, you might wish to modify the name, description, or help text. The second option allows you to add some<span class="strong"><strong> submission guidelines</strong></span> and configure the standard<span class="strong"><strong> Workflow</strong></span> options as shown here:<a class="indexterm" id="id338"/>
</p><div class="mediaobject"><img alt="Creating a Custom Content Type" src="graphics/1800_09_04.jpg"/></div><p>These standard options have already been discussed in earlier chapters at some length and you really need to make your decisions based on how you intend this content type to be used. For our purposes, file attachments have been enabled (even though this is not visible in the screenshot) to allow evidence for any assertions made to be supplied with the post. Comments are also allowed in order for people to be able to collaboratively ensure that facts are correct and up to date.<a class="indexterm" id="id339"/>
</p><p>With those two options out of the way, the really interesting and powerful part of the Flexinode module comes into play. The<span class="strong"><strong> Field list</strong></span> provides us with the option to specify a number of different types of input, which are then bundled into the overall content type. Now, this can be slightly confusing to begin with because you need to keep in mind that you are specifying<span class="emphasis"><em> what is needed</em></span> in order to make content, and not the<span class="emphasis"><em> actual content</em></span> itself.<a class="indexterm" id="id340"/>
</p><p>So, before you begin adding different fields all over the show, think carefully about what you want your special content type to do and how it should look. Once you have a clear idea of what it is you are creating, it will be a lot easier to go ahead and build it.<a class="indexterm" id="id341"/>
</p></div><div class="section" title="Adding Structure"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec03"/>Adding Structure</h2></div></div></div><p>Our<span class="emphasis"><em> Animal Stats</em></span> pages should be informative and interesting, providing interested parties with a comprehensive and coherent body of knowledge that serves to fix an image of the animal, its profile, and its plight in the reader's mind. If one thinks about the types of elements that a page like this would need, something like the following would probably be suitable:<a class="indexterm" id="id342"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A paragraph or two introducing the animal</li><li class="listitem" style="list-style-type: disc">A picture of the animal</li><li class="listitem" style="list-style-type: disc">A summary of its current status</li><li class="listitem" style="list-style-type: disc">A map of its habitat</li><li class="listitem" style="list-style-type: disc">Contact information and/or links to more resources</li></ul></div><p>With this in mind, we can turn to the field picker and see what it has to offer. Since the first thing we would like to show on the page is a paragraph, it makes sense to look for a text area to add to the top of the page. Selecting this option in the drop-down list shown on the<span class="strong"><strong> content types</strong></span> page brings up the following form:</p><div class="mediaobject"><img alt="Adding Structure" src="graphics/1800_09_05.jpg"/></div><p>Here the text area is set as a<span class="strong"><strong> Required field</strong></span> because any user who wants to add an<span class="strong"><strong> Animal Stats</strong></span> page must have a bit to say about the animal in the first place—a reasonable assumption! Making this a required field has the advantage that it is now a good idea to select<span class="strong"><strong> Show in teaser</strong></span> (because we know that there will always be a bit of introductory text). This means that whenever anyone happens to browse through the<span class="strong"><strong> Animal Stats</strong></span> pages, they can read the introductory paragraph in the teaser.<a class="indexterm" id="id343"/>
</p><p>Next, a weight of<span class="strong"><strong> 9</strong></span> is assigned to this field because we know that in all likelihood this field will always be displayed at the very top of the page. In the same way, you can simply pick and choose the rest of the fields according to how the page is to be formatted. Each field comes with its own set of considerations that you will need to set depending on how the content page is to be used. As always, it is easy to come back and modify things if they aren't working just right.</p><p>Once all the fields have been correctly chosen and set into the correct part of the page, content producers can then use the page as they would any other node. That's it! All that's left to do is to ensure that the content works as it is supposed to and that it fulfils its intended role correctly. Since we have already discussed how to use other content types, we will go no further here.</p></div></div></div>
<div class="section" title="AdSense"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec02"/>AdSense</h1></div></div></div><p>Once you have your site up and running, with hopefully a fair amount of people visiting, it may be a good option to try earning a bit of extra revenue from advertising. Google provides the<span class="strong"><strong> AdSense</strong></span> advertising scheme, which allows you to add customizable blocks of advertisements by simply cutting and pasting their code snippets into your pages. All that you need to do is to decide on the dimensions and colors that will best blend in with your site, and the rest is taken care of by Google.<a class="indexterm" id="id344"/>
</p><p>Doing things this way, while certainly easy, might not be able to give you the control you want over your ads so Drupal provides an<span class="strong"><strong> AdSense</strong></span> module to help out. This section will take a look at how the AdSense module works since it gives more control of what types of ads are displayed and when.</p><p>Before we begin, though, it is important that you register with Google in order to obtain an account and ID, which will be used in order to track the traffic that your site sends through the adverts. You can go directly to the AdSense site at:<a class="ulink" href="https://www.google.com/adsense/">  https://www.google.com/adsense/ </a> . Simply click on the prominently displayed<span class="strong"><strong> Click Here to Apply</strong></span> button and follow the instructions. Alternatively, you can support the developer of the AdSense module by registering through their referral link displayed at this page:<a class="ulink" href="http://baheyeldin.com/click/476/0"> http://baheyeldin.com/click/476/0</a>.<a class="indexterm" id="id345"/>
</p><div class="section" title="Installing and Configuring AdSense"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec04"/>Installing and Configuring AdSense</h2></div></div></div><p>The AdSense module installation is about as simple as they come and you won't need to modify your database or anything else for that matter, apart from copying the downloaded files into your<code class="literal"> modules</code> folder. Once that is done, you can enable the module in the<span class="strong"><strong> modules</strong></span> section under the<span class="strong"><strong> administer</strong></span> link.<a class="indexterm" id="id346"/>
</p><p>Once you have saved the new module's configuration, head over to<span class="strong"><strong> settings</strong></span> and look for the new<span class="strong"><strong> adsense</strong></span> link underneath the<span class="strong"><strong> settings</strong></span> link:</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_06.jpg"/></div><p>Clicking on this brings up the new<span class="strong"><strong> adsense</strong></span> configuration page, which also presents a link to tons of information on how to configure everything at<code class="literal"> admin/help/adsense</code>. You must read through the notes associated with each option as they provide useful information on what ad types are available, their dimensions, as well as how the module actually works to display the ads.<a class="indexterm" id="id347"/>
</p><p>We can go ahead and configure our ads now, but bear in mind that we will still need to manually add them to the site once this is done (discussed in the following section). The actual settings start off with the following:</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_07.jpg"/></div><p>Once you have obtained your client ID you can simply enter it here, and any traffic that goes through the ads on your site will generate revenue for the owner of the supplied ID (in other words, you). The next section allows you to decide which pages should be able to show ads, and which should not:<a class="indexterm" id="id348"/>
</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_08.jpg"/></div><p>As you can see, you can decide whether or not you want to list all the pages you can display ads on, or all the pages you can't display ads on. Depending on what suits your site, you will need to make a choice of one or the other and then add the appropriate pages in the text area below your choice.</p><p>For the purposes of the demo site, we are happy to show the ads on all the pages, hence the text area is left blank, for two reasons. One, there is no section of the site where ads would be inappropriate, and two, ads are not shown to the administrator anyway, so we don't have to specify that we don't want to see them on the admin pages.</p><p>
<span class="emphasis"><em>But what are the various types of ads that we can show?</em></span> Well, the following table shows the various options you have available:<a class="indexterm" id="id349"/>
</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Ad Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Dimensions</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Ad Links 4-links 120x90</p>
</td><td style="text-align: left" valign="top">
<p>120x90</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Vertical Banner</p>
</td><td style="text-align: left" valign="top">
<p>120x240</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Skyscraper</p>
</td><td style="text-align: left" valign="top">
<p>120x600</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button</p>
</td><td style="text-align: left" valign="top">
<p>125x125</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Half Banner</p>
</td><td style="text-align: left" valign="top">
<p>234x60</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Ad Links 4-links 160x90</p>
</td><td style="text-align: left" valign="top">
<p>160x90</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Wide Skyscraper</p>
</td><td style="text-align: left" valign="top">
<p>160x600</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Ad Links 4-links 180x90</p>
</td><td style="text-align: left" valign="top">
<p>180x90</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Large Rectangle</p>
</td><td style="text-align: left" valign="top">
<p>336x280</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Banner Ad Links 4-links</p>
</td><td style="text-align: left" valign="top">
<p>468x15</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Banner</p>
</td><td style="text-align: left" valign="top">
<p>468x60</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Wide Banner Ad Links 4-links</p>
</td><td style="text-align: left" valign="top">
<p>728x15</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Leaderboard</p>
</td><td style="text-align: left" valign="top">
<p>728x90</p>
</td></tr></tbody></table></div><p>
<span class="emphasis"><em>Why are there so many different types of ads?</em></span> you may ask. The reason is that often there will be limited space that is suitable for advertising on the web page. For example, you might find that there is some space down the left-hand column of your site, in which case you need a long thin ad. Of course, you might also want to show ads running along the bottom of the page, in which case you want a long, horizontal ad.<a class="indexterm" id="id350"/>
</p><p>It's equally likely that you need both types of ads at once, in which case it is important to make use of groups in order to distinguish one type of ad from another. Depending on where in a page an ad is placed, you might need to specify different colors or even a different type of ad entirely—all this can be handled by the use of groups.</p><p>An example of a group setting (under the<span class="strong"><strong> Ad Type and Colors</strong></span> section) is as follows:<a class="indexterm" id="id351"/>
</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_09.jpg"/></div><p>The colors chosen here cause the ads shown to be blended into the site so that they look like a natural part of the page's make-up. Depending on where you are placing your ads, you will need to fiddle around with the color settings to get everything looking neat and tidy.<a class="indexterm" id="id352"/>
</p><p>You can set up to three groups at any one time, so don't feel limited to working with just one. You may decide that you would like an image-only advertisement to be shown in one area, but text ads in another—in which, case you have to make use of different groups.<a class="indexterm" id="id353"/>
</p><p>The following option deals with<span class="strong"><strong> Custom Channels</strong></span>, which you will need to read up in your<span class="emphasis"><em> Google AdSense</em></span> account in order to get working. The website has this to say about them:</p><div class="blockquote"><blockquote class="blockquote"><p>Custom channels allow you to track performance based on your specified criteria. By pasting channel-specific ad code into your pages, you can track a variety of metrics across a range of URLs. Use custom channels to track the performance of different ad formats, for example, or to compare different page topics to one another.</p></blockquote></div><p>This is left to you to study up on because it really is a Google-related issue and not a Drupal one. Once you have created a few channels, it is a simple matter of implementing them in the<span class="strong"><strong> Custom Channels</strong></span> section of the<span class="strong"><strong> adsense</strong></span> settings page.</p><p>
<span class="strong"><strong>Revenue sharing options</strong></span> is an exceptionally useful tool in that it allows you to allocate a percentage of the revenue generated from Google Ads to the author of the page that contained the ad. In other words, you can now use revenue from ads as a way to encourage blog writers to blog, story writers to write, and so on, because they now have a vested interest in making their content as popular as possible so that as much traffic as possible flows over their posts.</p><p>Unfortunately, if you decide to make use of revenue sharing, then you need to go back to the Drupal website and download an appropriate version of the<span class="strong"><strong> User Referral</strong></span> module, because this is required in order to get this feature of the AdSense module working correctly. You should find it easy enough to install the module; there is a MySQL script that must be run, but recall that we have done this before in earlier chapters.</p><p>Once User Referral is installed and enabled, you will need to set the roles that are able to<span class="strong"><strong> use referrals</strong></span> in the<span class="strong"><strong> access control</strong></span> section under<span class="strong"><strong> administer</strong></span>. You then have to create a new<span class="strong"><strong> profile</strong></span> field on the<span class="strong"><strong> profiles</strong></span> page under<span class="strong"><strong> settings</strong></span> in the administration section so that users can enter their Google AdSense client ID into their<span class="strong"><strong> my account</strong></span> section. In order to do this you will need to enable the<span class="strong"><strong> profile</strong></span> module first (it is part of the core distribution, and so no download is required).</p><p>In this case, you should select a<span class="strong"><strong> single-line textfield</strong></span>, and provide a few informative and sensible options as shown here:</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_10.jpg"/></div><p>Now when users view their account information (or even upon registration, depending on whether this was enabled in the<span class="strong"><strong> profiles</strong></span> section), they have a text area in which they can enter their Google AdSense ID:</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_11.jpg"/></div><p>With everything correctly set up, the following revenue-oriented settings were made for the demo site:</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_12.jpg"/></div><p>In this case, the author of the content will get 30% of the revenue generated from traffic at their content, but only blogs, pages, and stories qualify as potential revenue-sharing content—users who are working on polls and book pages, sadly, miss out. Remember:</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note37"/>Note</h3><p>Any user who wishes to benefit from revenue sharing must have their own Google account and will need to supply their Google client ID in their profile before they can be credited for their share of the revenue.</p></div></div><p>Finally,<span class="strong"><strong> Advanced options</strong></span> allows you to specify whether to disable ads, display a placeholder, limit the number of ads per page, or<span class="strong"><strong> Enable AdSense Section targeting</strong></span> as follows:</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_13.jpg"/></div><p>It's a good idea to always keep the placeholder enabled as this allows you to track where your ads are even when you are logged on as the administrator. It could be fairly time consuming to have to log in and log out every time you make a change to the whereabouts of your ads, but it is simple enough to know where they are by viewing the placeholder, as shown here:<a class="indexterm" id="id354"/>
</p><div class="mediaobject"><img alt="Installing and Configuring AdSense" src="graphics/1800_09_14.jpg"/></div><p>The last item of interest,<span class="strong"><strong> Section targeting</strong></span>, is a Google-related function as defined here:</p><div class="blockquote"><blockquote class="blockquote"><p>Section targeting allows you to suggest sections of your text and HTML content that you'd like us to emphasize or downplay when matching ads to your site's content. By providing us with your suggestions, you can assist us in improving your ad targeting. We recommend that only those familiar with HTML attempt to implement section targeting.</p></blockquote></div><p>In our case, we don't have to do anything because the module automatically targets Google Ads to the teaser and body of nodes for us. Simply enable it and away you go!</p><p>Once you are done configuring the groups and so on, click<span class="strong"><strong> Save configuration</strong></span>. It is then time to actually make use of these configuration options by physically inserting the ads onto the site's pages.<a class="indexterm" id="id355"/>
</p></div><div class="section" title="Adding Google Ads to Your Pages"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec05"/>Adding Google Ads to Your Pages</h2></div></div></div><p>In our case, we would like to display an ad that runs down the left-hand side of the page below any and all other blocks. The reason for this is that the right-hand sidebar has already become quite full, while the left-hand sidebar is sparsely populated, so there is space here. While this ad will be housed within a block, we will also show how to add an ad directly to the site.<a class="indexterm" id="id356"/>
</p><p>Let's begin with the block first…</p><p>You have already seen how to create a new block; so if you would like to do things this way, head on over to the<span class="strong"><strong> blocks</strong></span> link and click on the<span class="strong"><strong> add block</strong></span> tab to bring up the following page:<a class="indexterm" id="id357"/>
</p><div class="mediaobject"><img alt="Adding Google Ads to Your Pages" src="graphics/1800_09_15.jpg"/></div><p>Here we have given the block a new title, which unsurprisingly enough is<span class="strong"><strong> Advertisements</strong></span> (the description as it will appear in the list of blocks is<span class="strong"><strong> Google Ads)</strong></span>. Next, we entered some PHP code to display the Google ads within the block. If you are wondering how I came up with this code, it is all discussed in the notes provided on the<span class="strong"><strong> adsense</strong></span> configuration page. The important thing to note here is the<code class="literal"> adsense_display</code> function, because it controls how your ads look via the settings you make in the<span class="strong"><strong> adsense</strong></span> configuration page (discussed in the previous section).<a class="indexterm" id="id358"/>
</p><p>The previous screenshot shows a fairly simple use of this function, but let's take a quick look at it in more detail so that you understand how it works in the event you need something slightly more complex. From the documentation, we can see that<code class="literal"> adsense_display</code> takes the following three arguments:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Format:</strong></span> This is a string of two numbers with an<code class="literal"> x</code> in between. It can be any valid combination from the list provided. If this is not specified, then<code class="literal"> 160x600</code> is assumed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Group:</strong></span> This is the group that denotes the type (text or image) and color of the ad. This can be<code class="literal"> 1, 2</code>, or<code class="literal"> 3</code>. If this is not specified, then<code class="literal"> 1</code> is assumed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Channel:</strong></span> This is the custom channel for the ad, as configured in AdSense. This is an optional parameter, and if it is not specified, then<code class="literal"> 1</code> is assumed. If you did not configure any channels, then leave this parameter out.</li></ul></div><p>Knowing this, you can see that in the previous screenshot, we have requested an ad of dimension<code class="literal"> 160x600</code> pixels, and that the ad should belong to group<code class="literal"> 1</code>. The final argument is optional, and since we are not concerned with custom channels (as this is a more advanced option, which we leave for you to consider in the event your advertising policy becomes more complex in the future), we left it out entirely.</p><p>The final thing to make note of is that we set the<span class="strong"><strong> Input format</strong></span> to<span class="strong"><strong> PHP code</strong></span> in order to allow Drupal to implement the code we have entered for the block. Once this block has been successfully added to the system, we give it a high weight (so it displays after everything else) and enable it within the left-hand sidebar as shown here:<a class="indexterm" id="id359"/>
</p><div class="mediaobject"><img alt="Adding Google Ads to Your Pages" src="graphics/1800_09_16.jpg"/></div><p>That is all there is to it! The results can be viewed simply by logging out and taking a look at the page. In our case, due to the settings we made in the configuration section and the dimensions we specified, we get the following block displayed in the left sidebar:</p><div class="mediaobject"><img alt="Adding Google Ads to Your Pages" src="graphics/1800_09_17.jpg"/></div><p>That looks pretty good!<span class="emphasis"><em> But how do we go about adding the ad to the page directly?</em></span> Simple! Open up the<code class="literal"> page.tpl.php</code> file and insert the<code class="literal"> adsense_display</code> function in the place you want it, as shown here:<a class="indexterm" id="id360"/>
</p><div class="informalexample"><pre class="programlisting">&lt;div id="footer"&gt;
<span class="strong"><strong>&lt;?php if ($footer_message) : ?&gt;
&lt;p&gt;&lt;?php print $footer_message;?&gt;&lt;/p&gt;
&lt;?php endif; ?&gt;</strong></span>
&lt;?php
if (module_exist("adsense"))
{
print adsense_display("468x60", 2);
}
?&gt;
Validate &lt;a href="http://validator.w3.org/check/referer"&gt;XHTML&lt;/a&gt; or &lt;a href="http://jigsaw.w3.org/css-validator/check/referer"&gt;CSS&lt;/a&gt;.
&lt;/div&gt;&lt;!-- footer --&gt;
&lt;?php print $closure;?&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div><p>This code snippet creates a long, flat banner that has its properties configured in the second attributes group (you will need to ensure you have made the appropriate settings, or change the group). When viewed on the site, we get the following ad (in this case, Group 2 was configured to show image ads):</p><div class="mediaobject"><img alt="Adding Google Ads to Your Pages" src="graphics/1800_09_18.jpg"/></div><p>It is important to remember that you don't actually need the AdSense contribution to display Google Ads on your website. In fact, you might even run into problems if you are not using a PHPTemplate theme, or trying to insert PHP code into an area of your template, and that area cannot make use of it. There are a couple of things you can look at if you run into problems:<a class="indexterm" id="id361"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Ensure you are not logged in as the administrator because only the ad placeholders display for this user.</li><li class="listitem" style="list-style-type: disc">Check your page's source code to see the result of the<code class="literal"> adsense_display</code> function.</li><li class="listitem" style="list-style-type: disc">Check that you have set valid dimensions for your ad—see the table presented earlier in the section entitled<span class="emphasis"><em> Installing and Configuring AdSense</em></span>.</li><li class="listitem" style="list-style-type: disc">Ensure that you are able to display the number of ads you require—it may be that you are limited in this respect.</li></ul></div><p>The second point in this list is fairly important because viewing the page's source can tell you a lot about what might have gone wrong. In order to do this, click on<span class="strong"><strong> View</strong></span>, and then<span class="strong"><strong> Source</strong></span> in IE, or click<span class="emphasis"><em> Ctrl+U</em></span> in Firefox and you should see something like this (assuming all has gone according to plan):</p><div class="informalexample"><pre class="programlisting">&lt;div class="adsense"&gt;
&lt;script type="text/javascript"&gt;&lt;!--
google_ad_client = "ca-ref-pub-0173529661****";
google_ad_type = "image";
google_ad_channel = "";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_color_border = "E5E5E5";
google_color_bg = "E5E5E5";
google_color_link = "AD857F";
google_color_url = "AD857F";
google_color_text = "AD857F";
//--&gt;&lt;/script&gt;
&lt;script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js"&gt;
&lt;/script&gt;
&lt;/div&gt;
</pre></div><p>If something has gone awry, then it is likely you will be able to spot the problem from comments that are added to the Google ad code or from what is actually presented in the source code.</p><p>Problems with your ads on a development machine might not be the end of the world; by all means check the forums for answers. However, don't get too panicked until you have tried everything out on your live site and allowed sufficient time for Google to crawl your web pages. Until this is done, it is possible that Google is not displaying ads because it has no idea what your site is about.</p></div><div class="section" title="Adding Google Ads to Your Content"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec06"/>Adding Google Ads to Your Content</h2></div></div></div><p>There is also a method of inserting ads directly into your content. For example, if you wanted to show an ad within content, you would first need to enable the<span class="strong"><strong> Adsense filter</strong></span>, by navigating to<span class="strong"><strong> input formats</strong></span> under<span class="strong"><strong> administer</strong></span> and modifying a current input format or creating a new one entirely. For example, the<span class="strong"><strong> Adsense filter</strong></span> was enabled on the<span class="strong"><strong> Full HTML input format</strong></span> as follows:<a class="indexterm" id="id362"/>
</p><div class="mediaobject"><img alt="Adding Google Ads to Your Content" src="graphics/1800_09_19.jpg"/></div><p>Now, when adding content that makes use of the<span class="strong"><strong> Full HTML</strong></span> input format, it is possible to add an<code class="literal"> adsense</code> tag, and the<span class="strong"><strong> Full HTML</strong></span> option has an extra line of information outlining how to make use of it, as shown here:<a class="indexterm" id="id363"/>
</p><div class="mediaobject"><img alt="Adding Google Ads to Your Content" src="graphics/1800_09_20.jpg"/></div><p>Adding a page that incorporates Google ads is then a trivial task. Simply insert the correct format, group, and channel into your<code class="literal"> adsense</code> tag and add it wherever you like in your post:</p><div class="mediaobject"><img alt="Adding Google Ads to Your Content" src="graphics/1800_09_21.jpg"/></div><p>The<code class="literal"> adsense</code> tag has a special format as follows:<a class="indexterm" id="id364"/>
</p><div class="informalexample"><pre class="programlisting">[adsense:format:group:channel]
</pre></div><p>where:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">format</code> is one of the supported ad formats (for example,<code class="literal"> 468x60)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">group</code> is the Numeric ad group this ad belongs to; determines colors</li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> is the numeric ad channel<a class="indexterm" id="id365"/></li></ul></div><p>Viewing this page once you have logged off gives the following result (depending on the settings you made for the relevant group referenced from the tag):</p><div class="mediaobject"><img alt="Adding Google Ads to Your Content" src="graphics/1800_09_22.jpg"/></div><p>There is also a special format to be used with<code class="literal"> flexiblocks</code> in the format:</p><div class="informalexample"><pre class="programlisting">[adsense:flexiblock:location]
</pre></div><p>We don't discuss the use of<span class="strong"><strong> Flexiblock</strong></span> here, and so we won't go into this now, but as an exercise you might find it worthwhile downloading and installing the Flexiblock contribution, and trying this out.<a class="indexterm" id="id366"/>
</p></div></div>
<div class="section" title="Advanced Site Modifications"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec03"/>Advanced Site Modifications</h1></div></div></div><p>One of the nice things about working with PHP-based applications like Drupal is that not only are they open source, but you can also combine them with pretty much any other technology you can get your hands on. There is a huge online programming community, and many people make their neat little scripts openly available for the likes of you and me to simply include into our own sites as we please. Not all are free, but many are, and many more are very cheap; so it is always worthwhile looking around at some of the scripting sites to see what you can pick up.</p><p>Here a few sites that you should consider looking over:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.phpbuilder.com">http://www.phpbuilder.com </a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.hotscripts.com">http://www.hotscripts.com   </a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.php.resourceindex.com%20"> http://www.php.resourceindex.com  </a></li><li class="listitem" style="list-style-type: disc"><code class="literal">http://drupal.org/node/257—Customization</code></li></ul></div><p>In this section, we will take a look at what is available and what can easily be incorporated into a Drupal website. Many of you may be shying away at this point because you are not keen to get involved with hardcore PHP programming. Don't worry! The scripts are, by and large, autonomous and complete so that all that is required of us is a few cut and pastes in the right place, perhaps the odd tweak here and there, and away we go. Remember:</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note38"/>Note</h3><p>Adding powerful and advanced features, like those seen on big sites,<span class="emphasis"><em> is not that hard!</em></span>
</p></div></div><p>It is important to be aware that you should always look at any and all licensing issues whenever you make use of other people's scripts. You will find that many are made available for free for non-commercial uses but you are required to purchase a license if you are using it for commercial purposes. As you get more confident with working with scripts, however, you should find that it is possible to build fairly powerful features by using your own code or tying together snippets of freely available code.</p><p>Since the modifications to come are based on JavaScript and AJAX, it is fair to warn you that Drupal 4.7 comes with built in support for AJAX via the<code class="literal"> drupal.js</code> file. AJAX is a term used to describe JavaScript-based applications that are used to create responsive and dynamic web page elements. The goal of this chapter, however, is to show you how to incorporate really nice features<span class="emphasis"><em> without having to learn any coding</em></span>. As a result, we won't discuss how to make use of the JavaScript functionality provided in<code class="literal"> drupal.js</code> because this is really a task for developers, not site administrators.<a class="indexterm" id="id367"/>
</p><p>If you are interested in creating your own AJAX widgets, take a look at the online tutorials provided on the Drupal site at<code class="literal"> http://drupal.org/node/42403</code>. These will give you a good idea of where and how to start off in the event that you need to build a few widgets of your own. Any JavaScript-related development you undertake yourself should be done with Drupal's native JavaScript support.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>What we cover in the rest of this chapter is a bit like cheating—we are getting the advantage of some nice JavaScript effects without being subject to the burden of having to learn how to code them.</p></div></div><p>Many new or upgraded modules will (and do) make use of AJAX already. You might want to download and install a few of these to see what type of effects can be achieved using Drupal's native JavaScript support. Of course, the administration interface for Drupal 4.7 has already been AJAXified with the introduction of the collapsible page areas and so on (for example, on the<span class="strong"><strong> settings</strong></span> page).</p><p>At any rate, let's take a look at the first new feature we are going to add.</p><div class="section" title="Scrolling News Ticker"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec07"/>Scrolling News Ticker</h2></div></div></div><p>This is a nice feature of many sites that attempt to provide up-to-date information for their users. If you need to present several bits of information at once, then a dynamic news ticker could be just the thing. With a bit of work you can even integrate the news ticker with an RSS feed to present breaking news from other sites without having to do any work in creating content yourself.<a class="indexterm" id="id368"/>
</p><p>We'll keep it simple and create a scrolling news ticker across the top of each page on the site. The ticker will show information stored in a<code class="literal"> .txt</code> file on the site. While you can't tell that this information is scrolling across the screen from the screenshot, this is what the addition will ultimately look like:</p><div class="mediaobject"><img alt="Scrolling News Ticker" src="graphics/1800_09_23.jpg"/></div><p>You can hopefully tell from the various fonts displayed in the ticker above that it is possible to add HTML elements such as links to the individual items (shown in a bold font). This means you can use this ticker to add links to sponsors, or even add image links. There is quite a lot of scope for change; so we will look at how to get everything up and running—what you create with the ticker is then up to you and your imagination.<a class="indexterm" id="id369"/>
</p><div class="section" title="Obtaining the Ticker"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec01"/>Obtaining the Ticker</h3></div></div></div><p>The first task is of course to actually find a workable ticker script. In this case, a free ticker script was downloaded (after a brief search on Google) from<span class="strong"><strong> mioplanet</strong></span> at<a class="ulink" href="http://www.mioplanet.com/ rsc/newsticker_javascript.htm">  http://www.mioplanet.com/ rsc/newsticker_javascript.htm </a> . The conditions of use presented on this page are fairly simple and you should make sure you understand the terms before you continue. Assuming you are happy to continue, download the JavaScript source-code file, entitled<code class="literal"> webticker_lib.js</code>, and save it to the theme folder you are currently developing in—in the case of the demo site this is currently<code class="literal"> box_grey_dev</code>.<a class="indexterm" id="id370"/>
</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>If you are going to use a few widgets like this, it may be better to create a<code class="literal"> widgets</code> folder within your theme in order to keep everything neat and tidy and easy to locate.</p></div></div><p>Next, open up the<code class="literal"> page.tpl.php</code> file and search for a suitable place to add the ticker. The actual code required to add the ticker to your web page is given on the mioplanet page, and you can simply copy and paste this directly into your site. Since I wanted the ticker to appear along the top of the screen, I added the code in here:<a class="indexterm" id="id371"/>
</p><div class="informalexample"><pre class="programlisting">&lt;?php if (count($primary_links)) : ?&gt;
&lt;ul id="primary"&gt;
&lt;?php foreach ($primary_links as $link): ?&gt;
&lt;li&gt;&lt;?php print $link?&gt;&lt;/li&gt;
&lt;?php endforeach; ?&gt;
&lt;/ul&gt;
&lt;?php endif; ?&gt;
<span class="strong"><strong>&lt;DIV ID="TICKER" STYLE="overflow:hidden; width:100%" onmouseover="TICKER_PAUSED=true" onmouseout="TICKER_PAUSED=false"&gt;
&lt;? include "ticker.txt"?&gt;
&lt;/DIV&gt;
&lt;script src="webticker_lib.js" language="javascript"&gt;&lt;/script&gt;</strong></span>                            
&lt;/div&gt;
&lt;table id="content"&gt;
&lt;tr&gt;
&lt;?php if ($sidebar_left != ""): ?&gt;
&lt;td class="sidebar" id="sidebar-left"&gt;
&lt;?php print $sidebar_left ?&gt;
&lt;/td&gt;
</pre></div><p>As you can see, this places the script after the header information within the same<code class="literal">&lt;div&gt;</code> tag, but above the table that houses the main content and left and right sidebars.</p><p>The most important part of this script is the reference to the<code class="literal"> webticker_lib.js</code> file. In this instance I have added the relative path to the file (webticker_lib.js) so that this will not have to change once the site is deployed to the host server.</p><p>If you find that your scrolling ticker is just not scrolling, try referencing it with the relative file path, for example:<code class="literal"> /drupal/themes/box_grey_dev/webticker_lib.js</code>. In the unlikely event this doesn't work, try using the fully qualified path:<code class="literal"> C:\\apache2triad\\htdocs\\drupal\\themes\\box_grey_dev\\webticker_lib.js</code>. If this works, remember to write a note somewhere that reminds you to change this path appropriately once you have deployed your site to the live host. It is generally<span class="emphasis"><em> bad practice</em></span> to include absolute file paths like this in your scripts for precisely this reason.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note41"/>Note</h3><p>In the event you have to enter a path and not just the filename, it is a good idea to escape backslashes with another backslash (\\) on Windows machines to prevent any confusion with special characters being misinterpreted—alternatively, use forward slashes.</p></div></div><p>Finally, notice that I have added a short PHP snippet to include a file called<code class="literal"> ticker.txt</code> underneath the first added<code class="literal">&lt;div&gt;</code> tag. If you would rather test whether the ticker is working correctly before dealing with additional code, then replace:</p><div class="informalexample"><pre class="programlisting">&lt;? include "ticker.txt"?&gt;
</pre></div><p>with:</p><div class="informalexample"><pre class="programlisting">Hi! You should see me scrolling across your page.
</pre></div><p>and view your site in your browser. You should see the message scrolling across your page, like this:<a class="indexterm" id="id372"/>
</p><div class="mediaobject"><img alt="Obtaining the Ticker" src="graphics/1800_09_24.jpg"/></div><p>If that works, replace the text message with the PHP<code class="literal"> include</code> statement, and let's move on.</p></div><div class="section" title="Creating the Content"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec02"/>Creating the Content</h3></div></div></div><p>For our humble purposes, all we really need to do is feed the JavaScript file we have just installed on our site a list of lines to print out to the screen. Assuming that we are going to use a simple text file to hold our data, we need each individual item to appear in its complete form on one line. This is a bit of a limitation if you want to make complex scrolling items, but for the purposes of our demonstration, it is more than adequate. You can add in pretty much anything you want here; however, ensure that you test everything thoroughly before releasing it to the public.<a class="indexterm" id="id373"/>
</p><p>Go ahead and create a<code class="literal"> ticker.txt</code> file and add it to the same folder as the<code class="literal"> webticker_lib.js</code> JavaScript file. Before you start adding lines of information to it, bear in mind that you should try to create a standard format for each news item, so that your work in creating new elements is minimized. In this case, each line is delimited by a single vertical bar, except the start and end of the first and last element, which have two in order to keep everything even.</p><p>The following snippet shows the current contents of the<code class="literal"> ticker.txt</code> file on the demo site. These are the items that were used for the scrolling text in the first screenshot in the<span class="emphasis"><em> Scrolling News Ticker</em></span> section:</p><div class="informalexample"><pre class="programlisting">|| &lt;a href="http://www.mioplanet.com/rsc/newsticker_javascript.htm" target="_blank"&gt;&lt;strong&gt;Scrolling News Ticker&lt;/strong&gt;&lt;/a&gt; by &lt;a href="http://www.mioplanet.com" target="_blank"&gt;&lt;strong&gt;mioplanet&lt;/strong&gt;&lt;/a&gt; |
| This book was brought to you by &lt;a href="http://www.packtpub.com" target="_blank"&gt;&lt;strong&gt;Packt Publishing&lt;/strong&gt;&lt;/a&gt; |
| It was written by &lt;em&gt;David Mercer&lt;/em&gt; of &lt;a href="http://www.contechst.com" target="_blank"&gt;&lt;strong&gt;Contechst Technical &amp; Editorial Consultancy&lt;/strong&gt;&lt;/a&gt; ||
</pre></div><p>Unfortunately, due to the limitations in page size of this book, what should appear as<span class="emphasis"><em> single</em></span> lines have to be presented on<span class="emphasis"><em> several</em></span>. You should, however, get the picture in that you can add some sort of delimiter to the start and end of the item, and within these you can add whatever HTML you like. You might even want to try experiment with adding images or even a special style to the style sheet and referencing it from here. In this way you could add a highlighted title icon or logo to each item, for example.</p><p>You will notice a bit further on in this chapter that the news ticker gets a nice, new background color. How you achieve this look is left as an exercise for you. (Hint:<span class="emphasis"><em> follow the same method as the theme and declare a new</em></span>
<code class="literal">&lt;div&gt;</code>
</p><p>The main problem with this script as it stands is that it requires you to manually enter each item, which will no doubt become a pain if you have to do it several times a day for the next ten years. There are several ways around this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a script to pull information from a database.</li><li class="listitem" style="list-style-type: disc">Pull information from an RSS feed.</li><li class="listitem" style="list-style-type: disc">Only enter content that changes infrequently—such as links to sponsors.</li><li class="listitem" style="list-style-type: disc">Get someone else to do it for you.</li></ul></div><p>While we won't continue on this topic here; it would be great experience for you to attempt any one or more of the previous list of options with the exception of the third, which is covered by default. Remember that you can use other scripts to help you out—whatever you can find out there on the Net is fair game to incorporate into your scripts. At any rate, let's get on with the next thing.</p></div></div><div class="section" title="Dynamic Content Page"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec08"/>Dynamic Content Page</h2></div></div></div><p>Assume that as the head honcho of your new site you want to add a page outlining all the latest and greatest posts, happenings, and goings on in your life and in your community. In the case of the demo site, we are going to add a<span class="strong"><strong> quick pick</strong></span> page link to the main menu where people can quickly visit for a selection of the latest and most important happenings on the website—updated once a week, for example.<a class="indexterm" id="id374"/>
</p><p>Now, there are plenty of modules that allow you to show a block of related posts and so forth, but this isn't quite what we want. Ideally, we want to present a list of selected items that allows users to select whatever topic is of interest. At the same time we don't want them to have to jump from node to node in order to view the content of each page.</p><p>What we need is some way of only reloading the new articles without actually changing the page we are on. Once again, this can be easily accomplished with the use of scripts that have already been developed. In this particular case, we are going to use a freely available<span class="strong"><strong> Dynamic Ajax Content</strong></span> script, which is provided by the folks at DynamicDrive DHTML Scripts at<a class="ulink" href="http://www.dynamicdrive.com">  http://www.dynamicdrive.com  </a>.</p><div class="section" title="Incorporating the Application into the Theme"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec03"/>Incorporating the Application into the Theme</h3></div></div></div><p>In this instance we are going to take the JavaScript file provided by DynamicDrive and paste it directly into the<code class="literal"> page.tpl.php</code> file in between the<code class="literal">&lt;head&gt;</code> tags. You can get hold of the particular script at the following address:<code class="literal"> http://www.dynamicdrive.com/dynamicindex17/ajaxcontent.htm</code>. Now, it is not really important that you understand what is going on in the script; however, we will break up the code listing and take a quick look over what it is doing for clarity's sake.<a class="indexterm" id="id375"/>
</p><p>Once you have copied the script, paste it into the PHP file, like so (I have chopped a bit of the actual code file out to save space):</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html  lang="&lt;?php print $language ?&gt;" xml:lang="&lt;?php print $language ?&gt;"&gt;
&lt;head&gt;
&lt;title&gt;&lt;?php print $head_title ?&gt;&lt;/title&gt;
&lt;meta http-equiv="Content-Style-Type" content="text/css" /&gt;
&lt;?php print $head ?&gt;
&lt;?php print $styles ?&gt;
<span class="strong"><strong>&lt;script type="text/javascript"&gt;
/***********************************************
* Dynamic Ajax Content- © Dynamic Drive DHTML code library (www.dynamicdrive.com)
* This notice MUST stay intact for legal use
* Visit Dynamic Drive at http://www.dynamicdrive.com/ for full source code
***********************************************/
var bustcachevar=1 //bust potential caching of external pages after initial request? (1=yes, 0=no)
var loadedobjects=""
var rootdomain="http://"+window.location.hostname
function ajaxpage(url, containerid){
var page_request = false
if (window.XMLHttpRequest) // if Mozilla, Safari etc
page_request = new XMLHttpRequest()
else if (window.ActiveXObject){ // if IE
try {
page_request = new ActiveXObject("Msxml2.XMLHTTP")
}
catch (e){
try{
page_request = new ActiveXObject("Microsoft.XMLHTTP")
}
catch (e){}
}
}
else
return false
page_request.onreadystatechange=function(){
loadpage(page_request, containerid)
}
...
function loadpage(page_request, containerid){
if (page_request.readyState == 4 &amp;&amp; (page_request.status==200 || window.location.href.indexOf("http")==-1))
document.getElementById(containerid).innerHTML=page_request.responseText
}
...
if (fileref!=""){
document.getElementsByTagName("head").item(0).appendChild(fileref)
loadedobjects+=file+" " //Remember this object as being already added to page
}
}
}
&lt;/script&gt;</strong></span>                          
&lt;/head&gt;
&lt;body &lt;?php print theme("onload_attribute"); ?&gt;&gt;
&lt;div id="header"&gt;
&lt;?php print $search_box ?&gt;
&lt;?php if ($logo) : ?&gt;
</pre></div><p>From this code you should be able to gather that once the script has been declared, we use a function,<code class="literal"> ajaxpage</code>, to create a new page that can be loaded into a specific container on our parent web page. This checks to see which browser is being used, and attempts to ensure that the correct<code class="literal"> page_request</code> object is created for the calling browser in order to implement some cross-browser compatibility.</p><p>Then, a new page is loaded using the<code class="literal"> loadpage</code> function, which performs a few checks on the newly created<code class="literal"> page_request</code> object before populating the document container (with the ID,<code class="literal"> containerid)</code> with the page information. The<code class="literal"> containerid</code> is specified in the page code to come, but is obviously very important in that it<span class="emphasis"><em> determines where the new information will be loaded onto the parent page.</em></span>
<a class="indexterm" id="id376"/>
</p><p>Just to reiterate, it is not necessary for you to understand how these scripts work. They are a bit like the engine of a car—you can drive it without knowing exactly how it works. Having said this, JavaScript is a most valuable tool, and with the advent of AJAX to create responsive web pages, time spent studying these scripts would not be wasted.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>Remember, if you ever want to create your own widgets, learn how to make use of Drupal's built-in JavaScript support.</p></div></div><p>With those functions added to your page, the hard work is done! We now need to turn our attention to how we can make use of them when posting to the<span class="strong"><strong> quick pick</strong></span> page.</p></div><div class="section" title="Building the Content Page"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec04"/>Building the Content Page</h3></div></div></div><p>Building a new dynamic page requires us to remember only a couple of important points. First, we need to actually attach the pages we are going to add to the post; otherwise we will not be able to add them to the page. The next is to actually tag a section of the page with the<code class="literal"> containerid</code> tag.</p><p>Actually, we shouldn't start building the page until we have some content to go with it. So, for the purposes of this demo we will add a few pages of interesting content. The first page is a bit of news:<a class="indexterm" id="id377"/>
</p><div class="informalexample"><pre class="programlisting">&lt;table border="0" cellpadding="5"&gt;
&lt;tr&gt;
&lt;td align="center" colspan="2"&gt;
&lt;strong&gt;Latest News&lt;/strong&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan="2"&gt;
The Contechst Wildlife Community was praised for its unswerving
dedication to animal rights in a television interview last night.
&lt;br&gt; The project founder said he thought we did a great job when
asked by the reporter!
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center" colspan="2"&gt;
&lt;em&gt;Sponsored By&lt;/em&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center" colspan="2"&gt;
&lt;a href="http://www.packtpub.com" target="_blank"&gt;
&lt;img src="/drupal/files/PacktLogosmall.png" alt="Packt Publishers"&gt;&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
</pre></div><p>This page is prefixed with the date and the type of article—in this case it was saved as<code class="literal"> 09_02_news.txt</code> on the file system. The reason for this is that when the file attachment is uploaded and attached to the post, you will still need to be able to clearly see which material is the most outdated when the time comes to remove it. The next file is just a bit of plain old content, which we won't bother to list here.</p><p>Now, let's head on over to the<span class="strong"><strong> create content</strong></span> page and add a new page entitled<span class="strong"><strong> quick pick</strong></span>. The first thing that we must do is attach the two content files to this post. Once that is done, ensure that you unselect the<span class="strong"><strong> List</strong></span> options for both. Leaving these files listed would defeat the purpose of the page entirely. Next, the most important thing to do is take note of the names of the files that have been saved by Drupal. You can check these in the<span class="strong"><strong> File attachments</strong></span> section as follows:<a class="indexterm" id="id378"/>
</p><div class="mediaobject"><img alt="Building the Content Page" src="graphics/1800_09_25.jpg"/></div><p>From the previous screenshot you can see that the two files have been saved as<code class="literal"> 09_02_news.txt</code> and<code class="literal"> 09_02_notnews.txt</code> in the<code class="literal"> files</code> directory.</p><p>In the body of the page, we need to create a few links that will call on the<code class="literal"> ajaxpage</code> script function we added to the<code class="literal"> page.tpl.php</code> file earlier. The following HTML was added to the body text area of the<span class="strong"><strong> quick pick</strong></span> page:</p><div class="informalexample"><pre class="programlisting">&lt;table border="0"&gt;
&lt;tr&gt;
&lt;td colspan="2" class="body" width="100%"&gt;
&lt;strong&gt;Please select a link below to view that article:&lt;/strong&gt;
&lt;hr&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class="body" valign="top"&gt;
&lt;br&gt;
<span class="strong"><strong>&lt;a href="javascript:ajaxpage(‘/drupal/files/09_02_news.txt', ‘contentarea');"&gt;Latest News&lt;/a&gt;
&lt;a href="javascript:ajaxpage(‘/drupal/files/09_02_notnews.txt', ‘contentarea');"&gt;Plain Old Content&lt;/a&gt;
&lt;/td&gt;
&lt;td id="contentarea" width="70%" align="center"&gt;&lt;/td&gt;</strong></span>                     
&lt;/tr&gt;
&lt;/table&gt;
</pre></div><p>As you can see, we have added two links, one entitled<code class="literal"> Latest News</code> and the other entitled<code class="literal"> Plain Old Content</code>. Within the links, the<code class="literal"> ajaxpage</code> function is referenced and it is passed the names of the attached files as well as the<code class="literal"> id</code> of the page element where the content of each page is to be displayed. A little further down you can see that we have declared a table cell with the<code class="literal"> id</code> attribute set to<code class="literal"> contentarea</code>, so this is where the dynamic content is going to be displayed.<a class="indexterm" id="id379"/>
</p><p>Before we post this content, it is important to ensure that it is published properly. Make sure you set the<span class="strong"><strong> input format</strong></span> to<span class="strong"><strong> Full HTML</strong></span> otherwise there is a good chance that this will not display properly. Since this is going to be a main menu item, you also need to set the following:</p><div class="mediaobject"><img alt="Building the Content Page" src="graphics/1800_09_26.jpg"/></div><p>While you are at it, you should probably also consider disabling comments for this page unless you particularly want your main menu pages to be up for discussion. Posting this page to the site now gives the following initial page:<a class="indexterm" id="id380"/>
</p><div class="mediaobject"><img alt="Building the Content Page" src="graphics/1800_09_27.jpg"/></div><p>Now, the magic comes when the user actually clicks on one of the links. Instead of moving to a new node, we stay on precisely the same page, except that the content file you attached to this post is now displayed as shown here:<a class="indexterm" id="id381"/>
</p><div class="mediaobject"><img alt="Building the Content Page" src="graphics/1800_09_28.jpg"/></div><p>From the lighter color of the top link you can<span class="emphasis"><em> hopefully</em></span> see it has been followed, and as promised, the<span class="strong"><strong> Latest News</strong></span> article is now displayed in all its glory.<a class="indexterm" id="id382"/>
</p><p>I'm sure you can come up with more novel uses for this type of page—remember to keep the attached files' sizes small so that users don't click on a link and then lose interest waiting for it to be displayed. If you want a bit of a challenge, write a PHP script that converts the<code class="literal">&lt;body&gt;</code> section of other posts into a file so that you can add interesting posts or articles without having to manually create the attached content files.</p><p>Hopefully, you will agree that we have created some very nice functionality for very little effort. That's all we have time for, but now that you know how it's done, I leave it in your capable hands to come up with novel ways of accomplishing whatever important tasks you might have.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec04"/>Summary</h1></div></div></div><p>This chapter focused on two quite different aspects of your website.</p><p>The first dealt with functionality and explored a couple of the more advanced modules available for us. Hopefully, you will find that you now know enough about the use of modules to feel confident in using any one you choose. Ultimately, you might end up creating and sharing your own modules for use by other members of the community, but for now, being able to generate a bit of cash on the side using AdSense as well as create your own custom content types should give you plenty to work with.</p><p>The second section of this chapter discussed how to use the resources available on the Internet in order to find complete solutions, or even partial code pieces that can be modified and/or incorporated into your site in order to give some great functionality. This has hopefully highlighted the fact that even if you aren't a programming expert, with a bit of searching and some basic knowledge of a few important web-based technologies, you can create some powerful features for your site.</p><p>All in all, you website should now be pretty much complete, or, if there is something you want to add that was not discussed directly here, you should find that you have enough general experience to go ahead and make whatever changes you want. Gaining the confidence to create an advanced website is simply about taking the time to learn your way around things, and this book has given you the platform from which to start.</p><p>The following chapter looks at administrative tasks associated with your new website, and doesn't relate to the development of your site as directly as these first nine have. Because of this, I would like to take the time to congratulate you on finishing your website now, as well as assure you that all the hard development work is done.</p><p>If you would like to get your site up and running as soon as possible, feel free to skip the next chapter and go directly to the Appendix, which outlines how to properly deploy your new site to its home on the Web. You can always come back to<a class="link" href="ch10.html" title="Chapter 10. Running Your Website"> Chapter 10</a> and learn how to maintain and administer your site once it is up and running.</p></div></body></html>