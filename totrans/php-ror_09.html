<html><head></head><body>
<div id="_idContainer072">
<h1 class="chapter-number" id="_idParaDest-125"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-126"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.2.1">Bringing It All Together</span></h1>
<p><span class="koboSpan" id="kobo.3.1">So far, we have seen how to use controllers, views, and models in a somewhat detached manner. </span><span class="koboSpan" id="kobo.3.2">In the previous chapter (</span><em class="italic"><span class="koboSpan" id="kobo.4.1">Models, Databases, and Active Record</span></em><span class="koboSpan" id="kobo.5.1">), we manipulated data on our database. </span><span class="koboSpan" id="kobo.5.2">However, we didn’t see how to interact with the database data from our controller, much less how to load that database data into our view. </span><span class="koboSpan" id="kobo.5.3">In this chapter, we are going to see how everything comes together – that is, we’ll load a model from the controller and pass the model data to our view so that the end user will see data on the browser. </span><span class="koboSpan" id="kobo.5.4">We will also do the reverse, which is getting data from the user into our database, starting from the view and ending on the model. </span><span class="koboSpan" id="kobo.5.5">Furthermore, we will also learn the Rails way to perform these actions, as they are quite different from the way we would do these tasks </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">in PHP.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">With models, views, and controllers in mind, in this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Setting up our initial application </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">with generators</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Processing data the </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Rails way</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Do not, I repeat, do not reinvent </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">the wheel</span></span></li>
</ul>
<h1 id="_idParaDest-127"><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.15.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.16.1">To follow along this chapter, we will need </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.18.1">Any IDE to view/edit code (e.g., SublimeText, Visual Studio Code, Notepad++ Vim, </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">Emacs, etc.)</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">For macOS users, you will also need to have Xcode Command Line </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">Tools installed</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Ruby version 3.1.1 or later installed and ready </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">to use</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">A Git client installed on your </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">local machine</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.26.1">The code presented in this chapter is available </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">at </span></span><a href="https://github.com/PacktPublishing/From-PHP-to-Ruby-on-Rails/"><span class="No-Break"><span class="koboSpan" id="kobo.28.1">https://github.com/PacktPublishing/From-PHP-to-Ruby-on-Rails/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.29.1">.</span></span></p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.30.1">Project preparation</span></h1>
<p><span class="koboSpan" id="kobo.31.1">Prior to setting up our application, we are going to do some additional configuration, depending on the operating system. </span><span class="koboSpan" id="kobo.31.2">We will separate the configuration into two sections – Windows configuration and Linux-based systems (</span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">including macOS).</span></span></p>
<h3><span class="koboSpan" id="kobo.33.1">Windows configuration</span></h3>
<p><span class="koboSpan" id="kobo.34.1">In </span><a href="B19230_07.xhtml#_idTextAnchor103"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.35.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.36.1">, we configured our Windows </span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.37.1">environment to use </span><strong class="bold"><span class="koboSpan" id="kobo.38.1">rbenv</span></strong><span class="koboSpan" id="kobo.39.1"> to be able to use Ruby 2.6.10. </span><span class="koboSpan" id="kobo.39.2">If you haven’t done so, please go back to the </span><em class="italic"><span class="koboSpan" id="kobo.40.1">Installing Ruby on Rails in Windows</span></em><span class="koboSpan" id="kobo.41.1"> section, as this is </span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.42.1">required for this chapter. </span><span class="koboSpan" id="kobo.42.2">For Rails 7 (which we will install in this chapter), we will require Ruby 3.1.1 installed and some dependencies that aren’t easily available for Windows. </span><span class="koboSpan" id="kobo.42.3">We will use the Git SDK’s bash shell (which we also installed in </span><a href="B19230_07.xhtml#_idTextAnchor103"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.43.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.44.1">) to solve this issue. </span><span class="koboSpan" id="kobo.44.2">So, let’s open a Windows PowerShell and type the </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.46.1">
C:\git-sdk-64\git-bash.exe</span></pre> <p><span class="koboSpan" id="kobo.47.1">This will open a Git Bash console, which looks and behaves a lot like a Linux shell. </span><span class="koboSpan" id="kobo.47.2">Let’s confirm that we have Ruby available by typing the </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.49.1">
ruby –version</span></pre> <p><span class="koboSpan" id="kobo.50.1">This should output </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.52.1">
ruby 3.1.3p185 (2022-11-24 revision 1a6b16756e) [x64-mingw32]</span></pre> <p><span class="koboSpan" id="kobo.53.1">If you’re not familiar with this version of Ruby, it’s because it comes with the Git SDK. </span><span class="koboSpan" id="kobo.53.2">Now, let’s install bundler for Ruby 3.1.3 with the </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.55.1">
gem install bundler</span></pre> <p><span class="koboSpan" id="kobo.56.1">Next, let’s update our system’s bundler with the </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.58.1">
gem update –system 3.3.3</span></pre> <p><span class="koboSpan" id="kobo.59.1">Now, we are ready to set up </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">our application.</span></span></p>
<h3><span class="koboSpan" id="kobo.61.1">Linux-based system configuration</span></h3>
<p><span class="koboSpan" id="kobo.62.1">For macOS and Linux-based systems (Ubuntu and Debian), we’re going to depend on rbenv to install Ruby 3.1.1. </span><span class="koboSpan" id="kobo.62.2">If you haven’t installed rbenv, please refer to </span><a href="B19230_07.xhtml#_idTextAnchor103"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.63.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.64.1"> to view the instructionson on how to install rbenv on Linux. </span><span class="koboSpan" id="kobo.64.2">With rbenv available, let’s install another version of Ruby</span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.65.1"> with the following command on </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">a shell:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.67.1">
rbenv install 3.1.1</span></pre> <p><span class="koboSpan" id="kobo.68.1">Now that Ruby 3.1.1 has been installed, let’s set the default Ruby to Ruby 3.1.1 with the </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.70.1">
rbenv global 3.1.1</span></pre> <p><span class="koboSpan" id="kobo.71.1">Let’s confirm that the correct Ruby version has been activated by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.73.1">
ruby --version</span></pre> <p><span class="koboSpan" id="kobo.74.1">This should output </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.76.1">
ruby 3.1.1p18 (2022-02-18 revision 53f5fc4236) [x86_64-linux]</span></pre> <p><span class="koboSpan" id="kobo.77.1">We should install bundler for this version of Ruby with the </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.79.1">
gem install bundler</span></pre> <p><span class="koboSpan" id="kobo.80.1">Now, we’re ready for our next </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">Rails project.</span></span></p>
<h1 id="_idParaDest-129"><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.82.1">Setting up our application</span></h1>
<p><span class="koboSpan" id="kobo.83.1">For this exercise, we will have a hypothetical scenario in which we are Thomas A. </span><span class="koboSpan" id="kobo.83.2">Anderson, and we work for </span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.84.1">a respectable software company. </span><span class="koboSpan" id="kobo.84.2">We will play the part of a junior web developer in terms of our knowledge of Rails, and we will be assigned a simple task. </span><span class="koboSpan" id="kobo.84.3">The client has requested a simple address book structure where they can save their friends’ contact information – name, last name, email, and phone number. </span><span class="koboSpan" id="kobo.84.4">So, let’s get to work. </span><span class="koboSpan" id="kobo.84.5">Make sure you have Ruby version 3.1.1 or above installed, or we might encounter issues with the project. </span><span class="koboSpan" id="kobo.84.6">We could download a template application that we already have or clone it from GitHub. </span><span class="koboSpan" id="kobo.84.7">In case you haven’t done so, open a terminal and type the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.85.1">git</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.86.1"> command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.87.1">
git clone https://github.com/PacktPublishing/From-PHP-to-Ruby-on-Rails.git</span></pre> <p><span class="koboSpan" id="kobo.88.1">If you’ve already done so, just navigate into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">chapter09/rails7_original</span></strong><span class="koboSpan" id="kobo.90.1"> folder inside our project with the </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.92.1">
cd From-PHP-to-Ruby-on-Rails/chapter09/rails7_original/</span></pre> <p><span class="koboSpan" id="kobo.93.1">For this small project, the client requested that we use Rails 7, as it’s the version they have used in other projects. </span><span class="koboSpan" id="kobo.93.2">It also gives us a chance to see Rails 7 in action. </span><span class="koboSpan" id="kobo.93.3">Now, let’s install our project</span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.94.1"> dependencies with the </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.96.1">
bundle install</span></pre> <p><span class="koboSpan" id="kobo.97.1">To confirm our setup was done correctly, let’s run the </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.99.1">
bundle exec rails --version</span></pre> <p><span class="koboSpan" id="kobo.100.1">The output should read something </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">like this:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.102.1">
Rails 7.0.6</span></pre> <p><span class="koboSpan" id="kobo.103.1">And this is where our work as a Rails developer starts. </span><span class="koboSpan" id="kobo.103.2">We’re going to use some Rails magic to generate most of our code. </span><span class="koboSpan" id="kobo.103.3">Let’s generate a </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">friends</span></strong><span class="koboSpan" id="kobo.105.1"> controller with all the methods that we are going to be calling – </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">index</span></strong><span class="koboSpan" id="kobo.107.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">new</span></strong><span class="koboSpan" id="kobo.109.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">edit</span></strong><span class="koboSpan" id="kobo.111.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">update</span></strong><span class="koboSpan" id="kobo.113.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">destroy</span></strong><span class="koboSpan" id="kobo.115.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.116.1">create</span></strong><span class="koboSpan" id="kobo.117.1">. </span><span class="koboSpan" id="kobo.117.2">Let’s go to our shell and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.119.1">
bundle exec rails generate controller Friends index new edit update destroy create</span></pre> <p><span class="koboSpan" id="kobo.120.1">This should generate the </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">following output:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.122.1">
      create  app/controllers/friends_controller.rb
       route  get 'friends/index'
              get 'friends/new'
              get 'friends/edit'
              get 'friends/update'
              get 'friends/destroy'
              get 'friends/create'
      invoke  erb
      create    app/views/friends
      create    app/views/friends/index.html.erb
      create    app/views/friends/new.html.erb
      create    app/views/friends/edit.html.erb
      create    app/views/friends/update.html.erb
      create    app/views/friends/destroy.html.erb
      create    app/views/friends/create.html.erb
      …</span></pre> <p><span class="koboSpan" id="kobo.123.1">Coming from the PHP </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.124.1">world, and more specifically, Laravel, you may find the previous command slightly familiar. </span><span class="koboSpan" id="kobo.124.2">In Laravel, you’d generate an equivalent controller with the </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.126.1">
php artisan make:controller FriendsController --resource</span></pre> <p><span class="koboSpan" id="kobo.127.1">They both generate similar functionality (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">friends</span></strong><span class="koboSpan" id="kobo.129.1"> controller) and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">--resource</span></strong><span class="koboSpan" id="kobo.131.1"> option at the end generates the correct HTTP verbs. </span><span class="koboSpan" id="kobo.131.2">In Rails, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">generator</span></strong><span class="koboSpan" id="kobo.133.1"> command we just ran takes as its first argument the controller name (Friends) and the rest as controller methods. </span><span class="koboSpan" id="kobo.133.2">The command is also very verbose regarding what it actually generates. </span><span class="koboSpan" id="kobo.133.3">It not only created our controller but also a view for each of the methods we passed to the command. </span><span class="koboSpan" id="kobo.133.4">We can see this by opening the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">app/views/friends/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.135.1"> folder.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer057">
<span class="koboSpan" id="kobo.136.1"><img alt="Figure 9.1 – Generated views for the Friends controller" src="image/B19230_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.137.1">Figure 9.1 – Generated views for the Friends controller</span></p>
<p><span class="koboSpan" id="kobo.138.1">Additionally, the controller generator modified our </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">routes.rb</span></strong><span class="koboSpan" id="kobo.140.1"> file, which defines all the URLs for our actions inside the controller. </span><span class="koboSpan" id="kobo.140.2">If we open </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">config/routes.rb</span></strong><span class="koboSpan" id="kobo.142.1">, we see our newly </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">created routes:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.144.1">
Rails.application.routes.draw do
  get 'friends/index'
  get 'friends/new'
  get 'friends/edit'
  get 'friends/update'
  get 'friends/destroy'
  get 'friends/create'
  # root "articles#index"
end</span></pre> <p><span class="koboSpan" id="kobo.145.1">While this is fine and</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.146.1"> dandy, we can also do it the Rails way. </span><span class="koboSpan" id="kobo.146.2">Let’s delete all the routes and just leave two lines inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">do</span></strong><span class="koboSpan" id="kobo.148.1"> block, so our </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">routes.rb</span></strong><span class="koboSpan" id="kobo.150.1"> file now looks </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.152.1">
Rails.application.routes.draw do
  resources :friends
  root "friends#index"
end</span></pre> <p><span class="koboSpan" id="kobo.153.1">This looks a lot cleaner, though slightly cryptic, as we don’t know (yet) what this resource call does. </span><span class="koboSpan" id="kobo.153.2">The resource call generates RESTful routes for the following actions – </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">index</span></strong><span class="koboSpan" id="kobo.155.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">new</span></strong><span class="koboSpan" id="kobo.157.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">edit</span></strong><span class="koboSpan" id="kobo.159.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">create</span></strong><span class="koboSpan" id="kobo.161.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">update</span></strong><span class="koboSpan" id="kobo.163.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">destroy</span></strong><span class="koboSpan" id="kobo.165.1">. </span><span class="koboSpan" id="kobo.165.2">This simply means that all these actions should be called using the correct HTTP verbs – </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">GET</span></strong><span class="koboSpan" id="kobo.167.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">POST</span></strong><span class="koboSpan" id="kobo.169.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">PATCH</span></strong><span class="koboSpan" id="kobo.171.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">PUT</span></strong><span class="koboSpan" id="kobo.173.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">DELETE</span></strong><span class="koboSpan" id="kobo.175.1">. </span><span class="koboSpan" id="kobo.175.2">I don’t want to overwhelm you with too much information here, so to simplify this, we’ll just say we need some parameters through the URL, and some others to be “hidden” from the user. </span><span class="koboSpan" id="kobo.175.3">If you’re curious about RESTful and its uses, please take a look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">following links:</span></span></p>
<ul>
<li><a href="https://guides.rubyonrails.org/routing.html"><span class="No-Break"><span class="koboSpan" id="kobo.177.1">https://guides.rubyonrails.org/routing.html</span></span></a></li>
<li><a href="https://www.redhat.com/en/topics/api/what-is-a-rest-api"><span class="No-Break"><span class="koboSpan" id="kobo.178.1">https://www.redhat.com/en/topics/api/what-is-a-rest-api</span></span></a></li>
<li><a href="https://aws.amazon.com/what-is/restful-api/"><span class="No-Break"><span class="koboSpan" id="kobo.179.1">https://aws.amazon.com/what-is/restful-api/</span></span></a></li>
<li><a href="https://www.ibm.com/topics/rest-apis"><span class="No-Break"><span class="koboSpan" id="kobo.180.1">https://www.ibm.com/topics/rest-apis</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.181.1">Now, to the next step. </span><span class="koboSpan" id="kobo.181.2">Let’s generate a model that will represent our “friends” in the database. </span><span class="koboSpan" id="kobo.181.3">We’ll generate our model with the following command on </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">the shell:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.183.1">
bundle exec rails generate model Friend first_name:string last_name:string email:string phone:string</span></pre> <p><span class="koboSpan" id="kobo.184.1">This will generate the </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">following output:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.186.1">
      invoke  active_record
      create    db/migrate/20230817022418_create_friends.rb
      create    app/models/friend.rb
      invoke    test_unit
      create      test/models/friend_test.rb
      create      test/fixtures/friends.yml</span></pre> <p><span class="koboSpan" id="kobo.187.1">The model generator</span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.188.1"> created the migration to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">friends</span></strong><span class="koboSpan" id="kobo.190.1"> table. </span><span class="koboSpan" id="kobo.190.2">The table will have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">first_name</span></strong><span class="koboSpan" id="kobo.192.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">last_name</span></strong><span class="koboSpan" id="kobo.194.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">email</span></strong><span class="koboSpan" id="kobo.196.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">phone</span></strong><span class="koboSpan" id="kobo.198.1"> fields. </span><span class="koboSpan" id="kobo.198.2">From what we learned in the previous chapter, we know that we must run the migration to effectively generate our database structure. </span><span class="koboSpan" id="kobo.198.3">We’ll do that by running the following command on </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">our shell:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.200.1">
bundle exec rails db:migrate</span></pre> <p><span class="koboSpan" id="kobo.201.1">If this is not new to you, it might be because other PHP frameworks have similar tools. </span><span class="koboSpan" id="kobo.201.2">For Laravel, we would execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.203.1">
php artisan migrate</span></pre> <p><span class="koboSpan" id="kobo.204.1">For Symfony, we would write the </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.206.1">
bin/console doctrine:migrations:migrate</span></pre> <p><span class="koboSpan" id="kobo.207.1">For CodeIgniter, we would write the </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.209.1">
spark migrate</span></pre> <p><span class="koboSpan" id="kobo.210.1">We can infer from these examples in PHP frameworks that the migration tool has been in the web framework market for a while, and it’s here </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">to stay.</span></span></p>
<p><span class="koboSpan" id="kobo.212.1">The last step to our setup is going to be something we didn’t cover in the previous chapter, and it is related to Rails models. </span><span class="koboSpan" id="kobo.212.2">As an additional help for developers to get a working environment as soon as possible, Rails</span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.213.1"> integrated a tool called database seeds. </span><span class="koboSpan" id="kobo.213.2">Seeds allow us to generate test data based on our model structure. </span><span class="koboSpan" id="kobo.213.3">I confess I cheated a little bit by providing you with an already-working seed file. </span><span class="koboSpan" id="kobo.213.4">It’s in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">db/seeds.rb</span></strong><span class="koboSpan" id="kobo.215.1"> file. </span><span class="koboSpan" id="kobo.215.2">Let’s look at one record in </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">that file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.217.1">
…
Friend.create(first_name: "rasmus", last_name: "lerdorf", email: "rasmus@email.com", phone: "+1(669)1111111")
…</span></pre> <p><span class="koboSpan" id="kobo.218.1">This piece of code is pretty self-explanatory. </span><span class="koboSpan" id="kobo.218.2">It creates a </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">Friend</span></strong><span class="koboSpan" id="kobo.220.1"> entry with the first name (</span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">rasmus</span></strong><span class="koboSpan" id="kobo.222.1">), the last name (</span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">lerdorf</span></strong><span class="koboSpan" id="kobo.224.1">), the email address (</span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">rasmus@email.com</span></strong><span class="koboSpan" id="kobo.226.1">), and a phone number (</span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">+1(669)1111111</span></strong><span class="koboSpan" id="kobo.228.1">). </span><span class="koboSpan" id="kobo.228.2">Of course, this is all fake data, but it will </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.229.1">be useful for us whenever we start using the database. </span><span class="koboSpan" id="kobo.229.2">The last step is to run this seed and add these records to our database. </span><span class="koboSpan" id="kobo.229.3">We do this with the following command on </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">our shell:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.231.1">
bundle exec rails db:seed</span></pre> <p><span class="koboSpan" id="kobo.232.1">This command will generate the five records we find in the seeds file. </span><span class="koboSpan" id="kobo.232.2">This was all the setup we needed for our initial application. </span><span class="koboSpan" id="kobo.232.3">Now, it’s time to manage </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">this data.</span></span></p>
<h1 id="_idParaDest-130"><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.234.1">Processing data</span></h1>
<p><span class="koboSpan" id="kobo.235.1">Up until this point, we’ve manually modified data within the database. </span><span class="koboSpan" id="kobo.235.2">By manually, I mean all inside the Rails console. </span><span class="koboSpan" id="kobo.235.3">However, as</span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.236.1"> our project requirement is to let the users handle the </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">friends</span></strong><span class="koboSpan" id="kobo.238.1"> entries, we will do so by integrating our model with our controller and our view so that a user can see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">friends</span></strong><span class="koboSpan" id="kobo.240.1"> entries in a friendly interface. </span><span class="koboSpan" id="kobo.240.2">We will be creating a </span><strong class="bold"><span class="koboSpan" id="kobo.241.1">CRUD</span></strong><span class="koboSpan" id="kobo.242.1"> interface. </span><span class="koboSpan" id="kobo.242.2">Yes, it sounds ugly, but it’s the </span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.243.1">acronym software engineers came up with. </span><span class="koboSpan" id="kobo.243.2">It stands for </span><strong class="bold"><span class="koboSpan" id="kobo.244.1">CReate Update Delete</span></strong><span class="koboSpan" id="kobo.245.1">, which is exactly what we are going to build – an interface to create, update, and </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">delete records.</span></span></p>
<h2 id="_idParaDest-131"><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.247.1">Setting up the CRUD interface</span></h2>
<p><span class="koboSpan" id="kobo.248.1">The first step is to</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.249.1"> confirm that the data is, in fact, in our database. </span><span class="koboSpan" id="kobo.249.2">From our previous chapter, we know that we can call the Rails console for this, so let’s do that by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.251.1">
bundle exec rails console</span></pre> <p><span class="koboSpan" id="kobo.252.1">This should change our shell to look </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">like this:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.254.1">
Loading development environment (Rails 7.0.6)
irb(main):001:0&gt;</span></pre> <p><span class="koboSpan" id="kobo.255.1">Now, let’s type the following command on </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">this console:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.257.1">
Friend.all</span></pre> <p><span class="koboSpan" id="kobo.258.1">This will show all of the </span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.259.1">friends entries on the database. </span><span class="koboSpan" id="kobo.259.2">It should show something </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">like this:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.261.1">
  Friend Load (0.4ms)  SELECT "friends".* FROM "friends"
=&gt;
[#&lt;Friend:0x00000001067cbe90
  id: 1,
  first_name: "rasmus",
  last_name: "lerdorf",
  email: "rasmus@email.com",
  phone: "+1(669)1111111",
  created_at: Thu, 17 Aug 2023 02:41:30.679843000 UTC +00:00,
  updated_at: Thu, 17 Aug 2023 02:41:30.679843000 UTC +00:00&gt;,
…
 #&lt;Friend:0x00000001068232f8
  id: 5,
  first_name: "david heinemeier",
  last_name: "hansson",
  email: "my5@email.com",
  phone: "+1(918)5555555",
  created_at: Thu, 17 Aug 2023 02:41:30.687162000 UTC +00:00,
  updated_at: Thu, 17 Aug 2023 02:41:30.687162000 UTC +00:00&gt;]
irb(main):002:0&gt;</span></pre> <p><span class="koboSpan" id="kobo.262.1">The content has been truncated for brevity, but you should see five records that correspond to what’s on the seed file. </span><span class="koboSpan" id="kobo.262.2">This output confirms that the data is in the database. </span><span class="koboSpan" id="kobo.262.3">Now, let’s exit</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.263.1"> the Rails console by typing the following on </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">the shell:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.265.1">
exit</span></pre> <p><span class="koboSpan" id="kobo.266.1">Now, let’s start our Rails application with the </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.268.1">
bundle exec rails server</span></pre> <p><span class="koboSpan" id="kobo.269.1">This command should output </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.271.1">
=&gt; Booting Puma
=&gt; Rails 7.0.6 application starting in development
=&gt; Run `bin/rails server --help` for more startup options
Puma starting in single mode...
</span><span class="koboSpan" id="kobo.271.2">* Puma version: 5.6.6 (ruby 3.1.1-p18) ("Birdie's Version")
*  Min threads: 5
*  Max threads: 5
*  Environment: development
*          PID: 14464
* Listening on http://127.0.0.1:3000
* Listening on http://[::1]:3000
Use Ctrl-C to stop</span></pre> <p><span class="koboSpan" id="kobo.272.1">Lastly, open the browser of your choice and go to </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">http://127.0.0.1:3000/any</span></strong><span class="koboSpan" id="kobo.274.1">. </span><span class="koboSpan" id="kobo.274.2">This should show the following Rails </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">error page:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer058">
<span class="koboSpan" id="kobo.276.1"><img alt="Figure 9.2 – The Rails Routing Error page" src="image/B19230_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.277.1">Figure 9.2 – The Rails Routing Error page</span></p>
<p><span class="koboSpan" id="kobo.278.1">I purposely mentioned opening a non-existing route to view this page. </span><span class="koboSpan" id="kobo.278.2">Whenever you open a route that is not registered on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">routes.rb</span></strong><span class="koboSpan" id="kobo.280.1"> file, Rails shows this error page, which shows us all the defined routes for our application. </span><span class="koboSpan" id="kobo.280.2">As I mentioned earlier, the resource call </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.281.1">generated a lot of routes for us that are related to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">friends</span></strong><span class="koboSpan" id="kobo.283.1"> component. </span><span class="koboSpan" id="kobo.283.2">We’ll start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">root_path</span></strong><span class="koboSpan" id="kobo.285.1">. </span><span class="koboSpan" id="kobo.285.2">Let’s find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">root_path</span></strong><span class="koboSpan" id="kobo.287.1"> entry on this error page. </span><span class="koboSpan" id="kobo.287.2">Once we find the entry, we can see that it corresponds to our application’s root URL (</span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">/</span></strong><span class="koboSpan" id="kobo.289.1">), and whenever we go to this route on the browser, we execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">index</span></strong><span class="koboSpan" id="kobo.291.1"> method that is inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">friends</span></strong><span class="koboSpan" id="kobo.293.1"> controller, as shown in the last column (</span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">friends#index</span></strong><span class="koboSpan" id="kobo.295.1">). </span><span class="koboSpan" id="kobo.295.2">This error page is basically a map of URL addresses and what action on the controller they will execute. </span><span class="koboSpan" id="kobo.295.3">From this page, we learned that we are going to need to modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">index</span></strong><span class="koboSpan" id="kobo.297.1"> method on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">friends</span></strong><span class="koboSpan" id="kobo.299.1"> controller file in </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.301.1">. </span><span class="koboSpan" id="kobo.301.2">We should see the following code inside </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">this file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.303.1">
class FriendsController &lt; ApplicationController
  def index
  end
  def new
  end
  def edit
  end
  def update
  end
  def destroy
  end
  def create
  end
end</span></pre> <p><span class="koboSpan" id="kobo.304.1">Note that all these </span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.305.1">actions were generated by the controller generator, so we don’t start from scratch. </span><span class="koboSpan" id="kobo.305.2">Also, these are all the actions that we’ll build to create our </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">CRUD interface.</span></span></p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.307.1">Listing data</span></h2>
<p><span class="koboSpan" id="kobo.308.1">Let’s focus on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">index</span></strong><span class="koboSpan" id="kobo.310.1"> method. </span><span class="koboSpan" id="kobo.310.2">We</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.311.1"> want to show all our records on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">index</span></strong><span class="koboSpan" id="kobo.313.1"> method, so we will now load the </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">Friend</span></strong><span class="koboSpan" id="kobo.315.1"> model and select all of our entries in the database. </span><span class="koboSpan" id="kobo.315.2">With these changes in mind, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">index</span></strong><span class="koboSpan" id="kobo.317.1"> method should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.319.1">
class FriendsController &lt; ApplicationController
  def index
    @friends = Friend.all
  end
…</span></pre> <p><span class="koboSpan" id="kobo.320.1">By adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">@</span></strong><span class="koboSpan" id="kobo.322.1"> symbol in front of our </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">friends</span></strong><span class="koboSpan" id="kobo.324.1"> variable, we set the variable to be an instance variable. </span><span class="koboSpan" id="kobo.324.2">The way Rails works is that this instance variable is then passed to the view. </span><span class="koboSpan" id="kobo.324.3">Note that this is</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.325.1"> not the only way to pass data from the controller to the view, but it is a very simple way to do it. </span><span class="koboSpan" id="kobo.325.2">Now, let’s go back to the browser but change the URL to </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">http://127.0.0.1:9000/</span></strong><span class="koboSpan" id="kobo.327.1">. </span><span class="koboSpan" id="kobo.327.2">We should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">following screen:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer059">
<span class="koboSpan" id="kobo.329.1"><img alt="Figure 9.3 – The Rails index page" src="image/B19230_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.330.1">Figure 9.3 – The Rails index page</span></p>
<p><span class="koboSpan" id="kobo.331.1">But wait! </span><span class="koboSpan" id="kobo.331.2">The data that we loaded is not being shown. </span><span class="koboSpan" id="kobo.331.3">This is because while we do have Rails magic, we don’t have Rails miracles. </span><span class="koboSpan" id="kobo.331.4">We still have to work on the view. </span><span class="koboSpan" id="kobo.331.5">So, let’s open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">app/views/friends/index.html.erb</span></strong><span class="koboSpan" id="kobo.333.1"> view and add the data that we just fetched from the database, with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">Friend</span></strong><span class="koboSpan" id="kobo.335.1"> model. </span><span class="koboSpan" id="kobo.335.2">Our view currently looks </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.337.1">
&lt;h1&gt;Friends#index&lt;/h1&gt;
&lt;p&gt;Find me in app/views/friends/index.html.erb&lt;/p&gt;</span></pre> <p><span class="koboSpan" id="kobo.338.1">Let’s remove that code and add a table and a cycle to iterate inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">@friends</span></strong><span class="koboSpan" id="kobo.340.1"> variable. </span><span class="koboSpan" id="kobo.340.2">Our code in the view should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.342.1">
&lt;% @friends.each do |friend| %&gt;
  &lt;%= friend.first_name %&gt;&lt;/br&gt;
&lt;% end %&gt;</span></pre> <p><span class="koboSpan" id="kobo.343.1">With this code, for every friend entry on the database (</span><strong class="source-inline"><span class="koboSpan" id="kobo.344.1">@friends.each do |friend|</span></strong><span class="koboSpan" id="kobo.345.1">), we will rename each entry </span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">friend</span></strong><span class="koboSpan" id="kobo.347.1">. </span><span class="koboSpan" id="kobo.347.2">Note the code tags (</span><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">&lt;% %&gt;</span></strong><span class="koboSpan" id="kobo.349.1">) on the first line of code. </span><span class="koboSpan" id="kobo.349.2">They are very much like the PHP tags we use to embed PHP code in a page (</span><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">&lt;?php ?&gt;</span></strong><span class="koboSpan" id="kobo.351.1">), and just like the PHP tags, anything inside these tags will be processed as Ruby code. </span><span class="koboSpan" id="kobo.351.2">Since the code is simply a cycle to fetch every DB entry, any code after line one will be repeated for every entry in the database until the Ruby cycle is closed on line three. </span><span class="koboSpan" id="kobo.351.3">On line two, we use a different set of tags (</span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">&lt;%= %&gt;</span></strong><span class="koboSpan" id="kobo.353.1">). </span><span class="koboSpan" id="kobo.353.2">These tags will not only process whatever is inside them as Ruby code, but they will also output the result to the browser. </span><span class="koboSpan" id="kobo.353.3">They</span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.354.1"> are exactly like the PHP tags (</span><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">&lt;?= ?&gt;</span></strong><span class="koboSpan" id="kobo.356.1">). </span><span class="koboSpan" id="kobo.356.2">It’s sort of like an </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">echo</span></strong><span class="koboSpan" id="kobo.358.1"> statement but on the browser. </span><span class="koboSpan" id="kobo.358.2">Now, let’s refresh the browser, which should show a page </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer060">
<span class="koboSpan" id="kobo.360.1"><img alt="Figure 9.4 – The Rails index page with data" src="image/B19230_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.361.1">Figure 9.4 – The Rails index page with data</span></p>
<p><span class="koboSpan" id="kobo.362.1">Wow! </span><span class="koboSpan" id="kobo.362.2">We’ve done it. </span><span class="koboSpan" id="kobo.362.3">We’ve loaded data from the database to the controller and then to the view. </span><span class="koboSpan" id="kobo.362.4">I don’t know about you, but the first time I saw this I was really excited, not only because of the result but also because I understood what I was doing with the framework. </span><span class="koboSpan" id="kobo.362.5">I hope you do too now. </span><span class="koboSpan" id="kobo.362.6">Unfortunately, this was just a test to make sure our data was being loaded correctly into the view. </span><span class="koboSpan" id="kobo.362.7">A proper grid will have titles and more fields. </span><span class="koboSpan" id="kobo.362.8">Let’s remove the code we just added to the view and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.364.1">
&lt;table border=1&gt;
  &lt;tr&gt;
      &lt;th&gt;FIRST NAME&lt;/th&gt;
      &lt;th&gt;LAST NAME&lt;/th&gt;
      &lt;th&gt;ACTION&lt;/th&gt;
  &lt;/tr&gt;
  &lt;% @friends.each do |friend| %&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;%= friend.first_name %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= friend.last_name %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href="/friends/&lt;%= friend.id %&gt;/edit"&gt;
        DETAILS&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;% end %&gt;
&lt;/table&gt;</span></pre> <p><span class="koboSpan" id="kobo.365.1">With this change, the first </span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.366.1">six lines of code build a table and the title rows. </span><span class="koboSpan" id="kobo.366.2">On line seven, we create the cycle to iterate between each database entry. </span><span class="koboSpan" id="kobo.366.3">Inside the cycle, we show the first and the last name. </span><span class="koboSpan" id="kobo.366.4">Lastly, we’ve added a link to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">edit</span></strong><span class="koboSpan" id="kobo.368.1"> action. </span><span class="koboSpan" id="kobo.368.2">This is to work on our next view. </span><span class="koboSpan" id="kobo.368.3">If we refresh the browser, we should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">following page:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer061">
<span class="koboSpan" id="kobo.370.1"><img alt=" Figure 9.5 – A Rails index table with data" src="image/B19230_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.371.1"> Figure 9.5 – A Rails index table with data</span></p>
<p><span class="koboSpan" id="kobo.372.1">Now, let’s work on the update page of our CRUD </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">web interface.</span></span></p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.374.1">Updating data</span></h2>
<p><span class="koboSpan" id="kobo.375.1">To edit an entry, we</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.376.1"> first must select that entry. </span><span class="koboSpan" id="kobo.376.2">If we take a closer look at </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.377.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.378.1">.2</span></em><span class="koboSpan" id="kobo.379.1">, we can see that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">edit_friend_path</span></strong><span class="koboSpan" id="kobo.381.1"> route passes a parameter (</span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">:id</span></strong><span class="koboSpan" id="kobo.383.1">). </span><span class="koboSpan" id="kobo.383.2">Unlike classic PHP, we do not explicitly pass parameters by the URL. </span><span class="koboSpan" id="kobo.383.3">Instead, we embed them inside the URL so that our route would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">http://localhost:3000/friends/2/edit</span></strong><span class="koboSpan" id="kobo.385.1"> instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">http://localhost:3000/friends?id=2</span></strong><span class="koboSpan" id="kobo.387.1">. </span><span class="koboSpan" id="kobo.387.2">In Rails, we seldom use explicit URL parameters (</span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">?parameter_name=value</span></strong><span class="koboSpan" id="kobo.389.1">). </span><span class="koboSpan" id="kobo.389.2">With that in mind, as we already have the name of the parameter, we can </span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.390.1">use it to select a single entry. </span><span class="koboSpan" id="kobo.390.2">Let’s open our edit method on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">friends</span></strong><span class="koboSpan" id="kobo.392.1"> controller in </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.394.1">. </span><span class="koboSpan" id="kobo.394.2">The method is currently empty. </span><span class="koboSpan" id="kobo.394.3">It should look </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.396.1">
class FriendsController &lt; ApplicationController
…
  def edit
  end
…</span></pre> <p><span class="koboSpan" id="kobo.397.1">Now, let’s use our model to select a single user by its ID. </span><span class="koboSpan" id="kobo.397.2">Our code will now look </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.399.1">
class FriendsController &lt; ApplicationController
…
  def edit
    @friend = Friend.find(params[:id])
  end
…</span></pre> <p><span class="koboSpan" id="kobo.400.1">Now that we’ve selected the entry, let’s see some more Rails magic in action. </span><span class="koboSpan" id="kobo.400.2">Let’s open the edit view on </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">app/views/friends/edit.html.erb</span></strong><span class="koboSpan" id="kobo.402.1">. </span><span class="koboSpan" id="kobo.402.2">This should look </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.404.1">
&lt;h1&gt;Friends#edit&lt;/h1&gt;
&lt;p&gt;Find me in app/views/friends/edit.html.erb&lt;/p&gt;</span></pre> <p><span class="koboSpan" id="kobo.405.1">Now, let’s delete the preceding HTML code and replace it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.407.1">
&lt;%= form_with model: @friend do |form| %&gt;
  &lt;%= form.label :first_name %&gt;&lt;br&gt;
  &lt;%= form.text_field :first_name %&gt;&lt;br&gt;
  &lt;%= form.label :last_name %&gt;&lt;br&gt;
  &lt;%= form.text_field :last_name %&gt;&lt;br&gt;
  &lt;%= form.label :email %&gt;&lt;br&gt;
  &lt;%= form.text_field :email %&gt;&lt;br&gt;
  &lt;%= form.label :phone %&gt;&lt;br&gt;
  &lt;%= form.text_field :phone %&gt;&lt;br&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;</span></pre> <p><span class="koboSpan" id="kobo.408.1">Rails comes with another set of tools for tasks we do over and over. </span><span class="koboSpan" id="kobo.408.2">These tools are called </span><em class="italic"><span class="koboSpan" id="kobo.409.1">helpers</span></em><span class="koboSpan" id="kobo.410.1">. </span><span class="koboSpan" id="kobo.410.2">Helpers are</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.411.1"> functions that we can call to generate a task for us. </span><span class="koboSpan" id="kobo.411.2">There are many</span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.412.1"> types of helpers, but for now, we’ll use form helpers that assist us in building forms for </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">data processing.</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">If you’re interested in learning more on this topic of form helpers, please refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">Ruby guides:</span></span></p>
<p><a href="https://guides.rubyonrails.org/form_helpers.html"><span class="No-Break"><span class="koboSpan" id="kobo.416.1">https://guides.rubyonrails.org/form_helpers.html</span></span></a></p>
<p><span class="koboSpan" id="kobo.417.1">In the preceding code, we chose the </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">form_with</span></strong><span class="koboSpan" id="kobo.419.1"> helper to generate a form to update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">Friend</span></strong><span class="koboSpan" id="kobo.421.1"> entry. </span><span class="koboSpan" id="kobo.421.2">Then, inside the form, for each field that we have on the database (</span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">first_name</span></strong><span class="koboSpan" id="kobo.423.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">last_name</span></strong><span class="koboSpan" id="kobo.425.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">email</span></strong><span class="koboSpan" id="kobo.427.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">phone</span></strong><span class="koboSpan" id="kobo.429.1">), we generated a label and a field. </span><span class="koboSpan" id="kobo.429.2">Lastly, we added a submit button to send the data back to the controller for processing. </span><span class="koboSpan" id="kobo.429.3">Now, let’s open our browser and click on the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">DETAILS</span></strong><span class="koboSpan" id="kobo.431.1"> link on the index page. </span><span class="koboSpan" id="kobo.431.2">This will take us to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">http://127.0.0.1:3000/friends/1/edit</span></strong><span class="koboSpan" id="kobo.433.1"> URL, and it should show the </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">following page:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer062">
<span class="koboSpan" id="kobo.435.1"><img alt="Figure 9.6 – A Rails edit form with data" src="image/B19230_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.436.1">Figure 9.6 – A Rails edit form with data</span></p>
<p><span class="koboSpan" id="kobo.437.1">And voilà! </span><span class="koboSpan" id="kobo.437.2">With very little code, we’ve generated a form that shows the current field values and lets us modify these values. </span><span class="koboSpan" id="kobo.437.3">However, we’re still missing the code to modify any of these values on</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.438.1"> the database. </span><span class="koboSpan" id="kobo.438.2">So, let’s go back to the controller on </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.440.1">, but now, we’ll add a method to help us process </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">the form.</span></span></p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.442.1">Creating data</span></h2>
<p><span class="koboSpan" id="kobo.443.1">Our last method (</span><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">create</span></strong><span class="koboSpan" id="kobo.445.1">) is at the</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.446.1"> end of </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">our class:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.448.1">
class FriendsController &lt; ApplicationController
…
  def create
  end
end</span></pre> <p><span class="koboSpan" id="kobo.449.1">Let’s add a private method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">friend_params</span></strong><span class="koboSpan" id="kobo.451.1"> right after our </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">create</span></strong><span class="koboSpan" id="kobo.453.1"> method. </span><span class="koboSpan" id="kobo.453.2">Our code should look </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.455.1">
class FriendsController &lt; ApplicationController
…
  def create
  end
  private
  def friend_params
    params.require(:friend).permit( :first_name,
      :last_name, :email, :phone )
  end
end</span></pre> <p><span class="koboSpan" id="kobo.456.1">With this method, when called, we let Rails know that the data sent through a form should have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">friend</span></strong><span class="koboSpan" id="kobo.458.1"> index, and</span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.459.1"> inside this index, it may have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">first_name</span></strong><span class="koboSpan" id="kobo.461.1"> field, </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">last_name</span></strong><span class="koboSpan" id="kobo.463.1"> field, and so on. </span><span class="koboSpan" id="kobo.463.2">In PHP terms, this would be equivalent to sending data in the </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">following array:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.465.1">
$_REQUEST['friend'] = array("first_name"=&gt;"rasmus",…);</span></pre> <p><span class="koboSpan" id="kobo.466.1">I’m oversimplifying this process, but in essence, the method requires and allows </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">certain parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.468.1">If you wish to learn more about parameters, do take a look at </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">these pages:</span></span></p>
<ul>
<li><a href="https://apidock.com/rails/ActionController/Parameters/require"><span class="No-Break"><span class="koboSpan" id="kobo.470.1">https://apidock.com/rails/ActionController/Parameters/require</span></span></a></li>
<li><a href="https://apidock.com/rails/ActionController/Parameters/permit"><span class="No-Break"><span class="koboSpan" id="kobo.471.1">https://apidock.com/rails/ActionController/Parameters/permit</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.472.1">For now, let’s implement this </span><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">friend_params</span></strong><span class="koboSpan" id="kobo.474.1"> method. </span><span class="koboSpan" id="kobo.474.2">Do keep in mind that to show the edit form, the method we call is </span><strong class="source-inline"><span class="koboSpan" id="kobo.475.1">edit</span></strong><span class="koboSpan" id="kobo.476.1">, but to modify the data on the database, we’ll call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">update</span></strong><span class="koboSpan" id="kobo.478.1"> method. </span><span class="koboSpan" id="kobo.478.2">Currently, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">update</span></strong><span class="koboSpan" id="kobo.480.1"> method is empty. </span><span class="koboSpan" id="kobo.480.2">Let’s modify the method so that it will now look </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.482.1">
…
  def update
    @friend = Friend.find(params[:id])
    if @friend.update(friend_params)
      redirect_to friends_path
    end
  end
…</span></pre> <p><span class="koboSpan" id="kobo.483.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">@friend</span></strong><span class="koboSpan" id="kobo.485.1"> variable, we again select the record that we are going to modify. </span><span class="koboSpan" id="kobo.485.2">Once this record is selected, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">update</span></strong><span class="koboSpan" id="kobo.487.1"> method on this object, which is where the update on the database will happen. </span><span class="koboSpan" id="kobo.487.2">Lastly, we’ll use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">redirect_to</span></strong><span class="koboSpan" id="kobo.489.1"> helper to send the user to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">friends</span></strong><span class="koboSpan" id="kobo.491.1"> page on the browser. </span><span class="koboSpan" id="kobo.491.2">This code is very concise and almost reads like sentences – </span><em class="italic"><span class="koboSpan" id="kobo.492.1">find friend</span></em><span class="koboSpan" id="kobo.493.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.494.1">if friend is updated with friend parameters, redirect to friends path</span></em><span class="koboSpan" id="kobo.495.1">. </span><span class="koboSpan" id="kobo.495.2">This is Ruby at its finest. </span><span class="koboSpan" id="kobo.495.3">The only thing we haven’t analyzed from</span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.496.1"> this snippet of code is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">friends_path</span></strong><span class="koboSpan" id="kobo.498.1"> helper. </span><span class="koboSpan" id="kobo.498.2">However, it’s simple. </span><span class="koboSpan" id="kobo.498.3">We’ll refer again to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.499.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.500.1">.2</span></em><span class="koboSpan" id="kobo.501.1">, in which we see a table with all of our defined routes. </span><span class="koboSpan" id="kobo.501.2">As we find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">friends_path</span></strong><span class="koboSpan" id="kobo.503.1"> helper on this page, we can determine that when we use that alias, we can send a user to the correct controller and </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">method (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">friends#index</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.506.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.507.1">Now, let’s move on to creating a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">friend</span></strong><span class="koboSpan" id="kobo.509.1"> entry. </span><span class="koboSpan" id="kobo.509.2">As with the edit page, let’s first generate our new entry page. </span><span class="koboSpan" id="kobo.509.3">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.511.1"> file, let’s modify the empty </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">new </span></strong><span class="koboSpan" id="kobo.513.1">method. </span><span class="koboSpan" id="kobo.513.2">It should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.515.1">
…
def new
  @friend = Friend.new
end
…</span></pre> <p><span class="koboSpan" id="kobo.516.1">As we are going to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">form_for</span></strong><span class="koboSpan" id="kobo.518.1"> helper, we need to pass an empty model object for the helper to be able to generate the form correctly. </span><span class="koboSpan" id="kobo.518.2">Let’s open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">new</span></strong><span class="koboSpan" id="kobo.520.1"> view in </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">app/views/friends/new.html.erb</span></strong><span class="koboSpan" id="kobo.522.1">, which currently looks </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.524.1">
&lt;h1&gt;Friends#new&lt;/h1&gt;
&lt;p&gt;Find me in app/views/friends/new.html.erb&lt;/p&gt;</span></pre> <p><span class="koboSpan" id="kobo.525.1">Let’s delete the preceding content and replace it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.527.1">
&lt;%= form_with model: @friend do |form| %&gt;
  &lt;%= form.label :first_name %&gt;&lt;br&gt;
  &lt;%= form.text_field :first_name %&gt;&lt;br&gt;
  &lt;%= form.label :last_name %&gt;&lt;br&gt;
  &lt;%= form.text_field :last_name %&gt;&lt;br&gt;
  &lt;%= form.label :email %&gt;&lt;br&gt;
  &lt;%= form.text_field :email %&gt;&lt;br&gt;
  &lt;%= form.label :phone %&gt;&lt;br&gt;
  &lt;%= form.text_field :phone %&gt;&lt;br&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;</span></pre> <p><span class="koboSpan" id="kobo.528.1">You might have noticed that this is the exact same view as the edit page. </span><span class="koboSpan" id="kobo.528.2">Most of the time, we should not repeat </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.529.1">the exact same code, but since we are still learning Rails, we get a pass here. </span><span class="koboSpan" id="kobo.529.2">Now, let’s go back to the controller in </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.531.1"> and modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">create</span></strong><span class="koboSpan" id="kobo.533.1"> method. </span><span class="koboSpan" id="kobo.533.2">It’s empty, but we should add some code so that it looks </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.535.1">
…
def create
  if Friend.create( friend_params )
    redirect_to friends_path
  end
end
…</span></pre> <p><span class="koboSpan" id="kobo.536.1">Just like the </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">update</span></strong><span class="koboSpan" id="kobo.538.1"> method, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">create</span></strong><span class="koboSpan" id="kobo.540.1"> method with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">friend</span></strong><span class="koboSpan" id="kobo.542.1"> params to create a new entry. </span><span class="koboSpan" id="kobo.542.2">Once the entry is created, we redirect the user to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">friends</span></strong><span class="koboSpan" id="kobo.544.1"> index page. </span><span class="koboSpan" id="kobo.544.2">Now, let’s try it out on the browser. </span><span class="koboSpan" id="kobo.544.3">On the browser, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">http://127.0.0.1:3000/friends/new</span></strong><span class="koboSpan" id="kobo.546.1"> URL, which should show the same form as the edit page, but without </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">any data:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer063">
<span class="koboSpan" id="kobo.548.1"><img alt="Figure 9.7 – The Rails new entry form" src="image/B19230_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.549.1">Figure 9.7 – The Rails new entry form</span></p>
<p><span class="koboSpan" id="kobo.550.1">Let’s fill the fields with new</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.551.1"> data, as </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer064">
<span class="koboSpan" id="kobo.553.1"><img alt="Figure 9.8 – The Rails new entry form with data" src="image/B19230_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.554.1">Figure 9.8 – The Rails new entry form with data</span></p>
<p><span class="koboSpan" id="kobo.555.1">When we click on the </span><strong class="bold"><span class="koboSpan" id="kobo.556.1">Create Friend</span></strong><span class="koboSpan" id="kobo.557.1"> button, a new entry is added to the database, and we are redirected to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">friends</span></strong><span class="koboSpan" id="kobo.559.1"> index page, which should show the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">created friend:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer065">
<span class="koboSpan" id="kobo.561.1"><img alt="Figure 9.9 – The Rails index page with a new entry" src="image/B19230_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.562.1">Figure 9.9 – The Rails index page with a new entry</span></p>
<p><span class="koboSpan" id="kobo.563.1">OK, we are almost there – just</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.564.1"> a few more lines of code. </span><span class="koboSpan" id="kobo.564.2">The only method left to cover is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">destroy</span></strong><span class="koboSpan" id="kobo.566.1"> method, but it’s as easy as the other methods we’ve coded </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">so far.</span></span></p>
<h2 id="_idParaDest-135"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.568.1">Deleting data</span></h2>
<p><span class="koboSpan" id="kobo.569.1">Let’s open up our edit view on </span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">app/views/friends/edit.html.erb</span></strong><span class="koboSpan" id="kobo.571.1"> and add another form at the end of the file. </span><span class="koboSpan" id="kobo.571.2">Our form at the end of the file should look </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.573.1">
…
&lt;%= form_with model: @friend, method: :delete do |form| %&gt;
  &lt;%= form.submit "DELETE" %&gt;
&lt;% end %&gt;</span></pre> <p><span class="koboSpan" id="kobo.574.1">Beware of not modifying any </span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.575.1">of the code that was already in this </span><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">edit.html.erb</span></strong><span class="koboSpan" id="kobo.577.1"> view at the beginning of the file. </span><span class="koboSpan" id="kobo.577.2">We should add the preceding code at the </span><em class="italic"><span class="koboSpan" id="kobo.578.1">end</span></em><span class="koboSpan" id="kobo.579.1"> of the file. </span><span class="koboSpan" id="kobo.579.2">This new form generates a delete button. </span><span class="koboSpan" id="kobo.579.3">Note how we are passing an additional parameter, </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">method:</span></strong><span class="koboSpan" id="kobo.581.1">, with the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">:delete</span></strong><span class="koboSpan" id="kobo.583.1"> symbol. </span><span class="koboSpan" id="kobo.583.2">This will automatically make the form send the data to the appropriate </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">destroy</span></strong><span class="koboSpan" id="kobo.585.1"> method. </span><span class="koboSpan" id="kobo.585.2">Now, let’s work on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">destroy</span></strong><span class="koboSpan" id="kobo.587.1"> method on the controller in </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.589.1">. </span><span class="koboSpan" id="kobo.589.2">As with the other methods we’ve covered so far, this method should be empty. </span><span class="koboSpan" id="kobo.589.3">Let’s add the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">to it:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.591.1">
…
def destroy
  @friend = Friend.find(params[:id])
  @friend.destroy
  redirect_to friends_path
end
…</span></pre> <p><span class="koboSpan" id="kobo.592.1">With this ominously looking code, we’re telling Rails to select a user by their ID, delete the record from the database, and finally, redirect the user to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">friends</span></strong><span class="koboSpan" id="kobo.594.1"> index page. </span><span class="koboSpan" id="kobo.594.2">Now, let’s give it a try on the</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.595.1"> browser. </span><span class="koboSpan" id="kobo.595.2">Let’s open our browser and go to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">friends</span></strong><span class="koboSpan" id="kobo.597.1"> index page: </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">http://127.0.0.1:3000/friends</span></strong><span class="koboSpan" id="kobo.599.1">. </span><span class="koboSpan" id="kobo.599.2">Click on the last link at the bottom, which should open the edit page that corresponds to </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">Taylor Otwell:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer066">
<span class="koboSpan" id="kobo.601.1"><img alt="Figure 9.10 – A Rails edit page with the latest entry" src="image/B19230_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.602.1">Figure 9.10 – A Rails edit page with the latest entry</span></p>
<p><span class="koboSpan" id="kobo.603.1">Note how we now have a </span><strong class="bold"><span class="koboSpan" id="kobo.604.1">DELETE</span></strong><span class="koboSpan" id="kobo.605.1"> button. </span><span class="koboSpan" id="kobo.605.2">Let’s click on it, and just as quickly as we created this entry, we now have deleted it. </span><span class="koboSpan" id="kobo.605.3">The table should now look like this (without the Taylor </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">Otwell record):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer067">
<span class="koboSpan" id="kobo.607.1"><img alt="Figure 9.11 – A Rails friends index page with one less entry" src="image/B19230_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.608.1">Figure 9.11 – A Rails friends index page with one less entry</span></p>
<p><span class="koboSpan" id="kobo.609.1">And with that, my dear reader, we have successfully created our CRUD interface for our friend address book. </span><span class="koboSpan" id="kobo.609.2">We can now list the existing friends, create new ones, modify the existing ones, and lastly, delete</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.610.1"> any records we no longer need. </span><span class="koboSpan" id="kobo.610.2">Just so we don’t get confused as to what our controller in </span><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.612.1"> should look like at the end of this exercise, let me share the whole file again with all the changes we’ve made </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">so far:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.614.1">
class FriendsController &lt; ApplicationController
  def index
    @friends = Friend.all
  end
  def new
    @friend = Friend.new
  end
  def edit
    @friend = Friend.find(params[:id])
  end
  def update
    @friend = Friend.find(params[:id])
    if @friend.update(friend_params)
      redirect_to friends_path
    end
  end
  def destroy
    @friend = Friend.find(params[:id])
    @friend.destroy
    redirect_to friends_path
  end
  def create
    if Friend.create(friend_params)
      redirect_to friends_path
    end
  end
  private
  def friend_params
    params.require(:friend).permit( :first_name, :last_name, :email, :phone )
  end
end</span></pre> <p><span class="koboSpan" id="kobo.615.1">While our application </span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.616.1">can now handle records, it still has room for improvement, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.618.1">We could use a navigation bar or at least a link to the “</span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">new” page</span></span></li>
<li><span class="koboSpan" id="kobo.620.1">We should refactor the form views so that we use the same form to modify and </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">add records</span></span></li>
<li><span class="koboSpan" id="kobo.622.1">We should </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">use validations</span></span></li>
<li><span class="koboSpan" id="kobo.624.1">We should show errors if any of the </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">actions fail</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.626.1">I tried to over-simplify many of these concepts to focus more on a pragmatic approach. </span><span class="koboSpan" id="kobo.626.2">However, if you are interested in a more detailed set of examples, there are always the guides from Ruby on </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">Rails: </span></span><a href="https://guides.rubyonrails.org/getting_started.html"><span class="No-Break"><span class="koboSpan" id="kobo.628.1">https://guides.rubyonrails.org/getting_started.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.629.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.630.1">The examples in the preceding web page will cover a far more detailed version of what we saw in this chapter. </span><span class="koboSpan" id="kobo.630.2">You</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.631.1"> could make everyone proud and take on these improvements on </span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">your own.</span></span></p>
<p><span class="koboSpan" id="kobo.633.1">Back to the task at hand – the hypothetical client accepted our simplified version of the CRUD interface. </span><span class="koboSpan" id="kobo.633.2">However, someone asked about security. </span><span class="koboSpan" id="kobo.633.3">They don’t want just anyone to be able to see their friend entries on the app. </span><span class="koboSpan" id="kobo.633.4">They want to at least protect the application with a login page. </span><span class="koboSpan" id="kobo.633.5">If you were thinking that we need to program this authentication component, think no more, as we have just the tool </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">for this.</span></span></p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.635.1">Do not, I repeat, do not repeat yourself</span></h1>
<p><span class="koboSpan" id="kobo.636.1">If you’ve worked with frameworks in the past, you may be familiar with the </span><strong class="bold"><span class="koboSpan" id="kobo.637.1">Don’t Repeat Yourself</span></strong><span class="koboSpan" id="kobo.638.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.639.1">DRY</span></strong><span class="koboSpan" id="kobo.640.1">) principle, even though</span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.641.1"> the principle is more focused on coding and coding style. </span><span class="koboSpan" id="kobo.641.2">If you’re not, or just need a reminder, the DRY principle simply states that you should not </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">repeat yourself.</span></span></p>
<p><span class="koboSpan" id="kobo.643.1">You can find out more </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">details here:</span></span></p>
<p><a href="https://docs.getdbt.com/terms/dry"><span class="No-Break"><span class="koboSpan" id="kobo.645.1">https://docs.getdbt.com/terms/dry</span></span></a></p>
<p><span class="koboSpan" id="kobo.646.1">As much as we possibly can, we should try not to repeat our code. </span><span class="koboSpan" id="kobo.646.2">As an example in this application, we repeated the code on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">edit</span></strong><span class="koboSpan" id="kobo.648.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">new</span></strong><span class="koboSpan" id="kobo.650.1"> views. </span><span class="koboSpan" id="kobo.650.2">Using the DRY principle, we should refactor our code so that it uses the same form for both actions. </span><span class="koboSpan" id="kobo.650.3">In the same manner, instead of building everything on your own and from scratch, you should reuse functions, tools, and even libraries altogether. </span><span class="koboSpan" id="kobo.650.4">One task that we as developers have done over and over is to authenticate users. </span><span class="koboSpan" id="kobo.650.5">If you have an authentication code that works, you may have even copied it from a previous project. </span><span class="koboSpan" id="kobo.650.6">However, an open source tool can improve your code. </span><span class="koboSpan" id="kobo.650.7">One advantage of using an open source tool to handle your authentication is that it’s tested against many more scenarios than you could have ever imagined on your own. </span><span class="koboSpan" id="kobo.650.8">Another reason to use an open source tool is that it may be ready to use and simple to incorporate into our project. </span><span class="koboSpan" id="kobo.650.9">There are several gems for user authentication, but for now, we’ll use</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.651.1"> one that is very easy to use called </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">Devise: </span></span><a href="https://github.com/heartcombo/devise"><span class="No-Break"><span class="koboSpan" id="kobo.653.1">https://github.com/heartcombo/devise</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.654.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.655.1">Devise is a gem that, interestingly enough, generates several Rails components that we can use for our application. </span><span class="koboSpan" id="kobo.655.2">Devise will generate views, routes, and helpers to assist us with our user</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.656.1"> authentication. </span><span class="koboSpan" id="kobo.656.2">So, let’s incorporate a new gem into our application. </span><span class="koboSpan" id="kobo.656.3">The first step is going to be to stop the Rails application server. </span><span class="koboSpan" id="kobo.656.4">Open the shell where the application is currently running and press the </span><em class="italic"><span class="koboSpan" id="kobo.657.1">Ctrl</span></em><span class="koboSpan" id="kobo.658.1"> key and </span><em class="italic"><span class="koboSpan" id="kobo.659.1">C</span></em><span class="koboSpan" id="kobo.660.1">. </span><span class="koboSpan" id="kobo.660.2">This should stop the Rails application and return the shell to normal. </span><span class="koboSpan" id="kobo.660.3">The next step is to include the Devise gem in our Gemfile. </span><span class="koboSpan" id="kobo.660.4">Let’s open our </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">./Gemfile</span></strong><span class="koboSpan" id="kobo.662.1"> file at the root of our project (</span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">chapter09/rails7_original/Gemfile</span></strong><span class="koboSpan" id="kobo.664.1">), and add the following code right after the Rails gem line. </span><span class="koboSpan" id="kobo.664.2">The Gemfile should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.666.1">
…
gem "rails", "~&gt; 7.0.6"
gem "devise"
…</span></pre> <p><span class="koboSpan" id="kobo.667.1">Now, let’s install our gem. </span><span class="koboSpan" id="kobo.667.2">Let’s go to our shell and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.668.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.669.1">
bundle install</span></pre> <p><span class="koboSpan" id="kobo.670.1">The command should output a message related to the </span><span class="No-Break"><span class="koboSpan" id="kobo.671.1">devise gem:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.672.1">
…
Using responders 3.1.0
Using importmap-rails 1.2.1
Fetching devise 4.9.2
Using rails 7.0.6
Installing devise 4.9.2
Bundle complete! </span><span class="koboSpan" id="kobo.672.2">11 Gemfile dependencies, 64 gems now installed.
</span><span class="koboSpan" id="kobo.672.3">Use `bundle info [gemname]` to see where a bundled gem is installed.
</span><span class="koboSpan" id="kobo.672.4">Post-install message from devise:
…</span></pre> <p><span class="koboSpan" id="kobo.673.1">Our gem has been installed, but it still needs to run additional tasks, and we still need to add some configuration to our app in order for us to be able to use Devise. </span><span class="koboSpan" id="kobo.673.2">Let’s run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.674.1">install</span></strong><span class="koboSpan" id="kobo.675.1"> command on </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">our shell:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.677.1">
bundle exec rails generate devise:install</span></pre> <p><span class="koboSpan" id="kobo.678.1">The outcome of this</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.679.1"> installation is a set of instructions that we must do before being able to use the gem in </span><span class="No-Break"><span class="koboSpan" id="kobo.680.1">our project:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.681.1">
      create  config/initializers/devise.rb
      create  config/locales/devise.en.yml
=============================================================
Depending on your application's configuration some manual setup may be required:
  1. </span><span class="koboSpan" id="kobo.681.2">Ensure you have defined default url options in your environments files. </span><span class="koboSpan" id="kobo.681.3">Here is an example of default_url_options appropriate for a development environment in config/environments/development.rb:
       config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }
     In production, :host should be set to the actual host of your application.
</span><span class="koboSpan" id="kobo.681.4">     * Required for all applications. </span><span class="koboSpan" id="kobo.681.5">*
  2. </span><span class="koboSpan" id="kobo.681.6">Ensure you have defined root_url to *something* in your config/routes.rb.
</span><span class="koboSpan" id="kobo.681.7">     For example:
       root to: "home#index"
     * Not required for API-only Applications *
  3. </span><span class="koboSpan" id="kobo.681.8">Ensure you have flash messages in app/views/layouts/application.html.erb.
</span><span class="koboSpan" id="kobo.681.9">     For example:
       &lt;p class="notice"&gt;&lt;%= notice %&gt;&lt;/p&gt;
       &lt;p class="alert"&gt;&lt;%= alert %&gt;&lt;/p&gt;
     * Not required for API-only Applications *
  4. </span><span class="koboSpan" id="kobo.681.10">You can copy Devise views (for customization) to your app by
…</span></pre> <p><span class="koboSpan" id="kobo.682.1">We must follow these</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.683.1"> post installation instructions for the gem to work properly. </span><span class="koboSpan" id="kobo.683.2">The first task refers to adding a line of configuration to our environment config file. </span><span class="koboSpan" id="kobo.683.3">Let’s do that. </span><span class="koboSpan" id="kobo.683.4">Let’s open </span><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">config/environment/development.rb</span></strong><span class="koboSpan" id="kobo.685.1"> and add the following line to it. </span><span class="koboSpan" id="kobo.685.2">Our </span><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">config</span></strong><span class="koboSpan" id="kobo.687.1"> file should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.689.1">
…
# Don't care if the mailer can't send.
</span><span class="koboSpan" id="kobo.689.2">  Config.action_mailer.raise_delivery_errors = false
  config.action_mailer.perform_caching = false
  config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }</span></pre> <p><span class="koboSpan" id="kobo.690.1">We’ve added a line to set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">config.action_mailer.default_url_options</span></strong><span class="koboSpan" id="kobo.692.1"> flag after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1">config.action_mailer.perform_caching</span></strong><span class="koboSpan" id="kobo.694.1"> flag is set. </span><span class="koboSpan" id="kobo.694.2">In a production setting, the configuration line we just added would enable password recovery through email. </span><span class="koboSpan" id="kobo.694.3">As this will not work locally, we can ignore it, but the config still needs to be set in place for Devise to work. </span><span class="koboSpan" id="kobo.694.4">The second instruction refers to having a root route. </span><span class="koboSpan" id="kobo.694.5">We can also ignore this instruction, as our </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.695.1">application already includes a root route. </span><span class="koboSpan" id="kobo.695.2">The third task requires that we modify our application layout to include an HTML placeholder for errors and messages. </span><span class="koboSpan" id="kobo.695.3">So, let’s do just that. </span><span class="koboSpan" id="kobo.695.4">Let’s open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">app/views/layouts/application.html.erb</span></strong><span class="koboSpan" id="kobo.697.1"> file. </span><span class="koboSpan" id="kobo.697.2">This file controls how our application will look. </span><span class="koboSpan" id="kobo.697.3">Anytime you need to make a view change on a general level, this is the place to go. </span><span class="koboSpan" id="kobo.697.4">Let’s add those placeholders so that our application layout now looks </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.699.1">
…
&lt;body&gt;
  &lt;p class="notice" &gt;&lt;%= notice %&gt;&lt;/p&gt;
  &lt;p class="alert"&gt;&lt;%= alert %&gt;&lt;/p&gt;
  &lt;%= yield %&gt;
&lt;/body&gt;
…</span></pre> <p><span class="koboSpan" id="kobo.700.1">Whenever Devise alerts any messages regarding the login process, these placeholders will now show those messages (if any are present). </span><span class="koboSpan" id="kobo.700.2">From post installation instructions to get the devise gem to work correctly, we are at the last task (number 4) and this task can be ignored, as it refers to customizing our login views. </span><span class="koboSpan" id="kobo.700.3">We’re almost ready to use Devise, but as I mentioned before, this gem will need a database model to save our user data. </span><span class="koboSpan" id="kobo.700.4">So, let’s run the following command on our shell to </span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">do so:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.702.1">
bundle exec rails generate devise User</span></pre> <p><span class="koboSpan" id="kobo.703.1">This should output </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.705.1">
      invoke  active_record
      create    db/migrate/20230817200425_devise_create_users.rb
      create    app/models/user.rb
      invoke    test_unit
      create      test/models/user_test.rb
      create      test/fixtures/users.yml
      insert    app/models/user.rb
       route  devise_for :users</span></pre> <p><span class="koboSpan" id="kobo.706.1">From analyzing this output, we can see that both a user model and a database migration have been created. </span><span class="koboSpan" id="kobo.706.2">This command also added the login routes to our application. </span><span class="koboSpan" id="kobo.706.3">Remember what we do after we create a database migration? </span><span class="koboSpan" id="kobo.706.4">We need to run the database migration </span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.707.1">so that the user structure is added to the database. </span><span class="koboSpan" id="kobo.707.2">Let’s do just that. </span><span class="koboSpan" id="kobo.707.3">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.709.1">
bundle exec rails db:migrate</span></pre> <p><span class="koboSpan" id="kobo.710.1">This will output the changes made to </span><span class="No-Break"><span class="koboSpan" id="kobo.711.1">the database:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.712.1">
== 20230817200425 DeviseCreateUsers: migrating ===================
-- create_table(:users)
   -&gt; 0.0015s
-- add_index(:users, :email, {:unique=&gt;true})
   -&gt; 0.0004s
-- add_index(:users, :reset_password_token, {:unique=&gt;true})
   -&gt; 0.0003s
== 20230817200425 DeviseCreateUsers: migrated (0.0023s) ===========</span></pre> <p><span class="koboSpan" id="kobo.713.1">Our gem is now ready to be used by our application. </span><span class="koboSpan" id="kobo.713.2">For now, let’s limit all access to our application so that no method on the controller can be viewed without signing in. </span><span class="koboSpan" id="kobo.713.3">The beginning of our </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">app/controllers/friends_controller.rb</span></strong><span class="koboSpan" id="kobo.715.1"> file should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.717.1">
class FriendsController &lt; ApplicationController
  before_action :authenticate_user!
</span><span class="koboSpan" id="kobo.717.2">  Def index
…</span></pre> <p><span class="koboSpan" id="kobo.718.1">By adding the second line of code, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">before_action</span></strong><span class="koboSpan" id="kobo.720.1"> helper will perform the user authentication prior to executing any other action on the controller. </span><span class="koboSpan" id="kobo.720.2">Now, it’s time to try it out. </span><span class="koboSpan" id="kobo.720.3">Let’s go to our</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.721.1"> shell and start the Rails application server with the </span><span class="No-Break"><span class="koboSpan" id="kobo.722.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.723.1">
bundle exec rails s</span></pre> <p><span class="koboSpan" id="kobo.724.1">Once our application is up and running, we should go back to the browser and open </span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">http://127.0.0.1:3000/</span></strong><span class="koboSpan" id="kobo.726.1">, and you will be asked for an email address and </span><span class="No-Break"><span class="koboSpan" id="kobo.727.1">a password:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer068">
<span class="koboSpan" id="kobo.728.1"><img alt="Figure 9.12 – The Devise login page" src="image/B19230_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.729.1">Figure 9.12 – The Devise login page</span></p>
<p><span class="koboSpan" id="kobo.730.1">If you see this form, it means that the Devise gem is working. </span><span class="koboSpan" id="kobo.730.2">If you try to view any page (e.g., </span><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">http://127.0.0.1:3000/friends/1/edit</span></strong><span class="koboSpan" id="kobo.732.1"> or any other existing route), you should be redirected to the login page. </span><span class="koboSpan" id="kobo.732.2">There are two ways to create users with the Devise gem in place. </span><span class="koboSpan" id="kobo.732.3">We can use our Rails console, or we can just sign up. </span><span class="koboSpan" id="kobo.732.4">Let’s use the sign-up method. </span><span class="koboSpan" id="kobo.732.5">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.733.1">Sign up</span></strong><span class="koboSpan" id="kobo.734.1"> link, and it should take you to the </span><strong class="bold"><span class="koboSpan" id="kobo.735.1">Sign </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.736.1">up</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.737.1"> form:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer069">
<span class="koboSpan" id="kobo.738.1"><img alt="Figure 9.13 – The Devise sign up page" src="image/B19230_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.739.1">Figure 9.13 – The Devise sign up page</span></p>
<p><span class="koboSpan" id="kobo.740.1">Let’s add an email </span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.741.1">address, </span><strong class="source-inline"><span class="koboSpan" id="kobo.742.1">admin@email.com</span></strong><span class="koboSpan" id="kobo.743.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">123456</span></strong><span class="koboSpan" id="kobo.745.1"> as the password. </span><span class="koboSpan" id="kobo.745.2">Then, when you click on the </span><strong class="bold"><span class="koboSpan" id="kobo.746.1">Sign up</span></strong><span class="koboSpan" id="kobo.747.1"> button, you should immediately see the page you were trying to browse before being redirected. </span><span class="koboSpan" id="kobo.747.2">As the last page I tried to browse was the edit page, I am now shown that. </span><span class="koboSpan" id="kobo.747.3">However, you can also browse the index page at </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">http://127.0.0.1:3000/</span></strong><span class="koboSpan" id="kobo.749.1"> – try it. </span><span class="koboSpan" id="kobo.749.2">You should be able to see the index </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">page again:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer070">
<span class="koboSpan" id="kobo.751.1"><img alt="Figure 9.14 – The authenticated index page" src="image/B19230_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.752.1">Figure 9.14 – The authenticated index page</span></p>
<p><span class="koboSpan" id="kobo.753.1">As our pièce de resistance, let’s add a logout link, but only to our index page. </span><span class="koboSpan" id="kobo.753.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">app/views/friends/index.html.erb</span></strong><span class="koboSpan" id="kobo.755.1"> file, and add this code to the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.756.1">the file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.757.1">
…
&lt;%= form_with model: @user, url: destroy_user_session_path, method: :delete do |form| %&gt;
  &lt;%= form.submit "Sign out" %&gt;
&lt;% end %&gt;</span></pre> <p><span class="koboSpan" id="kobo.758.1">Now, the form looks fairly familiar. </span><span class="koboSpan" id="kobo.758.2">Devise uses the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">form_with</span></strong><span class="koboSpan" id="kobo.760.1"> helper to build a form to log out with. </span><span class="koboSpan" id="kobo.760.2">Let’s go back to our browser and refresh the index view. </span><span class="koboSpan" id="kobo.760.3">It will look </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer071">
<span class="koboSpan" id="kobo.762.1"><img alt="Figure 9.15 – The index page with a Sign out button" src="image/B19230_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.763.1">Figure 9.15 – The index page with a Sign out button</span></p>
<p><span class="koboSpan" id="kobo.764.1">We now have a </span><strong class="bold"><span class="koboSpan" id="kobo.765.1">Sign out</span></strong><span class="koboSpan" id="kobo.766.1"> button. </span><span class="koboSpan" id="kobo.766.2">If we click it, our session ends, and we are redirected to the login page again. </span><span class="koboSpan" id="kobo.766.3">We can log in again using the credentials we created a few </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1">steps back.</span></span></p>
<p><span class="koboSpan" id="kobo.768.1">Congratulations! </span><span class="koboSpan" id="kobo.768.2">Our</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.769.1"> work here is done. </span><span class="koboSpan" id="kobo.769.2">As always, there is room for improvement and further learning. </span><span class="koboSpan" id="kobo.769.3">This gem is super handy and has helped me solve the authentication piece of an application many times. </span><span class="koboSpan" id="kobo.769.4">One thing (among so many) that you may have noticed is that even though this gem uses session values to handle the authentication, you never see these session values, and you never handle them directly. </span><span class="koboSpan" id="kobo.769.5">That is the Rails way of doing things. </span><span class="koboSpan" id="kobo.769.6">We always tend to hide the session layer of an application with helpers. </span><span class="koboSpan" id="kobo.769.7">Devise comes with some helpers that will help you within your code to show or hide components, depending on your authentication status. </span><span class="koboSpan" id="kobo.769.8">You may want to check the </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">user_signed_in?</span></strong><span class="koboSpan" id="kobo.771.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">current_user</span></strong><span class="koboSpan" id="kobo.773.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.774.1">user_session</span></strong><span class="koboSpan" id="kobo.775.1"> helpers on the Devise documentation page. </span><span class="koboSpan" id="kobo.775.2">Additionally, you can add several other customizations that you may want to add to your authentication mechanism. </span><span class="koboSpan" id="kobo.775.3">Be sure to play around with the gem, and learn on your own what other configurations might be useful </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">to you.</span></span></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.777.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.778.1">Wow! </span><span class="koboSpan" id="kobo.778.2">We covered a lot of ground in this chapter. </span><span class="koboSpan" id="kobo.778.3">We learned how to load data from a model to a controller to finally show data on the view. </span><span class="koboSpan" id="kobo.778.4">We also learned how to interact with forms and impact the database with the MVC architecture of Rails. </span><span class="koboSpan" id="kobo.778.5">Last but not least, we learned how to integrate the Devise gem with our application to leverage our authentication mechanism, instead of building one </span><span class="No-Break"><span class="koboSpan" id="kobo.779.1">from scratch.</span></span></p>
<p><span class="koboSpan" id="kobo.780.1">Now, we are ready for our last chapter, where we’ll explore some additional information regarding hosting our Rails application on </span><span class="No-Break"><span class="koboSpan" id="kobo.781.1">a server.</span></span></p>
</div>
</body></html>