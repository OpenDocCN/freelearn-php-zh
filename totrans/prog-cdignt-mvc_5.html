<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Helpers"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Helpers</h1></div></div></div><p>This chapter covers the CI helpers topic, the different types of helpers, and their different usage categories, with several code examples of web applications. CI provides us with built-in helpers, enables us to integrate third-party helpers, and enables us to develop new helpers and share them with the community if we wish to. The CI helpers<a id="id171" class="indexterm"/> are powering CI efficiency and code reusability by enabling all other CI controllers using the same code instead of defining a helper function locally.</p><p>A helper file<a id="id172" class="indexterm"/> is a collection of independent procedural functions in a particular category. Each helper function performs one specific task, with no dependence on other functions. The chapter will elaborate on the CI helper's concept, definition, and usage with several examples.</p><p>The folder <code class="literal">system/helpers</code> contains the CI system's built-in helpers. The folder <code class="literal">application/helpers</code> contains all the additional helper files of CI helpers. They can be third-party helpers or created by the developer.</p><p>This chapter will primarily focus on:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CI helpers' scope and usage<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Usage categories</li><li class="listitem" style="list-style-type: disc">Using a helper</li><li class="listitem" style="list-style-type: disc">Adding a helper to the project</li><li class="listitem" style="list-style-type: disc">Loading a helper</li><li class="listitem" style="list-style-type: disc">Using helper methods</li></ul></div></li><li class="listitem" style="list-style-type: disc">The available CI helpers</li><li class="listitem" style="list-style-type: disc">Examples<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example 1: using a built-in helper</li><li class="listitem" style="list-style-type: disc">Example 2: using third-party helpers—SSL helper</li><li class="listitem" style="list-style-type: disc">Example 3: building our own helper—the <code class="literal">my_download</code> helper</li></ul></div></li></ul></div><p>We will begin by briefly reviewing what a helper is in a CI framework, and how we can use it for our needs across the project code resources.</p><div class="section" title="CI helpers' scope and usage"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec33"/>CI helpers' scope and usage</h1></div></div></div><p>The CI helper does not have<a id="id173" class="indexterm"/> access to the controller resources by default unless CI and <code class="literal">get_instance()</code> are called<a id="id174" class="indexterm"/> and used to access CI resources.</p><p>We can extend the CI helper using third-party helpers from the CI system' or we can develop our own helper.</p><p>Any application helper should be located under <code class="literal">application/helpers/</code> in the project directory.</p><p>The helper file must be in the following format:</p><div class="informalexample"><pre class="programlisting">  application/helpers/&lt;HELPER_NAME&gt;_helper.php</pre></div><p>For example, the SSL helper file should appear as <code class="literal">application/helpers/ssl_helper.php</code>.</p><p>The helper integration and usage <a id="id175" class="indexterm"/>within the CI project is as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add the helper code resources to <code class="literal">application/helpers/myhelper_helper.php</code></li><li class="listitem" style="list-style-type: disc">Load the helper automatically or via the controller<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Automatically load a helper <code class="literal">myhelper</code> for all CI projects as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$autoload['helper'] = array('url','myhelper');</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">For loading in certain specific controllers, constructors, or methods, use the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$this-&gt;load-&gt;helper('myhelper'); </strong></span>
</pre></div></li></ul></div></li><li class="listitem" style="list-style-type: disc">Use the following helper methods:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$result = $this-&gt;myhelper-&gt;called_method($param1, aram2);</strong></span>
</pre></div></li></ul></div><div class="section" title="Available CI helpers"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec44"/>Available CI helpers</h2></div></div></div><p>CI and the CI developers community<a id="id176" class="indexterm"/> network provide many helpers, covering a rich set of topics. We will review CI helpers as well as popular resources for third-party CI helpers.</p><p>We are also encouraged to build our own helpers, which can be used by others, and share them with the following communities:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">Git</code> community: <a class="ulink" href="https://github.com">https://github.com</a></li><li class="listitem" style="list-style-type: disc">CI forums<a id="id177" class="indexterm"/> <a class="ulink" href="http://codeigniter.com/forums/">http://codeigniter.com/forums/</a></li></ul></div><div class="section" title="CI system helpers"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec07"/>CI system helpers</h3></div></div></div><p>The list of CI built-in <a id="id178" class="indexterm"/>helpers <a id="id179" class="indexterm"/>is as follows (they can be found in the <code class="literal">CI Directory Tree</code> by going to <code class="literal">system/helpers/</code>):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Array Helper</li><li class="listitem" style="list-style-type: disc">CAPTCHA Helper</li><li class="listitem" style="list-style-type: disc">Cookie Helper</li><li class="listitem" style="list-style-type: disc">Date Helper</li><li class="listitem" style="list-style-type: disc">Directory Helper</li><li class="listitem" style="list-style-type: disc">Download Helper</li><li class="listitem" style="list-style-type: disc">Email Helper</li><li class="listitem" style="list-style-type: disc">File Helper</li><li class="listitem" style="list-style-type: disc">Form Helper</li><li class="listitem" style="list-style-type: disc">HTML Helper</li><li class="listitem" style="list-style-type: disc">Inflector Helper</li><li class="listitem" style="list-style-type: disc">Language Helper</li><li class="listitem" style="list-style-type: disc">Number Helper</li><li class="listitem" style="list-style-type: disc">Path Helper</li><li class="listitem" style="list-style-type: disc">Security Helper</li><li class="listitem" style="list-style-type: disc">Smiley Helper</li><li class="listitem" style="list-style-type: disc">String Helper</li><li class="listitem" style="list-style-type: disc">Text Helper</li><li class="listitem" style="list-style-type: disc">Typography Helper</li><li class="listitem" style="list-style-type: disc">URL <a id="id180" class="indexterm"/>Helper</li><li class="listitem" style="list-style-type: disc">XML <a id="id181" class="indexterm"/>Helper</li></ul></div></div><div class="section" title="CI third-party helpers"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec08"/>CI third-party helpers</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ssl_helper.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">html_manipulator_helper.php</code></li></ul></div></div></div></div></div>
<div class="section" title="Example 1 &#x2013; using built-in helpers"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec34"/>Example 1 – using built-in helpers</h1></div></div></div><p>In this example, we will see how to use<a id="id182" class="indexterm"/> CI build-in helpers. For this example, we will use the URL helper for generating links. The URL helper file contains functions that assist in working with URLs. We will use the URL <a id="id183" class="indexterm"/>helper function <code class="literal">site_url()</code>, which returns the site URL as specified in the config file.</p><p>This example will be constructed from either of the following controllers:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">application/controllers/ helperexample1.php</code><p>This controller loads the built-in CI helper URL.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$this-&gt;load-&gt;helper('url'); </strong></span>
</pre></div><p>The controller renders a view named <span class="strong"><strong>helper-example1-view</strong></span></p></li><li class="listitem" style="list-style-type: disc"><code class="literal">application/views/helper-example1-view.php</code><p>This view will use the URL helper to generate links in the view file</p><p>Let us assume the URLs to the project root are as follows: <code class="literal">http://mydomain.com/myproject</code>. <code class="literal">http://mydomain.com/myproject/helperexample1</code></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>The source code is provided with this book via URLs.</p></div></div></li></ul></div><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec45"/>The controller file</h2></div></div></div><p>Now we will see how the<a id="id184" class="indexterm"/> controller loads the built-in CI URL helper so the view file will be able to use the URL helper function <code class="literal">site_url</code>, which generates the links.</p><div class="informalexample"><pre class="programlisting">
class Helperexample1 extends CI_Controller {
  /**
   * Index Page for this controller.
   *
   * Maps to the following URL
   *     http://example.com/index.php/welcome
   *  - or -  
   *     http://example.com/index.php/welcome/index
   *  - or -
   * Since this controller is set as the default controller in 
   * config/routes.php, it's displayed at http://example.com/
   *
   * So any other public methods not prefixed with an underscore
       *  will
   * map to /index.php/welcome/&lt;method_name&gt;
   * @see http://codeigniter.com/user_guide/general/urls.html
   */
    public function index()
    {
  	      	  // Loading the url helper
  	      	  $this-&gt;load-&gt;helper('url');
         $this-&gt;load-&gt;view('helper-example1-view');
    }
  }
/* End of file helperexample1.php */
/* Location: ./application/controllers/helperexample1 */
</pre></div></div><div class="section" title="The view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec46"/>The view file</h2></div></div></div><p>The view file <a id="id185" class="indexterm"/>calls the URL helper function <code class="literal">site_url</code>. Since the controller loaded the URL helper, it's recognized by the view.</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8"&gt;
  &lt;title&gt;Menu&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href="&lt;?php echo site_url('welcome'); ?&gt;"&gt;Welcome&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href="&lt;?php echo site_url('example2/more/1/2/3');      ?&gt;"&gt;Example2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></div></div>
<div class="section" title="Example 2 &#x2013; SSL helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Example 2 – SSL helper</h1></div></div></div><p>In this example, we will use the CI third-party SSL helper<a id="id186" class="indexterm"/> to enforce an https or HTTP URI request and response between CI and the browser. This example will be constructed from the following helpers:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">application/helpers/ssl_helper.php</code>: The CI helper for SSL that implements SSL on the links.</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/controllers/helpersslexample.php</code>: This controller loads the helper and implements SSL on the links. The helper is loaded in the constructor.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$this-&gt;load-&gt;helper('ssl');    </strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">application/views/helper-ssl-view.php</code>: This is the rendered view that SSL is implemented on.</li></ul></div><p>Let us assume the <a id="id187" class="indexterm"/>URI to the project root is <code class="literal">http://mydomain.com/myproject</code>. <code class="literal">http://mydomain.com/myproject/helpersslexample</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>The source code is provided with this book via URLs.</p></div></div><div class="section" title="The helper file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec47"/>The helper file</h2></div></div></div><p>This CI helper file<a id="id188" class="indexterm"/> implements the services described in the preceding section. This helper uses the built-in CI URL library and URL helper using the redirect CI URL helper function.</p><div class="informalexample"><pre class="programlisting">  &lt;?php if ( ! defined('BASEPATH')) exit('No direct script access  allowed');
  if (!function_exists('force_ssl')) {function force_ssl(){ // get the CI instance to access the CI resources  $CI =&amp; get_instance();// Change the base_url to have https prefix  
      $CI-&gt;config-&gt;config['base_url'] =str_replace('http://', 'https://',$CI-&gt;config-&gt;config['base_url']);
            if ($_SERVER['SERVER_PORT'] != 443){     // redirect CI to use https URI
        // so that ($CI-&gt;uri-&gt;uri_string() return 
        // the current URI with https prefix
              redirect($CI-&gt;uri-&gt;uri_string());}}}
  if (!function_exists('remove_ssl')) {function remove_ssl(){$CI =&amp; get_instance();
      // Change the base_url to have http prefix  
      $CI-&gt;config-&gt;config['base_url'] =str_replace('https://', 'http://',$CI-&gt;config-&gt;config['base_url']);
      if ($_SERVER['SERVER_PORT'] != 80){// redirect CI to use http URI
        // so that ($CI-&gt;uri-&gt;uri_string() return 
        // the current URI with http prefix
              redirect($CI-&gt;uri-&gt;uri_string());}}}</pre></div></div><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec48"/>The controller file</h2></div></div></div><p>Now we will see <a id="id189" class="indexterm"/>how the controller loads the SSL helper and calls its function <code class="literal">force_ssl</code> to enforce the HTTPS URI request and response with the browser.</p><div class="informalexample"><pre class="programlisting">class Helpersslexample extends CI_Controller {
    public function __construct() {
      parent::__construct();
      // Loading the ssl helper
      $this-&gt;load-&gt;helper('ssl');		
      // Enforce URI request of https 
      force_ssl();
    }  
    /**
      * Index Page for this controller.
      *
      */
    public function index()
    {
      $this-&gt;load-&gt;helper('url');
      $this-&gt;load-&gt;view('helper-ssl-view');
    }
  }
/* End of file helpersslexample.php */
/* Location: ./application/controllers/helpersslexample */
</pre></div></div><div class="section" title="The view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec49"/>The view file</h2></div></div></div><p>The <a id="id190" class="indexterm"/>view file code is as follows:</p><div class="informalexample"><pre class="programlisting">
  &lt;!DOCTYPE html&gt;
  &lt;html lang="en"&gt;
  &lt;head&gt;
  &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Menu&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;table&gt;
  &lt;tr&gt;
    &lt;td&gt;
    &lt;a href="&lt;?php echo site_url('welcome'); ?&gt;"&gt;
    Welcome - You are using https
    &lt;/a&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
     &lt;td&gt;&lt;a href="&lt;?php echo site_url('example2/more/1/2/3'); 	   
           ?&gt;"&gt;Example2&lt;/a&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;
  &lt;/body&gt;
  &lt;/html&gt;</pre></div></div></div>
<div class="section" title="Example 3 &#x2013; building your own helper"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Example 3 – building your own helper</h1></div></div></div><p>This example uses a helper <a id="id191" class="indexterm"/>to download a very large file, of 200 MB, which can't be downloaded in one file reading.</p><p>This example will be constructed from the following helpers:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">application/helpers/my_download_helper.php</code>: This is the CI helper that is used to download a very large file</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/controllers/classg2.php</code>: This is the controller that uses the <code class="literal">my_download</code> helper</li><li class="listitem" style="list-style-type: disc"><code class="literal">application/views/classg2view.php</code>: This is the view that has a link for the file download</li></ul></div><p>Let us assume that the URI to the project root is <code class="literal">http://mydomain.com/myproject</code>. Hence the URI to execute the <code class="literal">auth</code> controller for login will be <code class="literal">http://mydomain.com/myproject/classg2</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>The source code is provided with this book via URLs.</p></div></div><div class="section" title="The helper file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec50"/>The helper file</h2></div></div></div><p>This helper<a id="id192" class="indexterm"/> is used to download very large files, which can't be downloaded in one file reading. Its function, <code class="literal">download_large_files</code>, reads 1 MB in each loop until it downloads the whole file.</p><div class="informalexample"><pre class="programlisting">  &lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access           allowed');
  /*** CodeIgniter Download Helpers** @package  CodeIgniter* @subpackage Helpers* @category	Helpers* @author Yehuda Zadik*/ 
    // --------------------------------------------------------------
  	/*** Download large files** Generates headers that force a download to happen** @access  public* @param	string	$fullPath* @return	void*/ 
    function download_large_files($fullPath){
    // File Exists? if( file_exists($fullPath) ){ 
      // Parse Info / Get Extension $fsize = filesize($fullPath); $path_parts = pathinfo($fullPath); $ext = strtolower($path_parts["extension"]); 
      // Determine Content Type 
      switch ($ext) { 
        case "pdf": $ctype = "application/pdf"; break; 
        case "exe": $ctype = "application/octet-stream";
         break; 
        case "zip": $ctype = "application/zip";
          break; 
        case "doc": $ctype = "application/msword"; break; 
    
        case "xls":$ctyp = "application/vnd.ms-excel";
             break;
        case "ppt": $ctype = "application/vnd.ms-powerpoint";
           break; 
     
        case "wmv": $ctype = "video/x-ms-wmv";
             break;
               case "gif": $ctype = "image/gif";
             break;
               case "png": $ctype = "image/png";
               break;
     
        case "jpeg":case "jpg": $ctype = "image/jpg"; 
                break;
               
        default: $ctype = "application/force-download"; 
      } 
      $file_handle = fopen($fullPath, "rb");          
      header('Content-Description: File Transfer');
        header("Content-Type: " . $ctype);            header('Content-Length: ' . $fsize);
    
        header('Content-Disposition: attachment; filename=' .
                 basename($fullPath));
      while(!feof($file_handle)) {$buffer = fread($file_handle, 1*(1024*1024));
        echo $buffer;          ob_flush();flush();    //These two flush commands seem to             have helped with performance
      }    
      fclose($file_handle);
    } else{die('File Not Found');
    } 
  }
  /* End of file my_download_helper.php *//* Location: ./application/helpers/my_download_helper.php */</pre></div></div><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec51"/>The controller file</h2></div></div></div><p>The controller<a id="id193" class="indexterm"/> loads the helper <code class="literal">my_download</code> and calls its function, <code class="literal">download_large_files,</code> in order to enable the user to download large files that originally could not be downloaded, using the <code class="literal">my_download</code> helper.</p><div class="informalexample"><pre class="programlisting">  &lt;?php 
  class Classg2 extends CI_Controller {
    public function index()
    {
      $this-&gt;load-&gt;helper('url');  
      $this-&gt;load-&gt;view('classg2view');
      }  
    function download(){
      // Loading the helpers url, my_download
      $this-&gt;load-&gt;helper(array('url', 'my_download'));        // FCPATH is a constant that Codeigniter sets which       // contains the absolute path to index.php 
      $fullPath = FCPATH . 'files/movie-classg2.wmv';
      // Using the helper my_download function to download       // a very large filedownload_large_files($fullPath);
    }
  }  
  /* End of file classg2.php *//* Location: ./application/controllers/classg2.php */</pre></div></div><div class="section" title="The view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec52"/>The view file</h2></div></div></div><p>The view file<a id="id194" class="indexterm"/> displays the data that contains a link for downloading the very large file.</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
 &lt;meta charset="utf-8"&gt;
 &lt;title&gt;Download large file&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="container"&gt;
 &lt;a href="&lt;?php echo base_url("classg2/download")              ?&gt;"&gt;Download large file&lt;/a&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Summary</h1></div></div></div><p>In this chapter we have reviewed the CI helpers, scope, the different types of built-in CI system helpers, third-party helpers, and how to build our own helpers. We also reviewed the steps to load and use helpers in our project. Finally, we saw several relevant usage examples, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example 1: using build-in helpers</li><li class="listitem" style="list-style-type: disc">Example 2: using third-party helpers— SSL helper</li><li class="listitem" style="list-style-type: disc">Example 3: building our own helper—<code class="literal">my_download</code> helper</li></ul></div></div></body></html>