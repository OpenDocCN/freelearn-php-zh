- en: Chapter 10. Deployment
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章 部署
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍以下菜谱：
- en: Changing the Yii directory layout
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 修改Yii目录布局
- en: Moving an application webroot
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 移动应用程序webroot
- en: Changing an advanced application template
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 修改高级应用程序模板
- en: Moving configuration parts into separate files
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将配置部分移动到单独的文件中
- en: Using multiple configurations to simplify the deployment
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用多个配置来简化部署
- en: Implementing and executing cron jobs
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实现和执行cron作业
- en: Maintenance mode
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维护模式
- en: Deployment tools
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 部署工具
- en: Introduction
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: In this chapter, we will cover various tips that are especially useful during
    application deployment; these tips will also come in handy when developing an
    application in a team or when you just want to make your development environment
    more comfortable.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍一些特别有用的提示，这些提示在应用程序部署期间非常有用；这些提示在团队开发应用程序或只是想要使你的开发环境更舒适时也非常有用。
- en: Changing the Yii directory layout
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 修改Yii目录布局
- en: By default, we have the Basic and Advanced Yii2 application skeletons with different
    directory structures. But these structures are not dogmatic, and we can customize
    them if required.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，我们有基本的和高级的Yii2应用程序骨架，具有不同的目录结构。但这些结构并非教条，如果需要，我们可以自定义它们。
- en: For example, we can move the runtime directory out of the project.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以将运行时目录从项目中移出。
- en: Getting ready
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer the package
    manager, as described in the official guide at [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Composer包管理器创建一个新的`yii2-app-basic`应用程序，如官方指南中所述[http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html)。
- en: How to do it...
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Changing the location of the runtime directory
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修改运行时目录位置
- en: 'Open `config/web.php` and `config/console.php` and define the `runtimePath`
    parameter:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 打开`config/web.php`和`config/console.php`并定义`runtimePath`参数：
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Move the runtime directory to the new location.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 将运行时目录移动到新位置。
- en: Changing the location of the vendor directory
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修改供应商目录位置
- en: 'Open `config/web.php` and `config/console.php` and define the `vendorPath`
    parameter:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`config/web.php`和`config/console.php`并定义`vendorPath`参数：
- en: '[PRE1]'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Move the `vendor` directory with the `composer.json` and `composer.lock` files
    to the new location.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将包含`composer.json`和`composer.lock`文件的`vendor`目录移动到新位置。
- en: 'Open the `web/index.php` and `yii` files and find these rows:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`web/index.php`和`yii`文件，并找到以下行：
- en: '[PRE2]'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Change the including paths.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改包含路径。
- en: Changing the location of the controllers
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修改控制器位置
- en: Rename the `commands` directory to `console`.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`commands`目录重命名为`console`。
- en: Change the namespace of `app\commands\HelloController` to `app\console\HelloController`.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`app\commands\HelloController`的命名空间更改为`app\console\HelloController`。
- en: 'Open `config/console.php` and redefine the `controllerNamespace` parameter:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`config/console.php`并重新定义`controllerNamespace`参数：
- en: '[PRE3]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Changing the locations of the views directory
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修改视图目录位置
- en: 'Open `config/web.php` and define `viewPath` parameter:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`config/web.php`并定义`viewPath`参数：
- en: '[PRE4]'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Rename your `views` directory.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重命名你的`views`目录。
- en: How it works...
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In the `yii\base\Application::preInit` method our application defines `basePath`,
    `runtimePath`, and `vendorPath` parameters.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在`yii\base\Application::preInit`方法中，我们的应用程序定义了`basePath`、`runtimePath`和`vendorPath`参数。
- en: By default, these values lead to the root application directory, `runtime` and
    `vendor` path in the root respectively.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，这些值指向根应用程序目录、根目录中的`runtime`和`vendor`路径。
- en: For example, you can redefine `vendorPath` if you want to share the vendor directory
    with some instances of the same projects. But take care of the package's versions
    compatibility.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想与同一项目的某些实例共享供应商目录，可以重新定义`vendorPath`。但请注意包的版本兼容性。
- en: 'The `yii\base\Application` class extends `yii\base\Module`, which contains
    the `controllerNamespace` and `viewPath` parameters. The first one allows you
    to change the base namespace of the application and modules. It is helpful if
    you want to provide frontend and backend controllers in the same module directory.
    Just change the `controllers` directory to frontend and backend or create subdirectories
    and configure your frontend and backend applications:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '`yii\base\Application`类扩展了`yii\base\Module`，其中包含`controllerNamespace`和`viewPath`参数。第一个参数允许你更改应用程序和模块的基本命名空间。如果你想在同一个模块目录中提供前端和后端控制器，这将很有帮助。只需将`controllers`目录更改为前端和后端，或者创建子目录并配置你的前端和后端应用程序：'
- en: '[PRE5]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: See also
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: In order to learn more about application structures, refer to [http://www.yiiframework.com/doc-2.0/guide-structure-applications.html](http://www.yiiframework.com/doc-2.0/guide-structure-applications.html).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解更多关于应用程序结构的信息，请参阅[http://www.yiiframework.com/doc-2.0/guide-structure-applications.html](http://www.yiiframework.com/doc-2.0/guide-structure-applications.html)。
- en: Moving an application webroot
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 移动应用程序 webroot
- en: By default, Yii2 applications work from the `web` directory for your site's
    entry script. But shared hosting environments are often quite limited when it
    comes to the configuration and directory structure. You cannot change the working
    directory for your site. Most servers provide only the `public_html` directory
    for your site entry scripts.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Yii2 应用程序从 `web` 目录运行你的网站入口脚本。但是，共享主机环境在配置和目录结构方面通常非常有限。你不能更改你网站的运行目录。大多数服务器只为你的网站入口脚本提供
    `public_html` 目录。
- en: Getting ready
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer package manager,
    as described in the official guide at [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html).
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 使用官方指南中描述的 Composer 包管理器创建一个新的 `yii2-app-basic` 应用程序，官方指南请见[http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html)。
- en: How to do it...
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Let's discuss the ways to move an application webroot.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们讨论移动应用程序 webroot 的方法。
- en: Placing files in the root
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将文件放置在根目录
- en: Upload the application files into your hosting.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序文件上传到你的主机。
- en: Rename the `web` directory to `public_html`.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `web` 目录重命名为 `public_html`。
- en: Check that the site works correctly.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认网站运行正常。
- en: Placing files in a subdirectory
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将文件放置在子目录
- en: 'A hosting user directory may contain other files and folders. Here''s how you
    can move files to a subdirectory:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 主机用户目录可能包含其他文件和文件夹。以下是你可以将文件移动到子目录的方法：
- en: Create the `application` and `public_html` directories.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 `application` 和 `public_html` 目录。
- en: Move the application files to the `application` directory.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序文件移动到 `application` 目录。
- en: Move the content of the `application/web` directory to `public_html`.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `application/web` 目录的内容移动到 `public_html`。
- en: 'Open the `public_html/index.php` file and change the include paths:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 `public_html/index.php` 文件并更改包含路径：
- en: '[PRE6]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: How it works...
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The Yii2 application automatically sets the `@web` and `@webroot` alias paths
    on the base of the entry script location. Therefore we can easily move or rename
    a `web` directory without changing the application configurations.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: Yii2 应用程序会自动基于入口脚本的位置设置 `@web` 和 `@webroot` 别名路径。因此，我们可以轻松地移动或重命名 `web` 目录而无需更改应用程序配置。
- en: 'For `yii2-app-advanced`, you can move the `web` directory content from `backend`
    to a subdirectory, such as `admin`:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 `yii2-app-advanced`，你可以将 `web` 目录的内容从 `backend` 移动到子目录，例如 `admin`：
- en: '[PRE7]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: See also
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: To get more information on installing Yii on a shared hosting environment, refer
    to [http://www.yiiframework.com/doc-2.0/guide-tutorial-shared-hosting.html](http://www.yiiframework.com/doc-2.0/guide-tutorial-shared-hosting.html).
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取在共享主机环境中安装 Yii 的更多信息，请参阅[http://www.yiiframework.com/doc-2.0/guide-tutorial-shared-hosting.html](http://www.yiiframework.com/doc-2.0/guide-tutorial-shared-hosting.html)。
- en: Changing an advanced application template
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 修改高级应用程序模板
- en: By default, Yii2's Advanced template has `console`, `frontend`, and `backend`
    applications. However, in your specific case, you can rename the existing ones
    and create your own applications. For example you can add the `api` application
    if you develop an API for your site.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Yii2 的高级模板包含 `console`、`frontend` 和 `backend` 应用程序。然而，在你的特定情况下，你可以重命名现有的应用程序并创建自己的应用程序。例如，如果你为你的网站开发
    API，你可以添加 `api` 应用程序。
- en: Getting ready
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-advanced` project by using the Composer package manager,
    as described in the official guide at [https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/start-installation.md](https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/start-installation.md).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 使用官方指南中描述的 Composer 包管理器创建一个新的 `yii2-app-advanced` 项目，官方指南请见[https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/start-installation.md](https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/start-installation.md)。
- en: How to do it...
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Copy the `backend` directory content to a new `api` directory in the root of
    your application.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `backend` 目录的内容复制到应用程序根目录下的新 `api` 目录。
- en: 'Open the `api/config/main.php` file and change the `controllerNamespace` option
    value:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 `api/config/main.php` 文件并更改 `controllerNamespace` 选项的值：
- en: '[PRE8]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Open `api/assets/AppAsset.php` and `api/controllers/SiteController.php` and
    change the namespaces from `backend` to `api` like this:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`api/assets/AppAsset.php`和`api/controllers/SiteController.php`，并将命名空间从`backend`更改为`api`，如下所示：
- en: '[PRE9]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Open the `api/views/layouts/main.php` file and find the following row:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`api/views/layouts/main.php`文件，找到以下行：
- en: '[PRE10]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Change it to this:'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 更改为这个：
- en: '[PRE11]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Open `common/config/bootstrap.php` and add the `@api` alias for the new application:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`common/config/bootstrap.php`并为新应用程序添加`@api`别名：
- en: '[PRE12]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Open the `environments` directory, and in the `dev` and `prod` subdirectories
    make the `api` directories copies of `backend`.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`environments`目录，并在`dev`和`prod`子目录中将`api`目录复制为`backend`。
- en: 'Open the `environments/index.php` file and add rows for the `api` application:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`environments/index.php`文件并为`api`应用程序添加行：
- en: '[PRE13]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now you have the `console`, `frontend`, `backend`, and `api` applications.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您有了`console`、`frontend`、`backend`和`api`应用程序。
- en: How it works...
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The Advanced application template is a set of applications with custom aliases,
    such as `@frontend`, `@backend`, `@common`, and `@console` and corresponding namespaces
    instead of the simple `@app` alias for the `Basic` template.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 高级应用程序模板是一组具有自定义别名的应用程序，例如`@frontend`、`@backend`、`@common`和`@console`，以及相应的命名空间，而不是`Basic`模板中的简单`@app`别名。
- en: You can easily add, remove, or rename this applications (with their aliases
    and namespaces) if needed.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，您可以轻松地添加、删除或重命名这些应用程序（包括它们的别名和命名空间）。
- en: See also
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: For getting more information about the usage of application directory structures
    refer to [https://github.com/yiisoft/yii2-app-advanced/tree/master/docs/guide](https://github.com/yiisoft/yii2-app-advanced/tree/master/docs/guide).
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 若想了解更多关于应用程序目录结构的使用信息，请参阅[https://github.com/yiisoft/yii2-app-advanced/tree/master/docs/guide](https://github.com/yiisoft/yii2-app-advanced/tree/master/docs/guide)。
- en: Moving configuration parts into separate files
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将配置部分移动到单独的文件中
- en: In the basic application template we have separated web and console configuration
    files. And usually we set some application components in the both the configuration
    files.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在基本应用程序模板中，我们已经将Web和控制台配置文件分开。通常，我们在两个配置文件中设置一些应用程序组件。
- en: Moreover, when we develop a big application, we may face some inconvenience.
    For example, if we need to adjust some settings, we would most probably end up
    repeating the changes in both the web application config and console application
    config.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，当我们开发大型应用程序时，可能会遇到一些不便。例如，如果我们需要调整一些设置，我们很可能会在Web应用程序配置和控制台应用程序配置中重复更改。
- en: Getting ready
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer package manager,
    as described in the official guide at [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html).
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用Composer包管理器创建一个新的`yii2-app-basic`应用程序，如官方指南中所述[http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html)。
- en: How to do it...
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Open the `config/web.php` file and add the `urlManager` section to the components
    configuration:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`config/web.php`文件并在组件配置中添加`urlManager`部分：
- en: '[PRE14]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Create the `config/urlRules.php` file and move rules array into it:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`config/urlRules.php`文件并将规则数组移动到其中：
- en: '[PRE15]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Replace the rule array with the file that requires this:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将规则数组替换为需要此文件的文件：
- en: '[PRE16]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: How it works...
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The preceding technique relies on the fact that Yii configuration files are
    native PHP files with arrays:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 上述技术依赖于Yii配置文件是本地的PHP文件，包含数组：
- en: '[PRE17]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Let''s look at the `require` construct:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看`require`结构：
- en: '[PRE18]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: When we use this, it reads the file specified, and, if there is a `return` statement
    inside this file, it returns a value.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们使用这个时，它会读取指定的文件，如果这个文件中有`return`语句，它会返回一个值。
- en: Therefore, moving a part out of the main configuration file into a separate
    file requires creating a separate file, moving the configuration part into it
    right after the `return` statement, and using `require` in the main configuration
    file.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，将一部分从主配置文件移出并放入单独的文件中需要创建一个单独的文件，将配置部分移动到`return`语句之后，并在主配置文件中使用`require`。
- en: If separate applications (in our example, these are web applications and console
    applications) require some common configuration parts, then we can use `require`
    to move them into a separate file.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果单独的应用程序（在我们的例子中，这些是Web应用程序和控制台应用程序）需要一些共同的配置部分，那么我们可以使用`require`将它们移动到一个单独的文件中。
- en: See also
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: 'In order to learn more about PHP `require` and `include` statements, refer
    to the following URLs:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解更多关于PHP `require`和`include`语句的信息，请参阅以下URL：
- en: '[http://php.net/manual/en/function.require.php](http://php.net/manual/en/function.require.php)'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://php.net/manual/en/function.require.php](http://php.net/manual/en/function.require.php)'
- en: '[http://php.net/manual/en/function.include.php](http://php.net/manual/en/function.include.php)'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://php.net/manual/en/function.include.php](http://php.net/manual/en/function.include.php)'
- en: Using multiple configurations to simplify the deployment
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用多个配置简化部署
- en: 'The Advanced application template uses different configuration files for each
    of its applications:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 高级应用程序模板为每个应用程序使用不同的配置文件：
- en: '[PRE19]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Each entry `web/index.php` script merges own set of configuration files:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 每个`web/index.php`脚本合并自己的配置文件集：
- en: '[PRE20]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Each `config/main.php` file merges parameters:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 每个`config/main.php`文件合并参数：
- en: '[PRE21]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: This system allows you to configure both common and specific application properties
    and components of our applications. And we can store default configuration files
    on the version control system and ignore all the `*-local.php` files.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 这个系统允许你配置我们应用程序的公共和特定属性以及组件。我们可以在版本控制系统上存储默认配置文件，并忽略所有`*-local.php`文件。
- en: All local files templates are prepared in the `environments` directory. When
    you run `php init` in your console and choose a needle environment, this initialization
    script makes copies of the corresponded files and places them into target folders.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 所有本地文件模板都在`environments`目录中准备。当你通过控制台运行`php init`并选择一个针环境时，这个初始化脚本会复制相应的文件并将它们放置到目标文件夹中。
- en: 'But the Basic application template does not contain an agile configuration
    system and provides only the following files:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 但基本应用程序模板不包含敏捷配置系统，只提供了以下文件：
- en: '[PRE22]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Let's try to add an advanced configuration system to the `yii2-app` `-basic`
    application template.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们尝试向`yii2-app` `-basic`应用程序模板添加一个高级配置系统。
- en: Getting ready
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer package manager,
    as described in the official guide at [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html).
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 按照官方指南使用Composer包管理器创建一个新的`yii2-app-basic`应用程序，如[http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html)中所述。
- en: How to do it...
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'Create the `config/common.php` file:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`config/common.php`文件：
- en: '[PRE23]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Create the `config/common-local` file:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`config/common-local`文件：
- en: '[PRE24]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Remove the `config/db.php` file.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移除`config/db.php`文件。
- en: 'Remove repetitive code from `config/console.php`:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`config/console.php`中移除重复的代码：
- en: '[PRE25]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Create the `config/console-local.php` file with an empty array:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个空的`config/console-local.php`文件：
- en: '[PRE26]'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Change the `config/web.php` file:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改`config/web.php`文件：
- en: '[PRE27]'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Move the `request` configuration into `config/web-local.php`:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`request`配置移动到`config/web-local.php`：
- en: '[PRE28]'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Remove the e-mail ID from `config/params.php`:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`config/params.php`中移除电子邮件ID：
- en: '[PRE29]'
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Paste the ID into `config/params-local.php`:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将ID粘贴到`config/params-local.php`：
- en: '[PRE30]'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Remove the `dsn` string from `tests/codeception/config/config.php`:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`tests/codeception/config/config.php`中移除`dsn`字符串：
- en: '[PRE31]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Put the string into a new `tests/codeception/config/config-local.php` file:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将字符串放入新的`tests/codeception/config/config-local.php`文件：
- en: '[PRE32]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Add configuration merging to the `web/index.php` file:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将配置合并添加到`web/index.php`文件：
- en: '[PRE33]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Add configuration merging to the console entry script, `yii`:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将配置合并添加到控制台入口脚本`yii`：
- en: '[PRE34]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Add configuration merging to the testing configurations of the unit, functional,
    and acceptance tests from `tests/codeception/config`:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将配置合并添加到单元测试、功能测试和验收测试的测试配置中，从`tests/codeception/config`：
- en: '[PRE35]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Add configuration merging to the testing environment console''s entry script,
    `tests/codeception/bin/yii`:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将配置合并添加到测试环境控制台的入口脚本`tests/codeception/bin/yii`：
- en: '[PRE36]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'As a result, you must get the following content in your configuration directory:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结果，你必须在你的配置目录中得到以下内容：
- en: '[PRE37]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'After all, you can add a new `.gitignore` file with this content into your
    `config` and `tests/codeception/config` directories so you can ignore local configuration
    files by the Git version control system:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，你可以在`config`和`tests/codeception/config`目录中添加一个包含此内容的新的`.gitignore`文件，这样你就可以通过Git版本控制系统忽略本地配置文件。
- en: '[PRE38]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: How it works...
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: You can store common application components configuration in the `config/common.php`
    file and also set specific configurations for web and console applications. You
    can put your temporary and secure configuration data into the `*-local.php` files.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在`config/common.php`文件中存储公共应用程序组件配置，并为Web和命令行应用程序设置特定配置。你可以将你的临时和安全的配置数据放入`*-local.php`文件中。
- en: Also, you can copy the initialization shell script from `yii2-app-advanced`.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你也可以从`yii2-app-advanced`复制初始化shell脚本。
- en: 'Create a new `environments` directory and copy your templates into it:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的`environments`目录并将你的模板复制进去：
- en: '[PRE39]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Create the `environments/index.php` file with this code:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下代码创建`environments/index.php`文件：
- en: '[PRE40]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Remove the default `Installer::postCreateProject` configuration from your `composer.json`:'
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从你的`composer.json`中移除默认的`Installer::postCreateProject`配置：
- en: '[PRE41]'
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Copy the `init` and `init.bat` scripts from the Advanced template, [https://github.com/yiisoft/yii2-app-advanced](https://github.com/yiisoft/yii2-app-advanced)
    and you can run the initialization process using the command `php init` after
    the cloning of the project from the repository.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从高级模板[https://github.com/yiisoft/yii2-app-advanced](https://github.com/yiisoft/yii2-app-advanced)复制`init`和`init.bat`脚本，并在从仓库克隆项目后使用命令`php
    init`运行初始化过程。
- en: See also
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: For more information about application configurations refer to [http://www.yiiframework.com/doc-2.0/guide-concept-configurations.html](http://www.yiiframework.com/doc-2.0/guide-concept-configurations.html).
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 关于应用程序配置的更多信息，请参阅[http://www.yiiframework.com/doc-2.0/guide-concept-configurations.html](http://www.yiiframework.com/doc-2.0/guide-concept-configurations.html)。
- en: Implementing and executing cron jobs
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实现和执行cron作业
- en: Sometimes, an application requires some background tasks, such as regenerating
    a site map or refreshing statistics. A common way to implement this is by using
    cron jobs. When using Yii, there is a way to use a command to run as a job.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，应用程序需要一些后台任务，例如重新生成网站地图或刷新统计数据。实现这一点的常见方法是使用cron作业。当使用Yii时，有一种方法可以使用命令作为作业运行。
- en: In this recipe, we will see how to implement both. For our recipe, we will implement
    writing the current timestamp into a `t` `imestamp.txt` file under the protected
    directory.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将看到如何实现这两个。对于我们的菜谱，我们将实现将当前时间戳写入受保护目录下的`t` `imestamp.txt`文件。
- en: Getting ready
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer, as described
    in the official guide at [http://www.yiiframework.com/doc-2.0/guide-startinstallation.html](http://www.yiiframework.com/doc-2.0/guide-startinstallation.html).
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Composer创建一个新的`yii2-app-basic`应用程序，如官方指南中所述，[http://www.yiiframework.com/doc-2.0/guide-startinstallation.html](http://www.yiiframework.com/doc-2.0/guide-startinstallation.html)。
- en: How to do it...
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: Running the Hello command
  id: totrans-184
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 运行Hello命令
- en: 'Let us try to run `app\commands\HelloController::actionIndex` as a shell command:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们尝试将`app\commands\HelloController::actionIndex`作为一个shell命令来运行：
- en: '[PRE42]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Open the shell in your application directory and execute this command:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的应用程序目录中打开shell并执行此命令：
- en: '[PRE43]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Alternatively, you also can call the following and ensure that the shell works:'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 或者，你也可以调用以下内容并确保shell工作正常：
- en: '[PRE44]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Type the following command for the display `hello`:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令以显示`hello`：
- en: '[PRE45]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'The framework must display some information:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 框架必须显示一些信息：
- en: '[PRE46]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Run the default command action:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行默认命令动作：
- en: '[PRE47]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Alternatively, run the concrete `index` action:'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 或者，运行具体的`index`动作：
- en: '[PRE48]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'You must now see the default phrase:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你现在应该看到默认短语：
- en: '[PRE49]'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Run the command with any parameter and see the response:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用任何参数运行命令并查看响应：
- en: '[PRE50]'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Creating your own command
  id: totrans-203
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建自己的命令
- en: 'You also can create your own console controllers. For example, create a `commands/CronController.php`
    file with the sample code:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以创建自己的控制台控制器。例如，创建一个`commands/CronController.php`文件，包含以下示例代码：
- en: '[PRE51]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'After all is done, run the command in a shell:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 一切完成后，在shell中运行命令：
- en: '[PRE52]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Then, check the response text and the existence of a new file, namely `timestamp.txt`.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，检查响应文本和新的文件是否存在，即`timestamp.txt`。
- en: Setting the cron schedule
  id: totrans-209
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置cron计划
- en: 'Create `/etc/cron.d/myapp` on your Linux server and add the following row to
    run our command at every midnight:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的Linux服务器上创建`/etc/cron.d/myapp`，并添加以下行以在午夜运行我们的命令：
- en: '[PRE53]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: How it works...
  id: totrans-212
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: A console command is defined as a controller class that extends from `yii\console\Controller`.
    In the controller class, you define one or more actions that correspond to the
    subcommands of the controller. Within each action, you write code that implements
    the appropriate tasks for that particular sub-command.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 控制台命令被定义为扩展自`yii\console\Controller`的控制器类。在控制器类中，你定义一个或多个动作，这些动作对应于控制器的子命令。在每个动作中，你编写代码以实现特定子命令的适当任务。
- en: When running a command, you need to specify the route to the controller action.
    For example, the route `migrate/create` invokes the sub-command that corresponds
    to the `MigrateController::actionCreate()` action method. If a route offered during
    the execution does not contain an action ID, the default action will be executed
    (as with a web controller).
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 当运行一个命令时，您需要指定控制器操作的路径。例如，路径 `migrate/create` 调用与 `MigrateController::actionCreate()`
    操作方法相对应的子命令。如果在执行过程中提供的路由不包含操作 ID，则将执行默认操作（类似于网络控制器）。
- en: Take care that your console controllers are placed in the directory defined
    in the `c` `ontrollerNamespace` option in your `web/console.php` config.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，您的控制台控制器应放置在 `web/console.php` 配置中定义的 `c` `ontrollerNamespace` 选项指定的目录中。
- en: See also
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: For getting more information about Yii2 console commands, refer to [http://www.yiiframework.com/doc-2.0/guide-tutorial-console.html](http://www.yiiframework.com/doc-2.0/guide-tutorial-console.html)
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要获取有关 Yii2 控制台命令的更多信息，请参阅 [http://www.yiiframework.com/doc-2.0/guide-tutorial-console.html](http://www.yiiframework.com/doc-2.0/guide-tutorial-console.html)
- en: In order to learn more about the Cron daemon, refer to [https://en.wikipedia.org/wiki/Cron](https://en.wikipedia.org/wiki/Cron)
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要了解更多关于 Cron 守护进程的信息，请参阅 [https://en.wikipedia.org/wiki/Cron](https://en.wikipedia.org/wiki/Cron)
- en: The *Changing the Yii directory layout* recipe for `controllerNamespace`
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`controllerNamespace` 的 `Changing the Yii directory layout` 菜谱'
- en: Maintenance mode
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 维护模式
- en: Sometimes, there is a need to fine tune some application settings or restore
    a database from a backup. When working on tasks such as these, it is not desirable
    to allow everyone to use the application because it can lead to losing the recent
    user messages or showing the application implementation details.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，需要微调一些应用程序设置或从备份中恢复数据库。在处理此类任务时，不希望允许每个人使用应用程序，因为这可能导致丢失最近的用户消息或显示应用程序实现细节。
- en: In this recipe, we will see how to show everyone except the developer a maintenance
    message.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将看到如何向除开发者外的人显示维护消息。
- en: Getting ready
  id: totrans-223
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer package manager,
    as described in the official guide at [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html).
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用官方指南中描述的 Composer 软件包管理器创建一个新的 `yii2-app-basic` 应用程序，如 [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html)
    所述。
- en: How to do it...
  id: totrans-225
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Carry out the following steps:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤：
- en: 'First, we need to create `protected/controllers/MaintenanceController.php`.
    We do this as follows:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要创建 `protected/controllers/MaintenanceController.php`。我们这样做如下：
- en: '[PRE54]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Then we create a view named `views/maintenance/index.php`, as follows:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们创建一个名为 `views/maintenance/index.php` 的视图，如下所示：
- en: '[PRE55]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Now we need to add a single line of code to `config/web.php`, as follows:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们需要在 `config/web.php` 中添加一行代码，如下所示：
- en: '[PRE56]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Now in order to go into the maintenance mode, you need to create a file named
    `.maintenance` in your site directory. After you do this, you should see this
    page.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在为了进入维护模式，您需要在您的站点目录中创建一个名为 `.maintenance` 的文件。完成此操作后，您应该看到这个页面。
- en: In order to get it back to normal, you just need to delete it. To view the website
    in the maintenance mode, you can create a cookie named `secret` with its value
    equal to `password`.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 为了恢复正常，您只需将其删除。要查看维护模式下的网站，您可以在您的站点目录中创建一个名为 `secret` 的 cookie，其值等于 `password`。
- en: How it works...
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'A Yii web application offers a way to intercept all the possible requests and
    route these to a single controller action. You can do this by setting `yii\web\Application::catchAll`
    to an array containing the application route as follows:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: Yii 网络应用程序提供了一种拦截所有可能的请求并将这些请求路由到单个控制器操作的方法。您可以通过将 `yii\web\Application::catchAll`
    设置为包含应用程序路由的数组来实现这一点，如下所示：
- en: '[PRE57]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: The maintenance controller itself is nothing special; it just renders a view
    with some text.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 维护控制器本身并没有什么特别之处；它只是渲染一个包含一些文本的视图。
- en: 'We need an easy way to turn the maintenance mode on and off. As the application
    config is a regular PHP file, we can achieve it with a simple check to confirm
    the file exists, as follows:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要一个简单的方法来开启和关闭维护模式。由于应用程序配置是一个常规的 PHP 文件，我们可以通过简单地检查文件是否存在来实现，如下所示：
- en: '[PRE58]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'In addition, we check for the cookie value to be able to override the maintenance
    mode. We do this as follows:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们检查 cookie 值以能够覆盖维护模式。我们这样做如下：
- en: '[PRE59]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: See also
  id: totrans-243
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: In order to learn more about how to catch all the requests in a Yii application
    and check the production ready solution for maintenance, refer to [http://www.yiiframework.com/doc-2.0/yii-web-application.html#$catchAll-detail](http://www.yiiframework.com/doc-2.0/yii-web-application.html#%24catchAll-detail).
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解如何在 Yii 应用程序中捕获所有请求以及检查生产就绪解决方案的维护，请参阅[http://www.yiiframework.com/doc-2.0/yii-web-application.html#$catchAll-detail](http://www.yiiframework.com/doc-2.0/yii-web-application.html#%24catchAll-detail)。
- en: Deployment tools
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署工具
- en: If you are using a version control system such as Git, for your project's code
    and pushing releases into remote repository, you can use Git to deploy code to
    your production server via the `git pull` shell command instead of uploading files
    manually. Also, you can write your own shell script to pull new repository commits,
    update vendors, apply migrations, and do more things.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用 Git 等版本控制系统来管理项目代码并将发布版本推送到远程仓库，你可以通过 `git pull` 命令将代码部署到生产服务器，而不是手动上传文件。此外，你可以编写自己的
    shell 脚本来拉取新的仓库提交、更新供应商、应用迁移以及执行更多操作。
- en: However, there are many tools available for automating the deployment process.
    In this recipe, we consider the tool named Deployer.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，有许多工具可用于自动化部署过程。在本配方中，我们考虑名为 Deployer 的工具。
- en: Getting ready
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Create a new `yii2-app-basic` application by using the Composer package manager,
    as described in the official guide at [http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html).
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用官方指南中描述的 Composer 包管理器创建一个新的 `yii2-app-basic` 应用程序，官方指南请参阅[http://www.yiiframework.com/doc-2.0/guidestart-installation.html](http://www.yiiframework.com/doc-2.0/guidestart-installation.html)。
- en: How to do it...
  id: totrans-250
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: If you have a shared remote repository, you can use it for deployment source.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一个共享的远程仓库，你可以将其用作部署源。
- en: Step 1 - Preparing the remote host
  id: totrans-252
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第1步 - 准备远程主机
- en: 'Go to your remote host and install Composer and `asset-plugin` too:'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往你的远程主机并安装 Composer 和 `asset-plugin`：
- en: '[PRE60]'
  id: totrans-254
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: Generate the SSH key via `ssh-keygen`.
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 `ssh-keygen` 生成 SSH 密钥。
- en: Add the `~/.ssh/id_rsa.pub` file content into deployment the SSH keys page of
    your repository settings on GitHub, Bitbucket, or other repositories storage.
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `~/.ssh/id_rsa.pub` 文件内容添加到 GitHub、Bitbucket 或其他存储库的仓库设置中的部署 SSH 密钥页面。
- en: 'Try to clone your repository manually:'
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试手动克隆你的仓库：
- en: '[PRE61]'
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Add the Github address and the list of known hosts if the system asks you to
    do it.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果系统要求你这样做，添加 Github 地址和已知主机列表。
- en: Step 2 - Preparing the localhost
  id: totrans-260
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第2步 - 准备本地主机
- en: 'Install `deploy.phar` globally on your local host:'
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在本地主机上全局安装 `deploy.phar`：
- en: '[PRE62]'
  id: totrans-262
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Add the `deploy.php` file with the deployment configuration:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加带有部署配置的 `deploy.php` 文件：
- en: '[PRE63]'
  id: totrans-264
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Try to prepare remote project directories structure:'
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试准备远程项目目录结构：
- en: '[PRE64]'
  id: totrans-266
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: Step 3 - Adding remote configuration
  id: totrans-267
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第3步 - 添加远程配置
- en: 'Open the server''s `/var/www/project` directory. It has two subdirectories
    after the initialization:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开服务器的 `/var/www/project` 目录。初始化后，它有两个子目录：
- en: '[PRE65]'
  id: totrans-269
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Create original files with private configurations in a `shared` directory like
    this:'
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `shared` 目录中创建具有私有配置的原始文件，如下所示：
- en: '[PRE66]'
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: The Deployer tool will include these files in every release subdirectory via
    symbolic links.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: Deployer 工具将通过符号链接将这些文件包含在每个发布子目录中。
- en: 'Specify your private configuration in `share/config/db.php`:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `share/config/db.php` 中指定你的私有配置：
- en: '[PRE67]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Also, specify it in `share/config/params.php`:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 还要在 `share/config/params.php` 中指定它：
- en: '[PRE68]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Set the content of `share/web/index.php`:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 设置 `share/web/index.php` 的内容：
- en: '[PRE69]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Also, set the content of the `share/yii` file:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 还要设置 `share/yii` 文件的内容：
- en: '[PRE70]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: Note
  id: totrans-281
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Note**: We deliberately use the `dirname($_SERVER[''SCRIPT_FILENAME''])`
    code instead of the original `__DIR__` constant because `__DIR__` will return
    incorrect value when the file is included via symbolic link.'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**：我们故意使用 `dirname($_SERVER[''SCRIPT_FILENAME''])` 代码而不是原始的 `__DIR__` 常量，因为当文件通过符号链接包含时，`__DIR__`
    将返回不正确的值。'
- en: 'Note: If you use the `yii2-app-advanced` template you can redeclare only the
    `config/main-local.php` and `config/params-local.php` files of every (backend,
    frontend, console, and common) because `web/index.php` and `yii` files will be
    created automatically by the `init` command.'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：如果你使用 `yii2-app-advanced` 模板，你只能重新声明每个（后端、前端、控制台和公共）的 `config/main-local.php`
    和 `config/params-local.php` 文件，因为 `web/index.php` 和 `yii` 文件将由 `init` 命令自动创建。
- en: Step 4 - Trying to deploy
  id: totrans-284
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第4步 - 尝试部署
- en: 'Come back to the localhost with the `deploy.php` file and run the deploy command:'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `deploy.php` 文件回到本地主机并运行部署命令：
- en: '[PRE71]'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: If successful, you will see the deployment report:![Step 4 - Trying to deploy](img/image00469.jpeg)
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果成功，您将看到部署报告：![步骤 4 - 尝试部署](img/image00469.jpeg)
- en: 'Deployer created a new release subdirectory on your remote server and added
    symlinks from your project to the shared items and from the `current` directory
    to the current release:'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Deployer 在您的远程服务器上创建了一个新的发布子目录，并从您的项目到共享项目以及从 `current` 目录到当前发布添加了符号链接：
- en: '[PRE72]'
  id: totrans-289
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: After all is done, you must set up the `DocumentRoot` of your server in `project/current/web`
    directory.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有工作完成后，您必须在 `project/current/web` 目录中设置服务器的 `DocumentRoot`。
- en: 'If something goes wrong during the deployment process you can roll back to
    the previous working release:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果在部署过程中出现问题，您可以回滚到先前的有效发布：
- en: '[PRE73]'
  id: totrans-292
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: The `current` directory will lead to your previous release files.
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`current` 目录将指向您的前一个发布文件。'
- en: How it works...
  id: totrans-294
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'Most of the deployment tools do the same tasks:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数部署工具都执行相同的任务：
- en: Create a new release subdirectory
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建新的发布子目录
- en: Clone repository files
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 克隆仓库文件
- en: Make symlinks from the project to shared directories and to local configuration
    files
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从项目到共享目录以及到本地配置文件的符号链接
- en: Install Composer packages
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 Composer 包
- en: Apply project migrations
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用项目迁移
- en: Switch the symlink from the server's `DocumentRoot` path to the current release
    directory
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将符号链接从服务器的 `DocumentRoot` 路径切换到当前发布目录
- en: The Deployer tool has predefined recipes for popular frameworks. You can extend
    any existing recipe or write a new one for your specific case.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: Deployer 工具为流行的框架预定义了食谱。您可以为任何现有食谱扩展或为特定情况编写一个新的食谱。
- en: See also
  id: totrans-303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: For more information about Deployer, refer to [http://deployer.org/docs](http://deployer.org/docs)
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于 Deployer 的更多信息，请参阅 [http://deployer.org/docs](http://deployer.org/docs)
- en: And about creating SSH keys refer to [https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key](https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key)
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于创建 SSH 密钥，请参阅 [https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key](https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key)
