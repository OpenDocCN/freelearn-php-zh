<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;1.&#xA0;Composer, Configuration, Classes, and Path Aliases"><div class="book" id="DB7S2-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01" class="calibre1"/>Chapter 1. Composer, Configuration, Classes, and Path Aliases</h1></div></div></div><p class="calibre9">Before diving into Yii Framework 2, we need to take a look at how it is installed, how it is configured, and what the core building blocks of the framework are. In this chapter, we'll go over how to install the framework itself and prebuilt applications via a package management tool<a id="id0" class="calibre1"/> called <span class="strong"><strong class="calibre2">Composer</strong></span>. We'll also cover some common configurations of both Yii Framework 2 and our web server, including making our applications aware of the environment they are running on and responding appropriately to that environment.</p><div class="note" title="Note"><h3 class="title2"><a id="note04" class="calibre1"/>Note</h3><p class="calibre9">The most common ways to reference Yii Framework 2 are <span class="strong"><em class="calibre13">Yii Framework 2</em></span>, <span class="strong"><em class="calibre13">YF2</em></span>, and <span class="strong"><em class="calibre13">Yii2</em></span>. We'll be using these terms interchangeably throughout the book.</p></div></div>

<div class="book" title="Chapter&#xA0;1.&#xA0;Composer, Configuration, Classes, and Path Aliases">
<div class="book" title="Composer"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch01lvl1sec08" class="calibre1"/>Composer</h1></div></div></div><p class="calibre9">There <a id="id1" class="calibre1"/>are several different ways to install Yii2, ranging from downloading the framework from source control (typically, from GitHub at <a class="calibre1" href="https://github.com/yiisoft/yii2">https://github.com/yiisoft/yii2</a>) to using a package manager such as Composer. With modern <a id="id2" class="calibre1"/>web applications, Composer is the preferred method to install Yii2 as it enables us to install, update, and manage all dependencies and extensions for our application in an automated fashion. Additionally, using Composer, we can ensure that Yii Framework 2 is kept up to date with the latest security and bug fixes. Composer can be installed<a id="id3" class="calibre1"/> by following the instructions on <a class="calibre1" href="https://getcomposer.org">https://getcomposer.org</a>. Typically, this process looks as follows:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">curl -sS https://getcomposer.org/installer | php</strong></span>
</pre></div><p class="calibre9">Alternatively, if you don't have cURL available on your system, it can be installed through PHP itself:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">php -r "readfile('https://getcomposer.org/installer');" | php</strong></span>
</pre></div><p class="calibre9">Once installed, we should move Composer to a more centralized directory so that we can call it from any directory on our system. Installing Composer from a centralized directory rather than on a per-project basis has several advantages:</p><div class="book"><ul class="itemizedlist"><li class="listitem">It <a id="id4" class="calibre1"/>can be called anywhere from any project. When working with multiple projects, we can ensure that we use the same dependency manager each time and for every project.</li><li class="listitem">In a centralized directory, Composer only needs to be updated once rather than in every project we are working on.</li><li class="listitem">Dependency managers are rarely considered code that should be pushed to your DCVS repository. Keeping the <code class="email">composer.phar</code> file out of your repository reduces the amount of code you need to commit and push and ensures that your source code remains isolated from your package manager code.</li><li class="listitem">By installing Composer from a centralized directory, we can ensure that Composer is always available, which saves us a step each time we clone a project that depends on Composer.</li></ul></div><p class="calibre9">A good directory to move Composer to is <code class="email">/usr/local/bin,</code> as shown in the following example:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">mv composer.phar /usr/local/bin/composer</strong></span>
<span class="strong"><strong class="calibre2">chmod a+x /usr/local/bin/composer</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip04" class="calibre1"/>Tip</h3><p class="calibre9">Throughout this book, we'll be using Unix-style commands when referencing command-line arguments. Consequently, some commands may not work on Windows. If<a id="id5" class="calibre1"/> you decide to set up a Windows environment, you might need to use <code class="email">Composer-Setup.exe</code> (available at <a class="calibre1" href="https://getcomposer.org/Composer-Setup.exe">https://getcomposer.org/Composer-Setup.exe</a>) to get Composer configured for your system. If you have any issues getting Composer to run on your<a id="id6" class="calibre1"/> system, ensure that you check out the Composer documentation available at <a class="calibre1" href="https://getcomposer.org/doc/">https://getcomposer.org/doc/</a>.</p></div><p class="calibre9">Alternatively, if you have Composer installed on your system already, ensure that you update it to the latest version by running this:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">composer self-update</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip05" class="calibre1"/>Tip</h3><p class="calibre9">The commands that we use through this book are based on the assumption that you have sufficient privileges to run them. On Unix-like systems, you may need to preface some commands with <code class="email">sudo</code> in order to execute the command with a high permissions set. Alternatively if you are running these commands on Windows, you should ensure that you are running the listed commands in a command prompt that has elevated privileges. Ensure that you follow best practices when using <code class="email">sudo</code> and when using elevated command prompts in order to ensure your system stays secure.</p></div><p class="calibre9">Once<a id="id7" class="calibre1"/> Composer is installed, we'll need to install a global plugin<a id="id8" class="calibre1"/> called <span class="strong"><strong class="calibre2">The Composer Asset Plugin</strong></span> (available at <a class="calibre1" href="https://github.com/francoispluchino/composer-asset-plugin">https://github.com/francoispluchino/composer-asset-plugin</a>). This plugin enables <a id="id9" class="calibre1"/>Composer to manage asset files for us without the need to install additional software (these programs are Bower, an asset dependency manager created by Twitter, and Node Package Manager, or NPM, which is a JavaScript dependency manager).</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">composer global require "fxp/composer-asset-plugin:1.0.0"</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip06" class="calibre1"/>Tip</h3><p class="calibre9">Due to the GitHub API's rate limiting, during installation, Composer may ask you to enter your GitHub credentials. After entering your credentials, Composer will request a dedicated API key from GitHub that can be used for future installations. Ensure<a id="id10" class="calibre1"/> that you check out the Composer documentation at <a class="calibre1" href="https://getcomposer.org/doc/">https://getcomposer.org/doc/</a> for more information.</p></div><p class="calibre9">With Composer installed, we can now instantiate our application. If we want to install an existing Yii2 package, we can simply run the following:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">composer create-project --prefer-dist &lt;package/name&gt; &lt;foldername&gt;</strong></span>
</pre></div><p class="calibre9">Using the Yii2 basic app as an example, this command will look like this:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">composer create-project --prefer-dist yiisoft/yii2-app-basic basic</strong></span>
</pre></div><p class="calibre9">After running the command, you should see output similar to the following:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">Installing yiisoft/yii2-app-basic (2.0.6)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-app-basic (2.0.6)</strong></span>
<span class="strong"><strong class="calibre2">    Downloading: 100%</strong></span>
<span class="strong"><strong class="calibre2">Created project in basic</strong></span>
<span class="strong"><strong class="calibre2">Loading composer repositories with package information</strong></span>
<span class="strong"><strong class="calibre2">Installing dependencies (including require-dev)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-composer (2.0.3)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing ezyang/htmlpurifier (v4.6.0)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing bower-asset/jquery (2.1.4)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing bower-asset/yii2-pjax (v2.0.4)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing bower-asset/punycode (v1.3.2)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing bower-asset/jquery.inputmask (3.1.63)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing cebe/markdown (1.1.0)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2 (2.0.6)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing swiftmailer/swiftmailer (v5.4.1)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-swiftmailer (2.0.4)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-codeception (2.0.4)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing bower-asset/bootstrap (v3.3.5)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-bootstrap (2.0.5)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-debug (2.0.5)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing bower-asset/typeahead.js (v0.10.5)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing phpspec/php-diff (v1.0.2)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-gii (2.0.4)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing fzaninotto/faker (v1.5.0)</strong></span>
<span class="strong"><strong class="calibre2">  - Installing yiisoft/yii2-faker (2.0.3)</strong></span>
<span class="strong"><strong class="calibre2">Writing lock file</strong></span>
<span class="strong"><strong class="calibre2">Generating autoload files</strong></span>
<span class="strong"><strong class="calibre2">&gt; yii\composer\Installer::postCreateProject</strong></span>
<span class="strong"><strong class="calibre2">chmod('runtime', 0777)...done.</strong></span>
<span class="strong"><strong class="calibre2">chmod('web/assets', 0777)...done.</strong></span>
<span class="strong"><strong class="calibre2">chmod('yii', 0755)...done.</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="note05" class="calibre1"/>Note</h3><p class="calibre9">Your output may differ slightly due to the data cached on your system and versions of subpackages.</p></div><p class="calibre9">This <a id="id11" class="calibre1"/>command will install the Yii2 basic app to a folder called basic. When creating a new Yii2 project, you'll typically want to use the create-project command to clone "yii2-app-basic" and then develop your application from there as the basic app comes prepopulated with just about everything you need to start a new project. However, you can also create a Yii2 project from scratch that, while more complicated, gives you more control over your application's structure.</p><p class="calibre9">Let's take a look at the <code class="email">composer.json</code> file that was created when we ran the <code class="email">create-project</code> command:</p><div class="note"><pre class="programlisting">{
    "name": "yiisoft/yii2-app-basic",
    "description": "Yii 2 Basic Application Template",
    "keywords": ["yii2", "framework", "basic", "application template"],
    "homepage": "http://www.yiiframework.com/",
    "type": "project",
    "license": "BSD-3-Clause",
    "support": {
        "issues": "https://github.com/yiisoft/yii2/issues?state=open",
        "forum": "http://www.yiiframework.com/forum/",
        "wiki": "http://www.yiiframework.com/wiki/",
        "irc": "irc://irc.freenode.net/yii",
        "source": "https://github.com/yiisoft/yii2"
    },
    "minimum-stability": "stable",
    "require": {
        "php": "&gt;=5.4.0",
        "yiisoft/yii2": "*",
        "yiisoft/yii2-bootstrap": "*",
        "yiisoft/yii2-swiftmailer": "*"
    },
    "require-dev": {
        "yiisoft/yii2-codeception": "*",
        "yiisoft/yii2-debug": "*",
        "yiisoft/yii2-gii": "*",
        "yiisoft/yii2-faker": "*"
    },
    "config": {
        "process-timeout": 1800
    },
    "scripts": {
        "post-create-project-cmd": [
            "yii\\composer\\Installer::postCreateProject"
        ]
    },
    "extra": {
        "yii\\composer\\Installer::postCreateProject": {
            "setPermission": [
                {
                    "runtime": "0777",
                    "web/assets": "0777",
                    "yii": "0755"
                }
            ],
            "generateCookieValidationKey": [
                "config/web.php"
            ]
        },
        "asset-installer-paths": {
            "npm-asset-library": "vendor/npm",
            "bower-asset-library": "vendor/bower"
        }
    }
}</pre></div><p class="calibre9">While <a id="id12" class="calibre1"/>most of these items (such as the name, description, license, and require blocks) are rather self-explanatory, there are a few Yii2-specific items in here that we should take note of. The first section we want to look at is the <code class="email">"scripts"</code> section:</p><div class="note"><pre class="programlisting">"scripts": {
    "post-create-project-cmd": [
        "yii\\composer\\Installer::postCreateProject"
    ]
}</pre></div><p class="calibre9">This script tells Composer that when the <code class="email">create-project</code> command is run, it should run the <code class="email">postCreateProject</code> static function. Looking at the the framework source code, we see that this file is <a id="id13" class="calibre1"/>referenced in the <code class="email">yii2-composer</code> package (refer to <a class="calibre1" href="https://github.com/yiisoft/yii2-composer/blob/master/Installer.php#L232">https://github.com/yiisoft/yii2-composer/blob/master/Installer.php#L232</a>). This command then runs several post-project creation actions, namely setting the local disk permissions, generating a unique cookie validation key, and setting some asset installer paths for composer-asset-plugin.</p><p class="calibre9">Next, we have the <code class="email">"extra"</code> block:</p><div class="note"><pre class="programlisting">"extra": {
    "yii\\composer\\Installer::postCreateProject": {
        "setPermission": [
            {
                "runtime": "0777",
                "web/assets": "0777",
                "yii": "0755"
            }
        ],
        "generateCookieValidationKey": [
            "config/web.php"
        ]
    },
    "asset-installer-paths": {
        "npm-asset-library": "vendor/npm",
        "bower-asset-library": "vendor/bower"
    }
}</pre></div><p class="calibre9">This<a id="id14" class="calibre1"/> section tells Composer to use these options when it runs the <code class="email">postCreateProject</code> command. These preconfigured options give us a good starting point to create our applications.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuration"><div class="book" id="E9OE2-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec09" class="calibre1"/>Configuration</h1></div></div></div><p class="calibre9">With <a id="id15" class="calibre1"/>our basic application now installed, let's take a look at a few basic configuration and bootstrap files that Yii2 automatically generated for us.</p></div>

<div class="book" title="Configuration">
<div class="book" title="Requirements checker"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec07" class="calibre1"/>Requirements checker</h2></div></div></div><p class="calibre9">Projects <a id="id16" class="calibre1"/>created from <code class="email">yii2-app-basic</code> now come with a built-in requirements script called <code class="email">requirements.php</code>. This script checks several different values in order to ensure that Yii2 can run on our application server. Before running our application, let's run the requirements checker:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">php requirements.php</strong></span>
</pre></div><p class="calibre9">You'll get output similar to the following:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">Yii Application Requirement Checker</strong></span>
<span class="strong"><strong class="calibre2">This script checks if your server configuration meets the requirements for running Yii application.</strong></span>
<span class="strong"><strong class="calibre2">It checks if the server is running the right version of PHP,  if appropriate PHP extensions have been loaded, and if php.ini file settings are correct.</strong></span>
<span class="strong"><strong class="calibre2">Check conclusion:</strong></span>
<span class="strong"><strong class="calibre2">-----------------</strong></span>
<span class="strong"><strong class="calibre2">PHP version: OK</strong></span>
<span class="strong"><strong class="calibre2">[... more checks here ...]</strong></span>
<span class="strong"><strong class="calibre2">-----------------------------------------</strong></span>
<span class="strong"><strong class="calibre2">Errors: 0   Warnings: 6   Total checks: 21</strong></span>
</pre></div><p class="calibre9">In general, as long as the error count is set to <code class="email">0</code>, we'll be good to move forward. If the requirements checker notices an error, it will report it in the <code class="email">Check conclusion</code> section for <a id="id17" class="calibre1"/>you to rectify.</p><div class="note" title="Note"><h3 class="title2"><a id="tip07" class="calibre1"/>Tip</h3><p class="calibre9">As part of your deployment process, it is recommended that your deployment tool runs the requirements checker. This helps ensure that your application server meets all the requirements for Yii2 and that your application doesn't get deployed to a server or environment that doesn't support it.</p></div></div></div>

<div class="book" title="Configuration">
<div class="book" title="Entry scripts"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec08" class="calibre1"/>Entry scripts</h2></div></div></div><p class="calibre9">Like<a id="id18" class="calibre1"/> its predecessor, Yii Framework 2 comes with two separate<a id="id19" class="calibre1"/> entry scripts: one for web applications and the other for console applications.</p><div class="book" title="Web entry script"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch01lvl3sec01" class="calibre1"/>Web entry script</h3></div></div></div><p class="calibre9">In Yii2, the <a id="id20" class="calibre1"/>entry script for web applications has been moved from the root (<code class="email">/</code>) folder to the <code class="email">web/</code> folder. In Yii1, our PHP files were stored in the <code class="email">protected/</code> directory. By moving our entry scripts to the <code class="email">web/</code> directory, Yii2 has increased the security of our application by reducing the amount of web server configuration we need to run our application. Furthermore, all public asset (JavaScript and CSS) files are now completely isolated from our source code directories. If we open up <code class="email">web/index.php</code>, our entry script now looks as follows:</p><div class="note"><pre class="programlisting">&lt;?php

// comment out the following two lines when deployed to production
defined('YII_DEBUG') or define('YII_DEBUG', true);
defined('YII_ENV') or define('YII_ENV', 'dev');

require(__DIR__ . '/../vendor/autoload.php');
require(__DIR__ . '/../vendor/yiisoft/yii2/Yii.php');

$config = require(__DIR__ . '/../config/web.php');

(new yii\web\Application($config))-&gt;run();</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip08" class="calibre1"/>Tip</h3><p class="calibre9">
<span class="strong"><strong class="calibre2">Downloading the example code</strong></span>
</p><p class="calibre9">The latest and most up to date copies of source code for this book is maintained on the Packt Publishing website, <a class="calibre1" href="http://www.packtpub.com">http://www.packtpub.com</a>, and on GitHub at <a class="calibre1" href="https://github.com/masteringyii">https://github.com/masteringyii</a>, for each chapter where applicable.</p></div><p class="calibre9">While suitable for basic applications, the default entry script requires us to manually comment out and change the code when moving to different environments. Since changing the code in a nondevelopment environment doesn't follow best practices, we should change this code block so that we don't have to touch our code to move it to a different environment.</p><p class="calibre9">We'll start by <a id="id21" class="calibre1"/>creating a new application-wide constant called <code class="email">APPLICATION_ENV</code>. This variable will be defined by either our web server or our console environment and will allow us to dynamically load different configuration files depending upon the environment that we're working in:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">After the opening <code class="email">&lt;?php</code> tag in <code class="email">web/index.php</code>, add the following code block:<div class="note"><pre class="programlisting">// Define our application_env variable as provided by nginx/apache/console
if (!defined('APPLICATION_ENV'))
{
    if (getenv('APPLICATION_ENV') != false)
        define('APPLICATION_ENV', getenv('APPLICATION_ENV'));
    else 
       define('APPLICATION_ENV', 'prod');
}</pre></div><p class="calibre14">Our application now knows how to read the <code class="email">APPLCATTION_ENV</code> variable from the environment variable, which will be passed either though our command line or our web server configuration. By default, if no environment is set, the <code class="email">APPLICATION_ENV</code> variable will be set to prod.</p><p class="calibre14">Next, we'll want to load a separate environment file that contains several environmental constants that we'll use to dynamically change how our application runs in different environments:</p><div class="note"><pre class="programlisting">$env = require(__DIR__ . '/../config/env.php');</pre></div><p class="calibre14">Next, we'll configure Yii to set the <code class="email">YII_DEBUG</code> and <code class="email">YII_ENV</code> variables according to our application:</p><div class="note"><pre class="programlisting">defined('YII_DEBUG') or define('YII_DEBUG', $env['debug']);
defined('YII_ENV') or define('YII_ENV', APPLICATION_ENV);</pre></div></li><li class="listitem" value="2">Then, follow the rest of our <code class="email">index.php</code> file under <code class="email">web/</code>:<div class="note"><pre class="programlisting">require(__DIR__ . '/../vendor/autoload.php');
require(__DIR__ . '/../vendor/yiisoft/yii2/Yii.php');
(new yii\web\Application($config))-&gt;run();</pre></div></li></ol><div class="calibre15"/></div><p class="calibre9">With<a id="id22" class="calibre1"/> these changes, our web application is now configured to be aware of its environment and load the appropriate configuration files.</p><div class="note" title="Note"><h3 class="title2"><a id="note06" class="calibre1"/>Note</h3><p class="calibre9">Don't worry; later in the chapter, we'll cover how to define the <code class="email">APPLICATION_ENV</code> variable for both our web server (either Apache or NGINX) and our command line.</p></div></div></div></div>

<div class="book" title="Configuration">
<div class="book" title="Configuration files"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch01lvl2sec09" class="calibre1"/>Configuration files</h2></div></div></div><p class="calibre9">In Yii2, configuration <a id="id23" class="calibre1"/>files are still split into console- and <a id="id24" class="calibre1"/>web-specific configurations. As there are many commonalities between these two files (such as our database and environment configuration), we'll store common elements in their own files and include those files in both our web and console configurations. This will help us follow the DRY standard, and reduce duplicate code within our application.</p><div class="note" title="Note"><h3 class="title2"><a id="note07" class="calibre1"/>Note</h3><p class="calibre9">The <span class="strong"><strong class="calibre2">DRY</strong></span> (<span class="strong"><strong class="calibre2">don't repeat yourself</strong></span>) principle in software development states that we <a id="id25" class="calibre1"/>should avoid having the same code block appear in multiple places in our application. By keeping our application DRY, we can ensure that our application is performant and can reduce bugs in our application. By moving our database and parameters' configuration to their own file, we can reuse that same code in both our web and console configuration files.</p></div><div class="book" title="Web and console configuration files"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch01lvl3sec02" class="calibre1"/>Web and console configuration files</h3></div></div></div><p class="calibre9">Yii2 <a id="id26" class="calibre1"/>supports two different kinds of configuration files: one for web applications and another for console applications. In Yii2, our web configuration file is stored in <code class="email">config/web.php</code> and our console configuration file is stored in <code class="email">config/console.php</code>. If you're familiar with Yii1, you'll see that the basic structure of both of these files hasn't changed all that much.</p></div><div class="book" title="Database configuration"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch01lvl3sec03" class="calibre1"/>Database configuration</h3></div></div></div><p class="calibre9">The <a id="id27" class="calibre1"/>next file we'll want to look at is our database configuration file stored in <code class="email">config/db.php</code>. This file contains all the information our web and console applications will need in order to connect to the database.</p><p class="calibre9">In our basic application, this file looks as follows:</p><div class="note"><pre class="programlisting">&lt;?php

return [
    'class' =&gt; 'yii\db\Connection',
    'dsn' =&gt; 'mysql:host=localhost;dbname=yii2basic',
    'username' =&gt; 'root',
    'password' =&gt; '',
    'charset' =&gt; 'utf8',
];</pre></div><p class="calibre9">For an application that is aware of its environment, however, we should replace this file with a configuration that will use the <code class="email">APPLICATION_ENV</code> variable that we defined earlier:</p><div class="note"><pre class="programlisting">&lt;?php return require __DIR__ . '/env/' . APPLICATION_ENV . '/db.php';</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip09" class="calibre1"/>Tip</h3><p class="calibre9">Right now, we're just setting things up. We'll cover how to set up our directories in the next section.</p></div><p class="calibre9">With this change, our application now knows that it needs to look in a file called <code class="email">db.php</code> under <code class="email">config/env/&lt;APPLICATION_ENV&gt;/</code> to pull the correct configuration environment for that file.</p></div><div class="book" title="Parameter configuration"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch01lvl3sec04" class="calibre1"/>Parameter configuration</h3></div></div></div><p class="calibre9">In a <a id="id28" class="calibre1"/>manner similar to our database configuration file, Yii also lets us use a parameter file where we can store all of the noncomponent parameters for our application. This file is located at <code class="email">config/params.php</code>. Since the basic app doesn't make this file aware of its environment, we'll change it to do that as follows:</p><div class="note"><pre class="programlisting">&lt;?php return require __DIR__ . '/env/' . APPLICATION_ENV . '/params.php';</pre></div></div><div class="book" title="Environment configuration"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch01lvl3sec05" class="calibre1"/>Environment configuration</h3></div></div></div><p class="calibre9">Finally, we<a id="id29" class="calibre1"/> have the environment configuration that we defined earlier when working with our entry scripts. We'll store this file in config/env.php, and it should be written as follows:</p><div class="note"><pre class="programlisting">&lt;?php return require __DIR__ . '/env/' . APPLICATION_ENV . '/env.php';</pre></div><p class="calibre9">Most modern applications have several different environments depending upon their requirements. Typically, we'd break them down into four distinct environments:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The first environment we typically have is called <span class="strong"><strong class="calibre2">DEV</strong></span>. This environment is where all of our local development occurs. Typically, developers have complete control over this environment and can change it, as required, to build their applications.</li><li class="listitem">The <a id="id30" class="calibre1"/>second environment that we typically have is a testing environment called <span class="strong"><strong class="calibre2">TEST</strong></span>. Normally, we'd deploy our application to this environment in order to make sure that our code works in a production-like setting; however, we normally would still have high log levels and debug information available to us when using this environment.</li><li class="listitem">The third<a id="id31" class="calibre1"/> environment we typically have is called <span class="strong"><strong class="calibre2">UAT</strong></span>, or the User Acceptance Testing environment. This is a separate environment that we'd provide to our client or business stakeholders for them to test the application to verify that it does what they want it to do.</li><li class="listitem">Finally, in our typical setup, we'd have our <span class="strong"><strong class="calibre2">PROD</strong></span> or production environment. This is where our code finally gets deployed to and where all of our users ultimately interact with our application.</li></ul></div><p class="calibre9">As outlined in the previous sections, we've been pointing all of our environment configuration files to the <code class="email">config/env/&lt;env&gt;</code> folder. Since our local environment is going to be called <code class="email">DEV</code>, we'll create it first:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We'll start by creating our <code class="email">DEV</code> environment folder from the command line:<div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">mkdir –p config/env/dev</strong></span>
</pre></div></li><li class="listitem" value="2">Next, we'll create our <code class="email">dev</code> database configuration file in <code class="email">db.php</code> under <code class="email">config/env/dev/</code>. For now, we'll stick with a basic SQLite database:<div class="note"><pre class="programlisting">&lt;?php return [
    'dsn' =&gt; 'sqlite:/' . __DIR__ . '/../../../runtime/db.sqlite',
      'class' =&gt; 'yii\db\Connection',
    'charset' =&gt; 'utf8'
];</pre></div></li><li class="listitem" value="3">Next, we'll create our environment configuration file in <code class="email">env.php</code> under <code class="email">config/env/dev</code>. If you recall from earlier in the chapter, this is where our <code class="email">debug</code> flag was stored, so this file will look as follows:<div class="note"><pre class="programlisting">&lt;?php return [ 
    'debug' =&gt; true
];</pre></div></li><li class="listitem" value="4">Finally, we'll create our <code class="email">params.php</code> file under <code class="email">config/env/dev/</code>. As of now, this file will simply return an empty array:<div class="note"><pre class="programlisting">&lt;?php return [];</pre></div></li></ol><div class="calibre15"/></div><p class="calibre9">Now, for<a id="id32" class="calibre1"/> simplicity, let's copy over this configuration to our other environments. From the command line, we can do that as follows:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">cp –R config/env/dev config/env/test</strong></span>
<span class="strong"><strong class="calibre2">cp –R config/env/dev config/env/uat</strong></span>
<span class="strong"><strong class="calibre2">cp –R config/env/dev config/env/prod</strong></span>
</pre></div></div></div></div>

<div class="book" title="Configuration">
<div class="book" title="Setting up our application environment"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch01lvl2sec10" class="calibre1"/>Setting up our application environment</h2></div></div></div><p class="calibre9">Now<a id="id33" class="calibre1"/> that we've told Yii what files and configurations it needs to use for each environment, we need to tell it what environment to use. To do this, we'll set custom variables in our web server configuration that will pass this option to Yii.</p></div></div>

<div class="book" title="Configuration">
<div class="book" title="Setting the web environment for NGINX"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch01lvl2sec11" class="calibre1"/>Setting the web environment for NGINX</h2></div></div></div><p class="calibre9">With <a id="id34" class="calibre1"/>our console application properly configured, we now need to configure our web server to pass the <code class="email">APPLICATION_ENV</code> variable to our application. In a typical NGINX configuration, we have a location block that looks as follows:</p><div class="note"><pre class="programlisting">location ~ \.php$ {
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
        fastcgi_pass   127.0.0.1:9000;
        #fastcgi_pass unix:/var/run/php5-fpm.sock;
        try_files $uri =404;
    }</pre></div><p class="calibre9">To pass the <code class="email">APPLICATION_ENV</code> variable to our application, all we need to do is define a new <code class="email">fastcgi_param</code> as follows:</p><div class="note"><pre class="programlisting">fastcgi_param   APPLICATION_ENV "dev";</pre></div><p class="calibre9">After<a id="id35" class="calibre1"/> making this change, simply restart NGINX.</p></div></div>

<div class="book" title="Configuration">
<div class="book" title="Setting the web environment for Apache"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch01lvl2sec12" class="calibre1"/>Setting the web environment for Apache</h2></div></div></div><p class="calibre9">We<a id="id36" class="calibre1"/> can also easily configure Apache to pass the <code class="email">APPLICATION_ENV</code> variable to our application. With Apache, we typically have a VirtualHost block that looks as follows:</p><div class="note"><pre class="programlisting"># Set document root to be "basic/web"
DocumentRoot "path/to/basic/web"

&lt;Directory "path/to/basic/web"&gt;
    # use mod_rewrite for pretty URL support
    RewriteEngine on
    # If a directory or a file exists, use the request directly
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    # Otherwise forward the request to index.php
    RewriteRule . index.php

    # ...other settings...
&lt;/Directory&gt;</pre></div><p class="calibre9">To pass the <code class="email">APPLICATION_ENV</code> variable to our application, all we need to do is use the <code class="email">SetEnv</code> command as follows, which can be placed anywhere in our VirtualHost block:</p><div class="note"><pre class="programlisting">SetEnv   APPLICATION_ENV dev</pre></div><p class="calibre9">After making this change, simply restart Apache and navigate to your application.</p><p class="calibre9">At the most basic level, our application isn't doing anything different from what it was when we first ran the composer <code class="email">create-project</code> command. Despite not doing anything different, our application is now significantly more powerful and flexible than it was before our changes. Later on in the book, we'll take a look at how these changes in particular can make automated deployments of our application a seamless and simple process.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Components and objects" id="F8901-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec10" class="calibre1"/>Components and objects</h1></div></div></div><p class="calibre9">There<a id="id37" class="calibre1"/> are<a id="id38" class="calibre1"/> two base classes that almost everything in Yii2 extends from: the <code class="email">Component</code> class and the <code class="email">Object</code> class.</p></div>

<div class="book" title="Components and objects" id="F8901-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Components"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec13" class="calibre1"/>Components</h2></div></div></div><p class="calibre9">In Yii2, the <code class="email">Component</code> class has replaced the <code class="email">CComponent</code> class from Yii1. In Yii1, components act as service locators that host a specific set of application components that provide <a id="id39" class="calibre1"/>different services for the processing of requests. Each component in Yii2 can be accessed using the following syntax:</p><div class="note"><pre class="programlisting">Yii::$app-&gt;componentID</pre></div><p class="calibre9">For example, the database component can be accessed using this:</p><div class="note"><pre class="programlisting">Yii::$app-&gt;db</pre></div><p class="calibre9">The cache component can be accessed using this:</p><div class="note"><pre class="programlisting">Yii::$app-&gt;cache</pre></div><p class="calibre9">Yii2 automatically registers each component at runtime via the application configuration that we mentioned in the previous section by name.</p><p class="calibre9">To improve performance in Yii2 applications, components are lazy-loaded or only instantiated the first time they are accessed. This means that if the cache component is never used in your application code, the cache component will never be loaded. At times, however, this can be nonideal, so to force load a component, you can bootstrap it by adding it to the bootstrap configuration option in either <code class="email">config/web.php</code> or <code class="email">config/console.php</code>. For instance, if we want to bootstrap the log component, we can do that as follows:</p><div class="note"><pre class="programlisting">&lt;?php return [
    'bootstrap' =&gt; [
        'log'
    ],
    […]
]</pre></div><p class="calibre9">The <code class="email">bootstrap</code> option behaves in a manner similar to the preload option in Yii1—any component that you want or need to be instantiated on bootstrap will be loaded if it is in the <code class="email">bootstrap</code> section of your configuration file.</p><div class="note" title="Note"><h3 class="title2"><a id="note08" class="calibre1"/>Note</h3><p class="calibre9">For <a id="id40" class="calibre1"/>more information on service locators and components, ensure that you read the <span class="strong"><em class="calibre13">Definitive Guide to Yii</em></span> guide located at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/guide-concept-service-locator.html">http://www.yiiframework.com/doc-2.0/guide-concept-service-locator.html</a> and <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/guide-structure-application-components.html">http://www.yiiframework.com/doc-2.0/guide-structure-application-components.html</a>.</p></div></div></div>

<div class="book" title="Components and objects" id="F8901-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Objects"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec14" class="calibre1"/>Objects</h2></div></div></div><p class="calibre9">In Yii2, almost <a id="id41" class="calibre1"/>every class that doesn't extend from the <code class="email">Component</code> class extends from the <code class="email">Object</code> class. The <code class="email">Object</code> class is the base class that implements the property feature. In Yii2, the property feature allows you to access a lot of information about an object, such as the <code class="email">__get</code> and <code class="email">__set</code> magic methods, as well as other utility functions, such as <code class="email">hasProperty()</code>, <code class="email">canGetProperty()</code>, and <code class="email">canSetProperty()</code>. Combined, this makes objects in Yii2 extremely powerful.</p><div class="note" title="Note"><h3 class="title2"><a id="tip10" class="calibre1"/>Tip</h3><p class="calibre9">The <code class="email">object</code> class is extremely powerful, and many classes in Yii extend from it. Despite this, using the magic methods <code class="email">__get</code> and <code class="email">__set</code> yourself is not considered best practice as it is slower than a native PHP method and doesn't integrate well with your IDE's autocomplete tool and documentation tools.</p></div></div></div>
<div class="book" title="Path aliases" id="G6PI1-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec11" class="calibre1"/>Path aliases</h1></div></div></div><p class="calibre9">In Yii2, path<a id="id42" class="calibre1"/> aliases are used to represent file paths or URL paths so that we don't hardcode paths or URLs directly into our application. In Yii2, aliases always start with the <code class="email">@</code> symbol so that Yii knows how to differentiate it from a file path or URL.</p><p class="calibre9">Aliases can be defined in several ways. The most basic way to define a new alias is to call <code class="email">\Yii::setAlias()</code>:</p><div class="note"><pre class="programlisting">\Yii::setAlias('@path', '/path/to/example');
\Yii::setAlias('@example, 'https://www.example.com');</pre></div><p class="calibre9">Aliases can also be defined in the application configuration file by setting the alias option as follows:</p><div class="note"><pre class="programlisting">return [
    // ...
    'aliases' =&gt; [
        '@path =&gt; '/path/to/example,
        '@example' =&gt; 'https://www.example.com',
    ],
];</pre></div><p class="calibre9">Also, aliases can be easily retrieved using <code class="email">\Yii::getAlias()</code>:</p><div class="note"><pre class="programlisting">\Yii::getAlias('@path') // returns /path/to/example
\Yii::getAlias('@example') // returns https://www.example.com</pre></div><p class="calibre9">Several places in Yii are alias-aware and will accept aliases as inputs. For example, <code class="email">yii\caching\FileCache</code> accepts a file <a id="id43" class="calibre1"/>alias as an alias for the <code class="email">$cachePath</code> parameter:</p><div class="note"><pre class="programlisting">$cache = new FileCache([
    'cachePath' =&gt; '@runtime/cache',
]);</pre></div><div class="note" title="Note"><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre9">For<a id="id44" class="calibre1"/> more information on path aliases, check out the Yii documentation at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/guide-concept-aliases.html">http://www.yiiframework.com/doc-2.0/guide-concept-aliases.html</a>.</p></div></div>
<div class="book" title="Summary" id="H5A41-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec12" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, we went over how to create new Yii2 applications via composer. We also went over the basic configuration files that come with Yii2 as well as how to configure our web application to load environment-specific configuration files. Finally, we also covered components, objects, and path aliases, which are fundamental to gaining mastery over Yii.</p><p class="calibre9">In the next chapter, we'll cover everything you need to know in order to become a master of console commands and applications.</p></div></body></html>