<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Working on the User Interface"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working on the User Interface</h1></div></div></div><p>In this chapter, you will discover how powerful Gii is as a tool. It provides support for CRUD actions, as well as creating a controller and its respective views.</p><p>We will cover the following topics related to the user interface in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using Gii to generate create, read, update, and delete (CRUD) actions:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For example – using CRUD to manage rooms, reservations, and customers using Gii</li></ul></div></li><li class="listitem" style="list-style-type: disc">Customizing JavaScript and CSS:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For example – using JavaScript and CSS to display advertising columns that disappear if there is not enough space available</li></ul></div></li><li class="listitem" style="list-style-type: disc">Using AJAX:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For example: reservation details loaded from customers' drop-down lists</li></ul></div></li><li class="listitem" style="list-style-type: disc">Using the Bootstrap widget:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For example – using datepicker</li></ul></div></li><li class="listitem" style="list-style-type: disc">Viewing multiple models in the same view:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For example – saving multiple customers at the same time</li></ul></div></li><li class="listitem" style="list-style-type: disc">Saving linked models in the same view:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For example – creating a customer and reservation in the same view</li></ul></div></li></ul></div><p>It is now time for you to learn what Yii2 supports in order to customize the JavaScript and CSS parts of web pages. A recurrent use of JavaScript is to handle AJAX calls, that is, to manage widgets and compound controls (such as a dependent drop-down list) from jQuery and Bootstrap.</p><p>Finally, we will employ jQuery to dynamically create more models from the same class in the form, which will be passed to the controller in order to be validated and saved.</p><div class="section" title="Using Gii to generate CRUD"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Using Gii to generate CRUD</h1></div></div></div><p>We introduced <a id="id317" class="indexterm"/>Gii in <a class="link" href="ch05.html" title="Chapter 5. Developing a Reservation System">Chapter 5</a>, <span class="emphasis"><em>Developing a Reservation System</em></span>, to <a id="id318" class="indexterm"/>generate models. Now we want to use Gii to create CRUD actions with a controller and views.</p><p>Type <code class="literal">http://hostname/basic/web/gii</code> in your browser to return to the Gii welcome page. Click on the <span class="strong"><strong>Start</strong></span> button of the <span class="strong"><strong>CRUD</strong></span> section. We have to fill out four fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Model Class</strong></span>: This is the ActiveRecord class associated with the table where CRUD will be built; this class should be provided using the fully qualified namespaced path, for example: <code class="literal">app\models\ModelClass</code>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Search Model Class</strong></span>: This is the name of the search model class to be generated and extended from the model class; this class will provide useful methods and extensions to be used when searching the record. This should be provided using the fully qualified namespaced path, for example: <code class="literal">app\models\ModelClassSearch</code>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Controller Class</strong></span>: This is the name of the controller class to be generated; this class should be provided using the fully qualified namespaced path and the CamelCase format for the name, starting with an uppercase letter, for example: <code class="literal">app\controller\MyCustomController</code>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View Path</strong></span>: This is the directory where the view created from the controller actions will be stored. We can use path, alias <code class="literal">@app/views</code>, to indicate the base path for the views file, for example: <code class="literal">@app/views/myCustom</code> to indicate the base path of the <code class="literal">MyCustomController</code> views, that will be filled by default to <code class="literal">@app/views/controller-id</code>.</li></ul></div><p>Then, we can customize <code class="literal">BaseControllerClass</code>, the widget used in the index page, to enable the state of I18N and the code template, but it is okay to leave them with the default values.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note45"/>Note</h3><p>If we check <span class="strong"><strong>Enable I18N</strong></span>, we must then look after the translations in app messages for each attribute label. This will be covered in a later chapter.</p></div></div><div class="section" title="Example – using CRUD to manage rooms, reservations, and customers using Gii"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec33"/>Example – using CRUD to manage rooms, reservations, and customers using Gii</h2></div></div></div><p>In this example, we <a id="id319" class="indexterm"/>will create <a id="id320" class="indexterm"/>complete <a id="id321" class="indexterm"/>CRUD actions to manage rooms, reservations, and customers.</p><p>In the earlier chapter, we dealt with Gii CRUD actions to create a form. We must now repeat these instructions for all three models: the room, reservation, and customer model class. To distinguish files created with Gii from files created manually in the previous chapters, we will append the Gii suffix to the controller's class name.</p><p>Browse to the Gii welcome page at <code class="literal">http://hostname/basic/web/gii</code>, click on the <span class="strong"><strong>Start</strong></span> button in the <span class="strong"><strong>CRUD</strong></span> section, and fill out the fields with the following values to create CRUD actions for the <code class="literal">Room</code> model class:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Model Class</strong></span>: <code class="literal">app\models\Room</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Search Model Class</strong></span>: <code class="literal">app\models\RoomSearch</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Controller Class</strong></span>: <code class="literal">app\controllers\RoomsWithGiiController</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View Path</strong></span>: <code class="literal">@app/views/rooms-with-gii</code></li></ul></div><p>Then, repeat this operation for the <code class="literal">Reservation</code> model class:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Model Class</strong></span>: <code class="literal">app\models\Reservation</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Search Model Class</strong></span>: <code class="literal">app\models\ReservationSearch</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Controller Class</strong></span>: <code class="literal">app\controllers\ReservationsWithGiiController</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View Path</strong></span>: <code class="literal">@app/views/reservations-with-gii</code></li></ul></div><p>Finally, repeat them for the <code class="literal">Customer</code> model class:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Model Class</strong></span>: <code class="literal">app\models\Customer</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Search Model Class</strong></span>: <code class="literal">app\models\CustomerSearch</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Controller Class</strong></span>: <code class="literal">app\controllers\CustomersWithGiiController</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View Path</strong></span>: <code class="literal">@app/views/customers-with-gii</code><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note46"/>Note</h3><p>Make sure that the View Path has a slash (<code class="literal">/</code>) in the path and not a backslash (<code class="literal">\</code>) as the namespaced path in the model class, search model class, and controller class.</p></div></div></li></ul></div><p>The following screenshot shows the fields filled out to generate CRUD actions for the <code class="literal">Room</code> model class:</p><div class="mediaobject"><img src="graphics/B04656_07_01.jpg" alt="Example – using CRUD to manage rooms, reservations, and customers using Gii"/><div class="caption"><p>CRUD Generator from Gii</p></div></div><p>While navigating <a id="id322" class="indexterm"/>in the folder structure, you will see that Gii has<a id="id323" class="indexterm"/> created three new files in <code class="literal">basic/controllers</code>, named <code class="literal">RoomsWithGiiController.php</code>, <code class="literal">ReservationsWithGiiController.php</code>, <a id="id324" class="indexterm"/>and <code class="literal">CustomersWithGiiController.php</code>.</p><p>Each of these files contains five actions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">actionCreate()</code>: This action is used to create a new model object</li><li class="listitem" style="list-style-type: disc"><code class="literal">actionView()</code>: This action is used to view the details of a model object</li><li class="listitem" style="list-style-type: disc"><code class="literal">actionUpdate()</code>: This action is used to update an existing model object</li><li class="listitem" style="list-style-type: disc"><code class="literal">actionDelete()</code>: This action is used to delete an existing model object</li><li class="listitem" style="list-style-type: disc"><code class="literal">actionIndex()</code>: This action is used to display, using the grid layout, a list of model objects</li></ul></div><p>Open the <code class="literal">basic/models</code> folder <a id="id325" class="indexterm"/>and you will find three new files: <code class="literal">RoomSearch.php</code>, <code class="literal">ReservationSearch.php</code> (which should already exist), and <code class="literal">CustomerSearch.php</code>.</p><p>Each of these files <a id="id326" class="indexterm"/>basically contains a <code class="literal">search()</code> method, which <a id="id327" class="indexterm"/>returns the ActiveDataProvider to be used to display data in GridView, passing some filter conditions.</p><p>Finally, open the <code class="literal">basic/views</code> folder and you will find three new folders: <code class="literal">roomsWithGii</code>, <code class="literal">reservationsWithGii</code>, and <code class="literal">customersWithGii</code>; each one containing six files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">_form.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">_search.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">create.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">index.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">update.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">view.php</code></li></ul></div><p>View files that start with an underscore are considered by default in Yii2 as subviews, or rather views that are called by other views.</p><p>The first two files start with an underscore; effectively if we open <code class="literal">create.php</code> and <code class="literal">update.php</code>, we will notice that, at the end of these files, the <code class="literal">render()</code> method is called using the <code class="literal">_form.php</code> view. Both the create and update view will use the same <code class="literal">_form</code> view to display the form to edit fields.</p><p>The last four files, <code class="literal">create.php</code>, <code class="literal">index.php</code>, <code class="literal">update.php</code>, and <code class="literal">view.php</code> are views that refer to the same actions in the controller. By default, they all have a breadcrumb and a title for each page.</p><p>Make some tests that browse, for example, to <code class="literal">http://hostname/basic/web/rooms-with-gii/index</code> or <code class="literal">http://hostname/basic/web/rooms-with-gii/index</code>, to see some excellent works made by Gii.</p><p>This is the index action result of <code class="literal">RoomsWithGiiController</code>:</p><div class="mediaobject"><img src="graphics/B04656_07_02.jpg" alt="Example – using CRUD to manage rooms, reservations, and customers using Gii"/><div class="caption"><p>The output of the RoomsWithGiiController index action</p></div></div></div></div></div>
<div class="section" title="Customize JavaScript and CSS"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec53"/>Customize JavaScript and CSS</h1></div></div></div><p>As mentioned before, in<a id="id328" class="indexterm"/> this chapter, you will discover how to use frontend <a id="id329" class="indexterm"/>interaction. Using JavaScript and CSS is fundamental to customize frontend output.</p><p>Differently from Yii1, where calling JavaScript and CSS scripts and files was done using the <code class="literal">Yii::app()</code> singleton, in the new framework version, Yii2, this task is part of the <code class="literal">yii\web\View</code> class.</p><p>There are two ways to call JavaScript or CSS: either directly passing the code to be executed or passing the path file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note47"/>Note</h3><p>When passing the code directly to be executed, we will use the Heredoc syntax provided by PHP to avoid handling strings escaping.</p></div></div><p>The <code class="literal">registerJs()</code> function allows us to execute the JavaScript code with three parameters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first parameter is the JavaScript code block to be registered</li><li class="listitem" style="list-style-type: disc">The second parameter is the position where the JavaScript tag should be inserted (the header, the beginning of the body section, the end of the body section, enclosed within the jQuery <code class="literal">load()</code> method, or enclosed within the jQuery <code class="literal">document.ready()</code> method, which is the default)</li><li class="listitem" style="list-style-type: disc">The third and last parameter is a key that identifies the JavaScript code block (if it is not provided, the content of the first parameter will be used as the key)</li></ul></div><p>On the other hand, the <code class="literal">registerJsFile()</code> function allows us to execute a JavaScript file with three parameters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first parameter is the path file of the JavaScript file</li><li class="listitem" style="list-style-type: disc">The second parameter is the HTML attribute for the script tag, with particular attention given to the depends and position values, which are not treated as tag attributes</li><li class="listitem" style="list-style-type: disc">The third parameter is a key that identifies the JavaScript code block (if it's not provided, the content of the first parameter will be used as the key)</li></ul></div><p>CSS, similar to<a id="id330" class="indexterm"/> JavaScript, can be executed using the code or by passing the <a id="id331" class="indexterm"/>path file.</p><p>The <code class="literal">registerCss()</code> function allows us to execute CSS code with three parameters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first one is the CSS code block to be registered</li><li class="listitem" style="list-style-type: disc">The second one is the HTML attributes for the <code class="literal">style</code> tag</li><li class="listitem" style="list-style-type: disc">The third and last parameter is a key that identifies the JavaScript code block (if it is not provided, the content of the first parameter will be used as the key)</li></ul></div><p>The <code class="literal">registerCssFile()</code> function allows us instead to execute a CSS file with three parameters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first one is the path file of the CSS file</li><li class="listitem" style="list-style-type: disc">The second parameter is the HTML attribute for the link tag, with particular attention given to the depends value, which is not treated as a tag attribute</li><li class="listitem" style="list-style-type: disc">The third parameter is a key that identifies the JavaScript code block (if it's not provided, the content of the first parameter will be used as the key)</li></ul></div><p>Generally, JavaScript or CSS files are published in the <code class="literal">basic/web</code> folder, which is accessible without restrictions.</p><p>So, when we have to use custom JavaScript or CSS files, it is recommended to put them in a subfolder of the <code class="literal">basic/web</code> folder, which can be named as <code class="literal">css</code> or <code class="literal">js</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note48"/>Note</h3><p>By default, the folder for CSS files <code class="literal">basic/web/css</code> should already exist. But we still need to create <code class="literal">basic/web/js</code> for JavaScript files.</p></div></div><p>In some circumstances, we might be required to add a new CSS or JavaScript file for all web application pages. The most appropriate place to put these entries is <code class="literal">AppAsset.php</code>, a file located<a id="id332" class="indexterm"/> in <code class="literal">basic/assets/AppAsset.php</code>. In it we can add CSS and <a id="id333" class="indexterm"/>JavaScript entries required in web applications, even using dependencies if we need to.</p><div class="section" title="Example – using JavaScript and CSS to display advertising columns that disappear if not enough space is available"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec34"/>Example – using JavaScript and CSS to display advertising columns that disappear if not enough space is available</h2></div></div></div><p>This sample is suitable if<a id="id334" class="indexterm"/> you need to use JavaScript<a id="id335" class="indexterm"/> and CSS customizations together.</p><p>Think about the layout built as three vertical columns, typical of a blog system. One column of 200 pixels on the left (usually for advertising), one central column of 1000 pixels (usually for content) and one of 200 pixels on the right (usually again for advertising).</p><p>If the browser size is at least 1,400 pixels wide, we want all three columns to be shown (the content and two columns for advertising).</p><p>If there is not enough space for all the columns and the browser's width size is between 1,200 and 1,400 pixels, only the left and central columns will be shown (only a column for advertising and one for the content. Finally, if the browser's width size is under 1,200 pixels, only the central column with content will be shown).</p><p>Also, our goal is to ensure that these columns are always centered in the browser.</p><p>Create a new controller class in <code class="literal">basic/controllers/ThreeColumnsController.php</code>, to handle the action to render the view file:</p><div class="informalexample"><pre class="programlisting">&lt;?php
namespace app\controllers;

use Yii;
use yii\web\Controller;

class ThreeColumnsController extends Controller
{
    public function actionIndex()
    {
        return $this-&gt;render('index.php');
    }
}</pre></div><p>Furthermore, create a new <code class="literal">view</code> folder in <code class="literal">basic/views/three-columns</code> and insert <code class="literal">index.php</code> file in it to store view content.</p><p>Basically, this is the content necessary to build a three column layout:</p><div class="informalexample"><pre class="programlisting">&lt;div id="layout"&gt;
    &lt;div id="colSx" class="column"&gt;
            Content of SX Column
    &lt;/div&gt;
    &lt;div id="colCenter" class="column"&gt;
            Content of Central Column
    &lt;/div&gt;
    &lt;div id="colDx" class="column"&gt;
            Content of DX Column
    &lt;/div&gt;
&lt;/div&gt;</pre></div><p>The CSS class <a id="id336" class="indexterm"/>column will only be used to enhance <a id="id337" class="indexterm"/>cells' visibility with a black border around them.</p><p>At this point, we will center the layout and fix the columns' width using the <code class="literal">registerCss()</code> method at the top of the view file:</p><div class="informalexample"><pre class="programlisting">&lt;?php

$this-&gt;registerCss( &lt;&lt;&lt; EOT_CSS

    .column
    {
            border:1px solid black;
    }

    #layout
    {
        position:relative;
        margin:0pt auto;
        width:1400px;
    }
    
    #colSx
    {
        width:200px;
        float:left;
    }

    #colCenter
    {
        width:1000px;
        float:left;
    }

    #colDx
    {
        width:200px;
        float:left;
    }
     
EOT_CSS
);

?&gt;</pre></div><p>Point your <a id="id338" class="indexterm"/>browser to <code class="literal">http://hostname/basic/web/three-columns/index</code> and <a id="id339" class="indexterm"/>you will get the following content:</p><div class="mediaobject"><img src="graphics/B04656_07_03.jpg" alt="Example – using JavaScript and CSS to display advertising columns that disappear if not enough space is available"/><div class="caption"><p>Content width split into three columns</p></div></div><p>We must handle the resize browser event through JavaScript to manage the columns visualization using the dimension rules defined at the start of this chapter.</p><p>We will use the <code class="literal">registerJs()</code> method, passing only the code to be executed:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$this-&gt;registerJs( &lt;&lt;&lt; EOT_JS
    
    function resizeLayout()
    {
        var windowWidth = $(window).width();
        
        if(windowWidth &gt; 1400)
        {
            $('#colSx').css('display', 'block');
            $('#colCenter').css('display', 'block');
            $('#colDx').css('display', 'block');
            $('#layout').css('width', 1400);
        }
        else if((windowWidth&gt;1200)&amp;&amp;(windowWidth&lt;=1400))
        {
            $('#colSx').css('display', 'block');
            $('#colCenter').css('display', 'block');
            $('#colDx').css('display', 'none');
            $('#layout').css('width', 1200);
        }
        else if(windowWidth&lt;1200)
        {
            $('#colSx').css('display', 'none');
            $('#colCenter').css('display', 'block');
            $('#colDx').css('display', 'none');
            $('#layout').css('width', 1000);
        }
        
    }
   
    $(window).resize(function() {
            resizeLayout();
    });
    
    $(function() {
            resizeLayout();
    });
   
EOT_JS
);
?&gt;</pre></div><p>Refresh your <a id="id340" class="indexterm"/>browser to <code class="literal">http://hostname/basic/web/three-columns/index</code> and resize it to the desired width, and the<a id="id341" class="indexterm"/> columns visualization should change depending on the available space in the specific width.</p></div></div>
<div class="section" title="Using AJAX"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec54"/>Using AJAX</h1></div></div></div><p>Yii2 provides<a id="id342" class="indexterm"/> appropriate attributes for some widgets to make AJAX calls; sometimes, however, writing a JavaScript code in these attributes will make code hard to read, especially if we are dealing with complex codes.</p><p>Consequently, to make an AJAX call, we will use external JavaScript code executed by <code class="literal">registerJs()</code>.</p><p>This is a template of the AJAX class using the <code class="literal">GET</code> or <code class="literal">POST</code> method:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$this-&gt;registerJs( &lt;&lt;&lt; EOT_JS
     
     // using GET method
$.get({
  url: url,
  data: data,
  success: success,
  dataType: dataType
});

     // using POST method
$.post({
  url: url,
  data: data,
  success: success,
  dataType: dataType
});

EOT_JS
);
?&gt;</pre></div><p>An AJAX call is usually the effect of a user interface event (such as a click on a button, a link, and so on). So, most of the time an AJAX call is directly connected to the <code class="literal">.on()</code> event of jQuery on the HTML elements (anchors, buttons, and so on). For this reason, it is important to remember how Yii2 renders the <code class="literal">name</code> and <code class="literal">id</code> attributes of input fields.</p><p>When we call <code class="literal">Html::activeTextInput($model, $attribute)</code> or in the same way use <code class="literal">&lt;?= $form-&gt;field($model, $attribute)-&gt;textInput() ?&gt;</code>.</p><p>The <code class="literal">name</code> and <code class="literal">id</code> attributes of the input text field will be rendered as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">id</code> : The model class name separated with a dash by the attribute name in lowercase; for example, if the model class name is <code class="literal">Room</code> and the attribute is <code class="literal">floor</code>, the <code class="literal">id</code> attribute will be <code class="literal">room-floor</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: The model class name that encloses the attribute name, for example, if the model class name is <code class="literal">Reservation</code> and the attribute is <code class="literal">price_per_day</code>, the name attribute <a id="id343" class="indexterm"/>will be <code class="literal">Reservation[price_per_day]</code>; so every field owned by the <code class="literal">Reservation</code> model will be enclosed all in a single array</li></ul></div><div class="section" title="Example – reservation details loaded from the customers' drop-down lists"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec35"/>Example – reservation details loaded from the customers' drop-down lists</h2></div></div></div><p>In this example, there are two <a id="id344" class="indexterm"/>drop-down lists and a detail box. The two drop-down lists refer to customers and reservations; when user clicks on a customer list item, the second drop-down list of reservations will be filled out according to their choice.</p><p>Finally, when a user clicks on a reservation list item, a details box will be filled out with data about the selected reservation.</p><p>Create a new action in <code class="literal">basic/controllers/ReservationsController.php</code> named <code class="literal">actionDetailDependentDropdown()</code>:</p><div class="informalexample"><pre class="programlisting">    public function actionDetailDependentDropdown()
    {
        $showDetail = false;
        
        $model = new Reservation();
        
        if(isset($_POST['Reservation']))
        {
          $model-&gt;load( Yii::$app-&gt;request-&gt;post() );
        
          if(isset($_POST['Reservation']['id'])&amp;&amp;($_POST['Reservation']['id']!=null))
            {
               $model = Reservation::findOne($_POST['Reservation']['id']);
               $showDetail = true;
            }
        }
        
        
        return $this-&gt;render('detailDependentDropdown', [ 'model' =&gt; $model, 'showDetail' =&gt; $showDetail ]);
    }</pre></div><p>In this action, we<a id="id345" class="indexterm"/> will get the <code class="literal">customer_id</code> and <code class="literal">id</code> parameters from a form based on the <code class="literal">Reservation</code> model data and if it are filled out, the data will be used to search for the correct reservation model to be passed to the view.</p><p>There is a flag called <code class="literal">$showDetail</code> that displays the reservation details content if the <code class="literal">id</code> attribute of the model is received.</p><p>In <code class="literal">ReservationsController</code>, there is also an action that will be called using AJAX when the user changes the customer selection in the drop-down list:</p><div class="informalexample"><pre class="programlisting">    public function actionAjaxDropDownListByCustomerId($customer_id)
    {
        $output = '';
        
        $items = Reservation::findAll(['customer_id' =&gt; $customer_id]);
        foreach($items as $item)
        {
            $content = sprintf('reservation #%s at %s', $item-&gt;id, date('Y-m-d H:i:s', strtotime($item-&gt;reservation_date)));
            $output .= \yii\helpers\Html::tag('option', $content, ['value' =&gt; $item-&gt;id]);
        }
        
        return $output;
    }</pre></div><p>This action will <a id="id346" class="indexterm"/>return the <code class="literal">&lt;option&gt;</code> HTML tags filled out with reservations data filtered by the customer ID passed as a parameter.</p><p>Now let's look at the view in <code class="literal">basic/views/reservations/detailDependentDropdown.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
use yii\helpers\Html;
use yii\widgets\ActiveForm;
use yii\helpers\ArrayHelper;
use yii\helpers\Url;
use app\models\Customer;
use app\models\Reservation;

$urlReservationsByCustomer = Url::to(['reservations/ajax-drop-down-list-by-customer-id']);
$this-&gt;registerJs( &lt;&lt;&lt; EOT_JS

    $(document).on('change', '#reservation-customer_id', function(ev) {

        $('#detail').hide(); 
                
        var customerId = $(this).val();    
        
        $.get(
            '{$urlReservationsByCustomer}',
            { 'customer_id' : customerId },
            function(data) {
                data = '&lt;option value=""&gt;--- choose&lt;/option&gt;'+data;
                $('#reservation-id').html(data);
            }
        )
        ev.preventDefault();
    });

    $(document).on('change', '#reservation-id', function(ev) {
        $(this).parents('form').submit();
        ev.preventDefault();
    });

EOT_JS
);

?&gt;

&lt;div class="customer-form"&gt;
    &lt;?php $form = ActiveForm::begin(['enableAjaxValidation' =&gt; false, 'enableClientValidation' =&gt; false, 'options' =&gt; ['data-pjax' =&gt; '']]); ?&gt;

    &lt;?php $customers = Customer::find()-&gt;all(); ?&gt;
    &lt;?= $form-&gt;field($model, 'customer_id')-&gt;dropDownList(ArrayHelper::map( $customers, 'id', 'nameAndSurname'), [ 'prompt' =&gt; '--- choose' ]) ?&gt;

    &lt;?php $reservations = Reservation::findAll(['customer_id' =&gt; $model-&gt;customer_id]); ?&gt;
    &lt;?= $form-&gt;field($model, 'id')-&gt;label('Reservation ID')-&gt;dropDownList(ArrayHelper::map( $reservations, 'id', function($temp, $defaultValue) {
      $content = sprintf('reservation #%s at %s', $temp-&gt;id, date('Y-m-d H:i:s', strtotime($temp-&gt;reservation_date)));
        return $content;
    }), [ 'prompt' =&gt; '--- choose' ]); ?&gt;

    &lt;div id="detail"&gt;
    &lt;?php if($showDetail) { ?&gt;
        &lt;hr /&gt;
        &lt;h2&gt;Reservation Detail:&lt;/h2&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;Price per day&lt;/td&gt;
                &lt;td&gt;&lt;?php echo $model-&gt;price_per_day ?&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;?php } ?&gt;
    &lt;/div&gt;
    
    &lt;?php ActiveForm::end(); ?&gt;

&lt;/div&gt;</pre></div><p>At the top of the view, there are handlers for changes in the customers and reservations drop-down list.</p><p>If the customer<a id="id347" class="indexterm"/> drop-down list is changed, the <code class="literal">detail</code> div will be hidden, an AJAX call will get all the reservations filtered by <code class="literal">customer_id</code>, and the result will be passed as content to the reservations drop-down list. If the reservations drop-down list is changed, a form will be submitted.</p><p>Next in the form declaration, we can find first of all the customer drop-down list and then the reservations list, which uses a closure to get the value from the <code class="literal">ArrayHelper::map()</code> methods. We could add a new property in the <code class="literal">Reservation</code> model by creating a function starting with the prefix <code class="literal">get</code>, such as <code class="literal">getDescription()</code>, and put in it the content of the closure, or rather:</p><div class="informalexample"><pre class="programlisting">public function getDescription()
{
$content = sprintf('reservation #%s at %s', $this&gt;id, date('Y-m-d H:i:s', strtotime($this&gt;reservation_date)));
            return $content;
}</pre></div><p>Or we could use a short syntax to get data from <code class="literal">ArrayHelper::map()</code> in this way:</p><div class="informalexample"><pre class="programlisting">    &lt;?= $form-&gt;field($model, 'id')-&gt;dropDownList(ArrayHelper::map( $reservations, 'id', 'description'), [ 'prompt' =&gt; '--- choose' ]); ?&gt;</pre></div><p>Finally, if <code class="literal">$showDetail</code> is flagged, a simple details box with only the price per day of the reservation will be displayed.</p><p>Point your browser to <code class="literal">http://hostname/basic/web/reservations/detail-dependent-dropdown</code>:</p><div class="mediaobject"><img src="graphics/B04656_07_04.jpg" alt="Example – reservation details loaded from the customers' drop-down lists"/><div class="caption"><p>Dynamic reservation details being loaded from the customer drop-down list</p></div></div></div></div>
<div class="section" title="Using the Bootstrap widget"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec55"/>Using the Bootstrap widget</h1></div></div></div><p>Yii2 supports <a id="id348" class="indexterm"/>Bootstrap as a core feature. Bootstrap framework CSS and JavaScript files are injected by default in all pages and we could even use this feature to only apply CSS classes or call our own JavaScript function provided by Bootstrap.</p><p>However, Yii2 embeds Bootstrap as a widget, and we can access this framework's capabilities like any other widget.</p><p>The most used are:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Class name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">yii\bootstrap\Alert</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class renders an alert Bootstrap component</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">yii\bootstrap\Button</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class renders a Bootstrap button</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">yii\bootstrap\Dropdown</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class renders a Bootstrap drop-down menu component</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">yii\bootstrap\Nav</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class renders a <code class="literal">nav</code> HTML component</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">yii\bootstrap\NavBar</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class renders a <code class="literal">navbar</code> HTML component</p>
</td></tr></tbody></table></div><p>For example, <code class="literal">yii\bootstrap\Nav</code> and <code class="literal">yii\bootstrap\NavBar</code> are used in the default main template.</p><p>This is an extract from the main layout view (in <code class="literal">basic/views/layouts/main.php</code>):</p><div class="informalexample"><pre class="programlisting">        &lt;?php
            NavBar::begin([
                'brandLabel' =&gt; 'My Company',
                'brandUrl' =&gt; Yii::$app-&gt;homeUrl,
                'options' =&gt; [
                    'class' =&gt; 'navbar-inverse navbar-fixed-top',
                ],
            ]);
            echo Nav::widget([
                'options' =&gt; ['class' =&gt; 'navbar-nav navbar-right'],
                'items' =&gt; [
                    ['label' =&gt; 'Home', 'url' =&gt; ['/site/index']],
                    ['label' =&gt; 'About', 'url' =&gt; ['/site/about']],
                    ['label' =&gt; 'Contact', 'url' =&gt; ['/site/contact']],
                    Yii::$app-&gt;user-&gt;isGuest ?
                        ['label' =&gt; 'Login', 'url' =&gt; ['/site/login']] :
                        ['label' =&gt; 'Logout (' . Yii::$app-&gt;user-&gt;identity-&gt;username . ')',
                            'url' =&gt; ['/site/logout'],
                            'linkOptions' =&gt; ['data-method' =&gt; 'post']],
                ],
            ]);
            NavBar::end();
        ?&gt;</pre></div><div class="section" title="Example: using datepicker"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec36"/>Example: using datepicker</h2></div></div></div><p>Yii2 also supports, by<a id="id349" class="indexterm"/> itself, many jQuery UI widgets through the JUI extension for Yii2,<code class="literal"> yii2-jui</code>.</p><p>If we do not have the <code class="literal">yii2-jui</code> extension in the <code class="literal">vendor</code> folder, we can get it from Composer using this command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php composer.phar require --prefer-dist yiisoft/yii2-jui</strong></span>
</pre></div><p>In this example, we will discuss the two most used widgets: <code class="literal">datepicker</code> and <code class="literal">autocomplete</code>. First let's have a look at the <code class="literal">datepicker</code> widget. This widget can be initialized using a model attribute or by filling out a value property. The following is an example made using a model instance and one of its attributes:</p><div class="informalexample"><pre class="programlisting">echo DatePicker::widget([
    'model' =&gt; $model,
    'attribute' =&gt; 'from_date',
    //'language' =&gt; 'it',
    //'dateFormat' =&gt; 'yyyy-MM-dd',
]);</pre></div><p>And here is a sample of the value property's use:</p><div class="informalexample"><pre class="programlisting">echo DatePicker::widget([
    'name'  =&gt; 'from_date',
    'value'  =&gt; $value,
    //'language' =&gt; 'it',
    //'dateFormat' =&gt; 'yyyy-MM-dd',
]);</pre></div><p>Now create a new <a id="id350" class="indexterm"/>controller named <code class="literal">JuiWidgetsController</code> in <code class="literal">basic/controllers/JuiWidgetsController.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php

namespace app\controllers;

use Yii;
use yii\web\Controller;
use app\models\Reservation;

class JuiWidgetsController extends Controller
{
    public function actionDatePicker()
    {
        $reservationUpdated = false;
        
        $reservation = Reservation::findOne(1);
        
        if(isset($_POST['Reservation']))
        {
            $reservation-&gt;load( Yii::$app-&gt;request-&gt;post() );
            
            $reservation-&gt;date_from = Yii::$app-&gt;formatter-&gt;asDate(  date_create_from_format('d/m/Y', $reservation-&gt;date_from), 'php:Y-m-d' );
            $reservation-&gt;date_to = Yii::$app-&gt;formatter-&gt;asDate(  date_create_from_format('d/m/Y', $reservation-&gt;date_to), 'php:Y-m-d' );
            
            $reservationUpdated = $reservation-&gt;save();
        }
        
        return $this-&gt;render('datePicker', ['reservation' =&gt; $reservation, 'reservationUpdated' =&gt; $reservationUpdated]);
    }
}</pre></div><p>In this action, we define the <code class="literal">$reservation</code> model, picking from the reservations database table with <code class="literal">id</code> 1.</p><p>When data is sent via POST, the <code class="literal">date_from</code> and <code class="literal">date_to</code> fields will be converted from the d/m/y to the y-m-d format to make it possible for the database to save data. Then the model object is updated through the <code class="literal">save()</code> method. Using the Bootstrap widget, an alert box will be displayed in the view after updating the model.</p><p>Create the <code class="literal">datePicker</code> view <a id="id351" class="indexterm"/>in <code class="literal">basic/views/jui-widgets/datePicker.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php

use yii\helpers\Html;
use yii\widgets\ActiveForm;
use yii\jui\DatePicker;

?&gt;

&lt;div class="row"&gt;
    &lt;div class="col-lg-6"&gt;
        &lt;h3&gt;Date Picker from Value&lt;br /&gt;(using MM/dd/yyyy format and English language)&lt;/h3&gt;
        &lt;?php
            $value = date('Y-m-d');
            
        echo DatePicker::widget([
            'name'  =&gt; 'from_date',
            'value'  =&gt; $value,
            'language' =&gt; 'en',
            'dateFormat' =&gt; 'MM/dd/yyyy',
        ]);
        ?&gt;
    &lt;/div&gt;
    &lt;div class="col-lg-6"&gt;
        
        &lt;?php if($reservationUpdated) { ?&gt;
            &lt;?php
            echo yii\bootstrap\Alert::widget([
                'options' =&gt; [
                    'class' =&gt; 'alert-success',
                ],
                'body' =&gt; 'Reservation successfully updated',
            ]);   
            ?&gt;         
        &lt;?php } ?&gt;
        
        &lt;?php $form = ActiveForm::begin(); ?&gt;
        
        &lt;h3&gt;Date Picker from Model&lt;br /&gt;(using dd/MM/yyyy format and italian language)&lt;/h3&gt;
        
        &lt;br /&gt;
        
        &lt;label&gt;Date from&lt;/label&gt;
        &lt;?php
        // First implementation of DatePicker Widget
        echo DatePicker::widget([
            'model'  =&gt; $reservation,
            'attribute' =&gt; 'date_from',
            'language' =&gt; 'it',
            'dateFormat' =&gt; 'dd/MM/yyyy',
        ]);
        ?&gt;
   
        &lt;br /&gt;
        &lt;br /&gt;
        
        &lt;?php
        // Second implementation of DatePicker Widget
        echo $form-&gt;field($reservation, 'date_to')-&gt;widget(\yii\jui\DatePicker::classname(), [
                'language' =&gt; 'it',
                'dateFormat' =&gt; 'dd/MM/yyyy',
        ]) ?&gt;        
        
        &lt;?php     
            echo Html::submitButton('Send', ['class' =&gt; 'btn btn-primary'])
        ?&gt;

        &lt;?php $form = ActiveForm::end(); ?&gt;
        
    &lt;/div&gt;
&lt;/div&gt;</pre></div><p>The view is split into<a id="id352" class="indexterm"/> two columns, left and right. The left column simply displays a <code class="literal">DataPicker</code> example from the value (fixed to the current date). The right column displays an alert box if the <code class="literal">$reservation</code> model has been updated and the next two kinds of widget declaration too; the first one without using <code class="literal">$form</code> and the second one using <code class="literal">$form</code>, both outputting the same HTML code.</p><p>In either case, the <code class="literal">DatePicker</code> date output format is set to dd/MM/yyyy through the <code class="literal">dateFormat</code> property and the language is set to Italian through the <code class="literal">language</code> property.</p><p>Point your browser to <code class="literal">http://hostname/basic/web/jui-widgets/date-picker</code> to see the following output:</p><div class="mediaobject"><img src="graphics/B04656_07_05.jpg" alt="Example: using datepicker"/><div class="caption"><p>Using datepicker</p></div></div></div></div>
<div class="section" title="Multiple models in the same view"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Multiple models in the same view</h1></div></div></div><p>Often, we can find many<a id="id353" class="indexterm"/> models of same or different class in a single view. First of all, remember that Yii2 encapsulates all the views' form attributes in the same container, named the same as the model class name. Therefore, when the controller receives the data, these will all be organized in a key of the <code class="literal">$_POST</code> array named the same as the model class name.</p><p>If the model class name is <code class="literal">Customer</code>, every form input name attribute will be <code class="literal">Customer[attributeA_of_model]</code> This is built with: <code class="literal">$form-&gt;field($model, 'attributeA_of_model')-&gt;textInput()</code>.</p><p>In the case of multiple models of the same class, the container will again be named as the model class name but every attribute of each model will be inserted in an array, such as:</p><div class="informalexample"><pre class="programlisting">Customer[0][attributeA_of_model_0]
Customer[0][attributeB_of_model_0]
…
…
…
Customer[n][attributeA_of_model_n]
Customer[n][attributeB_of_model_n]</pre></div><p>These are built with:</p><div class="informalexample"><pre class="programlisting">$form-&gt;field($model, '[0]attributeA_of_model')-&gt;textInput();
$form-&gt;field($model, '[0]attributeB_of_model')-&gt;textInput();
…
…
…
$form-&gt;field($model, '[n]attributeA_of_model')-&gt;textInput();
$form-&gt;field($model, '[n]attributeB_of_model')-&gt;textInput();</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note49"/>Note</h3><p>Notice that the array key information is inserted in the attribute name!</p></div></div><p>So, when data is passed to <a id="id354" class="indexterm"/>the controller, <code class="literal">$_POST['Customer']</code> will be an array composed by the <code class="literal">Customer</code> models and every key of this array, for example, <code class="literal">$_POST['Customer'][0]</code> is a model of the <code class="literal">Customer</code> class.</p><div class="section" title="Example – saving multiple customers at the same time"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec37"/>Example – saving multiple customers at the same time</h2></div></div></div><p>Now let's see how<a id="id355" class="indexterm"/> to save three customers at once. We will create three containers, one for each model class that will contain some fields of the <code class="literal">Customer</code> model.</p><p>Create a view in <code class="literal">basic/views/customers/createMultipleModels.php</code> that contains a block of input fields repeated for every model passed from the controller:</p><div class="informalexample"><pre class="programlisting">&lt;?php

use yii\helpers\Html;
use yii\widgets\ActiveForm;

/* @var $this yii\web\View */
/* @var $model app\models\Room */
/* @var $form yii\widgets\ActiveForm */
?&gt;

&lt;div class="room-form"&gt;

    &lt;?php $form = ActiveForm::begin(); ?&gt;

    &lt;div class="model"&gt;
      
      &lt;?php for($k=0;$k&lt;sizeof($models);$k++) { ?&gt;
          &lt;?php $model = $models[$k]; ?&gt;
          &lt;hr /&gt;
          &lt;label&gt;Model #&lt;?php echo $k+1 ?&gt;&lt;/label&gt;
          &lt;?= $form-&gt;field($model, "[$k]name")-&gt;textInput() ?&gt;
          &lt;?= $form-&gt;field($model, "[$k]surname")-&gt;textInput() ?&gt;
          &lt;?= $form-&gt;field($model, "[$k]phone_number")-&gt;textInput() ?&gt;
      &lt;?php } ?&gt;
        
    &lt;/div&gt;

&lt;hr /&gt;

    &lt;div class="form-group"&gt;
      &lt;?= Html::submitButton('Save', ['class' =&gt; 'btn btn-primary']) ?&gt;
    &lt;/div&gt;

    &lt;?php ActiveForm::end(); ?&gt;

&lt;/div&gt;</pre></div><p>For each model all the fields will have the same validator rules of the <code class="literal">Customer</code> class, and every single model object will be validated separately.</p><p>Next create a new <a id="id356" class="indexterm"/>action in the customers controller in <code class="literal">basic/controllers/CustomersController.php</code>, named <code class="literal">actionCreateMultipleModels</code>. If the <code class="literal">$_POST['Customer']</code> content is set, and if they are all validated and finally redirected to the grid action, it will save them all together; otherwise it will create three models of the <code class="literal">Customer</code> class:</p><div class="informalexample"><pre class="programlisting">    public function actionCreateMultipleModels()
    {
        $models = [];
        
        if(isset($_POST['Customer']))
        {
             $validateOK = true;
            
            foreach($_POST['Customer'] as $postObj)
            {
                $model = new Customer();
                $model-&gt;attributes = $postObj;
                $models[] = $model;

                $validateOK = ($validateOK &amp;&amp; ($model-&gt;validate()));               
            }
            
            // All models are validated and will be saved
            if($validateOK)
            {
                foreach($models as $model)
                {
                    $model-&gt;save();
                }
                
                // Redirect to grid after save
                return $this-&gt;redirect(['grid']);
            }
        }
        else
        {
            for($k=0;$k&lt;3;$k++)
            {
                $models[] = new Customer();
            }    
        }
        
        return $this-&gt;render('createMultipleModels', ['models' =&gt; $models]);
    }</pre></div><p>It can be useful to create<a id="id357" class="indexterm"/> models in the controller because a large number of them and other validation checks are configured here.</p><p>Browse to <code class="literal">http://hostname/basic/web/customers/create-multiple-models</code> to see the complete page:</p><div class="mediaobject"><img src="graphics/B04656_07_06.jpg" alt="Example – saving multiple customers at the same time"/><div class="caption"><p>Multiple models in the same view</p></div></div></div></div>
<div class="section" title="Saving linked models in the same view"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Saving linked models in the same view</h1></div></div></div><p>It could be convenient<a id="id358" class="indexterm"/> to save different kind of models in the same view. This approach allows us to save time and to navigate from every single detail until a final item that merges all data is created. Handling different kind of models linked to each other it is not so different from what we have seen so far. The only point to take care of is the link (foreign keys) between models, which we must ensure is valid.</p><p>Therefore, the controller action will receive the <code class="literal">$_POST</code> data encapsulated in the model's class name container; if we are thinking, for example, of the customer and reservation models, we will have two arrays in the <code class="literal">$_POST</code> variable, <code class="literal">$_POST['Customer']</code> and <code class="literal">$_POST['Reservation']</code>, containing all the fields about the customer and reservation models.</p><p>Then all data must be saved together. It is advisable to use a database transaction while saving data because the action can be considered as ended only when all the data has been saved.</p><p>Using database transactions in Yii2 is incredibly simple! A database transaction starts with calling <code class="literal">beginTransaction()</code> on the database connection object and finishes with calling the <code class="literal">commit()</code> or <code class="literal">rollback()</code> method on the database transaction object created by <code class="literal">beginTransaction()</code>.</p><p>To start a transaction:</p><div class="informalexample"><pre class="programlisting">$dbTransaction = Yii::$app-&gt;db-&gt;beginTransaction();</pre></div><p>Commit a transaction, to <a id="id359" class="indexterm"/>save all the database activities:</p><div class="informalexample"><pre class="programlisting">$dbTransaction-&gt;commit();</pre></div><p>Rollback a transaction, to clear all the database activities:</p><div class="informalexample"><pre class="programlisting">$dbTransaction-&gt;rollback();</pre></div><p>So, if a customer was saved and the reservation was not (for any possible reason), our data would be partial and incomplete. Using a database transaction, we will avoid this danger.</p><div class="section" title="Example – creating a customer and reservation in the same view"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec38"/>Example – creating a customer and reservation in the same view</h2></div></div></div><p>We now want to create both the<a id="id360" class="indexterm"/> customer and reservation models in the same view in a single step. In this way, we will have a box containing the customer model fields and a box with the reservation model fields in the view.</p><p>Create a view in <code class="literal">basic/views/reservations/createCustomerAndReservation.php</code>, with the fields from the customer and reservation models:</p><div class="informalexample"><pre class="programlisting">&lt;?php

use yii\helpers\Html;
use yii\widgets\ActiveForm;
use yii\helpers\ArrayHelper;
use \app\models\Room;
?&gt;

&lt;div class="room-form"&gt;

    &lt;?php $form = ActiveForm::begin(); ?&gt;

    &lt;div class="model"&gt;
        
      &lt;?php echo $form-&gt;errorSummary([$customer, $reservation]); ?&gt;

      &lt;h2&gt;Customer&lt;/h2&gt;        
      &lt;?= $form-&gt;field($customer, "name")-&gt;textInput() ?&gt;
      &lt;?= $form-&gt;field($customer, "surname")-&gt;textInput() ?&gt;
      &lt;?= $form-&gt;field($customer, "phone_number")-&gt;textInput() ?&gt;

      &lt;h2&gt;Reservation&lt;/h2&gt;        
      &lt;?= $form-&gt;field($reservation, "room_id")-&gt;dropDownList(ArrayHelper::map(Room::find()-&gt;all(), 'id', function($room, $defaultValue) {
          return sprintf('Room n.%d at floor %d', $room-&gt;room_number, $room-&gt;floor);
      })); ?&gt;
      &lt;?= $form-&gt;field($reservation, "price_per_day")-&gt;textInput() ?&gt;
      &lt;?= $form-&gt;field($reservation, "date_from")-&gt;textInput() ?&gt;
      &lt;?= $form-&gt;field($reservation, "date_to")-&gt;textInput() ?&gt;
      
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        &lt;?= Html::submitButton('Save customer and room', ['class' =&gt; 'btn btn-primary']) ?&gt;
    &lt;/div&gt;

    &lt;?php ActiveForm::end(); ?&gt;

&lt;/div&gt;</pre></div><p>We have created <a id="id361" class="indexterm"/>two blocks in the form to fill out the fields for the customer and the reservation.</p><p>Now, create a new action named <code class="literal">actionCreateCustomerAndReservation</code> in <code class="literal">ReservationsController</code> in <code class="literal">basic/controllers/ReservationsController.php</code>:</p><div class="informalexample"><pre class="programlisting">    public function actionCreateCustomerAndReservation()
    {
        $customer = new \app\models\Customer();
        $reservation = new \app\models\Reservation();

        // It is useful to set fake customer_id to reservation model to avoid validation error (because customer_id is mandatory)
        $reservation-&gt;customer_id = 0;
        
        if(
            $customer-&gt;load(Yii::$app-&gt;request-&gt;post())
            &amp;&amp;
            $reservation-&gt;load(Yii::$app-&gt;request-&gt;post())
            &amp;&amp;
            $customer-&gt;validate()
            &amp;&amp;
            $reservation-&gt;validate()
        )
        {
        
            $dbTrans = Yii::$app-&gt;db-&gt;beginTransaction();
            
            $customerSaved = $customer-&gt;save();
            
            if($customerSaved)
            {
                $reservation-&gt;customer_id = $customer-&gt;id;
                $reservationSaved = $reservation-&gt;save();
                
                if($reservationSaved)
                {
                    $dbTrans-&gt;commit();
                }
                else {
                    $dbTrans-&gt;rollback();
                }                
            }
            else {
                $dbTrans-&gt;rollback();
            }
        }
        
        
        return $this-&gt;render('createCustomerAndReservation', [ 'customer' =&gt; $customer, 'reservation' =&gt; $reservation ]);
    }</pre></div><p>Ensure you pay<a id="id362" class="indexterm"/> attention to these two matters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">$reservation-&gt;customer_id = 0</code>: With this code, we avoid the validation error relating to the <code class="literal">customer_id</code> requirement that appears when <code class="literal">$reservation</code> is validated</li><li class="listitem" style="list-style-type: disc">The database transaction will be committed only if the customer model and reservation model's save action are completed</li></ul></div><p>Browse to <code class="literal">http://hostname/basic/web/reservations/create-customer-and-reservation</code> to see the complete page:</p><div class="mediaobject"><img src="graphics/B04656_07_07.jpg" alt="Example – creating a customer and reservation in the same view"/><div class="caption"><p>A customer and reservation created together</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec58"/>Summary</h1></div></div></div><p>In this chapter, we discussed about the user interface and how Yii helps us with its core functionalities. The first important tool that Yii provides is Gii, which facilitates CRUD actions and views' creation, which we used in Gii to manage rooms, reservations, and customers, for example.</p><p>Next we saw how to embed JavaScript and CSS in a layout and views, with file content or an inline block. This was applied to an example that showed you how to change the number of columns displayed based on the browser's available width; this is typically a task for websites or web apps that display advertising columns.</p><p>Again on the subject of JavaScript, you learned how to implement direct AJAX calls, taking an example where the reservation detail was dynamically loaded from the customers drop-down list.</p><p>Next we looked at Yii's core user interface library, which is built on Bootstrap and we illustrated how to use the main Bootstrap widgets natively, together with DatePicker (probably the most commonly used jQuery UI widget).</p><p>Finally, the last topics covered were multiple models of the same and different classes. We looked at two examples on these topics: the first one to save multiple customers at the same time and the second to create a customer and reservation in the same view.</p><p>In the next chapter, we will explain how to set up login authentication and authorization, and will reach these goals from scratch.</p></div></body></html>