<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Theming"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Theming</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Configuring Magento themes and packages</li><li class="listitem" style="list-style-type: disc">Creating your first theme</li><li class="listitem" style="list-style-type: disc">Adding extra files to your theme</li><li class="listitem" style="list-style-type: disc">Adding jQuery support</li><li class="listitem" style="list-style-type: disc">Changing a page title</li><li class="listitem" style="list-style-type: disc">Working with translations</li><li class="listitem" style="list-style-type: disc">Understanding the theming block system</li><li class="listitem" style="list-style-type: disc">Adding widgets to the layout</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/>Introduction</h1></div></div></div><p>When you want to make your sample Magento site ready for use, the first thing most people want to change is the look and feel of the shop. The first impression a visitor has of your site is the look and feel.</p><p>In this chapter, we will cover the most important things you can do with a Magento theme. Customizing the standard theme is not so difficult but building a theme from scratch is a lot of work.</p></div></div>
<div class="section" title="Configuring Magento themes and packages"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Configuring Magento themes and packages</h1></div></div></div><p>Magento works with<a id="id59" class="indexterm"/> multiple themes. You can configure more themes in the same store. A common case<a id="id60" class="indexterm"/> is that you have a theme of your shop and some inherited themes based on the shop theme.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Getting ready</h2></div></div></div><p>Log in to the backend and go<a id="id61" class="indexterm"/> to the theme configuration section that you can find at <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Design</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>How to do it...</h2></div></div></div><p>The following instructions describe how to manage the different Magento themes of a webshop:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change the theme field to <code class="literal">modern</code> and clear the cache. Go to your frontend and your shop will look as follows:<div class="mediaobject"><img src="graphics/3329OS_02_01.jpg" alt="How to do it..."/></div><p>You have now configured the <code class="literal">modern</code> theme in the <code class="literal">default</code> package. This theme will extend things from the <code class="literal">default</code> theme and, in the last case, from the <code class="literal">base/default</code> theme. <a id="id62" class="indexterm"/>This process is called the <span class="strong"><strong>theme fallback system</strong></span><a id="id63" class="indexterm"/>.</p></li><li class="listitem">Make the theme field empty and add the following configuration:<div class="mediaobject"><img src="graphics/3329OS_02_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Reload the frontend:<div class="mediaobject"><img src="graphics/3329OS_02_03.jpg" alt="How to do it..."/></div><p>Your shop will look like the <code class="literal">default</code> theme but with some different CSS styles. We have<a id="id64" class="indexterm"/> configured the <code class="literal">default</code> theme but with another <code class="literal">skin</code> folder that contains the CSS files.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>How it works...</h2></div></div></div><p>There are three levels of themes in Magento: the base theme, the package's default theme, and the other themes in the package.</p><p>The following diagram shows how the theme fallback system works when you have configured a theme:</p><div class="mediaobject"><img src="graphics/3329OS_02_04.jpg" alt="How it works..."/></div><p>When the <code class="literal">winter</code> theme is<a id="id65" class="indexterm"/> configured, Magento will look at files in the following order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The theme (<code class="literal">packt/winter</code>)</li><li class="listitem" style="list-style-type: disc">The package's default theme (<code class="literal">packt/default</code>)</li><li class="listitem" style="list-style-type: disc">The base theme (<code class="literal">base/default</code>)</li></ul></div><p>It is possible to configure a default theme in the configuration page by navigating to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Design</strong></span>. If this is set (for example, <code class="literal">packt/summer</code>), the fallback system will loop through the themes in the following order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The theme (<code class="literal">packt/winter</code>)</li><li class="listitem" style="list-style-type: disc">The configured default theme (<code class="literal">packt/summer</code>)</li><li class="listitem" style="list-style-type: disc">The package's default theme (<code class="literal">packt/default</code>)</li><li class="listitem" style="list-style-type: disc">The base theme (<code class="literal">base/default</code>)</li></ul></div><p>The directory where the theme is stored is <code class="literal">app/design/frontend</code> for the template files (rendering HTML) and <code class="literal">skin/frontend</code> for the static files (CSS, images, fonts, and so on).</p><p>Practically, the default theme of a package will contain the theme of the webshop. The subthemes in that package mostly have the same layout but differ in some small things. For example, a winter theme has a background with snow and the summer theme has a background with a beach. The rest of the theme is exactly the same because this uses the same files of the default theme.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>When your theme is not in the default package, nothing happens on the frontend after installing a Magento extension.</p><p>The reason could<a id="id66" class="indexterm"/> be that the theme files of the module are in the default package. Magento looks only at the configured and base packages. The default<a id="id67" class="indexterm"/> package is just like every other package such as <code class="literal">packt</code> or <code class="literal">music</code>. When a module has custom theme files, the best practice is to store these files in the base theme to avoid this problem.</p></div></div><p>You can configure Magento themes on different levels to show up on the frontend. In most cases, the theme settings are configured on the configuration page by navigating to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Design</strong></span>.</p><p>You can add exceptions on the page by navigating to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Design</strong></span>. On this page, you can configure a theme for a store with a from date and to date.</p><p>It is also possible to configure a specific theme for a product, category, or CMS page. You can change the settings on the edit pages of a product, category, or CMS page.</p></div></div>
<div class="section" title="Creating your first theme"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Creating your first theme</h1></div></div></div><p>We will create a <a id="id68" class="indexterm"/>package with a default theme in it. At a later stage, we can add more themes in this package, which extend the default theme that we will <a id="id69" class="indexterm"/>create in this chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Getting ready</h2></div></div></div><p>Open your IDE and navigate to the theme folder (<code class="literal">app/design/frontend and skin/frontend/default</code>).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>How to do it...</h2></div></div></div><p>The following procedure shows you which actions are required to create a custom theme:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the following folders:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">app/design/frontend/packt/default</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/design/frontend/packt/default/layout</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/design/frontend/packt/default/template</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">skin/frontend/packt/default</code></li></ul></div></li><li class="listitem">Copy the content <a id="id70" class="indexterm"/>of the folder <code class="literal">skin/frontend/default/blank/</code> to <code class="literal">skin/frontend/packt/default</code>. The folder looks as follows:<div class="mediaobject"><img src="graphics/3329OS_02_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Configure the new theme and package in the backend. Navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Design</strong></span><a id="id71" class="indexterm"/> and configure as follows:<div class="mediaobject"><img src="graphics/3329OS_02_06.jpg" alt="How to do it..."/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/suppor">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></li><li class="listitem">Save the configuration and your site will look as follows:<div class="mediaobject"><img src="graphics/3329OS_02_07.jpg" alt="How to do it..."/></div><p>The theme is<a id="id72" class="indexterm"/> now installed and ready for further development.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>How it works...</h2></div></div></div><p>We have just created a blank theme; a theme with only structural CSS. When we want to customize the look and feel with CSS, we have to work in the following folders and files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">skin/frontend/packt/default/css</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">skin/frontend/packt/default/css/styles.css (the main css file)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">skin/frontend/packt/default/images (the css images folder)</code></li></ul></div><p>With these files, you can change the CSS look and feel of the shop. If you want to change some of the HTML code, you have to work in the <code class="literal">app/design/frontend/packt/default</code> folder.</p><p>This folder is inherited from<a id="id73" class="indexterm"/> the <code class="literal">app/design/frontend/base/default</code> folder where the standard files are stored. If you want to change a file in the <code class="literal">base</code> folder, you need to copy the file with the same folder structure from the <code class="literal">base</code> folder to your theme.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Changing the code of the base package files will also work but this is not recommended because these files are part of the Magento core. When these files are changed, your changes will be lost after a Magento upgrade and your code maintainability becomes low.</p></div></div><p>If you want to change the <code class="literal">header.phtml</code> file that is located at <code class="literal">app/design/frontend/base/default/template/page/html/header.phtml</code>, you have to copy it to <code class="literal">app/design/frontend/packt/default/template/page/html/header.phtml</code>.</p><p>When it is located there, clear your caches. Now, the file of your theme is loaded instead of the one in the base folder.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>In the Magento development process, you have to clear the caches to see your changes. It is also possible to disable the cache. If so, you don't have to clear the cache many times when developing but you will have longer page loads.</p></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>There's more…</h2></div></div></div><p>To see from where every file is loaded, you can turn on <span class="strong"><strong>Template Path Hints</strong></span>. To do this, go to the backend and navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Developer</strong></span>.</p><p>Navigate to your store view in the top-left corner and set the following configuration:</p><div class="mediaobject"><img src="graphics/3329OS_02_08.jpg" alt="There's more…"/></div><p>When this is set, <a id="id74" class="indexterm"/>navigate to the frontend and you will see red columns around every block.</p></div></div>
<div class="section" title="Adding extra files to your theme"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Adding extra files to your theme</h1></div></div></div><p>In the previous recipe, we <a id="id75" class="indexterm"/>set up our theme with one<a id="id76" class="indexterm"/> CSS file. Mostly, you want to add some more files to it (when you are using a JavaScript plugin or something).</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Getting ready</h2></div></div></div><p>We will add an extra CSS and JavaScript file to our theme. To do this, we have to work in the following two directories:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">app/design/frontend/packt/default/layout</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">skin/frontend/packt/default</code></li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/>How to do it...</h2></div></div></div><p>In the following steps, we will see how we can add extra files to a theme:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the <code class="literal">page.xml</code> file. The declarations of all the CSS and JavaScript files that need to be included are stored in the file <code class="literal">app/design/frontend/base/default/layout/page.xml</code>.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>It is possible that there are other CSS and JavaScript declarations in other layout XML files. The <code class="literal">page.xml</code> file is used to set up the default layout structure.</p></div></div></li><li class="listitem">We need to add something. So we need to copy this file with the same folder structure to our <a id="id77" class="indexterm"/>theme folder. Copy the file to <code class="literal">app/design/frontend/packt/default/layout/page.xml</code>.</li><li class="listitem">Add the CSS declaration.</li><li class="listitem">If you open the <code class="literal">page.xml</code> file and look in the <code class="literal">&lt;default&gt;</code> tag, you will see a lot of lines with <code class="literal">"addCss"</code>. We <a id="id78" class="indexterm"/>need to add the following line in that section:<div class="informalexample"><pre class="programlisting">&lt;action method="addCss"&gt;&lt;stylesheet&gt;css/packt.css&lt;/stylesheet&gt;&lt;/action&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>The path we specify here is the path starting from our theme root folder, so it is <code class="literal">css/packt.css</code>. Magento will use the theme fallback to find the file in the <code class="literal">theme</code>, <code class="literal">package</code>, or <code class="literal">base</code> folder.</p></div></div></li><li class="listitem">Don't forget to create the CSS file. Create the <code class="literal">packt.css</code> file in the <code class="literal">skin/frontend/packt/default/css/</code> folder.</li><li class="listitem">Clear the Magento cache.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>When you change something in the XML files, you will always have to clear the cache to see the effect of your changes. It is also possible to disable the cache. The purpose is that you don't have to clear the cache many times as the page loads are slower.</p></div></div></li><li class="listitem">Reload the frontend and look at the HTML source. Your file should be added.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How it works...</h2></div></div></div><p>The <code class="literal">addCss</code> function<a id="id79" class="indexterm"/> is one of the functions in the head block of Magento. This block will generate the HTML head section of a page.</p><p>The following functions are useful when working with extra CSS and JS files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">addJs</code>: This function will <a id="id80" class="indexterm"/>add a JS file from the <code class="literal">js</code> folder (folder in the root directory) to the head of the page.</li><li class="listitem" style="list-style-type: disc"><code class="literal">addItem</code>: This is a function that will add <a id="id81" class="indexterm"/>a JS or CSS file to the head of the page. The function has two required parameters: the type and the filename.</li></ul></div><p>The type can have the following values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">skin_js</code>: This is a JavaScript file in the <code class="literal">skin</code> folder</li><li class="listitem" style="list-style-type: disc"><code class="literal">js_css</code>: This is a CSS file in the <code class="literal">js</code> folder</li><li class="listitem" style="list-style-type: disc"><code class="literal">js</code>: This is a JavaScript file in the <code class="literal">js</code> folder</li><li class="listitem" style="list-style-type: disc"><code class="literal">css</code>: This is a CSS file in the <code class="literal">skin</code> folder</li><li class="listitem" style="list-style-type: disc"><code class="literal">rss</code>: This creates a <code class="literal">&lt;link&gt;</code> HTML tag with an attribute <code class="literal">type="application/rss+xml"</code></li></ul></div><p>The <a id="id82" class="indexterm"/>
<code class="literal">addItem</code> function has<a id="id83" class="indexterm"/> three other optional parameters<a id="id84" class="indexterm"/> to customize the output of the tag in the <code class="literal">head</code> tag.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>There's more...</h2></div></div></div><p>When you use the right functions to include images, JavaScript, and CSS, you have the following advantages over adding HTML code in a <code class="literal">.phtml</code> file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can merge the CSS and JavaScript files to one file when you configure it</li><li class="listitem" style="list-style-type: disc">It always contains the right absolute URL to the file (it contains the right domain and protocol)</li><li class="listitem" style="list-style-type: disc">It uses the theme fallback system</li></ul></div></div></div>
<div class="section" title="Adding jQuery support"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Adding jQuery support</h1></div></div></div><p>Magento 1.8 and earlier versions didn't use jQuery in the frontend and backend. The library that Magento uses for the <a id="id85" class="indexterm"/>JavaScript functionality is Prototype. When you want to use some jQuery code, you need to add the jQuery library in your theme.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Getting ready</h2></div></div></div><p>Go to the jQuery website and get the latest version.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>How to do it...</h2></div></div></div><p>By default, Magento loads the Prototype library. Excluding this will cause JavaScript errors on every page, so we need to use both libraries. The problem with jQuery and Prototype is that they both use the dollar sign (<code class="literal">$</code>) as the namespace for their functions.</p><p>To avoid the conflict, we have to use jQuery in the noconflict mode:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Put the jQuery library in the <code class="literal">js/jquery</code> folder.</li><li class="listitem">We will create a <code class="literal">local.xml</code> file in our theme folder to add extra layout instructions. Create the <code class="literal">app/design/frontend/packt/default/local.xml</code> file.</li><li class="listitem">Add the following content in that file:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;layout&gt;
  &lt;default&gt;
    &lt;reference name="head"&gt;
      &lt;action method="addJs"&gt;
        &lt;js&gt;jquery/jquery.js&lt;/js&gt;
      &lt;/action&gt;
    &lt;/reference&gt;
  &lt;/default&gt;
&lt;/layout&gt;</pre></div></li><li class="listitem">Create a <code class="literal">jquery.noconflict.js</code> file in the <code class="literal">js/jquery</code> folder with the following content:<div class="informalexample"><pre class="programlisting">$.noConflict();</pre></div></li><li class="listitem">Add this file, after adding the jQuery<a id="id86" class="indexterm"/> file, in your <code class="literal">local.xml</code> file. The file contains the following code snippet:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;layout&gt;
  &lt;default&gt;
    &lt;reference name="head"&gt;
      &lt;action method="addJs"&gt;
        &lt;js&gt;jquery/jquery.js&lt;/js&gt;
      &lt;/action&gt;
      &lt;action method="addJs"&gt;
        &lt;js&gt;jquery/jquery.noconflict.js&lt;/js&gt;
      &lt;/action&gt;
    &lt;/reference&gt;
  &lt;/default&gt;
&lt;/layout&gt;</pre></div></li><li class="listitem">Clear your caches and look at the source of your frontend.</li><li class="listitem">The jQuery file and the <code class="literal">noconflict</code> file should be added in the head section.</li><li class="listitem">You can now use jQuery in your webshop.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>Keep in mind that you have to call jQuery with the <code class="literal">jQuery</code> namespace instead of the <code class="literal">$</code> namespace.</p><p>Also keep in mind that third-party extensions of Magento could include jQuery in the frontend. Make sure the version is compatible with your code.</p></div></div></li><li class="listitem">We normally use the following <a id="id87" class="indexterm"/>code snippet:<div class="informalexample"><pre class="programlisting">$(document).ready(function() {});</pre></div><p>But, we will instead use the following line with the jQuery namespace:</p><div class="informalexample"><pre class="programlisting">jQuery(document).ready(function () {});</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>How it works...</h2></div></div></div><p>We added two files to the theme that contains the jQuery library. We had to use the noconflict mode to avoid conflicts with the prototype library.</p><p>To add files to the layout, we created a <code class="literal">local.xml</code> file. In that file, we added instructions to add the JavaScript files to the head of the HTML code.</p><p>The main advantage of using a <code class="literal">local.xml</code> file for this is that you don't have to overwrite an entire XML file from the base folder to add just two lines of code.</p></div></div>
<div class="section" title="Changing a page title"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Changing a page title</h1></div></div></div><p>In the previous chapter, we added some CSS and JavaScript files to the <code class="literal">&lt;head&gt;</code> tag of the HTML. To change the page title, we have<a id="id88" class="indexterm"/> to do it in a similar way.</p><p>We will change the page title of the contacts page that is available at <code class="literal">http://magento-dev.local/contacts</code>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>How to do it...</h2></div></div></div><p>To change the page title of the contacts page, have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the contacts page in the frontend. This is available at <code class="literal">http://magento-dev.local/contacts</code>.</li><li class="listitem">You see that the page title reads <span class="strong"><strong>Contact Us</strong></span>. We will change this to <span class="strong"><strong>Give us a message</strong></span>.</li><li class="listitem">Copy the <code class="literal">layout/contacts.xml</code> file from the base theme to our theme and open the file. In this file, there is an xml tag <code class="literal">&lt;contacts_index_index&gt;</code>:<div class="informalexample"><pre class="programlisting">&lt;contacts_index_index translate="label"&gt;
  &lt;label&gt;Contact Us Form&lt;/label&gt;
  &lt;reference name="head"&gt;
    &lt;action method="setTitle" translate="title" module="contacts"&gt;&lt;title&gt;Contacts Us&lt;/title&gt;&lt;/action&gt;
  &lt;/reference&gt;
  &lt;reference name="root"&gt;
    &lt;action method="setTemplate"&gt;&lt;template&gt;page/2columns-right.phtml&lt;/template&gt;&lt;/action&gt;
    &lt;action method="setHeaderTitle" translate="title" module="contacts"&gt;&lt;title&gt;Contact Us&lt;/title&gt;&lt;/action&gt;
  &lt;/reference&gt;
  &lt;reference name="content"&gt;
    &lt;block type="core/template" name="contactForm" template="contacts/form.phtml"/&gt;
  &lt;/reference&gt;
&lt;/contacts_index_index&gt;</pre></div></li><li class="listitem">In the <code class="literal">&lt;reference name="head"&gt;</code> tag, you will see a <code class="literal">setTitle</code> method<a id="id89" class="indexterm"/>. Set this line as follows:<div class="informalexample"><pre class="programlisting">&lt;action method="setTitle" translate="title" module="contacts"&gt;&lt;title&gt;Give us a message&lt;/title&gt;&lt;/action&gt;</pre></div></li><li class="listitem">Clear your cache and reload the page. <a id="id90" class="indexterm"/>The title in your browser is now changed to <span class="strong"><strong>Give us a message.</strong></span></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>How it works...</h2></div></div></div><p>The <code class="literal">&lt;title&gt;</code> tag in the HTML page is in the head section. This head section is generated by the Magento head block.</p><p>In the template file, the code looks as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;title&gt;&lt;?php echo $this-&gt;getTitle() ?&gt;&lt;/title&gt;</strong></span>
</pre></div><p>This means that Magento will print the title of that object in the tag. To set the title of that object, we use the <code class="literal">setTitle</code> function<a id="id91" class="indexterm"/>.</p></div></div>
<div class="section" title="Working with translations"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Working with translations</h1></div></div></div><p>Magento has the ability to run multiple<a id="id92" class="indexterm"/> stores in different languages. In the sample store, you can see English, French, and a German store view.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Getting ready</h2></div></div></div><p>Open the backend and go to the general configuration section (<span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>General</strong></span>). We will configure the languages for the store views and do some inline translations.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How to do it...</h2></div></div></div><p>The following steps show <a id="id93" class="indexterm"/>you how you can translate strings in a Magento store:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Configure the languages for each store view.</li><li class="listitem">At the top-left corner, you will see a store switcher where you can switch the configuration for a store. Set the French language for the French store view and the German language for the German store view.</li><li class="listitem">Clear the cache and reload your frontend.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>You will see no changes because there is no language pack installed by default for French and German. Language packs are available in Magento Connect.</p></div></div></li><li class="listitem">Enable the inline translation. We will translate our store with the inline translation tool that you can configure from <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Developer</strong></span><a id="id94" class="indexterm"/> (the last tab). In the default configuration scope, configure the following:<div class="mediaobject"><img src="graphics/3329OS_02_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Reload your frontend. You will see red frames around a lot of strings in the frontend. When you hover and click on the icon, a pop-up window will show the translation form:<div class="mediaobject"><img src="graphics/3329OS_02_10.jpg" alt="How to do it..."/></div><p>With this translation form, you can create your own translations for the language of the current store.</p></li><li class="listitem">Click on <span class="strong"><strong>Submit</strong></span>, clear<a id="id95" class="indexterm"/> the caches, and reload the page.</li></ol></div><p>If everything goes well, you will see that the text is translated into the string you just entered. Make sure you always clear the cache when editing a translation.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>How it works...</h2></div></div></div><p>Magento has a very powerful translate function. To create a string in this translate function, you have to use the following syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Mage::helper('core')-&gt;__('Text to translate');</strong></span>
</pre></div><p>This syntax always works, but when working in template files, you can also use the shorter syntax:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$this-&gt;__('Text to translate');</strong></span>
</pre></div><p>The translate function will search for the string in the following ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">First, Magento will look into the <code class="literal">core_translate</code> table of the database. In this table, only those translations which you have translated inline are added (like we did in this recipe).</li><li class="listitem" style="list-style-type: disc">If no matching string is found in the <code class="literal">core_translate</code> table, Magento will look at the <code class="literal">translate.csv</code> file in the theme. This file is located under <code class="literal">app/design/frontend/&lt;&lt;my_package&gt;&gt;/&lt;&lt;my_theme&gt;&gt;/locale/&lt;&lt;language&gt;&gt;/translate.csv</code>.</li><li class="listitem" style="list-style-type: disc">If the string is not found in the theme translation file, Magento will search for the string in the <code class="literal">app/locale/&lt;&lt;language&gt;&gt;</code> folder. In this folder, you can find all the translation<a id="id96" class="indexterm"/> files. A translate package will contain some of the module's translate files (<code class="literal">.csv</code>).</li><li class="listitem" style="list-style-type: disc">If no string is found in the module's translate files, Magento will print the original string that is passed as an argument to the translation function.</li></ul></div></div></div>
<div class="section" title="Understanding the theming block system"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Understanding the theming block system</h1></div></div></div><p>The Magento frontend is not a single file. It is a combination of blocks nested in each other. Each block is an object you can play with.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Getting ready</h2></div></div></div><p>Open a category page in your shop and you see a lot of frames which all represent a block. Some blocks are structural (left column, right column, content, and footer) and others contain content (product list, cart, navigation, and so on).</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>How to do it...</h2></div></div></div><p>In the next two steps, we will enable<a id="id97" class="indexterm"/> the frontend hints to get an idea of the used blocks on a page.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enable your frontend <span class="strong"><strong>Template Path Hints</strong></span>. Go to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Developer</strong></span> and enable the template and block names.</li><li class="listitem">Reload the frontend. When the frontend hints are enabled, a frontend page will have red frames around each block.</li></ol></div><p>Each block with a template is in a red frame. The title in white is the template file and the blue title is the classname of the block object.</p><p>When you want to edit the content of a block, you will have to look at the files displayed in the red frames. Make sure when a template file is in the base theme, you copy it to your theme.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How it works...</h2></div></div></div><p>All the blocks are declared in layout XML files. These layout files are stored in the layout folder of a theme.</p><p>When you open a layout file, everything is stored in the layout XML tag. The children of this tag are layout handles.</p><p>A layout handle is a set of layout instructions that can be loaded on a page. When you look at the <code class="literal">contacts.xml </code>file, you<a id="id98" class="indexterm"/> see two handles. Layout handles are always in the second level of the <code class="literal">&lt;layout&gt;</code> XML tree:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">default</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">contacts_index_index</code></li></ul></div><p>The default handle will be loaded on every page. The <code class="literal">contacts_index_index</code> handle will be loaded on the contacts page.</p><p>When you want to load a layout instruction on a page, you have to name your handle as follows:</p><div class="informalexample"><pre class="programlisting">&lt;modulename&gt;_&lt;controllername&gt;_&lt;actionname&gt;</pre></div><p>For the contacts page, you have to enter following values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Module: <code class="literal">contacts</code></li><li class="listitem" style="list-style-type: disc">Controller: <code class="literal">IndexController</code></li><li class="listitem" style="list-style-type: disc">Action: <code class="literal">indexAction</code></li></ul></div><p>For the login page, it is as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Module: <code class="literal">customer</code></li><li class="listitem" style="list-style-type: disc">Controller: <code class="literal">AccountController</code></li><li class="listitem" style="list-style-type: disc">Action: <code class="literal">loginAction</code></li></ul></div><p>So, the name of the handle is <code class="literal">customer_account_login</code>.</p><p>You can find more information about controllers and their actions in the <span class="emphasis"><em>Adding a new page</em></span> recipe in <a class="link" href="ch04.html" title="Chapter 4. Creating a Module">Chapter 4</a>, <span class="emphasis"><em>Creating a Module</em></span>.</p><p>When you look at the <code class="literal">customer.xml</code> file in the theme, you will see this handle with the instructions for the login page. When you look inside a handle, you will see the <code class="literal">&lt;reference&gt;</code> tags. Inside these tags, you see the <code class="literal">&lt;block&gt;</code> tags.</p><p>A reference is a block. When you have <code class="literal">&lt;reference name="left"&gt;</code>, you are performing actions in the block with the name <code class="literal">left</code>. This block with the name <code class="literal">left</code> is declared in the <code class="literal">page.xml</code> file of the theme.</p><p>Actions that you can perform <a id="id99" class="indexterm"/>are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Calling methods on the block object with <code class="literal">&lt;action method="methodName"&gt;</code></li><li class="listitem" style="list-style-type: disc">Adding child blocks</li><li class="listitem" style="list-style-type: disc">Removing child blocks</li><li class="listitem" style="list-style-type: disc">Setting a template</li></ul></div><p>The Magento frontend is built with blocks. The main block where everything starts from is called root. If you look at the <code class="literal">page.xml</code> file in our theme, in the default handle, you will see how the structural blocks are initialized.</p></div></div>
<div class="section" title="Adding widgets to the layout"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Adding widgets to the layout</h1></div></div></div><p>In the previous recipe, we described the Magento layout blocks. Writing layout XML files is not so easy as there is a graphical interface to add blocks to the layout. This interface is <a id="id100" class="indexterm"/>called <span class="strong"><strong>widgets</strong></span>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>Getting ready</h2></div></div></div><p>We will add a product link<a id="id101" class="indexterm"/> to the left column of the category page. Go to the backend and navigate to <span class="strong"><strong>CMS</strong></span> | <span class="strong"><strong>Widgets</strong></span><a id="id102" class="indexterm"/>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>How to do it...</h2></div></div></div><p>In the following steps, we will configure a widget for the category pages.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Choose <span class="strong"><strong>Add new widget instance</strong></span>.</li><li class="listitem">In the next form, choose the configuration shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_02_12.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on <span class="strong"><strong>Continue</strong></span> and the<a id="id103" class="indexterm"/> following screen shows up:<div class="mediaobject"><img src="graphics/3329OS_02_13.jpg" alt="How to do it..."/></div></li><li class="listitem">Fill in the form with the following values:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Widget Instance Title</strong></span>: <code class="literal">Widget-category-left-product</code><p>This is the title of the widget in the backend. A structural name is easy when working with a lot of widgets.</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Assign to Store Views</strong></span>: <span class="strong"><strong>All Store Views</strong></span><p>In the <span class="strong"><strong>Widget Options</strong></span> tab,<a id="id104" class="indexterm"/> you have to choose the product.</p></li></ul></div></li><li class="listitem">Save the widget. Click on <span class="strong"><strong>Save and Continue Edit</strong></span>. The <a id="id105" class="indexterm"/>widget instance is now saved but nothing will show up in the frontend because there is no layout update set.</li><li class="listitem">To show the widget in the frontend, we have to create a layout update by clicking on the <span class="strong"><strong>Add Layout Update</strong></span> button<a id="id106" class="indexterm"/>.</li><li class="listitem">Fill in the form as follows:<div class="mediaobject"><img src="graphics/3329OS_02_14.jpg" alt="How to do it..."/></div></li><li class="listitem">Clear the cache and go to a category page. A product link will show up in the left column.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>How it works...</h2></div></div></div><p>In the left column, a new block is added to the frontend. Like each block on the frontend, this widget has a block class and<a id="id107" class="indexterm"/> a template similar to the other blocks.</p><p>The only difference is that this block is not generated by an XML file but by an XML layout instruction in the database.</p><p>The widget interface will generate a layout XML that is stored in the database. The block class and template are similar to other blocks in the XML files.</p></div></div></body></html>