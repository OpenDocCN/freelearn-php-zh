<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Setting Up a Phalcon Project"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Setting Up a Phalcon Project</h1></div></div></div><p>Before we start writing the code for our blog, we are going to take a look at the skeleton we need to have in place for our project. First, we will walk through creating the folder structure and necessary files manually. After we have finished doing it the hard way, we will learn how to use Phalcon Developer Tools in order to do all of this automatically with a few simple terminal commands. Our code will change and morph as we go. This is because as we delve deeper into the framework, we will be refactoring our old code to handle new features that we want to add to our blog application.</p><p>In this chapter, we will learn the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The folder structure of Phalcon project</li><li class="listitem" style="list-style-type: disc">The Phalcon .htaccess file</li><li class="listitem" style="list-style-type: disc">How to use a .ini file</li><li class="listitem" style="list-style-type: disc">How to create a Phalcon bootstrap file</li><li class="listitem" style="list-style-type: disc">How to use Phalcon Developer Tools</li></ul></div><div class="section" title="Folder structure"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Folder structure</h1></div></div></div><p>Unlike many PHP frameworks, Phalcon doesn't care about your folder structure. You can create any folder structure you<a id="id35" class="indexterm"/> want, but for our blog tutorial, we are going to use a basic MVC-structured site. There are many different variations of the folder structure in various frameworks. We will start out with the following code snippet, which has the same structure that the Phalcon Developer Tools will be generating for us later in the chapter:</p><div class="informalexample"><pre class="programlisting">phalconBlog/
  app/
    config/
    controllers/
    library/
    logs/
    models/
    plugins/
    views/
      index/
      layouts/
  public/
    css/
    files/
    img/
    js/
    temp/</pre></div><p>The only executable file we have in our <a id="id36" class="indexterm"/>
<code class="literal">public</code> folder is our bootstrap file, <code class="literal">index.php</code>, which we will learn about later in this chapter. Everything else are static files loaded by the browser. In our <a id="id37" class="indexterm"/>
<code class="literal">app</code> folder, we have folders for our <code class="literal">models</code>, <code class="literal">views</code>, and <code class="literal">controllers</code>.</p><p>There are MVC file structures smaller than this, and there are structures that contain the <code class="literal">template</code>,<a id="id38" class="indexterm"/> <code class="literal">partial</code>,<a id="id39" class="indexterm"/> and <code class="literal">module</code> folders. <a id="id40" class="indexterm"/>As your project gets bigger and more complicated, you may want to switch to a multimodule folder structure, about which you can read at <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/applications.html">http://docs.phalconphp.com/en/latest/reference/applications.html</a>. And for simpler sites, such as a basic API, you may want to opt for a much smaller structure such as the micro application structure. You can find an example of the micro MVC structure at <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/tutorial-rest.html">http://docs.phalconphp.com/en/latest/reference/tutorial-rest.html</a>.</p></div></div>
<div class="section" title="Using .htaccess files"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Using .htaccess files</h1></div></div></div><p>We are going to use <code class="literal">.htaccess</code> files in our application, and for this step, you need to make sure <code class="literal">mod_rewrite</code> is enabled on your Apache server. On many Apache installations, this mod is installed and enabled by default. If <code class="literal">mod_rewrite</code> is not enabled on your server, you will need<a id="id41" class="indexterm"/> to enable it, which could involve running the <code class="literal">sudo a2enmod rewrite</code> command or uncommenting the <code class="literal">LoadModule mod_rewrite.so</code> line in the <code class="literal">httpd.conf</code> or <code class="literal">apache2.conf</code> file. It all depends on your Apache installation.</p><p>For Nginx configuration, you can read the section at the end of this chapter and skip using <code class="literal">.htaccess</code> files.</p><p>Now, we need to tell Apache how to serve our Phalcon project. First, we will have to hide our <code class="literal">app</code> folder from public view and redirect all visitors to our <code class="literal">public</code> folder. Therefore, we need to create a <code class="literal">.htaccess</code> file for our project's root folder, the <code class="literal">phalconBlog</code> folder. So, open a text editor, create a new file, and insert the following lines of code in the file:</p><div class="informalexample"><pre class="programlisting">&lt;IfModule mod_rewrite.c&gt;
  RewriteEngine on
  RewriteRule ^$ public/     [L]
  RewriteRule (.*) public/$1 [L]
&lt;/IfModule&gt;</pre></div><p>Save this file as <code class="literal">.htaccess</code> in the <code class="literal">phalconBlog</code> folder. Now, all visitors to the <code class="literal">phalconBlog</code> folder will be <a id="id42" class="indexterm"/>directed to the <code class="literal">public</code> folder.</p><p>This is not the only option when it comes to serving our <code class="literal">public</code> folder in Apache. We could edit our Apache configuration file for the virtual host serving our project and set the document root to our <code class="literal">public/</code> directory. In this case, we would not need this first <code class="literal">.htaccess</code> file, only the <code class="literal">.htaccess</code> file we are about to create.</p><p>Phalcon has beautiful URLs built in. In other words, URLs can have a more appealing structure; for example, <a class="ulink" href="http://www.blog.com/post/1">http://www.blog.com/post/1</a> is better than <a class="ulink" href="http://www.blog.com/?post=1">http://www.blog.com/?post=1</a>. Since every visit must go through the bootstrap file that we will learn about next, we will also have to create a <code class="literal">.htaccess</code> file for the <code class="literal">public</code> folder. So, create the file in the <code class="literal">public</code> folder and insert the following lines of code in the file:</p><div class="informalexample"><pre class="programlisting">&lt;IfModule mod_rewrite.c&gt;
  RewriteEngine On
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ index.php?_url=/$1 [QSA,L]
&lt;/IfModule&gt;</pre></div><p>This <code class="literal">.htaccess</code> file tells Apache to load a file or folder in the <code class="literal">public</code> folder if it exists, and if not, send the visitor to the <code class="literal">index.php</code> file.</p></div>
<div class="section" title="The bootstrap file"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>The bootstrap file</h1></div></div></div><p>The <code class="literal">index.php</code> file that <a id="id43" class="indexterm"/>we are redirecting all of our requests to is the cornerstone of our application. In this file, we load any configuration we set up and put together the various pieces of the Phalcon framework into a complete application. In this step, we will start with a simple bootstrap file and then make it more configurable in the next step with the use of a <code class="literal">.ini</code> file.</p><div class="section" title="Handling exceptions"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec07"/>Handling exceptions</h2></div></div></div><p>First, we want to make sure <a id="id44" class="indexterm"/>we catch any exceptions our application may throw at us. So, open up your text editor or IDE and create an <code class="literal">index.php</code> file and place it in the <code class="literal">public</code> directory. In the <code class="literal">index.php</code> file, insert the following code snipppet:</p><div class="informalexample"><pre class="programlisting">&lt;?php
  try {
    //Our code
  } catch(\Phalcon\Exception $e) {
    echo "PhalconException: ", $e-&gt;getMessage();
  }
?&gt;</pre></div><p>The first thing you should notice is that we haven't included a file in our application, yet we can still reference a Phalcon exception. Phalcon is a PHP extension and is now part of your PHP installation. There is no need to include any PHP files. We are using a PHP try-catch construction to catch any exception that Phalcon may throw.</p></div><div class="section" title="Dependency Injection"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec08"/>Dependency Injection</h2></div></div></div><p>Phalcon uses a Dependency Injection container to handle all the services you may need to use in your application. Whenever <a id="id45" class="indexterm"/>our application needs one of these services, it asks for it by name from the container. Phalcon is designed to be decoupled, meaning that you can use all or part of its features rather than being required to use a specific base set of services. This Dependency Injection container, or DI, is the glue that holds all of our chosen services together.</p><p>Let's create a DI. We will be using Phalcon's <code class="literal">FactoryDefault</code> DI. So, in the <code class="literal">try</code> brackets of your <code class="literal">index.php</code>, insert the following code snippet:</p><div class="informalexample"><pre class="programlisting">  try {
    //Create a DI
    $di = new Phalcon\DI\FactoryDefault();

    //Set up our views
    $di-&gt;set('view''view', function(){
      $view = new \Phalcon\Mvc\View();
      $view-&gt;setViewsDir(__DIR__ . '../app/views/');
      return $view;
    });
  } catch(\Phalcon\Exception $e) {
    echo "PhalconException: ", $e-&gt;getMessage();
  }</pre></div><p>So, we have created our DI. Next, we register our view service with it, telling Phalcon where to find our view files. Now, let's set the model and controller folders for our application.</p></div><div class="section" title="Autoloaders"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec09"/>Autoloaders</h2></div></div></div><p>Now, we add our<a id="id46" class="indexterm"/> autoloaders.</p><div class="informalexample"><pre class="programlisting">  //Create a DI
    $di = new Phalcon\DI\FactoryDefault();

    //Set up our views
    $di-&gt;set('view', function(){
      $view = new \Phalcon\Mvc\View();
      $view-&gt;setViewsDir(__DIR__ . '../app/views/');
      return $view;
    });

    //Our autoloaders
    $loader = new \Phalcon\Loader();
    $loader-&gt;registerDirs(array(
      __DIR__ . '../app/controllers/',
      __DIR__ . '../app/models/'
    ))-&gt;register();</pre></div><p>This will tell Phalcon where to find our controller and model files. Currently, we are using only two folders in our blog project, but it is possible to load more folders with Phalcon Loader if we need to. We also created <code class="literal">library</code> and <code class="literal">plugin</code> folders, which we will be using later.</p></div><div class="section" title="Initializing our application"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec10"/>Initializing our application</h2></div></div></div><p>Now, we only have to add a couple more lines of code to initialize our application to handle requests. We create an<a id="id47" class="indexterm"/> instance of <code class="literal">Phalcon\MVC\Application</code> and name it <code class="literal">$application</code>. Then, we invoke <code class="literal">$application-&gt;handle-&gt;getContent()</code>.</p><div class="informalexample"><pre class="programlisting">&lt;?php
  try {
    //Create a DI
    $di = new Phalcon\DI\FactoryDefault();

    //Set up our views
    $di-&gt;set('view', function(){
      $view = new \Phalcon\Mvc\View();
      $view-&gt;setViewsDir(__DIR__ . '../app/views/');
      return $view;
    });

    //Our autoloaders
    $loader = new \Phalcon\Loader();
    $loader-&gt;registerDirs(array(
      __DIR__ . '../app/controllers/',
      __DIR__ . '../app/models/'
    ))-&gt;register();

    //Initialize our application
    $application = new \Phalcon\Mvc\Application($di);
    echo $application-&gt;handle()-&gt;getContent();
  } catch(\Phalcon\Exception $e) {
    echo "PhalconException: ", $e-&gt;getMessage();
  }
?&gt;</pre></div><p>Now that we have hardcoded everything into our bootstrap file, we are going to change it up a bit and make our application<a id="id48" class="indexterm"/> a bit more flexible. Also, we are going to use the classic <code class="literal">.ini</code> file as the configuration file for our application.</p></div></div>
<div class="section" title="Using a configuration file"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Using a configuration file</h1></div></div></div><p>Using a configuration file gives the developer a simple place to edit various settings on a website that might otherwise<a id="id49" class="indexterm"/> change in different environments. If you move a project from your localhost to another server, all you have to do is edit this file, and the application should run wherever you put it.</p><p>You can use a standard PHP array to store Phalcon configurations, JSON files, or the <code class="literal">.ini</code> file format. We will be using a <code class="literal">.ini</code> file for readability, but the PHP array format is native to PHP and loads quicker. Later in this book, we will add more settings to our file, but for now, our project's folder paths look like good additions to our <code class="literal">.ini</code> file. Most likely, we won't have to change these settings, but it gives us the option to change our mind later. So, you should create a new folder, <code class="literal">config</code>, in the <code class="literal">app</code> folder of your blog project, and create a new file, <code class="literal">config.ini</code>, in your editor and save it in this folder. In this file, add the following lines of code:</p><div class="informalexample"><pre class="programlisting">[phalcon]
controllersDir = "../app/controllers/"
modelsDir = "../app/models/"
viewsDir = "../app/views/"</pre></div><p>Now, we have a <code class="literal">.ini</code> file hanging out all alone. It's time to load it in our bootstrap file. So, open up the <code class="literal">index.php</code> file again. We are going to make some changes.</p><p>The <code class="literal">Phalcon\Config</code> component can currently read the configuration files of either the <code class="literal">.ini</code> or PHP array types. For our project, it is <code class="literal">.ini</code> all the way. Right after you create the DI, you are going to load the <code class="literal">.ini</code> file.</p><div class="informalexample"><pre class="programlisting">//Create a DI
$di = new Phalcon\DI\FactoryDefault();

//Load ini file
$config = new \Phalcon\Config\Adapter\Ini(__DIR__ . '../app/config/config.ini');
$di-&gt;set('config', $config);</pre></div><p>Now, we have our configuration file loaded, but it's not doing anything; it's just taking up space. It is time to replace our hardcoded file paths with our configuration data. The only path we cannot replace is the<a id="id50" class="indexterm"/> location of the <code class="literal">.ini</code> file itself.</p><p>So, we are going to take the following bit of code out of our index file:</p><div class="informalexample"><pre class="programlisting">//Set up our views
$di-&gt;set('view', function(){
  $view = new \Phalcon\Mvc\View();
  $view-&gt;setViewsDir(__DIR__ . '../app/views/');
  return $view;
});

//Our autoloaders
$loader = new \Phalcon\Loader();
$loader-&gt;registerDirs(array(
  __DIR__ .'../app/controllers/',
  __DIR__ .'../app/models/'
))-&gt;register();</pre></div><p>Change it to the following code snippet:</p><div class="informalexample"><pre class="programlisting">//Set up our views
$di-&gt;set('view', function() use ($config) {
  $view = new \Phalcon\Mvc\View();
  $view-&gt;setViewsDir($config-&gt;phalcon-&gt;viewsDir);
  return $view;
});

//Our autoloaders
$loader = new \Phalcon\Loader();
$loader-&gt;registerDirs(array(
  $config-&gt;phalcon-&gt;controllersDir,
  $config-&gt;phalcon-&gt;modelsDir
))-&gt;register();</pre></div><p>Each heading in our <code class="literal">.ini</code> file became a child object of our <code class="literal">$config</code> object, and each setting under the header became a variable in that Phalcon child object. Now that we have a <code class="literal">.ini</code> file, we can choose a few deployment methods to ensure our application will run on each environment we need to put it on. We could create a <code class="literal">dev.ini</code> file for our development server and a <code class="literal">prod.ini</code> file for our production server. Our bootstrap file could then load a <code class="literal">.ini</code> file based<a id="id51" class="indexterm"/> on an Apache environmental variable. Alternatively, we could use a build script that uploads the correct <code class="literal">.ini</code> file to the correct environment.</p></div>
<div class="section" title="Phalcon Developer Tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Phalcon Developer Tools</h1></div></div></div><p>Now that we have done everything the hard way to get a feel of how Phalcon works, let's try doing the same in a quick, easy way. Phalcon Developer Tools are a set of tools that will help you get your project up and running quickly by generating a skeleton code<a id="id52" class="indexterm"/> for you. We will be using these in the upcoming chapters to generate a lot of things and then review the files that were created to learn how they work.</p><p>If you don't want to install the developer tools, no problem. The current skeleton we created manually will work as a base for the rest of the application with a few modifications that we will cover in this section. Phalcon is a very flexible framework. We will also be going through everything we generate with the developer tools in sufficient detail so that you will be able to create all your code manually if you so choose to. But I would advise you to use developer tools wherever you can and then fill in the gaps with custom code. It can really shorten your development time. First, let's install these tools.</p><div class="section" title="Installing Phalcon Developer Tools"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec11"/>Installing Phalcon Developer Tools</h2></div></div></div><p>Phalcon Developer Tools can be downloaded from the official Git repository available at <a class="ulink" href="https://github.com/phalcon/phalcon-devtools">https://github.com/phalcon/phalcon-devtools</a>. Alternatively, you can use Composer to install it as a library in <a id="id53" class="indexterm"/>your project. The reason why we have a <code class="literal">library</code> folder in our project's <code class="literal">app</code> folder<a id="id54" class="indexterm"/> is so that we can store PHP libraries that we may need in our application. Composer is a PHP package manager that will take care of these libraries with only a few commands. You can read more about Composer at <a class="ulink" href="http://getcomposer.org/">http://getcomposer.org/</a>.</p><p>Firstly, create a new file, <code class="literal">composer.json</code>, in the <code class="literal">library</code> folder, add the following lines of code in it, and save the file:</p><div class="informalexample"><pre class="programlisting">{
    "require": {
        "phalcon/devtools": "dev-master"
    }
}</pre></div><p>This is simply a <code class="literal">.json</code> file<a id="id55" class="indexterm"/> telling Composer that we want to include Phalcon Developer Tools in our project. If you have <code class="literal">curl</code> installed on your computer, open a terminal or an SSH window and browse to your <code class="literal">library</code> folder located at <code class="literal">phalconBlog</code> and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>curl -s http://getcomposer.org/installer | php</strong></span>
</pre></div><p>In Linux, you will most likely have <code class="literal">curl</code> installed. If you do not, you can simply download <code class="literal">composer.phar</code> from <a class="ulink" href="http://getcomposer.org/download/">http://getcomposer.org/download/</a> and put the file in your <code class="literal">lib</code> folder.</p><p>Next, we tell Composer to<a id="id56" class="indexterm"/> add Phalcon Developer Tools in our <code class="literal">lib</code> folder.</p><div class="informalexample"><pre class="programlisting">php composer.phar install</pre></div><p>This will work for you<a id="id57" class="indexterm"/> if your system's <code class="literal">PATH</code> variable has the location of your PHP executable in it. If you are working on Linux and PHP was installed with a package manager, then it most likely is. In Windows, you may have to locate your PHP executable and put its location in your path.</p><p>After Phalcon Developer Tools are downloaded via Composer, you must add the path <code class="literal">phalconBlog/app/library/vendor/phalcon/devtools/phalcon.php</code> to your system's <code class="literal">PATH</code> variable so that the Phalcon command will work.</p><p>Phalcon can also be installed with PEAR, the PHP package manager. For the purposes of this book, we have glossed over the details of installing the developer tools. Covering each operating system would be beyond the scope of this book:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can find out more details on all installations at <a class="ulink" href="https://github.com/phalcon/phalcon-devtools">https://github.com/phalcon/phalcon-devtools</a></li><li class="listitem" style="list-style-type: disc">For more details on installing Phalcon Developer Tools on Windows, please visit <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/wintools.html">http://docs.phalconphp.com/en/latest/reference/wintools.html</a></li><li class="listitem" style="list-style-type: disc">For details on installing these tools on Mac, see <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/mactools.html">http://docs.phalconphp.com/en/latest/reference/mactools.html</a></li><li class="listitem" style="list-style-type: disc">And for Linux, visit <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/linuxtools.html">http://docs.phalconphp.com/en/latest/reference/linuxtools.html</a></li></ul></div></div><div class="section" title="Generating a project skeleton"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec12"/>Generating a project skeleton</h2></div></div></div><p>Using one command, we<a id="id58" class="indexterm"/> are going to do just about everything we have already done in this chapter. Open up the command-line interface and browse to where you want to generate your project. You can actually delete our previously created project. You can either start over or build your new project in another location. Now, type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>phalcon project phalconBlog –-use-config-ini --enable-webtools</strong></span>
</pre></div><p>Suddenly, we will have a complete project structure built for us. You will notice a few differences between the generated project and the one we built from scratch. We will go over a few of those differences to see what has changed.</p><p>If you didn't use Phalcon <a id="id59" class="indexterm"/>Developer Tools, you will want to change your <code class="literal">config.ini</code> file to this version. This configuration file is going to have a few more settings, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[database]</strong></span>
<span class="strong"><strong>adapter  = Mysql</strong></span>
<span class="strong"><strong>host     = localhost</strong></span>
<span class="strong"><strong>username = root</strong></span>
<span class="strong"><strong>password = root</strong></span>
<span class="strong"><strong>dbname     = phalconblog</strong></span>

<span class="strong"><strong>[application]</strong></span>
<span class="strong"><strong>controllersDir = ../app/controllers/</strong></span>
<span class="strong"><strong>modelsDir      = ../app/models/</strong></span>
<span class="strong"><strong>viewsDir       = ../app/views/</strong></span>
<span class="strong"><strong>pluginsDir     = ../app/plugins/</strong></span>
<span class="strong"><strong>libraryDir     = ../app/library/</strong></span>
<span class="strong"><strong>baseUri        = /phalconBlog/</strong></span>
<span class="strong"><strong>cacheDir       = ../app/cache/</strong></span>

<span class="strong"><strong>[models]</strong></span>
<span class="strong"><strong>metadata.adapter = "Memory"</strong></span>
</pre></div><p>It adds a set of dummy database configurations. It adds a few more folders to the application section of our <code class="literal">.ini</code> file. The <code class="literal">baseUri</code> setting may cause you some issues. If the project you are creating is running in a subdirectory of your localhost, the generated setting will work. If you browse directly to the localhost and see the following message, you will have to change this <code class="literal">baseUri</code> setting:</p><div class="mediaobject"><img src="graphics/7873OS_02_01.png.jpg" alt="Generating a project skeleton"/></div><p>You will not notice any issues with the <code class="literal">baseUri</code> setting<a id="id60" class="indexterm"/> until you start including CSS and JavaScript files in your application <a id="id61" class="indexterm"/>and these files don't load. So, if your site is running in the main directory, change that line to the following line of code:</p><div class="informalexample"><pre class="programlisting">baseUri        = /</pre></div><p>You will also notice that the <code class="literal">views</code> folder has some new files in it with the <code class="literal">.volt</code> extension. There is an <code class="literal">index.volt</code> file in your index folder located at <code class="literal">app/views</code> and another <code class="literal">index.volt</code> file in the <code class="literal">views</code> folder located at <code class="literal">app</code><a id="id62" class="indexterm"/>. Let's take a look at the file in your <code class="literal">views</code> folder located at <code class="literal">app</code>.</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Phalcon PHP Framework&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    {{ content() }}
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>This file is the main layout for your whole application. Every view that your application serves will be wrapped by this file. The content of the body tags will be provided by the view. That is what the <code class="literal">{{ content() }}</code> tag is for. This is a Volt template tag. Volt is a template engine that is built into Phalcon. We will learn more about it in <a class="link" href="ch03.html" title="Chapter 3. Using Phalcon Models, Views, and Controllers">Chapter 3</a>, <span class="emphasis"><em>Using Phalcon Models, Views, and Controllers</em></span>.</p><p>The view that is served when you browse to your localhost is in the <code class="literal">index.volt</code> file in your <code class="literal">index</code> folder located at <code class="literal">app/views</code>.</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;Congratulations!&lt;/h1&gt;

&lt;p&gt;You're now flying with Phalcon. Great things are about to happen!&lt;/p&gt;</pre></div><p>This is just static HTML that lets you know everything has worked.</p><p>You will also notice that your bootstrap or your <code class="literal">index.php</code> file located at <code class="literal">public</code> is different. It now looks like the following code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;?php

error_reporting(E_ALL);

try {

  /**
   * Read the configuration
   */
  $config = new \Phalcon\Config\Adapter\Ini(__DIR__ . "/../app/config/config.ini");

  /**
   * Read auto-loader
   */
  include __DIR__ . "/../app/config/loader.php";

  /**
   * Read services
   */
  include __DIR__ . "/../app/config/services.php";

  /**
   * Handle the request
   */
  $application = new \Phalcon\Mvc\Application($di);
  
  echo $application-&gt;handle()-&gt;getContent();

} catch (\Exception $e) {
  echo $e-&gt;getMessage();
}</pre></div><p>It still loads our <code class="literal">.ini</code> file from the same place. However, it now loads two new files, <code class="literal">loader.php</code> and <code class="literal">services.php</code>, from our <code class="literal">config</code> folder. The rest of the file is about the same. The generated version<a id="id63" class="indexterm"/> simply breaks up the autoloader and the Dependency Injection container into separate files and includes them as configuration files, which does make a lot more sense. First, let's take a look at <code class="literal">loader.php</code> file located at <code class="literal">app/config</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php

$loader = new \Phalcon\Loader();

/**
 * We're a registering a set of directories taken from the configuration file
 */
$loader-&gt;registerDirs(
  array(
    $config-&gt;application-&gt;controllersDir,
    $config-&gt;application-&gt;modelsDir
  )
)-&gt;register();</pre></div><p>This is basically the same code that we used to<a id="id64" class="indexterm"/> have in our old bootstrap file. Now, let's look at <code class="literal">services.php</code> file located at <code class="literal">app/config</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
use Phalcon\DI\FactoryDefault,
  Phalcon\Mvc\View,
  Phalcon\Mvc\Url as UrlResolver,
  Phalcon\Db\Adapter\Pdo\Mysql as DbAdapter,
  Phalcon\Mvc\View\Engine\Volt as VoltEngine,
  Phalcon\Mvc\Model\Metadata\Memory as MetaDataAdapter,
  Phalcon\Session\Adapter\Files as SessionAdapter;
/**
 * The FactoryDefault Dependency Injector automatically registers the right services providing a full stack framework
 */
$di = new FactoryDefault();
/**
 * The URL component is used to generate all kind of urls in the application
 */
$di-&gt;set('url', function() use ($config) {
  $url = new UrlResolver();
  $url-&gt;setBaseUri($config-&gt;application-&gt;baseUri);
  return $url;
}, true);
/**
 * Setting up the view component
 */
$di-&gt;set('view', function() use ($config) {

  $view = new View();

  $view-&gt;setViewsDir($config-&gt;application-&gt;viewsDir);

  $view-&gt;registerEngines(array(
    '.volt' =&gt; function($view, $di) use ($config) {

      $volt = new VoltEngine($view, $di);

      $volt-&gt;setOptions(array(
        'compiledPath' =&gt; $config-&gt;application-&gt;cacheDir,
        'compiledSeparator' =&gt; '_'
      ));

      return $volt;
    },
    '.phtml' =&gt; 'Phalcon\Mvc\View\Engine\Php'
  ));

  return $view;
}, true);
/**
 * Database connection is created based in the parameters defined in the configuration file
 */
$di-&gt;set('db', function() use ($config) {
  return new DbAdapter(array(
    'host' =&gt; $config-&gt;database-&gt;host,
    'username' =&gt; $config-&gt;database-&gt;username,
    'password' =&gt; $config-&gt;database-&gt;password,
    'dbname' =&gt; $config-&gt;database-&gt;dbname
  ));
});
/**
 * If the configuration specifies the use of a metadata adapter, use it or use memory otherwise
 */
$di-&gt;set('modelsMetadata', function() {
  return new MetaDataAdapter();
});
/**
 * Start the session the first time a component requests the session service
 */
$di-&gt;set('session', function() {
  $session = new SessionAdapter();
  $session-&gt;start();
  return $session;
});</pre></div><p>There is definitely a lot more going on in this file than we can cover in this chapter. However, we will touch up on<a id="id65" class="indexterm"/> the new services that got added here in later chapters, and will end up adding a few more ourselves. You can see where we set our views directory with this line of code: <code class="literal">$view-&gt;setViewsDir($config-&gt;application-&gt;viewsDir);</code>. But, we definitely have more services loaded now than in our old bootstrap file. Now, we have a URL resolver, a template engine service, a database adapter, and a session service. These will become important later on in the book.</p></div><div class="section" title="Available commands"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec13"/>Available commands</h2></div></div></div><p>We will be exploring more commands in future chapters to generate the files we will need for our application, <a id="id66" class="indexterm"/>but here are some commands to get you started in exploring what these tools can do for you.</p><p>Typing <code class="literal">Phalcon</code> in your command line will give you the output (as shown in the following screenshot):</p><div class="mediaobject"><img src="graphics/7873OS_02_02.png.jpg" alt="Available commands"/></div><p>The <code class="literal">commands</code> command<a id="id67" class="indexterm"/> will actually print out this same list of available commands. We have already taken a look at the project command. We will explore the rest in the upcoming chapters.</p><p>Yet, you may have noticed that when we built our project with Phalcon Developer Tools, we used the <code class="literal">–enable-webtools</code> command<a id="id68" class="indexterm"/>. We have an even easier option while writing code for our application; we can generate code right in the browser.</p></div><div class="section" title="The web interface"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec14"/>The web interface</h2></div></div></div><p>Once we create a project with<a id="id69" class="indexterm"/> the command-line tool, <a id="id70" class="indexterm"/>we can do just about everything else that Phalcon Developer Tools can do in the browser. Navigate to <code class="literal">http://localhost/phalconBlog/webtools.php</code>, and you should see a page as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7873OS_02_03.png.jpg" alt="The web interface"/></div><p>We will learn about the power of this amazing<a id="id71" class="indexterm"/> tool in the next chapter.</p></div><div class="section" title="IDE stubs"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec15"/>IDE stubs</h2></div></div></div><p>Another feature of Phalcon Developer Tools is that they contain IDE stubs for the code hint and autocomplete features<a id="id72" class="indexterm"/> of your IDE. Because Phalcon is compiled in C, your IDE won't be able to index the classes and functions of the actual framework, like it could with the Zend framework, for example, which is written in PHP. The<a id="id73" class="indexterm"/> IDE stub files mirror the classes and functions in the Phalcon framework so that an IDE has access to their names and documentation.</p><p>In the <code class="literal">devtools</code> folder of our project located at <code class="literal">app/library/vendor/phalcon</code>, an <code class="literal">ide</code> folder will be present, and there are stubs for various versions of Phalcon in this <code class="literal">ide</code> folder. To use the current version of the stubs in our IDE, we would just add the path to the <code class="literal">1.2.4</code> folder of our project's external libraries in our IDE. The process of doing this will differ depending on which IDE you use, but you can find specific instructions to add the Phalcon IDE stubs to PhpStorm at <a class="ulink" href="http://phalconphp.com/en/download/stubs">http://phalconphp.com/en/download/stubs</a>.</p></div></div>
<div class="section" title="Setting up Phalcon\Debug"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Setting up Phalcon\Debug</h1></div></div></div><p>An optional step is to add the <code class="literal">Phalcon\Debug</code> component to the application. It only takes two lines of code to add it, and it will go a long way in helping you track down the causes of errors when they occur.</p><p>To add <code class="literal">Phalcon\Debug</code>, we are<a id="id74" class="indexterm"/> going to open up our bootstrap file, <code class="literal">index.php</code> file located at <code class="literal">public</code>, and add a couple of lines of code at the beginning of our code, remove the try-catch construction, leaving all the code in the <code class="literal">try</code> part untouched, and add our debugger.</p><div class="informalexample"><pre class="programlisting">&lt;?php

error_reporting(E_ALL);
    
$debug = new \Phalcon\Debug();
$debug-&gt;listen();

/**
 * Read the configuration
 */
$config = new \Phalcon\Config\Adapter\Ini(__DIR__ . "/../app/config/config.ini");</pre></div><p>Now, when we have an exception, instead of a <a id="id75" class="indexterm"/>standard ugly error, we will see a page that looks like the following screenshot:</p><div class="mediaobject"><img src="graphics/7673OS_02_04.png.jpg" alt="Setting up Phalcon\Debug"/></div><p>Instead of the standard stack trace, we are presented with the section of the code where the exception arose to examine for possible issues. We can also click on the Phalcon functions listed in our trace in order to be taken to the official Phalcon documentation page. <code class="literal">Phalcon\Debug</code> has a lot of features. You can learn about them more by creating exceptions in the application on purpose and examining the output or by reading more about the debugger at <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/debug.html">http://docs.phalconphp.com/en/latest/reference/debug.html</a>.</p></div>
<div class="section" title="Nginx configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Nginx configuration</h1></div></div></div><p>It is also possible to run Phalcon on Nginx. To run our project in Nginx, we would use the following configuration <a id="id76" class="indexterm"/>and skip using the <code class="literal">.htaccess</code> files, which are of no use in Nginx:</p><div class="informalexample"><pre class="programlisting">server {

    listen   80;
    server_name localhost;

    index index.php index.html index.htm;
    set $root_path '/var/www/phalcon/public';
    root $root_path;

    try_files $uri $uri/ @rewrite;

    location @rewrite {
        rewrite ^/(.*)$ /index.php?_url=/$1;
    }

    location ~ \.php {
        fastcgi_pass unix:/run/php-fpm/php-fpm.sock;
        fastcgi_index /index.php;

        include /etc/nginx/fastcgi_params;

        fastcgi_split_path_info       ^(.+\.php)(/.+)$;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
        root $root_path;
    }

    location ~ /\.ht {
        deny all;
    }
}</pre></div><p>You should only have to edit the <code class="literal">server_name</code> variable if yours is not <code class="literal">localhost</code> and the <code class="literal">$root_path</code> variable to the path to the <code class="literal">public</code> folder in your project. For more details on configuring <a id="id77" class="indexterm"/>Nginx for Phalcon projects, see <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/nginx.html">http://docs.phalconphp.com/en/latest/reference/nginx.html</a>, and for configuring <a id="id78" class="indexterm"/>Cherokee web <a id="id79" class="indexterm"/>server, see <a class="ulink" href="http://docs.phalconphp.com/en/latest/reference/cherokee.html">http://docs.phalconphp.com/en/latest/reference/cherokee.html</a>.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Summary</h1></div></div></div><p>In this chapter, we learned how to set up our skeleton application. We created folders, <code class="literal">.htaccess</code> files, and our bootstrap file. Then, we made our application more configurable by using a <code class="literal">.ini</code> file. Finally, we used Phalcon Developer Tools to make the whole job a lot quicker and easier.</p><p>In the next chapter, we will finally be serving pages in the browser when we learn about Phalcon's models, views, and controllers.</p></div></body></html>