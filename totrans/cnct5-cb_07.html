<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Working with Users and Permissions"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working with Users and Permissions</h1></div></div></div><p>In this chapter we will cover the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Checking if the current user is logged in</li><li class="listitem" style="list-style-type: disc">Getting the currently logged-in user</li><li class="listitem" style="list-style-type: disc">Loading a user by its ID</li><li class="listitem" style="list-style-type: disc">Loading a user by its username</li><li class="listitem" style="list-style-type: disc">Getting a user's info</li><li class="listitem" style="list-style-type: disc">Setting a user's attributes</li><li class="listitem" style="list-style-type: disc">Retrieving a user's attributes</li><li class="listitem" style="list-style-type: disc">Loading a group by its ID</li><li class="listitem" style="list-style-type: disc">Loading a group by its name</li><li class="listitem" style="list-style-type: disc">Adding a user to a group</li><li class="listitem" style="list-style-type: disc">Getting all of the users from a group</li><li class="listitem" style="list-style-type: disc">Checking if a user is a member of a group</li><li class="listitem" style="list-style-type: disc">Removing a user from a group</li><li class="listitem" style="list-style-type: disc">Logging out a user</li><li class="listitem" style="list-style-type: disc">Deleting a user</li><li class="listitem" style="list-style-type: disc">Getting the permission object</li><li class="listitem" style="list-style-type: disc">Checking if a user can write to a page</li><li class="listitem" style="list-style-type: disc">Checking if a user can edit a page</li><li class="listitem" style="list-style-type: disc">Checking a user's file permissions</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec118"/>Introduction</h1></div></div></div><p>One of concrete5's greatest attributes is the included functionality surrounding users and permissions. concrete5 makes it easy to control which users and user groups can access specific pages. Users in concrete5 can be site editors, administrators, community members, or any other role that site owners can devise.</p><p>In this chapter, we will explore several recipes that allow developers to interact with and manipulate user objects, groups, and their related permissions. The recipes in this chapter will empower concrete5 developers to incorporate the powerful user and permissions model into their own custom applications and websites.</p></div></div>
<div class="section" title="Checking if the current user is logged in"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec119"/>Checking if the current user is logged in</h1></div></div></div><p>One of the most common tasks in <a id="id455" class="indexterm"/>concrete5 development is finding out if a user is logged into the website. In this recipe, we will output some HTML to say hello to the <a id="id456" class="indexterm"/>logged-in user if they are logged in. If they are logged out, we will output a link to the login page.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec420"/>How to do it...</h2></div></div></div><p>The steps for checking if the current user is logged in are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check if the current user is logged in.<div class="informalexample"><pre class="programlisting">$isLoggedIn = User::isLoggedIn();</pre></div></li><li class="listitem">If they are logged in, show a welcome message.<div class="informalexample"><pre class="programlisting">if ($isLoggedIn) {
  echo '&lt;p&gt;Thanks for logging in!&lt;/p&gt;';
}</pre></div></li><li class="listitem">Otherwise, show a link to the login page.<div class="informalexample"><pre class="programlisting">else {
  echo '&lt;a href="/login"&gt;Login&lt;/a&gt;';
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec421"/>How it works...</h2></div></div></div><p>The user model contains a static function called <code class="literal">isLoggedIn</code> which will simply return a Boolean result. This does not bring any sort of permission checks into the mix, only checks to see if the person viewing the page is logged in at all.</p></div></div>
<div class="section" title="Getting the currently logged-in user"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec120"/>Getting the currently logged-in user</h1></div></div></div><p>concrete5 makes it easy to get the <a id="id457" class="indexterm"/>object of the currently logged-in user. In this <a id="id458" class="indexterm"/>recipe, we will output the the username of the currently logged-in user.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec422"/>Getting ready</h2></div></div></div><p>It is a good idea to make sure the user is logged in at all before attempting to display their username. We will use the skills from the previous recipe to make sure the user is logged first.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec423"/>How to do it...</h2></div></div></div><p>The steps for getting the currently logged-in user are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check if the user is logged in.<div class="informalexample"><pre class="programlisting">$isLoggedIn = User::isLoggedIn();</pre></div></li><li class="listitem">If the user is logged in, create a new instance of the <code class="literal">User</code> class.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Echo the username of the <code class="literal">user</code> object.<div class="informalexample"><pre class="programlisting">echo $user-&gt;getUsername();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec424"/>How it works...</h2></div></div></div><p>concrete5 makes it incredibly easy to get the currently logged-in user. Essentially, we only have to instantiate the <code class="literal">User</code> class, which will return an object representing the currently logged-in user.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec425"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Checking if the current user is logged in</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a user's info</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Loading a user by its ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec121"/>Loading a user by its ID</h1></div></div></div><p>Developers can also load users <a id="id459" class="indexterm"/>by their unique IDs. In this recipe, we will load the user with the <a id="id460" class="indexterm"/>ID of 1 and output their username.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec426"/>How to do it...</h2></div></div></div><p>The steps for loading a user by its ID are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Determine the ID of the user that you wish to load. In this example, we will load the user with an ID of 1.<div class="informalexample"><pre class="programlisting">$userId = 1;</pre></div></li><li class="listitem">Load a user by its ID.<div class="informalexample"><pre class="programlisting">$user = User::getByUserID($userId);</pre></div></li><li class="listitem">Echo out the user's username.<div class="informalexample"><pre class="programlisting">echo $user-&gt;getUserName();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec427"/>How it works...</h2></div></div></div><p>concrete5 will look in the <code class="literal">Users</code> table <a id="id461" class="indexterm"/>of the database and return a user object populated with data <a id="id462" class="indexterm"/>from that corresponding record.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec428"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a user by its username</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Loading a user by its username"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec122"/>Loading a user by its username</h1></div></div></div><p>In addition to being able to load <a id="id463" class="indexterm"/>users by their IDs, developers can also load users by their <a id="id464" class="indexterm"/>usernames. In this recipe, we will load a user with the username of admin and output their numerical ID.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec429"/>How to do it...</h2></div></div></div><p>The steps for loading a user by its username are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Determine the username of the user that you are loading.<div class="informalexample"><pre class="programlisting">$username = 'admin';</pre></div></li><li class="listitem">Load the user by its username.<div class="informalexample"><pre class="programlisting">$user = UserInfo::getByUserName($username);</pre></div></li><li class="listitem">Echo the user's ID.<div class="informalexample"><pre class="programlisting">echo $user-&gt;getUserID();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec430"/>How it works...</h2></div></div></div><p>Hey, that was easy! The <code class="literal">UserInfo</code> <a id="id465" class="indexterm"/>class contains methods to load a user by its username rather than just its ID. The <code class="literal">UserInfo</code> class <a id="id466" class="indexterm"/>also has a method to get the numerical user ID, for the user.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec431"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a user by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> <a id="id467" class="indexterm"/>recipe</li></ul></div></div></div>
<div class="section" title="Getting a user's info"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec123"/>Getting a user's info</h1></div></div></div><p>User objects carry a lot of information <a id="id468" class="indexterm"/>with them, including the user's username, e-mail, and several other attributes. In this recipe, we will run through several functions to retrieve data associated with users.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec432"/>Getting ready</h2></div></div></div><p>The code for this chapter doesn't necessarily belong to any specific place in concrete5. The steps for this recipe are basic, one-line functions to demonstrate the different ways to get data from a user object. If you'd like a place to just write arbitrary code and have concrete5 evaluate it, the <code class="literal">site_post.php</code> file in <code class="literal">config/</code> is a pretty good place to start.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec433"/>How to do it...</h2></div></div></div><p>The steps for getting a user's info are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we will load the currently logged-in user.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Get the user's ID.<div class="informalexample"><pre class="programlisting">$userId = $user-&gt;getUserID();</pre></div></li><li class="listitem">Get the user's username.<div class="informalexample"><pre class="programlisting">$username = $user-&gt;getUserName();</pre></div></li><li class="listitem">Check if the user is registered on the site.<div class="informalexample"><pre class="programlisting">$isRegistered = $user-&gt;isRegistered();</pre></div></li><li class="listitem">Check if the user's account is active.<div class="informalexample"><pre class="programlisting">$isActive = $user-&gt;isActive();</pre></div></li><li class="listitem">Check if the user is the super admin.<div class="informalexample"><pre class="programlisting">$isSuper = $user-&gt;isSuperUser();</pre></div></li><li class="listitem">Load the <code class="literal">UserInfo</code> object, which contains even more information about the user.<div class="informalexample"><pre class="programlisting">$userInfo = UserInfo::getByID($userId);</pre></div></li><li class="listitem">Get the user's e-mail address.<div class="informalexample"><pre class="programlisting">$email = $userInfo-&gt;getUserEmail();</pre></div></li><li class="listitem">Get the user's encrypted password.<div class="informalexample"><pre class="programlisting">$password = $userInfo-&gt;getUserPassword();</pre></div></li><li class="listitem">Get the number of times the user has logged in.<div class="informalexample"><pre class="programlisting">$loginCount = $userInfo-&gt;getNumLogins();</pre></div></li><li class="listitem">Find out if the user has verified their e-mail address.<div class="informalexample"><pre class="programlisting">$verifiedEmail = $userInfo-&gt;isValidated();</pre></div></li><li class="listitem">Get the Unix timestamp of the previous time that this user logged in.<div class="informalexample"><pre class="programlisting">$previousLogin = $userInfo-&gt;getPreviousLogin();</pre></div></li><li class="listitem">Find out if the user has an avatar uploaded to the site.<div class="informalexample"><pre class="programlisting">$hasAvatar = $userInfo-&gt;hasAvatar();</pre></div></li><li class="listitem">Find out when the user was added to the website.<div class="informalexample"><pre class="programlisting">$dateAdded = $userInfo-&gt;getUserDateAdded();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec434"/>How it works...</h2></div></div></div><p>The <code class="literal">User</code> class contains a couple of <a id="id469" class="indexterm"/>methods to retrieve basic user data, such as a user's ID and username. When developers want to see more information about a user, though, they will need to use the <code class="literal">UserInfo</code> class.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec435"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Setting a user's attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec124"/>Setting a user's attributes</h1></div></div></div><p>Users in concrete5 can have <a id="id470" class="indexterm"/>custom attributes that get defined through the interface. Imagine a <a id="id471" class="indexterm"/>website where you would like to know your users' ages. concrete5 does not provide an age field for users out of the box, but one can easily be added using attributes.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec436"/>Getting ready</h2></div></div></div><p>First, you will want to make sure that the attribute exists in the concrete5 site before trying to set it. Go to <code class="literal">http://example.com/dashboard/users/attributes</code> (replacing <code class="literal">example.com</code> with your own domain name, of course) and make sure that the attribute that you are creating exists. The <a id="id472" class="indexterm"/>page will look similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/4548OS_07_01.jpg" alt="Getting ready"/></div><p>In this recipe, we will work with an attribute with the handle of age, so feel free to create that attribute to follow along.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec437"/>How to do it...</h2></div></div></div><p>The steps for setting a user's <a id="id473" class="indexterm"/>attributes are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the currently logged-in user.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Load the <code class="literal">UserInfo</code> <a id="id474" class="indexterm"/>object for that user.<div class="informalexample"><pre class="programlisting">$userInfo = UserInfo::getByUserID($user-&gt;getUserID());</pre></div></li><li class="listitem">Set the age attribute to <code class="literal">35</code>.<div class="informalexample"><pre class="programlisting">$userInfo-&gt;setAttribute('age', 35);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec438"/>How it works...</h2></div></div></div><p>The <code class="literal">UserInfo</code> class contains a function called <a id="id475" class="indexterm"/>
<code class="literal">setAttribute</code> which will accept either a string that represents the attribute key handle, or an actual instance of an <code class="literal">AttributeKey</code> <a id="id476" class="indexterm"/>object. In this recipe, we opted for the <a id="id477" class="indexterm"/>simpler approach of providing the attribute handle in a string.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec439"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Retrieving a user's attributes</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a user's info</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Retrieving a user's attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec125"/>Retrieving a user's attributes</h1></div></div></div><p>In addition to setting attributes, <a id="id478" class="indexterm"/>we can also retrieve them. In this recipe, we will retrieve the attribute for the user's age, which we set in the previous recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec440"/>Getting ready</h2></div></div></div><p>As in the previous recipe, you will need to make sure that any attributes you are retrieving actually exist in concrete5. In this <a id="id479" class="indexterm"/>case, we will be referencing an attribute with the handle of <code class="literal">age</code>. If your concrete5 system does not have a user attribute available called age, please adapt this recipe to fit your needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec441"/>How to do it...</h2></div></div></div><p>The steps for retrieving a user's attributes are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the currently logged-in user.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Get the <code class="literal">user info</code> object for the user.<div class="informalexample"><pre class="programlisting">$userInfo = UserInfo::getByID($user-&gt;getUserID());</pre></div></li><li class="listitem">Get the value of the user's age attribute.<div class="informalexample"><pre class="programlisting">$age = $userInfo-&gt;getAttribute('age');</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec442"/>How it works...</h2></div></div></div><p>concrete5 provides a simple API to retrieve attributes from users. In the database, attribute keys and values are spread over <a id="id480" class="indexterm"/>several tables and are difficult to query manually. This method is the preferred way to retrieve user attributes.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec443"/>There's more...</h2></div></div></div><p>concrete5 also makes use of "magic methods" to <a id="id481" class="indexterm"/>retrieve user attributes. Essentially, call a function with the camel-cased version <a id="id482" class="indexterm"/>of the attribute handle, preceded by the word <code class="literal">get</code>. In this recipe, to get the user's age, we could simply write the following code:</p><div class="informalexample"><pre class="programlisting">$age = $userInfo-&gt;getAge();</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec444"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting a user's attributes</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a user's info</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Loading a group by its ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec126"/>Loading a group by its ID</h1></div></div></div><p>Groups in concrete5 are ways to <a id="id483" class="indexterm"/>organize users by their role on the website. Groups can receive permission settings just like users can. In this recipe, we will load a group with the ID of <a id="id484" class="indexterm"/>3 (which is the Administrators' group on most concrete5 installations).</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec445"/>How to do it...</h2></div></div></div><p>The steps for loading a group by its ID are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Determine the ID of the group that we want to load.<div class="informalexample"><pre class="programlisting">$groupId = 3;</pre></div></li><li class="listitem">Load the group by its ID.<div class="informalexample"><pre class="programlisting">$group = Group::getByID($groupId);</pre></div></li><li class="listitem">Dump the name of the group variable to ensure that it has loaded correctly.<div class="informalexample"><pre class="programlisting">echo $group-&gt;gName;
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec446"/>How it works...</h2></div></div></div><p>concrete5 will simply query the <code class="literal">Groups</code> <a id="id485" class="indexterm"/>table in the database to find the group record that <a id="id486" class="indexterm"/>corresponds to the provided ID.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec447"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a group by its name</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Loading a group by its name"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec127"/>Loading a group by its name</h1></div></div></div><p>Groups can be loaded by their name, <a id="id487" class="indexterm"/>which can be useful when you do not know the <a id="id488" class="indexterm"/>numeric ID of the group.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec448"/>How to do it...</h2></div></div></div><p>The steps for loading a group by its name are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define the name of the group that you wish to load.<div class="informalexample"><pre class="programlisting">$groupName = 'Administrators';</pre></div></li><li class="listitem">Load the group by its name.<div class="informalexample"><pre class="programlisting">$group = Group::getByName($groupName);</pre></div></li><li class="listitem">Dump the group variable to make sure that you have loaded the group correctly.<div class="informalexample"><pre class="programlisting">var_dump($group);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec449"/>How it works...</h2></div></div></div><p>concrete5 queries the database to find the group that has the same name that you provided to the <code class="literal">getByName</code> function. <a id="id489" class="indexterm"/>Group names can be changed through the concrete5 dashboard any time, so use caution when hardcoding group names in your applications.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec450"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a group by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Adding a user to a group"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec128"/>Adding a user to a group</h1></div></div></div><p>While the concrete5 dashboard <a id="id490" class="indexterm"/>provides a simple interface to add users to different groups, sometimes you will encounter the need to do it programmatically. In this recipe, we <a id="id491" class="indexterm"/>will add a user with the ID of 1 to the Administrators' group, which has an ID of 3.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec451"/>How to do it...</h2></div></div></div><p>The steps for adding a user to a group are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define the ID of the user that you would like to load.<div class="informalexample"><pre class="programlisting">$userId = 1;</pre></div></li><li class="listitem">Load the user by its ID.<div class="informalexample"><pre class="programlisting">$user = User::getByID($userId);</pre></div></li><li class="listitem">Define the ID of the group that you would like to add the user to.<div class="informalexample"><pre class="programlisting">$groupId = 3;</pre></div></li><li class="listitem">Load the group by its ID.<div class="informalexample"><pre class="programlisting">$group = Group::getByID($groupId);</pre></div></li><li class="listitem">Add the user to the group.<div class="informalexample"><pre class="programlisting">$user-&gt;enterGroup($group);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec452"/>How it works...</h2></div></div></div><p>When the <code class="literal">enterGroup</code> function of the <a id="id492" class="indexterm"/>user model is called, the user will be added to the group that was passed as the first parameter. The user now will inherit all of the permissions associated with that group.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec453"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a user by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a group by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Removing a user from a group</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting all of the users from a group"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec129"/>Getting all of the users from a group</h1></div></div></div><p>Once you have loaded a group <a id="id493" class="indexterm"/>object, you can easily iterate through the users that are <a id="id494" class="indexterm"/>members of that group. In this recipe, we will load a group, and then output the username of each member within the group.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec454"/>How to do it...</h2></div></div></div><p>The steps for getting all of the users from a group are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define the ID of the group <a id="id495" class="indexterm"/>that you wish to load.<div class="informalexample"><pre class="programlisting">$groupId = 3;</pre></div></li><li class="listitem">Load the group by its ID.<div class="informalexample"><pre class="programlisting">$group = Group::getByID($groupId);</pre></div></li><li class="listitem">Get an array of group members.<div class="informalexample"><pre class="programlisting">$members = $group-&gt;getGroupMembers();</pre></div></li><li class="listitem">Loop through the members array, echoing the user's name.<div class="informalexample"><pre class="programlisting">foreach ($members as $member) {
  echo $member-&gt;getUserName().'&lt;br /&gt;';
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec455"/>How it works...</h2></div></div></div><p>As usual, concrete5 does the heavy lifting here in regards to querying the database to find all of the user accounts that are members of the group that has been loaded. The <code class="literal">getGroupMembers</code> function returns an <a id="id496" class="indexterm"/>array of <code class="literal">UserInfo</code> objects, which can be used to read and modify the members of the group.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec456"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a group by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a user's info</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Checking if a user is a member of a group"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec130"/>Checking if a user is a member of a group</h1></div></div></div><p>concrete5 comes with a <a id="id497" class="indexterm"/>robust permissions model, but sometimes developers will <a id="id498" class="indexterm"/>want to do simple permissions and access control tasks on their own. In this recipe, we will see if a user is in the Administrators' group. We will then display a message that indicates if they are an administrator or not.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec457"/>How to do it...</h2></div></div></div><p>The steps for checking if a user is a member of a group are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the currently logged-in user.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Determine the ID of the group that you wish to load (in this case, it's the Administrators' group with an ID of 3).<div class="informalexample"><pre class="programlisting">$groupId = 3; // administrators</pre></div></li><li class="listitem">Load the group by its ID.<div class="informalexample"><pre class="programlisting">$group = Group::getByID($groupId);</pre></div></li><li class="listitem">Check if the user is a member of the group.<div class="informalexample"><pre class="programlisting">$isAdmin = $user-&gt;inGroup($group);</pre></div></li><li class="listitem">Display a message to the user confirming or denying if they are a member of the Administrators' group.<div class="informalexample"><pre class="programlisting">if ($isAdmin) {
  echo 'You\'re an administrator!';
}
else {
  echo 'You are not an administrator.';
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec458"/>How it works...</h2></div></div></div><p>concrete5 checks to see if the user is a <a id="id499" class="indexterm"/>member of the specified group object and <a id="id500" class="indexterm"/>returns a Boolean value.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec459"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a group by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Removing a user from a group"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec131"/>Removing a user from a group</h1></div></div></div><p>In addition to being able to add <a id="id501" class="indexterm"/>users to groups, concrete5 also allows developers to <a id="id502" class="indexterm"/>perform the opposite task: removing users from groups. In this recipe, we will remove a user from the Administrators' group.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec460"/>How to do it...</h2></div></div></div><p>The steps for removing a user from a group are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the currently logged-in user.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Define the ID of the group that you wish to load.<div class="informalexample"><pre class="programlisting">$groupId = 3; // administrators</pre></div></li><li class="listitem">Load the group by its ID.<div class="informalexample"><pre class="programlisting">$group = Group::getByID($groupId);</pre></div></li><li class="listitem">Check to see if this user is a member of the group.<div class="informalexample"><pre class="programlisting">$inGroup = $user-&gt;inGroup($group);</pre></div></li><li class="listitem">If the user is a member, <a id="id503" class="indexterm"/>remove them from the group.<div class="informalexample"><pre class="programlisting">if ($inGroup) {
  $user-&gt;exitGroup($group);
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec461"/>How it works...</h2></div></div></div><p>In this case concrete5 will simply <a id="id504" class="indexterm"/>remove the association between the user and the group. The user will lose all of the permissions that it had inherited from the group.</p></div><div class="section" title="See also..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec462"/>See also...</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding a user to a group</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Loading a group by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Checking if a user is a member of a group</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Logging out a user"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec132"/>Logging out a user</h1></div></div></div><p>concrete5 also contains functionality <a id="id505" class="indexterm"/>to log users out of the system programmatically. In this recipe, we will log out the user who is currently logged in.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec463"/>How to do it...</h2></div></div></div><p>The steps for logging out a user are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check if the user is logged in.<div class="informalexample"><pre class="programlisting">$loggedIn = User::isLoggedIn();</pre></div></li><li class="listitem">Load the logged-in user.<div class="informalexample"><pre class="programlisting">$user = new User();</pre></div></li><li class="listitem">Log out the user.<div class="informalexample"><pre class="programlisting">if ($loggedIn) {
  $user-&gt;logout();
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec464"/>How it works...</h2></div></div></div><p>concrete5 deletes the current session, effectively logging the user out.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec465"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Checking if the current user is logged in</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the currently logged-in user</em></span> <a id="id506" class="indexterm"/>recipe</li></ul></div></div></div>
<div class="section" title="Deleting a user"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec133"/>Deleting a user</h1></div></div></div><p>In this recipe, we will load a user <a id="id507" class="indexterm"/>with the ID of 3 and delete that user from concrete5.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec466"/>How to do it...</h2></div></div></div><p>The steps for deleting a user are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define the ID of the user that you wish to delete.<div class="informalexample"><pre class="programlisting">$userId = 3;</pre></div></li><li class="listitem">Load the <code class="literal">UserInfo</code> object for that user.<div class="informalexample"><pre class="programlisting">$user = UserInfo::getByID($userId);</pre></div></li><li class="listitem">Delete the user.<div class="informalexample"><pre class="programlisting">$user-&gt;delete();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec467"/>How it works...</h2></div></div></div><p>concrete5 will remove the user as well as all of their attributes from the database. This action is permanent and cannot be reversed, short of restoring a database backup.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec468"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a user's info</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting the permission object"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec134"/>Getting the permission object</h1></div></div></div><p>Verifying and modifying page <a id="id508" class="indexterm"/>permissions, centers around the permissions object. In this recipe, we will load the permissions object for a page.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec469"/>How to do it...</h2></div></div></div><p>The steps for getting the permission object are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Specify the path of the page for which you want to check the permissions settings.<div class="informalexample"><pre class="programlisting">$path = '/about';</pre></div></li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath($path);</pre></div></li><li class="listitem">Load the <code class="literal">permissions</code> object for that page.<div class="informalexample"><pre class="programlisting">$permissions = new Permissions($page);</pre></div></li><li class="listitem">Dump the <code class="literal">permissions</code> object to verify its contents.<div class="informalexample"><pre class="programlisting">var_dump($permissions);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec470"/>How it works...</h2></div></div></div><p>concrete5 will return a <code class="literal">permissions</code> object that can be further used to determine if a user has access to perform various <a id="id509" class="indexterm"/>actions on that page.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec471"/>There's more...</h2></div></div></div><p>You can get the <code class="literal">permissions</code> objects for content areas and blocks as well, just pass a block or area object to the <code class="literal">Permissions</code> constructor instead of a <code class="literal">Page</code> object.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec472"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> in <a class="link" href="ch01.html" title="Chapter 1. Pages and Page Types">Chapter 1</a>, <span class="emphasis"><em>Pages and Page Types</em></span></li></ul></div></div></div>
<div class="section" title="Checking if a user can read a page"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec135"/>Checking if a user can read a page</h1></div></div></div><p>You may find that sometimes <a id="id510" class="indexterm"/>you will want to manually find out if a user is allowed to read a particular page. In this recipe, we will load a page by its path, get the <code class="literal">permissions</code> object for it, and then find out if the user is allowed to view it.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec473"/>How to do it...</h2></div></div></div><p>The steps for checking if a user can read a page are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Determine the path of the page to load.<div class="informalexample"><pre class="programlisting">$path = '/about';</pre></div></li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath($path);</pre></div></li><li class="listitem">Load the <code class="literal">permissions</code> object for that page.<div class="informalexample"><pre class="programlisting">$permissions = new Permissions($page);</pre></div></li><li class="listitem">Find out if the user is allowed to read that page.<div class="informalexample"><pre class="programlisting">$canRead = $permissions-&gt;canRead();
var_dump($canRead);
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec474"/>How it works...</h2></div></div></div><p>concrete5 will check all of the permissions for that <code class="literal">Page</code> object, including group and user permissions, to find out if the current <a id="id511" class="indexterm"/>user is allowed to view that page. The <span class="emphasis"><em>canRead</em></span> function returns a Boolean value.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec475"/>There's more...</h2></div></div></div><p>Read permissions can also be checked for content areas and blocks by simply providing an area or block object to the <code class="literal">Permissions</code> constructor, instead of a <code class="literal">Page</code> object.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec476"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> in <a class="link" href="ch01.html" title="Chapter 1. Pages and Page Types">Chapter 1</a>, <span class="emphasis"><em>Pages and Page Types</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the permission object</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Checking if a user can edit a page"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec136"/>Checking if a user can edit a page</h1></div></div></div><p>In addition to being able to check <a id="id512" class="indexterm"/>if users can view pages, developers can also manually check to see if the logged-in user has the ability to edit a page. In this recipe, we will load a page by its path, get the <code class="literal">permissions</code> object for that page, and then find out if the user is allowed to edit it.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec477"/>How to do it...</h2></div></div></div><p>The steps for checking if a user can edit a page are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Specify the page path to load.<div class="informalexample"><pre class="programlisting">$path = '/about';</pre></div></li><li class="listitem">Load the page.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath($path);</pre></div></li><li class="listitem">Load the <code class="literal">permissions</code> object for the page.<div class="informalexample"><pre class="programlisting">$permissions = new Permissions($page);</pre></div></li><li class="listitem">Find out if the user can edit the page.<div class="informalexample"><pre class="programlisting">$canEdit = $permissions-&gt;canWrite();
var_dump($canEdit);
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec478"/>How it works...</h2></div></div></div><p>concrete5 will look at the user's own permission settings as well as the settings for any groups that it is a member of, and determine if the user has the ability to edit or write to the given page.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec479"/>There's more...</h2></div></div></div><p>As with read permissions, content area <a id="id513" class="indexterm"/>and block permissions can also be checked using this method. Simply provide an instance of an area or block instead of a page, and the permissions will be checked against those items instead.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec480"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the permission object</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Checking a user's file permissions"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec137"/>Checking a user's file permissions</h1></div></div></div><p>concrete5 allows site owners to <a id="id514" class="indexterm"/>specify permissions on the file manager. <a id="id515" class="indexterm"/>In this recipe, we will see if a user is allowed to upload files to the file manager.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec481"/>How to do it...</h2></div></div></div><p>The steps for checking a user's file permissions are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Load the <code class="literal">FilePermissions</code> global object.<div class="informalexample"><pre class="programlisting">$permissions = FilePermissions::getGlobal();</pre></div></li><li class="listitem">Check if the user can view the <code class="literal">file manager</code> interface.<div class="informalexample"><pre class="programlisting">$canUpload = $permissions-&gt;canAddFiles();</pre></div></li><li class="listitem">Check if the user can upload to the file manager.<div class="informalexample"><pre class="programlisting">$canViewFileManager = $permissions-&gt;canAccessFileManager();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec482"/>How it works...</h2></div></div></div><p>The <code class="literal">FilePermissions</code> class extends the <code class="literal">Permissions</code> class, and allows users to check the global settings of the file manager.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec483"/>There's more...</h2></div></div></div><p>concrete5 also allows developers to <a id="id516" class="indexterm"/>check if a user is allowed to upload files of a specific type.</p><div class="informalexample"><pre class="programlisting">$canUploadMp3 = $permissions-&gt;canAddFileType('mp3');</pre></div></div></div></body></html>