<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Creating a Simple News Reader"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Creating a Simple News Reader</h1></div></div></div><p>This chapter explains how to write your first controller in order to display news items list and details, make interactions between controllers and views, and then customize the view's layout.</p><p>In this chapter, we will go through the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating controller and action</li><li class="listitem" style="list-style-type: disc">Creating a view to display the news list</li><li class="listitem" style="list-style-type: disc">How the controller sends the data to view<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – create a controller to display the static news items list and details</li></ul></div></li><li class="listitem" style="list-style-type: disc">Split the common view content into reusable views<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – render partial in view</li></ul></div></li><li class="listitem" style="list-style-type: disc">Creating static pages</li><li class="listitem" style="list-style-type: disc">Share data between views and layout<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – change layout background based on the URL parameter</li></ul></div></li><li class="listitem" style="list-style-type: disc">Layout with dynamic blocks<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – add dynamic box to display advertising info</li></ul></div></li><li class="listitem" style="list-style-type: disc">Using multiple layouts<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – using different layout to create responsive and not responsive layout for the same view</li></ul></div></li></ul></div><div class="section" title="Creating Controller and Action"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Creating Controller and Action</h1></div></div></div><p>In order to handle a request, the first thing to do is to create a new <a id="id80" class="indexterm"/>controller.</p><p>The things you must <a id="id81" class="indexterm"/>remember while creating a file controller<a id="id82" class="indexterm"/> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The namespace at the top (in basic application usually app\controllers)</li><li class="listitem" style="list-style-type: disc">The <code class="literal">use</code> path for used class</li><li class="listitem" style="list-style-type: disc">The controller class must extend the <code class="literal">yii\web\Controller</code> class</li><li class="listitem" style="list-style-type: disc">The actions are handled from controller functions whose name starts with <code class="literal">action</code> and the first letter of each word is in uppercase</li></ul></div><p>Let's point to <code class="literal">basic/controllers</code> and create a file named <code class="literal">NewsController.php</code>.</p><p>Then, create a class with the same name as the file and extend it from controller; finally, create an action named <code class="literal">index</code> to manage request for <code class="literal">news/index</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php

// 1. specify namespace at the top (in basic application usually app\controllers);
namespace app\controllers;

// 2. specify 'use' path for used class;
use Yii;
use yii\web\Controller;

// 3. controller class must extend yii\web\Controller class;
// This line is equivalent to
// class NewsController extends yii\web\Controller
class NewsController extends Controller
{
// 4. actions are handled from controller functions whose name starts with 'action' and the first letter of each word is uppercase;
    public function actionIndex()
    {
            echo "this is my first controller";
    }
}</pre></div><p>If we try to point the browser to <code class="literal">http://hostname/basic/web/index.php?r=news/index</code>, we will see a blank page with the notice <span class="strong"><strong>this is my first controller</strong></span>.</p><p>Now, let's see which common errors can occur when we ignore those four things to remember mentioned at the top of this chapter.</p><p>The <a id="id83" class="indexterm"/>namespace defines the hierarchical organization for names <a id="id84" class="indexterm"/>used in our application. If we forget to declare a namespace, Yii2 with <code class="literal">YII_DEBUG</code> set to true in <code class="literal">web/index.php</code>, will display the following error message:</p><div class="mediaobject"><img src="graphics/B04656_02_01.jpg" alt="Creating Controller and Action"/><div class="caption"><p>The missing Controller namespace</p></div></div><p>Yii2 reports an error in an excellent way, giving us the possibility to solve it by checking if we are missing the namespace.</p><p>Then, the <code class="literal">Use</code> keyword is employed to specify the complete path of a class in the application. A class that has a <code class="literal">path/to/class/ClassName</code> complete path, can be referenced in the app using only <code class="literal">ClassName</code> if we put an <code class="literal">use  path/to/class/ClassName</code> just after namespace declaration.</p><p>However, if we use just <code class="literal">ClassName</code> without defining the <code class="literal">use</code> declaration at the top of the file, an error such as the following can occur:</p><div class="mediaobject"><img src="graphics/B04656_02_02.jpg" alt="Creating Controller and Action"/></div><p>This error is simple to explain, but harder to find, especially for beginners.</p><p>In this case, the screenshot shows that it has been used the <code class="literal">Controller</code> name (after the <code class="literal">extends</code> keyword) at row 9. Since there is no complete path for the <code class="literal">Controller</code> class name, Yii2 will try to look for the <code class="literal">Controller</code> class under <code class="literal">app\controllers</code>, without finding it.</p><p>To solve<a id="id85" class="indexterm"/> this problem, we must change <code class="literal">Controller</code> with <code class="literal">yii\web\Controller</code> at row 9 and for all the next rows that will use the <code class="literal">Controller</code> class name <a id="id86" class="indexterm"/>without defining a complete class path, or that insert a <code class="literal">use</code> declaration at the top of the file, we must employ <code class="literal">yii\web\Controller</code>.</p><p>A controller is always a subclass of <code class="literal">yii\web\Controller</code> or simply, if we have used the keyword <code class="literal">use</code>, a subclass of <code class="literal">Controller</code>. Action names follow the rules described in the previous chapter.</p></div></div>
<div class="section" title="Creating a view to display a news list"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Creating a view to display a news list</h1></div></div></div><p>Now, we will create a <a id="id87" class="indexterm"/>simple news list in a view named <code class="literal">itemsList</code>. We will point to this view from <code class="literal">NewsController</code>, so we have to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a <code class="literal">news</code> folder under <code class="literal">basic/views</code>, that <code class="literal">NewsController</code> will use as the base folder to search for the views to be rendered (according to the view names' rules explained in the previous chapter)</li><li class="listitem" style="list-style-type: disc">Create an <code class="literal">itemsList.php</code> file under <code class="literal">basic/views/news</code></li></ul></div><p>Now, open <code class="literal">basic/views/news/itemsList.php</code>, create an array with a list of data and display the output with a simple table of items:</p><div class="informalexample"><pre class="programlisting">&lt;?php
    $newsList = [
        [ 'title' =&gt; 'First World War', 'date' =&gt; '1914-07-28' ],
        [ 'title' =&gt; 'Second World War', 'date' =&gt; '1939-09-01' ],
        [ 'title' =&gt; 'First man on the moon', 'date' =&gt; '1969-07-20' ]
    ];
?&gt;

&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;Title&lt;/th&gt;
        &lt;th&gt;Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php foreach($newsList as $item) { ?&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;?php echo $item['title'] ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?php echo $item['date'] ?&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;?php } ?&gt;
&lt;/table&gt;</pre></div><p>Then, we need to <a id="id88" class="indexterm"/>create an action provided by a function named <code class="literal">actionItemsList</code> that will be rendered by <code class="literal">http://hostname/basic/web/index.php?r=news/items-list</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Pay attention to names for routes, controllers, and actions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The route for this action is <code class="literal">news/items-list</code> (lowercase and words separated by dashes);</li><li class="listitem" style="list-style-type: disc">The controller class name is <code class="literal">NewsController</code> (uppercase with the word Controller in the end);</li><li class="listitem" style="list-style-type: disc">The action function name in <code class="literal">NewsController</code> is <code class="literal">actionItemsList</code> (the function name has <code class="literal">action</code> word as prefix, dashes in the route are removed, and the first letter of each word is in uppercase);</li></ul></div></div></div><p>The function to append in the <code class="literal">NewsController</code> class is as follows:</p><div class="informalexample"><pre class="programlisting">public function actionItemsList()
{
     return $this-&gt;render('itemsList');
}</pre></div><p>The <code class="literal">render()</code> method that belongs to <code class="literal">\yii\web\Controller</code>, displays in the layout content of the view passed as the first parameter. When the framework is looking for the view, it will append <code class="literal">.php</code> extension to the name passed as the first parameter of the <code class="literal">render()</code> method and it will look for it in <code class="literal">basic/view/news</code>. The last member of the path is the name that is calling the <code class="literal">render()</code> method.</p><p>Now, we can <a id="id89" class="indexterm"/>point to <code class="literal">http://hostname/basic/web/index.php?r=news/items-list</code>, to see our beautiful table!</p></div>
<div class="section" title="How the controller sends data to view"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>How the controller sends data to view</h1></div></div></div><p>In the previous <a id="id90" class="indexterm"/>paragraph, we have seen how to display the content view. However, the view should only be responsible for displaying data, and not for manipulation. Consequently, any work on data should be done in controller action and then passed to view.</p><p>The <code class="literal">render()</code> method in the action of the controller has a second parameter, which is an array whose keys are names of variables, and values are the content of these variables available in view context.</p><p>Now, let's move all data manipulation of our <code class="literal">itemsList</code> example in controller, leaving out just the code to format the output (such as HTML).</p><p>The following is the content of the <code class="literal">actionItemsList()</code> controller:</p><div class="informalexample"><pre class="programlisting">public function actionItemsList()
{
  $newsList = [
    [ 'title' =&gt; 'First World War', 'date' =&gt; '1914-07-28' ],
    [ 'title' =&gt; 'Second World War', 'date' =&gt; '1939-09-01' ],
    [ 'title' =&gt; 'First man on the moon', 'date' =&gt; '1969-07-20' ]
  ];

  return $this-&gt;render('itemsList', ['newsList' =&gt; $newsList]);
}</pre></div><p>In <code class="literal">views/news/itemsList.php</code>, we only have the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?php // $newsList is from actionItemsList ?&gt;
&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;Title&lt;/th&gt;
        &lt;th&gt;Date&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php foreach($newsList as $item) { ?&gt;
    &lt;tr&gt;
        &lt;th&gt;&lt;?php echo $item['title'] ?&gt;&lt;/th&gt;
        &lt;th&gt;&lt;?php echo $item['date'] ?&gt;&lt;/th&gt;
    &lt;/tr&gt;
    &lt;?php } ?&gt;
&lt;/table&gt;</pre></div><p>Thus, we have <a id="id91" class="indexterm"/>correctly split the working of controller and view.</p><div class="section" title="Example – create a controller to display the static news items list and details using the bootstrap template"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec13"/>Example – create a controller to display the static news items list and details using the bootstrap template</h2></div></div></div><p>Our next goal is to <a id="id92" class="indexterm"/>complete the news reader <a id="id93" class="indexterm"/>displaying details of single news in another page.</p><p>Since we are going to use the same data for list and detail, we will extract the <code class="literal">$newsList</code> data from action to a function, in order to be reused for more actions.</p><p>In <code class="literal">NewsController</code>, we will have the following code:</p><div class="informalexample"><pre class="programlisting">public function dataItems()
{
  $newsList = [
    [ 'title' =&gt; 'First World War', 'date' =&gt; '1914-07-28' ],
    [ 'title' =&gt; 'Second World War', 'date' =&gt; '1939-09-01' ],
    [ 'title' =&gt; 'First man on the moon', 'date' =&gt; '1969-07-20' ]
  ];

  return $newsList;
}

public function actionItemsList()
{
  $newsList = $this-&gt;dataItems();

  return $this-&gt;render('itemsList', ['newsList' =&gt; $newsList]);
}</pre></div><p>After this, we will create a new function in <code class="literal">NewsController</code>, <code class="literal">actionItemDetail</code>, that is used to handle requests of detail of a news item. This function will expect a parameter, which will allow to filter the correct items from <code class="literal">$newsList</code>, for example, the title.</p><p>The following is the content of <code class="literal">actionItemDetail</code>:</p><div class="informalexample"><pre class="programlisting">public function actionItemDetail($title)
{
  $newsList = $this-&gt;dataItems();

  $item = null;
  foreach($newsList as $n)
  {
    if($title == $n['title']) $item = $n;
  }

  return $this-&gt;render('itemDetail', ['item' =&gt; $item]);
}</pre></div><p>Next we have to <a id="id94" class="indexterm"/>create a new view file in <code class="literal">views/news</code> named <code class="literal">itemDetail.php</code>.</p><p>The following is<a id="id95" class="indexterm"/> the content of <code class="literal">itemDetail.php</code> located under <code class="literal">views/news/</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php // $item is from actionItemDetail ?&gt;

&lt;h2&gt;News Item Detail&lt;h2&gt;
&lt;br /&gt;
Title: &lt;b&gt;&lt;?php echo $item['title'] ?&gt;&lt;/b&gt;
&lt;br /&gt;
Date: &lt;b&gt;&lt;?php echo $item['date'] ?&gt;&lt;/b&gt;</pre></div><p>If we point to <code class="literal">http://hostname/basic/web/index.php?r=news/item-detail</code> without passing the title parameter, we will see the following screenshot:</p><div class="mediaobject"><img src="graphics/B04656_02_04.jpg" alt="Example – create a controller to display the static news items list and details using the bootstrap template"/></div><p>It displays an error that tells us that the title parameter is missing.</p><p>Try to pass <code class="literal">First%20%World%20War</code> as the title parameter to the URL, like this <code class="literal">http://hostname/basic/web/index.php?r=news/item-detail&amp;title=First%20World%20War</code>; the following will be the output:</p><div class="mediaobject"><img src="graphics/B04656_02_05.jpg" alt="Example – create a controller to display the static news items list and details using the bootstrap template"/></div><p>That is what we are<a id="id96" class="indexterm"/> expecting!</p><p>Finally, we want to <a id="id97" class="indexterm"/>connect together <code class="literal">itemsList</code> and <code class="literal">itemDetail</code>. In <code class="literal">views/news/itemsList.php</code>, we must change the title content into an anchor element, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php // $newsList is from actionItemsList ?&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Date&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php foreach($newsList as $item) { ?&gt;
  &lt;tr&gt;
    &lt;th&gt;&lt;a href="&lt;?php echo Yii::$app-&gt;urlManager-&gt;createUrl(['news/item-detail' , 'title' =&gt; $item['title']]) ?&gt;"&gt;&lt;?php echo $item['title'] ?&gt;&lt;/a&gt;&lt;/th&gt;
    &lt;th&gt;&lt;?php echo $item['date'] ?&gt;&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php } ?&gt;
&lt;/table&gt;</pre></div><p>To build a link, there is an available component, <code class="literal">urlManager</code>, which allows us to create links through the <code class="literal">createUrl()</code> method. The parameter in <code class="literal">createUrl()</code> is an array that contains the route path and variable to pass to the URL. To learn more about this method, just refer to <a id="id98" class="indexterm"/>the link <a class="ulink" href="http://www.yiiframework.com/doc-2.0/yii-web-urlmanager.html#createUrl%28%29-detail">http://www.yiiframework.com/doc-2.0/yii-web-urlmanager.html#createUrl%28%29-detail</a>.</p><p>In our case, we have <code class="literal">news/item-detail</code> as the route to be called and the <code class="literal">title</code> parameter to be passed to the URL.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>The date can be formatted using the built-in formatter component. For example, to to display a date in the d/m/Y format, <code class="literal">d/m/Y : Yii::$app-&gt;formatter-&gt;asDatetime($item['date'], "php:d/m/Y");</code>.</p></div></div><p>It is advisable to<a id="id99" class="indexterm"/> use a unique identifier to<a id="id100" class="indexterm"/> pass data between routes. For this purpose, we add a third parameter, named <code class="literal">id</code>, to identify a record univocally.</p><p>The following is the content of <code class="literal">NewsController</code>:</p><div class="informalexample"><pre class="programlisting">public function dataItems()
{
  $newsList = [
    [ 'id' =&gt; 1, 'title' =&gt; 'First World War', 'date' =&gt; '1914-07-28' ],
    [ 'id' =&gt; 2, 'title' =&gt; 'Second World War', 'date' =&gt; '1939-09-01' ],
    [ 'id' =&gt; 3, 'title' =&gt; 'First man on the moon', 'date' =&gt; '1969-07-20' ]
  ];
  return $newsList;
}

public function actionItemsList()
{
  $newsList = $this-&gt;dataItems();
  return $this-&gt;render('itemsList', ['newsList' =&gt; $newsList]);
}
public function actionItemDetail($id)
{
  $newsList = $this-&gt;dataItems();

  $item = null;
  foreach($newsList as $n)
  {
    if($id == $n['id']) $item = $n;
  }

  return $this-&gt;render('itemDetail', ['item' =&gt; $item]);
}</pre></div><p>Then, change the parameter in the <code class="literal">createUrl</code> parameter in <code class="literal">views/news/itemsList.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
     &lt;th&gt;Date&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php foreach($newsList as $item) { ?&gt;
  &lt;tr&gt;
    &lt;th&gt;&lt;a href="&lt;?php echo Yii::$app-&gt;urlManager-&gt;createUrl(['news/item-detail' , 'id' =&gt; $item['id']]) ?&gt;"&gt;&lt;?php echo $item['title'] ?&gt;&lt;/a&gt;&lt;/th&gt;
    &lt;th&gt;&lt;?php echo Yii::$app-&gt;formatter-&gt;asDatetime($item['date'], "php:d/m/Y"); ?&gt;&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php } ?&gt;
&lt;/table&gt;</pre></div></div></div>
<div class="section" title="Splitting the common view content into reusable views"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Splitting the common view content into reusable views</h1></div></div></div><p>Sometimes, views <a id="id101" class="indexterm"/>share the same common portion <a id="id102" class="indexterm"/>of content. In the examples made until now, we have seen that a common area for <code class="literal">itemsList</code> and <code class="literal">itemDetail</code> could be copyright data, which displays a disclaimer about copyright info.</p><p>In order to make this, we must put the common content in a separate view and call it using the <code class="literal">renderPartial()</code> method<a id="id103" class="indexterm"/> of controller (<a class="ulink" href="http://www.yiiframework.com/doc-2.0/yii-base-controller.html#renderPartial%28%29-detail">http://www.yiiframework.com/doc-2.0/yii-base-controller.html#renderPartial%28%29-detail</a>). It has the same types of parameters of the <code class="literal">render()</code> method; the main difference between the <code class="literal">render()</code> and <code class="literal">renderPartial()</code> methods is that <code class="literal">render()</code> writes a view content in layout and <code class="literal">renderPartial()</code> writes only view contents to output.</p><div class="section" title="Example – render partial in view"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec14"/>Example – render partial in view</h2></div></div></div><p>In this example, we create a <a id="id104" class="indexterm"/>common view for both <code class="literal">itemsList</code> and <code class="literal">itemDetail</code> about copyright data.</p><p>Create a view file named <code class="literal">_copyright.php</code> in <code class="literal">views/news</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>Usually, in Yii2's app, a view name that starts with underscore stands for common reusable view.</p></div></div><p>In this file, put only a text for copyright into <code class="literal">views/news/_copyright.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div&gt;
     This is text about copyright data for news items
&lt;/div&gt;</pre></div><p>Now, we want to <a id="id105" class="indexterm"/>display this view inside the <code class="literal">itemsList</code> and <code class="literal">itemDetail</code> views.</p><p>Change the content in <code class="literal">itemsList.php</code> located at <code class="literal">views/news/</code> as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo $this-&gt;context-&gt;renderPartial('_copyright'); ?&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Date&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php foreach($newsList as $item) { ?&gt;
  &lt;tr&gt;
    &lt;th&gt;&lt;a href="&lt;?php echo Yii::$app-&gt;urlManager-&gt;createUrl(['news/item-detail' , 'id' =&gt; $item['id']]) ?&gt;"&gt; &lt;?php echo $item['title'] ?&gt; &lt;/a&gt;&lt;/th&gt;
    &lt;th&gt;&lt;?php echo Yii::$app-&gt;formatter-&gt;asDatetime($item['date'], 'php:d/m/Y'); ?&gt;&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php } ?&gt;
&lt;/table&gt;</pre></div><p>Then, change the content in <code class="literal">itemDetail.php</code> located at <code class="literal">views/news/</code> as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php // $item is from actionItemDetail ?&gt;
&lt;?php echo $this-&gt;context-&gt;renderPartial('_copyright'); ?&gt;
&lt;h2&gt;News Item Detail&lt;h2&gt;
&lt;br /&gt;
Title: &lt;b&gt;&lt;?php echo $item['title'] ?&gt;&lt;/b&gt;
&lt;br /&gt;
Date: &lt;b&gt;&lt;?php echo $item['date'] ?&gt;&lt;/b&gt;</pre></div><p>We have put a common code at the top of the file in both views:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo $this-&gt;context-&gt;renderPartial('_copyright'); ?&gt;</pre></div><p>This will render the content of the <code class="literal">_copyright.php</code> view without layout.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Pay attention! Since <code class="literal">renderPartial()</code> is a method of the <code class="literal">Controller</code> class and <code class="literal">$this</code> refers to the <code class="literal">View</code> class in the view file, to access from <code class="literal">$this</code> to <code class="literal">renderPartial()</code> we will use the context member, which represents the <code class="literal">Controller</code> object in the <code class="literal">View</code> object.</p></div></div></div></div>
<div class="section" title="Creating static pages"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Creating static pages</h1></div></div></div><p>All websites contain <a id="id106" class="indexterm"/>static pages, whose content is static.</p><p>To create a static page in a common way, we need to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a function (<code class="literal">action</code>) to execute action in <code class="literal">Controller</code></li><li class="listitem" style="list-style-type: disc">Create a view for static content</li></ul></div><p>Append the following action to <code class="literal">Controller</code>:</p><div class="informalexample"><pre class="programlisting">public function actionInfo()
{
    return $this-&gt;render('info');
}</pre></div><p>Then, create a view in <code class="literal">views/controller/action-name.php</code>. This procedure is simple but too long and redundant.</p><p>Yii2 provides a quick alternative, adding static pages to the <code class="literal">actions()</code> method of <code class="literal">Controller</code> as follows:</p><div class="informalexample"><pre class="programlisting">public function actions()
{
  return [
    'pages' =&gt; [
    'class' =&gt; 'yii\web\ViewAction',
    ],
  ];
}</pre></div><p>With this simple declaration, we can put all static content under <code class="literal">views/controllerName/pages</code>.</p><p>Finally, we can point to the URL with route <code class="literal">controller_name/page</code> and the <code class="literal">view</code> parameter with the name of a view file such as <code class="literal">http://hostname/basic/web/index.php?r=controllerName/pages&amp;view=name_of_view</code>.</p><div class="section" title="Example – add a contact page"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec15"/>Example – add a contact page</h2></div></div></div><p>After we have learned <a id="id107" class="indexterm"/>how to create a static page, it is time to write a contact page.</p><p>Let's put a short static content in <code class="literal">views/site/pages/contact.php</code> as follows:</p><div class="informalexample"><pre class="programlisting">To contact us, please write to info@example.com</pre></div><p>Then, let's add a <code class="literal">page</code> attribute in the return array from the <code class="literal">actions()</code> method of <code class="literal">Controller</code>. To simplify, we will use <code class="literal">SiteController</code> that has this default implementation of the <code class="literal">actions()</code> method:</p><div class="informalexample"><pre class="programlisting">  public function actions()
  {
    return [
    'error' =&gt; [
       'class' =&gt; 'yii\web\ErrorAction',
    ],
    'captcha' =&gt; [
      'class' =&gt; 'yii\captcha\CaptchaAction',
      'fixedVerifyCode' =&gt; YII_ENV_TEST ? 'testme' : null,
    ],
  ];
  }</pre></div><p>After the last<a id="id108" class="indexterm"/> attribute, we will append the <code class="literal">page</code> attribute, and the following will be the result:</p><div class="informalexample"><pre class="programlisting">  public function actions()
  {
    return [
    'error' =&gt; [
      'class' =&gt; 'yii\web\ErrorAction',
    ],
    'captcha' =&gt; [
      'class' =&gt; 'yii\captcha\CaptchaAction',
      'fixedVerifyCode' =&gt; YII_ENV_TEST ? 'testme' : null,
    ],
    'pages' =&gt; [
      'class' =&gt; 'yii\web\ViewAction',
    ],
  ];
  }</pre></div><p>Now, every request to <code class="literal">site/pages/</code> is routed using the <code class="literal">ViewAction</code> class, which handles it simply by rendering static content of relative view.</p><p>Test it by clicking on <code class="literal">http://hostname/basic/web/index.php?r=site/pages&amp;view=contact</code>, and we should see this:</p><div class="mediaobject"><img src="graphics/B04656_02_06.jpg" alt="Example – add a contact page"/></div><p>We can customize the last part of the route with these changes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The attribute name of array returned from the <code class="literal">actions()</code> method of <code class="literal">Controller</code></li><li class="listitem" style="list-style-type: disc">Set the <code class="literal">viewPrefix</code> attribute of the <code class="literal">ViewAction</code> class declaration with the first part of the URL that we want to use to reach the pages</li><li class="listitem" style="list-style-type: disc">Change the name of the subfolder under <code class="literal">views/controllerName</code></li></ul></div><p>For example, we want to use <code class="literal">static</code> as the last part of the URL to reach static pages in <code class="literal">SiteController</code>.</p><p>We want to point to <code class="literal">http://hostname/basic/web/index.php?r=site/static&amp;view=contact</code> to display the contact view.</p><p>This will be the <code class="literal">ViewAction</code> node in the array from the <code class="literal">actions()</code> method of <code class="literal">SiteController</code>:</p><div class="informalexample"><pre class="programlisting">    'static' =&gt; [
    'class' =&gt; 'yii\web\ViewAction',
    'viewPrefix' =&gt; 'static'
    ],  </pre></div><p>We must also <a id="id109" class="indexterm"/>change the name of the static pages subfolder, renaming it from <code class="literal">views/site/pages</code> to <code class="literal">views/site/static</code>, and we can point to <code class="literal">http://hostname/basic/web/index.php?r=site/static&amp;view=contact</code>.</p></div></div>
<div class="section" title="Sharing data between views and layout"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Sharing data between views and layout</h1></div></div></div><p>Yii2 provides a standard <a id="id110" class="indexterm"/>solution to share data between views and layout, through the <code class="literal">params</code> property of the View component that you can use to share data among views.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>This is a standard solution since the <code class="literal">params</code> property exists in all views and it is attached to the View component.</p></div></div><p>This property, <code class="literal">params</code>, is an array that we can use without any restriction.</p><p>Imagine that we want to fill the breadcrumb element in the layout to track the path of navigation.</p><p>Open the main layout at <code class="literal">views/layouts/main.php</code>; you should find the default implementation of breadcrumb just before declaring the footer:</p><div class="informalexample"><pre class="programlisting">        &lt;div class="container"&gt;
            &lt;?= Breadcrumbs::widget([
                'links' =&gt; isset($this-&gt;params['breadcrumbs']) ? $this-&gt;params['breadcrumbs'] : [],
            ]) ?&gt;
         &lt;/div&gt;</pre></div><p>We need to fill the breadcrumbs property of <code class="literal">params</code> in view to display from any view to the layout custom path. For example, we want to display breadcrumbs in the <code class="literal">SiteController</code> index.</p><p>Go to <code class="literal">views/site/index.php</code> and add the following code at the top of the file:</p><div class="informalexample"><pre class="programlisting">$this-&gt;params['breadcrumbs'][] = 'My website';</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Since we are in view file, <code class="literal">$this</code> refers to View component.</p></div></div><p>Go to <code class="literal">http://hostname/basic/web/index.php?r=site/index</code> to see the breadcrumb bar <a id="id111" class="indexterm"/>appearing at the top of the page:</p><div class="mediaobject"><img src="graphics/B04656_02_07.jpg" alt="Sharing data between views and layout"/></div><div class="section" title="Example – change the layout background based on a URL parameter"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec16"/>Example – change the layout background based on a URL parameter</h2></div></div></div><p>Another example of <a id="id112" class="indexterm"/>communication between view and layout is, for instance, to change the layout background color based on a URL parameter.</p><p>We need to change the background of route <code class="literal">site/index</code> passing the <code class="literal">bckg</code> parameter in URL.</p><p>Therefore, we must open <code class="literal">views/site/index.php</code> and put this code at the top:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$backgroundColor = isset($_REQUEST['bckg'])?$_REQUEST['bckg']:'#FFFFFF';
$this-&gt;params['background_color'] = $backgroundColor;</pre></div><p>This code will set $<code class="literal">backgroundColor</code> to <code class="literal">#FFFFFF</code> (white color), if it is not passed to the <code class="literal">bckg</code> parameter, otherwise it will be passed a value.</p><p>Then, set the <code class="literal">params</code> attribute of View component in order to write its content in layout.</p><p>Open <code class="literal">views/layout/main.php</code>, and, in the <code class="literal">body</code> tag, apply the style based on <code class="literal">params['background_color']</code> passed from view.</p><p>Then, let's change the layout of the body tag with the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
$backgroundColor = isset($this-&gt;params['background_color'])?$this-&gt;params['background_color']:'#FFFFFF'; ?&gt;
&lt;body style="background-color:&lt;?php echo $backgroundColor ?&gt;"&gt;</pre></div><p>Finally, go<a id="id113" class="indexterm"/> to <code class="literal">http://hostname/basic/web/index.php?r=site/index&amp;bckg=yellow</code> to have a yellow background or to <code class="literal">http://hostname/basic/web/index.php?r=site/index&amp;bckg=#FF0000</code> to have a red one.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>In this example, we are setting the <code class="literal">background</code> property of <code class="literal">params</code> only in <code class="literal">views/site/index.php</code>. Other views do not set this property, so if we have not checked whether <code class="literal">background_color</code> property exists in the layout file, we will receive an error of missing the attribute from the framework, which means:</p><div class="informalexample"><pre class="programlisting">$backgroundColor = isset($this-&gt;params['background_color'])?$this-&gt;params['background_color']:'#FFFFFF';</pre></div></div></div></div></div>
<div class="section" title="Layout with dynamic block"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Layout with dynamic block</h1></div></div></div><p>The use of the <code class="literal">params</code> property to allow<a id="id114" class="indexterm"/> communication between view and layout, is advisable for simple cases, but there are some more complex cases where we must share the block of HTML.</p><p>For example, think about the advertising box in layout (usually left or right column of the template), that could change according to the view that is being displayed.</p><p>In this case, we need to pass the entire block of HTML code from view to layout.</p><p>For this purpose, this framework provides Block statements, where we can define entire blocks of data to send from view to layout.</p><p>Using Blocks means to define the <code class="literal">Block</code> statement in view and display it in another view, usually layout.</p><p>We define the <code class="literal">Block</code> statement in view as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php $this-&gt;beginBlock('block1'); ?&gt;
...content of block1...
$this-&gt;endBlock(); ?&gt;</pre></div><p>Here, <code class="literal">beginBlock</code> and <code class="literal">endBlock</code> define the beginning and the end of the <code class="literal">block1</code> named statement. This content is saved into the <code class="literal">blocks</code> property of the view component with the <code class="literal">block1</code> attribute.</p><p>We can access this block through <code class="literal">$view&gt;blocks[$blockID]</code> in every view, including layout.</p><p>To render a block in layout view, if available, use the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?php if(isset($this-&gt;blocks['block1']) { ?&gt;
     &lt;?php echo $this-&gt;blocks['block1'] ?&gt;
&lt;?php } else { ?&gt;
    … default content if missing block1 attribute
&lt;?php } ?&gt;</pre></div><p>Obviously, we can<a id="id115" class="indexterm"/> define all the blocks that we want.</p><div class="section" title="Example – add a dynamic box to display advertising info"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>Example – add a dynamic box to display advertising info</h2></div></div></div><p>In this example, we will see how to<a id="id116" class="indexterm"/> display, when available, a box with advertising info that displays data sent from view.</p><p>The first thing to do is to add a block in layout displaying data.</p><p>Enter in <code class="literal">views/layouts/main.php</code> and change <code class="literal">div</code> with container class as follows:</p><div class="informalexample"><pre class="programlisting">&lt;div class="container"&gt;
    &lt;?= Breadcrumbs::widget([
      'links' =&gt; isset($this-&gt;params['breadcrumbs']) ? $this-&gt;params['breadcrumbs'] : [],
    ]) ?&gt;
    
    &lt;div class="well"&gt;
        This is content for blockADV from view
        &lt;br /&gt;
        &lt;?php if(isset($this-&gt;blocks['blockADV'])) { ?&gt;
            &lt;?php echo $this-&gt;blocks['blockADV']; ?&gt;
        &lt;?php } else { ?&gt;
               &lt;i&gt;No content available&lt;/i&gt;
        &lt;?php } ?&gt;    
    &lt;/div&gt;
    
    &lt;?= $content ?&gt;
&lt;/div&gt;</pre></div><p>We have added a div with the <code class="literal">well</code> class to display the content of <code class="literal">blockADV</code>, if available. If <code class="literal">blockADV</code> is available in <code class="literal">$this-&gt;blocks</code>, it will display its content; otherwise, it will display <code class="literal">no content available</code>, as a courtesy message.</p><p>Now, we will create a new action in <code class="literal">NewsController</code>, called <code class="literal">advTest</code>, and then will create a brand new view.</p><p>Let's start off by creating<a id="id117" class="indexterm"/> a file in <code class="literal">views/news/advTest.php</code> with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;span&gt;
This is a test where we display an adv box in layout view
&lt;/span&gt;
&lt;?php $this-&gt;beginBlock('blockADV'); ?&gt;

    &lt;b&gt;Buy this fantastic book!&lt;/b&gt;

&lt;?php $this-&gt;endBlock(); ?&gt;</pre></div><p>We can insert any content in a block; in this case, we have put in text.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>The position where block is defined in view is not important.</p></div></div><p>Then, open <code class="literal">NewsController</code> and add a new action <code class="literal">advTest</code>:</p><div class="informalexample"><pre class="programlisting">public function actionAdvTest()
{
        return $this-&gt;render('advTest');
}</pre></div><p>Now, point the browser to <code class="literal">http://hostname/basic/web/index.php?r=news/adv-test</code> and we will see the following screenshot:</p><div class="mediaobject"><img src="graphics/B04656_02_08.jpg" alt="Example – add a dynamic box to display advertising info"/></div><p>All other pages will only show <code class="literal">no content available</code> in the screenshot.</p></div></div>
<div class="section" title="Using multiple layouts"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Using multiple layouts</h1></div></div></div><p>During the building of <a id="id118" class="indexterm"/>a website or a web application, usually it could be required to render different views with different layouts. Think about, for example, the lists and details of news made in this chapter.</p><p>The layout is managed by the <code class="literal">$layout</code> property of <code class="literal">Controller</code>; <code class="literal">main</code> is the default value for this property.</p><p>Just set this property to change the layout file where to render the content of the view.</p><p>There are some important rules to write the value of the <code class="literal">$layout</code> property:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A path alias (for example, <code class="literal">@app/views/layouts/main</code>).</li><li class="listitem" style="list-style-type: disc">An absolute path (for example, <code class="literal">/main</code>) is where the layout value starts with a slash. The actual layout file will be looked for under the application layout path, which defaults to <code class="literal">@app/views/layouts</code>.</li><li class="listitem" style="list-style-type: disc">A relative path (for example, <code class="literal">main</code>) is where the actual layout file will be looked for under the context module's layout path, which defaults to the <code class="literal">views/layouts</code> directory under the module directory.</li><li class="listitem" style="list-style-type: disc">The Boolean value false is where no layout will be applied.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>If the layout value does not contain a file extension, it will use the default <code class="literal">.php</code>.</p></div></div></li></ul></div><div class="section" title="Example – using different layouts to create responsive and nonresponsive content layout for the same view"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>Example – using different layouts to create responsive and nonresponsive content layout for the same view</h2></div></div></div><p>In this example, we will<a id="id119" class="indexterm"/> create a new action in <code class="literal">NewsController</code> that will change its layout depending on a value passed in the URL.</p><p>First, add a new action in <code class="literal">NewsController</code> called <code class="literal">actionResponsiveContentTest</code>:</p><div class="informalexample"><pre class="programlisting">public function actionResponsiveContentTest()
{
  $responsive =  Yii::$app-&gt;request-&gt;get('responsive', 0);

  if($responsive)
  {
    $this-&gt;layout = 'responsive';
  }
  else
  {
    $this-&gt;layout = 'main';
  }

  return $this-&gt;render('responsiveContentTest', ['responsive' =&gt; $responsive]);
}</pre></div><p>In this action, we get a responsive parameter from the URL and set the <code class="literal">$responsive</code> variable to this value or 0 if not passed.</p><p>Then, set the <code class="literal">$layout</code> property of <code class="literal">Controller</code> to responsive or not according to the <code class="literal">$responsive</code> value, and pass this variable to view.</p><p>Then, create a new<a id="id120" class="indexterm"/> view in <code class="literal">views/news/responsiveContentTest.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php if($responsive) { ?&gt;
  This layout contains responsive content
&lt;?php } else { ?&gt;
  This layout does not contain responsive content
&lt;?php } ?&gt;</pre></div><p>This displays a different text block according to the <code class="literal">$responsive</code> value.</p><p>Finally, make a clone of main layout copying <code class="literal">views/layouts/main.php</code> in <code class="literal">views/layouts/responsive.php</code> and change in a new file <code class="literal">views/layouts/responsive.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div class="container"&gt; in &lt;div class="container-fluid" style="padding-top:60px"&gt;</pre></div><p>This change makes the div container fluid (responsive), in other words, its content is resized with respect to percentage available in the horizontal space (instead the fixed value).</p><p>If we point to <code class="literal">http://hostname/basic/web/index.php?r=news/responsive-content-test</code>, we will see content in a fixed layout. Instead, if we pass the <code class="literal">responsive </code>parameter with value 1, <code class="literal">http://hostname/basic/web/index.php?r=news/responsive-content-test&amp;responsive=1</code>, we will see the content in a full width screen.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Summary</h1></div></div></div><p>In this chapter, after understanding how a Yii2 app is structured, we have created our first Controllers and relative views. We have seen static and dynamic views, we have learned how to render views in layout and pass data from Controller to View and then we have looked at reusing Views through partial views and blocks. </p><p>Finally, we have manipulated layouts, changing them conditionally.</p><p>In the next chapter, we will display URLs in a pretty format, which is very important for all <span class="strong"><strong>search engine optimization</strong></span> (<span class="strong"><strong>SEO</strong></span>) activities on the website. Then, we will learn how to create a custom URL handler to manage any required URL customizations.</p></div></body></html>