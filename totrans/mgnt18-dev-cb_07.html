<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Magento Backend"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Magento Backend</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Registering a backend controller</li><li class="listitem" style="list-style-type: disc">Extending the menu</li><li class="listitem" style="list-style-type: disc">Adding an ACL</li><li class="listitem" style="list-style-type: disc">Extending the system configuration</li><li class="listitem" style="list-style-type: disc">Creating a grid from a database table</li><li class="listitem" style="list-style-type: disc">Adding customer attributes</li><li class="listitem" style="list-style-type: disc">Working with source models</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Introduction</h1></div></div></div><p>For a store owner, the backend is the interface to manage everything in their store. It is very important that everything is secured against visitors with bad intentions. The backend of a standard Magento installation is extendible in many ways, so everyone can extend it with custom pages, configuration, roles, and more.</p><p>By following the configuration patterns of Magento, all the security issues (access for anonymous users, a secured environment, and so on) are covered by the backend system of Magento. The recipes in this chapter describe all the ways in which you can extend your backend using Magento's best practices of extending the backend.</p></div></div>
<div class="section" title="Registering a backend controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Registering a backend controller</h1></div></div></div><p>The first thing that we will<a id="id325" class="indexterm"/> learn is how to extend the backend with a custom controller action. For this, we have to create a controller that is secured so that only logged-in backend users can see the content of this page.</p><p>You need a backend controller when you want to add an extra page to your backend. This is mostly the case when you are working with a custom form or overview that you need for your module.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec130"/>Getting ready</h2></div></div></div><p>To make the testing of the admin URLs <a id="id326" class="indexterm"/>easier, we will remove the secret key (the hash in the URL of a backend page) from the admin URLs. You can configure this in <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Security</strong></span>. Change the configuration as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/3329OS_07_06.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec131"/>How to do it...</h2></div></div></div><p>When you want to add an extra page to your backend, you have to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">app/code/local/Packt/Helloworld/etc/config.xml</code> file and add the following configuration under the <code class="literal">global</code> tag:<div class="informalexample"><pre class="programlisting">&lt;admin&gt;
  &lt;routers&gt;
    &lt;adminhtml&gt;
      &lt;args&gt;
        &lt;modules&gt;
          &lt;helloworld before="Mage_Adminhtml"&gt;Packt_Helloworld_Adminhtml
          &lt;/helloworld&gt;
        &lt;/modules&gt;
      &lt;/args&gt;
    &lt;/adminhtml&gt;
  &lt;/routers&gt;
&lt;/admin&gt;</pre></div><p>This configuration will initialize the <code class="literal">Adminhtml</code> module to look for controllers in the folders of the <code class="literal">Packt_Helloworld</code> module.</p></li><li class="listitem">Add the following folders in the<a id="id327" class="indexterm"/> directories as shown:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Helloworld/controllers/Adminhtml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Helloworld/controllers/Adminhtml/Helloworld</code></li></ul></div></li><li class="listitem">In the last folder, create the <code class="literal">IndexController.php</code> file with the following content:<div class="informalexample"><pre class="programlisting">&lt;?php
class Packt_Helloworld_Adminhtml_Helloworld_IndexController extends Mage_Adminhtml_Controller_Action
{
  public function indexAction()
  {
    
  }
}</pre></div></li><li class="listitem">Make sure that you extend from the <code class="literal">Mage_Adminhtml_Controller_Action</code> class so that all the security cases are covered.</li><li class="listitem">Clear the cache and navigate to the controller by going to the URL <code class="literal">http://magento-dev.local/index.php/admin/helloworld_index/</code>.<p>This will give you a white page. This is normal because the action is empty.</p></li><li class="listitem">Add the following code in your <code class="literal">indexAction</code> function<a id="id328" class="indexterm"/> and reload the page. You will see that an empty backend page is returned:<div class="informalexample"><pre class="programlisting">$this-&gt;loadLayout();
$this-&gt;renderLayout();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec132"/>How it works...</h2></div></div></div><p>The difference between a frontend and backend controller is the parent class. A backend controller extends another class as the frontend controller. A backend controller always extends from the <code class="literal">Mage_Adminhtml_Controller_Action</code> class<a id="id329" class="indexterm"/>. This class adds the security to the controller so that only authenticated users can have access to the controller action(s).</p><p>When we add the configuration in the <code class="literal">config.xml</code> file, we will extend the <code class="literal">controllers</code> folder of the <code class="literal">Mage_Adminhtml</code> module<a id="id330" class="indexterm"/> with the <code class="literal">controllers/Adminhtml</code> folder of our module. With the <code class="literal">before="Mage_Adminhtml"</code> option, Magento will look for a controller file in the folder of the module. Later, it will look in the <code class="literal">Mage_Adminhtml</code> module<a id="id331" class="indexterm"/>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip27"/>Tip</h3><p>When you create a backend controller for your module, make sure that you add the <code class="literal">Adminhtml/Modulename</code> folder in the <code class="literal">controllers</code> folder to avoid conflicts with the existing <code class="literal">Mage_Adminhtml</code> controllers.</p></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec133"/>There's more…</h2></div></div></div><p>In some modules and tutorials, you will find the following configuration to link your backend controller:</p><div class="informalexample"><pre class="programlisting">&lt;admin&gt;
  &lt;routers&gt;
    &lt;helloworld&gt;
      &lt;use&gt;admin&lt;/use&gt;
      &lt;args&gt;
        &lt;module&gt;Packt_Helloworld&lt;/module&gt;
        &lt;frontName&gt;helloworld&lt;/frontName&gt;
      &lt;/args&gt;
    &lt;/helloworld&gt;
  &lt;/routers&gt;
&lt;/admin&gt;</pre></div><p>It is <span class="emphasis"><em>not</em></span> recommended to do the configuration in this way because this will create issues when you work with frontend and backend controllers in the same module.</p></div></div>
<div class="section" title="Extending the menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec53"/>Extending the menu</h1></div></div></div><p>While extending the backend,<a id="id332" class="indexterm"/> it is important to make sure that the user can easily navigate to your customized pages. The only alternative that you can use for this is to extend the <span class="strong"><strong>Admin</strong></span> menu with your own items. With the Magento framework, it is possible to add menu items at every level in that menu.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec134"/>Getting ready</h2></div></div></div><p>For this recipe, the only task that we have to do is add the right configuration, which is in the <code class="literal">adminhtml.xml</code> file, into the <code class="literal">etc</code> folder of the <code class="literal">Packt_Helloworld</code> module.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec135"/>How to do it...</h2></div></div></div><p>The following steps describe how you can add an extra menu item to the <span class="strong"><strong>Admin</strong></span> menu:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first thing that we have to<a id="id333" class="indexterm"/> think about is where will we place an extra menu item in the <span class="strong"><strong>Admin</strong></span> menu. For this test, we will place it under the<a id="id334" class="indexterm"/> <span class="strong"><strong>System</strong></span> menu. Keep the system ID in mind. We have to use this for the menu configuration.</li><li class="listitem">The second thing is to add the configuration in the <code class="literal">adminhtml.xml</code> file. Paste the following code under the <code class="literal">config</code> tag:<div class="informalexample"><pre class="programlisting">&lt;menu&gt;
  &lt;system&gt;
    &lt;children&gt;
      &lt;helloworld translate="title" module="helloworld"&gt;
        &lt;title&gt;Helloworld&lt;/title&gt;
        &lt;sort_order&gt;10&lt;/sort_order&gt;
        &lt;action&gt;adminhtml/helloworld_index&lt;/action&gt;
      &lt;/helloworld&gt;
    &lt;/children&gt;
  &lt;/system&gt;
&lt;/menu&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>In the <code class="literal">&lt;helloworld&gt;</code> tag, you see the <code class="literal">translate</code> and <code class="literal">module</code> attributes. When these attributes are set, the title will be translated using the helper class of the <code class="literal">helloworld</code> module.</p></div></div></li><li class="listitem">Clear the cache and reload the backend. While hovering over the system menu, you will see that a <span class="strong"><strong>Helloworld</strong></span> link is displayed as shown the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_07_07.jpg" alt="How to do it..."/></div></li><li class="listitem">To change the position<a id="id335" class="indexterm"/> of the menu item, we have to add the following <code class="literal">sort_order</code> tag in the configuration:<div class="informalexample"><pre class="programlisting">&lt;sort_order&gt;30&lt;/sort_order&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec136"/>How it works...</h2></div></div></div><p>The <span class="strong"><strong>Admin</strong></span> menu of Magento <a id="id336" class="indexterm"/>comprises all menu configuration data from the modules. The standard menu contains the following 10 root items:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Dashboard</li><li class="listitem" style="list-style-type: disc">Sales</li><li class="listitem" style="list-style-type: disc">Catalog</li><li class="listitem" style="list-style-type: disc">Mobile</li><li class="listitem" style="list-style-type: disc">Customers</li><li class="listitem" style="list-style-type: disc">Promotions</li><li class="listitem" style="list-style-type: disc">Newsletter</li><li class="listitem" style="list-style-type: disc">Reports</li><li class="listitem" style="list-style-type: disc">System</li></ul></div><p>When you want to add an item as a child of one of the root items, you have to use these tags in your configuration as we did for this recipe. The IDs of these menu items are declared in the configuration XML files of the Magento <code class="literal">core</code> modules.</p><p>You can easily add extra root items to the menu, but you have to make sure that the menu doesn't become too long. When the root menu becomes too long, it will cause layout issues for smaller screen resolutions.</p></div></div>
<div class="section" title="Adding an ACL"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec54"/>Adding an ACL</h1></div></div></div><p>In the previous recipes, we created a backend controller action to which you can navigate. However, when you want to configure a custom admin role, you can't restrict the access to this page for a specific role. In this recipe, we will create an<a id="id337" class="indexterm"/> <span class="strong"><strong>ACL</strong></span> (<span class="strong"><strong>Access Control List</strong></span>) for our backend page and configure a role with restricted access to this page.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec137"/>Getting ready</h2></div></div></div><p>Every admin user has a role. These roles contain access permissions, so you can restrict access to some user roles. In this recipe, we will add an extra permission to the roles so that we can configure the access for our previously created page.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec138"/>How to do it...</h2></div></div></div><p>The following steps show you how<a id="id338" class="indexterm"/> you can restrict the access to a backend page for specific users:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first thing we have to do is to check which ACLs are available. To know this, we can run the following command:<div class="informalexample"><pre class="programlisting">wiz admin-resources</pre></div></li><li class="listitem">Or, we can navigate to the <span class="strong"><strong>Roles</strong></span> page in the backend. This is located in <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Permissions</strong></span> | <span class="strong"><strong>Roles</strong></span>. Click on <span class="strong"><strong>Add new role</strong></span> and open the <span class="strong"><strong>Resources</strong></span> tab. This will give you a list of all the available ACLs in the backend.</li><li class="listitem">The second step is to add an extra ACL to it. To do this, we can add the following configuration in the <code class="literal">adminhtml.xml</code> file under the <code class="literal">&lt;config&gt;</code> tag:<div class="informalexample"><pre class="programlisting">&lt;acl&gt;
  &lt;resources&gt;
    &lt;all&gt;
      &lt;title&gt;Allow Everything&lt;/title&gt;
    &lt;/all&gt;
    &lt;admin&gt;
      &lt;children&gt;
        &lt;system&gt;
          &lt;children&gt;
            &lt;helloworld&gt;
              &lt;title&gt;Hellworld index page&lt;/title&gt;
              &lt;sort_order&gt;10&lt;/sort_order&gt;
            &lt;/helloworld&gt;
          &lt;/children&gt;
        &lt;/system&gt;
      &lt;/children&gt;
    &lt;/admin&gt;
  &lt;/resources&gt;
&lt;/acl&gt;</pre></div></li><li class="listitem">Clear your cache and reload the <span class="strong"><strong>Resources</strong></span> page in the backend. When you search for <code class="literal">Helloworld</code>, you <a id="id339" class="indexterm"/>will see that there is a checkbox available for our previously created ACL as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_07_08.jpg" alt="How to do it..."/></div><p>At this point, our ACL is working. To verify this, we have to create a role with a user and log in to see that the user has access to the page:</p></li><li class="listitem">Create a new role on the<span class="strong"><strong> Roles</strong></span> page in <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Permissions</strong></span>. Name it <code class="literal">Test Helloworld</code> and check the <span class="strong"><strong>Helloworld test</strong></span> and <span class="strong"><strong>Manage Products</strong></span> ACL.</li><li class="listitem">Create a backend user on the<span class="strong"><strong> Users</strong></span> page at <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Permissions</strong></span>. Fill the form and add the user to the role that we have just created, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_07_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Log in as the new user, and you will see that this user has access only to the pages that we have <a id="id340" class="indexterm"/>configured in the role.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec139"/>How it works...</h2></div></div></div><p>With the ACL system, it is possible to restrict backend pages for specific roles of users. For example, a product manager only has the rights to manage the products, categories, and promotion rules and the logistic<a id="id341" class="indexterm"/> partner only has access to the order pages.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip28"/>Tip</h3><p>In the Magento Community Edition, it is not possible to restrict the access to the data of a specific store. For example, a logistic partner can only see the orders of Store 1. The restrictions are based on the controller actions.</p></div></div><p>When you don't create an ACL for a page, only the roles that have access to all resources can access the page. In most cases, this is the administrator. For other roles, it is not possible to access a page without an ACL.</p></div></div>
<div class="section" title="Extending the system configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec55"/>Extending the system configuration</h1></div></div></div><p>When you want to save some <a id="id342" class="indexterm"/>configuration parameters for you module, you can use the Magento configuration table to save your configuration in it. You can find the configuration forms under<span class="strong"><strong> Configuration</strong></span> in the <span class="strong"><strong>System</strong></span> menu. In this recipe, we will add a configuration page in the system configuration with some configuration parameters.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec140"/>Getting ready</h2></div></div></div><p>Prepare yourselves to extend the <code class="literal">Packt_Helloworld</code> module with some extra configuration. Also, connect to your database because we will have to look at some tables.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec141"/>How to do it...</h2></div></div></div><p>The following steps describe <a id="id343" class="indexterm"/>the procedure to create extra configuration parameters in the <span class="strong"><strong>Configuration</strong></span> page under <span class="strong"><strong>System</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the following files in the <code class="literal">app/code/local/Packt/Helloworld/etc/</code> folder:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">system.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">adminhtml.xml</code></li></ul></div></li><li class="listitem">The second step is to create the configuration page. We will create a new tab in the left-hand side column under a new section. To create a section with the name <code class="literal">packt</code>, we have to add the following code in the <code class="literal">system.xml</code> file that we have just created:<div class="informalexample"><pre class="programlisting">&lt;tabs&gt;
  &lt;packt&gt;
    &lt;label&gt;Packt&lt;/label&gt;
    &lt;sort_order&gt;400&lt;/sort_order&gt;
  &lt;/packt&gt;
&lt;/tabs&gt;</pre></div></li><li class="listitem">To add a configuration page, we have to add the following code under the <code class="literal">global</code> tag of the <code class="literal">system.xml</code> file:<div class="informalexample"><pre class="programlisting">&lt;sections&gt;
  &lt;helloworld translate="label" module="helloworld"&gt;
    &lt;label&gt;Helloworld&lt;/label&gt;
    &lt;tab&gt;packt&lt;/tab&gt;
    &lt;sort_order&gt;10&lt;/sort_order&gt;
    &lt;show_in_default&gt;1&lt;/show_in_default&gt;
    &lt;show_in_website&gt;1&lt;/show_in_website&gt;
    &lt;show_in_store&gt;1&lt;/show_in_store&gt;
    &lt;groups&gt;

    &lt;/groups&gt;
  &lt;/helloworld&gt;
&lt;/sections&gt;</pre></div></li><li class="listitem">When you clear the cache and reload the page, the <span class="strong"><strong>PACKT</strong></span> section with the <span class="strong"><strong>Helloworld</strong></span> tab appears in the menu as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_07_01.jpg" alt="How to do it..."/></div></li><li class="listitem">When you click on the link, you will see a 404 error. This is because we haven't created an ACL for this<a id="id344" class="indexterm"/> configuration section. To add an ACL, we have to add the following code in the <code class="literal">adminhtml.xml</code> file that we have created in the first step:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config&gt;
  &lt;acl&gt;
    &lt;resources&gt;
      &lt;all&gt;
        &lt;title&gt;Allow Everything&lt;/title&gt;
      &lt;/all&gt;
      &lt;admin&gt;
        &lt;children&gt;
          &lt;system&gt;
            &lt;children&gt;
              &lt;config&gt;
                &lt;children&gt;
                  &lt;helloworld translate="title" module="helloworld"&gt;
                    &lt;title&gt;Helloworld section&lt;/title&gt;
                  &lt;/helloworld&gt;
                &lt;/children&gt;
              &lt;/config&gt;
            &lt;/children&gt;
          &lt;/system&gt;
        &lt;/children&gt;
      &lt;/admin&gt;
    &lt;/resources&gt;
  &lt;/acl&gt;
&lt;/config&gt;</pre></div></li><li class="listitem">We have to make sure that the ACL is added. To test this, you have to clear your cache and go to the <span class="strong"><strong>Roles</strong></span> page <a id="id345" class="indexterm"/>at <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Permissions</strong></span>. On that page, click on the <span class="strong"><strong>Administrator</strong></span> role, open the <span class="strong"><strong>Role Resources</strong></span> tab, and change it to <span class="strong"><strong>Custom</strong></span>. You will see your ACL entry in the list as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_07_02.jpg" alt="How to do it..."/></div></li><li class="listitem">When we see <span class="strong"><strong>Helloworld section</strong></span> in the list, it means that the ACL is added. Don't save the role because this was just to verify ACL's addition. To make sure that all the ACL settings are in the backend session, we have to create a new backend session by logging out and then logging in.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip29"/>Tip</h3><p>When creating an ACL, make sure that your custom ACL configuration follows the Magento XML tree where you have placed your page.</p></div></div></li><li class="listitem">When you log in again, navigate to the configuration page and you will see an empty page. It's because the fields aren't added in the configuration.</li><li class="listitem"> A new configuration field has<a id="id346" class="indexterm"/> to be in a configuration group. To add a new group, we have to add some configuration in the <code class="literal">system.xml</code> file. Add the following code under the <code class="literal">config/sections/helloworld</code> tag:<div class="informalexample"><pre class="programlisting">&lt;groups&gt;
  &lt;hellopage translate="label"&gt;
    &lt;label&gt;Hello page settings&lt;/label&gt;
    &lt;sort_order&gt;1&lt;/sort_order&gt;
    &lt;show_in_default&gt;1&lt;/show_in_default&gt;
    &lt;show_in_website&gt;1&lt;/show_in_website&gt;
    &lt;show_in_store&gt;1&lt;/show_in_store&gt;
    &lt;fields&gt;

    &lt;/fields&gt;
  &lt;/hellopage&gt;
&lt;/groups&gt;</pre></div></li><li class="listitem">On reloading the page, you will see nothing because there are no fields defined in the <code class="literal">&lt;fields&gt;</code> tag. To add a field (for example, <code class="literal">header_title</code>), we have to add the following code in the <code class="literal">&lt;fields&gt;</code> tag:<div class="informalexample"><pre class="programlisting">&lt;header_title translate="label"&gt;
  &lt;label&gt;Header title&lt;/label&gt;
  &lt;frontend_type&gt;text&lt;/frontend_type&gt;
  &lt;sort_order&gt;1&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/header_title&gt;</pre></div></li><li class="listitem">After clearing the cache and reloading the page, you will see a field in the configuration page as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_07_03.jpg" alt="How to do it..."/></div></li><li class="listitem">Enter a value in the field and save the configuration.</li><li class="listitem">To see where the value is saved, we have to look in the <code class="literal">core_config_data</code> table. Run the following<a id="id347" class="indexterm"/> query to see the record of our field:<div class="informalexample"><pre class="programlisting">SELECT * FROM core_config_data where path = 'helloworld/hellopage/header_title'</pre></div><p>This query returns all the values of the field as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/3329OS_07_04.jpg" alt="How to do it..."/></div></li><li class="listitem">To read the config data, we can use the <code class="literal">Mage::getStoreConfig('&lt;path&gt;')</code> function. In our case, the path is <code class="literal">helloworld/hellopage/header_title</code>. You can determine the path from the path column of the <code class="literal">core_config_data</code> table or from the <code class="literal">system.xml</code> files of the modules.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec142"/>How it works...</h2></div></div></div><p>The Magento configuration is saved in the <code class="literal">core_config_data</code> table. This table contains all the configuration <a id="id348" class="indexterm"/>values that you can set in <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> from the backend.</p><p>Every config setting can be configured at three levels:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Global configuration</li><li class="listitem" style="list-style-type: disc">Website configuration</li><li class="listitem" style="list-style-type: disc">Store view configuration</li></ul></div><p>When you are working with multiple stores, this setup makes it possible to save a configuration value for every store view. You can switch the scope with the drop-down field in the upper-left corner of the screen, shown as follows:</p><div class="mediaobject"><img src="graphics/3329OS_07_05.jpg" alt="How it works..."/></div><p>The type of every<a id="id349" class="indexterm"/> configuration value is stored in the scope column. This scope has a different code for every level:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">default (for global configuration)</li><li class="listitem" style="list-style-type: disc">websites (for website configuration)</li><li class="listitem" style="list-style-type: disc">stores (for stores)</li></ul></div><p>For every configuration field, you can configure the scope in your <code class="literal">system.xml</code> file. This is done with the <code class="literal">use_in_store</code>, <code class="literal">use_in_website</code>, and <code class="literal">use_in_default</code> tags.</p><p>The configuration path of a configuration parameter is set in the <code class="literal">system.xml</code> files of the modules. In the following XML path, you can determine the values:</p><div class="informalexample"><pre class="programlisting">config/sections/<span class="strong"><strong>$1</strong></span>/groups/<span class="strong"><strong>$2</strong></span>/fields/<span class="strong"><strong>$3</strong></span>
</pre></div><p>When you convert this XML path to a configuration path, it will look as follows:</p><div class="informalexample"><pre class="programlisting">$1/$2/$3</pre></div><p>In this recipe, <code class="literal">$1</code> corresponds to <code class="literal">helloworld</code>, <code class="literal">$2</code> corresponds to <code class="literal">hellopage</code>, and <code class="literal">$3</code> corresponds to <code class="literal">header_title</code> or <code class="literal">is_enabled</code>.</p></div></div>
<div class="section" title="Creating a grid from a database table"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Creating a grid from a database table</h1></div></div></div><p>In the previous chapter, we<a id="id350" class="indexterm"/> created a Magento entity that was linked to a database table. In<a id="id351" class="indexterm"/> this recipe, we will create a backend interface so that backend users can see the data from this table in the backend.</p><p>We will create an overview that will use the standard backend grid widget of Magento. This widget is widely used in the backend to display information in a grid as the <span class="strong"><strong>Manage Products</strong></span> page.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec143"/>Getting ready</h2></div></div></div><p>For this recipe, we have to configure<a id="id352" class="indexterm"/> a backend controller, a menu item, an ACL, and the right <code class="literal">Block</code> files to render the grid output. Prepare yourselves to<a id="id353" class="indexterm"/> extend the backend with a custom grid.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec144"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first thing we have to do is to create a backend controller for our grid. We will create a grid based on the subscription entity, so we will create <code class="literal">SubscriptionController</code>. Create a <code class="literal">SubscriptionController.php</code> file in the <code class="literal">app/code/local/Packt/Helloworld/controllers/Adminhtml/Helloworld/</code> folder.</li><li class="listitem">Add the following content in the controller:<div class="informalexample"><pre class="programlisting">&lt;?php
class Packt_Helloworld_Adminhtml_Helloworld_SubscriptionController extends Mage_Adminhtml_Controller_Action
{
  public function indexAction()
  {
    $this-&gt;loadLayout();
    
    $this-&gt;renderLayout();
  }
}</pre></div></li><li class="listitem">Create a menu item for the controller. When you add the following code in the <code class="literal">adminhtml.xml</code> file of the module, it will create a menu item under the <span class="strong"><strong>Customer</strong></span> item:<div class="informalexample"><pre class="programlisting">&lt;menu&gt;
  &lt;customer&gt;
    &lt;children&gt;
      &lt;subscription translate="title" module="helloworld"&gt;
        &lt;title&gt;Helloworld subscriptions&lt;/title&gt;
        &lt;sort_order&gt;10&lt;/sort_order&gt;
        &lt;action&gt;adminhtml/helloworld_subscription&lt;/action&gt;
      &lt;/subscription&gt;
    &lt;/children&gt;
  &lt;/customer&gt;
&lt;/menu&gt;</pre></div></li><li class="listitem">Create an ACL for the controller action. This can be done by adding the following code in the same <a id="id354" class="indexterm"/><code class="literal">adminhtml.xml</code> file as<a id="id355" class="indexterm"/> we did for the menu.<div class="informalexample"><pre class="programlisting">&lt;acl&gt;
  &lt;resources&gt;
    &lt;all&gt;
      &lt;title&gt;Allow Everything&lt;/title&gt;
    &lt;/all&gt;
    &lt;admin&gt;
      &lt;children&gt;
        &lt;customer&gt;
          &lt;children&gt;
            &lt;subscription&gt;
              &lt;title&gt;Hellworld subscriptions&lt;/title&gt;
              &lt;sort_order&gt;10&lt;/sort_order&gt;
            &lt;/subscription&gt;
          &lt;/children&gt;
        &lt;/customer&gt;
      &lt;/children&gt;
    &lt;/admin&gt;
  &lt;/resources&gt;
&lt;/acl&gt;</pre></div></li><li class="listitem">Clear the cache and reload your backend. The menu item is now in the menu under <span class="strong"><strong>Customer</strong></span>. When you navigate to the page, you will see an empty backend page.<p>We now have a backend page that is linked to the menu. In the next steps, we will add a grid in the page. To do this, we have to create two blocks. The first block is for the wrapper (title, classes). The second one is for the grid where we will define the columns.</p></li><li class="listitem">To create the wrapper block, create the <code class="literal">app/code/local/Packt/Helloworld/Block/Adminhtml</code> folder. In that folder, create a <code class="literal">Subscription.php</code> file with the following content:<div class="informalexample"><pre class="programlisting">&lt;?php
class Packt_Helloworld_Block_Adminhtml_Subscription extends Mage_Adminhtml_Block_Widget_Grid_Container
{
  public function __construct()
  {
    $this-&gt;_headerText = Mage::helper('helloworld')-&gt;__('Helloworld subscriptions');
    
    $this-&gt;_blockGroup = 'helloworld';
    $this-&gt;_controller = 'adminhtml_subscription';
    
    parent::__construct();
  }
  
  protected function _prepareLayout()
  {
    $this-&gt;_removeButton('add');
    
    return parent::_prepareLayout();
  }
}</pre></div></li><li class="listitem">Create the <code class="literal">app/code/local/Packt/Helloworld/Block/Adminhtml/Subscription</code> folder with a <code class="literal">Grid.php</code> file in it. In<a id="id356" class="indexterm"/> that file, add the<a id="id357" class="indexterm"/> following content:<div class="informalexample"><pre class="programlisting">&lt;?php
class Packt_Helloworld_Block_Adminhtml_Subscription_Grid extends Mage_Adminhtml_Block_Widget_Grid
{
  public function __construct()
  {
    parent::__construct();
    
    $this-&gt;setId('subscription_grid');
    $this-&gt;setDefaultSort('subscription_id');
    $this-&gt;setDefaultDir('DESC');
  }
  
  protected function _prepareCollection()
  {
    $collection = Mage::getModel('helloworld/subscription')-&gt;getCollection();
    $this-&gt;setCollection($collection);
    return parent::_prepareCollection();
  }
  
  protected function _prepareColumns()
  {
    $this-&gt;addColumn('subscription_id', array (
      'index' =&gt; 'subscription_id',
      'header' =&gt; Mage::helper('helloworld')-&gt;__('Subscription id'),
      'type' =&gt; 'number',
      'sortable' =&gt; true,
      'width' =&gt; '100px',
    ));
    
    $this-&gt;addColumn('firstname', array (
      'index' =&gt; 'firstname',
      'header' =&gt; Mage::helper('helloworld')-&gt;__('Firstname'),
      'sortable' =&gt; false,
    ));
    
    $this-&gt;addColumn('lastname', array (
      'index' =&gt; 'lastname',
      'header' =&gt; Mage::helper('helloworld')-&gt;__('Lastname'),
      'sortable' =&gt; false,
    ));
    
    $this-&gt;addColumn('email', array (
      'index' =&gt; 'email',
      'header' =&gt; Mage::helper('helloworld')-&gt;__('Email'),
      'sortable' =&gt; false,
    ));

    return parent::_prepareColumns();
  }
  
  public function getGridUrl()
  {
    return $this-&gt;getUrl('*/*/grid', array(
      '_current' =&gt; true,
    ));
  }
}</pre></div></li><li class="listitem">To add the blocks to the page, add the <a id="id358" class="indexterm"/>following code in the <code class="literal">indexAction()</code> function<a id="id359" class="indexterm"/> of the<a id="id360" class="indexterm"/> previously created controller file:<div class="informalexample"><pre class="programlisting">public function indexAction()
{
  $this-&gt;loadLayout();

  $this-&gt;_addContent($this-&gt;getLayout()-&gt;createBlock('helloworld/adminhtml_subscription'));

  $this-&gt;renderLayout();
}</pre></div></li><li class="listitem">Reload the page and you will get the following output:<div class="mediaobject"><img src="graphics/3329OS_07_10.jpg" alt="How to do it..."/></div></li><li class="listitem">To change the page title, we have to go to the wrapper block class. This is the <code class="literal">app/code/local/Packt/Helloworld/Block/Adminhtml/Subscription.php</code> file. The <code class="literal">$this-&gt;_headerText</code> variable in the <code class="literal">__contsruct()</code> action contains the title of the page.</li><li class="listitem">Now, the grid contains the <span class="strong"><strong>Subscription id</strong></span>, <span class="strong"><strong>Firstname</strong></span>, <span class="strong"><strong>Lastname</strong></span>, and <span class="strong"><strong>Email</strong></span>. In <code class="literal">_prepareColumns()</code>, we<a id="id361" class="indexterm"/> will add<a id="id362" class="indexterm"/> more columns to the grid so that it shows all the columns of the database table.</li><li class="listitem">The <code class="literal">created_at</code> field is of the type <code class="literal">datetime</code>. When we add the following code in the <code class="literal">_prepareColumns()</code> function<a id="id363" class="indexterm"/>, we will see the <code class="literal">created_at</code> column with a date filter:<div class="informalexample"><pre class="programlisting">$this-&gt;addColumn('created_at', array (
  'index' =&gt; 'created_at',
  'header' =&gt; Mage::helper('helloworld')-&gt;__('Created At'),
  'type' =&gt; 'datetime',
  'sortable' =&gt; true,
  'width' =&gt; '150px',
));</pre></div></li><li class="listitem">The last column that we will add is the <span class="strong"><strong>status</strong></span> column. In this column, we will add some HTML markup to the values. For this, we need to add the following code in the <code class="literal">_prepareColumns()</code> function<a id="id364" class="indexterm"/>:<div class="informalexample"><pre class="programlisting">$this-&gt;addColumn('status', array (
  'index' =&gt; 'status',
  'header' =&gt; Mage::helper('helloworld')-&gt;__('Status'),
  'sortable' =&gt; true,
  'frame_callback' =&gt; array($this, 'prepareStatusLayout'),
  'width' =&gt; '150px',
));</pre></div></li><li class="listitem">The <code class="literal">frame_callback</code> column requires the <code class="literal">prepareStatusLayout()</code> function<a id="id365" class="indexterm"/>. Create the<a id="id366" class="indexterm"/> following function<a id="id367" class="indexterm"/> in the <code class="literal">grid</code> class:<div class="informalexample"><pre class="programlisting">public function prepareStatusLayout($value)
{
  $class = '';
  switch ($value) {
    case 'pending' :
      $class = 'grid-severity-notice';
      break;
    case 'approved' :
      $class = 'grid-severity-major';
      break;
    case 'declined' :
      $class = 'grid-severity-critical';
      break;
  }
  return '&lt;span class="'.$class.'"&gt;&lt;span&gt;'.$value.'&lt;/span&gt;&lt;/span&gt;';
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec145"/>How it works...</h2></div></div></div><p>The backend grid is one of the backend widgets that is available in Magento. Other widgets that are widely used are the forms or the tabbed left menu. The grid widget is made to display the content of a collection in a grid, where you can sort and filter on the columns. A pager is automatically included, which prevents out-of-memory exceptions when there is a very large number of records in a collection.</p><p>The rendering of the grid is done in the <code class="literal">Mage_Adminhtml_Block_Widget_Grid</code> class<a id="id368" class="indexterm"/>. Our grid directly extends this class and overwrites the functions that were needed to customize the output for our entity.</p><p>In the <code class="literal">_prepareCollection()</code> function,<a id="id369" class="indexterm"/> we initialize the collection where we will work. The <code class="literal">_prepareColumns()</code> function<a id="id370" class="indexterm"/> is used to define the columns of the grid. In the <code class="literal">_prepareColumns()</code> function<a id="id371" class="indexterm"/>, we can play with the definition of the columns. A column definition is done with the <code class="literal">$this-&gt;addColumn()</code> function<a id="id372" class="indexterm"/>. In this function, we will initialize an array with the parameters for the column. It is recommended to use the following parameters for every column:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">header</code> (column title)</li><li class="listitem" style="list-style-type: disc"><code class="literal">index</code> (column in database)</li><li class="listitem" style="list-style-type: disc"><code class="literal">sortable</code> (enables sorting for the column when true)</li></ul></div><p>The following parameters are <a id="id373" class="indexterm"/>optional:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">width</code> (defines a width for the column)</li><li class="listitem" style="list-style-type: disc"><code class="literal">frame_callback</code> (calls a function to render the value of a cell)</li><li class="listitem" style="list-style-type: disc"><code class="literal">type</code> (defines the filter<a id="id374" class="indexterm"/> widget such as number, datetime, and options)</li><li class="listitem" style="list-style-type: disc"><code class="literal">options</code> (defines a source model when the type is <code class="literal">options</code>)</li></ul></div></div></div>
<div class="section" title="Adding customer attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Adding customer attributes</h1></div></div></div><p>Sometimes, it is easy if we can add an attribute to a customer as we can do with products. This is possible, but there is no interface for<a id="id375" class="indexterm"/> adding attributes in the backend. We have to create it using a module that adds the attributes to the <code class="literal">customer</code> object. In this recipe, we will add a <code class="literal">loyaltynumber</code> field to the customer.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec146"/>Getting ready</h2></div></div></div><p>For adding a <code class="literal">customer</code> attribute, the only task is to create an upgrade script which adds the attribute. Then, we have to link the attribute in the <code class="literal">form</code> table.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec147"/>How to do it...</h2></div></div></div><p>Perform the following steps to<a id="id376" class="indexterm"/> add the <code class="literal">loyaltynumber</code> attribute to your customer objects:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first step is to create the upgrade script. In the previous chapters, we have created an <code class="literal">install</code> and <code class="literal">upgrade</code> script in the <code class="literal">app/code/local/Packt/Helloworld/sql/helloworld_setup</code> folder. Create an extra install script with the name <code class="literal">upgrade-002-003.php</code>.</li><li class="listitem">To install the <code class="literal">customer</code> attribute, add the following code in that <code class="literal">install</code> script:<div class="informalexample"><pre class="programlisting">&lt;?php

$installer = $this;

$installer-&gt;startSetup();

//Create the attribute "loyaltynumber" for the customer entity
$installer-&gt;addAttribute('customer', 'loyaltynumber', array(
  'type' =&gt; 'varchar',
  'input' =&gt; 'text',
  'required' =&gt; false,
  'label' =&gt; 'Loyaltynumber',
  'visible' =&gt; true,
  'adminhtml_only' =&gt; true,
  'user_defined' =&gt; true,
));

//Add the attribute to the backend forms
//@todo

$installer-&gt;endSetup();</pre></div><p>This will add a <code class="literal">text</code> attribute to the <code class="literal">customer</code> entity.</p></li><li class="listitem">The previous code was to <a id="id377" class="indexterm"/>create the attribute for the customer. In this step, we will add the attribute to the customer form in the backend. We can do this by adding the following code under the <code class="literal">@todo</code> comment:<div class="informalexample"><pre class="programlisting">$loyaltyAttribute = Mage::getSingleton('eav/config')-&gt;getAttribute('customer', 'loyaltynumber');

$loyaltyAttribute-&gt;setData('used_in_forms', array('adminhtml_customer'));

$loyaltyAttribute-&gt;save();</pre></div></li><li class="listitem">To execute the upgrade script, update the version number from <code class="literal">0.0.2</code> to <code class="literal">0.0.3</code> in <code class="literal">config.xml</code>.</li><li class="listitem">To run the script, clear the caches and reload the page. When you navigate to a customer in the backend, you will see that the attribute is added in the form as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="graphics/3329OS_07_11.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec148"/>How it works...</h2></div></div></div><p>The installation of the <code class="literal">customer</code> attribute works in the same way as adding a <code class="literal">product</code> attribute via code. The only big difference is the entity type. Adding the field to the backend form of a customer is not as easy as for a product. For a customer, the fields to be displayed in the form are<a id="id378" class="indexterm"/> stored in the <code class="literal">eav_form_attribute</code> table.</p><p>While rendering the form, Magento will get the data from this table and render the fields based on the configuration in the attribute. The customer address is another EAV entity related to the customer entity. Adding attributes to a customer address works in the same way as adding a customer entity.</p></div></div>
<div class="section" title="Working with source models"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec58"/>Working with source models</h1></div></div></div><p>Magento works with a lot of drop-down<a id="id379" class="indexterm"/> fields that you can select in the forms of the application. Also, we can make use of drop-down fields in our custom fields.</p><p>A drop-down or multiselect field always has options that you can choose in this field. To render these options, Magento uses a class that returns the options. Such a<a id="id380" class="indexterm"/> class is called a <span class="strong"><strong>source model</strong></span>.</p><p>In this recipe, we will see which source models Magento uses and how we can create a custom source model for a custom configuration field.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec149"/>Getting ready</h2></div></div></div><p>For this recipe, we will create a source model that is linked to a custom configuration field. This is done in the <code class="literal">Packt_Helloworld</code> module, which we will extend in this recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec150"/>How to do it...</h2></div></div></div><p>The following steps describe how<a id="id381" class="indexterm"/> you can create your own source models for your form fields.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first thing that we have to create is a configuration field of the type drop-down. This has the same syntax as a normal configuration. In the <code class="literal">system.xml</code> file of the <code class="literal">Packt_Helloworld</code> module, add the following configuration under the <code class="literal">&lt;fields&gt;</code> tag:<div class="informalexample"><pre class="programlisting">&lt;is_enabled translate="label"&gt;
  &lt;label&gt;Enabled&lt;/label&gt;
  &lt;frontend_type&gt;select&lt;/frontend_type&gt;
  &lt;sort_order&gt;10&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/is_enabled&gt;</pre></div></li><li class="listitem">Clear your cache and go to the configuration page. You will see that there is an additional drop-down field without options. To create the options, we have to link a source model to it. The next code adds a <span class="strong"><strong>Yes</strong></span>/<span class="strong"><strong>No</strong></span> option to the field. Add this under the <code class="literal">is_enabled</code> tag:<div class="informalexample"><pre class="programlisting">&lt;source_model&gt;adminhtml/system_config_source_yesno&lt;/source_model&gt;</pre></div></li><li class="listitem">To create our own source model, we have to create a <code class="literal">Model</code> instance. Create the <code class="literal">Packt_Helloworld_Model_Source_Config_Relation</code> class<a id="id382" class="indexterm"/>. We can do this by creating a <code class="literal">Relation.php</code> file in the <code class="literal">app/code/local/Packt/Helloworld/Model/Source/Config</code> folder. Add the following content to that file:<div class="informalexample"><pre class="programlisting">&lt;?php
class Packt_Helloworld_Model_Source_Config_Relation
{
  public function toOptionArray()
  {
    return array(
      array(
        'value' =&gt; null,
        'label'=&gt;Mage::helper('helloworld')-&gt;__('--Please Select--'),
      ),
      array(
        'value' =&gt; 'bronze',
        'label'=&gt;Mage::helper('helloworld')-&gt;__('Bronze'),
      ),
      array(
        'value' =&gt; 'silver',
        'label'=&gt;Mage::helper('helloworld')-&gt;__('Silver'),
      ),
      array(
        'value' =&gt; 'gold',
        'label'=&gt;Mage::helper('helloworld')-&gt;__('Gold'),
      ),
    );
  }
}</pre></div></li><li class="listitem">To link the previously created source model to the block, we have to change the <code class="literal">source_model</code> line in the <code class="literal">system.xml</code> file. Change the line to the following:<div class="informalexample"><pre class="programlisting">&lt;source_model&gt;helloworld/source_config_relation&lt;/source_model&gt;</pre></div></li><li class="listitem">Clear your cache and you will<a id="id383" class="indexterm"/> see that the options of the field are changed based on the output from the source model, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="graphics/3329OS_07_12.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec151"/>How it works...</h2></div></div></div><p>A source model is a model instance with a <a id="id384" class="indexterm"/>
<code class="literal">toOptionArray()</code> function. This function returns an array with all the items<a id="id385" class="indexterm"/> of the source array. This array has the following format:</p><div class="informalexample"><pre class="programlisting">array(
  array(
    'value' =&gt; '0',
    'label' =&gt; 'Label option 0',
  ),
  array(
    'value' =&gt; '1',
    'label' =&gt; 'Label option 1',
  )
)</pre></div><p>The <code class="literal">value</code> key<a id="id386" class="indexterm"/> is the value of the <code class="literal">&lt;option&gt;</code> in the drop-down list. The <code class="literal">label</code> key<a id="id387" class="indexterm"/> is the text that appears in the drop-down list.</p><p>In this recipe, we configured a source model for a configuration field. We can also use source models in the following<a id="id388" class="indexterm"/> cases:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The product attribute in the backend</li><li class="listitem" style="list-style-type: disc">The customer attribute in the backend</li><li class="listitem" style="list-style-type: disc">The additional backend form</li><li class="listitem" style="list-style-type: disc">The drop-down filter in backend grids</li></ul></div><p>The configuration of the source model is mostly done in the configuration of the field. For EAV forms, the information of the source model is stored in the attribute configuration that is in the database.</p><p>When a drop-down or<a id="id389" class="indexterm"/> multiselect field is saved, it is always saved in a single field of the database. If a field is a drop-down, a value will be stored in that field. When the field is a multiselect field, a comma-separated list of the selected values will be saved in that field.</p></div></div></body></html>