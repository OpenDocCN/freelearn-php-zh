<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Theming in Drupal 8"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Theming in Drupal 8</h1></div></div></div><p><span class="emphasis"><em>In the last chapter, we learned about the Field Types API and about developing a custom field module. Now let's explore the frontend by creating a custom theme and learning about the new features of Drupal 8's theming layer.</em></span></p><p>In this chapter, we will learn the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What a theme is and how to create a sub-theme</li><li class="listitem" style="list-style-type: disc">What is new about themes in Drupal 8</li><li class="listitem" style="list-style-type: disc">What the terms mobile first and responsive mean and why D8 base themes are built this way</li><li class="listitem" style="list-style-type: disc">How to install Drush</li><li class="listitem" style="list-style-type: disc">How to add assets to your theme</li><li class="listitem" style="list-style-type: disc">An introduction to the Twig templating language</li><li class="listitem" style="list-style-type: disc">Understanding the benefits of contributed modules and when to make use of them</li></ul></div><div class="section" title="What is a theme?"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec56"/>What is a theme?</h1></div></div></div><p>A <span class="strong"><strong>theme</strong></span><a class="indexterm" id="id265"/> adjusts, or overrides, the default appearance of your Drupal site. It does this by giving us the ability to change the markup (with templating), functionality (with JavaScript), and appearance (with CSS). Theming is the final layer of development before the work is viewed by the user. The icing on the cake!</p><p>By default, Drupal 8 comes shipped with a number of themes in core. Let's have a look at them.</p><p>In PhpStorm, go to the root directory of your project and then navigate to <code class="literal">core</code> | <code class="literal">themes</code>. In this directory, you'll find five themes: Bartik, Classy, Seven, Stable, and Stark. What are these and why are they here?</p><p>Let's discuss these core themes we have available by default, as they each have a distinct use:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bartik has been the default theme for both Drupal 7 and Drupal 8. It's well documented, well maintained, and contains some useful theme functions.</li><li class="listitem" style="list-style-type: disc">Seven has been the default administration theme for Drupal 7 and 8. The styling it contains applies to the admin interface.</li><li class="listitem" style="list-style-type: disc">Stark comes with no CSS whatsoever, and is designed to demonstrate the default HTML and CSS that's coming from Drupal.</li><li class="listitem" style="list-style-type: disc">Stable exists as a fallback base theme if one hasn't been defined.</li><li class="listitem" style="list-style-type: disc">Classy is a base theme designed to provide Drupal's standard classes, which you will be used to if you've worked with Drupal 7. Bartik is a sub-theme of Classy.</li></ul></div><p>The <a class="indexterm" id="id266"/>description of Classy mentioned that it is a base theme. What does this mean? Base themes exist to give you a faster starting point for customizing your site's looks by doing some of the groundwork for you. They provide a standards-compliant starting point, some useful documentation, and really good reference for how to do certain theme tasks, such as creating new template files or adding new CSS. It is possible to chain multiple themes together if needed, to inherit features.</p><p>While some of these themes have existed in multiple versions of Drupal, there are distinct changes in the Drupal 8 theme system. These include semantic HTML5 markup, the Twig templating system (which we will look at later in this chapter), more JavaScript libraries included by default, and CSS classes being moved from preprocess into templating. Visit <a class="ulink" href="https://www.drupal.org/node/2356951">https://www.drupal.org/node/2356951</a> for a more complete list.</p><p>There are many, many more themes you can download and make use of as a <a class="indexterm" id="id267"/>base theme too. Visit <a class="ulink" href="https://www.drupal.org/project/project_theme">https://www.drupal.org/project/project_theme</a> to find a listing.</p><p>It's important to note that the themes in core are not there to be adjusted. By keeping them untouched, we can update them (if needed) in future without losing any work. So if we can't adjust them, how do we customize the look of our site?</p></div></div>
<div class="section" title="Time for action &#x2013; creating a sub-theme"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Time for action – creating a sub-theme</h1></div></div></div><p>What <a class="indexterm" id="id268"/>we need to do is set up a theme to inherit the benefits we get from our <a class="indexterm" id="id269"/>chosen theme, that we can then adjust to suit our needs. This is called a <span class="strong"><strong>sub-theme</strong></span>. Let's get started, using Bartik as the parent theme.</p><p>Back in PhpStorm, in the root directory of your project, navigate to the <code class="literal">themes</code> directory. Right now this directory is empty apart from a README file. We'll first create a directory to place our sub-theme in. It is good practice to place your own themes in a folder named <code class="literal">custom</code>, and any contributed themes in a sub folder named <code class="literal">contrib</code> (more on contributed themes later). Inside the newly created <code class="literal">custom</code> folder, we'll begin creating our sub-theme. We need to follow a few naming rules: it must start with a letter and only use lowercase alphanumerics and underscores. We're going to call ours recipes:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a <a class="indexterm" id="id270"/>directory named <code class="literal">recipes</code>.</li><li class="listitem">Inside <a class="indexterm" id="id271"/>that, we'll define our theme. If you've worked with Drupal 7 previously, you may be used to working with the <code class="literal">.info</code> file. In Drupal 8, we now use the <code class="literal">.info.yml</code> files for theme definition. Among other things, the <code class="literal">.info.yml</code> file can define meta data, style sheets, and block regions.  This is the only required file in the theme. Create the file, naming it <code class="literal">recipes.info.yml</code>, and then open it.</li><li class="listitem">Copy the following into your <code class="literal">recipes.info.yml</code> file and save:<div class="informalexample"><pre class="programlisting">name: Recipes
type: theme
base theme: bartik
description: A theme for styling up some delicious recipes!
core: 8.x</pre></div></li><li class="listitem">Copy the file titled <code class="literal">logo.svg</code> from <code class="literal">/core/themes/bartik</code> into<code class="literal"> /themes/recipes</code>.</li><li class="listitem">Now back on our site, click on the <span class="strong"><strong>Appearance</strong></span> button in the shortcut bar. This will take you to <code class="literal">/admin/appearance</code>. This is where we can enable or disable the themes. Scroll down to the <span class="strong"><strong>Uninstalled themes</strong></span> section and find our Recipes theme. Click on the <span class="strong"><strong>Install and set as default</strong></span> button:<div class="mediaobject"><img alt="Time for action – creating a sub-theme" src="graphics/4659_05_01.jpg"/></div></li><li class="listitem">Once<a class="indexterm" id="id272"/> the page has refreshed and notified you that Recipes<a class="indexterm" id="id273"/> is our default theme, click on the <span class="strong"><strong>Back to site</strong></span> button in the top-left of your admin menu.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec37"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We created a sub-theme that uses Bartik as its parent theme. But what's inside the Bartik theme? Next, we'll have a look at the inner workings of Bartik to understand how a theme is put together.</p></div><div class="section" title="An overview of Bartik"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec38"/>An overview of Bartik</h2></div></div></div><p>Let's <a class="indexterm" id="id274"/>have a <a class="indexterm" id="id275"/>look at what sits inside the Bartik directory and gain a bit of knowledge about what each file does (follow along by navigating to <code class="literal">core/themes/bartik</code>). The directory consists of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">bartik.info.yml</code>: Like <a class="indexterm" id="id276"/>our <code class="literal">recipes.info.ml</code> file, this defines some meta data required for the theme, such as its name, its parent theme, and a description. This file also describes some libraries, stylesheets, and theme regions. You can find information on the included regions and more on theme customization at <a class="ulink" href="https://www.drupal.org/documentation/themes/bartik">https://www.drupal.org/documentation/themes/bartik</a>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">bartik.libraries.yml</code>: This<a class="indexterm" id="id277"/> file defines the CSS libraries that can be loaded into the theme (it would also define the JavaScript, if Bartik had any by default). See the <span class="emphasis"><em>Adding assets to your theme</em></span> section for more information and a practical example.</li><li class="listitem" style="list-style-type: disc"><code class="literal">bartik.breakpoints.yml</code>: This<a class="indexterm" id="id278"/> includes the configuration for the Breakpoints module (<a class="ulink" href="https://www.drupal.org/project/breakpoints">https://www.drupal.org/project/breakpoints</a>). This allows the theme to manage the breakpoints so that the other modules can make use of responsive breakpoints functionality. For example, Picture (<a class="ulink" href="https://www.drupal.org/project/picture">https://www.drupal.org/project/picture</a>) can deliver resized images depending on the size of the browser. See the <span class="emphasis"><em>Mobile First, Responsive Themes</em></span> section for more information about the module</li><li class="listitem" style="list-style-type: disc"><code class="literal">bartik.theme</code>: This <a class="indexterm" id="id279"/>contains some useful functions that support theming. These include adding classes to the markup detailing sidebar or region use, adding clearfix classes to some system elements, and classes to form elements.</li><li class="listitem" style="list-style-type: disc"><code class="literal">logo.svg</code>: This<a class="indexterm" id="id280"/> is the stock logo that will show by default in the header. Logos can also be uploaded in <code class="literal">/appearance/settings</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">screenshot.png</code>: This <a class="indexterm" id="id281"/>displays on the <code class="literal">/admin/appearance</code> page and can be useful for quick theme recognition if toggling between themes.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">color</code> directory: This <a class="indexterm" id="id282"/>houses the preview functionality for Bartik's integration with the <code class="literal">Color</code> module. This module allows you to change the color scheme of the theme without making changes in the CSS.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">css</code> directory: This <a class="indexterm" id="id283"/>houses multiple modular CSS files that contain styling for all the components of the theme, such as buttons, forms, and the header. These are then either combined into libraries in <code class="literal">bartik.libraries.yml</code> or imported directly into <code class="literal">batik.info.yml</code>, depending on their purpose.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">config</code> directory: This<a class="indexterm" id="id284"/> houses a schema for the Bartik configuration files.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">images</code> directory: This <a class="indexterm" id="id285"/>contains images used by the theme.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">templates</code> directory: This <a class="indexterm" id="id286"/>houses the templates used by the theme to structure the output of different areas of the site. The templates provide the HTML structure and some conditional logic. Templates target specific areas of the site which can range from fairly small independent sections like <code class="literal">status-messages.html.twig</code>, to elements that have wider effects, such as <code class="literal">page.html.twig</code>, which provides structure for all pages. You'll learn much more about templates and the language they're written in (Twig) later in the chapter.</li></ul></div><p>We are now in a position to start making some changes to the default look that Bartik provides, so in the next section we'll add some custom CSS to test we're in business. Before getting to that, let's discuss responsive themes and mobile first principles.</p></div></div>
<div class="section" title="Mobile first, responsive themes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec58"/>Mobile first, responsive themes</h1></div></div></div><p>Drupal 8 themes <a class="indexterm" id="id287"/>are both mobile first and responsive out of the box. What do these terms mean and why are the themes set up this way?</p><p>In April of 2000, John <a class="indexterm" id="id288"/>Allsop wrote an article on <a class="ulink" href="http://alistapart.com/">http://alistapart.com/</a> called <span class="emphasis"><em>A Dao of Web Design</em></span>. This seminal article described an issue of emerging web design—designers and developers wanted to control their users' experience with as much rigidity as was possible in print. They wanted their sites to look as similar as possible in terms of functionality and layout, no matter the users' setup. The article advocated a fresh approach:</p><div class="blockquote"><table border="0" cellpadding="0" cellspacing="0" class="blockquote" summary="Block quote" width="100%"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"Make pages which are adaptable. Make pages which are accessible, regardless of the browser, platform or screen that your reader chooses or must use to access your pages."</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td align="right" colspan="2" style="text-align: center" valign="top">--<span class="attribution"><span class="emphasis"><em>John Allsop</em></span></span></td></tr></table></div><p>This extends further today, as we must also consider different screen resolutions and Internet connection speeds, particularly for mobile devices. A site must adjust to the various needs of its users, and preferably, deliver an excellent experience, no matter the device.</p><p>Two approaches that attempted to solve the layout/screen size problem began to gain popularity: adaptive design and responsive design. Adaptive design was based on having series of static layouts that were delivered to the user after screen size was detected. Responsive design was based on fluidity of layout, responsively and flexibly fitting the device.</p><p>If a user resized their browser, an adaptive website would jump between the static layouts, while a responsive website would fluidly scale. Both approaches had benefits: adaptive design affords a level of control over the layout that sometimes can't be achieved with responsive design, but responsive design works more seamlessly across different devices, and because of this, has now become more popular.</p><p>Historically, <a class="indexterm" id="id289"/>designers and developers have focused on the desktop experience first, sometimes using layouts and functionality that didn't work well on mobile devices. This still happens occasionally, with designers approaching mobile design as a secondary issue. There's a very good reason to stamp this practice out: in 2015-2016, there are approximately 4.5 billion mobile phone users worldwide. A substantial portion of these will have Internet capability, and when we consider all the tablets, games consoles, watches, in-car devices, and even kitchen appliances with screens capable of browsing the Web, focusing on desktop experience alone is short sighted.</p><p>To combat the issue of reduced functionality of some devices, two approaches have become popular: graceful degradation and progressive enhancement. The result is the same; older or less capable devices deliver a lower level of experience, but importantly, a working site. However, the way this is achieved is applied from opposing starting points. Graceful degradation starts from a point of providing a high level of experience on modern devices, with the functionality degrading gracefully on older devices that aren't able to provide the support. Progressive enhancement takes the approach of creating the website at its lower level of user experience first, then progressively enhancing functionality if the devices support it. Both <a class="indexterm" id="id290"/>approaches have their merits, and excellent examples of both practices can be found at <a class="ulink" href="https://www.w3.org/wiki/Graceful_degradation_versus_progressive_enhancement">https://www.w3.org/wiki/Graceful_degradation_versus_progressive_enhancement</a>.</p><p>The important point here is the ability to provide a working website, regardless of device, and we'll discuss how Drupal 8 can help you achieve this.</p><p>Mobile first is an approach that means that content is laid out intelligently on smaller devices. Content on a small screen tends to require a single column layout, and therefore a linear order, with the most important content at the top of the page. This isn't always the case, but it's a mindset that helps web professionals consider the best experience for smaller devices first, which tends to also lead to an improved large screen experience.</p><p>Drupal 8 can help you create a responsive, mobile first site with progressive enhancement or graceful degradation. First off, have a look at the homepage in your browser—try resizing the page, and look at how the elements adjust. At mobile, our admin menu shows our links with icons rather than text, to ensure the layout fits. Our site's main menu is sat within a clickable (or tappable) dropdown. The content is single column, with the sidebars sat underneath the main content area. As the browser expands, the admin menu includes text, the main menu drops out of the dropdown, and the sidebars are positioned on either side of the main content area. This is a good example of responsive, mobile first behavior. This is being achieved with CSS. As an example, look at the styling in <span class="strong"><strong>core</strong></span> | <span class="strong"><strong>themes</strong></span> | <span class="strong"><strong>bartik</strong></span> | <span class="strong"><strong>css</strong></span> | <span class="strong"><strong>components</strong></span> | <span class="strong"><strong>header.css</strong></span>. You can see the default styling being set at the top of the file, then further into the file, media queries appear, which provide the necessary changes for the layout to continue working well at larger sizes. If you're not familiar with <a class="indexterm" id="id291"/>media queries, you can find good documentation at <a class="ulink" href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries">https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries</a>.</p><p>By providing good examples of responsive, mobile first styling in action, Drupal 8 has given you a helping hand beginning your own work.</p><p>Drupal 8 now comes with more JS libraries in core, which we'll discuss later. For now, just be aware that <a class="indexterm" id="id292"/>Modernizr is available to you, which is a great tool for detecting browser capabilities and providing methods for you to adjust your functionality and styling accordingly. See <a class="ulink" href="https://modernizr.com/">https://modernizr.com/</a> for more information.</p><p>Drupal core also<a class="indexterm" id="id293"/> now ships with a module called <a class="indexterm" id="id294"/>
<span class="strong"><strong>Breakpoint</strong></span>. This allows you, on a theme by theme basis, to define the browser widths at which you want to be able to make functional changes. These settings are independent of any CSS media queries you might use. The Breakpoint settings help configure other modules, such as Responsive Images, another module now in core. The combination of these two modules allows you to switch images on your site. You can provide lower resolution images for small screen devices, then swap them for higher resolution for bigger screens. This is great for site performance, particularly important to bear in mind for mobile Internet users. The settings for breakpoints sit in the root of the theme. Bartik's can be found in <code class="literal">bartik.breakpoints.yml</code>.</p><p>We've now learned what the terms <span class="emphasis"><em>mobile first</em></span> and <span class="emphasis"><em>responsive</em></span> mean, and how Drupal 8 gives you the tools you need to begin following these practices.</p><p>Before we start using our theme, we're going to install a tool called <a class="indexterm" id="id295"/>
<span class="strong"><strong>Drush</strong></span>, which is a command line tool for Drupal. It'll help us move quickly through the next few sections.</p></div>
<div class="section" title="Time for action &#x2013; installing Drush"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec59"/>Time for action – installing Drush</h1></div></div></div><p>The <a class="indexterm" id="id296"/>following <a class="indexterm" id="id297"/>section requires a command line with Unix or Unix-like functionality. If you are a Mac or Linux user, you'll have Bash preinstalled, but if you're a Windows user, you'll need to install Cygwin, which can be downloaded from <a class="ulink" href="https://www.cygwin.com">https://www.cygwin.com</a>. There <a class="indexterm" id="id298"/>are a number of tutorials available online to help you install and use it.</p><p>You'll also need some knowledge of editing and saving documents using terminal editors, such as <code class="literal">nano</code> or <code class="literal">vi</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>If you're new to command line, be aware that the dollar sign signals a new line of code (that is, don't type the dollar sign), and that each line needs to end with the return key being pressed.</p></div></div><p>We'll be <a class="indexterm" id="id299"/>installing Drush using Composer. If you have previous experience of Drupal 7 and already have Drush installed, upgrade it using your preferred method.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Firstly, we'll install <a class="indexterm" id="id300"/>Composer globally. In your terminal, run the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ curl -sS https://getcomposer.org/installer | php</strong></span>
<span class="strong"><strong>$ mv composer.phar /usr/local/bin/composer</strong></span>
</pre></div></li><li class="listitem">Now, open your <code class="literal">.bash_profile</code> (or <code class="literal">.zshrc</code> if using ZSH) using a terminal editor and add the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ export PATH="$HOME/.composer/vendor/bin:$PATH"</strong></span>
</pre></div></li><li class="listitem">Re-source the file (or reload your terminal):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ source ~/.bash_profile</strong></span>
</pre></div></li><li class="listitem">With Composer installed, we can quickly and easily install Drush:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ composer global require drush/drush:dev-master</strong></span>
</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>Composer makes it really easy to update Drush, or roll it back to a particular version if required. It's well documented online.</p></div></div></li></ol></div><p>Drush has a lot <a class="indexterm" id="id301"/>of useful features. Visit <a class="ulink" href="http://www.drush.org/en/master/">http://www.drush.org/en/master/</a> for documentation.</p></div>
<div class="section" title="Time for action &#x2013; Adding assets to your theme"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec60"/>Time for action – Adding assets to your theme</h1></div></div></div><p>In Drupal 7, CSS and JS assets were added to themes via the <code class="literal">.info</code> file. In Drupal 8, asset management <a class="indexterm" id="id302"/>has been split out and we have the concept of an asset library. These libraries contain the CSS and JS we would like to attach. They can be applied globally or to a specific page. Let's start by creating a global-styling asset library:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In your theme's directory, create a file called <code class="literal">recipes.libraries.yml</code>.</li><li class="listitem">Copy the following into your file and save:<div class="informalexample"><pre class="programlisting">global-styling:
  version: 1.0
  css:
    theme:
      css/style.css: {}</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>Indentation has meaning in <code class="literal">.yml</code> files, so ensure that the indentation in the preceding code matches your file.</p></div></div></li><li class="listitem">We now<a class="indexterm" id="id303"/> need to attach our library to the site. This can be done in two ways. If we want to attach a library to a specific page, we can do that in our templates. We'll discuss this later in the chapter. But when we want to attach a library to all the pages on our site that use our theme, we can add it to our info file. In <code class="literal">recipes.info.yml</code>, copy and save the following at the bottom of the file:<div class="informalexample"><pre class="programlisting">  - recipes/global-styling</pre></div><p>Your info file should now look like this:</p><div class="informalexample"><pre class="programlisting">name: Recipes
type: theme
base theme: bartik
description: A theme for styling up some delicious recipes!
core: 8.x
libraries:
  - recipes/global-styling</pre></div></li><li class="listitem">With our library in place and being applied globally via the info file, let's create some CSS and test it out. In your recipes directory, create a new directory called <code class="literal">css</code>.</li><li class="listitem">In the <code class="literal">css</code> directory, create a file called <code class="literal">style.css</code>.</li><li class="listitem">In <code class="literal">style.css</code>, copy and save the following:<div class="informalexample"><pre class="programlisting">.main-content h2 {
  font-size: 50px;
}</pre></div></li><li class="listitem">We now need to clear the cache. Drush makes this easy. Open your terminal and navigate to the site's root directory. We can type the following command to rebuild all our caches:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ drush cr</strong></span>
</pre></div><p>This will do the equivalent of going to <code class="literal">/admin/config/development/performance</code> and clicking on the <span class="strong"><strong>'Clear all caches</strong></span>' button, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Time for action – Adding assets to your theme" src="graphics/4659_05_02.jpg"/></div></li><li class="listitem">As the <a class="indexterm" id="id304"/>final step, let's head back to the homepage and see whether our styling has taken effect:<div class="mediaobject"><img alt="Time for action – Adding assets to your theme" src="graphics/4659_05_03.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec39"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We added a CSS file by creating a new library and then made a styling adjustment to check that it worked.</p><p>Ok, our titles are bigger, so that tells us that our recipes theme is working. Excellent!</p><p>Next, let's make<a class="indexterm" id="id305"/> adjusting our assets as easy as possible while we're developing, by disabling one of Drupal's default performance features.</p><p>Drupal uses a site performance tool called aggregation. A site's performance can be affected by the addition of multiple CSS or JS files, each of which require an HTTP request to the server. What Drupal does to avoid this is condense multiple files into a single one, performing uglification and minification too. This means fewer HTTP requests are made, and the files that are requested are as small as possible. However, the aggregated files are not re-created every time you make a change to your CSS or JavaScript, as they are cached. Great for performance, but not so useful when we're developing. We could clear the cache each time we make a change, but a quicker way is to disable aggregation for now.</p><p>Let's go back to <code class="literal">/admin/config/development/performance</code> and uncheck the <span class="strong"><strong>Aggregate CSS files</strong></span> and <span class="strong"><strong>Aggregate JavaScript files</strong></span> options. Then, click on the <span class="strong"><strong>Save configuration</strong></span> button, as shown in the following screenshot:</p><div class="mediaobject"><img alt="What just happened?" src="graphics/4659_05_04.jpg"/></div><p>With aggregation<a class="indexterm" id="id306"/> turned off, we can make changes and they will be immediately visible when we refresh our browser. Do remember to have aggregation enabled for production sites though!</p></div></div>
<div class="section" title="Time for action &#x2013; calling assets on specific pages"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec61"/>Time for action – calling assets on specific pages</h1></div></div></div><p>Let's dive a <a class="indexterm" id="id307"/>little deeper with asset library dependencies. We're going to add a little piece of JavaScript with a dependency on jQuery; when a user clicks on the recipe description field, an alert box will be triggered to tell them it's delicious. We'll set it so that it only loads on the full view mode of our recipes (that is, not on our homepage listing). This will also be our first introduction to Twig. Let's begin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Back in PhpStorm, in our <code class="literal">recipes</code> theme, create a directory called <code class="literal">js</code>.</li><li class="listitem">In the <code class="literal">js</code> directory, create a file called <code class="literal">delicious.js.</code></li><li class="listitem">While the contents of this JS file are just to demo the concept, we'll create it and document it using good practices, so that you can use this as a basis for your own work. We'll start by defining the file, setting a description, and then creating our function:<div class="informalexample"><pre class="programlisting">/**
* @file
*  A delicious notification alert
*/
var delicious = (function ( ) {
})();</pre></div></li><li class="listitem">After the function, we'll tell jQuery to load this function on the page load event:<div class="informalexample"><pre class="programlisting">jQuery(delicious.onPageLoad);</pre></div></li><li class="listitem">We'll now start adding the contents of the function. We'll create the object that will be returned when the function is called inside our function:<div class="informalexample"><pre class="programlisting">/**
* Pubic object.
* @type {{}}
*/
var self = {};</pre></div></li><li class="listitem">Following our '<code class="literal">self'</code> object, we'll create our jQuery selector, picking up the content we want to bind a <code class="literal">click</code> function to:<div class="informalexample"><pre class="programlisting">/**
* The delicious recipe content.
*
* @type {jQuery}
*/
var $deliciousContent = jQuery('.delicious-content');</pre></div></li><li class="listitem">Next, we'll bind<a class="indexterm" id="id308"/> the content click event and create our alerting function, which we'll make translatable:<div class="informalexample"><pre class="programlisting">/**
* Bind the recipe content click event.
*/
var bindRecipeContentEvent = function () {
   $deliciousContent.on('click', function () {
       deliciousAlert();
   });
};

/**
* Alert the user that this is delicious.
*/
var deliciousAlert = function () {
   window.alert(Drupal.t("This is delicious!"));
};</pre></div></li><li class="listitem">Finally, we'll set a property of our <code class="literal">self</code> object to be an anonymous function that calls the <code class="literal">bindRecipeContentEvent</code> function at page load. We'll then return the object:<div class="informalexample"><pre class="programlisting">/**
* Page load event.
*/
self.onPageLoad = function () {
   bindRecipeContentEvent();
};

return self;</pre></div><p>The contents of <code class="literal">delicious.js</code> should now be:</p><div class="informalexample"><pre class="programlisting">/**
* @file
*  A delicious notification alert
*/
var delicious = (function ( ) {
   /**
    * Pubic object.
    * @type {{}}
    */
   var self = {};

   /**
    * The delicious recipe content.
    *
    * @type {jQuery}
    */
   var $deliciousContent = jQuery('.delicious-content');

   /**
    * Bind the recipe content click event.
    */
   var bindRecipeContentEvent = function () {
       $deliciousContent.on('click', function () {
           deliciousAlert();
       });
   };

   /**
    * Alert the user that this is delicious.
    */
   var deliciousAlert = function () {
       window.alert(Drupal.t("This is delicious!"));
   };

   /**
    * Page load event.
    */
   self.onPageLoad = function () {
       bindRecipeContentEvent();
   };

   return self;
})();

jQuery(delicious.onPageLoad);</pre></div></li><li class="listitem">With <code class="literal">delicious.js</code> in <a class="indexterm" id="id309"/>place, we now need to add it as an asset library. In PhpStorm, open <code class="literal">recipes.libraries.yml</code>. Underneath the global-styling asset library, we'll create another, called <code class="literal">delicious</code>. This one will include the JS we just created, and will also specify our dependency on jQuery, a version of which sits in core for us to use. (In Drupal 8, core contains a lot of libraries for dependencies, including jQuery UI, Modernizr, and Backbone to name a few. See <code class="literal">core</code> / <code class="literal">core.libraries.yml</code> for the complete list):<div class="informalexample"><pre class="programlisting">delicious:
 version: 1.0
 js:
   js/delicious.js: {}
 dependencies:
   - core/jquery</pre></div></li><li class="listitem">The last <a class="indexterm" id="id310"/>process is to add the asset library to the site. This time, we don't want it to apply globally, as we only want <code class="literal">delicious.js</code> and jQuery to load on the specific pages they're needed on. For that, we'll create a very specific Twig template. We're going to gloss over the details for now, as they'll be covered later in the chapter. In the <code class="literal">recipes</code> directory, create a new directory called <code class="literal">templates</code> and then inside that create one called <code class="literal">field</code>.</li><li class="listitem">Inside <code class="literal">recipes</code> | <code class="literal">templates</code> | <code class="literal">field</code>, create a file named <code class="literal">field--node--field-description--recipe.html.twig.</code></li><li class="listitem">Inside that file, paste the following code. As mentioned, we'll gloss over Twig for now, but note that we're applying a class of <code class="literal">delicious-content</code> for our JS to apply to, and we're attaching the asset library using the <code class="literal">attach_library</code> function. This means that the asset library will only ever load on pages that include the specific recipe description field:<div class="informalexample"><pre class="programlisting">{%
set classes = [
'field',
'field--name-' ~ field_name|clean_class,
'field--type-' ~ field_type|clean_class,
'field--label-' ~ label_display,
'delicious-content',
]
%}
{%
set title_classes = [
'field__label',
label_display == 'visually_hidden' ? 'visually-hidden',
]
%}

{{ attach_library('recipes/delicious') }}
{% if label_hidden %}
   {% if multiple %}
       &lt;div{{ attributes.addClass(classes, 'field__items') }}&gt;
           {% for item in items %}
               &lt;div{{ item.attributes.addClass('field__item') }}&gt;{{ item.content }}&lt;/div&gt;
           {% endfor %}
       &lt;/div&gt;
   {% else %}
       {% for item in items %}
           &lt;div{{ attributes.addClass(classes, 'field__item') }}&gt;{{ item.content }}&lt;/div&gt;
       {% endfor %}
   {% endif %}
{% else %}
   &lt;div{{ attributes.addClass(classes) }}&gt;
       &lt;div{{ title_attributes.addClass(title_classes) }}&gt;{{ label }}&lt;/div&gt;
       {% if multiple %}
       &lt;div class='field__items'&gt;
           {% endif %}
           {% for item in items %}
               &lt;div{{ item.attributes.addClass('field__item') }}&gt;{{ item.content }}&lt;/div&gt;
           {% endfor %}
           {% if multiple %}
       &lt;/div&gt;
       {% endif %}
   &lt;/div&gt;
{% endif %}</pre></div></li><li class="listitem">Clear our caches with Drush:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ drush cr</strong></span>
</pre></div></li></ol></div><p>Ok, let's<a class="indexterm" id="id311"/> test that it's working! In your browser on the homepage, click on the title of one of the items in the list of recipes to be taken through to the full node. When you click on any of the text in the description section, our alert should appear:</p><div class="mediaobject"><img alt="Time for action – calling assets on specific pages" src="graphics/4659_05_05.jpg"/></div><p>Awesome! Now, let's test to see if <code class="literal">delicious.js</code> is loading only on our desired pages. If we view the source of the current page and do a search for it, we'll obviously find it:</p><div class="mediaobject"><img alt="Time for action – calling assets on specific pages" src="graphics/4659_05_06.jpg"/></div><p>Do the same <a class="indexterm" id="id312"/>search on the homepage and no results will be found. Exactly as we had hoped.</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec40"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We created a simple piece of JS, added it as an asset library with a jQuery dependency, and used a Twig template to ensure that the asset library is only loaded on pages with the correct field.</p></div></div>
<div class="section" title="Introduction to templating and Twig"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec62"/>Introduction to templating and Twig</h1></div></div></div><p>We skipped over templates and Twig in the previous section, so let's discuss them in more depth.</p><p>Templates <a class="indexterm" id="id313"/>will become the bread and butter of your experience of theming Drupal. They are the way we logically filter our data and create our required HTML structure. A standard page on a Drupal site is built from a set of nested templates. At each level of <a class="indexterm" id="id314"/>the nested structure, different variables are available to you that allow you to render the content you desire. Any of the templates mentioned next can be copied into your theme, either from Drupal core or your parent theme. The base versions of all the templates live in core, but your parent theme may already have templates you can copy that have a structure that gets you most of the way to your goal, or perhaps is already using a specifically named template you want to override.</p><p>Here's an example of some of the templates being used on our homepage:</p><div class="mediaobject"><img alt="Introduction to templating and Twig" src="graphics/4659_05_07.jpg"/></div><p>A quick note for<a class="indexterm" id="id315"/> those moving from Drupal 7 to Drupal 8—you may be wondering about theme functions—they are no more. All themable output is run through templates.</p><p>The template nesting hierarchy starts with a template defining the basic structure of the HTML page, including the <code class="literal">&lt;head&gt;</code> and <code class="literal">&lt;body&gt;</code> tags. The base template that does this is <code class="literal">html.html.twig</code>, and is located in <code class="literal">core/modules/system/templates/html.html.twig</code>. It's well worth having a read of the comments provided in these base files for a description of what the template is for, as well as a list of the available variables.</p><p>After that, come the page templates. The base template for these is <code class="literal">page.html.twig</code>, located in <code class="literal">core/modules/system/templates/page.html.twig</code>. This is where elements such as <code class="literal">&lt;header&gt;</code>, <code class="literal">&lt;main&gt;</code>, and <code class="literal">&lt;footer&gt;</code> are defined.</p><p>It's very common to want to create specific instances of the page template; for example, a custom front page with a different structure to the default pages on the site. We do that by using theme hook suggestions.</p><div class="section" title="Theme hook suggestions"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec41"/>Theme hook suggestions</h2></div></div></div><p>Theme <a class="indexterm" id="id316"/>hook suggestions are alternate templates you can create to override a default template file. They allow you to implement targeted overrides in your theme by using a specific naming convention.</p><p>When rendering an element, Drupal looks for template specificity—it uses the most specific template it can find. For example, when it's rendering your pages, if you create a template in your theme called <code class="literal">page-front.html.twig</code>, it uses that to render your front page. If no such file is found, it looks for the next most specific template, and continues to do that until it reaches the default <code class="literal">page.html.twig</code>.</p><p>In the next section, we'll move on to Twig debugging, where you will learn how to find out which templates your site is currently using, as well as discover some template naming suggestions for overriding them.</p><p>For further information and examples, refer to the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme_suggestions_HOOK/8">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme_suggestions_HOOK/8</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme_suggestions_alter/8">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme_suggestions_alter/8</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme_suggestions_HOOK_alter/8">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/function/hook_theme_suggestions_HOOK_alter/8</a></li></ul></div><p>For now, let's<a class="indexterm" id="id317"/> continue to look at templates and their hierarchy. After the <code class="literal">html.html.twig</code> template has defined the highest level <code class="literal">&lt;html&gt;</code>, <code class="literal">&lt;head&gt;</code>, and <code class="literal">&lt;body&gt;</code> tags, and <code class="literal">page.html.twig</code> has defined the <code class="literal">&lt;header&gt;</code>, <code class="literal">&lt;main&gt;</code>, and <code class="literal">&lt;footer&gt;</code> areas, the next level in our nested template tree are region templates. These are able to render the regions of the site (examples of regions in the Bartik theme are <code class="literal">sidebar_first</code>, <code class="literal">sidebar_second</code>, and <code class="literal">footer_first</code>, which are defined in its <code class="literal">.info.yml</code> file).  The base region template, <code class="literal">region.html.twig</code> is located in <code class="literal">core/modules/system/templates/region.html.twig</code>.</p><p>Inside our regions, any number of nodes, blocks, or fields can be rendered. There's a lot of Drupal terminology to be learned, and if this is all sounding new to you, the best place to start is to have a thorough read of the <a class="indexterm" id="id318"/>template section of the theming guide located at <a class="ulink" href="https://www.drupal.org/node/2186401">https://www.drupal.org/node/2186401</a>. There you'll find more information about template types, their base locations, and how to override them.</p><p>You may have noticed when we first looked at the core themes that there was one other directory there named <code class="literal">engines</code>. This houses the Twig templating engine, which replaces PHPTemplate from Drupal 7 as default (it is still possible, though not recommended, to use PHPTemplate). If you're new to Drupal, a templating engine, sometimes also called a theme engine, is the piece of software that combines our data with our theme's templates, and outputs HTML.</p><p>What was wrong with PHPTemplate? A number of things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Templates had too much power. For example, if a themer forgot to sanitize their user-submitted text, it left the site open to security issues (cross-site scripting). It was even possible to drop a site's database from a templating file! Feel like casually dropping the <code class="literal">users</code> table? <code class="literal">&lt;?php db_query('DROP TABLE {users}'); ?&gt;</code></li><li class="listitem" style="list-style-type: disc">It was complicated. Lots of templates and even more <code class="literal">theme()</code> functions. It had different syntaxes for rendering different data structures. All in all, a steep learning curve, which put a lot of developers off.</li><li class="listitem" style="list-style-type: disc">Markup wasn't very pretty or human readable.</li><li class="listitem" style="list-style-type: disc">It was Drupal-specific.</li></ul></div><p>So why Twig?</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It's <a class="indexterm" id="id319"/>more secure. PHP functions, such as <code class="literal">db_query</code>, simply aren't available, and auto-escaping is enabled by default, so cross-site scripting is no longer an issue.</li><li class="listitem" style="list-style-type: disc">The syntax is very easy to read and use. <code class="literal">&lt;?php print render($content); ?&gt; becomes {{ content }}</code>. More syntax examples to follow.</li><li class="listitem" style="list-style-type: disc">Templates are extendable, thanks to its 'include' feature.</li><li class="listitem" style="list-style-type: disc">Twig isn't Drupal-specific, so we learn transferable skills.</li><li class="listitem" style="list-style-type: disc">It's well <a class="indexterm" id="id320"/>documented. See <a class="ulink" href="http://twig.sensiolabs.org/documentation">http://twig.sensiolabs.org/documentation</a>.</li></ul></div><p>Moving to <a class="indexterm" id="id321"/>Twig is probably the most radical frontend change in Drupal 8. Regardless of whether you're new to Drupal or you're making the move from Drupal 7, there will be some new material to learn. But as you'll see, the syntax is clean and human readable, and the effort you need to put into learning it is quickly recovered as you fly through writing your templates! Let's have a look at some of its features and syntax before we put it to use. If you're new to Drupal, the following section may be initially confusing, but should serve as a good reference point when you begin to work in Twig.</p></div><div class="section" title="File and function names"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec42"/>File and function names</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">PHPTemplate<a class="indexterm" id="id322"/> filename syntax: <code class="literal">block--search-form-block.tpl.php</code></li><li class="listitem" style="list-style-type: disc">Twig filename syntax: <code class="literal">block--search-form-block.html.twig</code></li><li class="listitem" style="list-style-type: disc">PHPTemplate function: <code class="literal">theme_node_links()</code></li><li class="listitem" style="list-style-type: disc">Twig file: <code class="literal">node-links.html.twig</code></li></ul></div></div><div class="section" title="Brackets syntax"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec43"/>Brackets syntax</h2></div></div></div><p>Twig has <a class="indexterm" id="id323"/>three bracket types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">{# #}</code>: This is used for comments. Text inside these brackets never gets output.</li><li class="listitem" style="list-style-type: disc"><code class="literal">{{ }}</code>: This is used for rendering. We'll see some examples in subsequent sections.</li><li class="listitem" style="list-style-type: disc"><code class="literal">{% %}</code>: This is used for control structures such as <code class="literal">for</code> loops or conditionals. We'll see some examples in subsequent sections.</li></ul></div></div><div class="section" title="Rendering"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec44"/>Rendering</h2></div></div></div><p>Rendering<a class="indexterm" id="id324"/> a variable is done by typing the variable name in the printing bracket syntax: <code class="literal">{{ car }}</code></p><p>Let's use an example of a multidimensional <code class="literal">car</code> array in PHP:</p><div class="informalexample"><pre class="programlisting">$car = array(
  'maxSpeed' =&gt; 200,
  'gearbox' =&gt; 'six-speed',
  'optionalUpgrades' =&gt; array(
    'engine' =&gt; array(
        'upgrade' =&gt; 'turbo-charged engine',
        'price' =&gt; 500,
    ),
    'windows' =&gt; array(
        'upgrade' =&gt; 'tinted windows',
        'price' =&gt; 150
    ),
  ),
);</pre></div><p>To print an attribute of a variable, the powerful "dot" is used. <code class="literal">{{ car.maxSpeed }}</code> returns <code class="literal">200</code>.</p><p>This dot syntax checks a number of possible scenarios for <code class="literal">maxSpeed</code>. The following is its process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Check if <code class="literal">car</code> is an array and <code class="literal">maxSpeed</code> a valid element</li><li class="listitem" style="list-style-type: disc">If not, and if <code class="literal">foo</code> is an object, check that <code class="literal">maxSpeed</code> is a valid property</li><li class="listitem" style="list-style-type: disc">If not, and if <code class="literal">foo</code> is an object, check that <code class="literal">maxSpeed</code> is a valid method (even if <code class="literal">maxSpeed</code> is the constructor—use <code class="literal">__construct() </code>instead)</li><li class="listitem" style="list-style-type: disc">If not, and if <code class="literal">foo</code> is an object, check that <code class="literal">getMaxSpeed</code> is a valid method;</li><li class="listitem" style="list-style-type: disc">If not, and if <code class="literal">foo</code> is an object, check that <code class="literal">isMaxSpeed</code> is a valid method;</li><li class="listitem" style="list-style-type: disc">If not, return a null value</li></ul></div><p>It's multidimensional: <code class="literal">{{ car.optionalUpgrades.engine.upgrade }}</code> returns <code class="literal">turbo-charged engine</code>.</p><p>At the time of <a class="indexterm" id="id325"/>writing, hashkeys in render arrays are not able to be targeted with the dot syntax. There is an active issue for this: <a class="ulink" href="https://www.drupal.org/node/2160611">https://www.drupal.org/node/2160611</a> but for now, the syntax <code class="literal">['#haskey']</code> is needed, that is <code class="literal">{{ item.property['#markup'] }}.</code></p></div><div class="section" title="Filters"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec45"/>Filters</h2></div></div></div><p>With Twig,<a class="indexterm" id="id326"/> we can push a variable through a filter before it's rendered: <code class="literal">{{ car.gearbox |capitalize }}</code> returns <code class="literal">Six-speed</code>. As well as Twig's default filters, Drupal has included extras, such as translate: <code class="literal">{{ item |t }}</code>.</p><p>See a full list of the default Twig filters<a class="indexterm" id="id327"/> at <a class="ulink" href="http://twig.sensiolabs.org/doc/filters/index.html">http://twig.sensiolabs.org/doc/filters/index.html</a>.</p><p>You can find the list of Drupal's extra filters in <code class="literal">core/lib/Drupal/Core/Template/TwigExtension.php</code> inside <code class="literal">getFilters()</code>.</p></div><div class="section" title="Control structures"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec46"/>Control structures</h2></div></div></div><p>The <a class="indexterm" id="id328"/>following are the different control structures:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">if</code> statements:<div class="informalexample"><pre class="programlisting">{% if car.maxSpeed %}
  &lt;div class="max-speed"&gt;This car will reach {{ car.maxSpeed }} kph!&lt;/div&gt;
{% endif %}</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">for</code> loops:<div class="informalexample"><pre class="programlisting">{% for item in optionalUpgrades %}
  &lt;li class="item-list upgrades"&gt; {{ item.upgrade }} &lt;/li&gt;
{% endfor %}</pre></div></li><li class="listitem" style="list-style-type: disc">Variable creation:<div class="informalexample"><pre class="programlisting">{% set seatFinish = "leather" %}</pre></div></li><li class="listitem" style="list-style-type: disc">Array creation:<div class="informalexample"><pre class="programlisting">{% set colourScheme = [ 'blue', 'white', ] %}</pre></div></li></ul></div></div></div>
<div class="section" title="Debugging Twig"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec63"/>Debugging Twig</h1></div></div></div><p>Twig, by <a class="indexterm" id="id329"/>default, offers a great debugging tool. With Drupal 8, it's extended even further. We'll enable it and begin using it in the next section, but for now, let's go through the abilities it gives us.</p><div class="section" title="HTML comments in markup"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec47"/>HTML comments in markup</h2></div></div></div><p>Drupal 8 extends<a class="indexterm" id="id330"/> the default Twig debug tool here, giving us information on template suggestions, as well as showing which template the markup is currently coming from:</p><div class="mediaobject"><img alt="HTML comments in markup" src="graphics/4659_05_08.jpg"/></div><p>In the preceding screenshot, we can see the comments for the recipe title field on our homepage. We can see that currently the template it's using is coming from the Classy theme. We also have the template name suggestions if we need to create something more or less specific to suit our needs.</p></div><div class="section" title="Debugging variables"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec48"/>Debugging variables</h2></div></div></div><p>To<a class="indexterm" id="id331"/> print all the available variables in one of our template files, we can use the <code class="literal">dump()</code> function.</p><p>We can print all the available variables:</p><div class="informalexample"><pre class="programlisting">{{ dump() }}</pre></div><p>There are a couple of global variables in Twig templates:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">_context</code>: This contains all the variables that are passed to the template file, such as variables prepared by preprocess, coming from <code class="literal">theme()</code>, or set from within the template</li><li class="listitem" style="list-style-type: disc"><code class="literal">{{ dump() }}</code>: This is equivalent to <code class="literal">{{ dump(_context) }}</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">{{ dump(\_context|keys) }}</code>: To print available keys</li><li class="listitem" style="list-style-type: disc"><code class="literal">_charset</code>: This references the (current) charset</li></ul></div><p>But beware, <code class="literal">{{ dump() }}</code> may result in a white screen of death. The process recursively moves through and prints a potentially very large list of variables, which can result in a loss of <a class="indexterm" id="id332"/>memory. If that's the case, you can do something like the following:</p><div class="informalexample"><pre class="programlisting">&lt;ol&gt;
    {% for key, value in _context  %}
        &lt;li&gt;{{ key }}&lt;/li&gt;
    {% endfor %}
&lt;/ol&gt;</pre></div><p>To print the content of a specific variable, like <code class="literal">$car</code>:</p><div class="informalexample"><pre class="programlisting">{{ dump($car) }}</pre></div><p>To print out the content of the <code class="literal">$car</code> and <code class="literal">$truck</code> variables:</p><div class="informalexample"><pre class="programlisting">{{ dump($car, $truck) }}</pre></div></div><div class="section" title="Kint"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec49"/>Kint</h2></div></div></div><p><code class="literal">{{ dump() }}</code> is an<a class="indexterm" id="id333"/> excellent tool, but if the element it's applied to<a class="indexterm" id="id334"/> contains a lot of information, the output can be difficult to interpret. The Devel module, which was used to create the dummy content for the site, contains a submodule called Kint. This module can be enabled with Drush:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$drush en kint</strong></span>
</pre></div><p>With it enabled, all the <code class="literal">{{ dump() }}</code> commands can be replaced with <code class="literal">{{ kint() }}</code>, which gives a more user-friendly output.</p></div></div>
<div class="section" title="Time for action &#x2013; Twig in practice"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec64"/>Time for action – Twig in practice</h1></div></div></div><p>Ok, let's <a class="indexterm" id="id335"/>put some of what you've learned in the previous section into practice. It would be nice to separate out the preparation stage in our recipe from the cooking stage. We'll do this by splitting the two types of fields into separate wrapping <code class="literal">div</code> tags, and then apply some styling to help us differentiate them:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll find out which template is currently in use by enabling Twig debugging. In PHPStorm, navigate to <span class="strong"><strong>sites</strong></span> / <span class="strong"><strong>default</strong></span>. If you have a file named <code class="literal">services.yml</code>, open it. If you don't, make a copy of <code class="literal">default.services.yml</code>, rename it to <code class="literal">services.yml</code>, and open it.</li><li class="listitem">Look for the section called <code class="literal">twig.config</code>. In this section, you will find an option that currently says debug: <span class="strong"><strong>false</strong></span>. Change that value to <span class="strong"><strong>true</strong></span> and save. Like aggregation for CSS and JS, this will improve your development conditions, but ensure it's turned off again before the site is in production.</li><li class="listitem">If in step 3 you encountered a permissions error, you will need to reset permissions in the <span class="strong"><strong>sites</strong></span> / <span class="strong"><strong>default</strong></span> directory. In terminal, navigate to the sites directory and then enter the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ chmod 755 default</strong></span>
</pre></div></li><li class="listitem">We'll also <a class="indexterm" id="id336"/>enable Kint to help us with some debugging:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ drush en kint</strong></span>
</pre></div><p>With debugging enabled, let's have a look at the HTML output mentioned earlier. In your browser, click through to a full recipe page (I'm going to use the Awesome Sauce recipe, and I've added an image into the image field), and then inspect the HTML with your inspector of choice. (Right-click or <span class="emphasis"><em>cmd</em></span> + click on some of the content, then, depending on your browser and tools, you'll find an <span class="strong"><strong>Inspect</strong></span> option.) Note: if you're using Firebug, ensure comments are turned on:</p><div class="mediaobject"><img alt="Time for action – Twig in practice" src="graphics/4659_05_09.jpg"/></div><p>There's a lot of information available to you at this point, but you'll soon find that you can make your way through it with relative ease. Find the <code class="literal">&lt;article&gt;</code> element with a class of <code class="literal">node--type-recipe</code>. This is the structural point at which all the elements are wrapped in one containing div, so this is what we need to split:</p><div class="mediaobject"><img alt="Time for action – Twig in practice" src="graphics/4659_05_10.jpg"/></div><p>The template information regarding the element sits above it. As we can see from the green comments, the template being used is currently in <code class="literal">core/themes/bartik/templates/node.html.twig</code>. We can also see a number of file name suggestions, which we can choose from for extra specificity. We'll make use of the <code class="literal">node--recipe--full.html.twig</code> suggestion, which as the name implies, only applies to the full view mode.</p></li><li class="listitem">In PHPStorm, inside<a class="indexterm" id="id337"/> your theme's template directory, create a directory called content. Note that the directory names do not affect Drupal's ability to find a template. They are there to assist the developer in keeping work organized. Inside the content directory, create a file called <code class="literal">node--recipe--full.html.twig</code>.</li><li class="listitem">We'll now copy the contents of <code class="literal">core/themes/bartik/templates/node.html.twig</code> over into our newly created <code class="literal">node--recipe--full.html.twig</code>, so that we can begin overriding it. After that, your file's content should look as follows (the length comment is excluded):<div class="informalexample"><pre class="programlisting">{#
{%
set classes = [
'node',
'node--type-' ~ node.bundle|clean_class,
node.isPromoted() ? 'node--promoted',
node.isSticky() ? 'node--sticky',
not node.isPublished() ? 'node--unpublished',
view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
'clearfix',
]
%}
{{ attach_library('classy/node') }}
&lt;article{{ attributes.addClass(classes) }}&gt;
   &lt;header&gt;
       {{ title_prefix }}
       {% if not page %}
           &lt;h2{{ title_attributes.addClass('node__title') }}&gt;
               &lt;a href="{{ url }}" rel="bookmark"&gt;{{ label }}&lt;/a&gt;
           &lt;/h2&gt;
       {% endif %}
       {{ title_suffix }}
       {% if display_submitted %}
           &lt;div class="node__meta"&gt;
               {{ author_picture }}
               &lt;span{{ author_attributes }}&gt;
         {% trans %}Submitted by {{ author_name }} on {{ date }}{% endtrans %}
       &lt;/span&gt;
               {{ metadata }}
           &lt;/div&gt;
       {% endif %}
   &lt;/header&gt;
   &lt;div{{ content_attributes.addClass('node__content', 'clearfix') }}&gt;
       {{ content }}
   &lt;/div&gt;
&lt;/article&gt;</pre></div><p>Before doing anything to the file, see if you can spot some of what we've been discussing: array creation, conditional logic, and variable rendering.</p></li><li class="listitem">What<a class="indexterm" id="id338"/> we're interested in is the <code class="literal">{{ content }}</code> variable, as we'll need to drill into this to find the different fields we want to split into our two separate wrapper <code class="literal">div</code> tags. We'll use Kint to debug its contents. Adjust <code class="literal">{{ content }}</code> to <code class="literal">{{ kint(content) }}</code>, and then clear your cache with:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ drush cr.</strong></span>
</pre></div></li><li class="listitem">When you reload your page, the content will have disappeared (because it's no longer being rendered), and in its place you will have the debugging information. Open the array and then close down each inner array item (which will have opened by default), so that you're left with the following:<div class="mediaobject"><img alt="Time for action – Twig in practice" src="graphics/4659_05_11.jpg"/></div><p>We can see that the content array contains eight items, seven of which have keys with names of the different fields on our page. We'll be using these to print our custom output.</p></li><li class="listitem">There are some fields that are neither preparation nor cooking-based, and these ones we'd like to stay rendered in the normal div. Fields such as the description and the image. We want to exclude everything else though, so we can print them separately. We're going to make use of a Drupal Twig filter called <code class="literal">without</code>, which renders an element without specific inner items. Back in the template, replace <code class="literal">{{ kint(content) }}</code> with <code class="literal">{{ content|without('field_cooktime', 'field_preptime', 'field_ingredients', 'field_recipeinstructions') }}</code>. Our page will now only include the items we still want rendered in the normal way:<div class="mediaobject"><img alt="Time for action – Twig in practice" src="graphics/4659_05_12.jpg"/></div></li><li class="listitem">Now<a class="indexterm" id="id339"/> we'll render the fields in separate <code class="literal">div</code> tags. Directly beneath that last Twig statement, paste the following:<div class="informalexample"><pre class="programlisting">&lt;div class="preparation recipe-phase"&gt;
   {{ content.field_preptime }}
   {{ content.field_ingredients }}
&lt;/div&gt;
&lt;div class="cooking recipe-phase"&gt;
   {{ content.field_cooktime }}
   {{ content.field_recipeinstructions }}
&lt;/div&gt;</pre></div></li><li class="listitem">Now we'll go back to the theme's <code class="literal">style.css</code> file in the <code class="literal">css</code> directory and add some styling. Paste and save the following underneath the existing styling:<div class="informalexample"><pre class="programlisting">/* Override default image float on the recipe node */
.node--type-recipe .field--name-field-image {
   float: none;
}

.recipe-phase {
   padding: 20px;
   margin-bottom: 20px;
}

.preparation {
   background-color: #e7e7e7;
}

.cooking {
   background-color: #b0fbad;
}</pre></div><p>Let's have a <a class="indexterm" id="id340"/>look at the page again:</p><div class="mediaobject"><img alt="Time for action – Twig in practice" src="graphics/4659_05_13.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec50"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We used Twig debugging with Kint to determine the template we needed, and what variables were available to us. We used a Drupal-specific Twig filter to render content minus some items, and rendered those separately in the customized structure we wanted.</p><p>We got the results we wanted with this method, but it required us to break arrays apart. For larger content types with more fields, this would become cumbersome. There's another method, requiring the use of a contributed module. Let's take a look at that.</p></div></div>
<div class="section" title="Time for action &#x2013; understanding the benefits of contributed modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec65"/>Time for action – understanding the benefits of contributed modules</h1></div></div></div><p>Let's try to<a class="indexterm" id="id341"/> achieve the same result we got in the previous section, but this time, by using a contributed module called <code class="literal">field_group</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Delete <code class="literal">node--recipe--full.html.twig</code> inside <span class="strong"><strong>recipes</strong></span> / <span class="strong"><strong>templates</strong></span> / <span class="strong"><strong>content</strong></span> (or move the file outside of the project if you'd prefer to keep a copy of the work) and clear your cache.</li><li class="listitem">In command line, navigate to anywhere inside your Drupal project and type the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ drush en field_group -y</strong></span>
</pre></div><p>This command will enable the <code class="literal">field_group</code> module if you have it downloaded. If not, it will go ahead and download the latest stable release for you and enable it.</p></li><li class="listitem">Now back in the browser, navigate to <code class="literal">/admin/structure/types/manage/recipe/display</code> where the display settings for the recipe content type exist. You will see that we have a new piece of functionality at the bottom of the page:<div class="mediaobject"><img alt="Time for action – understanding the benefits of contributed modules" src="graphics/4659_05_14.jpg"/></div></li><li class="listitem">Type <code class="literal">preparation</code> into <a class="indexterm" id="id342"/>both the text inputs, select <span class="strong"><strong>Html element</strong></span> from the dropdown, and hit <span class="strong"><strong>Save</strong></span>.</li><li class="listitem">When the page reloads, you'll see the preparation group is now placed above the <span class="strong"><strong>Disabled</strong></span> label. On the right-hand side of the preparation group item, there's a cog. Click on that.</li><li class="listitem">The settings for the group will now open. Leave everything as default, apart from the <span class="strong"><strong>Extra CSS classes</strong></span> text input, where you can type <code class="literal">preparation recipe-phase</code>, and then click on the <span class="strong"><strong>Update</strong></span> button.<div class="mediaobject"><img alt="Time for action – understanding the benefits of contributed modules" src="graphics/4659_05_15.jpg"/></div></li><li class="listitem">Replicate these steps again, this time swapping <code class="literal">preparation</code> with <code class="literal">cooking</code>. When finished, you should have the two groups enabled.</li><li class="listitem">Now <a class="indexterm" id="id343"/>for some drag-and-dropping. Drag both the group fields up and place them underneath the <span class="strong"><strong>recipeYield</strong></span> field. Then, grab the <span class="strong"><strong>prepTime</strong></span> field and drag it above the preparation group item. You'll see that the icon automatically shifts to the right, as if it's indented. Drop that field there and then drag the <span class="strong"><strong>ingredients</strong></span> field into the preparation item area too, dropping it underneath <span class="strong"><strong>prepTime</strong></span>. Then drag <span class="strong"><strong>cookTime</strong></span> and <span class="strong"><strong>recipeInstructions</strong></span> into the cooking group area. When finished, your items should look like this:<div class="mediaobject"><img alt="Time for action – understanding the benefits of contributed modules" src="graphics/4659_05_16.jpg"/></div></li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button. Once the page has refreshed, you can see a notification as the following:<div class="mediaobject"><img alt="Time for action – understanding the benefits of contributed modules" src="graphics/4659_05_17.jpg"/></div></li><li class="listitem">Click <a class="indexterm" id="id344"/>on the <span class="strong"><strong>Back to site</strong></span> button in the top-left of your admin menu. We have achieved the same result:<div class="mediaobject"><img alt="Time for action – understanding the benefits of contributed modules" src="graphics/4659_05_18.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec51"/><span class="emphasis"><em>What just happened?</em></span></h2></div></div></div><p>We removed the<a class="indexterm" id="id345"/> templating we did with Twig and then replicated the functionality with the <code class="literal">field_group</code> module.</p><p>It's pretty neat that we were able to achieve the same amount of control over our markup so quickly and easily. What's more, this method is achievable by site builders as well as developers, and it will continue to be a quicker method for updating the content type if more fields are added. With this being the case, how should we decide whether to use a contributed module on our websites?</p></div></div>
<div class="section" title="What are contributed modules?"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec66"/>What are contributed modules?</h1></div></div></div><p>Contributed modules, or<a class="indexterm" id="id346"/> contrib modules, are pieces of Drupal functionality, contributed to the community and maintained by the community of developers, sometimes sponsored by companies keen to support open source. You can find all contrib modules in the <a class="indexterm" id="id347"/>modules section of Drupal at <a class="ulink" href="https://www.drupal.org/project/project_module">https://www.drupal.org/project/project_module</a> . The <code class="literal">field_group</code> module can be found at <a class="ulink" href="https://www.drupal.org/project/field_group">https://www.drupal.org/project/field_group</a>.</p><div class="section" title="How do I know whether a module is safe to use?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec52"/>How do I know whether a module is safe to use?</h2></div></div></div><p>It would indeed be risky to randomly pick and choose modules to use without prior knowledge, but there's lots of information<a class="indexterm" id="id348"/> about modules on Drupal (<a class="ulink" href="https://www.drupal.org/">https://www.drupal.org/</a>) that can inform you before use. These include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The number of people maintaining the project. The more eyes on the code, the more likely it is to be good quality.</li><li class="listitem" style="list-style-type: disc">The number of commits made, and how recently. Active maintenance means the module is more likely to be protected against any recent security issues.</li><li class="listitem" style="list-style-type: disc">The issue and bug queue. It's less about the number of bugs or issues and more about how well they're responded to.</li><li class="listitem" style="list-style-type: disc">The number of modules that depend on it. If a module is excellent, more and more developers will feel confident in having it as a dependency. A lot of core modules started life this way.</li><li class="listitem" style="list-style-type: disc">Whether the module is well documented.</li><li class="listitem" style="list-style-type: disc">The number of downloads and reported installations. Again, the more eyes on it, the better, and the more users, the greater the likelihood that bugs are found early.</li></ul></div><p>All of this is available to explore on a module's Drupal (<a class="ulink" href="https://www.drupal.org/">https://www.drupal.org/</a>) page.</p></div><div class="section" title="Is it better to use a contrib module or custom code?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec53"/>Is it better to use a contrib module or custom code?</h2></div></div></div><p>There is no hard<a class="indexterm" id="id349"/> and fast answer to this. The benefits of a contrib module include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Security. If lots of other developers are using it, it can give you confidence in code quality and security fixes.</li><li class="listitem" style="list-style-type: disc">You're not required for maintenance (unless you choose to contribute back to it).</li><li class="listitem" style="list-style-type: disc">Ease of use. As with the <code class="literal">field_group</code> example, it allows people with less development expertise to configure a powerful website.</li><li class="listitem" style="list-style-type: disc">A good learning opportunity. Dive into the module and explore how it is coded.</li><li class="listitem" style="list-style-type: disc">Usually more scalable.</li></ul></div><p>The benefits of<a class="indexterm" id="id350"/> custom code include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A clean, non-bloated solution to a unique problem.</li><li class="listitem" style="list-style-type: disc">Site performance. Large contrib modules with lots of extra functionality will negatively affect a site's performance more than clean, well-written code that addresses a single issue.</li><li class="listitem" style="list-style-type: disc">It gives you an opportunity to improve and test your development skills.</li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec67"/>Summary</h1></div></div></div><p>In this chapter, we explored theming in Drupal 8, from what a theme is and how to create one, to loading and using CSS and JS assets, as well as templating, and how to determine when and why to make use of contributed modules.</p><p>In the next chapter, we will explore CKEditor and be introduced to Block API for Drupal 8.</p></div></body></html>