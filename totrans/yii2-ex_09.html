<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Frontend to Display Rooms to Everyone"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Frontend to Display Rooms to Everyone</h1></div></div></div><p>This chapter will cover topics about using templates to have multiple apps in the same context.</p><p>Yii, indeed, allows you to have an advanced installation able to contain multiple instances of an Yii application. Therefore, every folder in the project is actually a new Yii application.</p><p>We will see how to install and configure the project, share data between them, and finally customize the URL to make them pretty for the search engine.</p><p>We will cover the following topics in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using an advanced template to split frontend and backend</li><li class="listitem" style="list-style-type: disc">Configuring an application using init<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – creating frontend for public access</li></ul></div></li><li class="listitem" style="list-style-type: disc">Sharing ActiveRecord models among applications<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – displaying available rooms in frontend site</li></ul></div></li><li class="listitem" style="list-style-type: disc">Customizing a URL in an advanced template<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Example – using advanced templates in the same domain</li></ul></div></li><li class="listitem" style="list-style-type: disc">How to use advanced templates in shared hosting</li></ul></div><div class="section" title="Using an advanced template to split frontend and backend"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec63"/>Using an advanced template to split frontend and backend</h1></div></div></div><p>Until <a id="id399" class="indexterm"/>now, we <a id="id400" class="indexterm"/>have <a id="id401" class="indexterm"/>seen simple<a id="id402" class="indexterm"/> applications with only one single entry point to access. However, a single entry point isn't enough for more general applications. In advanced web applications, in fact, we have not just a single entry point but often three: frontend, backend, and a common area used as shared zone for every entry point.</p><p>The frontend entry point is a public access that is available to all users without restrictions.</p><p>On the other hand, the backend entry point is a restricted access available only for authenticated users that have administration roles for managing content in the web application.</p><p>Finally, the common entry point is used to share data between entry points.</p><p>Think about a reservation system, where frontend is the website displaying room availability and prices, while backend is the administration area, where operators can manage rooms.</p><p>In the same way, another example of frontend and backend could be a newspaper website that comprises a frontend area with news publically visible to all users, and a backend area where journalists can insert news.</p><p>Now that we <a id="id403" class="indexterm"/>know the differences between <a id="id404" class="indexterm"/>frontend and backend and their aim, we will<a id="id405" class="indexterm"/> create an advanced Yii application.</p><p>The steps to install an <a id="id406" class="indexterm"/>advanced template of the Yii application are similar to the ones to install basic templates.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note57"/>Note</h3><p>It is highly recommended, at this point, to have a console access the host, where we can put files.</p></div></div><p>Locate the web hosting document root folder in the web hosting. Starting from it, we will launch commands to create the advanced application in a new subfolder named <code class="literal">yiiadv</code>, which stands for Yii installation with the advanced template.</p><p>We will install the Yii advanced template using Composer as it is the most recommended way. If we have not installed Composer as the global application yet, we can install it now in the <code class="literal">yiiadv</code> folder.</p><p>The following are the instructions to install Yii advanced template starting from document root folder:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ curl -sS https://getcomposer.org/installer | php</strong></span>
<span class="strong"><strong>$ php composer.phar global require "fxp/composer-asset-plugin:~1.0.0"</strong></span>
<span class="strong"><strong>$ php composer.phar create-project --prefer-dist yiisoft/yii2-app-advanced yiiadv</strong></span>
</pre></div><p>By opening the <code class="literal">yiiadv</code> subfolder, we can see some new folders beside the basic template, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">backend</code>: This folder is the entry point for the backend application of the project</li><li class="listitem" style="list-style-type: disc"><code class="literal">common</code>: This folder is the entry point for the application containing common data for the other applications in the project</li><li class="listitem" style="list-style-type: disc"><code class="literal">console</code>: This folder is the entry point for the console application of the project</li><li class="listitem" style="list-style-type: disc"><code class="literal">frontend</code>: This folder is the entry point for the frontend application of the project</li></ul></div><p>This structure is the result of the experience on developing the web application. Backend and frontend entry points have been formerly discussed; the common entry point is an area where to put data (common models, components, and so on) shared among all the other applications in the project.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note58"/>Note</h3><p>Every application in the project (backend, frontend, common, and console) is considered as a single namespace in the web application. So, when we refer to <code class="literal">RoomsController</code> in the frontend, the complete class namespace will be <code class="literal">frontend/controllers/RoomsController</code>.</p></div></div><p>This<a id="id407" class="indexterm"/> installation is still raw and requires an <a id="id408" class="indexterm"/>initialization using the <code class="literal">init</code> command. However, if <a id="id409" class="indexterm"/>we try to open any of these applications, we <a id="id410" class="indexterm"/>can recognize the same basic template structure with <code class="literal">assets</code>, <code class="literal">config</code>, <code class="literal">controllers</code>, <code class="literal">models</code>, <code class="literal">runtime</code>, <code class="literal">views</code>, and <code class="literal">web</code> subfolders. So, a basic template application can be considered the only unique application in an advanced template one.</p><p>Finally, in the advanced template properties, every application starting point is always in <code class="literal">web/index.php</code>. For example, for the frontend application, the starting point is <code class="literal">frontend/web/index.php</code>.</p></div></div>
<div class="section" title="Configuring an application using init"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec64"/>Configuring an application using init</h1></div></div></div><p>Apart from <a id="id411" class="indexterm"/>having <a id="id412" class="indexterm"/>multiple kinds of configuration, we can have multiple entry points in advanced applications.</p><p>In advanced web applications, in fact, we also have a different approach in the development stage. We usually have two environments: development and production. In the first one, we make tests using fake users, data, and so on, while in the second one we must take care to guarantee the proper functioning of the project.</p><p>Therefore, we will have different sets of configuration files and parameters based on environments where we will work in.</p><p>We could wish, in fact, to test the application using the development database instead of the production database, or specific parameters available only in a specific environment.</p><p>Indeed, the <code class="literal">init</code> command offers this capability to switch different configuration and parameters for different environments. Basically, there are two environments: development and production.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note59"/>Note</h3><p>A first initialization is needed to make sure that the project could work.</p></div></div><p>The <code class="literal">init</code> command<a id="id413" class="indexterm"/> can be launched both in interactive mode as well <a id="id414" class="indexterm"/>as in noninteractive (silent) one.</p><p>In the interactive mode, starting from the <code class="literal">yiiadv</code> folder:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php init</strong></span>
</pre></div><p>And in a noninteractive (silent) mode:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php init --env=Development --overwrite=All</strong></span>
</pre></div><p>In both modalities, we need to specify only the target environment if we want to overwrite all the current configuration files.</p><p>This command will simply copy the content of the chosen environment (according to the type of selected environment) in the respective application folder, with the same name starting from root.</p><p>For example, open the folder in <code class="literal">environments/dev/backend</code>. We will see two folders: <code class="literal">config</code> and <code class="literal">web</code>, containing the first two configuration files and the other files <code class="literal">index.php</code> and <code class="literal">index-test.php</code>. These files will overwrite the corresponding files in the <code class="literal">backend</code> folder starting from the root folder of the project.</p><p>So, if we launch the preceding command with parameters of <code class="literal">init</code>, the content of the folders in <code class="literal">environments/dev</code> (the <code class="literal">backend</code>, <code class="literal">common</code>, <code class="literal">console</code>, and <code class="literal">frontend</code> folders) will be copied in the <code class="literal">backend</code>, <code class="literal">common</code>, <code class="literal">console</code>, and <code class="literal">frontend</code> folders starting from the root folder of the project.</p><p>Also, with this command, other operations such as making some folders writable or applying specific values to configuration properties, are accomplished. However, the <code class="literal">init</code> command is mainly used to switch different configurations and <code class="literal">index.php</code> files.</p><p>Starting from any application of the project (backend, frontend, common, and console), configuration values and parameters taken from the top of any application's <code class="literal">index.php</code> file (backend, frontend, common, or console) are read in the following sequence:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">common/config/main.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">common/config/main-local.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">config/main.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">config/main-local.php</code></li></ul></div><p>This means that the <code class="literal">config</code> parameters are initially read firstly from <code class="literal">common/config/main.php</code> then from <code class="literal">common/config/main-local.php</code>, then again from <code class="literal">application config/main.php</code>, and finally from <code class="literal">application config/main-local.php</code>. The properties with same name will be overwritten during the reading of other configuration files.</p><p>Therefore, if the same configuration property is declared in all four configuration files, its value will be the same as <code class="literal">config/main-local.php</code>, which is the last configuration file to be read.</p><p>Since, we locally have a last chance to apply differences towards a specific property of configuration with the <code class="literal">-local</code> version of files, the content of environment subfolders will be only about the <code class="literal">-local</code> version of a specific file. For example, if we open <code class="literal">environments/dev/backend/config path</code>, we will see only <code class="literal">main-local.php</code> and <code class="literal">params-local.php</code>, practically the last two filenames that <code class="literal">index.php</code> will read in sequence.</p><p>So if we change <a id="id415" class="indexterm"/>the database connection parameters in <code class="literal">environments/dev/backend/config/main-local.php</code> and then apply <code class="literal">init</code> with the <code class="literal">dev</code> target<a id="id416" class="indexterm"/> environment, this file will overwrite <code class="literal">backend/config/main-local.php</code>. This is the last configuration file that <code class="literal">backend/web/index.php</code> will read during its bootstrap (if we browse <code class="literal">/backend/web/index.php</code>).</p><p>Now that we have executed the <code class="literal">init</code> command in the <code class="literal">dev</code> environment, we can point the browser to <code class="literal">http://hostname/yiiadv/frontend/web</code> and we should see the same congratulations page of the basic template.</p><p>In the same way, the backend entry point is also available pointing to <code class="literal">http://hostname/yiiadv/backend/web</code>, where a login form is displayed by default (this is because it is a restricted area).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note60"/>Note</h3><p>If we want to add a new application in the project, it is enough to copy the content of frontend or backend folder to another new folder in the project.</p></div></div><div class="section" title="Example – creating frontend for public access"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec43"/>Example – creating frontend for public access</h2></div></div></div><p>As we have seen, the frontend application is a reachable pointing browser to <code class="literal">http://hostname/yiiadv/frontend/web</code>.</p><p>However, the <a id="id417" class="indexterm"/>first thing to set in the frontend access is URL-friendly<a id="id418" class="indexterm"/> customization; this is because it is important that our public website is well positioned in the search engine.</p><p>As we have done in the basic template, we can render pretty URLs in the advanced template too, following these two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the <code class="literal">.htaccess</code> file in <code class="literal">yiiadv/frontend/web</code>.</li><li class="listitem">Add the <code class="literal">urlManager</code> component in <code class="literal">yiiadv/frontend/config/main.php</code>.</li></ol></div><p>In step 1, it is enough to create a file in <code class="literal">yiiadv/frontend/web/.htaccess</code> with the following content:</p><div class="informalexample"><pre class="programlisting">RewriteEngine on

# If a directory or a file exists, use it directly
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# Otherwise forward it to index.php
RewriteRule . index.php</pre></div><p>This code will make the web server URL rewrite work, rewriting all requests to the <code class="literal">index.php</code> file in <code class="literal">yiiadv/frontend/web</code>.</p><p>While, in step 2, we must add the <code class="literal">urlManager</code> property in <code class="literal">yiiadv/frontend/config/main.php</code>:</p><div class="informalexample"><pre class="programlisting">         'urlManager' =&gt; [
            'enablePrettyUrl' =&gt; true,
            'showScriptName' =&gt; false,
        ],</pre></div><p>Now we can refresh the web browser to <code class="literal">http://hostname/yiiadv/frontend/web</code> and navigation to the URL link on the top, and we can see, for instance, that URL is in pretty form.</p><p>We can consider the <code class="literal">frontend</code> folder as a Yii standalone application and we can create controllers, views, models, and so on.</p></div></div>
<div class="section" title="Sharing ActiveRecord models among applications"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec65"/>Sharing ActiveRecord models among applications</h1></div></div></div><p>Although every <a id="id419" class="indexterm"/>folder in the main Yii project could be <a id="id420" class="indexterm"/>considered a Yii standalone application, with its own controllers, models, views, and so on, it is conventionally accepted that all shared data are located in the <code class="literal">common</code> folder.</p><p>So every shared model (such as <code class="literal">User</code>, <code class="literal">Room</code>, <code class="literal">Reservation</code>, and <code class="literal">Customer</code>) that could be used in other Yii applications, should be inserted in <code class="literal">common/models</code>, under the <code class="literal">common\models</code> namespace.</p><p>From my point of view, when an application needs to use an ActiveRecord from <code class="literal">common/models</code>, I rather prefer to point to an extended version in its namespace, so as to have a chance again to add custom methods or properties to model for that application.</p><p>For example, consider we have the <code class="literal">Room</code> model in <code class="literal">common/models</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?php
namespace common\models;
class Room extends ActiveRecord
{
….
….
}</pre></div><p>In the backend application, we will create an empty extension to the <code class="literal">Room</code> class from common namespace:</p><div class="informalexample"><pre class="programlisting">&lt;?php
namespace backend\models;
class Room extends \common\models\Room
{
}</pre></div><p>In this way, we have the possibility to add custom methods or properties to that specific application (namespace), if needed.</p><p>Therefore, every controller, view, or model in backend namespace will point to <code class="literal">\backend\models\Room</code>, when it needs to refer to the <code class="literal">Room</code> ActiveRecord.</p><div class="section" title="Example – displaying available rooms in the frontend site"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec44"/>Example – displaying available rooms in the frontend site</h2></div></div></div><p>This example will emphasize the<a id="id421" class="indexterm"/> few differences between basic and<a id="id422" class="indexterm"/> advanced applications occurring in the developing phase.</p><p>The first thing to do is to check whether the database configuration is right, since we have just initialized an advanced application.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note61"/>Note</h3><p>The database configuration on the production server can be found in <code class="literal">common/config/main.php</code>, whereas the database configuration on the developing server is located in <code class="literal">common/config/main-local.php</code>, which overwrites the configuration in <code class="literal">common/config/main.php</code>.</p></div></div><p>Open <code class="literal">common/config/main.php</code> and add the <code class="literal">db</code> property to the configuration array:</p><div class="informalexample"><pre class="programlisting">        'db' =&gt; [
            'class' =&gt; 'yii\db\Connection',
            'dsn' =&gt; 'mysql:host=localhost;dbname=yii_db',
            'username' =&gt; 'my_username',
            'password' =&gt; 'my_password',
            'charset' =&gt; 'utf8',   
        ],</pre></div><p>Change the database properties (<code class="literal">host</code>, <code class="literal">username</code>, and <code class="literal">password</code>) according to our configuration parameters.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note62"/>Note</h3><p>Remember to comment out the database configuration in <code class="literal">common/config/main-local.php</code> to avoid overwriting configurations.</p></div></div><p>In this way, we will have complete access to the database and tables previously created, and to rooms' data, indeed.</p><p>Now, we are ready to create:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The <code class="literal">Room</code> model.</li><li class="listitem">The <code class="literal">Rooms</code> controller.</li><li class="listitem">View of index action of the <code class="literal">Rooms</code> controller.</li></ol></div><p>The first step<a id="id423" class="indexterm"/> requires the use of Gii. By default, Gii is <a id="id424" class="indexterm"/>enabled with basic configuration in the frontend application (only from localhost).</p><p>We will overwrite this configuration so as to use Gii from everywhere. Therefore, in the frontend local configuration (<code class="literal">frontend/config/main-local.php</code>), which has the following lines:</p><div class="informalexample"><pre class="programlisting">    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = 'yii\gii\Module';</pre></div><p>Replace them with these ones:</p><div class="informalexample"><pre class="programlisting">    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = [
            'class' =&gt; 'yii\gii\Module',
            'allowedIPs' =&gt; ['*']
    ];    </pre></div><p>Now, we can finally access Gii from everywhere. Using the browser, go to <code class="literal">http://hostname/yiiadv/frontend/web/gii</code>; a welcome page should be displayed.</p><p>Go to <span class="strong"><strong>Model Generator</strong></span> and fill the first field, <code class="literal">Table Name</code>, with <code class="literal">room</code>, the name of model we are creating, just as we have done in the previous chapters.</p><p>Since, we are working with the advanced template, model files (like other objects created by Gii) will be created in the <code class="literal">frontend</code> namespace, or rather in <code class="literal">frontend/models</code>.</p><p>Therefore, it is necessary to change the first field of <span class="strong"><strong>Model Generator</strong></span>, <span class="strong"><strong>Namespace</strong></span>, so as to switch from <code class="literal">app/models</code> to <code class="literal">common/models</code>, the shared area of common data:</p><div class="mediaobject"><img src="graphics/B04656_09_01.jpg" alt="Example – displaying available rooms in the frontend site"/><div class="caption"><p>Gii model generator in advanced template</p></div></div><p>In <code class="literal">common/models</code>, there should be a <code class="literal">Room.php</code> file containing the model of the <code class="literal">Room</code> table.</p><p>The second step it is <a id="id425" class="indexterm"/>to create the controller and the action<a id="id426" class="indexterm"/> of the controller to display the rooms list.</p><p>Let's create the controller under <code class="literal">frontend/controllers/RoomsController.php</code> with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;?php
namespace frontend\controllers;

use Yii;
use yii\web\Controller;
use yii\data\ActiveDataProvider;
use common\models\Room;

class RoomsController extends Controller
{
    public function actionIndex()
    {
        $dataProvider = new ActiveDataProvider([
            'query' =&gt; Room::find(),
            'pagination' =&gt; [
                'pageSize' =&gt; 20,
            ],
        ]);
        
        return $this-&gt;render('index', [
            'dataProvider' =&gt; $dataProvider,
        ]);
    }
}</pre></div><p>Make sure that the<a id="id427" class="indexterm"/> namespace declaration on top<a id="id428" class="indexterm"/> is <code class="literal">frontend\controllers</code>, since every application in the web project has its own namespace (in this case, <code class="literal">frontend</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note63"/>Note</h3><p>We should never directly subclass <code class="literal">yii\web\Controller</code>, instead we should create a custom controller for each application, for example, <code class="literal">frontend\controllers\BaseController</code>, and then subclass it from every controller that we will create in <code class="literal">frontend\controllers</code>.</p></div></div><p>Finally, the third step is to create view content of index action in <code class="literal">frontend/views/rooms/index.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div class="row"&gt;
&lt;?php foreach($dataProvider-&gt;getModels() as $model) { ?&gt;
    &lt;div class="col-md-3" style="border:1px solid gray; margin-right:10px; padding:20px;"&gt;
        &lt;h2&gt;Room #&lt;?= $model-&gt;id ?&gt;&lt;/h2&gt;
        Floor: &lt;?= $model-&gt;floor ?&gt;
        &lt;br /&gt;
        Number: &lt;?= $model-&gt;room_number; ?&gt;
    &lt;/div&gt;
&lt;?php } ?&gt;
&lt;/div&gt;</pre></div><p>This will produce the following output with the data available in the database:</p><div class="mediaobject"><img src="graphics/B04656_09_02.jpg" alt="Example – displaying available rooms in the frontend site"/><div class="caption"><p>Rooms availability in the frontend</p></div></div></div></div>
<div class="section" title="Customizing a URL in the advanced template"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec66"/>Customizing a URL in the advanced template</h1></div></div></div><p>When working with <a id="id429" class="indexterm"/>multiple applications in the <a id="id430" class="indexterm"/>same project, you might require access from an application to another, for example, from the backend to a frontend link. This is because we want to display public page rendering in the frontend after inserting data in the backend.</p><p>The <code class="literal">urlManager </code>property is customized with references about the application where it is defined. However, we can add specific properties to refer to the respective application.</p><p>Therefore, in <code class="literal">common/config/main.php</code>, we can add these two properties:</p><div class="informalexample"><pre class="programlisting">        'urlManagerFrontend' =&gt; [
            'class' =&gt; 'yii\web\urlManager',
            'baseUrl' =&gt; '/yiiadv/frontend/web',
            'enablePrettyUrl' =&gt; true,
            'showScriptName' =&gt; false,
        ],      
        
        'urlManagerBackend' =&gt; [
            'class' =&gt; 'yii\web\urlManager',
            'baseUrl' =&gt; '/yiiadv/backend/web',
            'enablePrettyUrl' =&gt; true,
            'showScriptName' =&gt; false,
        ],</pre></div><p>For example, we can get a URL to frontend from everywhere. It is enough to write this code <code class="literal">echo Yii::$app-&gt;urlManagerFrontend-&gt;createUrl(...)</code> to create a URL from frontend.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note64"/>Note</h3><p>It is necessary to put the <code class="literal">.htaccess</code> file in the <code class="literal">web</code> folder of each application that has the <code class="literal">enablePrettyUrl</code> property in the <code class="literal">urlManager</code> configuration.</p></div></div><p>Yii also provides convenient <a id="id431" class="indexterm"/>aliases to application paths, other than<a id="id432" class="indexterm"/> the default aliases of the basic template:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">@common</code>: This is the common directory</li><li class="listitem" style="list-style-type: disc"><code class="literal">@frontend</code>: This is the frontend web application directory</li><li class="listitem" style="list-style-type: disc"><code class="literal">@backend</code>: This is the backend web application directory</li><li class="listitem" style="list-style-type: disc"><code class="literal">@console</code>: This is the console directory</li></ul></div><div class="section" title="Example – using the advanced template in the same domain"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec45"/>Example – using the advanced template in the same domain</h2></div></div></div><p>We have seen that <a id="id433" class="indexterm"/>the advanced template creates more applications in the same web application than we can reach using <code class="literal">/frontend</code> or <code class="literal">/backend</code> or any other application name prefix in the URL. However, it is not advisable, especially for frontend, that all URLs contain a <code class="literal">/frontend</code> prefix.</p><p>We want to have this URL format for frontend: <code class="literal">http://hostname/yiiadv/</code>; and this one for backend: <code class="literal">http://hostname/yiiadv/admin</code> (we can choose the name we want).</p><p>All requests have to be managed on the <code class="literal">/yiiadv</code> folder level. So, we will add an <code class="literal">.htaccess</code> file in the <code class="literal">/yiiadv</code> folder that it will dispatch to the correct route.</p><p>Here is a list of the actions that must be performed:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Configure <code class="literal">.htaccess</code> in <code class="literal">/yiiadv</code> to handle all requests.</li><li class="listitem">Configure the backend application to customize its <code class="literal">baseUrl</code>.</li><li class="listitem">Configure the frontend application to customize its <code class="literal">baseUrl</code>.</li></ol></div><p>It is obvious that steps 2 and 3 must be repeated for any other application, for which we want to manipulate the base URL.</p><p>For step 1, let's put the <code class="literal">.htaccess</code> file with the following content in the <code class="literal">/yiiadv</code> folder:</p><div class="informalexample"><pre class="programlisting">RewriteEngine on
# For Backend
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} ^/yiiadv/admin
RewriteRule ^admin(/.+)?$ /yiiadv/backend/web/$1 [L,PT]
# For Frontend
RewriteCond %{REQUEST_URI} !index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ /yiiadv/frontend/web/$1</pre></div><p>Therefore, in the <code class="literal">Backend</code> block of <code class="literal">.htaccess</code>, we catch requests in <code class="literal">/yiiadv/admin</code> and redirect them to the <code class="literal">yiiadv/backend/web/</code> base URL.</p><p>For step 2, the backend requests capture is completed when we also make these changes in backend configuration, adding the <code class="literal">request</code> property in <code class="literal">backend/config/main.php</code>:</p><div class="informalexample"><pre class="programlisting">        'request' =&gt; [
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            'cookieValidationKey' =&gt; '2OofX7Q9e-EQLSK5BEk70_07fUXkka8y',
            'baseUrl' =&gt; '/yiiadv/admin',     
        ],</pre></div><p>Now, point the browser to <code class="literal">http://hostname/yiiadv/admin</code> and if we did everything correctly we should finally be able to see the login page.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note65"/>Note</h3><p>Make sure there is a <code class="literal">request</code> attribute in the configuration array in <code class="literal">backend/config/main-local.php</code>; we need to comment this otherwise it will overwrite <code class="literal">request</code> in the <code class="literal">backend/config/main.php</code> file that we have just changed.</p></div></div><p>Finally, just like we <a id="id434" class="indexterm"/>have done with backend requests, in step 3, we need to change the <code class="literal">request</code> property for frontend requests under <code class="literal">frontend/config/main.php</code> in the configuration:</p><div class="informalexample"><pre class="programlisting">        'request' =&gt; [
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            'cookieValidationKey' =&gt; 'ear8GcRjBGXQgKVwfEpbApyj7Fb0UKXk',
            'baseUrl' =&gt; '/yiiadv',     
        ],</pre></div><p>Now, point the browser to <code class="literal">http://hostname/yiiadv</code> and if we did everything correctly, we should see the congratulation page of the frontend.</p><p>As the last part of this example, if we want to reach the frontend to the <code class="literal">http://hostname</code> URL and backend to the <code class="literal">http://hostname/admin</code> URL, we must put an <code class="literal">.htaccess</code> file in the document root folder with this content:</p><div class="informalexample"><pre class="programlisting">RewriteEngine on
# For Backend
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} ^/admin
RewriteRule ^admin(/.+)?$ /yiiadv/backend/web/$1 [L,PT]
# For Frontend
RewriteCond %{REQUEST_URI} !index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ /yiiadv/frontend/web/$1</pre></div><p>Then, we must change the <code class="literal">request</code> property of the frontend configuration in <code class="literal">frontend/config/main.php</code> with:</p><div class="informalexample"><pre class="programlisting">        'request' =&gt; [
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            'cookieValidationKey' =&gt; 'ear8GcRjBGXQgKVwfEpbApyj7Fb0UKXk',
            'baseUrl' =&gt; '',     
        ],</pre></div><p>Finally, change the <code class="literal">request</code> property of the backend configuration in <code class="literal">backend/config/main.php</code> with:</p><div class="informalexample"><pre class="programlisting">        'request' =&gt; [
            // !!! insert a secret key in the following (if it is empty) - this is required by cookie validation
            'cookieValidationKey' =&gt; '2OofX7Q9e-EQLSK5BEk70_07fUXkka8y',
            'baseUrl' =&gt; '/admin',     
        ],</pre></div><p>In this way, the <a id="id435" class="indexterm"/>frontend is now reachable pointing the browser to <code class="literal">http://hostname</code> and the backend to <code class="literal">http://hostname/admin</code>.</p></div></div>
<div class="section" title="How to use the advanced template in the shared hosting"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec67"/>How to use the advanced template in the shared hosting</h1></div></div></div><p>In my opinion, almost <a id="id436" class="indexterm"/>all applications should use <a id="id437" class="indexterm"/>the advanced template, since it provides the right project structure from the very start, so as to immediately handle frontend and backend occurring in every web project.</p><p>However, we have also seen that the advanced template requires a console access to execute installation and initialization commands. So, if we have a remote hosting without this capability, it could be difficult for us to install and use Yii with the advanced template.</p><p>If we cannot add the console capability to remote hosting, we have two possibilities:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create the project in the local environment where we can install what we want and need; it is enough to locally install a WAMP or a LAMP distribution (based on the operating system of the hosting machine) and then launch the composer command to install Yii</li><li class="listitem" style="list-style-type: disc">Launch the <code class="literal">init</code> command to initialize the project (it could be initialized from start in production mode so that no other changes are needed)</li></ul></div><p>Therefore, the project is ready to be uploaded to remote hosting. Remember that project environment is in production mode, but in this way, we do not have to change the configuration manually<a id="id438" class="indexterm"/> if we want to pass from development <a id="id439" class="indexterm"/>to production mode.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec68"/>Summary</h1></div></div></div><p>In this chapter, we saw how to use Yii to build a modern web project based on frontend and backend applications. We have found out differences between basic and advanced templates, installing our first advanced project based on advanced templates.</p><p>Then we have used the <code class="literal">init</code> command to customize development or production environment in which to make the application run. Then we have written an example to display in the frontend rooms list, similar to what we have done in the previous basic template.</p><p>Finally, we customized URLs to make them pretty also in the advanced template, to refer to frontend and backend without URL application prefix. We also learned how to use advanced templates in shared hosting that does not have access to the console.</p><p>In the next chapter, we will explain how to write a multilingual app, adapt, and render the app in different languages without changes to the source code.</p></div></body></html>