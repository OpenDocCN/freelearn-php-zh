<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Deployment and Distribution"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Deployment and Distribution</h1></div></div></div><p>Welcome to the last chapter of this book; we have come far and learned a lot along the way. By now, you should have a clear idea about everything involved in working with and developing custom extensions for Magento—well, almost everything.</p><p>As for any other Magento developer, your code will eventually need to be promoted to production or maybe packaged for distribution. In this chapter, we will see the different techniques, tools, and strategies that are available to us.</p><p>The final objective of this chapter is to give you the tools and skills to perform deployments with confidence and with little or no downtime.</p><div class="section" title="The road toward zero-downtime deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec44"/>The road toward zero-downtime deployment</h1></div></div></div><p>Deploying to <a id="id431" class="indexterm"/>production is probably one of the most dreaded tasks for developers, and more often than not, it will be done improperly.</p><p>But what is zero-downtime deployment? Promoting to production with the confidence that the code has been properly tested and is ready the ideal that all Magento developers should aspire to achieve.</p><p>This is achieved not by a single process or tool, but by a combination of techniques, standards, and tools. In this chapter, we will learn the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Distributing our extension through Magento Connect</li><li class="listitem" style="list-style-type: disc">The role of version control systems on deployment</li><li class="listitem" style="list-style-type: disc">Proper practices to branch and merge changes</li></ul></div><div class="section" title="Making it right from scratch"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec61"/>Making it right from scratch</h2></div></div></div><p>In the previous chapter, we learned how testing can not only enhance our workflow, but also save us from future headaches, unit tests, and integration tests; automated tools are at our disposition to ensure that our code is properly tested.</p><p>Writing tests <a id="id432" class="indexterm"/>means more than just putting together a few tests and calling it done; we are responsible for thinking about all the possible edge cases that might affect our code and writing tests for each for them.</p></div><div class="section" title="Ensure that what you see is what you get"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec62"/>Ensure that what you see is what you get</h2></div></div></div><p>In the first <a id="id433" class="indexterm"/>chapter of this book, we dived right into setting up our development environment, which is a very important task. In order for us to guarantee that we deliver quality and tested code, we must be able to develop and test our code in an environment as close to production as possible.</p><p>To illustrate the importance of this environment, I'll use an example. In the early days of Magento, I often heard that developers would work on their local environments, creating new extensions from scratch. They finished development and testing on their local staging, and everything seemed to be working properly.</p><p>One of the commonly accepted workflows is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Start development on the developer's local machine, which is running a virtual machine that resembles the production environment as much as possible</li><li class="listitem" style="list-style-type: disc">Changes are tested and approved on a staging environment that is an as close as possible copy of production</li><li class="listitem" style="list-style-type: disc">Finally, changes are deployed to the production environment</li></ul></div><p>So, it was now time for the developers to promote their code to production, and they confidently did that. Of course, it was working on the local system, so it had to work in production, right? In these particular situations, this wasn't the case; what happened instead was that as soon the new code was loaded into production, the store would crash, saying the autoloader wasn't able to find the class.</p><p>What happened? Well, here, the problem was that the developers' local environment was Windows and the name of the extension folder was in <a id="id434" class="indexterm"/>
<span class="strong"><strong>CamelCase</strong></span>, for example <code class="literal">MyExtension</code>, but they were using <a id="id435" class="indexterm"/>
<span class="strong"><strong>capitalized</strong></span> text (<code class="literal">Myextension</code>) internally in the class names.</p><p>Now, this will work just fine in Windows because the file does not distinguish between uppercased, capitalized, or lowercased folder names, while a Unix-based system, such as most of the web servers, does make a distinction on the folder and file naming.</p><p>While this <a id="id436" class="indexterm"/>example may look silly, it illustrates the need for a standardized development environment quite well. There are many parts and "moving pieces" in a Magento installation; a different version of PHP or an extra Apache module that is enabled in production but not staging, can make a world of difference.</p></div><div class="section" title="Magento naming conventions"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec63"/>Magento naming conventions</h2></div></div></div><p>Magento uses<a id="id437" class="indexterm"/> standardized class naming conventions based on the class location in the filesystem. This standardization enables automatic class loading instead of using the more traditional <code class="literal">require_once</code> and <code class="literal">include_once</code> functions.</p><p>For example, the <code class="literal">Mage_Catalog_Model_Product</code> class is located in the <code class="literal">app/code/core/Mage/Catalog/Model/Product.php</code> location; the Magento autoloader is smart enough to replace the underscore (<code class="literal">_</code>) characters with the directory separators.</p></div><div class="section" title="Ready means ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec64"/>Ready means ready</h2></div></div></div><p>When do we decide<a id="id438" class="indexterm"/> that our code is actually ready to enter production, and what does "ready" really mean? Each developer might have a different definition of what ready and "done" actually mean. When working on a new module or extending Magento, we should always define what ready means for this particular feature/code.</p><p>So, we are getting somewhere now, and we know that in order move to production, we have to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Test our code and make sure we have covered all the edge cases</li><li class="listitem" style="list-style-type: disc">Make sure the code follows the standards and guidelines</li><li class="listitem" style="list-style-type: disc">Make sure it has been tested and developed in an environment as close to production as possible</li></ul></div></div></div></div>
<div class="section" title="Version control systems"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec45"/>Version control systems</h1></div></div></div><p>
<span class="strong"><strong>Version control systems</strong></span> (<span class="strong"><strong>VCS</strong></span>) are<a id="id439" class="indexterm"/> the lifeblood of any developer, and while the field might be a bit divided among Git and SVN enthusiasts (no mention for you, mercurial guys), the basic functionalities are still the same.</p><p>Let's quickly go over the differences between each VCS and the advantages and disadvantages of each.</p><div class="section" title="Subversion"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec65"/>Subversion</h2></div></div></div><p>
<span class="strong"><strong>Subversion</strong></span> (<span class="strong"><strong>SVN</strong></span>) is<a id="id440" class="indexterm"/> a<a id="id441" class="indexterm"/> powerful system and has been around for quite some time, is very well known, and is and widely used.</p><p>SVN is a centralized VCS; by this we mean that there is single main source that is recognized as "good" all developers' checkout and push changes to and from this central source.</p><p>While this makes changes easier to track and maintain, it has a serious disadvantage. As it is centralized, it means that we have to be in constant touch with the central repository, working remotely or without an Internet connection, which is not possible. This is illustrated in the following figure:</p><div class="mediaobject"><img src="graphics/4172_07_01.jpg" alt="Subversion"/></div></div><div class="section" title="Git"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec66"/>Git</h2></div></div></div><p>Git is a<a id="id442" class="indexterm"/> much <a id="id443" class="indexterm"/>younger VCS and has been rising in popularity for a few years now, mostly due to the wide adoption by the open source community and the <a id="id444" class="indexterm"/>popularity of GitHub<span class="strong"><strong> </strong></span>(<a class="ulink" href="http://www.github.com">www.github.com</a>).</p><p>A critical difference between SVN and Git is that Git is a decentralized version control system. By this, we mean that there is no central authority or main repo; each developer has a full copy of the repository locally.</p><p>The decentralization makes Git faster, in addition to having a better and more powerful <span class="strong"><strong>branching</strong></span> system<a id="id445" class="indexterm"/> other than VCS. Also, working remotely or without an Internet connection is possible:</p><div class="mediaobject"><img src="graphics/4172_07_02.jpg" alt="Git"/></div><p>Regardless of which VCS we choose, the most powerful and sometimes overlooked feature of any VCS is still available: the ability to create branches or branching.</p><p>Branching allows us to experiment and work on new features without breaking the stable code in our trunk or master. Creating a branch takes a snapshot of the current trunk/master code where we can make any changes and tests.</p><p>Now, branching<a id="id446" class="indexterm"/> is only part of the equation. Once we are comfortable with our code changes and we have properly tested every edge case, we need a way to reintegrate these changes into our main code base.</p><p>
<span class="strong"><strong>Merging</strong></span> give <a id="id447" class="indexterm"/>us this ability to reintegrate all our branch modifications by running a few commands.</p><p>By integrating branches and merging changes into our workflow, we gain flexibility and the freedom to work on a different set of changes, features, and bug fixes without interfering with experimental or work in progress code.</p><p>Also, as we will learn, version control can also help us perform seamless promotions and keep our code up to work across multiple Magento installations with ease.</p></div></div>
<div class="section" title="Distribution"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec46"/>Distribution</h1></div></div></div><p>You<a id="id448" class="indexterm"/> might want to freely distribute your extension or maybe make it available commercially, but how could you guarantee that the code is properly installed each time without having to check it yourself? And what about the updates or upgrades? Not all storeowners are tech savvy or capable of changing files on their own.</p><p>Fortunately, Magento comes out of the box with its package manager and extension marketplace called Magento Connect.</p><p>Magento Connect allows developers and solution partners to share their open source and commercial contributions with the community and is not restricted to only custom modules; we can find the following types of resources in the Magento Connect marketplace:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Modules</li><li class="listitem" style="list-style-type: disc">Language packs</li><li class="listitem" style="list-style-type: disc">Custom themes</li></ul></div><div class="section" title="Packing our extension"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec67"/>Packing our extension</h2></div></div></div><p>One of the<a id="id449" class="indexterm"/> core features of Magento Connect is that it allows us to package <a id="id450" class="indexterm"/>our extensions directly from the Magento backend.</p><p>To package our extension, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the Magento backend.</li><li class="listitem">From the backend, navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Magento Connect</strong></span> | <span class="strong"><strong>Package Extensions</strong></span>.<div class="mediaobject"><img src="graphics/4172_07_03.jpg" alt="Packing our extension"/></div></li></ol></div><p>As we can <a id="id451" class="indexterm"/>see, the <span class="strong"><strong>Create Extension Package</strong></span> section is composed of six different sections.</p><div class="section" title="Package Info"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec08"/>Package Info</h3></div></div></div><p>
<span class="strong"><strong>Package Info</strong></span> is<a id="id452" class="indexterm"/> used to specify the general extension information, such as the name, description, and versions of Magento that are supported. The subsections are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Name</strong></span>: The standard practice is to keep the name simple and use words</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Channel</strong></span>: This refers to the code pool for the extension; as we mentioned in previous chapters, extensions designed for distribution should use the <span class="strong"><strong>community</strong></span> channel</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Supported releases</strong></span>: Select which version of Magento should be supported for our extension</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Summary</strong></span>: This is a brief description of the extension used for the extension review process</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Description</strong></span>: This is a detailed description of the extension and its functionality</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>License</strong></span>: This is used for the extension, and some of the available options are:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Open Software License</strong></span> (<span class="strong"><strong>OSL</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mozilla Public License</strong></span> (<span class="strong"><strong>MPL</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Massachusetts Institute of Technology License</strong></span> (<span class="strong"><strong>MITL</strong></span>)</li><li class="listitem" style="list-style-type: disc">GNU <span class="strong"><strong>General Public License</strong></span> (<span class="strong"><strong>GPL</strong></span>)</li><li class="listitem" style="list-style-type: disc">Any other license if your extension is to be distributed commercially</li></ul></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>License Url</strong></span>: This is the link to the license text</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>More information on the different <a id="id453" class="indexterm"/>license types can be found at <a class="ulink" href="http://www.magedevguide.com/license-types">http://www.magedevguide.com/license-types</a>.</p></div></div></div><div class="section" title="Release Info"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec09"/>Release Info</h3></div></div></div><p>The following screenshot shows the screen for<a id="id454" class="indexterm"/> <span class="strong"><strong>Release</strong></span> <span class="strong"><strong>Info</strong></span>:</p><div class="mediaobject"><img src="graphics/4172_07_04.jpg" alt="Release Info"/></div><p>The <span class="strong"><strong>Release Info</strong></span> section<a id="id455" class="indexterm"/> contains important data about the current package release:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Release Version</strong></span>: In the initial release, this can be any arbitrary number; however, it is important that the version is incremented with each release. Magento Connect will not allow you to update the same version twice.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Release Stability</strong></span>: Three options are available (<span class="strong"><strong>Stable</strong></span>, <span class="strong"><strong>Beta</strong></span> and <span class="strong"><strong>Alpha</strong></span>).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Notes</strong></span>: With this, we can release all the specific notes, if any.</li></ul></div></div><div class="section" title="Authors"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec10"/>Authors</h3></div></div></div><p>The following screenshot shows the screen for <a id="id456" class="indexterm"/>
<span class="strong"><strong>Authors</strong></span>:</p><div class="mediaobject"><img src="graphics/4172_07_05.jpg" alt="Authors"/></div><p>In this section, the<a id="id457" class="indexterm"/> author(s) information is specified; each author information has the following fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Name</strong></span>: This specifies the author's full name</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>User</strong></span>: This specifies the Magento username</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Email</strong></span>: This specifies the contact e-mail address</li></ul></div></div><div class="section" title="Dependencies"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec11"/>Dependencies</h3></div></div></div><p>The following screenshot shows the screen for <a id="id458" class="indexterm"/>
<span class="strong"><strong>Dependencies</strong></span>:</p><div class="mediaobject"><img src="graphics/4172_07_06.jpg" alt="Dependencies"/></div><p>There are three <a id="id459" class="indexterm"/>types of dependencies that are used when packaging a Magento extension:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>PHP Version</strong></span>: This is the <span class="strong"><strong>Minimum</strong></span> and <span class="strong"><strong>Maximum</strong></span> version of the PHP that is supported for this extension</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Packages</strong></span>: This is used to specify any other packages that are required for this extension</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Extensions</strong></span>: With this, we can specify whether a specific PHP extension is required for our extension to work</li></ul></div><p>If a package dependency is not met, Magento Connect will offer to install the required extension because PHP extensions' Magento Connect will throw an error and will stop the installation.</p></div><div class="section" title="Contents"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec12"/>Contents</h3></div></div></div><p>The following screenshot shows the screen for <a id="id460" class="indexterm"/>
<span class="strong"><strong>Contents</strong></span>:</p><div class="mediaobject"><img src="graphics/4172_07_07.jpg" alt="Contents"/></div><p>The <span class="strong"><strong>Contents</strong></span> section allows us to specify each file and folder that forms part of the extension package.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>This is the most important section in the extension packaging process, and it's also the easiest to mess up.</p></div></div><p>Each content entry has the following fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Target</strong></span>: This is the target base directory; it is used to specify the base path to search the file. The following options are available:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Core team module file - ./app/code/core</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Local module file - ./app/code/local</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Community module file - ./app/code/community</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Global Configuration - ./app/etc</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Locale language file - ./app/locale</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento User Interface (layouts, templates) - ./app/design</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Library file - ./lib</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Media library - ./media</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Theme Skin (Images, CSS, JS) - ./skin</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento Other web accessible file - ./</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento PHPUnit test - ./tests</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Magento other - ./</strong></span></li></ul></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Path</strong></span>: This<a id="id461" class="indexterm"/> is the filename and/or path relative to our the specified target</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Type</strong></span>: Two options are available for us, <span class="strong"><strong>File</strong></span> or <span class="strong"><strong>Recursive dir</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Include</strong></span>: This field takes a regular expression that allows us to specify which files are to be included</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ignore</strong></span>: This field takes a regular expression that allows to specify which files are to be excluded</li></ul></div></div><div class="section" title="Load Local Package"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec13"/>Load Local Package</h3></div></div></div><p>The <a id="id462" class="indexterm"/>following screenshot shows the screen for <span class="strong"><strong>Load Local Package</strong></span>:</p><div class="mediaobject"><img src="graphics/4172_07_08.jpg" alt="Load Local Package"/></div><p>This section <a id="id463" class="indexterm"/>allows us to load packaged extensions; as we have not packaged any extensions, the list is currently empty.</p><p>Let's go ahead and package our gift registry extension; ensure that you fill in all the fields and then click on <span class="strong"><strong>Save Data and Create Package</strong></span>. This will package and save the extension in the <code class="literal">magento_root/var/connect/</code> folder.</p><p>The extension package file contains all the sources files and source code needed; additionally, a new file is created with each package, called <code class="literal">package.xml</code>. This file contains all the information about the extension and the detailed structure of the files and folders.</p></div></div></div>
<div class="section" title="Publishing our extension"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Publishing our extension</h1></div></div></div><p>Finally, in<a id="id464" class="indexterm"/> order to make our extension available, we have to create an extension profile in Magento Connect.</p><p>To create an extension profile, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to <a class="ulink" href="http://magentocommerce.com">magentocommerce.com</a>.</li><li class="listitem">Click on the <span class="strong"><strong>MY ACCOUNT</strong></span> .link.</li><li class="listitem">Click on the <span class="strong"><strong>Developers</strong></span> link in the left-side navigation.</li><li class="listitem">Click on <span class="strong"><strong>Add a New Extension</strong></span>.</li></ol></div><p>The <span class="strong"><strong>Add new extension</strong></span> screen looks something like the following:</p><div class="mediaobject"><img src="graphics/4172_07_09.jpg" alt="Publishing our extension"/></div><p>It is important to notice that the extension key field must be the exact same name you used while generating the package.</p><p>Once the extension <a id="id465" class="indexterm"/>profile has been created, we can proceed to upload our extension package; all the fields should match the ones specified during the extension packaging process.</p><div class="mediaobject"><img src="graphics/4172_07_10.jpg" alt="Publishing our extension"/></div><p>Finally, once we are done, we can click on the <span class="strong"><strong>Submit for Approval</strong></span> button. An extension can have the following statuses:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Submitted</strong></span>: This means the extension was submitted for review</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Not Approved</strong></span>: This means there was a problem with the extension; you will also receive an e-mail explaining the reason why the extension was not approved</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Live</strong></span>: This means the extension has been approved and is available through Magento Connect</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Offline</strong></span>: You can take your extension offline at any time from your account extension manager</li></ul></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec48"/>Summary</h1></div></div></div><p>In this chapter, we learned how to deploy and share our custom extensions. There are many different methods that we can use to share and deploy our code to production environments.</p><p>This is the book's final chapter. We learned a lot about Magento development, and while we covered a lot of ground, this book is only meant to be a stepping stone on a long journey.</p><p>Magento is not an easy framework to learn, and while it can be a daunting experience, I encourage you to keep trying and learning.</p></div></body></html>