<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer452">
<h1 class="chapter-number" id="_idParaDest-325" lang="en-GB"><a id="_idTextAnchor325"/>17</h1>
<h1 id="_idParaDest-326" lang="en-GB"><a id="_idTextAnchor326"/>Working with Moodle  Admin Tools</h1>
<p lang="en-GB">Moodle ships with several administration tools that have not been allocated to a particular topic; some are not even directly accessible via the familiar admin <span class="No-Break" lang="">web interface.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer440">
<img alt="Figure 17.1 – Moodle admin tools " height="279" src="image/Figure_17.01_B18779.jpg" width="1323"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.1 – Moodle admin tools</p>
<p lang="en-GB">We have grouped the admin tools into the following categories, each presented in a <span class="No-Break" lang="">separate section:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Site admin presets</strong>: Presets <a id="_idIndexMarker1588"/>allow you to create <a id="_idIndexMarker1589"/>backups of site settings that can be rolled back in case something <span class="No-Break" lang="">goes wrong.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Database tools</strong>: These <a id="_idIndexMarker1590"/>tools let you apply specific database actions. In <a id="_idIndexMarker1591"/>addition to the tools part of Moodle core, we will cover a useful external tool called <strong class="bold" lang="">Adminer</strong> that lets you manage the underlying database directly from <span class="No-Break" lang="">within Moodle.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Command Line Interface (CLI)</strong>: The <a id="_idIndexMarker1592"/>CLI is a <a id="_idIndexMarker1593"/>built-in mechanism that allows us to automate administrative processes via the command line or <span class="No-Break" lang="">shell scripts.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Moosh</strong>: A powerful <a id="_idIndexMarker1594"/>alternative to the CLI, Moosh is the third-party<a id="_idIndexMarker1595"/> Moodle Shell. We will learn how Moosh works and provide some <span class="No-Break" lang="">practical examples.</span></li>
</ul>
<p lang="en-GB">Before we cover these admin tools in detail, let’s explore how they are organized <span class="No-Break" lang="">in Moodle.</span></p>
<h1 id="_idParaDest-327" lang="en-GB"><a id="_idTextAnchor327"/>Exploring Moodle admin tools</h1>
<p lang="en-GB">Moodle’s classification<a id="_idIndexMarker1596"/> of what constitutes an admin tool is a little vague. When you navigate to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Admin tools</strong> | <strong class="bold" lang="">Manage admin tools</strong>, a long list of plugins <span class="No-Break" lang="">is shown:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer441">
<img alt="Figure 17.2 – Moodle admin tools " height="709" src="image/Figure_17.02_B18779.jpg" width="1040"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.2 – Moodle admin tools</p>
<p lang="en-GB">We can group admin tools into the <span class="No-Break" lang="">following categories:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Conversion tools</strong>: These<a id="_idIndexMarker1597"/> tools are usually only<a id="_idIndexMarker1598"/> applied once to migrate a feature from an old state to its current counterpart. Examples <a id="_idIndexMarker1599"/>are<a id="_idIndexMarker1600"/> the <strong class="bold" lang="">HTTPS conversion tool</strong> (see <a href="B18779_13.xhtml#_idTextAnchor251"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 13</em></span></a>, <em class="italic" lang="">Ensuring Moodle Security</em>) and <strong class="bold" lang="">Multilang upgrade</strong> (see <a href="B18779_10.xhtml#_idTextAnchor204"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 10</em></span></a>, <em class="italic" lang="">Configuring </em><span class="No-Break" lang=""><em class="italic" lang="">Technical Features</em></span><span class="No-Break" lang="">).</span></li>
<li lang="en-GB"><strong class="bold" lang="">Database tools</strong>: These<a id="_idIndexMarker1601"/> are tools to work with Moodle’s underlying<a id="_idIndexMarker1602"/> database. We have dedicated an entire section to database tools in <span class="No-Break" lang="">this chapter.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Development tools</strong>: These <a id="_idIndexMarker1603"/>tools are aimed at <a id="_idIndexMarker1604"/>Moodle programmers – for <a id="_idIndexMarker1605"/>instance, <strong class="bold" lang="">Acceptance testing</strong> (Behat), <strong class="bold" lang="">PHPUnit tests</strong>, and<a id="_idIndexMarker1606"/> the <strong class="bold" lang="">XMLDB</strong><strong class="bold" lang=""> </strong><strong class="bold" lang="">editor</strong>. You <a id="_idIndexMarker1607"/>came across a development tool in <a href="B18779_15.xhtml#_idTextAnchor289"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 15</em></span></a>,<em class="italic" lang=""> Optimizing Moodle Performance</em>, when we dealt with profiling and used the course generator. We are not going to deal with development <span class="No-Break" lang="">tools here.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Design tools</strong>: These <a id="_idIndexMarker1608"/>tools are aimed at theme designers – for <a id="_idIndexMarker1609"/>example, the <strong class="bold" lang="">Template library</strong> or <a id="_idIndexMarker1610"/>the <strong class="bold" lang="">UI component library</strong>. We <a id="_idIndexMarker1611"/>are not going to deal with design <span class="No-Break" lang="">tools, either.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Standard Moodle features</strong>: Some admin <a id="_idIndexMarker1612"/>features <a id="_idIndexMarker1613"/>have been implemented as admin tools, such as the recycling bin, learning plans, or the task scheduler. This way, they could be uninstalled from Moodle if not needed, though this is <span class="No-Break" lang="">not recommended.</span></li>
</ul>
<p lang="en-GB">Many tools of the first four categories are hidden from the Moodle admin web interface and can only be accessed by calling them directly via the URL: <strong class="source-inline" lang="">&lt;yoursite&gt;/admin/tool/&lt;tool&gt;</strong>. All core admin tools are located in subdirectories in <strong class="source-inline" lang="">$CFG-&gt;dirroot/admin/tool</strong>. For details of mostly non-standard admin tools, refer <span class="No-Break" lang="">to </span><a href="http://docs.moodle.org/en/Admin_tools"><span class="No-Break" lang="">docs.moodle.org/en/Admin_tools</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">We are not covering any admin tools classified as standard Moodle features, since they are either dealt with elsewhere in the book or are irrelevant in the administrator context. However, one exception are site admin presets, the only feature that does not belong to any category in the site administration menu. So, let’s get started with our first <span class="No-Break" lang="">admin tool.</span></p>
<h1 id="_idParaDest-328" lang="en-GB"><a id="_idTextAnchor328"/>Site admin presets</h1>
<p lang="en-GB">Presets allow <a id="_idIndexMarker1614"/>you to create backups of site settings that<a id="_idIndexMarker1615"/> can then be restored. There are several use cases where this facility comes <span class="No-Break" lang="">in handy:</span></p>
<ul>
<li lang="en-GB">Experimenting with a set of system settings and rolling back in case they <span class="No-Break" lang="">didn’t work</span></li>
<li lang="en-GB">Applying the same set of configurations to <span class="No-Break" lang="">multiple sites</span></li>
<li lang="en-GB">Migrating one Moodle site’s settings to another – for instance, your test instance to your <span class="No-Break" lang="">production system</span></li>
</ul>
<p lang="en-GB">The workflow of Moodle<a id="_idIndexMarker1616"/> admin presets is illustrated in the following diagram – a straightforward but very <span class="No-Break" lang="">powerful tool:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer442">
<img alt="Figure 17.3 – Site admin presets workflow " height="791" src="image/Figure_17.03_B18779.jpg" width="1361"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.3 – Site admin presets workflow</p>
<p lang="en-GB">You<a id="_idIndexMarker1617"/> find the <strong class="bold" lang="">Site admin presets</strong> tool in the <strong class="bold" lang="">General</strong> section of the <strong class="bold" lang="">Site administration</strong> area. It is the only Moodle feature that has not been placed in a menu category, hence its coverage in <span class="No-Break" lang="">this chapter.</span></p>
<p lang="en-GB">Moodle ships with two preconfigured presets that have been labelled <strong class="bold" lang="">Starter</strong> and <strong class="bold" lang="">Full</strong>. Details about its content are provided in the respective descriptions, as shown in the following screenshot, which contains a third preset that we will create in <span class="No-Break" lang="">this section.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer443">
<img alt="Figure 17.4 – Site admin presets " height="494" src="image/Figure_17.04_B18779.jpg" width="1398"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.4 – Site admin presets</p>
<p lang="en-GB">To make <a id="_idIndexMarker1618"/>your first preset, click the <strong class="bold" lang="">Create preset</strong> button, and then you have to provide a name, an optional description, and an author, which is pre-populated with <span class="No-Break" lang="">your name:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer444">
<img alt="Figure 17.5 – Creating a site admin preset " height="885" src="image/Figure_17.05_B18779.jpg" width="1294"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.5 – Creating a site admin preset</p>
<p lang="en-GB">The <strong class="bold" lang="">Include settings with passwords</strong> option <a id="_idIndexMarker1619"/>will add any sensitive information – passwords, keys, and IPs – of your site to the preset, so ensure that this will only be applied internally. You can view and modify the list of fields to be excluded in the <strong class="bold" lang="">Settings with password</strong> field in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Security</strong> | <strong class="bold" lang="">Site </strong><span class="No-Break" lang=""><strong class="bold" lang="">security settings</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once the preset has been created, it will appear in the list alongside the two default presets. The following actions are available for <span class="No-Break" lang="">each preset:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Review settings and apply</strong>: Details about the preset are shown, which include information on who created the preset (author), when (date and time), where (site URL), and on which Moodle version. As soon as you apply the admin preset, any site settings that differ from the preset will be applied, as shown in the following list of <span class="No-Break" lang="">setting changes.</span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer445">
<img alt="Figure 17.6 – Applying a site admin preset " height="882" src="image/Figure_17.06_B18779.jpg" width="1395"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.6 – Applying a site admin preset</p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Download</strong>: Moodle<a id="_idIndexMarker1620"/> exports the settings as an XML file. You can load an exported file via the <strong class="bold" lang="">Import </strong><span class="No-Break" lang=""><strong class="bold" lang="">preset</strong></span><span class="No-Break" lang=""> button.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Delete</strong>: Remove the preset permanently. The two default presets cannot <span class="No-Break" lang="">be deleted.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Show version history</strong>: If you change your mind after applying a preset, you can undo the setting changes via <span class="No-Break" lang="">this action.</span></li>
</ul>
<p lang="en-GB">Site admin presets is a<a id="_idIndexMarker1621"/> powerful tool during setup, maintenance, and when experimenting with <span class="No-Break" lang="">new features.</span></p>
<p class="callout-heading" lang="en-GB">Tip</p>
<p class="callout" lang="en-GB">It is good practice to store the presets of your production site as part of your <span class="No-Break" lang="">system documentation.</span></p>
<p lang="en-GB">Admin presets deal with your site’s configuration, stored in the underlying database. A number of dedicated database tools are discussed in the <span class="No-Break" lang="">following section.</span></p>
<h1 id="_idParaDest-329" lang="en-GB"><a id="_idTextAnchor329"/>Database tools</h1>
<p lang="en-GB">Moodle’s <a id="_idIndexMarker1622"/>database tools <a id="_idIndexMarker1623"/>transfer databases from one server to another, perform search-and-replace operations on text strings in the entire database, and let you view or change any data in the <span class="No-Break" lang="">database itself.</span></p>
<h2 id="_idParaDest-330" lang="en-GB"><a id="_idTextAnchor330"/>Transferring your Moodle database</h2>
<p lang="en-GB">If you<a id="_idIndexMarker1624"/> have to move the database of a Moodle instance from one server to another or migrate to another Moodle system, you have two broad options. You can either create a database dump manually (or via the Adminer tool, which is covered later) or use<a id="_idIndexMarker1625"/> the built-in <strong class="bold" lang="">database </strong><span class="No-Break" lang=""><strong class="bold" lang="">transfer</strong></span><span class="No-Break" lang=""> facility.</span></p>
<p lang="en-GB">The database migration tool is <a id="_idIndexMarker1626"/>available at <strong class="source-inline" lang="">&lt;yoursite&gt;/admin/tool/dbtransfer</strong>. At the time of writing, the feature can also be accessed via <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Development</strong> | <strong class="bold" lang="">Experimental</strong> | <strong class="bold" lang="">Database migration</strong>. As the category name suggests, the tool is experimental and might make it into core or might disappear again from the admin interface in <span class="No-Break" lang="">future releases.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer446">
<img alt="Figure 17.7 – Database transfer " height="1377" src="image/Figure_17.07_B18779.jpg" width="1437"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.7 – Database transfer</p>
<p lang="en-GB">You must <a id="_idIndexMarker1627"/>provide the details of the database to which the content of the current database will be copied. These settings are identical to the ones applied during installation (see <a href="B18779_01.xhtml#_idTextAnchor020"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 1</em></span></a>, <span class="No-Break" lang=""><em class="italic" lang="">Installing Moodle</em></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">You further have the <strong class="bold" lang="">Enable maintenance mode</strong> option, which will turn on maintenance<a id="_idIndexMarker1628"/> mode during and after migration. If used, you will have to remove the <strong class="source-inline" lang="">$CFG-&gt;dataroot/climaintenance.xhtml</strong> file afterwards manually or via <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Server</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Maintenance mode</strong></span><span class="No-Break" lang="">.</span></p>
<h2 id="_idParaDest-331" lang="en-GB"><a id="_idTextAnchor331"/>Searching and replacing database content</h2>
<p lang="en-GB">A tool related to the <a id="_idIndexMarker1629"/>database migration facility is <strong class="bold" lang="">DB search and replace</strong>. After you have moved or copied your system to another location, your URL might have changed. Any user using fixed URLs anywhere in their content now faces dead links. As an administrator, you have a script at hand where you can replace any text in the underlying database, except a few tables, as noted in the second warning. You <a id="_idIndexMarker1630"/>can find the script <span class="No-Break" lang="">at </span><span class="No-Break" lang=""><strong class="source-inline" lang="">&lt;yoursite&gt;/admin/tool/replace</strong></span><span class="No-Break" lang="">.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer447">
<img alt="Figure 17.8 – Database search and replace " height="1181" src="image/Figure_17.08_B18779.jpg" width="1391"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.8 – Database search and replace</p>
<p lang="en-GB">The last <a id="_idIndexMarker1631"/>option, labeled <strong class="bold" lang="">I understand the risks of this operation</strong>, indicates the potential risk of the execution – unless you are 100% certain that the replacements will not have any impact on the system, you had better stay away from it. Once completed, the script will display all executed <span class="No-Break" lang="">SQL queries.</span></p>
<h2 id="_idParaDest-332" lang="en-GB"><a id="_idTextAnchor332"/>Moodle Adminer</h2>
<p lang="en-GB">Adminer is an <a id="_idIndexMarker1632"/>open <a id="_idIndexMarker1633"/>source tool to administer different types of SQL databases. A wrapper has been created that lets you access the tool directly from within Moodle. Moodle Adminer must be installed in your <strong class="source-inline" lang="">local</strong> plugins section (see <a href="B18779_08.xhtml#_idTextAnchor168"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 8</em></span></a>,<em class="italic" lang=""> Understanding Moodle Plugins</em> for details). You will find the installer<a id="_idIndexMarker1634"/> <span class="No-Break" lang="">at </span><a href="http://moodle.org/plugins/local_adminer"><span class="No-Break" lang="">moodle.org/plugins/local_adminer</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once installed, you access the database management console via <strong class="bold" lang="">Site administration </strong>| <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Moodle Adminer</strong>, which opens the tool in a <span class="No-Break" lang="">modal window:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer448">
<img alt="Figure 17.9 – The Moodle Adminer interface " height="907" src="image/Figure_17.09_B18779.jpg" width="1330"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.9 – The Moodle Adminer interface</p>
<p lang="en-GB">By default, you <a id="_idIndexMarker1635"/>must select a database. However, you can skip this step if you enable the <strong class="bold" lang="">Start adminer with current database</strong> setting in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> |<strong class="bold" lang=""> Local plugins</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Moodle Adminer</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once a (Moodle) database has been opened, you can perform operations (such as querying, altering data, or creating an SQL dump) without any <span class="No-Break" lang="">SQL knowledge.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Ensure you only change data if you know what you are doing; otherwise, you might introduce database inconsistencies, and Moodle will not work <span class="No-Break" lang="">as expected.</span></p>
<p lang="en-GB">We will <a id="_idIndexMarker1636"/>not go into using Adminer in detail since this is beyond the scope of this chapter. You can<a id="_idIndexMarker1637"/> find all the information you are looking for <span class="No-Break" lang="">at </span><a href="http://www.adminer.org"><span class="No-Break" lang="">www.adminer.org</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">This concludes the database tools section, where we covered database transfer, database search and replace, and Moodle Adminer. We ignored one tool that only applies to MySQL/MariaDB and is only needed when migrating a database still using the legacy MyISAM format. This tool can be found at <strong class="source-inline" lang="">&lt;yoursite&gt;/admin/tool/innodb</strong>, which converts any tables from MyISAM to the InnoDB <span class="No-Break" lang="">storage engine.</span></p>
<p lang="en-GB">There are also CLI scripts supporting database-related operations, such as <strong class="source-inline" lang="">mysql_engine</strong> and <strong class="source-inline" lang="">check_database_schema</strong>. What’s a CLI script? Find out in the <span class="No-Break" lang="">following section.</span></p>
<h1 id="_idParaDest-333" lang="en-GB"><a id="_idTextAnchor333"/>CLI</h1>
<p lang="en-GB">We already <a id="_idIndexMarker1638"/>encountered the CLI selectively throughout the book and during <a href="B18779_01.xhtml#_idTextAnchor020"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 1</em></span></a>, <em class="italic" lang="">Installing Moodle</em>, when we dealt with <a id="_idIndexMarker1639"/>Moodle upgrades. However, the CLI has a few more tricks up its sleeve, which we will deal with in <span class="No-Break" lang="">this section.</span></p>
<p lang="en-GB">First, let’s look at how you call CLI scripts, which are either located in <strong class="source-inline" lang="">admin/cli/*</strong> or in the sub-folder of plugins that offer a CLI option – for example, <strong class="source-inline" lang="">auth/ldap/cli</strong>. To call a CLI script, follow the <span class="No-Break" lang="">following notation:</span></p>
<pre class="source-code" lang="en-GB">sudo –u &lt;apache_user&gt; /usr/bin/php admin/cli/&lt;script&gt;.php [--params]</pre>
<p lang="en-GB">Your <strong class="source-inline" lang="">&lt;apache_user&gt;</strong> is usually <strong class="source-inline" lang="">www-data</strong>, <strong class="source-inline" lang="">httpd</strong>, <span class="No-Break" lang="">or </span><span class="No-Break" lang=""><strong class="source-inline" lang="">apache</strong></span><span class="No-Break" lang="">.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Always run Moodle CLI scripts under the identity of the web <span class="No-Break" lang="">server user.</span></p>
<p lang="en-GB">Every CLI <a id="_idIndexMarker1640"/>script has a <strong class="source-inline" lang="">--help</strong> parameter that offers additional information and also describes calling options and parameters. The following is a list <a id="_idIndexMarker1641"/>of some useful CLI commands and chapter numbers in which they have been covered. Look in their respective CLI<a id="_idIndexMarker1642"/> directories or at <a href="http://docs.moodle.org/en/Administration_via_command_line">docs.moodle.org/en/Administration_via_command_line</a> for all other commands. We do not list any parameters here, as these are explained well in the <strong class="source-inline" lang="">--</strong><span class="No-Break" lang=""><strong class="source-inline" lang="">help</strong></span><span class="No-Break" lang=""> options.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer449">
<img alt="Figure 17.10 – A selection of Moodle CLI scripts " height="1604" src="image/Figure_17.10_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.10 – A selection of Moodle CLI scripts</p>
<p lang="en-GB">The real <a id="_idIndexMarker1643"/>power of the CLI lies in the ability to embed CLI <a id="_idIndexMarker1644"/>commands in shell scripts, which allows for powerful <strong class="bold" lang="">automation</strong> of otherwise time-consuming or error-prone routines. We presented a small installation script in <a href="B18779_01.xhtml#_idTextAnchor020"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 1</em></span></a>, <em class="italic" lang="">Installing Moodle</em>. Here is another sample script that kills all user sessions and clears caches, utilizing some <span class="No-Break" lang="">CLI scripts:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer450">
<img alt="Figure 17.11 – A sample Bash script utilizing the Moodle CLI " height="486" src="image/Figure_17.11_B18779.jpg" width="1020"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.11 – A sample Bash script utilizing the Moodle CLI</p>
<p lang="en-GB">While useful for the supported operations, the CLI provides a relatively restricted set of commands. Moosh, which we will cover<a id="_idTextAnchor334"/> next, overcomes <span class="No-Break" lang="">this limitation.</span></p>
<h1 id="_idParaDest-334" lang="en-GB"><a id="_idTextAnchor335"/>Moosh – the Moodle Shell</h1>
<p lang="en-GB">Moosh <a id="_idIndexMarker1645"/>stands for <a id="_idIndexMarker1646"/>Moodle Shell and is a command-line tool that allows you to perform the most common <span class="No-Break" lang="">Moodle tasks.</span></p>
<p lang="en-GB">Before you can make use of Moosh, you have to install it (see <a href="B18779_08.xhtml#_idTextAnchor168"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 8</em></span></a>, <em class="italic" lang="">Understanding Moodle Plugins</em>). Once installed, you will have a vast number of commands (at the time of writing, over 150!) at <span class="No-Break" lang="">your disposal.</span></p>
<p lang="en-GB">The general syntax of Moosh is <span class="No-Break" lang="">as follows:</span></p>
<pre class="source-code" lang="en-GB">moosh &lt;-params&gt; &lt;command&gt; &lt;options&gt;</pre>
<p lang="en-GB">To give you an idea of the <a id="_idIndexMarker1647"/>types of things you can do with Moosh, here are a <span class="No-Break" lang="">few examples:</span></p>
<ul>
<li lang="en-GB"><strong class="source-inline" lang="">moosh user-create test</strong>: Creates a user with the <span class="No-Break" lang="">username </span><span class="No-Break" lang=""><strong class="source-inline" lang="">test</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB"><strong class="source-inline" lang="">moosh user-create test{1..10}</strong>: Creates 10 users. This type of enumeration can be used with many <span class="No-Break" lang="">Moosh commands.</span></li>
<li lang="en-GB"><strong class="source-inline" lang="">moosh user-create --email packt@openumlaut.com --city "Heidelberg" --country DE --firstname "Alex" --lastname "Büchner" packt</strong>: All user profile values are supported; this is just <span class="No-Break" lang="">a sample.</span></li>
<li lang="en-GB"><strong class="source-inline" lang="">moosh info-plugins</strong>: Displays a list of all plugins installed and <span class="No-Break" lang="">their locations.</span></li>
<li lang="en-GB"><strong class="source-inline" lang="">moosh file-list course=42</strong>: Outputs information on all files in the course with the ID <strong class="source-inline" lang="">42</strong>. There are more file-related commands, such as showing the system path of a file or the ability to upload <span class="No-Break" lang="">files directly.</span></li>
<li lang="en-GB"><strong class="source-inline" lang="">moosh plugin-install mod_videotime</strong>: Downloads and installs the latest version of the versatile Videotime plugin. How cool <span class="No-Break" lang="">is that?</span></li>
</ul>
<p lang="en-GB">Once you combine <a id="_idIndexMarker1648"/>Moosh commands with standard shell commands via pipes and streams, you have a powerful arsenal of commands at hand. For example, you might want to find all backups that are larger than 10 GB, archive them, and reclaim <span class="No-Break" lang="">the space.</span></p>
<p lang="en-GB">The following example demonstrates the execution and output of<a id="_idIndexMarker1649"/> three <span class="No-Break" lang="">Moosh commands:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer451">
<img alt="Figure 17.12 – Playing with Moosh " height="759" src="image/Figure_17.12_B18779.jpg" width="1177"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 17.12 – Playing with Moosh</p>
<p lang="en-GB">The<a id="_idIndexMarker1650"/> first (<strong class="source-inline" lang="">moosh course-list</strong>) shows <a id="_idIndexMarker1651"/>the information<a id="_idIndexMarker1652"/> on all courses; the second (<strong class="source-inline" lang="">moosh category-list</strong>) does the same for categories; the last (<strong class="source-inline" lang="">moosh user-create test{1..10}</strong>) shows the IDs of the 10 user accounts after they have <span class="No-Break" lang="">been created.</span></p>
<p lang="en-GB">For a complete list of over 150 commands and hundreds of options, refer to the Moosh website at <a href="http://moosh-online.com/commands">moosh-online.com/commands</a>. The list is constantly growing, so ensure you have installed the <span class="No-Break" lang="">latest version.</span></p>
<p lang="en-GB">This concludes the section on Moosh and the chapter on Moodle admin tools. Hopefully, some facilities will streamline your day-to-day job and optimize some of the routine tasks you need to <span class="No-Break" lang="">carry out.</span></p>
<h1 id="_idParaDest-335" lang="en-GB"><a id="_idTextAnchor336"/>Summary</h1>
<p lang="en-GB">In this chapter, we have covered a range of admin tools, some hidden and unsupported but nonetheless very useful. We first explored how admin tools are organized, before we covered site admin presets and some database tools, including the external Adminer, the Moodle CLI, and the powerful third-party <span class="No-Break" lang="">Moosh tool.</span></p>
<p lang="en-GB">Other ways to extend the reach of Moodle are web services, which we will cover in the <span class="No-Break" lang="">following chapter.</span></p>
</div>
</div></body></html>