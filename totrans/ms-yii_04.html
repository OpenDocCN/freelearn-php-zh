<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Active Record, Models, and Forms"><div class="book" id="SJGS2-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Active Record, Models, and Forms</h1></div></div></div><p class="calibre9">Like many modern web frameworks, Yii2 comes with several powerful classes to represent data both in and out of our database. These classes enable us to abstract our data management code away from DAO and Query Builder and into an easy-to-use programmatic interface. In this chapter, we'll cover the use and implementation of Active Record and<a id="id173" class="calibre1"/> learn how to create data models and custom forms. We'll also cover how to configure a powerful code generation tool called <span class="strong"><strong class="calibre2">Gii</strong></span> to automate the creation of Active Record models and forms.</p></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Active Record, Models, and Forms">
<div class="book" title="Configuring Gii"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec24" class="calibre1"/>Configuring Gii</h1></div></div></div><p class="calibre9">While <a id="id174" class="calibre1"/>Active Record models and forms can be generated by hand, in most cases, we'll want to automate the creation of this code. To achieve this, Yii2 provides a code generation tool called Gii, which can be executed both from the command line and from a web interface in order to create Active Record models that work with our database structure and forms that work with both our base models and Active Record models.</p><p class="calibre9">Unlike Yii1, Gii does not come prebundled with Yii2. In Yii2, nearly every module is available as a separate Composer package, which can be installed from the command-line interface. Consequently, we must use Composer to include Gii in our application. Since Gii is available as a composer package, we can include it in our application by running the following command from our command line:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ composer require yiisoft/yii2-gii --dev</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00021.jpeg" alt="Configuring Gii" class="calibre10"/></div><p class="calibre11"> </p><div class="note" title="Note"><h3 class="title2"><a id="tip60" class="calibre1"/>Tip</h3><p class="calibre9">Since Gii is a development tool and has the ability to write new code to our application, we should use the <code class="email">--dev</code> flag so that Composer adds it to the <code class="email">require-dev</code> section of our <code class="email">composer.json</code> file. Typically, during our deployment process, we'll use the <code class="email">--no-dev</code> flag to ensure that development packages are not deployed to our production environment.</p></div><p class="calibre9">With <a id="id175" class="calibre1"/>Gii installed, we now need to configure it to work with both the Yii2 console and within our web browser.</p></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Active Record, Models, and Forms">
<div class="book" title="Configuring Gii">
<div class="book" title="Gii for web applications"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec41" class="calibre1"/>Gii for web applications</h2></div></div></div><p class="calibre9">To<a id="id176" class="calibre1"/> enable the web interface for Gii, we'll need to specify a <code class="email">module</code> section within our <code class="email">config/web.php</code> configuration file and bootstrap the Gii module so that it loads properly:</p><div class="note"><pre class="programlisting">return [
    'bootstrap' =&gt; ['gii'],
    'modules' =&gt; [
        'gii' =&gt; [
                'class'        =&gt; 'yii\gii\Module', 
                'allowedIPs'   =&gt; ['*']
        ]
        // [...]
    ],
    // [...]
];</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip61" class="calibre1"/>Tip</h3><p class="calibre9">By default, Gii is only available on the loopback interface of your machine. If you're using a remote development server or a virtual machine, you'll need to either whitelist your host IP within the <code class="email">allowedIPs</code> block or set the <code class="email">allowedIPs</code> block to the wildcard character <code class="email">*</code> in order to grant your computer access to Gii.</p></div><p class="calibre9">While this<a id="id177" class="calibre1"/> basic configuration will properly load the Gii module, it doesn't follow our convention of being aware of our environment. For instance, if we went to production with this configuration and deployed it with <code class="email">composer install --no-dev</code>, as described earlier, our application would crash because Composer would not have installed the Gii module in our vendor folder.</p><p class="calibre9">Fortunately, since we previously defined our <code class="email">APPLICATION_ENV</code> constant in our bootstrap file rather than returning a static array containing our configuration file, we can store our configuration as a variable and conditionally modify it to include the Gii module depending upon which environment we are working in:</p><div class="note"><pre class="programlisting">&lt;?php

<span class="strong"><strong class="calibre2">$config</strong></span> = [
    'id' =&gt; 'basic',
    'basePath' =&gt; dirname(__DIR__),
    'bootstrap' =&gt; ['log'],
    'components' =&gt; [
        'request' =&gt; [
            'cookieValidationKey' =&gt; '&lt;random_key&gt;',
        ],
        'cache' =&gt; [
            'class' =&gt; 'yii\caching\FileCache',
        ],
        'user' =&gt; [
            'identityClass' =&gt; 'app\models\User',
            'enableAutoLogin' =&gt; true,
        ],
        'errorHandler' =&gt; [
            'errorAction' =&gt; 'site/error',
        ],
        'log' =&gt; [
            'traceLevel' =&gt; YII_DEBUG ? 3 : 0,
            'targets' =&gt; [
                [
                    'class' =&gt; 'yii\log\FileTarget',
                    'levels' =&gt; ['error', 'warning'],
                ],
            ],
        ],
        'db' =&gt; require(__DIR__ . '/db.php'),
    ],
    'params' =&gt; require(__DIR__ . '/params.php'),
];

<span class="strong"><strong class="calibre2">if (APPLICATION_ENV == "dev")</strong></span>
<span class="strong"><strong class="calibre2">{</strong></span>
    <span class="strong"><strong class="calibre2">$config['bootstrap'][] = 'gii';</strong></span>
    <span class="strong"><strong class="calibre2">$config['modules'] = [</strong></span>
        <span class="strong"><strong class="calibre2">'gii' =&gt; [</strong></span>
            <span class="strong"><strong class="calibre2">'class' =&gt; 'yii\gii\Module',</strong></span>
            <span class="strong"><strong class="calibre2">'allowedIPs' =&gt; ['*']</strong></span>
        <span class="strong"><strong class="calibre2">]</strong></span>
    <span class="strong"><strong class="calibre2">];</strong></span>
<span class="strong"><strong class="calibre2">}</strong></span>

<span class="strong"><strong class="calibre2">return $config;</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip62" class="calibre1"/>Tip</h3><p class="calibre9">As <a id="id178" class="calibre1"/>an alternative to <code class="email">APPLICATION_ENV</code>, you can conditionally load Gii using the <code class="email">YII_ENV_DEV</code> constant, which is typically defined in your bootstrap file:</p><div class="note"><pre class="programlisting">if (YII_ENV_DEV) // YII_ENV_DEV = true. Define in ./yii
{                // to enable this constant
    $config['bootstrap'][] = 'gii';
    $config['modules'] = [
        'gii' =&gt; 'yii\gii\Module'  
    ];
}</pre></div><p class="calibre9">For our configuration files, the use of either constant is appropriate. However, most developers find that allowing their web server or command line to define the <code class="email">APPLICATION_ENV</code> constant requires less maintenance than manually managing the <code class="email">YII_ENV_DEV</code> constant.</p></div><p class="calibre9">Gii can now be accessed by navigating our web browser to our application path and changing the URI to <code class="email">/index.php?r=gii</code>.</p><div class="mediaobject"><img src="../images/00022.jpeg" alt="Gii for web applications" class="calibre10"/></div><p class="calibre11"> </p><div class="note" title="Note"><h3 class="title2"><a id="tip64" class="calibre1"/>Tip</h3><p class="calibre9">If<a id="id179" class="calibre1"/> you have already enabled pretty URLs for your application, Gii can be accessed by navigating to the <code class="email">/gii</code> endpoint.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Active Record, Models, and Forms">
<div class="book" title="Configuring Gii">
<div class="book" title="Gii for console applications"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec42" class="calibre1"/>Gii for console applications</h2></div></div></div><p class="calibre9">Unlike Yii1, Gii <a id="id180" class="calibre1"/>for Yii2 provides a new interface to work with Gii on the command line. With Yii2, we can now generate the source code for Active Record models, forms, and even extensions all from our command-line interface.</p><p class="calibre9">The simplest way to enable Gii for our console applications is to modify our <code class="email">config/console.php</code> file to include the Gii module within the <code class="email">module</code> section of our configuration file and then bootstrap the Gii module itself, as follows:</p><div class="note"><pre class="programlisting">return [
    'bootstrap' =&gt; ['gii'],
    'modules' =&gt; [
        'gii' =&gt; 'yii\gii\Module',
        // [...]
    ],
    // [...]
];</pre></div><p class="calibre9">Like our <a id="id181" class="calibre1"/>web application, this basic configuration doesn't enable our application function properly in every environment. We can reconfigure our <code class="email">config/console.php</code> file in the same manner as our web configuration file in order to ensure that the Gii module is only loaded in our development environment:</p><div class="note"><pre class="programlisting">&lt;?php

Yii::setAlias('@tests', dirname(__DIR__) . '/tests');

$config = [
    'id' =&gt; 'basic-console',
    'basePath' =&gt; dirname(__DIR__),
    'bootstrap' =&gt; ['log'],
    'controllerNamespace' =&gt; 'app\commands',
    'components' =&gt; [
        'cache' =&gt; [
            'class' =&gt; 'yii\caching\FileCache',
        ],
        'log' =&gt; [
            'targets' =&gt; [
                [
                    'class' =&gt; 'yii\log\FileTarget',
                    'levels' =&gt; ['error', 'warning'],
                ],
            ],
        ],
        'db' =&gt; require(__DIR__ . '/db.php'),
    ],
    'params' =&gt; require(__DIR__ . '/params.php'),
];

<span class="strong"><strong class="calibre2">if (APPLICATION_ENV == "dev")</strong></span>
<span class="strong"><strong class="calibre2">{</strong></span>
    <span class="strong"><strong class="calibre2">$config['bootstrap'][] = 'gii';</strong></span>
    <span class="strong"><strong class="calibre2">$config['modules'] = [</strong></span>
        <span class="strong"><strong class="calibre2">'gii' =&gt; 'yii\gii\Module'</strong></span>
    <span class="strong"><strong class="calibre2">];</strong></span>
<span class="strong"><strong class="calibre2">}</strong></span>

<span class="strong"><strong class="calibre2">return $config;</strong></span>
</pre></div><p class="calibre9">As shown in<a id="id182" class="calibre1"/> the previous code block, the <code class="email">module</code> section of our configuration file can be loaded using a shorter syntax if we don't need to register additional options with our module, which is generally the preferred way to load modules:</p><div class="note"><pre class="programlisting">$config['modules'] = [
    'gii' =&gt; 'yii\gii\Module'
];</pre></div><p class="calibre9">With our console environment configured, we can now run Gii from the command line by invoking the help command within the <code class="email">./yii</code> command:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ./yii help gii</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00023.jpeg" alt="Gii for console applications" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">With our console application configured to use Gii, we can now start using the Gii tool to create code. As we move through the rest of the chapter, we'll cover how to use Gii from the web<a id="id183" class="calibre1"/> interface as well as the console interface.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Active Record"><div class="book" id="TI1E2-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec25" class="calibre1"/>Active Record</h1></div></div></div><p class="calibre9">One of the<a id="id184" class="calibre1"/> most important tasks when building rich web applications is ensuring that we properly model and represent our data in code. From a simple blog site to an application as big as Twitter, data modeling and representation are vital to ensuring that our application is easy to work with and can grow as required. To help us model our data, Yii2 implements the Active Record pattern, also known as Active Record within the <code class="email">yii/db/ActiveRecord</code> class.</p></div>

<div class="book" title="Active Record">
<div class="book" title="The Active Record pattern"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec43" class="calibre1"/>The Active Record pattern</h2></div></div></div><p class="calibre9">Named by Martin Fowler in his 2003 book <span class="strong"><em class="calibre13">Patterns of Enterprise Application Architecture</em></span>, the <a id="id185" class="calibre1"/>Active Record pattern is an <span class="strong"><strong class="calibre2">object-relational mapping</strong></span> (<span class="strong"><strong class="calibre2">ORM</strong></span>) pattern that's used to represent database rows and columns within <a id="id186" class="calibre1"/>an object. In the Active Record pattern, each database column is represented by a single Active Record class. Upon instantiation, that object then provides a simple interface to manage individual rows or a collection of rows within our code. New rows can be created, old ones can be deleted, and existing rows can be updated—all within a simple and consistent API. Active Record also enables us to programmatically reference and interact with related data, which is usually represented in our database by foreign key relations.</p><p class="calibre9">In Yii2, Active Record is implemented by the <code class="email">yii/db/ActiveRecord</code> class and is often considered the go-to class to represent and work with the data within our database. While many frameworks and ORMs implement Active Record for relational databases only, Yii2 implements Active Record for search tools such as Sphinx and ElasticSearch as well as for NoSQL databases such as Redis and MongoDB. In this section, we'll cover how to create new Active Record classes, how to implement them within our code, and some common pitfalls of working with Active Record.</p><p class="calibre9">Before we start working with Active Record, we first need to create a couple of tables that we can work with. Included with the project resources for this chapter is a base migration that will create several new tables and populate them with some sample data:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">$ ./yii migrate/up –interactive=0</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00024.jpeg" alt="The Active Record pattern" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">After<a id="id187" class="calibre1"/> running the migration, you can verify that the following schema exists within our database by running the <code class="email">.schema</code> command from the sqlite3 tool.</p></div></div>

<div class="book" title="Active Record">
<div class="book" title="Creating Active Record classes"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec44" class="calibre1"/>Creating Active Record classes</h2></div></div></div><p class="calibre9">To get <a id="id188" class="calibre1"/>started with Active Record in Yii2, we first need to declare an instance of <code class="email">yii/db/ActiveRecord</code> within our application. Since Active Record instances in Yii2 extend from the <code class="email">yii/base/Model</code> class and are considered models, we will generally store them within the <code class="email">models/</code> directory of our application and under the <code class="email">app/models</code> namespace.</p><div class="note" title="Note"><h3 class="title2"><a id="note14" class="calibre1"/>Note</h3><p class="calibre9">In Yii2, <code class="email">@app</code> is a predefined alias that points to our application base path. Consequently, any namespace declared in our application will typically take the form of <code class="email">app\&lt;folder&gt;</code>, which enables Yii2's built-in autoloader to automatically reference that namespace to our class found in <code class="email">/&lt;folder&gt;/ClassName.php</code>. If we want to, we can declare additional aliases, such as <code class="email">@frontend</code> and <code class="email">@backend</code>, to divide our application into different sections, which would enable us to create multiple Active Record instances in different namespaces.</p><p class="calibre9">To keep things simple in this chapter, we'll declare only those Active Record classes that are within the <code class="email">app\models</code> namespace.</p></div><p class="calibre9">To<a id="id189" class="calibre1"/> illustrate an example, let's create an Active Record class for the <code class="email">user</code> table we created in <a class="calibre1" title="Chapter 3. Migrations, DAO, and Query Building" href="part0023_split_000.html#LTSU1-ad3e09b384df46aea690d9c8897d5fe7">Chapter 3</a>, <span class="strong"><em class="calibre13">Migrations, DAO, and Query Building</em></span>:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, we need to create a new file in the <code class="email">models/</code> directory of our application, called <code class="email">User.php</code>:<div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">touch models/User.php</strong></span>
</pre></div></li><li class="listitem" value="2">Next, we need to declare the namespace our Active Record instance will live in and extend the <code class="email">yii/db/ActiveRecord</code> class:<div class="note"><pre class="programlisting">&lt;?php

namespace app\models;

use yii\db\ActiveRecord;

class User extends ActiveRecord {}</pre></div></li><li class="listitem" value="3">Finally, we need to implement the static method <code class="email">tableName()</code> within our class, which defines the table name our Active Record model will use. Since our Active Record model will use the <code class="email">user</code> table, we will define this method as follows:<div class="note"><pre class="programlisting">/**
 * @return string    the string name of the database table
 */
public static function tableName()
{
    return 'user';
}</pre></div></li></ol><div class="calibre15"/></div><div class="book" title="Creating active record classes with Gii"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec16" class="calibre1"/>Creating active record classes with Gii</h3></div></div></div><p class="calibre9">While it's possible to<a id="id190" class="calibre1"/> create Active Record instances by hand, generally, we'll want to use Gii to create these classes for us. Using Gii to create our Active Record classes has several advantages: in addition to creating the class, it will also create attribute labels for our fields, create validation rules based upon our database schema, and generate model relationships to another Active Record classes based upon our databases' foreign key structure.</p><div class="book" title="Using Gii's web interface"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch04lvl4sec04" class="calibre1"/>Using Gii's web interface</h4></div></div></div><p class="calibre9">Like Yii1, Gii <a id="id191" class="calibre1"/>provides a friendly and easy-to-use web interface to create our Active Record instances. To get started with Gii, navigate to the <code class="email">/gii</code> endpoint of our application and click on the <span class="strong"><strong class="calibre2">Start</strong></span> button underneath the <span class="strong"><strong class="calibre2">Model Generator</strong></span> section.</p><div class="mediaobject"><img src="../images/00022.jpeg" alt="Using Gii's web interface" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">From this page, we can generate Active Record classes based upon our database schema. As an example, let's create an active record instance for our <code class="email">user</code> table:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, we need to populate the <code class="email">Table name</code> field with <code class="email">user</code>, the name of the <code class="email">user</code> table in our database. As you type, Gii will try to show you possible database tables that match our text entry, which can be extremely beneficial when working with large databases.</li><li class="listitem" value="2">Next, we need to either press the <span class="strong"><em class="calibre13">Tab</em></span> key on our keyboard, or focus our mouse onto the <code class="email">Model name</code> field, which should autopopulate the field with <code class="email">User</code>, which will be the name of the class that Gii will generate.</li><li class="listitem" value="3">Then, we<a id="id192" class="calibre1"/> need to ensure that the <span class="strong"><strong class="calibre2">Generate Relations</strong></span> checkbox is selected. This will automatically add the required code to our class in order to generate our model relations for the <code class="email">Post</code> and <code class="email">Role</code> classes, which we'll create in the next section. After checking this box, our form should be filled as follows:<div class="mediaobject"><img src="../images/00025.jpeg" alt="Using Gii's web interface" class="calibre10"/></div><p class="calibre25"> </p></li><li class="listitem" value="4">Then, we can click on the <span class="strong"><strong class="calibre2">Preview</strong></span> button at the bottom of the page, which will enable<a id="id193" class="calibre1"/> us to preview the code that Gii will generate for us before we confirm the creation of our class.<div class="mediaobject"><img src="../images/00026.jpeg" alt="Using Gii's web interface" class="calibre10"/></div><p class="calibre25"> </p></li><li class="listitem" value="5">After we preview the class, we can click on the <span class="strong"><strong class="calibre2">Generate</strong></span> button to generate our <code class="email">User</code> class, which will be located at <code class="email">models/User.php</code>.<div class="mediaobject"><img src="../images/00027.jpeg" alt="Using Gii's web interface" class="calibre10"/></div><p class="calibre25"> </p></li></ol><div class="calibre15"/></div><div class="note" title="Note"><h3 class="title2"><a id="tip65" class="calibre1"/>Tip</h3><p class="calibre9">In order to create new classes for us, the web user that our server is running under needs write access to our <code class="email">models/</code> directory. If Gii returns an error indicating it cannot write to the <code class="email">models/</code> directory, you'll need to adjust the permissions on the directory. In our Linux environment, this can be done by adding the <code class="email">www-data</code> group to the folder and adjusting the permissions so that the user can write to it:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">chown –R &lt;me&gt;:www-data /path/to/models/</strong></span>
<span class="strong"><strong class="calibre2">chmod –R 764 /path/to/models/</strong></span>
</pre></div><p class="calibre9">As an alternative, you can use the <code class="email">chmod</code> tool to adjust the permissions in the <code class="email">models/</code> directory to <code class="email">777</code>. Just ensure that you readjust the permissions to something more reasonable after using Gii to create the model.</p></div><p class="calibre9">By default, Gii is configured to add new models to the <code class="email">models/</code> folder in our application and create the models under the <code class="email">app/models</code> namespace. Additionally, the <code class="email">yii/db/ActiveRecord</code> class is configured to automatically use the <code class="email">db</code> component of our <a id="id194" class="calibre1"/>application. All of these fields are configurable within the Gii web interface for us to change.</p></div><div class="book" title="Using Gii's console interface"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch04lvl4sec05" class="calibre1"/>Using Gii's console interface</h4></div></div></div><p class="calibre9">As an<a id="id195" class="calibre1"/> alternative to Gii's web interface, Gii can generate Active Record classes from the command line. When running Gii from the command line, we simply need to provide two attributes: the table name that we are working with and the name of the model. This takes the following form:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii gii/model --tableName=&lt;tablename&gt; --modelClass=&lt;ModelName&gt;</strong></span>
</pre></div><p class="calibre9">As an example, we can create a class for our post table by running the following command:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii gii/model --tableName=post --modelClass=Post</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00028.jpeg" alt="Using Gii's console interface" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">While we're here, let's also create a class for our <code class="email">role</code> table:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii gii/model --tableName=role --modelClass=Role</strong></span>
</pre></div></div></div></div></div>

<div class="book" title="Active Record">
<div class="book" title="Working with Active Record"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec45" class="calibre1"/>Working with Active Record</h2></div></div></div><p class="calibre9">Now <a id="id196" class="calibre1"/>that our models have been generated, let's take a look at what Gii actually wrote to the disk. We'll start by opening up <code class="email">models/User.php</code>, which should be identical to the following code block:</p><div class="note"><pre class="programlisting">&lt;?php

namespace app\models;

use Yii;

/**
 * This is the model class for table "user".
 *
 * @property integer $id
 * @property string  $email
 * @property string  $password
 * @property string  $first_name
 * @property string  $last_name
 * @property integer $role_id
 * @property integer $created_at
 * @property integer $updated_at
 *
 * @property Post[] $posts
 * @property Role $role
 */
class User extends \yii\db\ActiveRecord
{
    /**
     * @inheritdoc
     */
    public static function tableName()
    {
        return 'user';
    }

    /**
     * @inheritdoc
     */
    public function rules()
    {
        return [
            [['email', 'password'], 'required'],
            [['role_id', 'created_at', 'updated_at'], 'integer'],
            [['email', 'password', 'first_name', 'last_name'], 'string', 'max' =&gt; 255],
            [['email'], 'unique']
        ];
    }

    /**
     * @inheritdoc
     */
    public function attributeLabels()
    {
        return [
            'id'            =&gt; 'ID',
            'email'         =&gt; 'Email',
            'password'      =&gt; 'Password',
            'first_name'    =&gt; 'First Name',
            'last_name'     =&gt; 'Last Name',
            'role_id'       =&gt; 'Role ID',
            'created_at'    =&gt; 'Created At',
            'updated_at'    =&gt; 'Updated At',
        ];
    }

    /**
     * @return \yii\db\ActiveQuery
     */
    public function getPosts()
    {
        return $this-&gt;hasMany(Post::className(), ['author_id' =&gt; 'id']);
    }

    /**
     * @return \yii\db\ActiveQuery
     */
    public function getRole()
    {
        return $this-&gt;hasOne(Role::className(), ['id' =&gt; 'role_id']);
    }
}</pre></div><div class="book" title="Model validation rules"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec17" class="calibre1"/>Model validation rules</h3></div></div></div><p class="calibre9">The first <a id="id197" class="calibre1"/>section we should notice in our generated active record class is the <code class="email">rules()</code> method, which Gii generated for us. Since <code class="email">yii/db/ActiveRecord</code> extends <code class="email">yii/base/Model</code>, it inherits all the validation logic and tools that <code class="email">yii/base/Model</code> has:</p><div class="note"><pre class="programlisting">public function rules()
{
    return [
        [['email', 'password'], 'required'],
        [['role_id', 'created_at', 'updated_at'], 'integer'],
        [['email', 'password', 'first_name', 'last_name'], 'string', 'max' =&gt; 255],
        [['email'], 'unique']
    ];
}</pre></div><p class="calibre9">When Gii created our model, it scanned our database schema to determine any necessary validation rules it thought we would need to have by default. As shown in the previous code block, it has marked both the <code class="email">email</code> and <code class="email">password</code> attributes as <code class="email">required</code> and the <code class="email">email</code> field as <code class="email">unique</code>, and it has correctly identified the appropriate data types for our name fields as well as timestamps.</p><p class="calibre9">The <code class="email">rules()</code> method in Yii consists of an array of validation rules that take the following format:</p><div class="note"><pre class="programlisting">[
    // Specifies which attributes should be validated, REQUIRED
    ['attr', 'attr2', ...],

    // Specifies the validator to be used, REQUIRED
    // Can be either a built in core validator, 
 // a custom validator method name, or a validator alias
    'validator',

    // Specifies the scenarios that the validator should 
 // run on, OPTIONAL
    'on' =&gt; ['scenario1', 'scenario2', ...],

    // Specifies additional properties to be passed 
 // to the validator, OPTIONAL
    'property1' =&gt; 'value1', 'property2' =&gt; 'value2'
]</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip67" class="calibre1"/>Tip</h3><p class="calibre9">A<a id="id198" class="calibre1"/> complete list of built-in validators can be found in the Yii2 guide at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/guide-tutorial-core-validators.html">http://www.yiiframework.com/doc-2.0/guide-tutorial-core-validators.html</a>.</p></div></div><div class="book" title="Adding custom validators"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec18" class="calibre1"/>Adding custom validators</h3></div></div></div><p class="calibre9">In addition <a id="id199" class="calibre1"/>to the many built-in core validators Yii2 has, we may need to write our own custom validators for our classes. Custom validators can either be written inline using anonymous functions, or they can be written as a separate method within our class.</p><p class="calibre9">For instance, suppose we only want to permit changes to our user information between certain core hours of our business. As an anonymous function, this can be written as follows:</p><div class="note"><pre class="programlisting">public function rules()
{
    return [
        // [... other validators ..],

        // an inline validator defined as an anonymous function
        ['email', function ($attribute, $params) {
                $currentTime = strtotime('now');
                $openTime    = strtotime('9:00');
                $closeTime   = strtotime('17:00');

                if ($currentTime &gt; $openTime &amp;&amp; $currentTime &lt; $closeTime)
                    return true;
                else
                     $this-&gt;addError('email', 'The user\'s email address can only be changed between 9 AM and 5 PM');
        }],
    ];
}</pre></div><p class="calibre9">Alternatively, we can write this as a separate method by providing a name for our validator and then use that name as a method within our class:</p><div class="note"><pre class="programlisting">public function rules()
{
    return [
        // [... other validators ..],

        // a custom validator
        ['email', 'validateTime']
    ];
}

public function validateTime($attributes, $params)
{
    $currentTime = strtotime('now');
    $openTime = strtotime('9:00');
    $closeTime = strtotime('17:00');

    if ($currentTime &gt; $openTime &amp;&amp; $currentTime &lt; $closeTime)
        return true;
    else
        $this-&gt;addError('email', 'The user\'s email address can only be changed between 9 AM and 5 PM');
}</pre></div><p class="calibre9">Additionally, custom <a id="id200" class="calibre1"/>validators can be written by creating and extending the <code class="email">yii\validators\Validator</code> class and implementing the <code class="email">validateAttribute($model, $attribute)</code> method within that class:</p><div class="note"><pre class="programlisting">// app/models/User.php::rules()
public function rules()
{
    return [
        // [... other validators ..],

        // a custom validator
        ['email', 'EditableTime']
    ];
}

// app/components/EditableTimeValidator.php
&lt;?php

namespace app\components;

use yii\validators\Validator;

class EditableTimeValidator extends Validator
{
    public function validateAttribute($model, $attribute)
    {
        $currentTime = strtotime('now');
        $openTime = strtotime('9:00');
        $closeTime = strtotime('17:00');

        if ($currentTime &gt; $openTime &amp;&amp; $currentTime &lt; $closeTime)
            return true;
        else
            $this-&gt;addError($model, $attribute, 'The user\'s email address can only be changed between 9 AM and 5 PM');
        }
    }
}</pre></div></div><div class="book" title="Customizing validator error messages"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec19" class="calibre1"/>Customizing validator error messages</h3></div></div></div><p class="calibre9">Nearly<a id="id201" class="calibre1"/> all validators in Yii2 come with built-in error messages. However, if we want to alter the error message for a certain property, we can do that by specifying the message parameter for a specific validator. For instance, we can adjust the error message for our unique validator by changing the last line of our validator to the following:</p><div class="note"><pre class="programlisting">[['email'], 'unique', 'That email address is already in use by another user!']</pre></div></div><div class="book" title="Working with validation errors"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec20" class="calibre1"/>Working with validation errors</h3></div></div></div><p class="calibre9">Yii2 <a id="id202" class="calibre1"/>provides several ways to interact with and customize errors as and when they happen. As you may have noticed in the previous example, we can use the <code class="email">yii/base/Model</code> method and <code class="email">addError()</code> to add new errors to our model attributes during our workflow. As shown in the previous example, this takes the following form:</p><div class="note"><pre class="programlisting">$this-&gt;addError($attribute, $message);</pre></div><p class="calibre9">Additionally, we can use the <code class="email">getError()</code> method to retrieve either all the errors for our model or just the errors for a particular attribute. This method will return an array of errors containing an array of error messages applicable for each attribute:</p><div class="note"><pre class="programlisting">[
    'email' =&gt; [
        'Email address is invalid.',
        'The user\'s email address can only be changed between 9 AM and 5 PM'
    ],
    'password' =&gt; [
        'Password is required.' 
    ],
]</pre></div></div><div class="book" title="Manually executing validation rules"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec21" class="calibre1"/>Manually executing validation rules</h3></div></div></div><p class="calibre9">In Yii2, validation <a id="id203" class="calibre1"/>rules are executed when the <code class="email">validate()</code> method on <code class="email">yii/db/ActiveRecord</code> is called. While this can be done manually in our controller, it is typically executed before the <code class="email">save()</code> method is executed. The validator method will return either <code class="email">true</code> or <code class="email">false</code>, indicating whether the validation was successful or not.</p><p class="calibre9">The <code class="email">validate()</code> method can also be extended by either overriding the <code class="email">beforeValidate()</code> and <code class="email">afterValidate()</code> methods or by listening to the <code class="email">yii\base\Model::EVENT_BEFORE_VALIDATE</code> or <code class="email">yii\base\Model::EVENT_AFTER_VALIDATE</code> events.</p><div class="note" title="Note"><h3 class="title2"><a id="tip68" class="calibre1"/>Tip</h3><p class="calibre9">We'll cover events in more detail in <a class="calibre1" title="Chapter 8. Routing, Responses, and Events" href="part0047_split_000.html#1CQAE2-ad3e09b384df46aea690d9c8897d5fe7">Chapter 8</a>, <span class="strong"><em class="calibre13">Routing, Responses, and Events</em></span>.</p></div></div><div class="book" title="Model attribute labels"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec22" class="calibre1"/>Model attribute labels</h3></div></div></div><p class="calibre9">The<a id="id204" class="calibre1"/> next method that Gii automatically implements for us is the <code class="email">attributeLabels()</code> method. The <code class="email">attributesLabels()</code> method enables us to name our model attributes with more descriptive names that we can use as form labels. By default, Gii will automatically generate labels for us based upon our column names. Furthermore, by following the convention of using underscores in our column names in our <code class="email">user</code> table, Gii has automatically created titleized and readable attribute labels for us:</p><div class="note"><pre class="programlisting">public function attributeLabels()
{
    return [
        'id'            =&gt; 'ID',
        'email'         =&gt; 'Email',
        'password'      =&gt; 'Password',
        'first_name'    =&gt; 'First Name',
        'last_name'     =&gt; 'Last Name',
        'role_id'       =&gt; 'Role ID',
        'created_at'    =&gt; 'Created At',
        'updated_at'    =&gt; 'Updated At',
    ];
}</pre></div><p class="calibre9">Since<a id="id205" class="calibre1"/> our <code class="email">attributeLabels()</code> method just returns an array of key-value pairs, we can enhance our application by translating our attribute labels into multiple languages using the <code class="email">\Yii::t()</code> method:</p><div class="note"><pre class="programlisting">public function attributeLabels()
{
    return [
        'id'            =&gt; 'ID',
        'email'         =&gt; \Yii::t('app', 'Email'),
        // [ ... other attribute labels ... ]
    ];
}</pre></div><p class="calibre9">Assuming that our application was properly configured to use translations, we can fetch the translated text for our attribute labels using the <code class="email">getAttributeLabel()</code> method for our <code class="email">email</code> attribute:</p><div class="note"><pre class="programlisting">$user-&gt;getAttributeLabel('email'); // returns "Email"</pre></div><p class="calibre9">If our application was configured for the English locale, it would simply return the string<code class="email"> "Email"</code>; however, if our application was running in a different language, say Spanish, this method would return the string <code class="email">"Correo"</code> instead of <code class="email">"Email"</code>.</p><div class="note" title="Note"><h3 class="title2"><a id="tip69" class="calibre1"/>Tip</h3><p class="calibre9">We'll cover the <code class="email">Yii::t()</code> method as well as general internationalization and localization in <a class="calibre1" title="Chapter 11. Internationalization and Localization" href="part0068_split_000.html#20R681-ad3e09b384df46aea690d9c8897d5fe7">Chapter 11</a>, <span class="strong"><em class="calibre13">Internationalization and Localization</em></span>.</p></div></div><div class="book" title="Active Record relationships"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec23" class="calibre1"/>Active Record relationships</h3></div></div></div><p class="calibre9">Assuming<a id="id206" class="calibre1"/> that we configured our database schema properly with primary and foreign keys, Yii2 will also generate model relationships for us. Unlike Yii1, Yii2 has done away with the <code class="email">relations()</code> methods and replaced them with magic <code class="email">__getter()</code> methods. Our <code class="email">User</code> model illustrates this for the <code class="email">Post</code> and <code class="email">Role</code> relationships:</p><div class="note"><pre class="programlisting">/**
 * @return \yii\db\ActiveQuery
 */
public function getPosts()
{
    return $this-&gt;hasMany(Post::className(), ['author_id' =&gt; 'id']);
}

/**
 * @return \yii\db\ActiveQuery
 */
public function getRole()
{
    return $this-&gt;hasOne(Role::className(), ['id' =&gt; 'role_id']);
}</pre></div><p class="calibre9">Yii2 also<a id="id207" class="calibre1"/> simplified the relationships method, and now, it only supports two types of relationships: has-one, as used by the <code class="email">hasOne()</code> method, and has-many, as defined by the <code class="email">hasMany()</code> method. Like Yii1, though, related data can be accessed simply by calling the <code class="email">__getter()</code> method. For instance, if we want to retrieve the name of the role for a user we are working with, we can simply execute the following:</p><div class="note"><pre class="programlisting">$user = new User::findOne(4);  // Fetch a user in our db
echo $user-&gt;role-&gt;name;    // "Admin"</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip70" class="calibre1"/>Tip</h3><p class="calibre9">Gii makes several inferences based upon your database schema to create model relationships. Check whether your relationships map to the correct classes and have the correct relationship types before executing your code.</p></div></div><div class="book" title="Using multiple database connections with Active Record"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec24" class="calibre1"/>Using multiple database connections with Active Record</h3></div></div></div><p class="calibre9">By default, all <a id="id208" class="calibre1"/>active record instances will use the <code class="email">db</code> component to connect to our database. In the instance where we have multiple databases connected to our application, we can configure active record to work with an alternate database by defining the static method <code class="email">getDb()</code> within our Active Record class:</p><div class="note"><pre class="programlisting">public static function getDb()
{
    // the "db2" component
    return \Yii::$app-&gt;db2;
}</pre></div></div><div class="book" title="Behaviors in Active Record"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec25" class="calibre1"/>Behaviors in Active Record</h3></div></div></div><p class="calibre9">Yii2 <a id="id209" class="calibre1"/>supports several behaviors, which can be used to automatically handle some of the more tedious tasks of model management, such as managing the created and updated times, automatically creating URL slugs for our application, and logging which user created and modified a specific record.</p><p class="calibre9">To use a behavior with an Active Record class in Yii2, we simply need to specify that we want to use the behavior class at the top of our PHP file and then add the behavior to the <code class="email">behaviors()</code> method of our model. For instance, since both our <code class="email">User</code> and <code class="email">Post</code> classes have the <code class="email">created_at</code> and <code class="email">updated_at</code> attributes, we can add the following to let Yii2 manage these attributes for us:</p><div class="note"><pre class="programlisting">&lt;?php

use Yii;
use yii\behaviors\TimestampBehavior
class User extends yii\db\ActiveRecord
{
    /** 
     * Allow yii to handle population of
     * created_at and updated_at time
     */
    public function behaviors()
    {   
            return [
                TimestampBehavior::className(),
            ];  
    }
    // [... other methods ...]
}</pre></div><p class="calibre9">By default, the <code class="email">yii\behaviors\TimestampBehavior</code> class will populate the <code class="email">created_at</code> and <code class="email">updated_at</code> attributes with the current time, as extracted from the native PHP <code class="email">time()</code> function. Like most things in Yii2, this is completely configurable. For instance, if our database has created and updated fields that use the MySQL <code class="email">TIMESTAMP</code> column type, we can adjust the behavior as follows:</p><div class="note"><pre class="programlisting">public function behaviors()
{
    return [
        [
            'class' =&gt; TimestampBehavior::className(),
            'createdAtAttribute' =&gt; 'created',
            'updatedAtAttribute' =&gt; 'updated',
            'value' =&gt; new \yii\db\Expression('NOW()'),
        ],
    ];
}</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip71" class="calibre1"/>Tip</h3><p class="calibre9">More<a id="id210" class="calibre1"/> information on behaviors can be found from the <a id="id211" class="calibre1"/>Yii2 guide located at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/guide-concept-behaviors.html">http://www.yiiframework.com/doc-2.0/guide-concept-behaviors.html</a>.</p></div></div></div></div>

<div class="book" title="Active Record">
<div class="book" title="Working with Active Record"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec46" class="calibre1"/>Working with Active Record</h2></div></div></div><p class="calibre9">Now that <a id="id212" class="calibre1"/>we have learned what Gii automatically provides for us when creating new Active Record classes and what additional options we can add to our classes to enhance them, let's take a look at how we can use active record instances to perform basic create, read, update, and delete (CRUD) actions.</p><div class="book" title="Querying data"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec26" class="calibre1"/>Querying data</h3></div></div></div><p class="calibre9">To query <a id="id213" class="calibre1"/>data with Active Record, we can query for data using the <code class="email">yii/db/ActiveRecord::find()</code> method, which will return an instance of <code class="email">yii/db/ActiveQuery</code>. Since <code class="email">yii/db/ActiveQuery</code> extends <code class="email">yii/db/Query</code>, we can take advantage of nearly all the methods and query objects we learned in <a class="calibre1" title="Chapter 3. Migrations, DAO, and Query Building" href="part0023_split_000.html#LTSU1-ad3e09b384df46aea690d9c8897d5fe7">Chapter 3</a>, <span class="strong"><em class="calibre13">Migrations, DAO, and Query Building</em></span>. Let's take a look at several different examples of using the <code class="email">yii/db/ActiveRecord::find()</code> method.</p><div class="note"><pre class="programlisting">// Find the user in our database with the ID of 1. 
// one() returns an instance of User model, for the user with id=1
$user = User::find()-&gt;where(['id' =&gt; 1])
                    -&gt;one();

// Find all users in our database and order them by ID
// Returns an array of User objects
$users = User::find()-&gt;orderBy('id'])
                     -&gt;all();

// Returns the number of users in our database
$userCount = User::find()-&gt;count();</pre></div><p class="calibre9">As an <a id="id214" class="calibre1"/>alternative to <code class="email">yii/db/ActiveQuery</code>, <code class="email">yii/db/ActiveRecord</code> also provides two additional methods to query for data, <code class="email">findOne()</code>, which will return the first Active Record instance from a query, and <code class="email">findAll()</code>, which will return an array of Active Record instances. Both methods accept a scalar argument, an array of scalar arguments, or an array of associative pairs to query data:</p><div class="note"><pre class="programlisting">// Fetches user with the ID of 1
User::findOne(1);

// Fetches users with the ID of 1, 2, 3, and 4
User::findAll([1, 2, 3, 4]);

// Fetches admin users (role_id = 2 from migration)
// with the last name of Doe
User::findOne([
    'role_id' =&gt; 2,
    'last_name' =&gt; 'Doe'
]);

// Retrieves users with the last name of Doe
User::findAll([
    'last_name' =&gt; 'Doe'
]);</pre></div><div class="note" title="Note"><h3 class="title2"><a id="note15" class="calibre1"/>Note</h3><p class="calibre9">The <code class="email">yii/db/ActiveRecord::findOne()</code> method will not add <code class="email">LIMIT 1</code> to the generated SQL query, which may result in longer running queries as <code class="email">yii/db/ActiveRecord::findOne()</code> will simply fetch the first row from the query result. If you encounter performance issues using <code class="email">yii/db/ActiveRecord::findOne()</code>, try to use the <code class="email">yii/db/Activequery::find()</code> method paired with the <code class="email">limit()</code> and <code class="email">one()</code> methods instead, as follows:</p><div class="note"><pre class="programlisting">User::find()-&gt;limit(1)-&gt;one();</pre></div></div><p class="calibre9">Using <code class="email">yii/db/ActiveQuery</code> can be extremely memory-intensive at times, depending upon how many records are being accessed. One way to get around this limitation is to convert our resulting data into an array format using the <code class="email">asArray()</code> method:</p><div class="note"><pre class="programlisting">$users = User::find()-&gt;asArray()
                     -&gt;all();</pre></div><p class="calibre9">Rather<a id="id215" class="calibre1"/> than returning an array of Active Record instances, the <code class="email">asArray()</code> method will return an array of arrays containing Active Record data attributes.</p><div class="note" title="Note"><h3 class="title2"><a id="tip72" class="calibre1"/>Tip</h3><p class="calibre9">While the <code class="email">asArray()</code> method can be used to increase the performance of large queries, it has several downsides. The data returned will not be an instance of Active Record, and thus, it will not have any of the methods or helpful attributes associated with it. Moreover, since data is being returned directly from PDO, the data will not be typecast automatically and will be returned as a string instead.</p></div><div class="book" title="Data access"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch04lvl4sec06" class="calibre1"/>Data access</h4></div></div></div><p class="calibre9">When using <a id="id216" class="calibre1"/>Active Record, each row from our database query will generate a single Active Record instance. The column values from our Active Record instance can be accessed via the model attributes for that Active Record instance:</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
echo $user-&gt;first_name; // "Jane"
echo $user-&gt;last_name; // "Doe"</pre></div><p class="calibre9">Moreover, relational information can be accessed through the related object's attributes. For instance, to retrieve the author's name from a given post, we can run the following code:</p><div class="note"><pre class="programlisting">$post = Post::findOne(1);
echo $post-&gt;id; // "1"

// "Site Administrator"
echo $post-&gt;author-&gt;first_name . ' ' . $post-&gt;author-&gt;last_name;</pre></div><div class="note" title="Note"><h3 class="title2"><a id="note16" class="calibre1"/>Note</h3><p class="calibre9">Active Record attributes are named after the column names. If having Active Record attributes with underscores doesn't match your coding style, you should rename your column names.</p></div><p class="calibre9">Our data can also be manipulated by creating a custom getter and setter method within our Active Record class. For instance, if we want to display the user's complete name without changing our database schema, we can add the following method to our User Active Record class:</p><div class="note"><pre class="programlisting">/**
 * Returns the user's full name
 * @return string
 */
public function getFullName()
{
    return $this-&gt;first_name . ' ' . $this-&gt;last_name;
}</pre></div><p class="calibre9">This data<a id="id217" class="calibre1"/> can then be accessed directly either through the <code class="email">getFullName()</code> method or as a pseudo attribute:</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
echo $user-&gt;fullName;      // "Jane Doe"
echo $user-&gt;getFullName(); // "Jane Doe"</pre></div><p class="calibre9">Along the same vein, we can also create custom setters. For instance, the following method takes the user's complete name as input and populates the <code class="email">first_name</code> and <code class="email">last_name</code> attributes for us:</p><div class="note"><pre class="programlisting">/**
 * Set the users first and last name from a single variable
 * @param boolean
 */
public function setFullName($name)
{
    list($firstName, $lastName) = explode(" ", $name);
    $this-&gt;first_name = $firstName;
    $this-&gt;last_name = $lastName;

    return true;
}</pre></div><p class="calibre9">Our setter then enables us to treat the user's complete name as a settable attribute:</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
$user-&gt;fullName = 'Janice Doe'; // or $user-&gt;setfullName('Janice Doe');
echo $user-&gt;first_name; // "Janice"
echo $user-&gt;last_name;  // "Doe"</pre></div></div></div><div class="book" title="Saving data"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec27" class="calibre1"/>Saving data</h3></div></div></div><p class="calibre9">Once<a id="id218" class="calibre1"/> we've made changes to our Active Record instance, we can save these changes to our database by calling the <code class="email">save()</code> method on our instance, which will return <code class="email">true</code> if the model was successfully saved to the database, or it'll return <code class="email">false</code> if there was an error.</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
$user-&gt;first_name = "Janice";
$user-&gt;last_name = "Doe";
$user-&gt;save();</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip73" class="calibre1"/>Tip</h3><p class="calibre9">If an error occurred during either the save or validation process, you can retrieve the errors through the <code class="email">yii/db/ActiveRecord::getErrors()</code> method.</p></div><p class="calibre9">If we retrieved our user information from the database again, we would see that the results were stored:</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
echo $user-&gt;first_name; // "Janice"
echo $user-&gt;last_name;  // "Doe"</pre></div><p class="calibre9">Data can also be assigned in bulk through the <code class="email">yii/db/ActiveRecord::load()</code> method. Typically when using the <code class="email">load()</code> method, we'll provide data from a form submission, which we'll cover later in this chapter.</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
$user-&gt;load(\Yii::$app-&gt;request-&gt;post());
$user-&gt;save(); </pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip74" class="calibre1"/>Tip</h3><p class="calibre9">
<code class="email">\Yii::$app-&gt;request</code> represents the request object and is configured in our <code class="email">config/web.php</code> file. The <code class="email">post()</code> method represents any data submitted via a <code class="email">POST</code> request.</p></div><div class="book" title="Creating new records"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch04lvl4sec07" class="calibre1"/>Creating new records</h4></div></div></div><p class="calibre9">Creating<a id="id219" class="calibre1"/> new records in our database can be done by instantiating a new instance of an active record class using the <code class="email">new</code> keyword, populating the model with data, and then calling the <code class="email">save()</code> method on the model.</p><div class="note"><pre class="programlisting">$user = new User;
$user-&gt;load(\Yii::$app-&gt;request-&gt;post());
/**
    $user-&gt;attributes = [
        'first_name' =&gt; 'Janice',
        'last_name'  =&gt; 'Doe',
        // ... and so forth
    ];
*/
$user-&gt;save();</pre></div></div></div><div class="book" title="Deleting data"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec28" class="calibre1"/>Deleting data</h3></div></div></div><p class="calibre9">Data<a id="id220" class="calibre1"/> can also be deleted from our database via Active Record by calling the <code class="email">delete()</code> method on our model. The <code class="email">delete()</code> method will permanently delete data from the database and will return <code class="email">true</code> if the deletion was successful or <code class="email">false</code> if an error occurred.</p><div class="note"><pre class="programlisting">$user = User::findOne(1);
$user-&gt;delete(); // return true;</pre></div><p class="calibre9">Multiple data rows can be deleted by calling the <code class="email">yii/db/ActiveRecord::deleteAll()</code> static method:</p><div class="note"><pre class="programlisting">Post::deleteAll(['author_id' =&gt; 4]);</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip75" class="calibre1"/>Tip</h3><p class="calibre9">Be careful when using the <code class="email">deleteAll()</code> method as it will permanently delete any data that the condition statement specifies. A mistake in the conditional can result in an entire table being truncated.</p></div></div><div class="book" title="Active Record events"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec29" class="calibre1"/>Active Record events</h3></div></div></div><p class="calibre9">As an <a id="id221" class="calibre1"/>alternative to creating before and after method handlers such as <code class="email">beforeSave()</code> and <code class="email">afterDelete()</code>, Yii2 supports several different events that our application can listen to. The events that Active Record supports are outlined in the following table:</p><div class="note"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Event</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Description</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_INIT</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An <a id="id222" class="indexterm"/>event that is triggered when an Active Record instance is initialized via the <code class="literal">init()</code> method</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_BEFORE_UPDATE</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An<a id="id223" class="indexterm"/> event that is triggered before a record is updated</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_BEFORE_INSERT</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An <a id="id224" class="indexterm"/>event that is triggered before a record is inserted </p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_BEFORE_DELETE</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An <a id="id225" class="indexterm"/>event that is triggered before a record is deleted</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_AFTER_UPDATE</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An<a id="id226" class="indexterm"/> event that is triggered after a record is modified</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_AFTER_INSERT</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An <a id="id227" class="indexterm"/>event that is triggered after a record is inserted</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_AFTER_DELETE</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An <a id="id228" class="indexterm"/>event that is triggered after a record is deleted</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal">EVENT_AFTER_FIND</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">An <a id="id229" class="indexterm"/>event that is triggered after a record is created and populated with a query result</p>
</td></tr></tbody></table></div><div class="note" title="Note"><h3 class="title2"><a id="tip76" class="calibre1"/>Tip</h3><p class="calibre9">We'll cover <a id="id230" class="calibre1"/>what exactly events are and how to use them in <a class="calibre1" title="Chapter 8. Routing, Responses, and Events" href="part0047_split_000.html#1CQAE2-ad3e09b384df46aea690d9c8897d5fe7">Chapter 8</a>, <span class="strong"><em class="calibre13">Routing, Responses, and Events</em></span>.</p></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Models" id="UGI01-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec26" class="calibre1"/>Models</h1></div></div></div><p class="calibre9">In Yii1, base<a id="id231" class="calibre1"/> models and form models were two separated classes (<code class="email">CModel</code> and <code class="email">CFormModel</code>). In Yii2, these two classes have been consolidated into a single class, <code class="email">yii/base/Model</code>. This class is used throughout Yii2 for data representation and should be our go-to class when representing data we can't represent with <code class="email">yii/db/ActiveRecord</code>.</p><div class="note" title="Note"><h3 class="title2"><a id="tip77" class="calibre1"/>Tip</h3><p class="calibre9">Since <code class="email">yii/db/ActiveRecord</code> extends <code class="email">yii/base/Model</code>, we're already familiar with the majority of methods and properties that <code class="email">yii/base/Model</code> offers, such as <code class="email">getAttributes()</code>, <code class="email">rules()</code>, <code class="email">attributeLabels()</code>, and <code class="email">getErrors()</code>. Refer to<a id="id232" class="calibre1"/> the Yii2 API documentation for a complete list of all the methods supported by <code class="email">yii/base/Model</code> at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/yii-base-model.html">http://www.yiiframework.com/doc-2.0/yii-base-model.html</a>.</p></div></div>

<div class="book" title="Models" id="UGI01-ad3e09b384df46aea690d9c8897d5fe7">
<div class="book" title="Model attributes"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec47" class="calibre1"/>Model attributes</h2></div></div></div><p class="calibre9">In <code class="email">yii/db/ActiveRecord</code>, data attributes and attribute names are pulled directly from our<a id="id233" class="calibre1"/> database column names. In <code class="email">yii/base/Model</code>, data attributes and attribute names are defined as public properties within our model class. For instance, if we want to create a model called <code class="email">UserForm</code> to collect user information, we can write the following class:</p><div class="note"><pre class="programlisting">&lt;?php

use Yii;

class UserForm extends yii/base/Model
{
    public $email;
    public $password;
    public $name;
}</pre></div><p class="calibre9">Unlike Active Record instances, information stored in base models is not persisted. Calling <code class="email">unset()</code> on the class or creating a new instance of the class will not grant user the access to the data stored in other instance of the model. Since our model attributes are public properties of our PHP class, we can access them like any public property.</p><div class="book" title="Scenarios"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec30" class="calibre1"/>Scenarios</h3></div></div></div><p class="calibre9">When <a id="id234" class="calibre1"/>working with models or active record classes, we may want to reuse the same model for different situations, such as logging in a user or registering a user. To help us write less code, Yii2 provides the <code class="email">scenarios()</code> method to define what business logic and validation rules should be executed for each scenario. By default, scenarios are determined by our validation rules using the <code class="email">on</code> property in our validation rules:</p><div class="note"><pre class="programlisting">public function rules()
{
    return [
        [['email', 'password'], 'required'],
        [['email'], 'email'],
        [['email', 'password', 'name'], 'string', 'max' =&gt; 255],
        [['email', 'password'], 'required', <span class="strong"><strong class="calibre2">'on' =&gt; 'login'</strong></span>],
        [['email', 'password', 'name'], 'required', <span class="strong"><strong class="calibre2">'on' =&gt; 'register'</strong></span>],
    ];
}</pre></div><p class="calibre9">This behavior can be customized by overriding the <code class="email">scenarios()</code> method with our custom logic:</p><div class="note"><pre class="programlisting">public function scenarios()
{
    return [
        'login'    =&gt; ['email', 'password'],
        'register' =&gt; ['email', 'password', 'name']
    ];  
}</pre></div><p class="calibre9">Alternatively, if we<a id="id235" class="calibre1"/> want to add new scenarios to our model without altering the current scenarios defined in our model validation rules, we can simply add them by fetching the classes' parent scenarios, adding the new scenarios we want to add, and then returning our updated scenarios' array:</p><div class="note"><pre class="programlisting">public function scenarios()
{
    $scenarios = parent::scenarios();
    $scenarios['login'] = ['email', 'password'];
    $scenarios['register'] = ['email', 'password', 'name'];
    return $scenarios;
}</pre></div><p class="calibre9">We can then control which scenario is active when we instantiate our model or when we define the scenario property of our model at runtime:</p><div class="note"><pre class="programlisting">// Instantiate a model with a specific scenario
$model = new UserForm(['scenario' =&gt; 'login']);

// Set scenario at runtime
$model = new UserForm;
$model-&gt;scenario = 'register';</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip78" class="calibre1"/>Tip</h3><p class="calibre9">When a scenario is not specified either at runtime or during model instantiation, the default scenario is used. The default scenario marks all model attributes as active for both mass assignment and model validation.</p></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Forms"><div class="book" id="VF2I2-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec27" class="calibre1"/>Forms</h1></div></div></div><p class="calibre9">In Yii2, we <a id="id236" class="calibre1"/>can dynamically generate rich HTML5 forms based upon our model using the <code class="email">yii/widgets/ActiveForm</code> class. The <code class="email">yii/widgets/ActiveForm</code> class has several advantages over managing forms manually. In addition to providing several useful helper methods and pairing well with the HTML helper <code class="email">yii/helpers/Html</code>, forms can be generated from the Gii tool using our model data. When working with models and active record instances, this is the preferred way to generate forms.</p></div>

<div class="book" title="Forms">
<div class="book" title="Generating forms with Gii"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec48" class="calibre1"/>Generating forms with Gii</h2></div></div></div><p class="calibre9">Like<a id="id237" class="calibre1"/> Active Record classes, forms can be generated automatically for us from both the web Gii tool and the console Gii tool. Let's take a look at generating a form for authentication, which we'll call <code class="email">LoginForm</code>, and a form to handle registration, which we'll call <code class="email">RegisterForm</code>.</p><div class="book" title="Generating forms with Gii's web interface"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec31" class="calibre1"/>Generating forms with Gii's web interface</h3></div></div></div><p class="calibre9">For<a id="id238" class="calibre1"/> our <code class="email">LoginForm</code> form, let's start by opening up the Gii web tool by navigating to the <code class="email">/gii</code> endpoint of our application and then clicking on the <span class="strong"><strong class="calibre2">Start</strong></span> button underneath the <span class="strong"><strong class="calibre2">Form Generator</strong></span> section.</p><div class="mediaobject"><img src="../images/00029.jpeg" alt="Generating forms with Gii's web interface" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">Like <a id="id239" class="calibre1"/>our model generator, to generate a form, we only need to provide a few fields. For forms, we only need to know the view name (which will translate to the filename) and the model class. For our view name, let's use <code class="email">site/forms/LoginForm</code>, and for our model class, we may want to use the <code class="email">UserForm</code> class that we generated previously. Since we want to use our form just to log in, we should also specify that we want to use the <span class="strong"><em class="calibre13">login</em></span> scenario.</p><div class="note" title="Note"><h3 class="title2"><a id="tip79" class="calibre1"/>Tip</h3><p class="calibre9">When specifying the model class, we need to specify both the namespace and the class so that Yii can find our class. For our <code class="email">UserForm</code> class, we will need to provide <code class="email">app\models\UserForm</code>.</p></div><div class="mediaobject"><img src="../images/00030.jpeg" alt="Generating forms with Gii's web interface" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">Once<a id="id240" class="calibre1"/> we have specified all the necessary attributes, we can click on the <span class="strong"><strong class="calibre2">Preview</strong></span> button to preview our form, and then we can click on the <span class="strong"><strong class="calibre2">Generate</strong></span> button to generate the source code.</p><div class="mediaobject"><img src="../images/00031.jpeg" alt="Generating forms with Gii's web interface" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">Unlike <a id="id241" class="calibre1"/>our model generator, after the generation, our form generator will also provide us with a template action that we can put into our controller:</p><div class="note"><pre class="programlisting">&lt;?php

// app\controllers\SiteController.php::actionLogin()
public function actionLogin()
{
    $model = new \app\models\UserForm(['scenario' =&gt; 'login']);

    if ($model-&gt;load(Yii::$app-&gt;request-&gt;post())) {
        if ($model-&gt;validate()) {
            // form inputs are valid, do something here
            return;
        }
    }

    return $this-&gt;render('LoginForm', [
        'model' =&gt; $model,
    ]);
}</pre></div></div><div class="book" title="Generating forms with Gii's console interface"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec32" class="calibre1"/>Generating forms with Gii's console interface</h3></div></div></div><p class="calibre9">As an<a id="id242" class="calibre1"/> alternative to generating forms with Gii's web interface, we can also use Gii's console interface to generate basic forms for our model class. To generate forms with our console interface, we can run the <code class="email">gii/form</code> tool, as shown in the following example:</p><div class="note"><pre class="programlisting"><span class="strong"><strong class="calibre2">./yii gii/form --modelClass=app\\models\\UserForm --viewName=site/forms/RegisterForm --scenarioName=register --enableI18N=1</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip80" class="calibre1"/>Tip</h3><p class="calibre9">Most console shells treat the backslash character as an escape character. To pass a backslash character to Gii, we need to escape the backslash character with a second backslash.</p></div><p class="calibre9">Here's the output:</p><div class="mediaobject"><img src="../images/00032.jpeg" alt="Generating forms with Gii's console interface" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">Our resulting <code class="email">RegisterForm</code> view will look as follows:</p><div class="note"><pre class="programlisting">&lt;?php

use yii\helpers\Html;
use yii\widgets\ActiveForm;

/* @var $this yii\web\View */
/* @var $model app\models\UserForm */
/* @var $form ActiveForm */
?&gt;
&lt;div class="site-forms-RegisterForm"&gt;

    &lt;?php $form = ActiveForm::begin(); ?&gt;

        &lt;?= $form-&gt;field($model, 'email') ?&gt;
        &lt;?= $form-&gt;field($model, 'password') ?&gt;
        &lt;?= $form-&gt;field($model, 'name') ?&gt;
    
        &lt;div class="form-group"&gt;
            &lt;?= Html::submitButton(Yii::t('app', 'Submit'), ['class' =&gt; 'btn btn-primary']) ?&gt;
        &lt;/div&gt;
    &lt;?php ActiveForm::end(); ?&gt;

&lt;/div&gt;&lt;!-- site-forms-RegisterForm --&gt;</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip81" class="calibre1"/>Tip</h3><p class="calibre9">Remember, Gii's <a id="id243" class="calibre1"/>console interface only prompts you for the most basic information it needs in order to generate the class. Remember to use the <code class="email">help</code> tool to discover other command-line arguments for additional customization.</p></div></div></div></div>

<div class="book" title="Forms">
<div class="book" title="Using forms"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec49" class="calibre1"/>Using forms</h2></div></div></div><p class="calibre9">Now<a id="id244" class="calibre1"/> that we've created our forms, let's take a brief look at how exactly they work. As shown earlier, our <code class="email">yii/widgets/ActiveForm</code> class expects a model to work with. In most cases, this is going to be defined in our controller and then passed down to our view:</p><div class="note"><pre class="programlisting">$model = new app\models\UserForm(['scenario' =&gt; 'login']);</pre></div><p class="calibre9">One thing you may notice about our generated forms is that they only contain core form logic and don't contain extra HTML, such as the <code class="email">html</code>, <code class="email">head</code>, and <code class="email">body</code> tags. In Yii2, generated forms are intended to be rendered as a partial view rather than a complete view. Rather than specifying our form, <code class="email">LoginForm</code>, directly in our controller, we will pass our model down to a parent view, which will then render our form. As an example, our login action within our controller will change to the following:</p><div class="note"><pre class="programlisting">// app\controllers\SiteController::actionLogin()
return $this-&gt;render('login', [
    'model' =&gt; $model,
]);</pre></div><p class="calibre9">We will then create a new view file at <code class="email">views/site/login.php</code>, which will render our <code class="email">LoginForm</code>:</p><div class="note"><pre class="programlisting">// views/site/login.php
&lt;div class="site-login" style="margin-top: 100px";&gt;
    &lt;div class="body-content"&gt;
        <span class="strong"><strong class="calibre2">&lt;?php echo $this-&gt;render('forms/LoginForm', [ 'model' =&gt; $model ]); ?&gt;</strong></span>
    &lt;/div&gt;
&lt;/div&gt;</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip82" class="calibre1"/>Tip</h3><p class="calibre9">Unlike Yii1, Yii2 doesn't have a <code class="email">renderPartial()</code> method to render partial views. Instead, it has two separate <code class="email">render()</code> methods: one in <code class="email">yii/base/Controller</code> and another in <code class="email">yii/base/View</code>. The <code class="email">render()</code> method called in our previous example is called from <code class="email">yii/base/View</code> and is used to render any view file whether we consider it a partial view or a complete view.</p></div><p class="calibre9">The<a id="id245" class="calibre1"/> resulting view from our render chain would then look as follows if we navigate to the <code class="email">site/login</code> endpoint of our application:</p><div class="mediaobject"><img src="../images/00033.jpeg" alt="Using forms" class="calibre10"/></div><p class="calibre11"> </p><div class="note" title="Note"><h3 class="title2"><a id="tip83" class="calibre1"/>Tip</h3><p class="calibre9">
<a class="calibre1" title="Chapter 8. Routing, Responses, and Events" href="part0047_split_000.html#1CQAE2-ad3e09b384df46aea690d9c8897d5fe7">Chapter 8</a>, <span class="strong"><em class="calibre13">Routing, Responses, and Events</em></span>, will help us gain a better understanding of how routing works in Yii2 and how we can easily figure out which controller actions match to which view actions.</p></div><div class="book" title="ActiveForm and input types"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec33" class="calibre1"/>ActiveForm and input types</h3></div></div></div><p class="calibre9">Now that<a id="id246" class="calibre1"/> we know how to render our form, let's break down our form<a id="id247" class="calibre1"/> view. Since view files and controllers are separated in Yii2, we need to first make sure that we use our active form class in our view file:</p><div class="note"><pre class="programlisting">&lt;?php use yii\widgets\ActiveForm; ?&gt;</pre></div><p class="calibre9">Our active form elements are then contained within a static call in the <code class="email">ActiveForm</code> class to the <code class="email">begin()</code> and <code class="email">end()</code> methods.</p><div class="note"><pre class="programlisting">&lt;?php $form = ActiveForm::begin(); ?&gt;
&lt;?php ActiveForm::end(); ?&gt;</pre></div><p class="calibre9">By default, our <code class="email">begin()</code> method will provide us with several built-in HTML defaults, such as an ID and class attribute. To customize these, we can provide an array of arguments to our <code class="email">begin()</code> method to manually specify these attributes:</p><div class="note"><pre class="programlisting">$form = ActiveForm::begin([
    'id' =&gt; 'login-form',
    'options' =&gt; [
'class' =&gt; 'form-horizontal'
 ]
]) ?&gt;</pre></div><p class="calibre9">The next item to notice about our form is that model attributes are wrapped within a call to <code class="email">$form-&gt;field()</code>:</p><div class="note"><pre class="programlisting">&lt;?= $form-&gt;field($model, 'email') ?&gt;
&lt;?= $form-&gt;field($model, 'password') ?&gt;</pre></div><p class="calibre9">The <code class="email">field()</code> method is a chainable method that specifies the <code class="email">&lt;input&gt;</code> tag for our model attribute, adding some basic client-side validation (such as the <code class="email">required</code> attribute) and populating the <code class="email">form</code> field with data in the instance of a model validation error in our <code class="email">POST</code> submission. Since the method is chainable, we can chain additional attributes onto our form. For instance, if we want to add client-side validation for our <code class="email">email</code> field so that our browsers can verify our text field was an email address, we can chain the following:</p><div class="note"><pre class="programlisting">&lt;?= $form-&gt;field($model, 'email')-&gt;input('email') ?&gt;</pre></div><p class="calibre9">In addition to our required validator, our view now verifies that our email is a valid email address.</p><div class="mediaobject"><img src="../images/00034.jpeg" alt="ActiveForm and input types" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre9">Likewise, we<a id="id248" class="calibre1"/> can customize our <code class="email">password</code> field to obstruct our <a id="id249" class="calibre1"/>password by specifying that the field should be a password input:</p><div class="note"><pre class="programlisting">&lt;?= $form-&gt;field($model, 'password')-&gt;passwordInput() ?&gt;</pre></div><p class="calibre9">With <code class="email">ActiveForm</code>, we can also add an inline hint or modify the label for any attribute using the <code class="email">hint()</code> method and the <code class="email">label()</code> method:</p><div class="note"><pre class="programlisting">&lt;?= $form-&gt;field($model, 'name')-&gt;textInput()-&gt;hint('Please enter your name')-&gt;label('Your Name') ?&gt;</pre></div><div class="mediaobject"><img src="../images/00035.jpeg" alt="ActiveForm and input types" class="calibre10"/></div><p class="calibre11"> </p><div class="note" title="Note"><h3 class="title2"><a id="tip84" class="calibre1"/>Tip</h3><p class="calibre9">While the <code class="email">$form</code> property is an instance of <code class="email">yii/widgets/ActiveForm</code>, the <code class="email">field()</code> method returns an instance of <code class="email">yii/widgets/ActiveField</code>. For a list<a id="id250" class="calibre1"/> of all the available methods and options for <code class="email">yii/widgets/ActiveField</code>, refer to the Yii2 documentation at <a class="calibre1" href="http://www.yiiframework.com/doc-2.0/yii-widgets-activefield.html">http://www.yiiframework.com/doc-2.0/yii-widgets-activefield.html</a>.</p></div></div></div></div>
<div class="book" title="Summary" id="10DJ41-ad3e09b384df46aea690d9c8897d5fe7"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec28" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">We covered a lot of information in this chapter! We covered how to properly set up and configure Gii, the code generation tool for Yii2. We then covered how we can automatically create Active Record classes based upon our database schema using both the web and console interface for Gii in addition to many of the common methods and properties we can bind to our Active Record classes, such as validation rules, attribute labels, and behaviors. Next, we covered how to create basic models that do not depend upon our database and how to add scenarios to our models and Active Record classes. We finally covered how we can use the Gii tool to create HTML forms based upon our models and explored some of the functionality that comes with the <code class="email">ActiveForm</code> class.</p><p class="calibre9">In the next chapter, we are going to expand our knowledge of the available helpers and widgets that come with Yii2. We will also dive into modules in Yii2 and explore how we can use them to create reusable self-contained applications that we will keep building upon throughout the book.</p><p class="calibre9">As we move forward, we are going to build upon much of the knowledge we have gained thus far. Before moving forward, ensure that you review the classes and information we have learned about.</p></div></body></html>