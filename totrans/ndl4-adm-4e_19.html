<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer482">
<h1 class="chapter-number" id="_idParaDest-343" lang="en-GB"><a id="_idTextAnchor344"/>19</h1>
<h1 id="_idParaDest-344" lang="en-GB"><a id="_idTextAnchor345"/>Setting Up Moodle Networking</h1>
<p lang="en-GB">Moodle provides a unique feature that lets you network multiple Moodle sites. This networking functionality is useful in several contexts – for example, when you want to share resources with remote LMSs, partner with another organization, or have a multi-campus setup where each site has its own <span class="No-Break" lang="">Moodle instance.</span></p>
<p lang="en-GB">After providing an <a id="_idIndexMarker1687"/>overview of <strong class="bold" lang="">Moodle networking</strong> (<strong class="bold" lang="">MNet</strong>), we will learn which networking components are required and how networking is enabled. Next, we will will learn how to link two Moodle sites, which entails setting up peer-to-peer connections, roaming across instances, configuring remote authentication and enrolment, and using the Networks server block. Lastly, we will learn how to connect multiple Moodle sites to a central <span class="No-Break" lang="">MNet hub.</span></p>
<p lang="en-GB">We will finish this chapter with a new platform closely related to MNet known as <strong class="bold" lang="">MoodleNet</strong>, a <a id="_idIndexMarker1688"/>platform for finding, sharing, and curating open educational resources. You will learn how to enable MoodleNet so that your educators can make use <span class="No-Break" lang="">of it.</span></p>
<p lang="en-GB">We will cover the following main topics in <span class="No-Break" lang="">this chapter:</span></p>
<ul>
<li lang="en-GB">Configuring Moodle <span class="No-Break" lang="">networking prerequisites</span></li>
<li lang="en-GB">Setting up <span class="No-Break" lang="">peer-to-peer networks</span></li>
<li lang="en-GB">Setting up a <span class="No-Break" lang="">Moodle hub</span></li>
<li lang="en-GB"><span class="No-Break" lang="">Enabling MoodleNet</span></li>
</ul>
<h1 id="_idParaDest-345" lang="en-GB"><a id="_idTextAnchor346"/>Understanding Moodle networking</h1>
<p lang="en-GB">Learning management systems are usually standalone systems. But learning is a lot about communication and collaboration, and MNet overcomes this limitation by providing a powerful facility to establish logical links among multiple <span class="No-Break" lang="">Moodle sites.</span></p>
<p lang="en-GB">Moodle Docs contains a very well-written page on <a id="_idIndexMarker1689"/>MNet, and this chapter follows the document in <span class="No-Break" lang="">part: </span><a href="http://docs.moodle.org/en/MNet"><span class="No-Break" lang="">docs.moodle.org/en/MNet</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">The following two <a id="_idIndexMarker1690"/>networking topologies <span class="No-Break" lang="">are supported:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Peer-to-peer</strong>: This <a id="_idIndexMarker1691"/>layout connects two Moodle systems directly. This <a id="_idIndexMarker1692"/>topology is favorable if you have two partnering organizations or one site that offers courses in which students from another site wish <span class="No-Break" lang="">to enrol.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Moodle hub</strong>: A hub is a <a id="_idIndexMarker1693"/>Moodle server (known as the <strong class="bold" lang="">MNet hub</strong>) that’s been <a id="_idIndexMarker1694"/>configured to accept connections from other Moodle servers and provide services to users of these remote servers. This topology is favorable if you have a portal for sharing learning resources <span class="No-Break" lang="">or courses.</span></li>
</ul>
<p lang="en-GB">The two topologies are not mutually exclusive and can be mixed in the same network, as visualized in the following diagram. All participating Moodle instances connect to a central hub, and the two Moodle systems on the left have established a <span class="No-Break" lang="">peer-to-peer connection:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer466">
<img alt="Figure 19.1 – Moodle networking topologies " height="803" src="image/Figure_19.01_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.1 – Moodle networking topologies</p>
<p lang="en-GB">MNet<a id="_idIndexMarker1695"/> supports <strong class="bold" lang="">single sign-on</strong> (<strong class="bold" lang="">SSO</strong>), which provides seamless integration of multiple Moodle systems. Security is guaranteed by fully encrypting authentication and <span class="No-Break" lang="">content exchanges.</span></p>
<p class="callout-heading" lang="en-GB">Information</p>
<p class="callout" lang="en-GB"><strong class="bold" lang="">MNet</strong> has been designed for Moodle-Moodle pairing. The plan is to replace MNet in the future with OAuth2 (for authentication) and web services (for communication and <span class="No-Break" lang="">data exchange).</span></p>
<p lang="en-GB">Now that we’ve covered some networking prerequisites and security issues, let’s learn how to set up peer-to-peer networks and an <span class="No-Break" lang="">MNet hub.</span></p>
<h1 id="_idParaDest-346" lang="en-GB"><a id="_idTextAnchor347"/>Configuring Moodle networking prerequisites</h1>
<p lang="en-GB">MNet requires three<a id="_idIndexMarker1696"/> additional components to be installed on all participating servers that deal with secure communication and safe <span class="No-Break" lang="">data exchange.</span></p>
<h2 id="_idParaDest-347" lang="en-GB"><a id="_idTextAnchor348"/>Checking the required PHP extensions</h2>
<p lang="en-GB">The following elements <a id="_idIndexMarker1697"/>must be installed on all Moodle servers participating in <span class="No-Break" lang="">the network:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">curl</strong>: A <a id="_idIndexMarker1698"/>PHP library of calls designed to safely fetch data from remote sites. If not installed, you must recompile PHP and add <strong class="source-inline" lang="">--with curl</strong> when <span class="No-Break" lang="">running </span><span class="No-Break" lang=""><strong class="source-inline" lang="">configure</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB"><strong class="bold" lang="">openssl</strong>: The OpenSSL<a id="_idIndexMarker1699"/> PHP library provides encryption functionality without the need to purchase an SSL certificate (<strong class="source-inline" lang="">--</strong><span class="No-Break" lang=""><strong class="source-inline" lang="">with openssl</strong></span><span class="No-Break" lang="">).</span></li>
<li lang="en-GB"><strong class="bold" lang="">xmlrpc</strong>: A <a id="_idIndexMarker1700"/>PHP library that supports remote procedure calls via XML (<strong class="source-inline" lang="">--</strong><span class="No-Break" lang=""><strong class="source-inline" lang="">with xmlrpc</strong></span><span class="No-Break" lang="">).</span></li>
</ul>
<p lang="en-GB">It is possible to add trusted hosts to Moodle, which allows them to execute calls via XML-RPC to any part of the Moodle API. Trusted hosts are potentially very dangerous and are only meant for developers; we will not be dealing with this <span class="No-Break" lang="">functionality here:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer467">
<img alt="Figure 19.2 – Moodle networking prerequisites " height="186" src="image/Figure_19.02_B18779.jpg" width="987"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.2 – Moodle networking prerequisites</p>
<p lang="en-GB">To check that the <a id="_idIndexMarker1701"/>required PHP extensions have been installed, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Environment</strong> and ensure the status for all three components <span class="No-Break" lang="">is </span><span class="No-Break" lang=""><strong class="bold" lang="">OK</strong></span><span class="No-Break" lang="">.</span></p>
<h2 id="_idParaDest-348" lang="en-GB"><a id="_idTextAnchor349"/>Enabling Moodle networking</h2>
<p lang="en-GB">The aforementioned<a id="_idIndexMarker1702"/> PHP extensions ensure secure communication and that data is safely transmitted between participating sites. Moodle will generate a certificate to encrypt the communication, which is done via PHP using the certificate <span class="No-Break" lang="">mentioned earlier.</span></p>
<p lang="en-GB">Once networking has been enabled, Moodle generates a public/private key pair using OpenSSL. When you later connect to another Moodle site (which also has a set of keys), the public key is exchanged, and you will have to confirm that your site will trust this public key. When the two sites exchange data, the sender will sign each request using their private key and encrypt the message with the recipient’s public key. The receiver, who is the holder of the sender’s public key and its private key, will be able to decrypt the message and execute the request. So much for the theory. Now, back to the <span class="No-Break" lang="">real world.</span></p>
<p lang="en-GB">To activate Mnet, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Advanced features</strong> and turn on <strong class="bold" lang="">Networking</strong>, which will add the <strong class="bold" lang="">Networking</strong> menu to the site admin menu. This step has to be performed on all participating servers in the <span class="No-Break" lang="">Moodle network.</span></p>
<p lang="en-GB">Go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">Settings</strong>, where you will see the public key created <span class="No-Break" lang="">by OpenSSL:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer468">
<img alt="Figure 19.3 – Moodle networking public key " height="1056" src="image/Figure_19.03_B18779.jpg" width="1206"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.3 – Moodle networking public key</p>
<p lang="en-GB">The key has an <a id="_idIndexMarker1703"/>expiry date that is 28 days from creation; after this, a new key is created (<strong class="bold" lang="">key rotation</strong>). The key can be renewed manually by using the <strong class="bold" lang="">Delete</strong> option on the <span class="No-Break" lang="">same screen.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">The key expiry duration cannot be changed via a Moodle parameter; however, it can be changed via a configuration setting (see the <em class="italic" lang="">Appendix</em>, <em class="italic" lang="">Configuration Settings</em>). Add <strong class="source-inline" lang="">$CFG-&gt;mnetkeylifetime=365</strong> to <strong class="source-inline" lang="">config.php</strong> to increase the expiry period to a full year to avoid regularly having to <span class="No-Break" lang="">renew keys.</span></p>
<p lang="en-GB">Now that MNet has been enabled and the public key has been generated, it is time to get the servers talking to <span class="No-Break" lang="">each other.</span></p>
<h1 id="_idParaDest-349" lang="en-GB"><a id="_idTextAnchor350"/>Setting up peer-to-peer networks</h1>
<p lang="en-GB">This section deals with<a id="_idIndexMarker1704"/> peer-to-peer networks, where two Moodle <a id="_idIndexMarker1705"/>servers <span class="No-Break" lang="">are connected.</span></p>
<p lang="en-GB">For demonstration purposes, we have set up two local sites (two peers); one is located at <strong class="source-inline" lang="">localhost:8<a id="_idTextAnchor351"/>888/one</strong> and the other is located <span class="No-Break" lang="">at </span><span class="No-Break" lang=""><strong class="source-inline" lang="">localhost:8888/two</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">The two sites do not have to be in the same domain or organization. For example, two universities or two high schools might want to offer a collaborative course. They both have their own Moodle system in their domain, and they both control who gets access to which part of <span class="No-Break" lang="">their site.</span></p>
<p lang="en-GB">If your two sites are hosted in the same top-level domain, and you are accessing both sites from the same web browser simultaneously, change the cookie prefix of one site (<strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Session handling</strong>) to avoid <span class="No-Break" lang="">any conflicts.</span></p>
<h2 id="_idParaDest-350" lang="en-GB"><a id="_idTextAnchor352"/>Adding network peers</h2>
<p lang="en-GB">Go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">Manage peers</strong> and add a new remote host you want to<a id="_idIndexMarker1706"/> connect to. We are currently working on <strong class="source-inline" lang="">localhost:8888/one</strong>; to establish a link to the remote server, we have to enter <strong class="source-inline" lang="">localhost:8888/two</strong>. Then, perform the equivalent step on the <span class="No-Break" lang="">other host:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer469">
<img alt="Figure 19.4 – Adding a peer I " height="372" src="image/Figure_19.04_B18779.jpg" width="1042"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.4 – Adding a peer I</p>
<p lang="en-GB">The pull-down menu offers an additional <strong class="bold" lang="">Application type</strong>: <strong class="bold" lang="">mahara</strong>. We won’t cover the integration with Mahara here and leave this setting <span class="No-Break" lang="">as-is (</span><span class="No-Break" lang=""><strong class="bold" lang="">moodle</strong></span><span class="No-Break" lang="">).</span></p>
<p class="callout-heading" lang="en-GB">Information</p>
<p class="callout" lang="en-GB">Mahara is an open source ePortfolio system that can be integrated via MNet. The integration between Moodle and Mahara has been affectionately named <strong class="bold" lang="">Mahoodle</strong>, which has been documented<a id="_idIndexMarker1707"/> in great detail <span class="No-Break" lang="">at </span><a href="http://wiki.mahara.org/wiki/System_Administrator%E2%80%99s_Guide/Moodle//Mahara_Integration"><span class="No-Break" lang="">wiki.mahara.org/wiki/System_Administrator’s_Guide/Moodle//Mahara_Integration</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once the <a id="_idIndexMarker1708"/>host has been added, the <strong class="bold" lang="">Site</strong>, <strong class="bold" lang="">Hostname</strong>, and <strong class="bold" lang="">Public key</strong> details are retrieved automatically. The <strong class="bold" lang="">SSL verification</strong> parameter determines the level of security; it is recommended to leave this at its default value of <strong class="bold" lang="">Verify host and peer</strong>. Optionally, select <strong class="bold" lang="">Force theme</strong> that will be used <span class="No-Break" lang="">when roaming:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer470">
<img alt="Figure 19.5 – Adding a peer II " height="583" src="image/Figure_19.05_B18779.jpg" width="1153"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.5 – Adding a peer II</p>
<p lang="en-GB">Once the peer details have been saved, certificate details of the remote server are displayed. You will also see the following three tabs at the top of <span class="No-Break" lang="">the screen:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Review host details</strong>: We just dealt with the details of the peer connection. You can always return to this screen by selecting the respective host under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Peers</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Services</strong>: Peer services define what SSO is enabled between <span class="No-Break" lang="">the sites.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Profile fields</strong>: This <a id="_idIndexMarker1709"/>determines which fields are populated when users roam from the local to the <span class="No-Break" lang="">remote site.</span></li>
</ul>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Deleted peers are kept on the system and can be reactivated when you attempt to add a new host with the <span class="No-Break" lang="">same address.</span></p>
<p lang="en-GB">Now that the two sites are talking to each other, let’s start configuring user roaming by configuring the <span class="No-Break" lang="">peer services.</span></p>
<h3 lang="en-GB">Configuring peer services</h3>
<p lang="en-GB">The SSO supported by <a id="_idIndexMarker1710"/>MNet avoids the need to log in when roaming to a remote site. The <strong class="bold" lang="">Services</strong> tab contains four areas. We will focus on the last two, which deal with SSO; the enrolment and portfolio services will be dealt <span class="No-Break" lang="">with later.</span></p>
<p lang="en-GB">Two SSO services represent a two-way process, and both services must be set up on both Moodle sites by the <span class="No-Break" lang="">respective administrators.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Peer services can be published and <span class="No-Break" lang="">subscribed to.</span></p>
<p lang="en-GB">It is important to note that the local administrator fully controls publication and subscription. The administrator of the <em class="italic" lang="">other</em> site will never be able to modify any of those settings on <span class="No-Break" lang=""><em class="italic" lang="">your</em></span><span class="No-Break" lang=""> site.</span></p>
<p lang="en-GB">You must publish the identity provider service to allow your users to roam to the other site without having to log in again. Subscribe to the identity provider service to allow authenticated users from the other site to access your site without having to log <span class="No-Break" lang="">in again.</span></p>
<p lang="en-GB">You must publish the service provider service to allow authenticated users from the other site to access your site without having to log in again. Subscribe to the service provider service to allow your users to roam to the other site without having to log in <span class="No-Break" lang="">again there:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer471">
<img alt="Figure 19.6 – Peer services " height="263" src="image/Figure_19.06_B18779.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.6 – Peer services</p>
<p lang="en-GB">Let’s look at an<a id="_idIndexMarker1711"/> example of two collaborating universities. University A will publish the identity provider, while University B will subscribe to it. Students from University A can now access restricted areas at University B’s site without having to log <span class="No-Break" lang="">in again.</span></p>
<p lang="en-GB">Each service has a reciprocal dependency on the other server, as shown in the preceding table. For example, the subscribed SSO (Service Provider) on the local site requires the SSO (Service Provider) to be published on the remote site. To allow roaming in both directions, all four boxes on both peers in your Moodle network have to be checked by the <span class="No-Break" lang="">respective administrator.</span></p>
<h3 lang="en-GB">Configuring profile fields</h3>
<p lang="en-GB">When a user from<a id="_idIndexMarker1712"/> one site roams to another site for the first time, a local user account is created, and specific profile fields are populated by fetching the data from the remote site. You can override the default fields by selecting any of the shown profile fields in the provided list. This setting exists for <strong class="bold" lang="">Fields to import</strong> (users who roam from a remote site to the local site) and <strong class="bold" lang="">Fields to export</strong> (<span class="No-Break" lang="">vice versa):</span></p>
<div>
<div class="IMG---Figure" id="_idContainer472">
<img alt="Figure 19.7 – Profile fields " height="839" src="image/Figure_19.07_B18779.jpg" width="1204"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.7 – Profile fields</p>
<p lang="en-GB">The default fields can be changed under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">Profile fields</strong>. Fields included in your import list but excluded from the remote site’s export list will <span class="No-Break" lang="">be ignored.</span></p>
<p lang="en-GB">Bear in <a id="_idIndexMarker1713"/>mind that no password will be stored on the remote server. As the authentication mechanism will be set to <strong class="bold" lang="">MNet authentication</strong>, Moodle checks the credentials every time a user logs in. We will deal with <span class="No-Break" lang="">authentication next.</span></p>
<h2 id="_idParaDest-351" lang="en-GB"><a id="_idTextAnchor353"/>Enabling MNet authentication</h2>
<p lang="en-GB">To initiate <a id="_idIndexMarker1714"/>roaming, you must enable the Moodle network authentication plugin on both sites. Go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Authentication</strong> | <strong class="bold" lang="">Manage authentication</strong> and enable the <strong class="bold" lang="">MNet authentication</strong> option. Every time a new user from a remote site logs into this site, a user account is <span class="No-Break" lang="">created automatically.</span></p>
<p lang="en-GB">When you select the <strong class="bold" lang="">Test connection</strong> link beside the authentication plugin, you will see a list of which hosts that users are allowed to roam to your site and which local users are allowed to <span class="No-Break" lang="">roam out:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer473">
<img alt="Figure 19.8 – MNet authentication " height="478" src="image/Figure_19.08_B18779.jpg" width="1211"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.8 – MNet authentication</p>
<p lang="en-GB">Only change <a id="_idIndexMarker1715"/>the <strong class="bold" lang="">RPC negotiation timeout</strong> parameter on the <strong class="bold" lang="">Settings</strong> screen if users experience intermittent timeout problems when roaming from one site <span class="No-Break" lang="">to another.</span></p>
<h2 id="_idParaDest-352" lang="en-GB"><a id="_idTextAnchor354"/>Allowing roaming</h2>
<p lang="en-GB">Only users<a id="_idIndexMarker1716"/> that have been assigned a role with the <strong class="source-inline" lang="">moodle/site:mnetlogintoremote</strong> capability are allowed to roam to other sites. By default, this <strong class="source-inline" lang="">Roam to a remote Moodle</strong> capability is turned off and has to be allowed for each role. Revisit <a href="B18779_06.xhtml#_idTextAnchor116"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 6</em></span></a>, <em class="italic" lang="">Managing Permissions, Roles, and Capabilities</em>, for details on how to <span class="No-Break" lang="">do this.</span></p>
<p lang="en-GB">To turn on roaming for all users logged into your site, allow the capability in the <strong class="bold" lang="">Authenticated user</strong> role. Unless all users are allowed to roam, it is worth considering creating a separate roaming role. Alternatively, if you wish to grant (or deny) access to individual users from a remote host, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">SSO access control</strong>. You have to specify a username, a remote host (the <strong class="bold" lang="">All hosts</strong> option is only relevant for the community hub mode, which will be discussed later), and the access level (<strong class="bold" lang="">Allow</strong> <span class="No-Break" lang="">or </span><span class="No-Break" lang=""><strong class="bold" lang="">Deny</strong></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">The newly added username does not have to exist on either Moodle site! The remote hub ID is displayed in the list of users, which is the internal ID. This is similar to a user ID, group ID, or <span class="No-Break" lang="">role ID:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer474">
<img alt="Figure 19.9 – Allowing roaming " height="446" src="image/Figure_19.09_B18779.jpg" width="1223"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.9 – Allowing roaming</p>
<p lang="en-GB">Network users can<a id="_idIndexMarker1717"/> also be assigned via CSV batch upload, which we described in detail in <a href="B18779_05.xhtml#_idTextAnchor092"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 5</em></span></a>, <em class="italic" lang="">Managing Users, Cohorts, and Authentication</em>; the relevant field in the CSV file <span class="No-Break" lang="">is </span><span class="No-Break" lang=""><strong class="source-inline" lang="">mnethostid</strong></span><span class="No-Break" lang="">.</span></p>
<h2 id="_idParaDest-353" lang="en-GB"><a id="_idTextAnchor355"/>Adding the Network servers block</h2>
<p lang="en-GB">Moodle<a id="_idIndexMarker1718"/> provides a <strong class="bold" lang="">Network servers</strong> block, which can be added to the home page. This block cannot be configured and is only displayed if the role of the logged-in user has the <strong class="source-inline" lang="">moodle/site:mnetlogintoremote</strong> capability mentioned previously set <span class="No-Break" lang="">to </span><span class="No-Break" lang=""><strong class="bold" lang="">Allow</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer475">
<img alt="Figure 19.10 – Network servers block " height="476" src="image/Figure_19.10_B18779.jpg" width="1167"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.10 – Network servers block</p>
<p lang="en-GB">The block acts as a launch pad from which to access remote sites. Here, in addition to our Moodle peer, we have also set up a link to a Mahara instance. Once you click on the remote server, you will be redirected to the selected site, where you can enroll in <span class="No-Break" lang="">remote courses.</span></p>
<p lang="en-GB">With that, your first peer-to-peer network has been <span class="No-Break" lang="">set up!</span></p>
<p lang="en-GB">Moodle<a id="_idIndexMarker1719"/> shows the host you logged in from above the user icon, similar to when you masquerade as another user. When you click on your name, you access the profile of the newly created user on the remote server, which cannot be changed. The <strong class="bold" lang="">Remote Moodle user – Profile fetched from &lt;peer&gt;</strong> message will <span class="No-Break" lang="">be displayed.</span></p>
<p lang="en-GB">If you want to deny a remote user access – for example, because of misconduct – go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Users</strong> | <strong class="bold" lang="">Accounts</strong> | <strong class="bold" lang="">Browse list of users</strong>; you will see that an additional column has been added to the list of users. Remote users cannot be edited locally; only the site they have logged in from is displayed. In the right-hand column, you can select <strong class="bold" lang="">Deny access</strong> to revoke access to the site. To reverse the operation, select <span class="No-Break" lang=""><strong class="bold" lang="">Allow access</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer476">
<img alt="Figure 19.11 – Remote users " height="190" src="image/Figure_19.11_B18779.jpg" width="1228"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.11 – Remote users</p>
<p lang="en-GB">The <strong class="bold" lang="">Network servers</strong> block adds the final compulsory piece to the Moodle networking puzzle: hosts <a id="_idIndexMarker1720"/>can talk to each other, and users can roam to remote sites. There is one more goodie in Moodle’s networking bag known as remote enrolment, which we will cover in the <span class="No-Break" lang="">following subsection.</span></p>
<h2 id="_idParaDest-354" lang="en-GB"><a id="_idTextAnchor356"/>Configuring network enrolment</h2>
<p lang="en-GB">This last step is <a id="_idIndexMarker1721"/>optional and only required if you wish to grant an administrator in one Moodle system permission to enrol local users in remote courses and vice versa. Remote enrolment is helpful if you run a shared course on your server, but learners from the remote site should be participants. To minimize the administrative effort at your end, you can grant the remote administrator the right to take on this task, which is limited to the courses you <span class="No-Break" lang="">have specified.</span></p>
<p lang="en-GB">First, on the local site (that is, the one that grants the rights to the remote site), go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Enrolments</strong> and enable the <strong class="bold" lang="">MNet remote enrolments</strong> plugin, which allows the local server to receive enrolments from its remote counterpart. You can change the default role (<strong class="bold" lang="">Student</strong>) for MNet enrolments on the <span class="No-Break" lang=""><strong class="bold" lang="">Settings</strong></span><span class="No-Break" lang=""> screen.</span></p>
<p lang="en-GB">Now, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">Peers</strong>, select the remote host, and click on the <strong class="bold" lang="">Services</strong> tab. <strong class="bold" lang="">Publish</strong> and <strong class="bold" lang="">Subscribe</strong> to <strong class="bold" lang="">Remote enrolment service</strong>, which grants remote administrators the right to enrol students on your site and allows local students to enrol in courses on the remote site, respectively. This step has to be repeated on <span class="No-Break" lang="">the peer.</span></p>
<p lang="en-GB">Both Moodle sites have now been configured to allow communication between the two servers, and courses have been set up to enrol remote students. Ensure you activate the <strong class="bold" lang="">MNet enrolment</strong> method inside your course (see <a href="B18779_04.xhtml#_idTextAnchor074"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 4</em></span></a>, <em class="italic" lang="">Managing Courses and Enrolments</em>, <span class="No-Break" lang="">for details).</span></p>
<p lang="en-GB">When you go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">Remote enrolments client</strong>, you will see a list of remote hosts where local users are enrolled. When you click on a host, courses offered for remote enrolment are displayed. You can then edit the enrolments, just like how you manage users in a <span class="No-Break" lang="">local course:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer477">
<img alt="Figure 19.12 – Remote enrolments " height="776" src="image/Figure_19.12_B18779.jpg" width="1219"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.12 – Remote enrolments</p>
<p lang="en-GB">This <a id="_idIndexMarker1722"/>concludes this long section on setting up peer-to-peer connections between Moodle hosts. Next, we will look at another supported networking topology: <span class="No-Break" lang="">Moodle hubs.</span></p>
<h1 id="_idParaDest-355" lang="en-GB"><a id="_idTextAnchor357"/>Setting up a Moodle hub</h1>
<p lang="en-GB">A Moodle or<a id="_idIndexMarker1723"/> MNet hub is<a id="_idIndexMarker1724"/> similar to a peer-to-peer network, with the only difference being that it accepts connections from multiple Moodle (and Mahara) servers. While this could be set up manually using several peer-to-peer connections, hub mode automatically accepts any hosts that try to connect to it. Potentially, this is a big time and maintenance saver, but at the cost of opening up your site to other <span class="No-Break" lang="">Moodle instances.</span></p>
<p lang="en-GB">A public learning portal with resources to be shared across many sites is typically implemented using hub mode. Each Moodle instance that wishes to access the portal must be configured to connect to <span class="No-Break" lang="">the hub.</span></p>
<p lang="en-GB">Once networking has been turned on, choose the Moodle site that will act as a hub and go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Networking</strong> | <strong class="bold" lang="">Manage peers</strong> to turn on <strong class="bold" lang="">Register all hosts</strong> (promiscuous mode). Effectively, a hub is a regular Moodle site that operates in a <span class="No-Break" lang="">special mode.</span></p>
<p lang="en-GB">All hosts are treated like peer-to-peer sites, except the <strong class="bold" lang="">Review host details</strong> tab is empty. All the other settings are identical to the peer-to-peer parameters. You might decide that traffic (that is, authentication and enrolment) should only go one way: from the different Moodle sites to the hub. You can control this using the <strong class="bold" lang="">SSO-Publish</strong> and <strong class="bold" lang="">SSO-Subscribe</strong> options under the <span class="No-Break" lang=""><strong class="bold" lang="">Services</strong></span><span class="No-Break" lang=""> tab:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer478">
<img alt="Figure 19.13 – Moodle hub versus connecting peers " height="119" src="image/Figure_19.13_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.13 – Moodle hub versus connecting peers</p>
<p lang="en-GB">The primary <a id="_idIndexMarker1725"/>use case for setting up an MNet hub is a portal to share<a id="_idIndexMarker1726"/> resources across sites. A more contemporary alternative to MNet is MoodleNet, which we will cover in the <span class="No-Break" lang="">following section.</span></p>
<h1 id="_idParaDest-356" lang="en-GB"><a id="_idTextAnchor358"/>Enabling MoodleNet</h1>
<p lang="en-GB">MoodleNet is <a id="_idIndexMarker1727"/>Moodle’s open social media platform for educators that focuses on sharing openly licensed learning resources. MoodleNet forms an integral part of the Moodle ecosystem and can be reached from within Moodle or directly <span class="No-Break" lang="">via </span><a href="http://moodle.net"><span class="No-Break" lang="">moodle.net</span></a><span class="No-Break" lang="">.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">MoodleNet aims to find, share, and curate open <span class="No-Break" lang="">educational resources.</span></p>
<p lang="en-GB">While the platform is targeted at teachers and content creators, you, as an administrator, must enable your colleagues to share (appropriate and legal) resources internally and with <span class="No-Break" lang="">peers worldwide.</span></p>
<p lang="en-GB">The workflow of MoodleNet’s integration is illustrated in the <span class="No-Break" lang="">following diagram:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer479">
<img alt="Figure 19.14 – MoodleNet integration " height="1131" src="image/Figure_19.14_B18779.jpg" width="867"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.14 – MoodleNet integration</p>
<p lang="en-GB">Let’s assume<a id="_idIndexMarker1728"/> you are a course creator who has started developing a module about a particular topic. From within the course (via the activity chooser), MoodleNet is called, and resources are browsed. When an element (from a simple learning nugget to an entire curriculum) is chosen, Moodle’s standard restore process is utilized to import the resources into your course. These steps can be repeated multiple times and support effective <span class="No-Break" lang="">content curation.</span></p>
<p lang="en-GB">The MoodleNet connection is turned on by default, so ensure that the <strong class="bold" lang="">Enable MoodleNet integration</strong> option under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Advanced settings</strong> <span class="No-Break" lang="">is ticked.</span></p>
<p lang="en-GB">Users who have <a id="_idIndexMarker1729"/>permission to create or manage activities can browse the public catalog at <a href="http://moodle.net">moodle.net</a> from the activity chooser and import resources into their courses. Ensure that the <strong class="bold" lang="">MoodleNet</strong> option has been selected under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Course</strong> | <strong class="bold" lang="">Activity chooser | Activity chooser settings</strong> for the link to appear at the bottom of the <span class="No-Break" lang="">activity chooser:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer480">
<img alt="Figure 19.15 – MoodleNet configuration " height="621" src="image/Figure_19.15_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.15 – MoodleNet configuration</p>
<p lang="en-GB">If you wish to change the name of the MoodleNet instance that’s been made available to your users, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">MoodleNet</strong> | <strong class="bold" lang="">MoodleNet settings</strong>, where you will see two parameters, <strong class="bold" lang="">MoodleNet instance name</strong> and <strong class="bold" lang="">MoodleNet URL</strong>. Only change the latter option if you are running your own instance or wish to connect to an alternative <span class="No-Break" lang="">MoodleNet system.</span></p>
<p lang="en-GB">Moodle lets you deploy your own secure and scalable MoodleNet instance. MoodleNet has been developed using Node.js and ArrangoDB. You find details on how to set up a local instance <span class="No-Break" lang="">at </span><a href="mailto:www.npmjs.com/package/@moodlenet/ce-platform"><span class="No-Break" lang="">www.npmjs.com/package/@moodlenet/ce-platform</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">The integration between Moodle and MoodleNet is planned to be enhanced in the future. The key feature to be looking forward to is the ability for educators to share activities to<a id="_idIndexMarker1730"/> MoodleNet easily. Check the release notes for upcoming versions to find out what administrative tasks will be available for you to configure this <span class="No-Break" lang="">upcoming feature.</span></p>
<p lang="en-GB">This concludes this section on the administrative aspects of enabling your teachers and content creators to share resources <span class="No-Break" lang="">via MoodleNet.</span></p>
<h1 id="_idParaDest-357" lang="en-GB"><a id="_idTextAnchor359"/>Summary</h1>
<p lang="en-GB">In this chapter, you learned how to network disparate Moodle systems. The setup process required several steps, summarized in the <span class="No-Break" lang="">following checklist:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer481">
<img alt="Figure 19.16 – MoodleNet checklist " height="700" src="image/Figure_19.16_B18779.jpg" width="1211"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.16 – MoodleNet checklist</p>
<p lang="en-GB">After providing an overview of MNet, we covered the required components and how networking <span class="No-Break" lang="">is enabled.</span></p>
<p lang="en-GB">We linked two Moodle sites, which entailed setting up peer-to-peer connections, roaming across instances, configuring remote authentication and enrolment, and using the Networks <span class="No-Break" lang="">server block.</span></p>
<p lang="en-GB">Then, we introduced the concept of a central MNet hub to connect multiple <span class="No-Break" lang="">Moodle sites.</span></p>
<p lang="en-GB">Finally, we enabled MoodleNet, a platform for finding, sharing, and curating open <span class="No-Break" lang="">educational resources.</span></p>
<p lang="en-GB">Moodle’s networking facility introduces a new dimension to learning management systems. Disparate systems can be connected logically, and roaming from one Moodle site to another can be facilitated. Networking Moodle hosts opens up entirely new opportunities, whether among entities within your organization or with <span class="No-Break" lang="">external sites.</span></p>
<p lang="en-GB">Another setting in which multiple entities are represented is multi-tenancy, which is the topic of the final chapter of <span class="No-Break" lang="">this book.</span></p>
</div>
</div></body></html>