<html><head></head><body>
<div id="_idContainer094">
<h1 class="chapter-number" id="_idParaDest-93"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-94"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.2.1">Applying Behavior-Driven Development</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the previous chapter, we learned how to create and use unit tests to our advantage. </span><span class="koboSpan" id="kobo.3.2">We used unit tests and integration tests to help ensure the stability of our solution code. </span><span class="koboSpan" id="kobo.3.3">That was probably like learning how to do a basic punch on a punching bag. </span><span class="koboSpan" id="kobo.3.4">If you go to a boxing class, they’ll probably teach you how to use your basic punch more effectively and teach you how to use that basic punch to do combinations of punches, as well as how to defend against them. </span><span class="koboSpan" id="kobo.3.5">That’s akin to what </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">behavior-driven development</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">BDD</span></strong><span class="koboSpan" id="kobo.7.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">test-driven development</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">TDD</span></strong><span class="koboSpan" id="kobo.11.1">) are. </span><span class="koboSpan" id="kobo.11.2">We first need to start with the basics: unit and integration testing. </span><span class="koboSpan" id="kobo.11.3">Now that we have those basics, we can start applying processes or techniques so that we can use them more effectively. </span></p>
<p><span class="koboSpan" id="kobo.12.1">A lot of developers know how to write unit tests and integration tests—after all, these tests are just programs that we developers write. </span><span class="koboSpan" id="kobo.12.2">From my personal experience, what I’ve noticed is that a lot of developers won’t know how to utilize their unit tests and integration tests effectively on their projects. </span><span class="koboSpan" id="kobo.12.3">Some developers know how to write unit tests but could not even write one for their project. </span><span class="koboSpan" id="kobo.12.4">So, merely having basic or technical knowledge of how to write a unit test is not enough to help improve a project. </span><span class="koboSpan" id="kobo.12.5">Applying and using it effectively is </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">what counts.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">With BDD and TDD, that’s what we’ll try to do. </span><span class="koboSpan" id="kobo.14.2">We will utilize those testing skills by following a process to help us build our </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">example project.</span></span></p>
<p><span class="koboSpan" id="kobo.16.1">In this chapter, we will go through the </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.18.1">What </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">is BDD?</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">Applying BDD using Behat </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">and Gherkin</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Writing PHP code based </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">on Gherkin</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Browser emulators </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">and Mink</span></span></li>
<li><span class="koboSpan" id="kobo.26.1">Why bother with </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">Gherkin, then?</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.28.1">By the end of the chapter, you will be able to write behavior-driven features, scenarios, and solution code. </span></p>
<h1 id="_idParaDest-95"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.29.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.30.1">This chapter requires you to have all the containers, configurations, and testing tools we have utilized in </span><a href="B18318_05.xhtml#_idTextAnchor070"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.31.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.32.1">, </span><em class="italic"><span class="koboSpan" id="kobo.33.1">Unit Testing</span></em><span class="koboSpan" id="kobo.34.1">. </span><span class="koboSpan" id="kobo.34.2">You can download the source files from this URL and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">containers: </span></span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%205"><span class="No-Break"><span class="koboSpan" id="kobo.36.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%205</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.37.1">.</span></span></p>
<h2 id="_idParaDest-96"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.38.1">Preparing the development environment for the chapter</span></h2>
<p><span class="koboSpan" id="kobo.39.1">First, get the base code for </span><a href="B18318_06.xhtml#_idTextAnchor094"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.40.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.41.1">, found in </span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%206/base/phptdd"><span class="koboSpan" id="kobo.42.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%206/base/phptdd</span></a><span class="koboSpan" id="kobo.43.1"> or simply run the </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.45.1">
curl -Lo phptdd.zip "https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/raw/main/Chapter%206/base.zip" &amp;&amp; unzip -o phptdd.zip &amp;&amp; cd base &amp;&amp; ./demoSetup.sh</span></pre>
<p><span class="koboSpan" id="kobo.46.1">To run the containers and execute the commands in this chapter, you should be inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">docker-server-web-1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.48.1"> container.</span></span></p>
<p><span class="koboSpan" id="kobo.49.1">Run the following command to confirm the container name for our </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">web server:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.51.1">
docker ps</span></pre>
<p><span class="koboSpan" id="kobo.52.1">To run the containers, run the following command from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">/phptdd/docker</span></strong><span class="koboSpan" id="kobo.54.1"> directory from the repository in your </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">host machine:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.56.1">
docker-compose build &amp;&amp; docker-compose up -d
docker exec -it docker_server-web_1 /bin/bash</span></pre>
<p><span class="koboSpan" id="kobo.57.1">Once inside the container, run the following command to install the libraries required </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">through Composer:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.59.1">
/var/www/html/symfony# ./setup.sh</span></pre>
<h1 id="_idParaDest-97"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.60.1">What is BDD?</span></h1>
<p><span class="koboSpan" id="kobo.61.1">BDD is a way or a process</span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.62.1"> to develop software where the intended behavior of a solution is first defined by the business and then translated into automated test scenarios, before starting the actual development of the </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">solution code.</span></span></p>
<p><span class="koboSpan" id="kobo.64.1">This development process promotes collaboration among the different departments or teams in a software company. </span><span class="koboSpan" id="kobo.64.2">It might sound ridiculous, but in my experience, understanding exactly “what” needs to be built and what is the actual goal of the project is what I always see as the most elusive part when starting a project. </span></p>
<p><span class="koboSpan" id="kobo.65.1">There are times when the business or a client doesn’t even know what it wants, or maybe the business or client does not know how to express or relay those goals effectively. </span><span class="koboSpan" id="kobo.65.2">Now, imagine being a software developer for a company—your job is to develop solutions to problems to achieve a goal. </span><span class="koboSpan" id="kobo.65.3">What if that goal is not defined clearly? </span><span class="koboSpan" id="kobo.65.4">Or, what if the goal was defined by the business but not relayed properly to the software developers? </span><span class="koboSpan" id="kobo.65.5">Basically, the developers will end up developing the wrong solution and—worse—for the wrong problem! </span><span class="koboSpan" id="kobo.65.6">That’s why collaboration among different departments in a software company is very important. </span></p>
<p><span class="koboSpan" id="kobo.66.1">Business analysts, project</span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.67.1"> managers, architects, and developers can define what the goals are for a project, and why the project is needed in the first place. </span><span class="koboSpan" id="kobo.67.2">The test engineers and software developers can then coordinate, debate, and discuss with the business analysts to come up with expected or intended behaviors of a solution, then break them down into smaller pieces. </span><span class="koboSpan" id="kobo.67.3">This is the first step that’s needed in BDD: knowing exactly what the goal is, what needs to be built, and knowing which behaviors are expected from </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">a solution.</span></span></p>
<p><span class="koboSpan" id="kobo.69.1">Now that we know what BDD is, we can start applying it to our </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">example project.</span></span></p>
<h1 id="_idParaDest-98"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.71.1">Applying BDD using Behat and Gherkin</span></h1>
<p><span class="koboSpan" id="kobo.72.1">To help us easily</span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.73.1"> understand what BDD</span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.74.1"> is and how</span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.75.1"> it is used, we will try to apply</span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.76.1"> it to example scenarios in a project. </span></p>
<p><span class="koboSpan" id="kobo.77.1">Going back to </span><a href="B18318_02.xhtml#_idTextAnchor027"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.78.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.79.1">,</span><em class="italic"><span class="koboSpan" id="kobo.80.1"> Understanding and Organizing the Business Requirements of Our Project</span></em><span class="koboSpan" id="kobo.81.1">, we have created some Jira tickets to help us break down the features that we need to build. </span><span class="koboSpan" id="kobo.81.2">Within the </span><strong class="bold"><span class="koboSpan" id="kobo.82.1">Inventory Clerk Solution</span></strong><span class="koboSpan" id="kobo.83.1"> epic, we have created a user story with the following title: </span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.84.1">As an inventory clerk, I want to be able to log in to the system so that I can access the </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.85.1">inventory system.</span></em></span></p>
<p><span class="koboSpan" id="kobo.86.1">With this user story, we</span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.87.1"> can deduce that we will need</span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.88.1"> a user for the application</span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.89.1"> and that user will need</span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.90.1"> to be able to authenticate themself so that they can access a </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">restricted feature.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">So, usually, as software developers, we’ll then go ahead and start building the solution code for that– write code, then check the results from the controller or web page we just created. </span><span class="koboSpan" id="kobo.92.2">We won’t be </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">doing that.</span></span></p>
<p><span class="koboSpan" id="kobo.94.1">With BDD, we’ll first start with a failing scenario. </span><span class="koboSpan" id="kobo.94.2">Sounds familiar? </span><span class="koboSpan" id="kobo.94.3">Yes—from the previous chapter, it’s just like writing our failing unit test before we write the solution code to pass that </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">failing test.</span></span></p>
<p><span class="koboSpan" id="kobo.96.1">Before we start writing our BDD test, we’ll need to use some PHP packages to let us do this. </span><span class="koboSpan" id="kobo.96.2">We’ll use the Behat testing framework to help us build and organize our </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">BDD tests.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.98.1">What is Behat?</span></h2>
<p><span class="koboSpan" id="kobo.99.1">Behat is a PHP framework</span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.100.1"> built for implementing BDD in PHP. </span><span class="koboSpan" id="kobo.100.2">It’s a framework to help us PHP developers write behavior-driven tests and programs. </span><span class="koboSpan" id="kobo.100.3">This will help us write better behavior-driven programs quicker so that we won’t have to reinvent the wheel in coming up with bootstrap code or skeleton code to write these behavior-driven tests. </span><span class="koboSpan" id="kobo.100.4">Behat uses Gherkin to describe the actual features we want </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">to test.</span></span></p>
<h2 id="_idParaDest-100"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.102.1">What is Gherkin?</span></h2>
<p><span class="koboSpan" id="kobo.103.1">Gherkin is a language</span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.104.1"> used to define business scenarios and goals. </span><span class="koboSpan" id="kobo.104.2">It’s in plain English text, so anyone in the company—even non-technical staff—will be able to understand the business scenario being described. </span></p>
<h2 id="_idParaDest-101"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.105.1">What is Mink?</span></h2>
<p><span class="koboSpan" id="kobo.106.1">This is where</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.107.1"> it gets very interesting, at least for a PHP developer like me. </span><span class="koboSpan" id="kobo.107.2">Mink is a PHP library that will serve as an emulator for a web browser. </span><span class="koboSpan" id="kobo.107.3">We web application developers develop PHP applications; our users will be using our web applications through a web browser. </span><span class="koboSpan" id="kobo.107.4">So, it will be very beneficial for us if we automate the process of testing our application through a web browser. </span><span class="koboSpan" id="kobo.107.5">Instead of manually clicking on buttons or filling out forms, and so on, we can just use some programs to do this for us. </span><span class="koboSpan" id="kobo.107.6">So, think</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.108.1"> about a robot version of yourself testing your program for you through a </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">web browser.</span></span></p>
<p><span class="koboSpan" id="kobo.110.1">In the next section, we will be </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">installing Behat.</span></span></p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.112.1">Installing Behat and Mink</span></h2>
<p><span class="koboSpan" id="kobo.113.1">Before we start writing</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.114.1"> our first behavior-driven test programs, we’ll first need to install all the libraries and dependencies we need. </span><span class="koboSpan" id="kobo.114.2">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">get started:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.116.1">Create a new directory named </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">behat</span></strong><span class="koboSpan" id="kobo.118.1"> under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">codebase</span></strong><span class="koboSpan" id="kobo.120.1"> directory so that we can have a separate installation directory from our </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">Symfony application:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer083">
<span class="koboSpan" id="kobo.122.1"><img alt="Figure 6.1 – Behat root directory" src="image/Figure_6.01_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.123.1">Figure 6.1 – Behat root directory</span></p>
<p><span class="koboSpan" id="kobo.124.1">After creating the new directory, we can go ahead and start installing the Behat PHP package through Composer. </span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.125.1">Using your terminal, inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">behat</span></strong><span class="koboSpan" id="kobo.127.1"> directory, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.129.1">/var/www/html/behat# composer require --dev behat/behat</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.130.1">After the installation, you can verify whether Behat was successfully installed by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.132.1">/var/www/html/behat# ./vendor/bin/behat -V</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.133.1">Once done, you should then see the Behat version that you just installed: </span></p>
<div>
<div class="IMG---Figure" id="_idContainer084">
<span class="koboSpan" id="kobo.134.1"><img alt="Figure 6.2 – Behat installed" src="image/Figure_6.02_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.135.1">Figure 6.2 – Behat installed</span></p>
<p><span class="koboSpan" id="kobo.136.1">Now, we also need to install Mink</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.137.1"> so that we can do some frontend testing. </span></p>
<p><span class="koboSpan" id="kobo.138.1">Run the following command to </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">install Mink:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.140.1">
/var/www/html/behat# composer require --dev behat/mink-extension -W
/var/www/html/symfony# composer require --dev behat/mink-goutte-driver</span></pre>
<p><span class="koboSpan" id="kobo.141.1">Great! </span><span class="koboSpan" id="kobo.141.2">Now, we need to let Behat create some skeleton files to help us get started. </span><span class="koboSpan" id="kobo.141.3">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.143.1">
/var/www/html/behat# ./vendor/bin/behat --init</span></pre>
<p><span class="koboSpan" id="kobo.144.1">You should now see a new directory called </span><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">features</span></strong><span class="koboSpan" id="kobo.146.1">. </span><span class="koboSpan" id="kobo.146.2">This is where we will be putting our business </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">feature scenarios.</span></span></p>
<h3><span class="koboSpan" id="kobo.148.1">Creating a Behat feature</span></h3>
<p><span class="koboSpan" id="kobo.149.1">Now that we have installed Behat</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.150.1"> and initialized it, we can create our first example feature file. </span><span class="koboSpan" id="kobo.150.2">We will use the Gherkin language to define the feature’s story. </span><span class="koboSpan" id="kobo.150.3">It’s literally like telling a story. </span></p>
<p><span class="koboSpan" id="kobo.151.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">features</span></strong><span class="koboSpan" id="kobo.153.1"> directory, create a new file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">home.feature</span></strong><span class="koboSpan" id="kobo.155.1"> and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">following content:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.157.1">/var/www/html/behat/features/home.feature</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.158.1">
Feature: Home page
  In order to welcome visitors
  As a visitor
  I need to be able to see the Symfony logo 
  Scenario: See the Symfony logo
    Given I have access to the home page URL
    When I visit the home page
    Then I should see the Symfony Logo</span></pre>
<p><span class="koboSpan" id="kobo.159.1">We have created </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">feature</span></strong><span class="koboSpan" id="kobo.161.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">scenario</span></strong><span class="koboSpan" id="kobo.163.1"> files using the Gherkin</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.164.1"> language. </span><span class="koboSpan" id="kobo.164.2">They are descriptive and very easy to understand. </span><span class="koboSpan" id="kobo.164.3">You don’t need a programmer to understand what they mean. </span><span class="koboSpan" id="kobo.164.4">So, showing them to your colleagues such as business analysts or test engineers won’t be an issue; they’ll even be able to help you fine-tune or improve your features and scenarios. </span></p>
<p><span class="koboSpan" id="kobo.165.1">Next, we’ll focus on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">Feature</span></strong><span class="koboSpan" id="kobo.167.1"> keyword itself and </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">its content.</span></span></p>
<h4><span class="koboSpan" id="kobo.169.1">Feature keyword</span></h4>
<p><span class="koboSpan" id="kobo.170.1">As you can see in the preceding</span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.171.1"> code snippet, we have written three sections below the </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">Feature</span></strong><span class="koboSpan" id="kobo.173.1"> keyword. </span><span class="koboSpan" id="kobo.173.2">The three sections below it are set </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">out here:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">In order to</span></strong><span class="koboSpan" id="kobo.176.1"> &lt;</span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">business goal&gt;</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">As </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">a/an</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.180.1"> &lt;actor&gt;</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">I need to be able to</span></strong><span class="koboSpan" id="kobo.182.1"> &lt;what the actor defined previously should be able </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">to do&gt;</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.184.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">In order to</span></strong><span class="koboSpan" id="kobo.186.1"> section, we define what the business wants to achieve in this feature. </span><span class="koboSpan" id="kobo.186.2">In our example, we want our site visitors to feel welcomed when they land on our </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">home page.</span></span></p>
<p><span class="koboSpan" id="kobo.188.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">As a/an</span></strong><span class="koboSpan" id="kobo.190.1"> section, we define who is performing the action. </span><span class="koboSpan" id="kobo.190.2">In our example, this is the site visitor who is accessing the </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">home page.</span></span></p>
<p><span class="koboSpan" id="kobo.192.1">And lastly, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">I need to be able to</span></strong><span class="koboSpan" id="kobo.194.1"> section, we define what the actor should be able to do or achieve so that the business can achieve its end goal. </span><span class="koboSpan" id="kobo.194.2">In our example, we just want the actor or visitor to see the Symfony logo and the </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">welcome message.</span></span></p>
<p><span class="koboSpan" id="kobo.196.1">Next, as a part of a feature, we will need to add scenarios using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">Scenario</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.198.1"> keyword.</span></span></p>
<h4><span class="koboSpan" id="kobo.199.1">Scenario keyword</span></h4>
<p><span class="koboSpan" id="kobo.200.1">Inside a feature, we can have</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.201.1"> one or more scenarios. </span><span class="koboSpan" id="kobo.201.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">home.feature</span></strong><span class="koboSpan" id="kobo.203.1"> file we created, you’ll notice that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">Scenario</span></strong><span class="koboSpan" id="kobo.205.1"> tag is indented compared to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">Feature</span></strong><span class="koboSpan" id="kobo.207.1"> tag above it. </span><span class="koboSpan" id="kobo.207.2">A scenario is written in plain English; it is just a written outline of a sequence of events. </span><span class="koboSpan" id="kobo.207.3">In Gherkin, we will divide a scenario into three sections </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">as well:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">Given</span></strong><span class="koboSpan" id="kobo.210.1">: Used to declare the existing or current state or value of </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">the system</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">When</span></strong><span class="koboSpan" id="kobo.213.1">: Used to define verbs or actions performed on </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">the system</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">Then</span></strong><span class="koboSpan" id="kobo.216.1">: The expected result after performing the verbs or actions declared in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">When</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.218.1"> section</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.219.1">Now that we have defined both an example feature and scenario, let’s try to run Behat and see what we get. </span></p>
<p><span class="koboSpan" id="kobo.220.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.222.1">
/var/www/html/behat# ./vendor/bin/behat</span></pre>
<p><span class="koboSpan" id="kobo.223.1">You should then see the </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer085">
<span class="koboSpan" id="kobo.225.1"><img alt="Figure 6.3 – Missing snippets" src="image/Figure_6.03_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.226.1">Figure 6.3 – Missing snippets</span></p>
<p><span class="koboSpan" id="kobo.227.1">You’ll notice that Behat tried to look for some PHP code that represents the scenario we declared earlier, but we did not do that. </span><span class="koboSpan" id="kobo.227.2">So, that means that we also have to write some PHP code for Behat</span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.228.1"> to execute in relation to the actual </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">Given</span></strong><span class="koboSpan" id="kobo.230.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">When</span></strong><span class="koboSpan" id="kobo.232.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">Then</span></strong><span class="koboSpan" id="kobo.234.1"> definitions we </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">have created.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">Next, we’ll write the PHP code needed to support the features and scenarios we </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">just created.</span></span></p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.238.1">Writing PHP code based on Gherkin</span></h1>
<p><span class="koboSpan" id="kobo.239.1">We will need PHP programs</span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.240.1"> to represent the features and scenarios we created using Gherkin. </span><span class="koboSpan" id="kobo.240.2">The Behat framework will follow the features and scenarios we created in the previous section, but it will also look for PHP code that represents each feature and scenario. </span><span class="koboSpan" id="kobo.240.3">Within this PHP code, we can add any custom logic we want to interpret the features and scenarios into programs. </span><span class="koboSpan" id="kobo.240.4">Create the following files that the Behat framework needs to run our features </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">and scenarios:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.242.1">First, we need to create</span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.243.1"> a new context class. </span><span class="koboSpan" id="kobo.243.2">A context class is what Behat uses to represent Gherkin features into PHP programs.Create the following file with the </span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">content shown:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.245.1">codebase/behat/features/bootstrap/HomeContext.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.246.1">
&lt;?php
use Behat\Behat\Tester\Exception\PendingException;
class HomeContext implements \Behat\Behat\Context\Context
{
    
}</span></pre>
<ol>
<li value="2"><span class="koboSpan" id="kobo.247.1">Then, after creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">HomeContext.php</span></strong><span class="koboSpan" id="kobo.249.1"> class, we also need to tell Behat that we have a new context class. </span><span class="koboSpan" id="kobo.249.2">We can do this by creating a configuration file. </span><span class="koboSpan" id="kobo.249.3">Create the following file with the </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">content shown:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.251.1">codebase/behat/behat.yml</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.252.1">
default:
  suites:
    default:
      contexts:
        - FeatureContext
        - HomeContext</span></pre>
<p><span class="koboSpan" id="kobo.253.1">Here, we can declare more PHP context classes. </span><span class="koboSpan" id="kobo.253.2">By default, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">FeatureContext.php</span></strong><span class="koboSpan" id="kobo.255.1"> file that’s been automatically created earlier in this chapter, but if we keep on adding different steps inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">FeatureContext.php</span></strong><span class="koboSpan" id="kobo.257.1"> class, we’ll end up with </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">a mess.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.259.1">Now, let’s try running Behat</span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.260.1"> again, but this time, we’ll use the following command to automatically generate the missing snippets for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">Given</span></strong><span class="koboSpan" id="kobo.262.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">When</span></strong><span class="koboSpan" id="kobo.264.1">, and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.265.1">Then</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.266.1"> steps:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.267.1">/var/www/html/behat# ./vendor/bin/behat features/home.feature --append-snippets</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.268.1">You’ll then be prompted to enter which specific context class you want </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">to use:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer086">
<span class="koboSpan" id="kobo.270.1"><img alt="Figure 6.4 – Selecting a context class" src="image/Figure_6.04_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.271.1">Figure 6.4 – Selecting a context class</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.272.1">Enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">2</span></strong><span class="koboSpan" id="kobo.274.1"> into the CLI, then press </span><em class="italic"><span class="koboSpan" id="kobo.275.1">Enter</span></em><span class="koboSpan" id="kobo.276.1">. </span><span class="koboSpan" id="kobo.276.2">Now, you should get the </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">following result:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer087">
<span class="koboSpan" id="kobo.278.1"><img alt="Figure 6.5 – Automatically generated snippets" src="image/Figure_6.05_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.279.1">Figure 6.5 – Automatically generated snippets</span></p>
<p><span class="koboSpan" id="kobo.280.1">Behat has automatically generated the PHP</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.281.1"> snippets needed to represent the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">Given</span></strong><span class="koboSpan" id="kobo.283.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">When</span></strong><span class="koboSpan" id="kobo.285.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">Then</span></strong><span class="koboSpan" id="kobo.287.1"> steps we have defined inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">home.feature</span></strong><span class="koboSpan" id="kobo.289.1"> file. </span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.290.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">HomeContext.php</span></strong><span class="koboSpan" id="kobo.292.1"> class we created earlier, and there you should see the new automatically </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">generated methods:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.294.1">
&lt;?php</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.295.1">
use Behat\Behat\Tester\Exception\PendingException;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.296.1">
class HomeContext implements \Behat\Behat\Context</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.297.1">
     \Context</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.298.1">
{</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.299.1">
    /**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.300.1">
     * @Given I have access to the home page URL</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.301.1">
     */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.302.1">
    public function iHaveAccessToTheHomePageUrl()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.303.1">
    {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.304.1">
        throw new PendingException();</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.305.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.306.1">
    /**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.307.1">
     * @When I visit the home page</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.308.1">
     */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.309.1">
    public function iVisitTheHomePage()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.310.1">
    {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.311.1">
        throw new PendingException();</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.312.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.313.1">
    /**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.314.1">
     * @Then I should see the Symfony Logo</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.315.1">
     */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.316.1">
    public function iShouldSeeTheSymfonyLogo()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.317.1">
    {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.318.1">
        throw new Exception();</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.319.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.320.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.321.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">iShouldSeeTheSymfonyLogo()</span></strong><span class="koboSpan" id="kobo.323.1"> method, replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">PendingException</span></strong><span class="koboSpan" id="kobo.325.1"> class with just an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">Exception</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.327.1"> class.</span></span></li>
<li><span class="koboSpan" id="kobo.328.1">Great! </span><span class="koboSpan" id="kobo.328.2">Now, let’s run Behat again, and see what </span><span class="No-Break"><span class="koboSpan" id="kobo.329.1">we get:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.330.1">/var/www/html/behat# ./vendor/bin/behat features/home.feature</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.331.1">Since the automatically generated snippets return a </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">PendingException</span></strong><span class="koboSpan" id="kobo.333.1"> object, we’ll get the following result </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">from Behat:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer088">
<span class="koboSpan" id="kobo.335.1"><img alt="Figure 6.6 – Behat with automatically generated PHP snippets" src="image/Figure_6.06_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.336.1">Figure 6.6 – Behat with automatically generated PHP snippets</span></p>
<p><span class="koboSpan" id="kobo.337.1">We should now see the warm and comforting failed test message. </span><span class="koboSpan" id="kobo.337.2">So far, we were able to use Gherkin</span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.338.1"> to define our feature. </span><span class="koboSpan" id="kobo.338.2">Then, we created a separate context class to house the methods that Behat will execute in relation to each of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">Given</span></strong><span class="koboSpan" id="kobo.340.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">When</span></strong><span class="koboSpan" id="kobo.342.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">Then</span></strong><span class="koboSpan" id="kobo.344.1"> steps we have defined using Gherkin. </span><span class="koboSpan" id="kobo.344.2">Then, we used Behat to automatically generate those methods. </span><span class="koboSpan" id="kobo.344.3">Now, how do make all these tests pass? </span><span class="koboSpan" id="kobo.344.4">Well, we can remove the exception we are throwing from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">iShouldSeeTheSymfonyLogo()</span></strong><span class="koboSpan" id="kobo.346.1"> method! </span><span class="koboSpan" id="kobo.346.2">As you can see, this is all happening inside PHP land. </span><span class="koboSpan" id="kobo.346.3">But to really pass the test, we have to let Behat fire up a browser, visit the home page URL, and verify whether it can see the Symfony logo. </span></p>
<p><span class="koboSpan" id="kobo.347.1">So, how do we do that? </span><span class="koboSpan" id="kobo.347.2">Remember when we installed Mink earlier? </span><span class="koboSpan" id="kobo.347.3">We will now have to use Mink and a browser emulator to do the browser work </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">for us.</span></span></p>
<h1 id="_idParaDest-104"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.349.1">Browser emulators and Mink</span></h1>
<p><span class="koboSpan" id="kobo.350.1">Browser emulators</span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.351.1"> are programs that emulate or mimic the functionalities and behaviors of a web browser. </span><span class="koboSpan" id="kobo.351.2">These emulators can then be used by another program, such as Behat or Codeception, to simulate what a real user would do on a web browser while using </span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.353.1">There are two types of </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">browser emulators:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.355.1">Headless</span></strong><span class="koboSpan" id="kobo.356.1">: These types of emulators fire HTTP requests</span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.357.1"> and simply listen for the returned DOM or response from the web application. </span><span class="koboSpan" id="kobo.357.2">They will be best suited for lightweight testing, without the need for complicated checks such as checking for an AJAX response after a </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">mouseover event.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.359.1">Controllers</span></strong><span class="koboSpan" id="kobo.360.1">: These types of emulators use real browsers, and </span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.361.1">they basically act like a person who controls a real browser. </span><span class="koboSpan" id="kobo.361.2">The good thing about using these types of emulators, in my experience, is that we can set the type of browser we want to test with. </span><span class="koboSpan" id="kobo.361.3">We can also check for the JavaScript and AJAX results on </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">a page.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.363.1">In our example, we will use the headless browser as we won’t need to do any JavaScript/AJAX actions. </span><span class="koboSpan" id="kobo.363.2">If you need to use a real browser emulator for your project, I highly recommend using Selenium2. </span><span class="koboSpan" id="kobo.363.3">You can read more about Selenium</span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.364.1"> from the Selenium website </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">at </span></span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">https://www.selenium.dev</span></span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.368.1">Next, to let our Behat application start interacting</span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.369.1"> with a browser emulator, in place of a real user, create the following </span><span class="No-Break"><span class="koboSpan" id="kobo.370.1">program files:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.371.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">HomeContext.php</span></strong><span class="koboSpan" id="kobo.373.1"> class we created earlier and replace it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.375.1">codebase/behat/features/bootstrap/HomeContext.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.376.1">
&lt;?php
use Behat\Mink\Mink;
use Behat\Mink\Session;
use Behat\Mink\Driver\GoutteDriver;
use Behat\MinkExtension\Context\MinkContext;
use Behat\MinkExtension\Context\MinkAwareContext;
class HomeContext extends MinkContext implements MinkAwareContext
{
    public function __construct()
    {
        $mink   = new Mink([
            'goutte'    =&gt; new Session(new 
                GoutteDriver()), // Headless browser
        ]);
        $this-&gt;setMink($mink);
        $this-&gt;getMink()-&gt;getSession('goutte')-&gt;start
            ();
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.377.1">In the constructor, we have</span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.378.1"> instantiated an instance</span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.379.1"> of Mink, which we injected with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">Session</span></strong><span class="koboSpan" id="kobo.381.1"> object. </span><span class="koboSpan" id="kobo.381.2">We have injected a driver object into the session with an instance of the Goutte headless emulator. </span><span class="koboSpan" id="kobo.381.3">Mink supports different types of browser emulators; you can read</span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.382.1"> more about them </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">here: </span></span><a href="https://mink.behat.org/en/latest/at-a-glance.html"><span class="No-Break"><span class="koboSpan" id="kobo.384.1">https://mink.behat.org/en/latest/at-a-glance.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.385.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">Next, add the following</span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.387.1"> functions inside the same</span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.388.1"> class. </span><span class="koboSpan" id="kobo.388.2">These methods represent each of the steps you have defined in your scenarios: </span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.389.1">
    /**
     * @Given I have access to the home page URL
     */
    public function iHaveAccessToTheHomePageUrl()
    {
        return true;
    }
    /**
     * @When I visit the home page
     */
    public function iVisitTheHomePage()
    {
        // Using the Goutte Headless emulator
        $sessionHeadless = $this-&gt;getMink()-&gt;getSession
            ('goutte');
        $sessionHeadless-&gt;visit("symfony/public");
        $sessionHeadless-&gt;getPage()-&gt;clickLink('Create your 
            first page');
    }
    /**
     * @Then I should see the Symfony Logo
     */
    public function iShouldSeeTheSymfonyLogo()
    {
        // Headless emulator test:
        $assertHeadless = $this-&gt;assertSession('goutte');
        $assertHeadless-&gt;elementExists('css', '.logo');
        $assertHeadless-&gt;pageTextContains('Welcome To 
            Symfony 6'); 
    }</span></pre>
<p><span class="koboSpan" id="kobo.390.1">Within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">iVisitTheHomePage()</span></strong><span class="koboSpan" id="kobo.392.1"> method, we retrieved</span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.393.1"> the Goutte-injected session we just created, and then we let the emulator visit the URL and click on </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">a link.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.395.1">Now, let’s run the test and see whether it works! </span><span class="koboSpan" id="kobo.395.2">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.397.1">/var/www/html/behat# ./vendor/bin/behat</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.398.1">You should then see the </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer089">
<span class="koboSpan" id="kobo.400.1"><img alt="Figure 6.7 – Failed headless browser assertion" src="image/Figure_6.07_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.401.1">Figure 6.7 – Failed headless browser assertion</span></p>
<p><span class="koboSpan" id="kobo.402.1">We failed the test</span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.403.1"> again, but why is that? </span><span class="koboSpan" id="kobo.403.2">Notice that inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">iVisitTheHomePage()</span></strong><span class="koboSpan" id="kobo.405.1"> method, we have </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">this line:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.407.1">
$sessionHeadless-&gt;getPage()-&gt;clickLink('Create your first page');</span></pre>
<p><span class="koboSpan" id="kobo.408.1">This line tells the emulator to click on the </span><strong class="bold"><span class="koboSpan" id="kobo.409.1">Tutorials</span></strong><span class="koboSpan" id="kobo.410.1"> option on the home page, which uses the </span><strong class="bold"><span class="koboSpan" id="kobo.411.1">Create your first page</span></strong><span class="koboSpan" id="kobo.412.1"> anchor text: </span></p>
<div>
<div class="IMG---Figure" id="_idContainer090">
<span class="koboSpan" id="kobo.413.1"><img alt="Figure 6.8 – Create your first page link " src="image/Figure_6.08_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.414.1">Figure 6.8 – Create your first page link </span></p>
<p><span class="koboSpan" id="kobo.415.1">What happened was the emulator</span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.416.1"> successfully loaded the Symfony home page, and then clicked on the tutorial link, and therefore the browser was redirected to a different page! </span><span class="koboSpan" id="kobo.416.2">That’s why we failed the test. </span><span class="koboSpan" id="kobo.416.3">So, if we update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">iVisitTheHomePage()</span></strong><span class="koboSpan" id="kobo.418.1"> method and remove the offending line, we should now be able to pass </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">the test!</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.420.1">Run the test again by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.422.1">/var/www/html/behat# ./vendor/bin/behat</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.423.1">We should then see the </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer091">
<span class="koboSpan" id="kobo.425.1"><img alt="Figure 6.9 – The first Behat test passed" src="image/Figure_6.09_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.426.1">Figure 6.9 – The first Behat test passed</span></p>
<p><span class="koboSpan" id="kobo.427.1">Great! </span><span class="koboSpan" id="kobo.427.2">We finally passed</span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.428.1"> our first Behat test! </span><span class="koboSpan" id="kobo.428.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">iShouldSeeTheSymfonyLogo()</span></strong><span class="koboSpan" id="kobo.430.1"> method, you’ll notice that we have two assertions. </span><span class="koboSpan" id="kobo.430.2">In the first assertion, we wanted to check whether an element exists in the returned DOM, which is the </span><em class="italic"><span class="koboSpan" id="kobo.431.1">logo</span></em><span class="koboSpan" id="kobo.432.1"> element. </span><span class="koboSpan" id="kobo.432.2">We then added another assertion to check for the </span><strong class="bold"><span class="koboSpan" id="kobo.433.1">Welcome to Symfony 6 </span></strong><span class="koboSpan" id="kobo.434.1">text. </span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.435.1">Open your web browser and visit the following </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">page: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">http://127.0.0.1:8081/symfony/public/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.439.1">Open your element inspector; you should see the logo element. </span><span class="koboSpan" id="kobo.439.2">This is what we told Mink to </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">look for:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer092">
<span class="koboSpan" id="kobo.441.1"><img alt="Figure 6.10 – Logo element" src="image/Figure_6.10_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.442.1">Figure 6.10 – Logo element</span></p>
<p><span class="koboSpan" id="kobo.443.1">Since both the </span><em class="italic"><span class="koboSpan" id="kobo.444.1">logo</span></em><span class="koboSpan" id="kobo.445.1"> element and </span><strong class="bold"><span class="koboSpan" id="kobo.446.1">Welcome to Symfony 6</span></strong><span class="koboSpan" id="kobo.447.1"> text exists when the browser emulator visited the home page, it finally passed </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">the test!</span></span></p>
<p><span class="koboSpan" id="kobo.449.1">Now, I think you’ll have an idea of how useful and powerful these tools can be. </span><span class="koboSpan" id="kobo.449.2">This can save you and your team hours of </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">manual testing.</span></span></p>
<p><span class="koboSpan" id="kobo.451.1">At this stage, you can start writing behaviors</span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.452.1"> represented by features and scenarios using the Gherkin language, then use Behat to execute those tests, then develop features using PHP to satisfy those tests. </span><span class="koboSpan" id="kobo.452.2">If you follow this process, your development will be driven by the behaviors that were defined before writing a single line of code. </span><span class="koboSpan" id="kobo.452.3">Now, your development is </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">behavior driven!</span></span></p>
<h1 id="_idParaDest-105"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.454.1">Why bother with Gherkin, then?</span></h1>
<p><span class="koboSpan" id="kobo.455.1">The example we used in this chapter</span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.456.1"> is very simple, but you might be tempted to think that we can just skip the features written in the Gherkin language. </span><span class="koboSpan" id="kobo.456.2">Well, I did that too. </span><span class="koboSpan" id="kobo.456.3">I thought: it’s not that useful. </span><span class="koboSpan" id="kobo.456.4">But when I started working on bigger projects, with bigger teams, with different companies working collaboratively on the same project and goal, I thought to myself: I wish there were a common format that we could share so that we all understand </span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.457.1">what the business is trying to achieve. </span><span class="koboSpan" id="kobo.457.2">I was working collaboratively with a third-party company, and I wanted to ask them whether I could borrow or get a copy of their test cases, but the thing is, they wrote down their test cases directly into their application, which is not written in PHP. </span><span class="koboSpan" id="kobo.457.3">I then realized how important it is to have some sort of a common language that we can use to understand the intended behavior of a system that is programming-language agnostic! </span></p>
<p><span class="koboSpan" id="kobo.458.1">The following diagram represents how useful the Gherkin language is in being a platform-agnostic, intermediary language to represent how the intended software solution </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">should behave:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer093">
<span class="koboSpan" id="kobo.460.1"><img alt="Figure 6.11 – Gherkin features and scenarios" src="image/Figure_6.11_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.461.1">Figure 6.11 – Gherkin features and scenarios</span></p>
<p><span class="koboSpan" id="kobo.462.1">By using a common language</span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.463.1"> to define the intended features and scenarios in a project, we can easily coordinate with different teams that do not do any software programming at all. </span><span class="koboSpan" id="kobo.463.2">This is very important for a business. </span><span class="koboSpan" id="kobo.463.3">People across different teams will be able to collaborate and understand each other easier and quicker, and by doing so, the developers can also be more confident and certain that what they are building is correct. </span><span class="koboSpan" id="kobo.463.4">It might sound ridiculous, but I’ve seen a lot of projects go wrong simply because of a breakdown in communication between different teams in a business. </span></p>
<h1 id="_idParaDest-106"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.464.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.465.1">In this chapter, we defined and explained what BDD is and why we need it. </span><span class="koboSpan" id="kobo.465.2">By implementing BDD, we will be able to develop our solutions better to properly address the actual business goal. </span><span class="koboSpan" id="kobo.465.3">We can start defining these business goals using features and scenarios, written in the Gherkin language, which is just plain English. </span><span class="koboSpan" id="kobo.465.4">By doing so, different people from different teams in the company will be able to coordinate and understand each other better in defining the system’s intended behavior. </span><span class="koboSpan" id="kobo.465.5">This will help bridge the gap and language barrier between different teams. </span></p>
<p><span class="koboSpan" id="kobo.466.1">We created a feature and a scenario, then used Behat, Mink, and Goutte to define the intended system behavior, open a headless browser, visit the web application, and verify the content of the </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">home page.</span></span></p>
<p><span class="koboSpan" id="kobo.468.1">This is just the tip of the BDD iceberg. </span><span class="koboSpan" id="kobo.468.2">In the next chapter, we will start writing solution code while making sure that our code is maintainable and testable by using BDD and TDD together. </span></p>
</div>
</body></html>