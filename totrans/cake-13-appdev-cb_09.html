<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Internationalizing Applications"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Internationalizing Applications</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Internationalizing controller and view texts</li><li class="listitem" style="list-style-type: disc">Internationalizing model validation messages</li><li class="listitem" style="list-style-type: disc">Translating strings with dynamic content</li><li class="listitem" style="list-style-type: disc">Extracting and translating text</li><li class="listitem" style="list-style-type: disc">Translating database records with the Translate behavior</li><li class="listitem" style="list-style-type: disc">Setting and remembering the language</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec01"/>Introduction</h1></div></div></div><p>This chapter includes a set of recipes that allow the reader to internationalize all aspects of their CakePHP applications, including static content, such as those available in views, and dynamic content, such as database records.</p><p>The first two recipes show how to allow text that is part of any CakePHP view or model validation messages to be ready for translation. The third recipe shows how to translate more complex expressions. The fourth recipe shows how to run CakePHP's built-in tools to extract all static content that needs translation, and then translate that content to different languages. The fifth recipe shows how to translate database records. Finally, the last recipe shows how to allow users to change the current application language.</p></div></div>
<div class="section" title="Internationalizing controller and view texts"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec02"/>Internationalizing controller and view texts</h1></div></div></div><p>In this recipe, we will learn how to internationalize text that is located in our application views, and have that content ready for translation.<a id="id311" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec01"/>Getting ready</h2></div></div></div><p>To go through this recipe, we need some data to work with. Create a table named<code class="literal"> articles</code> with the following SQL statement:<a id="id312" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">CREATE TABLE `articles`(
`id` INT UNSIGNED AUTO_INCREMENT NOT NULL,
`title` VARCHAR(255) NOT NULL,
`body` TEXT NOT NULL,
`created` DATETIME NOT NULL,
`modified` DATETIME NOT NULL,
PRIMARY KEY(`id`)
);
</pre></div><p>Now add some sample data to this table with the following statement:</p><div class="informalexample"><pre class="programlisting">INSERT INTO `articles`(`title`, `body`, `created`, `modified`) VALUES
('First Article', 'Body for first article', NOW(), NOW()),
('Second Article', 'Body for second article', NOW(), NOW()),
('Third Article', 'Body for third article', NOW(), NOW());
</pre></div><p>Create the controller for this table in a file named<code class="literal"> articles_controller.php</code> and place it in your<code class="literal"> app/controllers</code> folder, with the following contents:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class ArticlesController extends AppController {
public function index() {
$this-&gt;paginate['limit'] = 2;
$articles = $this-&gt;paginate();
$this-&gt;set(compact('articles'));
}
public function add() {
if (!empty($this-&gt;data)) {
$this-&gt;Article-&gt;create();
if ($this-&gt;Article-&gt;save($this-&gt;data)) {
$this-&gt;Session-&gt;setFlash('Article saved');
$this-&gt;redirect(array('action'=&gt;'index'));
} else {
$this-&gt;Session-&gt;setFlash('Please correct the errors');
}
}
}
public function view($id) {
$article = $this-&gt;Article-&gt;find('first', array(
'conditions' =&gt; array('Article.id' =&gt; $id)
));
if (empty($article)) {
$this-&gt;cakeError('error404');
}
$this-&gt;set(compact('article'));
}
}
?&gt;
</pre></div><p>Create a file named<code class="literal"> article.php</code> and place it in your<code class="literal"> app/models</code> folder, with the following contents:<a id="id313" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">&lt;?php
class Article extends AppModel {
public $validate = array(
'title' =&gt; 'notEmpty',
'body' =&gt; 'notEmpty'
);
}
?&gt;
</pre></div><p>Create a folder named<code class="literal"> articles</code> in your<code class="literal"> app/views</code> folder, and inside that folder create a file named<code class="literal"> index.ctp</code> with the following contents:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;Articles&lt;/h1&gt;
&lt;p&gt;
&lt;?php echo $this-&gt;Paginator-&gt;counter(); ?&gt;
&amp;nbsp;-&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;prev(); ?&gt;
&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;numbers(); ?&gt;
&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;next(); ?&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;?php echo count($articles) . ' articles: '; ?&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;?php foreach($articles as $article) { ?&gt;
&lt;li&gt;&lt;?php echo $this-&gt;Html-&gt;link(
$article['Article']['title'],
array('action'=&gt;'view', $article['Article']['id'])
); ?&gt;&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;?php echo $this-&gt;Html-&gt;link('Create article', array('action'=&gt;'add')); ?&gt;&lt;/p&gt;
</pre></div><p>Create a file named<code class="literal"> add.ctp</code> and place it in your<code class="literal"> app/views/articles</code> folder, with the following contents:</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo $this-&gt;Form-&gt;create();
echo $this-&gt;Form-&gt;inputs(array(
'title',
'body'
));
echo $this-&gt;Form-&gt;end('Save');
?&gt;
</pre></div><p>Create a file named<code class="literal"> view.ctp</code> and place it in your<code class="literal"> app/views/articles</code> folder, with the following contents:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;&lt;?php echo $article['Article']['title']; ?&gt;&lt;/h1&gt;
&lt;?php echo $article['Article']['body']; ?&gt;
</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec02"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Edit the<code class="literal"> articles_controller.php</code> file located in your<code class="literal"> app/controllers</code> folder and make the following changes to the<code class="literal"> add()</code> method:<a id="id314" class="indexterm"/><div class="informalexample"><pre class="programlisting">public function add() {
if (!empty($this-&gt;data)) {
$this-&gt;Article-&gt;create();
if ($this-&gt;Article-&gt;save($this-&gt;data)) {
<span class="strong"><strong>$this-&gt;Session-&gt;setFlash(__('Article saved', true));</strong></span>
$this-&gt;redirect(array('action'=&gt;'index'));
} else {
<span class="strong"><strong>$this-&gt;Session-&gt;setFlash(__('Please correct the errors', true));</strong></span>
}
}
}
</pre></div></li><li class="listitem">Edit the file<code class="literal"> add.ctp</code> located in your<code class="literal"> app/views/articles</code> folder and make the following changes:<div class="informalexample"><pre class="programlisting">&lt;?php
echo $this-&gt;Form-&gt;create();
echo $this-&gt;Form-&gt;inputs(array(
<span class="strong"><strong>'legend' =&gt; __('New Article', true),
'title' =&gt; array('label' =&gt; __('Title:', true)),
'body' =&gt; array('label' =&gt; __('Body:', true))</strong></span>
));
<span class="strong"><strong>echo $this-&gt;Form-&gt;end(__('Save', true));</strong></span>
?&gt;
</pre></div></li><li class="listitem">Finally, edit the file<code class="literal"> index.ctp</code> located in your<code class="literal"> app/views/articles</code> folder and make the following changes:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>&lt;h1&gt;&lt;?php __('Articles'); ?&gt;&lt;/h1&gt;</strong></span>
&lt;p&gt;
<span class="strong"><strong>&lt;?php echo $this-&gt;Paginator-&gt;counter(__('Showing records %start%-%end% in page %page% out of %pages%', true)); ?&gt;</strong></span>
&amp;nbsp;-&amp;nbsp;
<span class="strong"><strong>&lt;?php echo $this-&gt;Paginator-&gt;prev(__('&lt;&lt; Previous', true)); ?&gt;</strong></span>
&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;numbers(); ?&gt;
&amp;nbsp;
<span class="strong"><strong>&lt;?php echo $this-&gt;Paginator-&gt;next(__('Next &gt;&gt;', true)); ?&gt;</strong></span>
&lt;/p&gt;
&lt;p&gt;
<span class="strong"><strong>&lt;?php
$count = count($articles);
echo $count . ' ' . __n('article', 'articles', $count, true) . ': ';
?&gt;</strong></span>
&lt;/p&gt;
&lt;ul&gt;
&lt;?php foreach($articles as $article) { ?&gt;
&lt;li&gt;&lt;?php echo $this-&gt;Html-&gt;link(
$article['Article']['title'],
array('action'=&gt;'view', $article['Article']['id'])
); ?&gt;&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
<span class="strong"><strong>&lt;p&gt;&lt;?php echo $this-&gt;Html-&gt;link(__('Create article', true), array('action'=&gt;'add')); ?&gt;&lt;/p&gt;</strong></span>
</pre></div></li></ol></div><p>If you now browse to <code class="literal">http://localhost/articles</code>, you should see a paginated list of articles, as shown in the following screenshot:<a id="id315" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1926_9_01.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec03"/>How it works...</h2></div></div></div><p>CakePHP offers two main methods (amongst others) to allow developers to specify content that can be translated:<code class="literal"> __()</code> and<code class="literal"> __n()</code>. The naming of these methods may seem a bit odd, but they are largely influenced by Perl's implementation of<code class="literal"> gettext</code>, a tool that is part of the GNU Translation Project.<a id="id316" class="indexterm"/>
</p><p>The<code class="literal"> __()</code> method is used to translate static text, and takes up to two arguments:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">singular</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Text that should be translated to the current language.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">return</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If set to<code class="literal"> true</code>, the translated text will be returned instead of echoed to the client. Defaults to<code class="literal"> false</code>.</p>
</td></tr></tbody></table></div><p>The<code class="literal"> __n()</code> method is used to translate static text that could change if a certain value is either singular or plural, and takes up to four arguments:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">singular</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Text that should be used if the given value in<code class="literal"> count</code> is<code class="literal"> singular</code>, and that will be translated to the current language when used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">plural</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Text that should be used if the given value in<code class="literal"> count</code> is<code class="literal"> plural</code>, and that will be translated to the current language when used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">count</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A variable or numeric value that holds the value that should be used to determine if either the<code class="literal"> singular</code> or<code class="literal"> plural</code> text is to be used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">return</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If set to<code class="literal"> true</code>, the translated text will be returned instead of echoed to the client. Defaults to<code class="literal"> false</code>.</p>
</td></tr></tbody></table></div><p>We start by changing the flash messages in the<code class="literal"> ArticlesController</code> class to use the<code class="literal"> __()</code> method, specifying that the translated string should be returned rather than echoed to the client. We continue by modifying the<code class="literal"> add.ctp</code> view so that all labels and the form legend can be translated.</p><p>Similarly, we wrap the title in the<code class="literal"> index.ctp</code> view with the translator function. We then use the first parameter of the<code class="literal"> counter(), next()</code>, and<code class="literal"> prev()</code> methods that are part of the<code class="literal"> PaginatorHelper</code> class to pass the translated version of the appropriate pagination text. Finally, we use the<code class="literal"> __n()</code> function to choose the correct translated text depending on the value of the<code class="literal"> count</code> variable.<a id="id317" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"/>Note</h3><p>When using the<code class="literal"> __n()</code> function you should only use a variable as its third parameter. Using expressions (including array indexes) may produce unexpected results when running CakePHP's extractor shell, which is covered in the recipe<span class="emphasis"><em> Extracting and translating text</em></span>.</p></div><div class="section" title="Domains and categories"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec01"/>Domains and categories</h3></div></div></div><p>The translation functions used in this recipe are actually wrappers around the<code class="literal"> translate()</code> method of CakePHP's built-in<code class="literal"> I18n</code> class. This method not only allows simple translations, but also allows the developer to specify the domain from which translated texts are obtained, and the category to which the text to be translated belongs to.<a id="id318" class="indexterm"/>
</p><p>Domains allow you to separate groups of translation text into separate files. By default, when no domain is specified, CakePHP assumes a domain named<code class="literal"> default</code>. If you want to specify the domain in which a translated text should be looked for, use the<code class="literal"> __d()</code> and<code class="literal"> __dn()</code> translation functions. For example, to look for a translated text in the<code class="literal"> my_plugin</code> domain, you would do:<a id="id319" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">$translated = __d('my_plugin', 'Hello World', true);
</pre></div><p>Categories allow for a further grouping of translated texts by grouping the translation files into separate directories, and provide further meaning to the translated text. By default, CakePHP will assume that translated texts belong to the<code class="literal"> LC_MESSAGES</code> category. If you wish to change the category, use the<code class="literal"> __dc()</code> and<code class="literal"> __dcn()</code> translator functions, by setting its next-to-last argument,<code class="literal"> return</code>, to the desired category, which can be any of the following defined constants with the respective fixed value:<a id="id320" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">LC_ALL: 0</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LC_COLLATE: 1</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LC_CTYPE: 2</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LC_MONETARY: 3</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LC_NUMERIC: 4</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LC_TIME: 5</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LC_MESSAGES: 6</code></li></ul></div><p>For example, to look for a translated text in the<code class="literal"> default</code> domain and the<code class="literal"> LC_MESSAGES</code> category you would do:</p><div class="informalexample"><pre class="programlisting">$translated = __dc('default', 'Hello World', 6, true);
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"/>Note</h3><p>When looking forward to using categories, always use the category value previously given in the list rather than the constant name, as this constant is platform-dependent.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec04"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Internationalizing model validation messages</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Extracting and translating text</em></span></li></ul></div></div></div>
<div class="section" title="Internationalizing model validation messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec04"/>Internationalizing model validation messages</h1></div></div></div><p>In this recipe, we will learn different approaches for the same need: translating model validation messages.<a id="id321" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec05"/>Getting ready</h2></div></div></div><p>To go through this recipe, we need a basic application skeleton to work with. Go through the previous recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec06"/>How to do it...</h2></div></div></div><p>Edit the file<code class="literal"> article.php</code> located in your<code class="literal"> app/models</code> folder and make the following changes to the<code class="literal"> validate</code> property:</p><div class="informalexample"><pre class="programlisting">public $validate = array(
<span class="strong"><strong>'title' =&gt; array(
'required' =&gt; 'notEmpty'
),
'body' =&gt; array(
'required' =&gt; 'notEmpty'</strong></span>
)
);
</pre></div><p>There are two ways to have validation messages translated. The first one requires you to override the model constructor by adding the following implementation to the<code class="literal"> Article</code> class defined in your<code class="literal"> app/models/article.php</code> file:</p><div class="informalexample"><pre class="programlisting">public function __construct($id = false, $table = null, $ds = null) {
foreach($this-&gt;validate as $field =&gt; $rules) {
if (!is_array($rules)) {
$rules = (array) $rules;
}
foreach($rules as $key =&gt; $rule) {
if (!is_array($rule)) {
$rules[$key] = compact('rule');
}
}
$this-&gt;validate[$field] = $rules;
}
$this-&gt;validate = Set::merge($this-&gt;validate, array(
'title' =&gt; array(
'required' =&gt; array('message' =&gt; __('A title must be specified', true))
),
'body' =&gt; array(
'required' =&gt; array('message' =&gt; __('You must define the body', true))
)
));
parent::__construct($id, $table, $ds);
}
</pre></div><p>The alternative way to translate validation messages is to move these messages to the view. Instead of overriding and defining the messages in the model constructor, edit your<code class="literal"> app/views/articles/add.ctp</code> view file and make the following changes to it:<a id="id322" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo $this-&gt;Form-&gt;create();
echo $this-&gt;Form-&gt;inputs(array(
<span class="strong"><strong>'title' =&gt; array(
'label' =&gt; __('Title:', true),
'error' =&gt; array(
'required' =&gt; __('A title must be specified', true)
)
),
'body' =&gt; array(
'label' =&gt; __('Body:', true),
'error' =&gt; array(
'required' =&gt; __('You must define the body', true)
)
)</strong></span>
));
echo $this-&gt;Form-&gt;end(__('Save', true));
?&gt;
</pre></div><p>Both ways should produce the same result. If you now browse to <code class="literal">http://localhost/articles/add</code> and submit the form without entering any values, you should see the validation messages shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/1926_9_02.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec07"/>How it works...</h2></div></div></div><p>Before attempting to provide the error messages for each validation rule, we need to name each of our rules. We do so by modifying the<code class="literal"> Article</code> model so that each rule defined is indexed by a name. In our case we choose<code class="literal"> required</code> as the name for the validation based on CakePHP's built-in<code class="literal"> notEmpty</code> rule.<a id="id323" class="indexterm"/>
</p><p>The first method we used to specify the validation messages shows a practical approach when we want to centralize all validation messages in the model. We override the model constructor so that from within this constructor we specify the error messages that should be translated. We needed to implement the constructor because class property values cannot use an expression other than a static assignment, so the following block of code would produce a PHP syntax error:</p><div class="informalexample"><pre class="programlisting">public $validate = array(
'title' =&gt; array(
'required' =&gt; array(
'rule' =&gt; 'notEmpty',
'message' =&gt; __('Nothing defined!', true) // SYNTAX ERROR
)
)
);
</pre></div><p>In this constructor implementation, we start by making sure that the<code class="literal"> validate</code> property is an array of rules, indexed by field name, and that each set of rules is itself an array indexed by name, having as its value another array where at the very least the<code class="literal"> rule</code> setting is defined.<a id="id324" class="indexterm"/>
</p><p>Once we are sure that the<code class="literal"> validate</code> property has the right format, we merge the validation messages for each rule using the<code class="literal"> __()</code> translator function to translate the messages. Finally, we call the parent constructor to ensure that the model is built properly.</p><p>The second method described in this recipe moves the responsibility of declaring each validation error message to the view, by means of the<code class="literal"> error</code> setting available in the<code class="literal"> input()</code> method of the<code class="literal"> FormHelper</code> class. This setting is set to an array, indexed by validation name, and the value is set to the error message shown when the respective validation fails.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec08"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Extracting and translating text</em></span></li></ul></div></div></div>
<div class="section" title="Translating strings with dynamic content"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec05"/>Translating strings with dynamic content</h1></div></div></div><p>In this recipe, we will learn how to allow strings consisting of parts that are not static, such as variable values, to be translatable.<a id="id325" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec09"/>Getting ready</h2></div></div></div><p>To go through this recipe, we need a basic application skeleton to work with. Go through the entire recipe<span class="emphasis"><em> Internationalizing controller and view texts</em></span>.<a id="id326" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec10"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Edit the file<code class="literal"> articles_controller.php</code> located in your<code class="literal"> app/controllers</code> folder and make the following changes to the<code class="literal"> add()</code> method:<div class="informalexample"><pre class="programlisting">public function add() {
if (!empty($this-&gt;data)) {
$this-&gt;Article-&gt;create();
if ($this-&gt;Article-&gt;save($this-&gt;data)) {
<span class="strong"><strong>$this-&gt;Session-&gt;setFlash(
sprintf(__('Article "%s" saved', true), $this-&gt;Article-&gt;field('title'))</strong></span>
);
$this-&gt;redirect(array('action'=&gt;'index'));
} else {
$this-&gt;Session-&gt;setFlash('Please correct the errors');
}
}
}
</pre></div></li><li class="listitem">Edit the view file<code class="literal"> index.ctp</code> located in your<code class="literal"> app/views/articles</code> folder and make the following changes:<div class="informalexample"><pre class="programlisting">&lt;h1&gt;&lt;?php __('Articles'); ?&gt;&lt;/h1&gt;
&lt;p&gt;
&lt;?php echo $this-&gt;Paginator-&gt;counter(__('Showing records %start%-%end% in page %page% out of %pages%', true)); ?&gt;
&amp;nbsp;-&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;prev(__('&lt;&lt; Previous', true)); ?&gt;
&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;numbers(); ?&gt;
&amp;nbsp;
&lt;?php echo $this-&gt;Paginator-&gt;next(__('Next &gt;&gt;', true)); ?&gt;
&lt;/p&gt;
&lt;p&gt;
<span class="strong"><strong>&lt;?php
$count = count($articles);
printf(__n('%d article', '%d articles', $count, true), $count);
?&gt;</strong></span>
&lt;/p&gt;
&lt;ul&gt;
&lt;?php foreach($articles as $article) { ?&gt;
&lt;li&gt;&lt;?php echo $this-&gt;Html-&gt;link(
$article['Article']['title'],
array('action'=&gt;'view', $article['Article']['id'])
); ?&gt;&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;?php echo $this-&gt;Html-&gt;link(__('Create article', true), array('action'=&gt;'add')); ?&gt;&lt;/p&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec11"/>How it works...</h3></div></div></div><p>When looking forward to including dynamic information, such as the value of a variable, or in this case, the value of a table field in the database, one can be tempted to simply append the variable to the string that is sent to the translator function:<a id="id327" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">$translated = __('Hello ' . $name, true); // This is wrong
</pre></div><p>This is not a valid expression, as CakePHP's extractor, shown in the recipe<span class="emphasis"><em> Extracting and translating text</em></span>, expects only static strings as arguments to the translator functions, and other languages may need to re-order the sentence. Therefore, we need to use some way of string interpolation, so we chose to use the most common ones offered by PHP: the<code class="literal"> printf()</code> and<code class="literal"> sprintf()</code> functions.</p><p>Both functions take the same number and type of arguments. The first argument is mandatory and specifies the string to use for interpolation, while any subsequent argument is used to produce the final string. The only difference between<code class="literal"> printf()</code> and<code class="literal"> sprintf()</code> is that the former will output the resulting string, while the later simply returns it.</p><p>We start by changing the success message given by the<code class="literal"> ArticlesController</code> class whenever an article is created. We use<code class="literal"> sprintf()</code> as we need to send it through to the<code class="literal"> setFlash()</code> method of the<code class="literal"> Session</code> component. In this case, we use the expression<code class="literal"> %s</code> to interpolate the value of the<code class="literal"> title</code> field for the newly created article.</p><p>Similarly, our latest change uses<code class="literal"> %d</code> to interpolate the decimal value of the variable<code class="literal"> count</code>, and uses<code class="literal"> printf()</code> to output the result string.</p><div class="section" title="Reordering and reusing interpolation arguments"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec02"/>Reordering and reusing interpolation arguments</h4></div></div></div><p>When using expressions such as<code class="literal"> %s</code> or<code class="literal"> %d</code> to tell<code class="literal"> printf()</code> and<code class="literal"> sprintf()</code> where to place the value of an argument, we have no flexibility in terms of value positioning, and no practical way to reuse a value, as each of those expressions needs to match a specific argument. Let us assume the following expression:<a id="id328" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">printf('Your name is %s and your country is %s', $name, $country);
</pre></div><p>The first<code class="literal"> %s</code> expression gets replaced with the value of the<code class="literal"> name</code> variable, while the last<code class="literal"> %s</code> expression is replaced with the value of the<code class="literal"> country</code> variable. What if we wanted to change the order of these values in the string without altering the order of the arguments that are sent to<code class="literal"> printf()?</code>
<a id="id329" class="indexterm"/>
</p><p>We can instead specify which argument is used by an interpolation expression by referring to an argument number (name being the argument number<code class="literal"> 1</code>, and<code class="literal"> country</code> argument number<code class="literal"> 2</code>):
</p><div class="informalexample"><pre class="programlisting">printf('You are from %2$s and your name is %1$s', $name, $country);
</pre></div><p>This also allows us to reuse an argument without having to add it as an extra argument to<code class="literal"> printf()</code>:
</p><div class="informalexample"><pre class="programlisting">printf('You are from %2$s and your name is %1$s . Welcome %1$s!', $name, $country);
</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec12"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Extracting and translating text</em></span></li></ul></div></div></div><div class="section" title="Extracting and translating text"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl1sec06"/>Extracting and translating text</h2></div></div></div><p>In this recipe, we will learn how to extract all strings that need translation from our CakePHP applications and then perform the actual translations using free software.<a id="id330" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec13"/>Getting ready</h3></div></div></div><p>To go through this recipe, we need a basic application skeleton to work with. Go through the entire recipe<span class="emphasis"><em> Internationalizing controller and view texts</em></span>.</p><p>We also need to have<span class="strong"><strong> Poedit</strong></span> installed in our system. Go to <a class="ulink" href="http://www.poedit.net/download.php">http://www.poedit.net/download.php</a> and download the appropriate file for your operative system.<a id="id331" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec14"/>How to do it...</h3></div></div></div><p>From the command line, and while in your<code class="literal"> app/</code> directory, issue the following command:<a id="id332" class="indexterm"/>
</p><p>If you are on a GNU Linux / Mac / Unix system:</p><div class="informalexample"><pre class="programlisting">../cake/console/cake i18n extract
</pre></div><p>If you are on Microsoft Windows:</p><div class="informalexample"><pre class="programlisting">..\cake\console\cake.bat i18n extract
</pre></div><p>You should accept the default options, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/1926_9_03.jpg" alt="How to do it..."/></div><p>After answering the final question, the shell should go through your application files and generate a translation template in a file named<code class="literal"> default.pot</code>, placing it in your<code class="literal"> app/locale</code> folder.</p><p>Open Poedit, and then click on the menu<span class="strong"><strong> File</strong></span>, and option<span class="strong"><strong> New catalog from POT file</strong></span>. You should now see an open file dialog box. Browse to your<code class="literal"> app/locale</code> folder, select the<code class="literal"> default.pot</code> file, and click the<span class="strong"><strong> Open</strong></span> button. A setting window should appear, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/1926_9_04.jpg" alt="How to do it..."/></div><p>In the<span class="strong"><strong> Settings</strong></span> window, enter the desired project name and project information. In the<span class="strong"><strong> Plural Forms</strong></span> field you should enter an expression that tells Poedit how to recognize plural translations. For most languages, such as English, Spanish, German and Portuguese, you should enter the following expression:<a id="id333" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">nplurals=2; plural=(n != 1);
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"/>Note</h3><p>More information about plural forms and which value should be given, depending on the language you are translating to, is available at <a class="ulink" href="http://drupal.org/node/17564">http://drupal.org/node/17564</a>.</p></div><p>Once you have entered all the desired details, click on the<span class="strong"><strong> OK</strong></span> button. You will now be asked where to store the translated file. Create a folder named<code class="literal"> spa</code> and place it in your<code class="literal"> app/locale</code> folder. Inside the<code class="literal"> spa</code> folder, create a folder named<code class="literal"> LC_MESSAGES</code>. Then, while in Poedit's dialog box, select the folder<code class="literal"> app/locale/spa/LC_MESSAGES</code> and click the button<span class="strong"><strong> Save</strong></span> without changing the file name, which should be<code class="literal"> default.po</code>.<a id="id334" class="indexterm"/>
</p><p>Poedit will now show you all the original strings, and allow you to translate each by entering the desired translation in the bottom text area. After you enter your translations, Poedit may look like the following screenshot:</p><div class="mediaobject"><img src="graphics/1926_9_05.jpg" alt="How to do it..."/></div><p>Click on the menu<span class="strong"><strong> File</strong></span>, and then option<span class="strong"><strong> Save</strong></span> to save the translated file. There should now be two files in your<code class="literal"> app/locale/spa/LC_MESSAGES</code> folder:<code class="literal"> default.po</code> and<code class="literal"> default.mo</code>.<a id="id335" class="indexterm"/>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec15"/>How it works...</h3></div></div></div><p>CakePHP's extractor will first ask which paths to process. When all paths have been specified, it will browse recursively through its directories and look for any use of a translator function (any of<code class="literal"> __(), __n(), __d(), __dn(), __dc(), __dcn()</code>, and<code class="literal"> __c()</code>) in PHP and view files. For each found usage, it will extract the strings that need translation (first argument on calls to<code class="literal"> __()</code> and<code class="literal"> __c()</code>; the second argument on calls to<code class="literal"> __d()</code> and<code class="literal"> __dc()</code>; the first and second arguments on calls to<code class="literal"> __n()</code>; and the second and third arguments on calls to<code class="literal"> __dn()</code> and<code class="literal"> __dcn()</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"/>Note</h3><p>It is important to only use static strings, avoiding any PHP expressions, on the arguments the extractor looks for. If you want to learn how to interpolate variable values in the strings that need translation, see the recipe<span class="emphasis"><em> Translating strings with dynamic content</em></span>.</p></div><p>Once CakePHP's extractor has obtained all strings that need translation, it will create the appropriate translation template files. If you used any translator function that specifies a domain (<code class="literal">__d()</code>,<code class="literal"> __dn(), __dc()</code>, and<code class="literal"> __dcn()</code>), you can optionally merge all strings into one template file, or have each domain create a separate template file. Template files have the<code class="literal"> pot</code> extension, and use the domain name as its filename (default.pot being the default template file).<a id="id336" class="indexterm"/>
</p><p>If you open<code class="literal"> default.pot</code> with a text editor, you will notice that it starts with a header that includes several settings, and then includes two lines for each string that needs translation: a line that defines a<code class="literal"> msgid</code> (the string to be translated), and a line that has an empty string for<code class="literal"> msgstr</code> (the translated string).</p><p>We then use Poedit to open this template file, translate the strings, and save it in the appropriate directory (<code class="literal">app/locale/spa/LC_MESSAGES</code>), where Poedit will create two files:<code class="literal"> default.po</code> and<code class="literal"> default.pot</code>. If you open<code class="literal"> default.po</code> with a text editor, you will notice it almost looks exactly as the template file does, except that the header settings have changed to what we defined, and the<code class="literal"> msgid</code> lines are filled with our translations. The<code class="literal"> default.mo</code> file is a binary version of the<code class="literal"> default.po</code> file, also generated by Poedit, and is used by CakePHP to speed processing of the translation file.</p></div></div><div class="section" title="Translating database records with the Translate behavior"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl1sec08"/>Translating database records with the Translate behavior</h2></div></div></div><p>In this recipe, we will learn how to allow translation of database records by means of CakePHP's<code class="literal"> Translate</code> behavior.<a id="id337" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec16"/>Getting ready</h3></div></div></div><p>To go through this recipe, we need a basic application skeleton to work with. Go through the entire recipe<span class="emphasis"><em> Internationalizing controller and view texts</em></span>.<a id="id338" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec17"/>How to do it...</h3></div></div></div><p>From the command line, and while in your<code class="literal"> app/</code> directory, issue the following command:</p><p>If you are on a GNU Linux / Mac / Unix system:</p><div class="informalexample"><pre class="programlisting">../cake/console/cake i18n initdb
</pre></div><p>If you are on Microsoft Windows:</p><div class="informalexample"><pre class="programlisting">..\cake\console\cake.bat i18n initdb
</pre></div><p>Accept all the default answers. The shell should finish by creating a table named<code class="literal"> i18n</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/1926_9_06.jpg" alt="How to do it..."/></div><p>Edit your<code class="literal"> app/models/article.php</code> file and add the following property:<a id="id339" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">&lt;?php
class Article extends AppModel {
public $validate = array(
'title' =&gt; 'notEmpty',
'body' =&gt; 'notEmpty'
);
<span class="strong"><strong>public $actsAs = array(
'Translate' =&gt; array('title', 'body')
);</strong></span>
}
?&gt;
</pre></div><p>We now need to move the values for the<code class="literal"> title</code> and<code class="literal"> body</code> fields from the<code class="literal"> articles</code> table to the<code class="literal"> i18n</code> table, and then drop those fields from the<code class="literal"> articles</code> table. Issue the following SQL statements:</p><div class="informalexample"><pre class="programlisting">INSERT INTO `i18n`(`locale`, `model`, `foreign_key`, `field`, `content`)
SELECT 'eng', 'Article', `articles`.`id`, 'title', `articles`.`title`
FROM `articles`;
INSERT INTO `i18n`(`locale`, `model`, `foreign_key`, `field`, `content`)
SELECT 'eng', 'Article', `articles`.`id`, 'body', `articles`.`body`
FROM `articles`;
ALTER TABLE `articles`
DROP COLUMN `title`,
DROP COLUMN `body`;
</pre></div><p>Add the Spanish translations for our articles by Issuing the following SQL statements:</p><div class="informalexample"><pre class="programlisting">INSERT INTO `i18n`(`locale`, `model`, `foreign_key`, `field`, `content`) VALUES
('spa', 'Article', 1, 'title', 'Primer Artículo'),
('spa', 'Article', 1, 'body', 'Cuerpo para el primer Artículo'),
('spa', 'Article', 2, 'title', 'Segundo Artículo'),
('spa', 'Article', 2, 'body', 'Cuerpo para el segundo Artículo'),
('spa', 'Article', 3, 'title', 'Tercer Artículo'),
('spa', 'Article', 3, 'body', 'Cuerpo para el tercer Artículo');
</pre></div><p>Finally, edit your<code class="literal"> app/config/bootstrap.php</code> file and add the following above the PHP closing tag:</p><div class="informalexample"><pre class="programlisting">Configure::write('Config.language', 'eng');
</pre></div><p>If you now browse to <code class="literal">http://localhost/articles</code>, you should see the same listing of articles, as shown in the first screenshot (recipe<span class="emphasis"><em> Internationalizing controller and view texts</em></span>).</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec18"/>How it works...</h3></div></div></div><p>We start by using the shell to create the table required by the<code class="literal"> Translate</code> behavior. This table is by default named<code class="literal"> i18n</code>, and contains (besides its primary key) the following fields:<a id="id340" class="indexterm"/>
</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Field</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">locale</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The locale (language) this particular record field is being translated to.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">model</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The model where the record being translated belongs.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">foreign_key</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The ID (primary key) in<code class="literal"> model</code> that identifies the record being translated.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The field being translated.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">content</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The translated value for the record field.</p>
</td></tr></tbody></table></div><p>We then add the<code class="literal"> Translate</code> behavior to our<code class="literal"> Article</code> model, and set it to translate the<code class="literal"> title</code> and<code class="literal"> body</code> fields. This means that these fields will no longer be a part of the<code class="literal"> articles</code> table, but instead be stored in the<code class="literal"> i18n</code> table. Using the<code class="literal"> model</code> and<code class="literal"> foreign_key</code> values in the<code class="literal"> i18n</code> table, the<code class="literal"> Translate</code> behavior will fetch the appropriate values for these fields whenever an<code class="literal"> Article</code> record is obtained matching the application language.</p><p>We copy the values of the<code class="literal"> title</code> and<code class="literal"> body</code> fields into the<code class="literal"> i18n</code> table, and we then remove these fields from the<code class="literal"> articles</code> table. No change is needed in the<code class="literal"> find()</code> call that is used in our<code class="literal"> ArticlesController</code> class. Furthermore, the creation of articles will continue to work transparently, as the<code class="literal"> Translate</code> behavior will use the current language when saving records through the<code class="literal"> Article</code> model.</p><p>The final step is telling CakePHP which is the default application language, by setting the<code class="literal"> Config.language</code> configuration setting. If this step is omitted, CakePHP will obtain the current language by looking into the<code class="literal"> HTTP_ACCEPT_LANGUAGE</code> header sent by the client browser.</p><div class="section" title="Using separate translation tables"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec03"/>Using separate translation tables</h4></div></div></div><p>Any model that uses the<code class="literal"> Translate</code> behavior will by default use this<code class="literal"> i18n</code> table to store the different translations for each of its translated fields. This could be troublesome if we have a large number of records, or a large number of translated models. Fortunately, the<code class="literal"> Translate</code> behavior allows us to configure a different translation model.</p><p>As an example, let us assume that we want to store all article translations in a table called<code class="literal"> article_translations</code>. Create the table and then copy the translated records from the<code class="literal"> i18n</code> table by issuing the following SQL statements:<a id="id341" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">CREATE TABLE `article_translations`(
`id` INT UNSIGNED AUTO_INCREMENT NOT NULL,
`model` VARCHAR(255) NOT NULL,
`foreign_key` INT UNSIGNED NOT NULL,
`locale` VARCHAR(6) NOT NULL,
`field` VARCHAR(255) NOT NULL,
`content` TEXT default NULL,
KEY `model__foreign_key`(`model`, `foreign_key`),
KEY `model__foreign_key__locale`(`model`, `foreign_key`, `locale`),
PRIMARY KEY(`id`)
);
INSERT INTO `article_translations`
SELECT `id`, `model`, `foreign_key`, `locale`, `field`, `content`
FROM `i18n`;
</pre></div><p>Create a file named<code class="literal"> article_translation.php</code> and place it in your<code class="literal"> app/models</code> folder, with the following contents:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class ArticleTranslation extends AppModel {
public $displayField = 'field';
}
?&gt;
</pre></div><p>The<code class="literal"> displayField</code> property in the translation model tells the<code class="literal"> Translate</code> behavior which field in the table holds the name of the field being translated.</p><p>Finally, edit your<code class="literal"> app/models/article.php</code> file and make the following changes:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class Article extends AppModel {
public $validate = array(
'title' =&gt; 'notEmpty',
'body' =&gt; 'notEmpty'
);
public $actsAs = array(
'Translate' =&gt; array('title', 'body')
);
<span class="strong"><strong>public $translateModel = 'ArticleTranslation';</strong></span>
}
?&gt;
</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec19"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Setting and remembering the language</em></span></li></ul></div></div></div></div>
<div class="section" title="Setting and remembering the language"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec09"/>Setting and remembering the language</h1></div></div></div><p>In this recipe, we will learn how to allow users to change the current language and have their language selection be remembered through the use of cookies.<a id="id342" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec20"/>Getting ready</h2></div></div></div><p>To go through this recipe we need a fully internationalized application to work with. Go through the entire recipe<span class="emphasis"><em> Translating database records with the Translate behavior</em></span>.</p><p>We also need an application layout that we can modify. Copy the file<code class="literal"> default.ctp</code> from<code class="literal"> cake/libs/view/layouts</code> to your<code class="literal"> app/views/layouts</code> directory.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec21"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Edit your<code class="literal"> app/config/bootstrap.php</code> file and add the following right above the PHP closing tag:<div class="informalexample"><pre class="programlisting">Configure::write('Config.languages', array(
'eng' =&gt; __('English', true),
'spa' =&gt; __('Spanish', true)
));
</pre></div></li><li class="listitem">Edit the<code class="literal"> default.ctp</code> layout file located in your<code class="literal"> app/views/layouts</code> folder and add the following where you want the list of languages to be included (such as right above the call to the<code class="literal"> flash()</code> method of the<code class="literal"> Session</code> component):<div class="informalexample"><pre class="programlisting">&lt;div style="float: right"&gt;
&lt;?php
$links = array();
$currentLanguage = Configure::read('Config.language');
foreach(Configure::read('Config.languages') as $code =&gt; $language) {
if ($code == $currentLanguage) {
$links[] = $language;
} else {
$links[] = $this-&gt;Html-&gt;link($language, array('lang' =&gt; $code));
}
}
echo implode(' - ', $links);
?&gt;
&lt;/div&gt;
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note150"/>Note</h3><p>The Config.language setting used earlier was specified in the<code class="literal"> app/config/bootstrap.php</code> file while going through the<span class="emphasis"><em> Translating database records with the Translate behavior</em></span>.</p></div></li><li class="listitem">Create a file named<code class="literal"> app_controller.php</code> and place it in your<code class="literal"> app/</code> folder, with the following contents:<a id="id343" class="indexterm"/><div class="informalexample"><pre class="programlisting">&lt;?php
class AppController extends Controller {
public $components = array('Language', 'Session');
}
?&gt;
</pre></div></li><li class="listitem">Finally, create a file named<code class="literal"> language.php</code> and place it in your<code class="literal"> app/controller/components</code> folder, with the following contents:<div class="informalexample"><pre class="programlisting">&lt;?php
class LanguageComponent extends Object {
public $controller = null;
public $components = array('Cookie');
public $languages = array();
public function initialize($controller) {
$this-&gt;controller = $controller;
if (empty($languages)) {
$this-&gt;languages = Configure::read('Config.languages');
}
$this-&gt;set();
}
public function set($language = null) {
$saveCookie = false;
if (empty($language) &amp;&amp; isset($this-&gt;controller)) {
if (!empty($this-&gt;controller-&gt;params['named']['lang'])) {
$language = $this-&gt;controller-&gt;params['named']['lang'];
} elseif (!empty($this-&gt;controller-&gt;params['url']['lang'])) {
$language = $this-&gt;controller-&gt;params['url']['lang'];
}
if (!empty($language)) {
$saveCookie = true;
}
}
if (empty($language)) {
$language = $this-&gt;Cookie-&gt;read('language');
if (empty($language)) {
$saveCookie = true;
}
}
if (empty($language) &amp;&amp; !array_key_exists($language, $this-&gt;languages)) {
$language = Configure::read('Config.language');
}
Configure::write('Config.language', $language);
if ($saveCookie) {
$this-&gt;Cookie-&gt;write('language', $language, false, '1 year');
}
}
}
?&gt;
</pre></div></li></ol></div><p>If you now browse to <code class="literal">http://localhost/articles</code> you should see the list of articles, and in the top-right area, a link to switch the current language to<span class="strong"><strong> Spanish</strong></span>. Clicking on it should display the Spanish version of the articles, and change all available texts to the selected language, as shown in the following screenshot:<a id="id344" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1926_9_07.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec22"/>How it works...</h2></div></div></div><p>We start by defining all available languages so that we can easily include a link to switch the current language. We use this list to construct the list of links and place it in the<code class="literal"> default.ctp</code> layout file, only allowing clicks on languages other than the current application language.<a id="id345" class="indexterm"/>
</p><p>The current language is set in CakePHP's configure variable,<code class="literal"> Config.language</code>, which is set to a default language (<code class="literal">eng</code> in our case) in the configuration file<code class="literal"> bootstrap.php</code>. When a language change is needed, this setting should be changed before the first use of a translator function.</p><p>To keep a clean controller, we decided to create a component called<code class="literal"> Language</code> to handle language changes. This component will look for a named or URL parameter called<code class="literal"> lang</code>. If no language is specified, the component will look for the current language by looking into a cookie.</p><p>If no cookie is set, or if a language change is requested, the component will save the current language in a cookie named<code class="literal"> language</code> that lasts for one year.</p></div></div></body></html>