<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Plugin Framework Basics</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Creating a plugin file and header</li>
<li>Adding output content to page headers using plugin actions</li>
<li>Using WordPress path utility functions to load external files and images</li>
<li>Modifying the site generator meta tag using plugin filters</li>
<li>Adding text after each item's content using plugin filters</li>
<li>Inserting link statistics tracking code in page body using plugin filters</li>
<li>Troubleshooting coding errors and printing variable content</li>
<li>Creating a new simple shortcode</li>
<li>Creating a new shortcode with parameters</li>
<li>Creating a new enclosing shortcode</li>
<li>Loading a style sheet to format plugin output</li>
<li>Writing plugins using object-oriented PHP</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>From its very first versions, WordPress has always been designed as a very open platform. This openness has been exemplified not only through its open source licensing and distribution model, but also its open plugin architecture, providing developers with the ability to deliver an even richer experience to its users.</p>
<p>While a basic WordPress installation provides a great amount of functionality that continues to expand from one release to the next, users often have the need to add one more feature to make it the perfect website management system. This is where the plugins come into play. They can fill this gap by augmenting or manipulating virtually any aspect of a WordPress website's display and administrative tasks.</p>
<p>Just like WordPress, plugins are written in the PHP programming language, which is structurally similar to more traditional languages such as C and C++. This code is stored in plain ASCII text files that are read and executed on the web server when pages are requested to be displayed. The secret ingredient that enables plugins to have such great power in WordPress is the inclusion of callback mechanisms, called <strong>hooks</strong>, throughout the platform's source code. These hooks come in two flavors, called action and filter hooks, which allow plugins to add content to a site and modify data before it is displayed, respectively. Whether it's rendering a site's front page, a single article, or its administration pages, WordPress has hundreds of entry points where custom functions can be executed.</p>
<p>Beyond their ability to augment WordPress functionality, a side benefit of plugins is that most functionalities they add to a site are independent of the active theme. Therefore, users who like to change their theme frequently don't have to worry about manually adding back custom elements to their new themes when they make a switch.</p>
<p>This chapter explains the difference between action and filter hooks and shows how to use them to write a first set of plugins that will range in functionality from adding information to the page header to defining new custom shortcodes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a plugin file and header</h1>
                </header>
            
            <article>
                
<p>The first step of creating a WordPress plugin is to create a PHP file inside of the plugins directory and add the necessary information to have it recognized by the system. This first recipe shows you how to create a basic plugin file for WordPress and how to see and activate this new extension from the administration interface.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have access to a WordPress development environment, either on your local computer or a remote server, where you will be able to load your new plugin files.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory (<kbd>wp-content/plugins</kbd>) of your development installation.</li>
<li>Create a new subdirectory called <kbd>ch2-plugin-header</kbd> within the plugin directory.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-plugin-header.php</kbd>.</li>
<li>Open the new file in a text editor and add the following text:</li>
</ol>
<pre style="padding-left: 60px">&lt;?php <br/>/* <br/>Plugin Name: Chapter 2 - Plugin Header <br/>Plugin URI: <br/>Description: Declares a plugin that will be visible in the WordPress admin interface<br/>Version: 1.0 <br/>Author: Yannick Lefebvre <br/>Author URI: http://ylefebvre.ca <br/>License: GPLv2 <br/>*/</pre>
<div class="packt_tip packt_infobox">While the Description text is shown on two separate lines in the code example, it should all be entered on a single line in your code to be completely displayed in the WordPress Installed Plugins list.</div>
<div class="packt_tip"><span class="packt_screen">Downloading the example code</span><strong><br/></strong><span>You can download the example code files for all Packt books you have purchased from your account at <a href="https://www.packtpub.com">https://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a href="https://www.packtpub.com/support">https://www.packtpub.com/support</a> and register to have the files emailed directly to you.</span></div>
<ol start="5">
<li>Save and close the new file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
</ol>
<p> </p>
<ol start="7">
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu to show a list of all the installed plugins. You should see your new plugin listed next to the two default ones that come pre-packaged with WordPress:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="388" width="628" class="image-border" src="assets/772d9de8-2174-415b-9539-ef708d23c100.png"/></div>
<ol start="8">
<li>Enable the plugin by clicking on the <span class="packt_screen">Activate</span> link under its name. You will see that the background color of your new plugin changes to indicate that it has been activated, along with a message specifying that the activation was successful.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Plugin files can either be located directly in the <kbd>wp-content/plugins</kbd> directory or in a subdirectory under this location. When you access the installed plugins list in the administration interface, WordPress scans all potential plugin locations, looking for PHP files that contain comments following the format specified in this recipe. There can actually be one or more PHP files containing plugin header data in any of these directories, and each of them will show up as an entry in the plugin list.</p>
<p>Taking a closer look at the code that we entered in the file, the first line of the plugin file is a tag that identifies the beginning of the PHP code that will be analyzed and executed by the PHP interpreter. Optionally, we could include a closing PHP tag (?&gt;) at the end of the file. However, most PHP developers omit the closing tag, since having any spaces after that tag will cause warnings to be displayed by the interpreter.</p>
<div class="packt_infobox">To ensure compatibility with most WordPress installations, it is important to use the complete <kbd>&lt;?php</kbd> open tag syntax in your plugin code instead of the <kbd>&lt;?</kbd> short-hand version, since not all PHP installations are configured to support the short version and many users don't have access to change this type of configuration on their server.</div>
<p>The second and last lines indicate that the enclosed text should be considered as text comments. Finally, each line within the comment contains a specific label, indicating the type of information that follows it. When this information is found, WordPress retrieves data about the plugin and adds it to the list.</p>
<p>When a plugin is activated, WordPress validates the file's content to be sure that it is valid PHP code. It will then execute this content every time any page is rendered on the site, whether that page is front-facing or a backend administration section. For this reason, it is preferable to activate plugins only when they are in use, to avoid site slowdowns.</p>
<p>Of course, at this point, our new plugin does not add or modify any functionality in our WordPress installation, since it does not contain real code, but this is still an important first step.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Installing a web server on your computer</em> recipe in <a href="bd54bb42-2b11-4ac9-ac09-5e6e66f285b6.xhtml">Chapter 1</a>, <em>Preparing a Local Development Environment</em></li>
<li>The <em>Downloading and configuring a local WordPress installation</em> <span>recipe in</span> <a href="bd54bb42-2b11-4ac9-ac09-5e6e66f285b6.xhtml">Chapter 1</a><span>,</span> <em>Preparing a Local Development Environment</em></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding output content to page headers using plugin actions</h1>
                </header>
            
            <article>
                
<p>A common action performed by plugins is to add extra content to the header of visitor-facing pages generated by WordPress. This recipe shows you how to register an action hook function to be able to add such additional content. To make this example more concrete, we will use the Google Analytics page header JavaScript code that so many people use to get good page view statistics for their site.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol start="1">
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-page-header-output</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-page-header-output.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Page Header Output</kbd>.</li>
<li>Add the following line of code to register a function that will be called when WordPress renders the page header:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'wp_head', 'ch2pho_page_header_output' );</pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2pho_page_header_output</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pho_page_header_output() { ?&gt;<br/>    &lt;script&gt;<br/>        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;<br/>        i[r]=i[r]||function(){<br/>        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();<br/>        a=s.createElement(o),<br/>        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;<br/>        m.parentNode.insertBefore(a,m)})(window,document,'script',<br/>        'https://www.google-analytics.com/analytics.js','ga');<br/><br/>        ga('create', 'UA-0000000-0', 'auto');<br/>        ga('send', 'pageview');<br/>    &lt;/script&gt; <br/>&lt;?php }</pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Navigate to your website's front page and use your browser's <span class="packt_screen">View Page Source</span> function to see the HTML source code for the site. The exact name of this function will be slightly different based on which browser you are using. Reading through the page source code, all of the code contained between the two curled brackets of our new function will be visible on your website's header:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="192" width="780" class="image-border" src="assets/17db98ce-321f-4119-9e83-e35c55547b1b.png"/></div>
<div class="packt_tip packt_infobox">If you are copying and pasting code from a digital version of this book, you will lose the original code indentation and should correct it in your code editor.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>add_action</kbd> function is used to associate custom plugin code to one of the two types of WordPress hooks, the action hook. As mentioned briefly in this chapter's introduction, hooks are the enabling functionality that make plugins possible in WordPress. Action hooks enable the execution of additional code at specific points when either public-facing or administration pages are prepared to be displayed. This code usually adds content to a site or changes the way a given action is performed.</p>
<p>In this recipe, the first line of code that we wrote registered a function named <kbd>ch2pho_page_header_output</kbd> with an action hook called <kbd>wp_head</kbd>. This action is one among more than 2,400 action hooks that are available in current versions of WordPress and it allows any registered function to output additional content to the page header. Since all echoed content will be displayed, we can write our callback function very simply by placing <kbd>?&gt;</kbd> and <kbd>&lt;?php</kbd> tags around the Google Analytics code. This will tell PHP to display all the content that is within that function's body, as opposed to interpreting it.</p>
<p>As you may have noticed, the current code is not very flexible, since you would need to hardcode your Google Analytics account number in the output for it to function properly. The creation of a configuration panel in <a href="0346c3c6-27ee-45fb-bfd6-df398e04b2b4.xhtml"><span class="ChapterrefPACKT">Chapter 3</span></a>, <em>User Settings and Administration Pages</em>, will provide a way to configure such information to make our plugins more flexible.</p>
<p>Now, to fully understand its syntax, let's take a closer look at the complete <kbd>add_action</kbd> function:</p>
<pre style="padding-left: 30px">add_action ( 'hook_name', 'your_function_name', [priority],<br/>             [accepted_args] );</pre>
<p>The first parameter, the hook name, indicates the name of the WordPress hook that we want our custom function to be associated with. This name must be accurately spelled; otherwise, our function will not be called and no error message will be displayed.</p>
<p>The second parameter is the name of the plugin function that will be called to perform an action. This function can have any name, with the only condition being that this name must be unique enough to avoid conflicts with function names from other plugins or from the core WordPress code. In this recipe, the function name starts with an acronym representing the name of the plugin, making it much more unique.</p>
<p>The priority parameter is optional, as indicated by the square brackets, and has a default value of 10. It indicates the execution priority of this plugin relative to other plugin functions that hook into the same action, with a lower number indicating a higher priority.</p>
<p>Any plugin can register one or more functions with an action hook using the <kbd>add_action</kbd> function. As it is rendering web pages, WordPress keeps a queue of all entries and calls them at the appropriate moment. It is interesting to note that the hook mechanism is also used by WordPress itself, as it regularly calls the <kbd>add_action</kbd> function in its own code to register functions to be called at the right time. If you realize that you need your function to be called before or after other plugins that are registering with the same hook, change the value of the priority parameter.</p>
<p>The last parameter of the <kbd>add_action</kbd> function, <kbd>accepted_args</kbd>, has a default value of <kbd>1</kbd> and should be assigned a number. It should also only be set to a different value for some particular hooks where more than one parameter should be passed to the registered function. Some of these hooks will be covered in later recipes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Finding the right hooks to register plugin functions is a large part of WordPress plugin development. Fortunately, there are a number of ways to get information on existing hooks and learn when they get called during the WordPress page generation process.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Action hooks online listings</h1>
                </header>
            
            <article>
                
<p>The WordPress Codex (<a href="https://codex.wordpress.org/">https://codex.wordpress.org/</a>) and WordPress Code Reference (<a href="https://developer.wordpress.org/reference/">https://developer.wordpress.org/reference/</a>) are documentation sites that contain a multitude of information that is useful to users and developers alike. When it comes to action hooks, the Codex contains information on the most commonly used hooks, with basic descriptions indicating how they can be used, and can be found here: <a href="https://codex.wordpress.org/Plugin_API/Action_Reference"><span class="URLPACKT">https://codex.wordpress.org/Plugin_API/Action_Reference</span></a>. That being said, this is not a complete listing.</p>
<p>There are many third-party sites that parse the WordPress source code and provide their own hook listings (for example, <a href="http://hookr.io"><span class="URLPACKT">http://hookr.io</span></a>). While hooks are not as eloquently documented in these types of raw listings, they do provide basic information on their names and where they are called as WordPress generates pages for visitors and administrators. These details can be enough to find a hook based on the functionality that you are trying to implement.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Searching for hooks in the WordPress source code</h1>
                </header>
            
            <article>
                
<p>Since WordPress is open source, another way to find information about hooks is to search directly within its code. For every action hook that accepts user functions, you will see a call to the <kbd>do_action</kbd> function to execute all the registered items. As can be seen, the function takes two or more arguments, with the second one(s) being optional:</p>
<pre style="padding-left: 30px">do_action ( 'tag', [$arg] ); </pre>
<p>For the example shown in this recipe, a search for <kbd>do_action( 'wp_head' )</kbd> reveals that it is the only function that is called when a theme makes a call to the <kbd>wp_head()</kbd> function in its header file:</p>
<pre style="padding-left: 30px">do_action( 'wp_head' ); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a plugin file and header</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using WordPress path utility functions to load external files and images</h1>
                </header>
            
            <article>
                
<p>On occasion, plugins need to refer to external files (for example, images, JavaScript, or jQuery script files) that are stored in the plugin directory. Since users are free to rename a plugin's folder or even install plugin files straight into the WordPress plugin directory, paths to any external files must be built dynamically based on the actual plugin location. Thankfully, a number of utility functions are present to simplify this task. In this recipe, we will write a simple plugin that will add a favicon meta tag to a website's header, pointing to an image file located in the plugin directory.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-favicon</kbd>.</li>
<li>Use a web service, such as <a href="http://getfavicon.org"><span class="URLPACKT">http://getfavicon.org</span></a>, to retrieve a website's favicon (for example, <kbd>http://www.packtpub.com</kbd>) and store it in the plugin directory with its default name (<kbd>favicon.ico</kbd>).</li>
<li>Navigate to the plugin directory and create a new text file called <kbd>ch2-favicon.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Favicon</kbd>.</li>
</ol>
<p> </p>
<ol start="6">
<li>Add the following line of code to register a function that will be called when WordPress renders the page header:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'wp_head', 'ch2fi_page_header_output' ); </pre>
<ol start="7">
<li>Add the following code section to provide an implementation for the <kbd>ch2fi_page_header_output</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2fi_page_header_output() { <br/>    $site_icon_url = get_site_icon_url();<br/>    if ( !empty( $site_icon_url ) ) {<br/>        wp_site_icon();<br/>    } else {<br/>        $icon_url = plugins_url( 'favicon.ico', __FILE__ );<br/>    ?&gt;<br/><br/>    &lt;link rel="shortcut icon" href="&lt;?php echo $icon_url; ?&gt;" /&gt;<br/>    &lt;?php }<br/>}</pre>
<ol start="8">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Navigate to your website's front page and refresh it to see that the icon file that you assigned through your plugin code now appears in your browser's address bar, title bar, or navigation tab, depending on your preferred browser. The following screenshot shows how the favicon file is rendered in Internet Explorer, Mozilla Firefox, and Google Chrome, from top to bottom:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="163" width="484" class="image-border" src="assets/e54ae508-665a-42e1-ac94-64e7d15174e3.png"/></div>
<ol start="13">
<li>Navigate to your development site's dashboard and select the <span class="packt_screen">Customize</span> submenu under the <span class="packt_screen">Appearance</span> menu.</li>
<li>Under <span class="packt_screen">Site Identity</span>, assign a square image that is at least 512 x 512 pixels in dimension as <span class="packt_screen">Site Icon</span>; then, press the <span class="packt_screen">Save &amp; Publish</span> button at the top of the customizer.</li>
<li>Refresh your website to see that the newly assigned site icon is now displayed instead of the <kbd>favicon.ico</kbd> file.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>plugins_url</kbd> utility function, used in conjunction with the <kbd>__FILE__</kbd> PHP constant and the name of our favicon file, enables us to quickly get the URL of the directory where our plugin files are located and print out the appropriate HTML command to notify browsers of the location of this file:</p>
<pre style="padding-left: 30px">plugins_url( $path, $plugin ); </pre>
<p>The <kbd>plugins_url</kbd> function can be called with or without parameters. In the first case, it builds a URL by appending the path found in the first parameter to the location of the file specified in the second argument. In the second situation, it simply returns the location of the plugin directory.<br/>
<br/>
Before we display our plugin's favicon file, we also check to see whether the user has already assigned a site icon using the WordPress customizer. If that is the case, we give priority to that icon and display it using the built-in <kbd>wp_site_icon</kbd> function.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The <kbd>plugins_url</kbd> function is one of the many functions that can be used in plugins to help find the location of files in a WordPress installation. Other useful functions include:</p>
<ul>
<li><kbd>get_theme_root()</kbd>: Returns the address of the theme installation directory</li>
<li><kbd>get_template_directory_uri()</kbd>: Retrieves the URI to the current theme's files</li>
<li><kbd>admin_url()</kbd>: Provides the address of the WordPress administrative pages</li>
<li><kbd>content_url()</kbd>: Indicates where the <kbd>wp-content</kbd> directory can be found</li>
<li><kbd>site_url()</kbd> and <kbd>home_url()</kbd>: Returns the site address</li>
<li><kbd>includes_url()</kbd>: Provides the location of WordPress <kbd>include</kbd> files</li>
<li><kbd>wp_upload_dir()</kbd>: Indicates the directory where user-uploaded files are stored</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a plugin file and header</em> recipe</li>
<li>The <em>Adding output content to page headers using plugin actions</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Modifying the site generator meta tag using plugin filters</h1>
                </header>
            
            <article>
                
<p>Beyond adding functionality or content to a site, the other major task commonly performed by plugins is to augment, modify, or reduce information before it is displayed on the screen. This is done by using WordPress filter hooks, which allow plugins to register a custom function through the WordPress API to be called, since content is prepared before it is sent to the browser. In this recipe, you will learn how to implement your first filter callback function to modify the contents of the generator meta tag that is output as part of the site header.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-generator-filter</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-generator-filter.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Generator Filter</kbd>.</li>
<li>Add the following line of code to register a function that will be called when WordPress is preparing data to output the generator meta tag as part of the page header:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'the_generator', 'ch2gf_generator_filter', 10, 2 ); </pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2gf_generator_filter</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2gf_generator_filter ( $html, $type ) {<br/>    if ( $type == 'xhtml' ) {<br/>        $html = preg_replace( '("WordPress.*?")', <br/>                              '"Yannick Lefebvre"', $html );<br/>    }<br/>    return $html;<br/>} </pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Use a web browser to visit your website and display the page source. Searching for the keyword <kbd>generator</kbd> will reveal that the content generator meta tag has been modified and now reads:</li>
</ol>
<pre style="padding-left: 60px">&lt;meta name="generator" content="Yannick Lefebvre" /&gt;</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>add_filter</kbd> function is used to associate a custom plugin function to the second type of WordPress hooks, the filter hook. Filter hooks give plugins the chance to augment, modify, delete, or completely replace information while WordPress is executed. To enable this, filter functions are sent data that can be modified as a function parameter. They must return the resulting set of data back to WordPress once they have finished making the changes.</p>
<p>Unlike action hooks, filter functions must not output any text or HTML code, since they are executed while output is being prepared and that would likely result in the output showing up in unexpected places in the site layout. Instead, they should return the filtered data.</p>
<p>Taking a closer look at the parameters of the <kbd>add_filter</kbd> function, we can see that it is very similar to the <kbd>add_action</kbd> function that we saw in the previous recipes:</p>
<pre style="padding-left: 30px">add_filter( 'hook_name', 'your_function_name', [priority],<br/>            [accepted_args] ); </pre>
<p>The first parameter, the hook name, indicates the name of the WordPress hook that we want our custom function to be associated with. This name must be accurately spelled; otherwise, our function will not be called and no error message will be displayed.</p>
<p>The second parameter is the name of the plugin function that will be called to filter data. This function can have any name, with the only condition being that this name must be unique enough to avoid conflicting with functions from other plugins or from the WordPress code.</p>
<p>The <kbd>priority</kbd> parameter is optional, as indicated by the square brackets, and has a default value of <kbd>10</kbd>. It indicates the execution priority of this plugin relative to other plugins that are loaded by WordPress, with a lower number indicating a higher priority.</p>
<p>The last parameter of the function, <kbd>accepted_args</kbd>, has a default value of <kbd>1</kbd> and indicates how many parameters will be sent to your custom filter function. It should only be set to higher values when you are using filters that will send multiple parameters, as shown in this recipe with the <kbd>$html</kbd> and <kbd>$type</kbd> arguments.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Beyond demonstrating how to change the site generator name, this plugin also shows how to use an advanced PHP function to perform the actual text replacement. We also take a look at resources to learn more about filter hooks.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">preg_replace function</h1>
                </header>
            
            <article>
                
<p>The <kbd>preg_replace</kbd> function is a PHP function that can be used to perform a search and replace operation within a string based on a search pattern. We use this function rather than the simpler <kbd>str_replace</kbd><span>,</span> since we want to find and replace both the WordPress keyword and its associated version number, which changes with every version.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Filter hooks online listings and the apply_filters function</h1>
                </header>
            
            <article>
                
<p>Similar to action hooks, information about commonly used filter hooks can be found on the WordPress Codex (<a href="https://codex.wordpress.org/Plugin_API/Action_Reference"><span class="URLPACKT">https://codex.wordpress.org/Plugin_API/Action_Reference</span></a>) or on sites that provide raw function lists (for example, <a href="http://hookr.io"><span class="URLPACKT">http://hookr.io</span></a>).</p>
<p>It is also possible to learn about filter hooks by searching for occurrences of the <kbd>apply_filters</kbd> function in the WordPress code. As can be seen in the following code, this function has a variable number of arguments, with the first one being the name of the filter hook, the second representing the value that the registered function will be able to modify, and the remaining optional parameters containing additional data that may be useful in the implementation of the filter function:</p>
<pre style="padding-left: 30px">apply_filters( $tag, $value, $var ... );  </pre>
<p>For the example shown in this recipe, a search for <kbd>apply_filters( 'the_generator'</kbd> in the WordPress code reveals that it is called within the <kbd>the_generator</kbd> template function:</p>
<pre style="padding-left: 30px">echo apply_filters( 'the_generator', <br/>                    get_the_generator( $type ), $type ); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a plugin file and header</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding text after each item's content using plugin filters</h1>
                </header>
            
            <article>
                
<p>After making a number of changes to the page header, the generator meta tag, and the site favicon, this recipe takes a more active role by adding a link to each post or page, allowing visitors to email a link to the item that they are currently viewing. This functionality is implemented using a filter hook attached to the page and post content, allowing our custom function to append custom output code to all entries that get displayed on the screen.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-email-page-link</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-email-page-link.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Email Page Link</kbd>.</li>
</ol>
<p> </p>
<ol start="5">
<li>Visit an icon download website, such as <a href="http://iconarchive.com"><span class="URLPACKT">http://iconarchive.com</span></a>, and download an email icon in a small size (32 x 32 pixels) in PNG format to the new plugin's directory, giving it the name <kbd>mailicon.png</kbd>.</li>
<li>Add the following line of code to register a function that will be called when WordPress is preparing data to display the content of a post or page:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'the_content', 'ch2epl_email_page_filter' ); </pre>
<ol start="7">
<li>Add the following code section to provide an implementation for the <kbd>ch2epl_email_page_filter</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2epl_email_page_filter ( $the_content ) { <br/>     <br/>    // build url to mail message icon downloaded from<br/>    // iconarchive.com <br/>    $mail_icon_url = plugins_url( 'mailicon.png', __FILE__ ); <br/> <br/>    // Set initial value of $new_content variable to previous<br/>    // content <br/>    $new_content = $the_content; <br/><br/>    // Append image with mailto link after content, including <br/>    // the item title and permanent URL <br/>    $new_content .= '&lt;div class="email_link"&gt;';<br/>    $new_content .= '&lt;a href="mailto:someone@somewhere.com?';<br/>    $new_content .= 'subject=Check out this interesting article ';<br/>    $new_content .= 'entitled ' . get_the_title(); <br/>    $new_content .= '&amp;body=Hi!%0A%0AI thought you would enjoy ';<br/>    $new_content .= 'this article entitled '; <br/>    $new_content .= get_the_title() . '.%0A%0A' . get_permalink(); <br/>    $new_content .= '%0A%0AEnjoy!"&gt;';<br/><br/>    if ( !empty( $mail_icon_url ) ) {<br/>        $new_content .= '&lt;img alt="Email icon" ';<br/>        $new_content .= ' src="';<br/>        $new_content .= $mail_icon_url. '" /&gt;&lt;/a&gt;';<br/>    } else {<br/>        $new_content .= 'Email link to this article';<br/>    }<br/>    $new_content .= '&lt;/div&gt;';<br/><br/>    // Return filtered content for display on the site <br/>    return $new_content; <br/>} </pre>
<ol start="8">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Visit your website to see the new mail icon at the end of each post and page.</li>
<li>Click on one of the mail links. Your default mail client will come up with information about the item you were reading. The only information that needs to be updated is the recipient address, and visitors can quickly send an email:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="232" width="417" class="image-border" src="assets/f3b35d84-eed4-4a68-9f23-9d70d276574f.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Similar to the previous recipe, this plugin uses the <kbd>add_filter</kbd> function to register a custom function to be called by WordPress as it prepares an item's content to be displayed on the screen. When the filter function is called, the first action that it performs is to create a URL to the email icon that was downloaded in the recipe. It then goes on to modify the original content by appending the HTML code to display a <kbd>mailto</kbd> link. The same technique could be used to create links to popular social media and link sharing sites, with simple changes to the syntax of the link. Once the new content is ready, it is returned back to WordPress to be sent to any other registered filters and subsequently be displayed on the site.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>This recipe also introduces a pair of useful WordPress utility functions to get access to the current item's content.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">get_the_title and get_permalink functions</h1>
                </header>
            
            <article>
                
<p>While these two functions are mainly seen within theme template files, they can also be used by plugins to get easy access to the content of items that are currently being processed.</p>
<p>More specifically, the two utility functions that are used in this recipe are as follows:</p>
<ul>
<li><kbd>get_the_title()</kbd>: This function gives us quick access to the item's title</li>
<li><kbd>get_permalink()</kbd>: A function that returns the item's permalink (a URL that is always associated with this post or page, even after it is no longer featured on a website's front page)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a plugin file and header</em> recipe</li>
<li>The <em>Using WordPress path utility functions to load external files and images</em> recipe</li>
<li>The <em>Modifying the site generator meta tag using plugin filters</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Inserting link statistics tracking code in page body using plugin filters</h1>
                </header>
            
            <article>
                
<p>After creating two filter functions that append text to the existing content, this recipe shows you how to modify the page content before it is displayed on the screen. More specifically, the following plugin will expand on the Google Analytics header plugin created earlier and add a JavaScript function to all the links that are included in posts and pages to track when they are clicked by visitors.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Adding output content to page headers using plugin actions</em> recipe to have a starting point for this recipe and the resulting plugin should be active in your development site. Alternatively, you can download the resulting code (<kbd>Chapter 2/ch2-page-header-output/ch2-page-header-output.php</kbd>) for that recipe from the Packt Publishing website (<a href="https://www.packtpub.com/support"><span class="URLPACKT">https://www.packtpub.com/support</span></a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch2-page-header-output</kbd> folder in the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch2-page-header-output.php</kbd> file in a text editor.</li>
<li>Add the following line of code after the existing functions to register a function that will be called when WordPress is preparing data to display a page or post's content:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'the_content', 'ch2lfa_link_filter_analytics' ); </pre>
<ol start="4">
<li>Add the following code section to provide an implementation for the <kbd>ch2lfa_link_filter_analytics</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2lfa_link_filter_analytics ( $the_content ) { <br/>    $new_content = str_replace( 'href',  <br/>        'onClick="recordOutboundLink( this );return false;" href'<br/>        , $the_content ); <br/>     <br/>    return $new_content; <br/>} </pre>
<ol start="5">
<li>Add the following line of code to register a function that will be called when WordPress renders the page footer:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'wp_footer', 'ch2lfa_footer_analytics_code' ); </pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2lfa_footer_analytics_code</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2lfa_footer_analytics_code() { ?&gt; <br/>     <br/>&lt;script type="text/javascript"&gt; <br/>    function recordOutboundLink( link ) {<br/>        ga( 'send', 'event', 'Outbound Links', 'Click', <br/>            link.href, {<br/>                'transport': 'beacon',<br/>                'hitCallback': function() { <br/>                    document.location = link.href; <br/>                }<br/>            } );<br/>        }<br/>&lt;/script&gt; <br/> <br/>&lt;?php } </pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Go to the <span class="packt_screen">Pages</span> section of the Dashboard and edit the home page (or any other page). Add a link to the content, pointing to a location of your choice.</li>
<li>In your web browser, refresh your website and navigate to the page modified in the previous step.</li>
<li>Open the source view for the page and find the link you added. You will see that the link tag has additional <kbd>onClick</kbd> JavaScript code that will be called when visitors follow it:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="171" width="607" class="image-border" src="assets/eca034ca-af98-452a-8483-a79ec4559870.png"/></div>
<ol start="11">
<li>Scroll to the bottom of the page to see the implementation of the <kbd>recordOutboundLink</kbd> JavaScript function that was added to the page footer.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The content filter function that is put in place by calling <kbd>add_filter</kbd> receives the entire content of all the posts and pages before they are rendered to the browser and is allowed to make any number of changes to this information. In this case, we are using the PHP <kbd>str_replace</kbd> function to search for any occurrence of the string <kbd>href</kbd>, which indicates a link. When the string is found, it is replaced with a call to a JavaScript function as well as the original <kbd>href</kbd> tag.</p>
<p>To make this plugin complete, it also needs to provide an implementation for the JavaScript <kbd>recordOutboundLink</kbd> function. This is done by registering a custom function with the <kbd>wp_footer</kbd> hook that will output extra content with the function code in the website's footer.</p>
<p>The resulting plugin automates many of the tasks related to tracking usage data on a website using Google Analytics.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Adding output content to page headers using plugin actions</em> recipe</li>
<li>The <em>Adding text after each item's content using plugin filters</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Troubleshooting coding errors and printing variable content</h1>
                </header>
            
            <article>
                
<p>As you transcribe code segments from the pages of this book or start writing your own plugins, there is a strong chance that you will have to troubleshoot problems with your code or have trouble working with data that your plugin is meant to manipulate. This recipe shows the basic techniques to identify and quickly resolve these errors while creating a plugin that will hide an item from the navigation menu for users who are not logged in to your site.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-nav-menu-filter</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-nav-menu-filter.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Nav Menu Filter</kbd>.</li>
</ol>
<p> </p>
<ol start="5">
<li>Add the following line of code to register a function that will be called when WordPress is preparing data to display the site's navigation menu:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'wp_nav_menu_objects', 'ch2nmf_new_nav_menu_items', <br/>            10, 2 ); </pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2nmf_new_nav_menu_items</kbd> function. Notice that the word <kbd>functio</kbd> is mistyped on purpose at the beginning of the first line:</li>
</ol>
<pre style="padding-left: 60px">functio ch2nmf_new_nav_menu_items( $sorted_menu_items, $args ) { <br/>    print_r( $sorted_menu_items ); <br/>    return $sorted_menu_items; <br/>} </pre>
<div class="packt_tip"><span><span><span>If you are using a dedicated code editor, you should be able to tell that the text font is not a recognized keyword since it will not be colored as a PHP keyword.</span></span></span></div>
<ol start="7">
<li>Save the plugin file and leave your code editor open.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>WordPress will display a fatal error message indicating that the plugin could not be activated, since a syntax error was found. It also indicates the exact filename and line where the error occurred, helping to narrow down where the problem occurred:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="160" width="668" class="image-border" src="assets/9716665d-3376-493c-9c07-a8a2e97e94e1.png"/></div>
<ol start="12">
<li>Go back to your code editor, correct the spelling of the word <kbd>function</kbd>, and save the file.</li>
<li><span class="packt_screen">Activate</span> the plugin a second time. It should now activate correctly.</li>
<li>Back in the code editor, remove the last letter of the word kbd&gt;function to reintroduce a syntax error.</li>
<li>Visit your website. You will now see that the entire site has disappeared and your browser only displays a blank page with an error message similar to the one we just saw. You may also only get a blank page, depending on your web server configuration.</li>
<li>Correct the spelling error once again and your website will go back to normal. You will also see a lot of information printed before the navigation menu. This output is generated by the <kbd>print_r</kbd> function and is meant to help us understand how the data received by our filter function is organized. Once we have a good understanding of that data, we will be able to properly make changes to this information in a further step.</li>
<li>In the WordPress dashboard, navigate to the <span class="packt_screen">Appearance</span> | <span class="packt_screen">Menus</span> item and create an additional item in your menu as <span class="packt_screen">Custom Link,</span> setting the <span class="packt_screen">URL</span> to <kbd>/privatearea</kbd> and the <span class="packt_screen">Link Text</span> to <kbd>Private Area</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="309" width="524" class="image-border" src="assets/e870d724-ea54-42cf-8568-8cdc483593af.png"/></div>
<ol start="18">
<li>Click on the <span class="packt_screen">Save</span> <span class="packt_screen">Menu</span> button to store all of your updates.</li>
</ol>
<p> </p>
<ol start="19">
<li>Back in the code editor, replace the <kbd>print_r</kbd> function call inside of the filter function with the following code:</li>
</ol>
<pre style="padding-left: 60px">// Check if used is logged in, continue if not logged <br/>if ( is_user_logged_in() == FALSE ) { <br/>    // Loop through all menu items received <br/>    // Place each item's key in $key variable <br/>    foreach ( $sorted_menu_items as $key =&gt; $sorted_menu_item ) { <br/>        // Check if menu item title matches search string <br/>        if ( 'Private Area' == $sorted_menu_item-&gt;title ) { <br/>            // Remove item from menu array if found using <br/>            // item key <br/>            unset( $sorted_menu_items[ $key ] ); <br/>        } <br/>    } <br/>} </pre>
<ol start="20">
<li>Refresh your website and you will see that the large array printout has disappeared. If you are logged in as the administrator, you will also notice the <span class="packt_screen">Private</span> <span class="packt_screen">Area</span> link in your menu. Log out or use another browser where you are not logged in to your development site to hide the menu item.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>As WordPress assembles a list of all available plugins to display them in the administration interface, it does not check to see if each plugin's PHP code is valid. This check is actually done when a plugin is activated. At that time, any syntax error will be caught immediately and the newly-activated plugin will remain inactive, preventing a failure of the entire website.</p>
<p>That being said, once a plugin is activated, its code is evaluated every time WordPress renders a web page, and any subsequent code error that gets saved to the plugin file will cause the site to stop working correctly. For this reason, it is highly recommended to set up a local development environment, as shown in <a href=""><span class="ChapterrefPACKT">Chapter 1</span></a>, <em>Preparing a Local Development Environment</em>, to avoid affecting a live site when an inevitable error creeps up in your plugin code. On a live website, to avoid potential outages, a safer method is to deactivate plugins before making changes to them, then reactivating them once changes have been made so that they are revalidated before their functionality is enabled. It should be noted that, with this method, the plugin's functionality won't be available on your site while you make changes, so it is not an optimal way to modify deployed code.</p>
<p>Once the code is working correctly, the second part of this recipe shows us how to visualize the information that is received by a custom filter function. While the WordPress Codex website provides great documentation about the purpose of most filters available, it does not go into details about the structure of the information that is sent to each filter function. Thankfully, the PHP <kbd>print_r</kbd> function comes in very handy, since it can display the content of any variable on the screen, no matter what information is stored in the variable it receives as an argument.</p>
<p>Last, but not least, the implementation of the custom filter function uses the WordPress API function <kbd>is_user_logged_in()</kbd> to see whether the person viewing the site has provided login credentials, and then goes on to parse all the menu items and remove the <span class="packt_screen">Private</span> <span class="packt_screen">Area</span> menu item if the visitor is not logged in.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>In addition to the debugging techniques used in this recipe, WordPress offers a number of built-in tools to facilitate plugin troubleshooting.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Built-in WordPress debugging features</h1>
                </header>
            
            <article>
                
<p>While the <kbd>wp-config.php</kbd> file, located at the top of the WordPress file structure, is primarily used to store basic site configuration data, it can also be used to trigger a number of debugging features. The first of these is the debug mode, which will display all PHP errors, warnings, and notices at the top of site pages. For example, having this option active will show all the undefined variables that you try to access in your code along with any deprecated WordPress function. To activate this tool, change the second parameter of the line defining the <kbd>WP_DEBUG</kbd> constant from <kbd>false</kbd> to <kbd>true</kbd> in <kbd>wp_config.php</kbd>:</p>
<pre>define( 'WP_DEBUG', true ); </pre>
<p class="CDPAlignLeft CDPAlign">To prevent debug messages from affecting the site's layout, you can download a useful plugin called Debug Bar (<a href="https://wordpress.org/plugins/debug-bar/"><span class="URLPACKT">https://wordpress.org/plugins/debug-bar/</span></a>) to collect messages and display them in the admin bar:</p>
<div class="CDPAlignCenter CDPAlign"><img height="223" width="537" class="image-border" src="assets/c86f7a7e-95ec-4e14-9390-1e419731c473.png"/></div>
<p>Other debugging features that can be activated from the <kbd>wp-config.php</kbd> file are as follows:</p>
<ul>
<li><kbd>WP_DEBUG_LOG</kbd>: Stores all debug messages in a file named <kbd>debug.log</kbd> in the site's <kbd>wp-content</kbd> directory for later analysis</li>
<li><kbd>WP_DEBUG_DISPLAY</kbd>: Indicates whether or not error messages should be displayed on the screen</li>
<li><kbd>SAVEQUERIES</kbd>: Stores database queries in a variable that can be displayed in the page footer (see <a href="https://codex.wordpress.org/Editing_wp-config.php#Save_queries_for_analysis"><span class="URLPACKT">https://codex.wordpress.org/Editing_wp-config.php#Save_queries_for_analysis</span></a> for more information)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Modifying the site generator meta tag using plugin filters</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new simple shortcode</h1>
                </header>
            
            <article>
                
<p>Shortcodes are a very popular tool in WordPress that allow users to easily add content generated by plugins or themes to any page or post without needing to be familiar with PHP code and editing theme template files. As they are very simple to create, shortcodes can also be used to easily automate the output of content that repeatedly needs to be included in your site's content.</p>
<p>This recipe explains how to create a new custom shortcode that will be used to quickly add a link to a Twitter page in any post or page, automating a repetitive task.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol start="1">
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-twitter-shortcode</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-twitter-shortcode.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Twitter Shortcode</kbd>.</li>
<li>Add the following line of code to declare a new shortcode, simply using the two characters <kbd>tl</kbd>, and specify the name of the function that should be called when the code is encountered in posts or pages:</li>
</ol>
<pre style="padding-left: 60px">add_shortcode( 'tl', 'ch2ts_twitter_link_shortcode' ); </pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2ts_twitter_link_shortcode</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2ts_twitter_link_shortcode( $atts ) {<br/>    $output = '&lt;a href="https://twitter.com/ylefebvre"&gt;';<br/>    $output .= 'Twitter Feed&lt;/a&gt;';<br/>    return $output;<br/>} </pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Edit an existing post on your site and use the shortcode <span class="packt_screen">[tl]</span> in the code editor:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="63" width="365" class="image-border" src="assets/fb47c2b2-1b3a-4b95-8f5c-2714a920a959.png"/></div>
<ol start="12">
<li>Save and view the post to see that the shortcode was replaced by a link to a Twitter page attached to the words <span class="packt_screen">Twitter Feed</span>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Shortcodes have similarities with both action hooks and filter hooks, since their associated custom function is called when it is time to perform a task, just like an action hook, but they must return their output through a return value, just like a filter hook. In terms of external data, the function associated with a shortcode will receive data in the case of some types of codes, while it will only produce output in other cases.</p>
<p>When used in the text of a post or page, any shortcode surrounded by a pair of square brackets is identified by the WordPress engine, which then searches for functions registered for that specific code. If found, the associated function is called and the expected result is used to replace the original shortcode text in the item's content. Just like filter functions, shortcode functions must not output any text directly, since it would likely appear in an unexpected place in the page layout, as WordPress calls all shortcode-processing functions before displaying the body of an item.</p>
<p>For simple shortcodes, such as those in this recipe, the plugin functions associated with them must return information, but they do not receive any additional data through function parameters. That being said, they can rely on utility functions, such as <kbd>get_the_ID</kbd>, <kbd>get_the_title</kbd>, and other WordPress utility functions, to be able to produce the appropriate output. Other types of shortcodes seen in later recipes will have more context and configuration options. It is also possible for shortcodes to access stored options data, which will be covered in <a href="0346c3c6-27ee-45fb-bfd6-df398e04b2b4.xhtml"><span class="ChapterrefPACKT">Chapter 3</span></a>, <em>User Settings and Administration Pages</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a plugin file and header</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new shortcode with parameters</h1>
                </header>
            
            <article>
                
<p>While simple shortcodes already provide a lot of potential to output complex content to a page by entering a few characters in the post editor, shortcodes become even more useful when they are coupled with parameters that will be passed to their associated processing function. Using this technique, it becomes very easy to create a shortcode that accelerates the insertion of external content in WordPress posts or pages by only needing to specify the shortcode and the unique identifier of the source element to be displayed.</p>
<p>We will illustrate this concept in this recipe by creating a shortcode that will be used to quickly add Twitter feeds to posts or pages.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-twitter-embed</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-twitter-embed.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Twitter Embed</kbd>.</li>
<li>Add the following line of code to declare a new shortcode and specify the name of the function that should be called when the shortcode is found in posts or pages:</li>
</ol>
<pre style="padding-left: 60px">add_shortcode( 'twitterfeed', 'ch2te_twitter_embed_shortcode' );</pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2te_twitter_embed_shortcode</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2te_twitter_embed_shortcode( $atts ) {<br/>    extract( shortcode_atts( array(<br/>        'user_name' =&gt; 'ylefebvre'<br/>    ), $atts ) );<br/><br/>    if ( !empty( $user_name ) ) {<br/>        $output = '&lt;a class="twitter-timeline" href="'; <br/>        $output .= esc_url( 'https://twitter.com/' . $user_name );<br/>        $output .= '"&gt;Tweets by ' . esc_html( $user_name );<br/>        $output .= '&lt;/a&gt;&lt;script async ';<br/>        $output .= 'src="//platform.twitter.com/widgets.js"';<br/>        $output .= ' charset="utf-8"&gt;&lt;/script&gt;';<br/>    } else {<br/>        $output = '';<br/>    }<br/>    return $output;<br/>}</pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Create a new page and use the shortcode <kbd>[twitterfeed user_name='WordPress']</kbd> in the page editor, where <kbd>WordPress</kbd> is the Twitter username of the feed to display:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="72" width="521" class="image-border" src="assets/8dff22ef-cadd-402b-a39d-f877bcea83d6.png"/></div>
<ol start="12">
<li><span class="packt_screen">Publish</span> and <span class="packt_screen">view</span> the page to see that the shortcode has been replaced by an embedded Twitter feed on your site.</li>
<li><span class="packt_screen">Edit</span> the page and remove the <kbd>user_name</kbd> parameter and its associated value, only leaving the core <kbd>[twitterfeed]</kbd> shortcode in the post, then <span class="packt_screen">Update</span> to save changes.</li>
<li>Refresh the page and see that the feed is still being displayed, but now shows tweets from another account.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>When shortcodes are used with parameters, these extra pieces of data are sent to the associated processing function in the <kbd>$atts</kbd> parameter variable. By using a combination of the standard PHP <kbd>extract</kbd> and WordPress-specific <kbd>shortcode_atts</kbd> functions, our plugin is able to parse the data sent to the shortcode and create an array of identifiers and values that are subsequently transformed into PHP variables that we can use in the rest of our shortcode implementation function. In this specific example, we expect a single variable to be used, called <kbd>user_name</kbd>, which will be stored in a PHP variable called <kbd>$user_name</kbd>. If the user enters the shortcode without any parameter, a default value of <kbd>ylefebvre</kbd> will be assigned to the username variable to ensure that the plugin still works. Since we are going to accept user input in this code, we also verify that the user did not provide an empty string and we use the <kbd>esc_html</kbd> and <kbd>esc_url</kbd> functions to remove any potentially harmful HTML characters from the input string and make sure that the link destination URL is valid.</p>
<p>Once we have access to the Twitter username, we can put together the required HTML code that will embed a Twitter feed in our page and display the selected user's tweets.</p>
<p>While this example only has one argument, it is possible to define multiple parameters for a shortcode.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a new simple shortcode</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new enclosing shortcode</h1>
                </header>
            
            <article>
                
<p>A different type of shortcode is available in WordPress that encloses content in posts and pages. Using a syntax similar to HTML tags, enclosing shortcodes can be used to identify parts of an item's content that need to be treated in a special way. For example, it is possible to use this type of shortcode to style a part of the post.</p>
<p>As an example of how to create enclosing shortcodes, this recipe shows you how to create a set of tags that will identify part of a post or page that should only be shown to visitors that are logged in to a site. In this way, the shortcode acts similarly to a filter hook, with the added bonus that you do not need to parse for instances of these tags, as would normally be done in a filter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch2-private-item-text</kbd>.</li>
<li>Navigate to this directory and create a new text file called <kbd>ch2-private-item-text.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 2 - Private Item Text</kbd>.</li>
<li>Add the following line of code to declare a new shortcode and specify the name of the function that should be called when the shortcode is found in posts or pages:</li>
</ol>
<pre style="padding-left: 60px">add_shortcode( 'private', 'ch2pit_private_shortcode' ); </pre>
<ol start="6">
<li>Add the following code section to provide an implementation for the <kbd>ch2pit_private_shortcode</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_private_shortcode( $atts, $content = null ) { <br/>    if ( is_user_logged_in() ) {<br/>        return '&lt;div class="private"&gt;' . $content . '&lt;/div&gt;'; <br/>    } else {<br/>        $output = '&lt;div class="register"&gt;';<br/>        $output .= 'You need to become a member to access ';<br/>        $output .= 'this content.&lt;/div&gt;';<br/>        return $output;<br/>    }<br/>} </pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> your new plugin.</li>
<li>Create a new post and wrap some of the content with the <span class="packt_screen">[private]</span> and <span class="packt_screen">[/private]</span> tags:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="114" width="449" class="image-border" src="assets/dfa02604-2b29-4099-a5c6-a5f79a83e9ac.png"/></div>
<ol start="12">
<li>Save and view the post to see that the text is visible while you are logged in to your site.</li>
<li>Log out and refresh the page to see that the enclosed text has been replaced by a general message.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Similar to a filter function, enclosing shortcodes receive a copy of the text that has been wrapped with the new tags. It is then possible to return this text with additional HTML code, or completely replace it with new content. In this specific case, we used the <kbd>is_user_logged_in</kbd> WordPress function to determine whether the current visitor is logged in to the site. Based on the result of that query, the code determines whether the original content should be displayed with some additional styling code, or if the visitor should see a message encouraging them to join the website.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a new simple shortcode</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Loading a style sheet to format plugin output</h1>
                </header>
            
            <article>
                
<p>When a plugin adds custom content or inserts styling tags to a post or page's existing content, as was done in the previous recipe showing how to create an enclosing shortcode, it usually needs to load a custom style sheet to style these new elements. This recipe shows how to add a style sheet in the WordPress style queue to format the private output created in the previous recipe. This queue is processed when the page header is rendered, listing all the style sheets that need to be loaded to display the site correctly.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Creating a new enclosing shortcode</em> recipe to have a starting point for this recipe and the resulting plugin should still be active in your development site. Alternatively, you can download the resulting code (<kbd>Chapter 2/ch2-private-item-text/ch2-private-item-text.php</kbd>) of that recipe from the Packt website (<a href="https://www.packtpub.com/support"><span class="URLPACKT">https://www.packtpub.com/support</span></a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch2-private-item-text</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch2-private-item-text.php</kbd> file in a text editor.</li>
<li>Add the following line of code after the existing functions to register a function that will be called at the beginning of the WordPress page display process:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'wp_enqueue_scripts', 'ch2pit_queue_stylesheet' ); </pre>
<ol start="4">
<li>Add the following code section to provide an implementation for the <kbd>ch2pit_queue_stylesheet</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_queue_stylesheet() { <br/>    wp_enqueue_style( 'privateshortcodestyle',<br/>                      plugins_url( 'stylesheet.css', __FILE__ ) ); <br/>} </pre>
<ol start="5">
<li>Save and close the plugin file.</li>
<li>Create a new text file in the plugin's directory called <kbd>stylesheet.css</kbd> and open it in a code editor.</li>
<li>Add the following content to the file:</li>
</ol>
<pre style="padding-left: 60px">.private {  <br/>    color: #6E6A6B; <br/>}<br/><br/>.register { <br/>    background-color: #ff4d4d;<br/>    color: #fff;<br/>    padding-left: 10px;<br/>} </pre>
<ol start="8">
<li>Save and close the text file.</li>
<li>Navigate to your website, making sure you are logged in, and refresh the page containing the private text content. You should notice that the text is now displayed in gray.</li>
<li>Log out of the site and refresh the page to see that the registration message styling has also changed.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>While it would have been possible to write straight HTML code to load the CSS file by registering a function with the <kbd>wp_head</kbd> action hook, as we have done previously, WordPress has utility functions designed to help avoid loading duplicate style sheets or scripts on a site. In this specific example, <kbd>wp_enqueue_script</kbd> is used to place the plugin's style sheet file in a queue that will be processed when the plugin header is rendered, with the associated name <kbd>privateshortcodestyle</kbd>. Once WordPress has processed all the plugins and boiled down all the style sheet requests to single instances, it will output the necessary HTML code to load all of them.</p>
<p>The content of the <kbd>stylesheet.css</kbd> file is normal CSS code that specifies that any text that is assigned the <kbd>private</kbd> class should be displayed in gray, while the text displayed to non-registered users should be displayed in white on a red background.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a new enclosing shortcode</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Writing plugins using object-oriented PHP</h1>
                </header>
            
            <article>
                
<p>So far, all plugin examples that have been covered in this chapter have been written using the procedural PHP programming style, with all the functions declared directly in the main body of the plugin and the hook registration functions having direct access to these functions.</p>
<p>WordPress can also be written using an object-oriented PHP approach. This recipe explains how to convert the code from the previous recipe into a class-based version of the same functionality.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Loading a style sheet to format plugin output</em> recipe to have a starting point for this recipe. Alternatively, you can download the resulting code (<kbd>Chapter 2/ch2-private-item-text/ch2-private-item-text-v2.php</kbd>) for that recipe from the Packt Publishing website (<a href="https://www.packtpub.com/support"><span class="URLPACKT">https://www.packtpub.com/support</span></a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol start="1">
<li>Log in to the administration page of your WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li>Check whether the <kbd>Chapter 2 - Private Item Text</kbd> plugin is currently active and deactivate it if it is.</li>
<li>Copy the entire contents of the <kbd>ch2-private-item-text</kbd> directory and rename the copy <kbd>ch2-oo-private-item-text</kbd>.</li>
<li>Navigate to the newly renamed folder and rename the main PHP code file <kbd>ch2-oo-private-item-text.php</kbd>.</li>
<li>Open the newly renamed plugin file in a code editor.</li>
</ol>
<p> </p>
<ol start="7">
<li>Update the plugin header to change the name of the plugin to <kbd>Chapter 2 - Object-Oriented - Private Item Text</kbd>.</li>
<li>Right after the plugin header, add the following text to declare a new class for our plugin and specify a constructor method for this class:</li>
</ol>
<pre style="padding-left: 60px">class CH2_OO_Private_Item_Text {      <br/>    function __construct() { <br/>    }      <br/>} <br/>     <br/>$my_ch2_oo_private_item_text = new CH2_OO_Private_Item_Text(); </pre>
<ol start="9">
<li>Move the calls to the <kbd>add_shortcode</kbd> and <kbd>add_action</kbd> functions to be placed inside of the class constructor.</li>
<li>Modify the second argument of the <kbd>add_shortcode</kbd> and <kbd>add_action</kbd> functions as follows:</li>
</ol>
<pre style="padding-left: 60px">add_shortcode( 'private', <strong>array( $this, </strong><br/><strong>               'ch2pit_private_shortcode' )</strong> ); <br/> <br/>add_action( 'wp_enqueue_scripts', <strong>array( $this, </strong><br/><strong>            'ch2pit_queue_stylesheet' )</strong> ); </pre>
<ol start="11">
<li>Move the complete <kbd>ch2pit_private_shortcode</kbd> and <kbd>ch2pit_queue_stylesheet</kbd> functions inside of the class body (after the constructor method and before the class closing bracket).</li>
<li>Save and close the modified file.</li>
<li>Log in to the administration page of your development WordPress installation.</li>
<li>Click on <span class="packt_screen">Plugins</span> in the left-hand navigation menu.</li>
<li><span class="packt_screen">Activate</span> the new plugin.</li>
<li>Visit your site to see that the private item content functionality is still in place and works as it did before.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The code changes that we applied to the plugin first declare a class for all of our plugin's functionality and also contain a constructor method for that class. The constructor method is called once, as soon as the class is instantiated by the last line in the plugin's code, and can be used to associate custom functions with all action hooks, filter hooks, and shortcodes.</p>
<p>The main benefit of using an object-oriented approach is that you don't have to be as careful when naming your hook callbacks and all other functions, since these names are local to the class and can be the same as function names declared in any other classes or in procedural PHP code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Creating a new enclosing shortcode</em> recipe</li>
</ul>


            </article>

            
        </section>
    </body></html>