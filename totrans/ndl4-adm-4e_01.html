<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer030">
<h1 class="chapter-number" id="_idParaDest-21" lang="en-GB"><a id="_idTextAnchor020"/>1</h1>
<h1 id="_idParaDest-22" lang="en-GB"><a id="_idTextAnchor021"/>Installing Moodle</h1>
<p lang="en-GB">In this first chapter, we’ll start by <span class="No-Break" lang="">installing Moodle.</span></p>
<p lang="en-GB">After providing an overview describing the most suitable setup, we will outline the necessary software and hardware requirements before covering the <span class="No-Break" lang="">following installations:</span></p>
<ul>
<li lang="en-GB">Installing Moodle in a <span class="No-Break" lang="">LAMP environment</span></li>
<li lang="en-GB">Installing Moodle via the <strong class="bold" lang="">command-line </strong><span class="No-Break" lang=""><strong class="bold" lang="">interface</strong></span><span class="No-Break" lang=""> (</span><span class="No-Break" lang=""><strong class="bold" lang="">CLI</strong></span><span class="No-Break" lang="">)</span></li>
<li lang="en-GB">Upgrading Moodle manually and via the CLI <span class="No-Break" lang="">and Git</span></li>
</ul>
<p lang="en-GB">We won’t be covering the installation on operating systems other than Linux, but we will provide some pointers to resources for Windows <span class="No-Break" lang="">and macOS.</span></p>
<p lang="en-GB">Moodle can be scaled from a single instructor to an entire institution. We will only cover <em class="italic" lang="">basic</em> installations and present solutions to some common problems. We will also assume you are familiar with basic Linux <span class="No-Break" lang="">system administration.</span></p>
<p lang="en-GB">In this chapter, we will be covering the <span class="No-Break" lang="">following topics:</span></p>
<ul>
<li lang="en-GB">Preparing your <span class="No-Break" lang="">Moodle installation</span></li>
<li lang="en-GB">Installation in a <span class="No-Break" lang="">LAMP environment</span></li>
<li lang="en-GB">Installation via the <span class="No-Break" lang="">command-line interface</span></li>
<li lang="en-GB"><span class="No-Break" lang="">Updating Moodle</span></li>
</ul>
<h1 id="_idParaDest-23" lang="en-GB"><a id="_idTextAnchor022"/>Preparing your Moodle installation</h1>
<p lang="en-GB">Before you start <a id="_idIndexMarker000"/>installing Moodle, you have to decide which setup is right for your organization. Once you have decided, there are several hardware and software prerequisites you have to fulfill before you can <span class="No-Break" lang="">get started.</span></p>
<h2 id="_idParaDest-24" lang="en-GB"><a id="_idTextAnchor023"/>Choosing your best setup</h2>
<p lang="en-GB">There are many <a id="_idIndexMarker001"/>different environments in which you can set up Moodle. The three main criteria that will help you determine the correct setup are <span class="No-Break" lang="">as follows:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Flexibility</strong>: If you<a id="_idIndexMarker002"/> want to have complete control over your system, install plugins, be able to tweak system settings, and make frequent changes to the setup, you should host your own server. However, if your preferred choice is to only administer Moodle while somebody else is looking after the operating system, the web server, and backups, it is better to opt for a professionally-hosted setup, particularly the offerings provided by authorized <span class="No-Break" lang="">Moodle Partners.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Scalability</strong>: This is entirely driven by the number of active learners and educators logged in to Moodle simultaneously. Moodle on a small server will not be able to cope with hundreds of concurrently logged-in users. On the other hand, a load-balanced cluster would be overkill for a small institution with a few dozen learners. The following table provides some indicative setups for different types of <span class="No-Break" lang="">educational organizations:</span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer007">
<img alt="Figure 1.1 – Moodle setups depending on user numbers " height="255" src="image/Figure_1.01_B18779.jpg" width="1040"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Moodle setups depending on user numbers</p>
<p lang="en-GB">Please bear in mind that these are only indicative numbers that are not written in stone and also depend on the other factors <span class="No-Break" lang="">mentioned here.</span></p>
<p lang="en-GB">Each Moodle instance must be installed on a dedicated or shared server, either hosted in-house or externally. If you decide to go down the hosted route, avoiding a cheap hosting package is highly recommended as those systems are not optimized for Moodle usage; their one-size-fits-all approach will significantly impact the system’s performance, especially with an increasing number of <span class="No-Break" lang="">concurrent users.</span></p>
<p lang="en-GB">Moodle HQ <a id="_idIndexMarker003"/>offers hosting on <a href="http://moodlecloud.com">moodlecloud.com</a>; however, these packages come with <a id="_idIndexMarker004"/>some limitations (the numbers depend on the chosen plan): user limits, storage limits, no way to install plugins or custom themes, and the inability to modify some hard-coded admin settings. If these restrictions are acceptable, hosting on <a href="http://moodlecloud.com">moodlecloud.com</a> might be suitable for <span class="No-Break" lang="">your organization.</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Cost</strong>: Budgetary<a id="_idIndexMarker005"/> constraints will undoubtedly play an important role. Unless you already have the appropriate infrastructure in place, it will likely be more cost effective to host your Moodle system externally as it saves you from purchasing servers and renting a 24/7 data connection that caters to your users’ needs. The licensing cost will be significantly higher if you use commercial operating systems, web servers, and database systems instead of an open source solution. Either way, Moodle is designed to support a wide range of possible infrastructures suitable to your organization’s <span class="No-Break" lang="">IT policy.</span></li>
</ul>
<p lang="en-GB">In addition to these three criteria, which influence the decision about the underlying infrastructure, other factors, such as <strong class="bold" lang="">in-house expertise</strong>, <strong class="bold" lang="">compatibility with other systems</strong>, <strong class="bold" lang="">IT policies</strong>, <strong class="bold" lang="">personal preference</strong>, and <strong class="bold" lang="">existing resources</strong>, will impact <span class="No-Break" lang="">your decision.</span></p>
<p lang="en-GB">We will be covering the most popular operating system for hosting Moodle – Linux. For other operating systems or setups, such as in virtualized environments or on multi-server clusters, please consult your local Moodle Partner (<a href="http://moodle.com/solutions/certified-service-providers">moodle.com/solutions/certified-service-providers</a>). Some hosting companies offer quick one-click installations; while the resulting Moodle system is sufficient for experimental sites, it is certainly unsuitable for <span class="No-Break" lang="">production environments.</span></p>
<h2 id="_idParaDest-25" lang="en-GB"><a id="_idTextAnchor024"/>Fulfilling Moodle prerequisites</h2>
<p lang="en-GB">Several<a id="_idIndexMarker006"/> hardware and software requirements must be satisfied before we can start <span class="No-Break" lang="">installing Moodle.</span></p>
<h3 lang="en-GB">Hardware requirements</h3>
<p lang="en-GB">These<a id="_idIndexMarker007"/> requirements apply if you host Moodle yourself or if it is hosted on an external server (shared, virtual, dedicated, or clustered). On cheaper hosting packages, the hardware configuration is often insufficient to run <span class="No-Break" lang="">Moodle efficiently:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer008">
<img alt="Figure 1.2 – Moodle hardware " height="309" src="image/Figure_1.02_B18779.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Moodle hardware</p>
<p lang="en-GB">Let’s take a look at these requirements in <span class="No-Break" lang="">more detail:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Disk space</strong>: Moodle <a id="_idIndexMarker008"/>itself takes up approximately 1 GB of disk space. However, this only provides you with a naked system and does not consider the space you require for any learning resources. The faster the disks, the better. RAIDed disks are recommended but are not essential on <span class="No-Break" lang="">smaller installations.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Memory</strong>: A good <a id="_idIndexMarker009"/>rule of thumb is to have 1 GB of RAM for every 5 to 10 <strong class="bold" lang="">concurrent</strong> users. You have to double this calculation on Windows-based systems due to the higher overhead of the operating system. Of all the hardware components, RAM will impact Moodle’s performance <span class="No-Break" lang="">the most.</span></li>
</ul>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">The more RAM, the better; the faster the RAM, <span class="No-Break" lang="">the better.</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">CPUs</strong>: Processor <a id="_idIndexMarker010"/>type and speed are essential too, but not as important as RAM. As always, the faster the CPU, the better, and the more cores a CPU has, the more powerful it <span class="No-Break" lang="">will be.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Network</strong>: While <a id="_idIndexMarker011"/>Moodle can run on a standalone machine, its full potential is in a networked environment. Fast network cards are essential, as is good upload and download<a id="_idIndexMarker012"/> speed if the LMS is accessed over <span class="No-Break" lang="">the internet.</span></li>
</ul>
<p lang="en-GB">Now, let’s look at the <span class="No-Break" lang="">software requirements.</span></p>
<h3 lang="en-GB">Software requirements</h3>
<p lang="en-GB">While it is<a id="_idIndexMarker013"/> recommended to have the latest version installed, for Moodle 4, you must have the following components up and running on your server (release-specific notes can be found <span class="No-Break" lang="">at </span><a href="http://moodledev.io/general/releases"><span class="No-Break" lang="">moodledev.io/general/releases</span></a><span class="No-Break" lang="">):</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Database</strong>: Moodle<a id="_idIndexMarker014"/> officially supports the following database systems: MySQL (version 5.7 or later utilizing the ACID-compliant InnoDB storage engine), PostgreSQL 10+, MariaDB 10.2.29+, Aurora MySQL (on Amazon Web Services), Microsoft SQL Server 2017+, and <span class="No-Break" lang="">Oracle 11.2+.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Web server</strong>: Apache<a id="_idIndexMarker015"/> is the preferred web server option, but Moodle works well with any other web server that supports PHP, such as <span class="No-Break" lang="">Microsoft IIS.</span></li>
<li lang="en-GB"><strong class="bold" lang="">PHP</strong>: PHP 7.3.0 is <a id="_idIndexMarker016"/>the minimum PHP version for running Moodle 4; PHP 7.4.0 is the minimum version from Moodle 4.1 onwards. PHP 8 is also supported. You might have to change some PHP settings in the <strong class="source-inline" lang="">php.ini</strong> or <strong class="source-inline" lang="">.htaccess</strong> file (for more details, <span class="No-Break" lang="">see </span><span class="No-Break" lang="">docs.moodle.org/en/Installing_Moodle</span><span class="No-Break" lang="">).</span></li>
<li lang="en-GB"><strong class="bold" lang="">PHP extensions</strong>: Moodle <strong class="bold" lang="">makes</strong> use of several extensions, most of which are compiled<a id="_idIndexMarker017"/> into PHP by default. They<a id="_idIndexMarker018"/> are <a id="_idIndexMarker019"/><span class="No-Break" lang="">as</span><span class="No-Break" lang=""><a id="_idIndexMarker020"/></span><span class="No-Break" lang=""> follows:</span><ul><li lang="en-GB"><strong class="bold" lang="">Compulsory extensions</strong>: <strong class="source-inline" lang="">curl</strong>, <strong class="source-inline" lang="">ctype</strong>, <strong class="source-inline" lang="">dom</strong>, <strong class="source-inline" lang="">fileinfo</strong>, <strong class="source-inline" lang="">gd</strong>, <strong class="source-inline" lang="">hash</strong>, <strong class="source-inline" lang="">iconv</strong>, <strong class="source-inline" lang="">intl</strong>, <strong class="source-inline" lang="">json</strong>, <strong class="source-inline" lang="">mbstring</strong>, <strong class="source-inline" lang="">openssl</strong>, <strong class="source-inline" lang="">pcre</strong>, <strong class="source-inline" lang="">simplexml</strong>, <strong class="source-inline" lang="">spl</strong>, <strong class="source-inline" lang="">xml</strong>, <strong class="source-inline" lang="">xmlreader</strong>, <strong class="source-inline" lang="">zip</strong>, <span class="No-Break" lang="">and </span><span class="No-Break" lang=""><strong class="source-inline" lang="">zlib</strong></span></li><li lang="en-GB"><strong class="bold" lang="">Recommended extensions</strong>: <strong class="source-inline" lang="">exif</strong>, <strong class="source-inline" lang="">soap</strong>, <strong class="source-inline" lang="">sodium</strong>, <strong class="source-inline" lang="">tokenizer</strong>, <span class="No-Break" lang="">and </span><span class="No-Break" lang=""><strong class="source-inline" lang="">xmlrpc</strong></span></li><li lang="en-GB"><strong class="bold" lang="">Conditional extensions</strong>: <strong class="source-inline" lang="">mysql</strong>, <strong class="source-inline" lang="">odbc</strong>, and <strong class="source-inline" lang="">pgsql</strong> (depending on the database) and <strong class="source-inline" lang="">ldap</strong>, <strong class="source-inline" lang="">ntlm</strong>, and others (depending on the authentication <span class="No-Break" lang="">mechanism used)</span></li></ul></li>
</ul>
<p lang="en-GB">Depending on <a id="_idIndexMarker021"/>your specific setup, additional software might be required. It is assumed that the database, web server, PHP, and extensions have been installed correctly, as this is not an LMS administrator task. Once this is the case, we are ready <span class="No-Break" lang="">to go.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">To access Moodle, a modern web browser (the latest version of Firefox, Google Chrome, Edge, or Safari) <span class="No-Break" lang="">is required.</span></p>
<p lang="en-GB">Before we start the installation process, it is worth familiarizing yourself with Moodle’s releases <span class="No-Break" lang="">and versions.</span></p>
<h2 id="_idParaDest-26" lang="en-GB"><a id="_idTextAnchor025"/>Understanding Moodle versions</h2>
<p lang="en-GB">Moodle versions<a id="_idIndexMarker022"/> follow a strict calendar that is published and updated regularly <a id="_idIndexMarker023"/>on <a href="http://moodledev.io/general/releases">moodledev.io/general/releases</a>. If a planned feature is not ready for the imminent release, it will be moved to the next version; that is, a release date will never be changed, but the time when features will be introduced <span class="No-Break" lang="">might be.</span></p>
<p lang="en-GB">The release frequency <a id="_idIndexMarker024"/>for <strong class="bold" lang="">major versions</strong> (4.0, 4.1, and so on) is twice a year (the second Monday of May <span class="No-Break" lang="">and November).</span></p>
<p lang="en-GB">Moodle<a id="_idIndexMarker025"/> releases <strong class="bold" lang="">minor versions</strong> (4.1.1, 4.1.2, and so on) on the second Monday of March, May, July, September, and November. The same applies to unscheduled releases in the case of a severe security issue or serious regression <span class="No-Break" lang="">being fixed.</span></p>
<p lang="en-GB">Moodle distinguishes between two types <span class="No-Break" lang="">of releases:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Standard support release</strong>: Bugs<a id="_idIndexMarker026"/> will be fixed for 12 months, and security issues will be provided for <span class="No-Break" lang="">18 months</span></li>
<li lang="en-GB"><strong class="bold" lang="">Long-term support release</strong>: Bugs <a id="_idIndexMarker027"/>will be fixed for 12 months, and security issues will be provided for <span class="No-Break" lang="">36 months</span></li>
</ul>
<p lang="en-GB">The simplified release calendar is shown in the following timeline; you can find a more detailed version <span class="No-Break" lang="">at </span><a href="http://moodledev.io/general/releases"><span class="No-Break" lang="">moodledev.io/general/releases</span></a><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer009">
<img alt="Figure 1.3 – Moodle releases " height="717" src="image/Figure_1.03_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – Moodle releases</p>
<p lang="en-GB">When Moodle 4.0 was released in April 2022, versions 3.9 to 3.11 were still supported. By the time Moodle 4.1 is released, only version 3.9 will be supported since its lifetime has been extended (hence the long-long-term support label) to give admins more time to upgrade to the version <span class="No-Break" lang="">4 branch.</span></p>
<p lang="en-GB">If you wish to stay up-to-date with future<a id="_idIndexMarker028"/> releases, check Moodle’s roadmap at <a href="http://moodledev.io/general/community/roadmap">moodledev.io/general/community/roadmap</a>, where you will find the current plans for the future technical development of all Moodle’s products <span class="No-Break" lang="">and services.</span></p>
<p lang="en-GB">OK, enough of version numbers and release dates. Let’s learn how to install (the latest version <span class="No-Break" lang="">of) Moodle.</span></p>
<h1 id="_idParaDest-27" lang="en-GB"><a id="_idTextAnchor026"/>Installation in a LAMP environment</h1>
<p lang="en-GB">Moodle is <a id="_idIndexMarker029"/>developed in Linux using Apache, MySQL, and PHP (known as the <strong class="bold" lang="">LAMP stack</strong>). If you<a id="_idIndexMarker030"/> have a choice, this is the preferred environment<a id="_idIndexMarker031"/> to use. There is an ongoing debate about whether PostgreSQL is the more suitable database option, but we will stick with MySQL/MariaDB as this is the system most administrators are familiar with. Also, some organizations are bound to Microsoft SQL or Oracle. If this is the case, please refer to the respective installation guide, as this is beyond the scope of <span class="No-Break" lang="">this book.</span></p>
<p lang="en-GB">The high-level installation process is shown in the following <span class="No-Break" lang="">process diagram:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<img alt="Figure 1.4 – Moodle installation process " height="336" src="image/Figure_1.04_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.4 – Moodle installation process</p>
<p lang="en-GB">We will go through each phase in the remaining subsections, covering each installation step in a Linux environment. The process is the same for other operating systems, which we won’t cover; here are some pointers that should get <span class="No-Break" lang="">you started:</span></p>
<ul>
<li lang="en-GB">For Windows servers with a small number of users, the <strong class="bold" lang="">XAMPP</strong>-based Moodle distribution is suitable. XAMPP is a<a id="_idIndexMarker032"/> free Apache distribution that contains MySQL and PHP (as well as Perl) and exists for several operating systems. The Moodle distribution for Windows makes full use of XAMPP and is located at <a href="http://download.moodle.org/windows">download.moodle.org/windows</a>. The installation works on all the latest Windows PCs and <span class="No-Break" lang="">server variants.</span></li>
<li lang="en-GB">For larger <strong class="bold" lang="">Windows</strong> installations, you have to install Moodle manually, which involves installing a database server (MS SQL or any other supported system), a web server (Microsoft IIS or Apache), and PHP separately. You can find details about this process <span class="No-Break" lang="">at </span><a href="http://docs.moodle.org/en/Windows_installation"><span class="No-Break" lang="">docs.moodle.org/en/Windows_installation</span></a><span class="No-Break" lang="">.</span></li>
<li lang="en-GB"><strong class="bold" lang="">MAMP</strong> is a free<a id="_idIndexMarker033"/> distribution that contains Apache (and Nginx), MySQL, and PHP for macOS. Like its Windows counterpart, the Moodle distributions for macOS are only intended for local installations and not for production environments. Moodle4Mac is <a id="_idIndexMarker034"/>available as universal binaries via MAMP, located <span class="No-Break" lang="">at </span><a href="http://download.moodle.org/macosx"><span class="No-Break" lang="">download.moodle.org/macosx</span></a><span class="No-Break" lang="">.</span></li>
</ul>
<p lang="en-GB">Now, let’s go through the installation process, starting with <span class="No-Break" lang="">downloading Moodle.</span></p>
<h2 id="_idParaDest-28" lang="en-GB"><a id="_idTextAnchor027"/>Downloading Moodle</h2>
<p lang="en-GB">Go to <a href="http://download.moodle.org">download.moodle.org</a> and <a id="_idIndexMarker035"/>select <a id="_idIndexMarker036"/>the <span class="No-Break" lang="">latest release:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<img alt="Figure 1.5 – Moodle downloads " height="734" src="image/Figure_1.05_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.5 – Moodle downloads</p>
<p lang="en-GB">A newer<a id="_idIndexMarker037"/> version is likely to be available by the time you read this. If you wish to go with the 4.0.x version this book has been written for, select <strong class="bold" lang="">Other supported releases</strong>; otherwise, feel free to go with the latest stable build; most content in this book will still <span class="No-Break" lang="">be applicable.</span></p>
<p lang="en-GB">There are five types of builds available on Moodle’s <span class="No-Break" lang="">download site:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Latest release</strong>: There are two releases for the current version of Moodle: the latest stable build and the latest official release. The latest stable version is created weekly (every Wednesday) and is the best choice for a new server. The latest official release contains the stable build and new fixes, but the version will not have gone through the weekly code review and might contain <span class="No-Break" lang="">unresolved issues.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Other supported releases</strong>: The Moodle development team maintains older versions than the current ones, as outlined in the release <span class="No-Break" lang="">schedule earlier.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Security-only-supported releases</strong>: Critical fixes impacting security or data loss will be provided for one further release, but no other bug fixes will be back-ported. See the information on Moodle versions <span class="No-Break" lang="">provided earlier.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Legacy releases</strong>: For older versions, the last build is made available. However, these are not maintained <span class="No-Break" lang="">any further.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Development releases</strong>: Moodle also gives you the option to download beta releases of the software (if available) and the latest development release. These should only be downloaded for testing or development purposes, never in <span class="No-Break" lang="">production environments!</span></li>
</ul>
<p lang="en-GB">Each version<a id="_idIndexMarker038"/> is made available in two compressed formats: TGZ (use the <strong class="source-inline" lang="">tar</strong> command to uncompress) and ZIP (use the <strong class="source-inline" lang="">unzip</strong> command to extract it). You can download them by clicking on the respective link or, if you have (secure) shell access, retrieving the file directly by using the <span class="No-Break" lang=""><strong class="source-inline" lang="">wget</strong></span><span class="No-Break" lang=""> command:</span></p>
<pre class="source-code" lang="en-GB">wget http://download.moodle.org/moodle/moodle-latest.zip</pre>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">The location where you install Moodle is <a id="_idIndexMarker039"/>referred to <span class="No-Break" lang="">as </span><span class="No-Break" lang=""><strong class="bold" lang="">dirroot</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">If you make use of <strong class="bold" lang="">Moodle Shell</strong> (<strong class="bold" lang="">MOOSH</strong>), which<a id="_idIndexMarker040"/> is described in more detail in <a href="B18779_17.xhtml#_idTextAnchor325"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 17</em></span></a>, <em class="italic" lang="">Working with Moodle Admin Tools</em>, you can use the following command to download the latest stable branch <span class="No-Break" lang="">of Moodle:</span></p>
<pre class="source-code" lang="en-GB">moosh download-moodle</pre>
<p lang="en-GB">Once you have moved the file to the location where you want to install it on your web server (<strong class="source-inline" lang="">dirroot</strong>), extract the file using the <strong class="source-inline" lang="">unzip</strong> command or <strong class="source-inline" lang="">tar</strong> if you downloaded the <span class="No-Break" lang="">TGZ version:</span></p>
<pre class="source-code" lang="en-GB">unzip moodle-latest.zip</pre>
<pre class="source-code" lang="en-GB">tar xvfz moodle-latest.tgz</pre>
<p lang="en-GB">If you place the entire folder in your web server documents directory, the site will be located at www.yourwebserver.com/moodle. To access your site from www.yourwebserver.com, copy<a id="_idIndexMarker041"/> the contents directly into the main web server’s <span class="No-Break" lang="">documents directory.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">The URL via which Moodle is accessed is referred to <a id="_idIndexMarker042"/><span class="No-Break" lang="">as </span><span class="No-Break" lang=""><strong class="bold" lang="">wwwroot</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once the download step has been completed, you must create the database that Moodle uses to store <span class="No-Break" lang="">its data.</span></p>
<h2 id="_idParaDest-29" lang="en-GB"><a id="_idTextAnchor028"/>Creating the Moodle database</h2>
<p lang="en-GB">Moodle <a id="_idIndexMarker043"/>requires a database where it can store its information. While sharing an existing database is possible, creating a separate database for Moodle is highly recommended. Adding a new database can either be done via a web interface, as provided for hosted servers, or via the <span class="No-Break" lang="">command line.</span></p>
<h3 lang="en-GB">Using a hosted server</h3>
<p lang="en-GB">Most<a id="_idIndexMarker044"/> hosting providers provide a dedicated web interface to carry out basic database operations. Alternatively, you can <a id="_idIndexMarker045"/>use <strong class="bold" lang="">phpMyAdmin</strong>, open source software that allows you to manage MySQL databases over the web. phpMyAdmin is part of most Linux distributions and many control panels, but it is often configured not to allow new databases to be created. If this is the case, you must create the database from the database manager in your <span class="No-Break" lang="">control panel.</span></p>
<p lang="en-GB">phpMyAdmin allows you to perform both steps – creating a database and adding a new user – in a single action, as shown in the following screenshot. We will create a user, <strong class="source-inline" lang="">packt</strong>, and also check the <strong class="bold" lang="">Create database with same name and grant all </strong><span class="No-Break" lang=""><strong class="bold" lang="">privileges</strong></span><span class="No-Break" lang=""> option:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<img alt="Figure 1.6 – Creating a Moodle database and user in phpMyAdmin " height="783" src="image/Figure_1.06_B18779.jpg" width="1496"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.6 – Creating a Moodle database and user in phpMyAdmin</p>
<p lang="en-GB">While <a id="_idIndexMarker046"/>you can use an existing database user account, creating a dedicated user for the Moodle database is <span class="No-Break" lang="">good practice.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Do not use the MySQL root account for your <span class="No-Break" lang="">Moodle database!</span></p>
<p lang="en-GB">You don’t need to create any tables; Moodle will populate the database <span class="No-Break" lang="">during installation.</span></p>
<p lang="en-GB">Creating the Moodle database via a web interface is simple, but most technical administrators prefer to work via the <span class="No-Break" lang="">command line.</span></p>
<h3 lang="en-GB">Using the command line</h3>
<p lang="en-GB">If you<a id="_idIndexMarker047"/> don’t have access to a web interface to create MySQL databases and user accounts, or if you prefer to use a Linux shell, you can perform these steps via the <span class="No-Break" lang="">command line:</span></p>
<ol>
<li lang="en-GB">Start the database command-line tool by entering <strong class="source-inline" lang="">mysql -root -p</strong> and enter the password at <span class="No-Break" lang="">the prompt.</span></li>
<li lang="en-GB">Create a database (called <strong class="source-inline" lang="">packt</strong>) by entering <strong class="source-inline" lang="">CREATE DATABASE packt;</strong> (all MySQL commands must be terminated with <span class="No-Break" lang="">a semicolon).</span></li>
<li lang="en-GB">Set the default character and collation order to <strong class="source-inline" lang="">UTF8</strong> by entering <strong class="source-inline" lang="">ALTER DATABASE packt DEFAULT CHARACTER SET utf8 COLLATE </strong><span class="No-Break" lang=""><strong class="source-inline" lang="">utf8_unicode_ ci;</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">Create a user and password (here, packt@localhost and password, respectively) and grant database access permissions by entering <strong class="source-inline" lang="">GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, CREATE TEMPORARY TABLES, DROP, INDEX, ALTER ON packt.* TO packt@localhost IDENTIFIED </strong><span class="No-Break" lang=""><strong class="source-inline" lang="">BY 'password';</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">Exit the MySQL command tool by <span class="No-Break" lang="">entering </span><span class="No-Break" lang=""><strong class="source-inline" lang="">QUIT</strong></span><span class="No-Break" lang="">.</span></li>
</ol>
<p lang="en-GB">It is necessary <a id="_idIndexMarker048"/>to reload the grant tables using the following <span class="No-Break" lang="">command line:</span></p>
<pre class="source-code" lang="en-GB">mysqladmin -u root -p reload</pre>
<p lang="en-GB">With that, you have set up the database. All you have to do now is create Moodle’s data directory. Then, you can start installing <span class="No-Break" lang="">Moodle itself.</span></p>
<h2 id="_idParaDest-30" lang="en-GB"><a id="_idTextAnchor029"/>Creating the Moodle data directory</h2>
<p lang="en-GB">Moodle stores<a id="_idIndexMarker049"/> most of its information in the database you have just created. However, uploaded files such as assignments, course images, or user pictures are stored in a separate directory. This data directory in Moodle is usually referred to<a id="_idIndexMarker050"/> <span class="No-Break" lang="">as </span><span class="No-Break" lang=""><strong class="bold" lang="">moodledata</strong></span><span class="No-Break" lang="">.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">The location that holds your Moodle data files is referred to <span class="No-Break" lang="">as </span><span class="No-Break" lang=""><strong class="source-inline" lang="">dataroot</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Later, the Moodle installer will attempt to create this directory, but in some setups, this operation will fail due to security restrictions. To be on the safe side, it is better to create <strong class="source-inline" lang="">moodledata</strong> manually or via a web-based file manager, as provided by <span class="No-Break" lang="">some systems.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">It is crucial to create <strong class="source-inline" lang="">moodledata</strong> on your server where it cannot be accessed publicly – that is, outside your <span class="No-Break" lang="">web directory.</span></p>
<p lang="en-GB"><strong class="source-inline" lang="">moodledata</strong> is <a id="_idIndexMarker051"/>where all the <a id="_idIndexMarker052"/>uploaded files by course authors and learners will be stored, so ensure this is adequately dimensioned. You may also consider creating <strong class="source-inline" lang="">moodledata</strong> in a <span class="No-Break" lang="">separate partition.</span></p>
<p lang="en-GB">Any <strong class="source-inline" lang="">moodledata</strong> permissions should be <strong class="source-inline" lang="">rwxrwx---</strong> (<strong class="source-inline" lang="">chmod –R 0770 moodledata</strong>). If you use <strong class="source-inline" lang="">0777</strong>, everybody on the server will have access to <span class="No-Break" lang="">the files.</span></p>
<p lang="en-GB">Change the user and group of the directory to that of your web server (usually, this will be <strong class="source-inline" lang="">apache</strong> or <strong class="source-inline" lang="">www-data</strong> and <strong class="source-inline" lang="">nobody</strong> or <strong class="source-inline" lang="">www-data</strong>) by entering <strong class="source-inline" lang="">chown –R </strong><span class="No-Break" lang=""><strong class="source-inline" lang="">apache:nobody moodledata</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">If you don’t have permission to create the data directory in a secure location, create the <strong class="source-inline" lang="">.htaccess</strong> file in your home directory and ensure it contains the following <span class="No-Break" lang="">two lines:</span></p>
<pre class="source-code" lang="en-GB">order deny,allow</pre>
<pre class="source-code" lang="en-GB">deny from all</pre>
<p lang="en-GB">These two settings prevent files from being accessed without users having permission to <span class="No-Break" lang="">do so.</span></p>
<p lang="en-GB">We have completed the first three steps – downloading Moodle, creating the database, and preparing <strong class="source-inline" lang="">moodledata</strong> – which are the prerequisites for running the <span class="No-Break" lang="">installer script.</span></p>
<h2 id="_idParaDest-31" lang="en-GB"><a id="_idTextAnchor030"/>Running the installer script</h2>
<p lang="en-GB">The<a id="_idIndexMarker053"/> installer script <a id="_idIndexMarker054"/>performs two main actions – populating the database and creating the configuration file, <strong class="source-inline" lang="">config.php</strong>. The Moodle installer is initiated by entering the URL of <strong class="source-inline" lang="">wwwroot</strong> (the location where you copied Moodle) into your web browser; Moodle will recognize that it hasn’t been installed yet and start the <span class="No-Break" lang="">process automatically.</span></p>
<p lang="en-GB">The Moodle installer has to set a session cookie. If your browser has been configured to trigger a warning, make sure you accept <span class="No-Break" lang="">that cookie.</span></p>
<p lang="en-GB">The first screen lets <a id="_idIndexMarker055"/>you choose the language to be used during installation – this is not the locale used for Moodle, only the language for <span class="No-Break" lang="">the installation:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<img alt="Figure 1.7 – Moodle installation – Choose a language " height="719" src="image/Figure_1.07_B18779.jpg" width="1420"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.7 – Moodle installation – Choose a language</p>
<p lang="en-GB">The following screenshot displays the expected values for the <strong class="bold" lang="">Web address</strong> entry of the site (<strong class="source-inline" lang="">wwwroot</strong>), the <strong class="bold" lang="">Moodle directory</strong> (<strong class="source-inline" lang="">dirroot</strong>) entry, and the <strong class="bold" lang="">Data directory</strong> (<strong class="source-inline" lang="">dataroot</strong>) entry; you might have to modify the <strong class="bold" lang="">Data directory</strong> entry if the location of your <span class="No-Break" lang=""><strong class="source-inline" lang="">moodledata</strong></span><span class="No-Break" lang=""> differs:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<img alt="Figure 1.8 – Moodle installation – Confirm paths " height="381" src="image/Figure_1.08_B18779.jpg" width="1224"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.8 – Moodle installation – Confirm paths</p>
<p lang="en-GB">If <strong class="source-inline" lang="">dataroot</strong> cannot <a id="_idIndexMarker056"/>be located or does not have the correct permissions, an error message containing details will be displayed. The same applies if <strong class="source-inline" lang="">dataroot</strong> is accessible directly via the web and is <span class="No-Break" lang="">not secure.</span></p>
<p lang="en-GB">You must select which database you wish to use on the following screen. Only the drivers for MySQL, MariaDB, Aurora MySQL, and PostgresSQL are installed on my system. The respective PHP extension must be installed first if you wish to use other database systems such as Oracle or MS <span class="No-Break" lang="">SQL Server:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<img alt="Figure 1.9 – Moodle installation – Choose database driver " height="593" src="image/Figure_1.09_B18779.jpg" width="1211"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.9 – Moodle installation – Choose database driver</p>
<p lang="en-GB">This interface uses the configuration details previously established. The following screenshot shows the required fields but will look slightly different if you have chosen a database driver<a id="_idIndexMarker057"/> other <span class="No-Break" lang="">than MySQL:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<img alt="Figure 1.10 – Moodle installation – Database settings " height="1129" src="image/Figure_1.10_B18779.jpg" width="1216"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.10 – Moodle installation – Database settings</p>
<p lang="en-GB">The <strong class="bold" lang="">Database host</strong> entry’s default is <strong class="source-inline" lang="">localhost</strong> (<strong class="source-inline" lang="">127.0.0.1</strong>), which is correct if the database is located on the same server as the web server. If it is located on a separate server, specify the IP address (preferably unresolved to <span class="No-Break" lang="">improve performance).</span></p>
<p lang="en-GB">All the tables the Moodle installer will create will be prefixed with <strong class="source-inline" lang="">mdl_</strong>. The <strong class="bold" lang="">Tables prefix</strong> entry should only be changed if you run multiple Moodle installations using the <span class="No-Break" lang="">same database.</span></p>
<p lang="en-GB">Next, the <a id="_idIndexMarker058"/>Moodle installer checks whether certain components have been installed. Not all the modules are compulsory – see the <em class="italic" lang="">Moodle prerequisites</em> section of this chapter and the notice on-screen. The installer also verifies the critical PHP settings. If any of the tests have not passed, you must go back to the <em class="italic" lang="">Software requirements</em> section to resolve any problems and restart the installation process after the issues have been fixed. Otherwise, some features may not work, or the installer will not continue, depending on the importance of <span class="No-Break" lang="">the module:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<img alt="Figure 1.11 – Moodle installation – Server checks " height="1069" src="image/Figure_1.11_B18779.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.11 – Moodle installation – Server checks</p>
<p lang="en-GB">When you have confirmed the server check screen, the installer will display Moodle’s copyright notice, which you must confirm. The appearance of this screen also means that the <a id="_idIndexMarker059"/>Moodle configuration file, <strong class="source-inline" lang="">config.php</strong>, has been successfully created. The installer will display the config file’s content if the creation fails (usually because of incorrect permissions). You will have to copy the text from the screen and paste it manually into <strong class="source-inline" lang="">config.php</strong> in <span class="No-Break" lang="">your </span><span class="No-Break" lang=""><strong class="source-inline" lang="">dirroot</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once you have accepted the agreement (you can find the full text of the GPL license at <a href="http://docs.moodle.org/dev/License">docs.moodle.org/dev/License</a>), all the database tables will be created. This process might take a <span class="No-Break" lang="">few minutes.</span></p>
<p lang="en-GB">Once the table has been created and populated, you will see the screen where you can set up the administrator account. The default <strong class="bold" lang="">Username</strong> is admin, which should be changed for security reasons. You must fill in the following self-explanatory fields: <strong class="bold" lang="">New password</strong>, <strong class="bold" lang="">First name</strong>, <strong class="bold" lang="">Surname</strong>, and <strong class="bold" lang="">Email address</strong>. In <a href="B18779_05.xhtml#_idTextAnchor092"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 5</em></span></a>, <em class="italic" lang="">Managing Users, Cohorts, and Authentication</em>, all other fields will be explained in <span class="No-Break" lang="">great detail:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<img alt="Figure 1.12 – Moodle installation – setting up the admin account " height="776" src="image/Figure_1.12_B18779.jpg" width="1219"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.12 – Moodle installation – setting up the admin account</p>
<p lang="en-GB">The last screen of the installation script asks you to enter some home page settings; namely, <strong class="bold" lang="">Full site name</strong>, <strong class="bold" lang="">Short name for site</strong>, and <strong class="bold" lang="">Site home summary</strong>. These home page settings can be modified later (see <a href="B18779_07.xhtml#_idTextAnchor140"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 7</em></span></a>, <em class="italic" lang="">Enhancing Moodle’s Look </em><span class="No-Break" lang=""><em class="italic" lang="">and Feel</em></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">Change the <strong class="bold" lang="">Default timezone</strong> entry to the location of your server, not your location. The installer<a id="_idIndexMarker060"/> allows you to turn on <strong class="bold" lang="">Self registration</strong>. Leave this disabled for now until you have read <a href="B18779_05.xhtml#_idTextAnchor092"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 5</em></span></a>, <em class="italic" lang="">Managing Users, Cohorts, and Authentication</em>. You must also provide a <strong class="bold" lang="">Support email</strong> (for your user queries) and a <strong class="bold" lang="">No-reply address</strong> (to avoid <span class="No-Break" lang="">email issues).</span></p>
<p lang="en-GB">Once this information has been entered and the screen has been confirmed, you are ready to start using Moodle. However, first, you must set up the execution of Moodle’s <span class="No-Break" lang="">maintenance script.</span></p>
<h2 id="_idParaDest-32" lang="en-GB"><a id="_idTextAnchor031"/>Setting up the cron process</h2>
<p lang="en-GB">Moodle has to <a id="_idIndexMarker061"/>perform plenty of background <span class="No-Break" lang="">tasks regularly.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">The <strong class="bold" lang="">cron script</strong>, executed<a id="_idIndexMarker062"/> by<a id="_idIndexMarker063"/> the <strong class="bold" lang="">cron process</strong>, performs Moodle’s <span class="No-Break" lang="">background tasks.</span></p>
<p lang="en-GB">An entire page has been dedicated to cron in the Moodle documentation; you can find it at <a href="http://docs.moodle.org/en/Cron">docs.moodle.org/en/Cron</a>. You must set up the cron process; otherwise, any timed Moodle features, such as scheduled backups, sending forum notifications, statistics processing, and so on, will <span class="No-Break" lang="">not work.</span></p>
<p lang="en-GB">The script, <strong class="source-inline" lang="">cron.php</strong>, is located in the admin directory and can be triggered manually through a web browser (if allowed in the security settings). Once executed, the output from the script (<strong class="source-inline" lang="">&lt;yoursite&gt;/admin/cron.php</strong>) is shown on-screen, and you have to navigate back to your Moodle <span class="No-Break" lang="">system manually.</span></p>
<p lang="en-GB">There are several ways to call the cron script. The most popular option is via the <span class="No-Break" lang=""><strong class="source-inline" lang="">wget</strong></span><span class="No-Break" lang=""> command:</span></p>
<pre class="source-code" lang="en-GB">wget –q –O /dev/null http://&lt;yoursite&gt;/admin/cron.php</pre>
<p lang="en-GB">However, if this does not suit your setup, check out <a href="http://docs.moodle.org/en/Cron">docs.moodle.org/en/Cron</a> <span class="No-Break" lang="">for alternatives.</span></p>
<p lang="en-GB">Most <a id="_idIndexMarker064"/>control panels allow you to set up scheduled tasks via a cron job management tool. Bear in mind that this is not part of Moodle but part of your hosting package. Alternatively, you can create a crontab entry, a file located in the <strong class="source-inline" lang="">/etc</strong> directory that contains all the system-wide cron entries. This file can also be edited manually using <strong class="source-inline" lang="">crontab -e</strong>, but ensure you get the <span class="No-Break" lang="">syntax right!</span></p>
<p lang="en-GB">To run the CLI cron script every minute, add the following line, replacing <strong class="source-inline" lang="">&lt;yourpath&gt;</strong> with the directory where your Moodle system is <span class="No-Break" lang="">located (</span><span class="No-Break" lang=""><strong class="source-inline" lang="">dirroot</strong></span><span class="No-Break" lang="">):</span></p>
<pre class="source-code" lang="en-GB">* * * * * /usr/bin/php &lt;yourpath&gt;/cron.php &gt;/dev/null</pre>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">It is highly recommended to run the cron process <span class="No-Break" lang="">every minute!</span></p>
<p lang="en-GB">That’s it. Moodle is now ready to go. Two optional steps you should quickly run through are covered in the <span class="No-Break" lang="">next section.</span></p>
<h2 id="_idParaDest-33" lang="en-GB"><a id="_idTextAnchor032"/>Finalizing the installation</h2>
<p lang="en-GB">To make <a id="_idIndexMarker065"/>sure that Moodle is running without problems, go to <strong class="bold" lang="">Notifications</strong> in the <strong class="bold" lang="">Site administration</strong> menu of the <span class="No-Break" lang=""><strong class="bold" lang="">General</strong></span><span class="No-Break" lang=""> tab:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<img alt="Figure 1.13 – Moodle installation – checking system notifications " height="389" src="image/Figure_1.13_B18779.jpg" width="1495"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.13 – Moodle installation – checking system notifications</p>
<p lang="en-GB">In the case of my installation, there are two issues – the cron script has not been configured and the mobile app is not enabled. I need to fix the former issue; the latter can wait until <a href="B18779_11.xhtml#_idTextAnchor216"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 11</em></span></a>, <em class="italic" lang="">Enabling Mobile Learning</em>. Other messages might appear in the <strong class="bold" lang="">Notifications</strong> area, and you should resolve <span class="No-Break" lang="">them promptly.</span></p>
<p lang="en-GB">Moodle <a id="_idIndexMarker066"/>provides some statistics about its usage on <a href="http://moodle.net/stats">moodle.net/stats</a>, and to be included in these figures, you have to register your Moodle site via <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Registration</strong>. Registration with Moodle is optional and free, and you decide what information will be <span class="No-Break" lang="">made public.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Even if you opt out of providing any usage patterns for your site, it is still highly recommended to register to receive information on new Moodle releases, security alerts, and other <span class="No-Break" lang="">important news.</span></p>
<p lang="en-GB">The following is the registration form, alongside a screenshot from the <span class="No-Break" lang="">public statistics:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<img alt="Figure 1.14 – Moodle registration and statistics " height="780" src="image/Figure_1.14_B18779.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.14 – Moodle registration and statistics</p>
<p lang="en-GB">This concludes the installation process for Moodle in a LAMP environment. If you have encountered any issues that have not been covered in these instructions or if your setup differs from <a id="_idIndexMarker067"/>the one described, go to <a href="http://docs.moodle.org/en/Installing_Moodle">docs.moodle.org/en/Installing_Moodle</a>, where more installation details are provided, and exceptions are covered in <span class="No-Break" lang="">great detail.</span></p>
<p lang="en-GB">An alternative to installing Moodle via the web interface is via the <strong class="bold" lang="">command-line interface</strong> (<strong class="bold" lang="">CLI</strong>), which is the topic of the <span class="No-Break" lang="">following section.</span></p>
<h1 id="_idParaDest-34" lang="en-GB"><a id="_idTextAnchor033"/>Installation via the command-line interface</h1>
<p lang="en-GB">Moodle <a id="_idIndexMarker068"/>provides a CLI that lets you <a id="_idIndexMarker069"/>perform several administrative tasks from the Unix shell prompt. There is no CLI for Windows-based systems. CLI-based installations are useful if you need to automate setups, for example, in an environment where you host multiple <span class="No-Break" lang="">Moodle instances.</span></p>
<p lang="en-GB">The CLI is<a id="_idIndexMarker070"/> not for the faint-hearted, so be careful when using it. You must execute the installation script as the web server user, usually <strong class="source-inline" lang="">www-data</strong> or <strong class="source-inline" lang="">apache</strong>. You can run the installation script, <strong class="source-inline" lang="">install.php</strong>, in interactive mode (you will have to enter any parameters by hand) or in non-interactive mode, where the script will <span class="No-Break" lang="">run silently.</span></p>
<p lang="en-GB">From your <strong class="source-inline" lang="">dirroot</strong>, you can initiate the interactive script <span class="No-Break" lang="">as follows:</span></p>
<pre class="source-code" lang="en-GB">sudo –u www-data /usr/bin/php admin/cli/install.php</pre>
<p lang="en-GB">Something more interesting is the CLI’s non-interactive mode, as this can be used for scripting and automation purposes. A list of all the available parameters can be displayed using the <strong class="source-inline" lang="">--</strong><span class="No-Break" lang=""><strong class="source-inline" lang="">help</strong></span><span class="No-Break" lang=""> command:</span></p>
<pre class="source-code" lang="en-GB">sudo –u www-data /usr/bin/php admin/cli/install.php --help</pre>
<p lang="en-GB">The output of the executed command is shown in the <span class="No-Break" lang="">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<img alt="Figure 1.15 – Moodle installation via the CLI " height="1105" src="image/Figure_1.15_B18779.jpg" width="1336"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.15 – Moodle installation via the CLI</p>
<p lang="en-GB">An example <a id="_idIndexMarker071"/>command line would look<a id="_idIndexMarker072"/> similar to the following, where you will have to adjust the parameters to your <span class="No-Break" lang="">local setup:</span></p>
<pre class="source-code" lang="en-GB">sudo -u www-data /usr/bin/php admin/cli/install.php --wwwroot=http://123.54.67.89/moodle --dataroot=/var/moodledata/ --dbtype=mysqli --dbhost=localhost --dbname=moodle --dbuser=moodle --dbpass=password --fullname=moodle4 --shortname=moodle4 --adminpass=Password123! --non-interactive --agree-license</pre>
<p lang="en-GB">More Moodle tasks can be administered via the CLI, for example, resetting passwords or putting Moodle in maintenance mode. We will show the relevant syntax at the appropriate places throughout this book and have also dedicated a section to the CLI in <a href="B18779_17.xhtml#_idTextAnchor325"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 17</em></span></a>, <em class="italic" lang="">Working with Moodle </em><span class="No-Break" lang=""><em class="italic" lang="">Admin Tools</em></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once your Moodle system is up and running, you need to ensure that it is kept up to date. Updating Moodle manually and via the command line is covered in the <span class="No-Break" lang="">following section.</span></p>
<h1 id="_idParaDest-35" lang="en-GB"><a id="_idTextAnchor034"/>Updating Moodle</h1>
<p lang="en-GB">We <a id="_idIndexMarker073"/>provided an overview of Moodle’s release calendar earlier in this chapter. There is usually no need to install every single minor point release; however, there are several scenarios when you should upgrade your <span class="No-Break" lang="">Moodle system:</span></p>
<ul>
<li lang="en-GB">Security patches have <span class="No-Break" lang="">been issued</span></li>
<li lang="en-GB">New features have <span class="No-Break" lang="">been added</span></li>
<li lang="en-GB">Bugs have been fixed that affect <span class="No-Break" lang="">your setup</span></li>
<li lang="en-GB">A major version <span class="No-Break" lang="">is released</span></li>
<li lang="en-GB">The support cycle of your setup comes to <span class="No-Break" lang="">an end</span></li>
</ul>
<p lang="en-GB">There are principally two ways Moodle systems can be updated: you can run updates manually (using the web interface or the CLI) or stay up to date using Git commands. Both procedures will be described in <span class="No-Break" lang="">this section.</span></p>
<p lang="en-GB">Either way, before you start, ensure you put Moodle in maintenance mode to ensure that no other user is logged in during the update. Go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Maintenance mode</strong>, choose <strong class="bold" lang="">Enable</strong> for <strong class="bold" lang="">Maintenance mode</strong>, and enter a <span class="No-Break" lang="">maintenance message:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<img alt="Figure 1.16 – Enabling maintenance mode " height="651" src="image/Figure_1.16_B18779.jpg" width="1220"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.16 – Enabling maintenance mode</p>
<p lang="en-GB">You can <a id="_idIndexMarker074"/>also put Moodle in maintenance mode using its CLI, <span class="No-Break" lang="">as follows:</span></p>
<pre class="source-code" lang="en-GB">sudo –u www-data /usr/bin/php admin/cli/maintenance.php --enable</pre>
<p lang="en-GB">Using the <strong class="source-inline" lang="">--enablelater=MINUTES</strong> flag, you can specify the period before entering CLI maintenance mode, which is useful when you run an <span class="No-Break" lang="">automatic update.</span></p>
<p lang="en-GB">To change back to normal mode, use the <strong class="source-inline" lang="">--disable</strong> parameter instead of <strong class="source-inline" lang="">--enable</strong>, <span class="No-Break" lang="">as follows:</span></p>
<pre class="source-code" lang="en-GB">sudo –u www-data /usr/bin/php admin/cli/maintenance.php –disable</pre>
<p lang="en-GB">Once Moodle has been put in maintenance mode, you are ready to update your <span class="No-Break" lang="">Moodle system.</span></p>
<h2 id="_idParaDest-36" lang="en-GB"><a id="_idTextAnchor035"/>Updating Moodle manually</h2>
<p lang="en-GB">The <a id="_idIndexMarker075"/>high-level process for updating Moodle manually is <span class="No-Break" lang="">as follows:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<img alt="Figure 1.17 – Updating Moodle " height="472" src="image/Figure_1.17_B18779.jpg" width="1646"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.17 – Updating Moodle</p>
<p lang="en-GB">If you update<a id="_idIndexMarker076"/> from a previous version of Moodle, the process is the same. However, double-check the upgrading document at <a href="http://docs.moodle.org/en/Upgrading">docs.moodle.org/en/Upgrading</a> for any <span class="No-Break" lang="">version-specific issues.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">You have to be at least on version 3.6 to update directly to Moodle 4. If you’re upgrading from earlier versions, you must upgrade to 3.6 as a <span class="No-Break" lang="">first step.</span></p>
<p lang="en-GB">Before you install a new update, it is highly recommended that you run a <strong class="bold" lang="">backup</strong> of your Moodle system. While most updates will run smoothly, a backup will be required if you have to revert the system to the pre-updated version. Backups will be covered in detail in <a href="B18779_16.xhtml#_idTextAnchor308"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 16</em></span></a>, <em class="italic" lang="">Avoiding Sleepless Nights – Moodle Backup and Restore</em>. Ensure that you run a system backup that includes the database, <strong class="source-inline" lang="">moodledata</strong>, and <strong class="source-inline" lang="">dirroot</strong> (in <span class="No-Break" lang="">particular, </span><span class="No-Break" lang=""><strong class="source-inline" lang="">config.php</strong></span><span class="No-Break" lang="">).</span></p>
<p lang="en-GB">Now, let’s go through the update workflow step <span class="No-Break" lang="">by step:</span></p>
<ol>
<li lang="en-GB" value="1"><span class="No-Break" lang=""><strong class="bold" lang="">New version</strong></span></li>
</ol>
<p lang="en-GB">Once you have created a backup, it is time to replace the old version of <strong class="source-inline" lang="">dirroot</strong> with the latest code. Simply copy the new files over the existing ones; existing files will be overridden, except <strong class="source-inline" lang="">config.php</strong>, which is not part of the <span class="No-Break" lang="">download bundle.</span></p>
<p lang="en-GB">Alternatively, you can rename the old <strong class="source-inline" lang="">dirroot</strong> folder and create a new directory. However, you must copy the following files and directories from your old directory to your <span class="No-Break" lang="">new </span><span class="No-Break" lang=""><strong class="source-inline" lang="">dirroot</strong></span><span class="No-Break" lang="">:</span></p>
<ul>
<li lang="en-GB"><span class="No-Break" lang=""><strong class="source-inline" lang="">config.php</strong></span></li>
<li lang="en-GB"><strong class="source-inline" lang="">.htaccess</strong> (<span class="No-Break" lang="">if present)</span></li>
<li lang="en-GB">Any theme folders that have <span class="No-Break" lang="">been created</span></li>
<li lang="en-GB">Any modified <span class="No-Break" lang="">language packs</span></li>
<li lang="en-GB">The content of the <span class="No-Break" lang="">local directory</span></li>
<li lang="en-GB">Any third-party modules and custom code not located <span class="No-Break" lang="">in </span><span class="No-Break" lang=""><strong class="source-inline" lang="">local</strong></span></li>
</ul>
<p lang="en-GB">Once<a id="_idIndexMarker077"/> you go to the location of your Moodle site and log in as an administrator, the system will recognize that a new version is available and kick off the <span class="No-Break" lang="">installer automatically.</span></p>
<p lang="en-GB">The first screen displays the build of the new version (here, 4.0.2) and asks you to confirm that you wish to go ahead with <span class="No-Break" lang="">the upgrade:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer024">
<img alt="Figure 1.18 – Updating Moodle – New version " height="514" src="image/Figure_1.18_B18779.jpg" width="1221"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.18 – Updating Moodle – New version</p>
<ol>
<li lang="en-GB" value="2"><span class="No-Break" lang=""><strong class="bold" lang="">Server checks</strong></span></li>
</ol>
<p lang="en-GB">Next, a screen is displayed that links the release notes and performs the same server check as the one described <span class="No-Break" lang="">during installation.</span></p>
<ol>
<li lang="en-GB" value="3"><span class="No-Break" lang=""><strong class="bold" lang="">Plugins check</strong></span></li>
</ol>
<p lang="en-GB">Moodle plugins, whether core (<strong class="bold" lang="">Standard</strong>) or third-party (<strong class="bold" lang="">Additional</strong>), sometimes cause problems when upgrading Moodle. The <strong class="bold" lang="">Source/Status</strong> column <a id="_idIndexMarker078"/>highlights any actions required or problems found, and you should resolve any issues. Refer to <a href="B18779_08.xhtml#_idTextAnchor168"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 8</em></span></a>, <em class="italic" lang="">Understanding Moodle Plugins</em>, for <span class="No-Break" lang="">more details:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<img alt="Figure 1.19 – Updating Moodle – Plugins check " height="764" src="image/Figure_1.19_B18779.jpg" width="1218"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.19 – Updating Moodle – Plugins check</p>
<ol>
<li lang="en-GB" value="4"><span class="No-Break" lang=""><strong class="bold" lang="">System upgrade</strong></span></li>
</ol>
<p lang="en-GB">Once this screen has been confirmed, the actual system upgrade starts, during which new database fields are created, and data is modified if and <span class="No-Break" lang="">when necessary.</span></p>
<ol>
<li lang="en-GB" value="5"><span class="No-Break" lang=""><strong class="bold" lang="">New settings</strong></span></li>
</ol>
<p lang="en-GB">Any new system settings added to Moodle are shown and can be changed straight away. For example, in the following screenshot, a new <strong class="bold" lang="">Number of participants per page</strong> parameter has <span class="No-Break" lang="">been added:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<img alt="Figure 1.20 – Updating Moodle – New settings " height="411" src="image/Figure_1.20_B18779.jpg" width="1225"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.20 – Updating Moodle – New settings</p>
<p lang="en-GB">Once the <a id="_idIndexMarker079"/>upgrade process has been completed, check the <strong class="bold" lang="">Notifications</strong> page. Also, don’t forget to turn off <span class="No-Break" lang=""><strong class="bold" lang="">Maintenance mode</strong></span><span class="No-Break" lang="">!</span></p>
<p lang="en-GB">An alternative to manually updating Moodle is to utilize the CLI, which we will cover in the <span class="No-Break" lang="">following subsection.</span></p>
<h2 id="_idParaDest-37" lang="en-GB"><a id="_idTextAnchor036"/>Updating Moodle via the CLI</h2>
<p lang="en-GB">As expected, Moodle<a id="_idIndexMarker080"/> updates can also be run using the already-discussed CLI. Once you have backed up your data and updated to the latest version, all you need to do is run the <span class="No-Break" lang="">following script:</span></p>
<pre class="source-code" lang="en-GB">sudo –u www-data /usr/bin/php admin/cli/upgrade.php --non-interactive</pre>
<p lang="en-GB">Updating Moodle via the CLI is even more powerful when combined with the Git checkout of the Moodle source code. That is what we’ll look <span class="No-Break" lang="">at next.</span></p>
<p lang="en-GB">An alternative approach exists to keep a current version up to date, which uses the open source versioning<a id="_idIndexMarker081"/> system <strong class="bold" lang="">Git</strong>. All checked-in Moodle code is made available via this method, which only allows you to update the modules that <span class="No-Break" lang="">have changed.</span></p>
<p lang="en-GB">Setting up Git is a cumbersome process, which is beyond the scope of this book. You can find details <a id="_idIndexMarker082"/>at <a href="http://docs.moodle.org/en/Git_for_Administrators">docs.moodle.org/en/Git_for_Administrators</a>. However, once set up, Git is a very streamlined system, particularly in conjunction with the CLI mentioned earlier. The <a id="_idIndexMarker083"/>following is a sample script that gets the latest version of the source code, puts Moodle in maintenance mode, merges the old code with the new, runs the upgrade script, and disables <span class="No-Break" lang="">maintenance mode:</span></p>
<pre class="source-code" lang="en-GB">git fetch</pre>
<pre class="source-code" lang="en-GB">sudo -u www-data /usr/bin/php admin/cli/maintenance.php</pre>
<pre class="source-code" lang="en-GB">--enable</pre>
<pre class="source-code" lang="en-GB">git merge origin/cvshead</pre>
<pre class="source-code" lang="en-GB">sudo -u www-data /usr/bin/php admin/cli/upgrade.php</pre>
<pre class="source-code" lang="en-GB">sudo -u www-data /usr/bin/php admin/cli/maintenance.php</pre>
<pre class="source-code" lang="en-GB">--disable</pre>
<p lang="en-GB">The execution of the <strong class="source-inline" lang="">git fetch</strong> command can be seen in the <span class="No-Break" lang="">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer027">
<img alt="Figure 1.21 – Fetching the new Moodle version " height="411" src="image/Figure_1.21_B18779.jpg" width="1024"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.21 – Fetching the new Moodle version</p>
<p lang="en-GB">If you have changed any core code, potential conflicts might arise and must be resolved (Git will prompt you to <span class="No-Break" lang="">do so).</span></p>
<p lang="en-GB">Most commercial Moodle providers use Git to keep their Moodle instances up to date. If you feel comfortable using shell scripts, this should be your preferred method since it streamlines the <a id="_idIndexMarker084"/>update workflow and reduces the number of issues that <span class="No-Break" lang="">can arise.</span></p>
<p lang="en-GB">There is one last issue we haven’t covered yet: when do you know that updates are available? That’s what update notifications are <span class="No-Break" lang="">there for.</span></p>
<h2 id="_idParaDest-38" lang="en-GB"><a id="_idTextAnchor037"/>Update notifications</h2>
<p lang="en-GB">Moodle <a id="_idIndexMarker085"/>can notify you about a newly available version via email or message. To support this feature, the <strong class="bold" lang="">Automatically check for available updates</strong> setting under <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Update notifications</strong> has to remain enabled, <span class="No-Break" lang="">as follows:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer028">
<img alt="Figure 1.22 – Update notifications " height="772" src="image/Figure_1.22_B18779.jpg" width="1219"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.22 – Update notifications</p>
<p lang="en-GB">On your production site, the <strong class="bold" lang="">Required code maturity</strong> option should be set to <strong class="bold" lang="">Stable version</strong>; other maturity levels should only be considered on test instances. The same holds for the <strong class="bold" lang="">Notify about new </strong><span class="No-Break" lang=""><strong class="bold" lang="">builds</strong></span><span class="No-Break" lang=""> parameter.</span></p>
<p lang="en-GB">Alternatively, you can check for updates (core and plugins) by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Notifications</strong>. This information is updated every 24 hours via the cron process you set up earlier and takes into account the update notification settings. You<a id="_idIndexMarker086"/> can also initiate the request via the <strong class="bold" lang="">Check for available </strong><span class="No-Break" lang=""><strong class="bold" lang="">updates</strong></span><span class="No-Break" lang=""> button:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer029">
<img alt="Figure 1.23 – Update notifications " height="382" src="image/Figure_1.23_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.23 – Update notifications</p>
<p lang="en-GB">This concludes this section on updating your Moodle site, both manually and via the <span class="No-Break" lang="">command line.</span></p>
<h1 id="_idParaDest-39" lang="en-GB"><a id="_idTextAnchor038"/>Summary</h1>
<p lang="en-GB">This chapter taught you how to install and <span class="No-Break" lang="">update Moodle.</span></p>
<p lang="en-GB">After providing an overview describing the most suitable setup, we outlined the necessary software and hardware requirements and described Moodle’s versioning strategy and <span class="No-Break" lang="">release calendar.</span></p>
<p lang="en-GB">Then, we covered Moodle’s installation via the web and its powerful CLI. We did the same for Moodle upgrades, where we briefly <span class="No-Break" lang="">introduced Git.</span></p>
<p lang="en-GB">The fact that Moodle uses a portable software architecture and facilitates standard open source components allows it to be installed on multiple platforms. However, this also means that different peculiarities and quirks must be considered in <span class="No-Break" lang="">different environments.</span></p>
<p lang="en-GB">Now that your system is up and running, in the next chapter, we’ll look at the components of Moodle, which will give you a better understanding of the system and how to <span class="No-Break" lang="">administer it.</span></p>
</div>
<div>
<div class="Content" id="_idContainer031">
</div>
</div>
</div></body></html>