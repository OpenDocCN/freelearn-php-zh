<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Views"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Views</h1></div></div></div><p>This chapter covers the process flow to render views, the process flow within the view file, different type of views, and their role and usage with several code examples of web applications.</p><p>The views are programmatic portions that provide content to the browser to be executed on the client side (that is, the user PC) to make the user-interface session on the local computer.</p><p>The PHP view file rendered output returns from the server as an HTTP response content to the requesting browser application (that is, requesting via submitting a URI in the browser navigation area).</p><p>Initially, the browser sends a URI request that the user types in, to a default or specific controller method, such as <code class="literal">http://mysite.com/myapp/helloworld</code>.</p><p>The called controller method<a id="id231" class="indexterm"/> processes the request, performs its decision making, and may use the other CI resources, such as helpers, libraries, models, and eventually renders a view back as an HTTP response to the browser HTTP request that initiates the controller operation. The HTML file returned to the browser includes HTML, CSS, and JavaScript. The browser executes the received rendered view from the server, and uses it to perform the user-interface session (visual elements, and UI elements, such as buttons, scrollbars, and navigation elements); we see and operate via the browser to navigate to other page views or get specific information or media by issuing a page anchor, button, clicking on the icon, and so on. The described action causes another HTTP request(s), either synchronous (mostly anchor) or asynchronous AJAX request(s) handled by JavaScript embedded in the web page.</p><p>The CI view<a id="id232" class="indexterm"/> is a PHP file that may contain part or all of the following: PHP statements, HTML tags, CSS, JavaScript program, Flash, images, and media sources. In CI, a view file may contain the PHP code that uses the controller-provided parameters, or even call the CI helpers, libraries, or model directly to generate the output that is part of the generated HTML file response. The generated PHP output can be strings or numeric values incorporated in the HTML tags, or even a whole HTML page.</p><p>This chapter will primarily focus on the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The CI view scope:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The CI view resources path</li><li class="listitem" style="list-style-type: disc">The rendering flow</li><li class="listitem" style="list-style-type: disc">Client-side flexibility</li><li class="listitem" style="list-style-type: disc">Accessing libraries/helpers within a view</li><li class="listitem" style="list-style-type: disc">Forms</li><li class="listitem" style="list-style-type: disc">Using AJAX</li><li class="listitem" style="list-style-type: disc">View parser configuration issues</li><li class="listitem" style="list-style-type: disc">Integrating jQuery or other client-side libraries</li></ul></div></li><li class="listitem" style="list-style-type: disc">View rendering plugins (view template plugin example)</li><li class="listitem" style="list-style-type: disc">Example 1: HTML5 location powered by Google Maps</li><li class="listitem" style="list-style-type: disc">Example 2: user feedback powered by AJAX and the jQuery UI</li></ul></div><p>We will begin by briefly reviewing the CI view scope, and will proceed with several usage examples covering different use cases that can be combined in a real project.</p><div class="section" title="Scope of the CI view"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec44"/>Scope of the CI view</h1></div></div></div><p>The <a id="id233" class="indexterm"/>CI view is enabled with great flexibility to integrate the client-side third-party resources, as well as accessing the CI resources of the CI libraries, helpers, and models.</p><p>This section will focus on the CI view syntax and usage guidelines, as a preface to the coming usage code examples.</p><p>We can extend the CI library using the third-party libraries from the CI echo system or develop our own libraries.</p><div class="section" title="The CI view resources path"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec68"/>The CI view resources path</h2></div></div></div><p>In a CI project, the view files are located under the <code class="literal">application/views/</code> directory or any subdirectory to <a id="id234" class="indexterm"/>this path. For example, we can build under <code class="literal">application/views/</code> subdirectories, for let's say, two different view categories to improve the clarity of the<a id="id235" class="indexterm"/> file structure in our project. The following screenshot shows the views location in a CI project directory tree:</p><div class="mediaobject"><img src="graphics/4704OT_07_01.jpg" alt="The CI view resources path"/></div><p>For example, to render a template file located at <code class="literal">Application/views/templates/</code> named <code class="literal">home.php</code>, we shall write the following code:</p><div class="informalexample"><pre class="programlisting">$this-&gt;load-&gt;view('templates/home');
//The following load view call, render a view using all its optional parameters
$this-&gt;load-&gt;view('view_file', // PHP view file to render
$view_params,  // parameters array for view
FALSE  //  FALSE - default. to output
//   TRUE – back as string
  );</pre></div><p>In this example, <code class="literal">view_file</code> is referring to the CI resource PHP view file<a id="id236" class="indexterm"/> <code class="literal">application/views/view_file.php</code>.</p><p><code class="literal">$view_params</code><a id="id237" class="indexterm"/> is the array of parameters (scalar/array in each entry) for the view file, as we have demonstrated<a id="id238" class="indexterm"/> at several places earlier, so that each array key, let's say, <code class="literal">name,</code> becomes the <code class="literal">$name</code> PHP variable in the view to use.</p><p>In case we <a id="id239" class="indexterm"/>wish to get the processed view into a buffer, for, special processing, caching, or any other processing purpose, for example you may call the following example:</p><div class="informalexample"><pre class="programlisting">$view_buffer=$this-&gt;load-&gt;view('sectionA/view_file', $params, TRUE);</pre></div><p>Note that the third parameter's value is set to <code class="literal">TRUE</code> (the default value is set to <code class="literal">FALSE</code>, and echoes the view to the standard output; in the case of the controller rendering, this means it will be returned as an HTTP response to the browser, issuing the request from the controller).</p><p>The preceding example refers to the following view file: <code class="literal">application/views/sectionA/view_file.php</code>.</p></div><div class="section" title="The rendering flow"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec69"/>The rendering flow</h2></div></div></div><p>The <a id="id240" class="indexterm"/>view is rendered by the controller. The controller provides the parameters to the rendered PHP view file to use them.</p><p>The controller uses the following built-in CI load library<a id="id241" class="indexterm"/>: <code class="literal">$this-&gt;load-&gt;view('my_view',$data);</code></p><p>Otherwise, the controller uses the third-party rendering service library. In this chapter we will use such a library. The CI controller rendering is done by the CI load view library<a id="id242" class="indexterm"/>, and that optionally accepts the <code class="literal">$data</code> of parameters and objects that the rendered PHP view file can use. See the following code for example:</p><div class="informalexample"><pre class="programlisting">$data['myval'] = 'Hello';
$this-&gt;load-&gt;view('my_view',$data);</pre></div><p>The rendered PHP view file <code class="literal">application/views/my_view.php</code> uses the <code class="literal">$data</code> parameters provided via the load library as follows:</p><div class="informalexample"><pre class="programlisting">&lt;H1&gt;&lt;?PHP echo $myval; ?&gt;&lt;/H1&gt;</pre></div><p>Note that the controller defines the data as follows:</p><div class="informalexample"><pre class="programlisting">$data['myval'] = 'Hello';</pre></div><p>While the usage at the PHP view file rendered will be as follows:</p><div class="informalexample"><pre class="programlisting">&lt;H1&gt;&lt;?PHP echo $myval; ?&gt;&lt;/H1&gt;</pre></div><p>Later, the PHP view file will be executed, so that the HTML generated code will be as follows:</p><div class="informalexample"><pre class="programlisting">&lt;H1&gt;Hello&lt;/H1&gt;</pre></div><p>The entire PHP view file that is rendered, including the PHP executions, will generate the view HTML file that will be returned to the browser via HTTP to be executed locally.</p></div><div class="section" title="View flexibility"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec70"/>View flexibility</h2></div></div></div><p>CI provides<a id="id243" class="indexterm"/> the flexibility for the PHP view file code to use any client-side JavaScript/CSS/HTML, or <a id="id244" class="indexterm"/>other JavaScript libraries in the view files, without any requirement to declare them at the server-side controller, as it occurs in some other platforms.</p><p>Furthermore, the CI view can access any other CI resources, such as the CI libraries, the CI models, or the CI helpers, as if it were the rendering controller of the view; for example, accessing a session parameter directly.</p><div class="informalexample"><pre class="programlisting">$param = $this-&gt;session-&gt;userdata('param1' );</pre></div><p>Also, the CI view can call a CI library method directly in the same fashion as the rendering controller does (assuming the rendering controller loads this library).</p><div class="informalexample"><pre class="programlisting">$calc = $this-&gt;my_lib-&gt;my_lib_calc( $param);
&lt;H1&gt;&lt;?PHP echo $calc; ?&gt;&lt;/H1&gt;</pre></div></div></div></div>
<div class="section" title="Accessing the libraries/helpers"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec45"/>Accessing the libraries/helpers</h1></div></div></div><p>As mentioned <a id="id245" class="indexterm"/>earlier, the CI PHP view file can access any <a id="id246" class="indexterm"/>of the CI resources, such as calling the CI helpers, <a id="id247" class="indexterm"/>libraries, or models in the same way the controller does.</p><p>The following is a more elaborated and complete example of a PHP CI view file, accessing CI resources, such as libraries/models/helpers:</p><div class="informalexample"><pre class="programlisting">&lt;HTML&gt;
&lt;?PHP
// URI is a built-in CI library
// if the rendering controller for this view was// http://mysite/myproject/mycontroller/test3
// the segment(1) = mycontroller – the controller name
// the segment(2) = test3 - the controller method
$the_controller = $this-&gt;uri-&gt;segment(1);
$the_method = $this-&gt;uri-&gt;segment(2);
?&gt;
&lt;H1&gt;This View Rendered by Controller
&lt;?=$the_controller; ?&gt; &lt;/H1&gt;
&lt;H1&gt;Using its method named &lt;?=$the_method; ?&gt;&lt;/H1&gt;</pre></div><div class="section" title="Forms"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec71"/>Forms</h2></div></div></div><p>The CI PHP view file<a id="id248" class="indexterm"/> can contain any number of HTML data entry forms to accept the input data from the browsing user. We can use the CI form helper service to simplify the data entry buildup powered validation services.</p><p>The CI form helper<a id="id249" class="indexterm"/> provides a useful and comprehensive set of PHP functions for many data entry and input fashions. Among them we can find the data entry of the text field, the area text field, the radio button, checkbox, combo box, and menu option.</p><p>The following is a list of the most common <a id="id250" class="indexterm"/>CI form helper functions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">form_open()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_input()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_dropdown()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_password()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_upload()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_textarea()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_multiselect()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_checkbox()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_radio()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">form_close()</code></li></ul></div><p>The CI form helper generates<a id="id251" class="indexterm"/> an HTML portion<a id="id252" class="indexterm"/> that is<a id="id253" class="indexterm"/> rendered<a id="id254" class="indexterm"/> as part <a id="id255" class="indexterm"/>of the<a id="id256" class="indexterm"/> HTML<a id="id257" class="indexterm"/> file <a id="id258" class="indexterm"/>that<a id="id259" class="indexterm"/> is<a id="id260" class="indexterm"/> returned to the browser.</p><p>For example, let's take a look at a drop-down selection example of a color pickup.</p><div class="informalexample"><pre class="programlisting">&lt;HTML&gt;
&lt;?PHP
$attr = ' class="nice_field" ';
$options = array();
$options[0] = 'Blue';
$options[1] = 'Green';
$options[2] = 'Yellow';
$default    = 1;
echo form_dropdown("color", $options, $default, $attr);
?&gt;</pre></div><p>The <code class="literal">form_dropdown</code> helper will generate the following code:</p><div class="informalexample"><pre class="programlisting">&lt;select class="nice_field" name="color"&gt;
&lt;option value="0»&gt;Blue&lt;/option&gt;
&lt;option selected=»selected» value=»1»&gt;Green&lt;/option&gt;
&lt;option value=»2»&gt;Yellow&lt;/option&gt;
&lt;/select&gt;</pre></div><p>For more information, refer to the CI form help user manual.</p></div><div class="section" title="AJAX"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec72"/>AJAX</h2></div></div></div><p>Asynchronous JavaScript and XML services (AJAX) (<a class="ulink" href="http://en.wikipedia.org/wiki/Ajax">http://en.wikipedia.org/wiki/Ajax</a>) of JavaScript/jQuery integration within a view is critical today in almost any web application.<a id="id261" class="indexterm"/> It provides an advanced user experience by operating asynchronously in parallel to the user operations, and updates only certain HTML selector portions and not the entire page as anon AJAX updates operate.</p><p>AJAX has many use case examples to enhance the user experience. The following are few common usage examples:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Autocomplete while the user typing into a field all the matches found shown in a pop-up list for the user to choose. Without AJAX autocomplete the UI service is almost impossible.</li><li class="listitem" style="list-style-type: disc">When submitting a form data entry  using AJAX enables to issue the server submission to store or process the date and show the result only in a specific selector (notification massage), instead of refreshing the whole page as form with the action, submission requires. (Format: Bullet)</li><li class="listitem" style="list-style-type: disc">When browsing many information pages (called pagination) and clicking on a certain page number to view. AJAX enables rendering the selected page to view within a selection DIV in the whole HTML page without refreshing the whole page. (Format: Bullet End)</li></ul></div><p>Currently, AJAX is<a id="id262" class="indexterm"/> becoming an essential view component, mostly enabled via the popular jQuery library, which makes it easy to use. AJAX is an extremely valuable UI asset for building smart and interactive views. For example, the following is an example of the AJAX service that, for a given <span class="strong"><strong>SSN</strong></span> (<span class="strong"><strong>Social Security Number</strong></span>),<a id="id263" class="indexterm"/> provides the person's name and phone number in the defined selectors, if found, or alerts, if else. Whenever the user is clicking on the <span class="strong"><strong>Get Info</strong></span> button, an AJAX call is triggered, and an asynchronous AJAX call to an AJAX controller is sent with the SSN to get the person's record. When the response is returned, if the SSN was found, the phone and name of the person will be updated. Otherwise, a notification will be provided that the SSN person's record was not found.</p><p>The following is the code implementing the process described previously, where the AJAX call is the heart of the operation:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
function get_person_info (SSN_val, name_sel, phone_sel, err_sel) {
  /*
  //SSN_val –the value of the SSN user typed in to search 
  //name_sel–the name input that the Ajax will update if SSN found
..//phone_sel-the phone selector to be update if SSN found as well
  //err_sel-the error message area, to explain error such as SSN //not found or some other error occurred.
  */
  varajax_url = '&lt;?php echo base_url();?&gt;ajax/get_person_info';
  $.ajax({
    type: "POST",    //Very important POST is the best
    url: ajax_url,
    // the URI of the AJAX server side controller method that will processes this request
    data: {SSN: SSN_val},
    // SSN is the parameter name
    // SSN_val is the value
    dataType: "json",
    //the retuned data expected to be JSON
    success: function(data) { 
      // the data is the array conversion of the JSON data// retuned to ease our usage in the JavaScript!
      if(data.result=='found') {
        // Let's show the name and phone of the person with the//given SSN
        $(name_sel).val(data.name);
        $(phone_sel).val(data.phone);
      } else{
        // SSN Not found in the database!
        // Let's notify SSN has no person match
        $(err_sel).css ('color', 'red');
        $(err_sel).text('No person found with SSN' + SSN_val );
      }
    },
    error : //Ajax error occurred such as Ajax server not found//and so on
    function ( msg ) { alert ('Error:' + msg )
    $(err_sel).css ('color', 'red');
    $(err_sel).text ('Error:' + msg);
  }
});
// Wait for the document to be ready and bind the user click// on the #get id selector to call the AJAX search service// with the user typed SSN
$(function(){
  $('#get').click( function(){ 
    get_person_info ($('#SSN').val(),
    '#name',
    '#Phone',
    '#err_sel'
  );
  });
});
&lt;/script&gt;</pre></div><p>The following is the portion of the HTML form itself:</p><div class="informalexample"><pre class="programlisting">&lt;form&gt;
&lt;label&gt;Enter SSN&lt;/label&gt;
&lt;input type='text' name="SSN" id="SSN"&gt;
&lt;button id='get'&gt;Get Info&lt;/button&gt;
&lt;BR/&gt;
&lt;label&gt;Name&lt;/label&gt;&lt;B id='name'&gt;&lt;/B&gt;&lt;BR/&gt;
&lt;label&gt;phone&lt;/label&gt;&lt;B id='phone'&gt;&lt;/B&gt;
&lt;/form&gt;
&lt;B id='err_sel'&gt;&lt;/B&gt;</pre></div></div><div class="section" title="Parser configuration issues"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec73"/>Parser configuration issues</h2></div></div></div><p>The view is <a id="id264" class="indexterm"/>parsed by the CI parser<a id="id265" class="indexterm"/> before it is rendered <a id="id266" class="indexterm"/>back to the requesting browser. The default syntax to echo a PHP parameter / calculated expression value within the HTML tags is <code class="literal">&lt;?PHP echo trim($param); ?&gt;</code>.</p><p>However, CI provides automatic PHP short tag parsing support configuration at <code class="literal">application/config/config.php</code> and at the configuration parameter <code class="literal">$config['rewrite_short_tags'] = TRUE;</code>.</p><p>If <code class="literal">rewrite_short_tags</code> is set to <code class="literal">TRUE</code>, we can use the short tag of <code class="literal">&lt;?=trim($param)?&gt;</code>.</p><p>An important note on this is that in terms of debugging, the non-short/regular PHP echo format is preferred, as the short form errors might be more difficult to trace in this fashion. However, since this fashion is used in many code projects we've seen, we are mentioning it as well.</p></div><div class="section" title="Integrating jQuery or other client-side libraries"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec74"/>Integrating jQuery or other client-side libraries</h2></div></div></div><p>CI provides the freedom to integrate any client-side libraries<a id="id267" class="indexterm"/>, so that CI does not have to be specially configured to, or we do not need to perform any special CI declarations.</p><p>The client-side integration<a id="id268" class="indexterm"/> is performed in the same fashion, as if no platform is being used; they are completely transparent. However, CI provides client-side jQuery code generation services via PHP, such as building the JavaScript library to create jQuery code, as part of the controller coding.</p><div class="informalexample"><pre class="programlisting">$this-&gt;load-&gt;library('javascript');</pre></div><p>However, for the<a id="id269" class="indexterm"/> latest jQuery and many other JavaScript-based solutions today, there's no need to use this fashion of rendered JavaScript portions, but we can use the JavaScript A-Z in the view itself instead. A great resource for the (wow level) JavaScript libraries can be found in the largest resource for the JavaScript libraries we've found so far at <a class="ulink" href="http://www.jsdb.io">http://www.jsdb.io</a>.</p><p>Many more cool links for client-side platforms can be found at <a class="ulink" href="https://delicious.com/eliorr1961">https://delicious.com/eliorr1961</a>.</p><p>Note that the <a id="id270" class="indexterm"/>directory path for the sources in the CI views is calculated, as if the view file is in the project root.</p><p>For example, let's say the JavaScript library is located at <code class="literal">&lt;Project_root&gt;/javascript/myjs.js</code>.</p><p>And the view is located either at the <code class="literal">&lt;Project_root&gt;/application/views/view1.php</code> or <code class="literal">&lt;Project_root&gt;/application/views/topicB/view2.php</code> view path under <code class="literal">views</code>.</p><p>After we provide the root path via the base tag using the built-in CI URL helper <code class="literal">&lt;base href="&lt;?php echo base_url() ?&gt;"/&gt;</code>, both will load <code class="literal">myjs.js</code> as follows:</p><div class="informalexample"><pre class="programlisting">&lt;script type='text/javascript'src="javascript/myjs.js" &gt;&lt;/script&gt;</pre></div><p>They load as if they were located at the project root. This is due to the fact that CI processes the requests and rendering views as part of the root directory <code class="literal">index.php</code>. Hence, all the directory paths for SRC or INCLUDE from view PHP portions are considered, as if they occurred from the project root directory. This is due to the fact that all URIs to the project are executed by <code class="literal">index.php</code>. So for all the project code, the directory path is as though your code was in the same directory of <code class="literal">index.php</code> or at the CI project root directory.</p></div><div class="section" title="Plugins for rendering view"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec75"/>Plugins for rendering view</h2></div></div></div><p>As mentioned <a id="id271" class="indexterm"/>at the beginning of this <a id="id272" class="indexterm"/>chapter, we can use third-party libraries to enable us to create more advanced rendering services in a template layout fashion.</p><p>For example, the CodeIgniter template class<a id="id273" class="indexterm"/> by <span class="emphasis"><em>Colin Williams</em></span> available at <a class="ulink" href="http://www.williamsconcepts.com/ci/libraries/template/index.html">http://www.williamsconcepts.com/ci/libraries/template/index.html</a>.</p><p>This plugin enables us to define the rendered page as a <span class="strong"><strong>Lego</strong></span> fashioned layout with predefined page regions, so that we can have a different PHP CI view to render each of them.</p><p>This way we can have great reusability and a unified look, and fill in the entire application page, which in many cases is a good <span class="strong"><strong>UX</strong></span> (<span class="strong"><strong>User Experience</strong></span>)<a id="id274" class="indexterm"/> practice. In this case, the user, let's say, will know that on the top they will have a certain main navigation area, on the right certain status info and operational shortcuts, and so on.</p><p>We can define one <a id="id275" class="indexterm"/>or more layouts, so that each page layout template will have its region's organization. Each region is commonly defined within a DIV.</p><p>Having several template layouts, we can initially choose the proper layout we want to use, and then we will load its region content using the CI views defined for each region. For example, let's say we want to have a certain layout named <code class="literal">default</code>.</p><p>The <code class="literal">default</code> template's main layout will be named, <code class="literal">template,</code> for example, using the view file <code class="literal">main_template.php</code>, so that <code class="literal">main_template.php</code> will include the following regions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">header</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">upper_navigation</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">content</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">footer</code></li></ul></div><p>We shall perform the following configurations at <code class="literal">application/config/template.php</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>This is not the CI built-in plugin, but an additional plugin with the library and configuration file, and other assets we have installed to our CI project.</p></div></div><div class="informalexample"><pre class="programlisting">//The default template shall be defined as follow:
//Note, more templates can be defined in the same fashion
$template['default']['template'] = 'main_template';
$template['default']['regions'] = array ('header', 'upper_navigation', 'content', 'footer');</pre></div><p>The <code class="literal">main_template</code> refers to <code class="literal">application/views/main_template.php</code>.</p><p>The content of <code class="literal">main_template.php</code> will include rendering of all the defined template regions as follows:</p><div class="informalexample"><pre class="programlisting">&lt;html&gt;
&lt;body&gt;
&lt;div&gt;&lt;?=$header;?&gt;&lt;/div&gt;
&lt;div &gt;&lt;?= $upper_navigation;?&gt;&lt;/div&gt;
&lt;div&gt;&lt;!--main content area --&gt;
&lt;?= $content; ?&gt;
&lt;/div&gt;
&lt;!-- #footer --&gt;
&lt;?=$footer;?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>In order to use the preceding template plugin, we will do the following:</p><p>First, load the template library in the CI controller constructor/s where we want to use the template. Remember that the template library is located at &lt;Project_root&gt;/application/libraries/Template.php.</p><p>We shall load the template library as follows:</p><p><code class="literal">$this-&gt;load-&gt;library('template');</code></p><p><code class="literal">&lt;Project_root&gt;/application/libraries/Template.php</code></p><div class="informalexample"><pre class="programlisting">$this-&gt;load-&gt;library('template');</pre></div><p>Then, we will load the specific template file we have configured (we can define many to choose from), let's say, in the controller constructor, we will also assume that all the controller methods use the same template.</p><div class="informalexample"><pre class="programlisting">//set the selected template from the template config we want//to use
$this-&gt;template-&gt;set_template('default');</pre></div><p>Now, for rendering the template regions into a rendered view using the predefined view . We will do as follows:</p><p>For each template region at, let's say, <code class="literal">&lt;Project_root&gt;/application/views/</code>, we shall load it to the corresponding region as follows:</p><div class="informalexample"><pre class="programlisting">$this-&gt;template-&gt;write_view ('header', 'header_view', $data);.
$this-&gt;template-&gt;write_view('upper_navigation', 'upper_navigation_view', $data );
$this-&gt;template-&gt;write_view ('content', 'content_view', $data);
$this-&gt;template-&gt;write_view ('footer', 'footer_view', $data);</pre></div><p>Now the template regions are rendered with their region view files. We can render the whole template with all its regions as follows:</p><div class="informalexample"><pre class="programlisting">// Now, we have all the regions rendered into the
// template instance buffer, we can render them all to
// the desired template base page.
$this-&gt;template-&gt;render();</pre></div><p>The point to remember is that templates have great pros, but also some cons. The template dictates a very strict way of rendering a template base page that does not always have the desired flexibility, so that we may find ourselves writing several templates and switch between them, according to the UI situation.</p></div></div>
<div class="section" title="Example 1 &#x2013; HTML5 location powered by Google Maps"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec46"/>Example 1 – HTML5 location powered by Google Maps</h1></div></div></div><p>In this example, we will expand the Google Maps integration example from <a class="link" href="ch04.html" title="Chapter 4. Libraries">Chapter 4</a>, <span class="emphasis"><em>Libraries</em></span>, so that there will be a new option of showing the user where they are located on the Google Map. For<a id="id276" class="indexterm"/> doing so, we will use the HTML5 <code class="literal">navigator.geolocation</code> service to request the browsing user to share its location with the application. If the user agrees, and is using an advanced browser, such as the latest Firefox, Chrome builds that support to this service. Once we get the values, we will collect the geolocation, and call a controller method to prepare the Google Map of that area to render a Google Map view with the option <code class="literal">navigator</code>. We will use the HTML5 <code class="literal">navigator.geolocation</code> service as follows:</p><div class="informalexample"><pre class="programlisting">
<code class="literal">navigator.geolocation.getCurrentPosition(getLocation, locationFail);</code>
</pre></div><p>Here, <code class="literal">getLocation</code> is called, if the location was successfully fetched, and <code class="literal">locationFail</code>, if it was failed.</p><p>We will start with the controller first.</p><div class="section" title="The controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec76"/>The controller file</h2></div></div></div><p>The <a id="id277" class="indexterm"/>controller PHP file is located at <code class="literal">application/controllers/gmaps.php</code>. The following is the controller code based on <a class="link" href="ch04.html" title="Chapter 4. Libraries">Chapter 4</a>, <span class="emphasis"><em>Libraries</em></span>, for the extended Google Maps API integration example, where the new parts of code are highlighted:</p><div class="informalexample"><pre class="programlisting">class Gmaps extends CI_Controller
{
<span class="strong"><strong>// Extends the CI controller to be our Gmaps controller powered by </strong></span>
<span class="strong"><strong>// the Google API wrapper library.</strong></span>
<span class="strong"><strong>  // Setting the initialization parameters of Google Maps </strong></span>
<span class="strong"><strong>  // Library Mapper for the window size where the </strong></span>
<span class="strong"><strong>  // user interaction with Google Maps created window will occur</strong></span>
<span class="strong"><strong>  private $user_lon = 0;</strong></span>
<span class="strong"><strong>  private $user_lat = 0;</strong></span>
  function __construct()
  {parent::__construct();
    $this-&gt;load-&gt;library('googlemaps');
    // Set the map window sizes:
    $config['map_width'] = "1000px";  // map window width
    $config['map_height'] = "1000px";  // map window height
    $this-&gt;googlemaps-&gt;initialize($config);
  }
  function index()
  {
  /*Initialize and setup Google Maps for our App starting with 3 marked places: London, UK, Bombai, India, Rehovot, Israel */
  // Initialize our map for this use case of show 3 places // altogether.
  // let the zoom be automatically decided by Google for// showing the several places in one view
  $config['zoom'] = "auto";
  $this-&gt;googlemaps-&gt;initialize($config);
  //Define the places we want to see marked on Google Map!
  $this-&gt;add_visual_flag ('London, UK');
  $this-&gt;add_visual_flag ('Bombai, India');
  $this-&gt;add_visual_flag ('Rehovot, Israel');
  
<span class="strong"><strong>  // **NEW CODE ** </strong></span>
<span class="strong"><strong>  // optional user location if user allow it and was fetched// successfully</strong></span>
<span class="strong"><strong>  if ( $this-&gt;is_user_location_defined () ) {</strong></span>
<span class="strong"><strong>    $this-&gt;add_visual_flag ($this-&gt;get_user_location ());</strong></span>
<span class="strong"><strong>  }</strong></span>
  
  $data = $this-&gt;load_map_setting ();
  // Load our view, passing the map data that has just been //created.
  $this-&gt;load-&gt;view('google_map_view', $data);
}
<span class="strong"><strong>// ** NEW CODE **</strong></span>
<span class="strong"><strong>function user_location ($lat=0, $lon=0)</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>  // This is a new code we add for showing the //Geolocation fetched from the view base HTML5 Geolocation//service.</strong></span>
<span class="strong"><strong>  //Initialize our map with it if it is set.</strong></span>
<span class="strong"><strong>  if (! $lat&amp;&amp; ! $lon ) $this-&gt;index();</strong></span>
<span class="strong"><strong>  </strong></span>
<span class="strong"><strong>  // They are ok - let's keep them </strong></span>
<span class="strong"><strong>  $this-&gt;user_lat = $lat;</strong></span>
<span class="strong"><strong>  $this-&gt;user_lon = $lon;</strong></span>
<span class="strong"><strong>  $config['center'] = $this-&gt;get_user_location ();</strong></span>
<span class="strong"><strong>  // Define the address we want to be on the map center</strong></span>
<span class="strong"><strong>  $config['zoom'] = "5";</strong></span>
<span class="strong"><strong>  // since its approximate location is country level</strong></span>
<span class="strong"><strong>  $this-&gt;googlemaps-&gt;initialize($config);</strong></span>
<span class="strong"><strong>  //Add visual flag</strong></span>
<span class="strong"><strong>  $this-&gt;add_visual_flag ($config['center']);</strong></span>
<span class="strong"><strong>  $data = $this-&gt;load_map_setting ();</strong></span>
<span class="strong"><strong>  // Load our view, passing the map data that has just been //created.</strong></span>
<span class="strong"><strong>  $this-&gt;load-&gt;view('google_map_view', $data);</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>// ** NEW CODE</strong></span>
<span class="strong"><strong>functionis_user_location_defined ( ) {</strong></span>
<span class="strong"><strong>  return ( $this-&gt;user_lat != 0 ) || ( $this-&gt;user_lon!= 0 );</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>// ** NEW CODE</strong></span>
<span class="strong"><strong>functionget_user_location ( ) {</strong></span>
<span class="strong"><strong>  return $this-&gt;user_lat.", ".$this-&gt;user_lon;</strong></span>
<span class="strong"><strong>  }</strong></span>

functionlondon() 
{
  // as before
  }

functionbombai()
{
  // as before
  }
functionrehovot()
{
  // as before
  }
functionload_map_setting ( ) {
  // as before
  }
functionadd_visual_flag ( $place ) {
  // as before
  }
}
//End class Gmaps</pre></div></div><div class="section" title="The view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec77"/>The view file</h2></div></div></div><p>The<a id="id278" class="indexterm"/> view PHP file is located at <code class="literal">application/views/google_map_view.php</code>.The following is the view file code based on <a class="link" href="ch04.html" title="Chapter 4. Libraries">Chapter 4</a>, <span class="emphasis"><em>Libraries</em></span>, for the extended Google Maps API usage example view, where the new parts of code are highlighted.</p><p>Here, we add an HTML5 service in JavaScript to collect the user's geolocation, and call the controller method <code class="literal">user_location ($lat=0, $lon=0)</code>.</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html"&gt;
&lt;meta http-equiv="Content-type" content="text/html;charset=utf-8" /&gt;
&lt;html&gt;
&lt;head&gt;
&lt;script src="http://code.jquery.com/jquery-latest.js" type ='text/javascript'&gt;&lt;/script&gt;
&lt;script&gt;
<span class="strong"><strong>// New Code to get the user Geolocation and ask the controller to// render a Google Map for it.</strong></span>
<span class="strong"><strong>var latitude = 0;</strong></span>
<span class="strong"><strong>var longitude = 0;</strong></span>
<span class="strong"><strong>functionshow_on_map () {</strong></span>
<span class="strong"><strong>  var DIRECTORY_SEPARATOR = '/';</strong></span>
<span class="strong"><strong>  </strong></span>
<span class="strong"><strong>  // Prepare the URL path of calling the Gmaps controller method// user_location with latitude and longitude coordinates as// parameters using the CI naming convention of</strong></span>
<span class="strong"><strong>  // ControllerName/methodName/Param1/Param2</strong></span>
<span class="strong"><strong>  Var url_to_show = </strong></span>
<span class="strong"><strong>  '&lt;?php echo base_url(); ?&gt;index.php/gmaps/user_location/' +</strong></span>
<span class="strong"><strong>  longitude + DIRECTORY_SEPARATOR + latitude;</strong></span>
<span class="strong"><strong>  // Use jQuery to issue the HTTP controller call and rendering// request</strong></span>
<span class="strong"><strong>  $(location).attr('href', url_to_show );</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>$(document).ready(function() {</strong></span>
<span class="strong"><strong>  // if user clicks on the &lt;li&gt; for getting its Geolocation</strong></span>
<span class="strong"><strong>  $('#getmylocation').click(checkLocation);</strong></span>
<span class="strong"><strong>  functioncheckLocation() {</strong></span>
<span class="strong"><strong>    // Check if the browser supports the HTML5 Geolocation</strong></span>
<span class="strong"><strong>    // Note that navigator.geolocation will pop a request from// the user to allow getting its location (Privacy)</strong></span>
<span class="strong"><strong>    if (navigator.geolocation) {</strong></span>
<span class="strong"><strong>      // It does so let the user be notified</strong></span>
<span class="strong"><strong>      $('#notifications').html ( 'fetching your location, wait...' );</strong></span>
<span class="strong"><strong>      $('#notifications').css ( 'color', 'blue' );</strong></span>
<span class="strong"><strong>      </strong></span>
<span class="strong"><strong>      // Try to fetch the latitude/longitude of the browsing user//and provides the callbacks</strong></span>
<span class="strong"><strong>      // Success: getLocation</strong></span>
<span class="strong"><strong>      // Failure: locationFail</strong></span>
<span class="strong"><strong>      navigator.geolocation.getCurrentPosition(getLocation, locationFail);</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>    </strong></span>
<span class="strong"><strong>else {</strong></span>
<span class="strong"><strong>      $('#notifications').html( 'Sorry, your browser settings does not enable fetching yourGeolocation');</strong></span>
<span class="strong"><strong>    } // ends checkLocation()</strong></span>
<span class="strong"><strong>    //this is what happens if getCurrentPosition is successful</strong></span>
<span class="strong"><strong>    functiongetLocation(position) { </strong></span>
<span class="strong"><strong>      latitude = position.coords.latitude;</strong></span>
<span class="strong"><strong>      longitude = position.coords.longitude;</strong></span>
<span class="strong"><strong>      // Notify user for its location:</strong></span>
<span class="strong"><strong>      $('#notifications').html</strong></span>
<span class="strong"><strong>      ( 'Your approx. position : (' + latitude + ',' + longitude + ')' );</strong></span>
<span class="strong"><strong>      $('#notifications').css ( 'color', 'green' );</strong></span>
<span class="strong"><strong>      // Two seconds after the notification to user we have the// location issue call to the controller to show it on// the Google Map</strong></span>
<span class="strong"><strong>      setTimeout ( show_on_map, 2000);</strong></span>
<span class="strong"><strong>      }</strong></span>
<span class="strong"><strong>    //this is what happens if getCurrentPosition is unsuccessful//(getCurrentPositionerrorCallback)</strong></span>
<span class="strong"><strong>    functionlocationFail() {</strong></span>
<span class="strong"><strong>      $('#notifications').html('Sorry, your browser could not fetch your location ...');</strong></span>
<span class="strong"><strong>      $('#notifications').css ('color', 'red');</strong></span>
<span class="strong"><strong>      }</strong></span>
<span class="strong"><strong>    });</strong></span>
<span class="strong"><strong>    &lt;/script&gt;</strong></span>
    &lt;!—As Before..  --&gt;
<span class="strong"><strong>    &lt;!—Notification selector  --&gt;</strong></span>
<span class="strong"><strong>    &lt;HR&gt;&lt;/HR&gt;</strong></span>
<span class="strong"><strong>    &lt;DIV style='background:lightgreen;width:300px;'&gt;</strong></span>
<span class="strong"><strong>    &lt;span id='notifications'&gt;...&lt;/span&gt;</strong></span>
    &lt;/DIV&gt;
    &lt;HR&gt;&lt;/HR&gt;
    &lt;ul&gt;
    &lt;!-- Let the User Always Get Back to the default Zoom out withall places marked&gt;
    &lt;li&gt;&lt;?php echo anchor("index.php/gmaps", '&lt;B&gt;See All Locations&lt;/B&gt;' ) ?&gt;&lt;/li&gt;
<span class="strong"><strong>    &lt;!—If user clicks this one the Geo Location service will start --&gt;</strong></span>
<span class="strong"><strong>    &lt;li id = 'getmylocation' style = 'cursor: pointer;color: blue; decoration: underline'&gt; Show Me My Location&lt;/li&gt;</strong></span>
    &lt;!—As Before..  --&gt;</pre></div></div></div>
<div class="section" title="Example 2 &#x2013; user feedback powered by AJAX and the jQuery UI"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Example 2 – user feedback powered by AJAX and the jQuery UI</h1></div></div></div><p>In this example, <a id="id279" class="indexterm"/>we will show how we can use the jQuery UI with AJAX to call a CI AJAX controller method to collect the user feedback, and submit it without refreshing/rendering a page.</p><p>We will reuse and expand the login example from <a class="link" href="ch03.html" title="Chapter 3. Controller Usage and Scope">Chapter 3</a>, <span class="emphasis"><em>Usage and Scope of Controllers</em></span>, so if a user is logged in, we will log the feedback with the user ID kept in the session, while if not, we will log it as anonymous user feedback.</p><p>Remember the following things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Username</strong></span>: <code class="literal">reg_user</code>,</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Password</strong></span>: <code class="literal">111111111</code> (9 by 1s) for regular user login</li></ul></div><p>The reused and extended resources are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">auth.php</code>: No change here</li><li class="listitem" style="list-style-type: disc"><code class="literal">ajax_handler.php</code>: This is the new AJAX handler controller</li><li class="listitem" style="list-style-type: disc"><code class="literal">users_model.php</code>: This is the extended user model</li><li class="listitem" style="list-style-type: disc"><code class="literal">logged_in_view.php</code>: This is the extended view for regular user login</li></ul></div><p>We<a id="id280" class="indexterm"/> expand the code to include the new <code class="literal">Ajax_handler</code><a id="id281" class="indexterm"/> to keep the jQuery UI dialog submission of the browsing user feedback, as well as get the user logged message via the AJAX asynchronous interface. Note that we check in <code class="literal">Ajax_handler</code> to see whether the request is AJAX or not. And if it's not, we issue the following URL in the browser:</p><p><a class="ulink" href="http://photographersnav.com/ci_utils/index.php/ajax_handler">http://photographersnav.com/ci_utils/index.php/ajax_handler</a>.</p><p>We will get a notification in the browser that this is a bad request.</p><p>The <code class="literal">users_model</code> resource is expanded to provide a few more services, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">get_logged_in_user()</code>: This function is <a id="id282" class="indexterm"/>used to return the logged in user record if logged in or NULL otherwise. <code class="literal">get_user_rec</code> ( <code class="literal">$uid</code> ) to get a specific user record based on his/her ID.</li><li class="listitem" style="list-style-type: disc"><code class="literal">keep_user_feedback</code> (<code class="literal">$feedback</code>): This function is <a id="id283" class="indexterm"/>used to keep the user feedback in the database with its user ID, if logged in.</li><li class="listitem" style="list-style-type: disc"><code class="literal">get_user_feedbacks</code> (<code class="literal">$uid</code>): This function get all the user feedback messages save till now in the database as an array of the database objects. Each feedback database row returned have the feedback message and its timestamp formatted as HTML and returned via the JSON format back to the AJAX caller to be shown to the end user via the jQuery selector based HTML rendering (for example, <code class="literal">$(selector).html</code> (<code class="literal">The_html_item_returned_from_server</code>)).</li></ul></div><p>The <code class="literal">logged_in_view</code> resource<a id="id284" class="indexterm"/> is expanded to provide the user with the new services as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add a new feedback button, which when clicked pops-up a jQuery UI dialog for this purpose</li><li class="listitem" style="list-style-type: disc">Show the feedback log button, which when clicked shows a scrollable list of the user feedback</li></ul></div><p>Now let us review the source code itself.</p><div class="section" title="The ajax_handler.php controller file"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec78"/>The ajax_handler.php controller file</h2></div></div></div><p>The <a id="id285" class="indexterm"/>controller PHP file is located at <code class="literal">application/controllers/ajax_handler.php</code>. The code and inline explanations are as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php if (!defined('BASEPATH'))exit('No direct script access allowed');
class Ajax_handler extends CI_Controller {
  function __construct()
  {parent::__construct();
    /* Standard libraries, database &amp; helper URL loaded via theauto load
    */
    if (!$this-&gt;input-&gt;is_ajax_request())
    {exit( "Bad Request ignored! - Your info has been logged forfurther investigation of attacking the site!");
    }
  /* ------ Our Users Model ---------- */
  $this-&gt;load-&gt;model ( 'users_model' );
}

functionsave_user_feedback () {
  // Get the feedback content
  $feedback = $this-&gt;input-&gt;post('feedback');
  // Get if the user is logged in keep the user id
  $this-&gt;users_model-&gt;keep_user_feedback($feedback);
  }
functionget_user_feedback_log () {
  $user = $this-&gt;users_model-&gt;get_logged_in_user ();
  if ( $user ) $uid = $user-&gt;id;
  $user_feedback_rows = $this-&gt;users_model-&gt;get_user_feedbacks( $uid );
  $html = '';
  foreach ($user_feedback_rows as $row )
  $html.= $row-&gt;timestamp.' -  &lt;B&gt;'.$row-&gt;feedback.'&lt;/B&gt;&lt;BR/&gt;';
  $result = array ('result' =&gt; $html);
  echojson_encode ($result);
  return;
  }
} // End Ajax_handler</pre></div></div><div class="section" title="The users_model.php model file"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec79"/>The users_model.php model file</h2></div></div></div><p>The <a id="id286" class="indexterm"/>model PHP file is located at <code class="literal">application/models/users_model.php</code>. The code and inline explanations are as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php if (!defined('BASEPATH'))
exit('No direct script access allowed');
class Users_model extends CI_Model {
  function __construct()
  {parent::__construct();
  }
  functioncheck_login ($user, $pass)
  {
    /* No change here
    */ 
    }
  functionget_logged_in_user (  )
  {
    // Will check if there's a login user session and if so will// fetch its record
    $ci = &amp;get_instance();
    
    //get the login in user ID, if any
    $uid = $this-&gt;session-&gt;userdata('user_id');
    if (! $uid ) return NULL;
    $sql = "SELECT *
    FROMusers
    WHERE id = '$uid' ";
    
    $q = $ci-&gt;db-&gt;query($sql);
    if ($q-&gt;num_rows())
    {foreach ($q-&gt;result() as $row )
      return $row;
      }
    return NULL;
    }
    Function get_user_rec ( $uid ){
      // Will check if there's a login user session and if so will// fetch its record
      $ci = &amp;get_instance();
      // get the login in user ID, if any
      if (! $uid ) return NULL;
      $sql = "SELECT *FROM users WHERE id = '$uid' ";
      $q = $ci-&gt;db-&gt;query($sql);
      if($q-&gt;num_rows())
      {foreach ($q-&gt;result() as $row ) return $row;
        }
      return NULL;
      }
    Function keep_user_feedback ($feedback) {
      $ci = &amp;get_instance();
      $uid_rec = $this-&gt;get_logged_in_user ();
      $uid = $uid_rec ? $uid_rec-&gt;id: 0;
      /* id email uid feedback timestamp
      */
      $table = 'user_feedback';
      $data = array ( 'feedback'  =&gt;urldecode ($feedback),'uid'=&gt;  $uid);
      $ci-&gt;db-&gt;insert($table, $data);
      }
      Function  get_user_feedbacks ( $uid ) {
        $ci = &amp;get_instance();
        if (! $uid ) return NULL;
        $feedbacks = array();
        $table = 'user_feedback';
        $sql = "SELECT * FROM  $tableWHERE  uid = '$uid'
        ORDER BY timestamp DESC";
        $q = $ci-&gt;db-&gt;query($sql);
        if ( $q-&gt;num_rows() ) {
          foreach ($q-&gt;result() as $row)
          $feedbacks[] = $row;
          }
        return $feedbacks;
        }
      } // End Users_model</pre></div></div><div class="section" title="The logged_in_view.php view file"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec80"/>The logged_in_view.php view file</h2></div></div></div><p>The <a id="id287" class="indexterm"/>PHP view file is located at <code class="literal">application/views/logged_in_view.php</code>. This file was extended with several more services, as described in the previous examples. The code and inline explanations are as follows:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html"&gt;
&lt;meta http-equiv="Content-type" content="text/html;charset=utf-8" /&gt;
&lt;html&gt;
&lt;head&gt;
&lt;script src="http://code.jquery.com/jquery-latest.js" type='text/javascript'&gt;&lt;/script&gt;
&lt;scriptsrc="http://code.jquery.com/jquery-1.8.2.js"&gt;&lt;/script&gt;
&lt;script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"&gt;
&lt;/script&gt;
&lt;link rel="stylesheet" type="text/css" href="&lt;?=base_url(); ?&gt;/css/my_style.css" media="screen" /&gt;
&lt;script type='text/javascript'&gt;
// The AJAX handler controller method URLs
varsave_user_feedback_submitter = '&lt;?=site_url()?&gt;'+'index.php/ajax_handler/save_user_feedback';
varget_user_feedbacks = '&lt;?=site_url()?&gt;' +'index.php/ajax_handler/get_user_feedback_log';
functionajax_save_user_feedback (feedback) {
  $.ajax({
    type : "POST",
    url : save_user_feedback_submitter,
    data : {feedback: feedback},
    dataType: "json",
    success: function(data) {
      // When AJAX return back alert // ('Your feedback Updated - Thanks!');
      }
    });
  }

functionajax_get_user_feedback_log() {
  $.ajax({
    type: "POST",
    url: get_user_feedbacks,
    dataType: "json",
    success: function(data) {
      $('#feedback_log_view').show();
      $('#feedback_log_view').html(data.result);
      }
    });
  }
$(document).ready(function() {
  // Set up the jQuery UI feedback dialog
  $("#ideas-form").dialog({
    autoOpen: false,
    height: 270,
    width: 700,
    modal: true,
    resizable: false,
    effect: 'drop',
    direction: "up",
    show: "slide",
    buttons: {
      "Send Us Your Feedback": function() {
        varuser_feedback = $('#user_feedback').val();
        ajax_save_user_feedback(user_feedback);
        // clean feedback entry for next one
        $('#user_feedback').val('');
        // Show user all its feedback so far
        ajax_get_user_feedback_log();
        $(this).dialog("close");
        },
      "Cancel": function() {
        $(this).dialog("close");
        }
      }
    });
  
  // When user clicks on for a popup feedback window
  $('#user_ideas').button().click(function() {
    $("#ideas-form").dialog("open");
    });
  
  $('#feedback_log').button().click(function() {
    ajax_get_user_feedback_log();
    });
  });// Document ready section
&lt;/script &gt;
&lt;/head&gt;
&lt;body&gt;
&lt;H1&gt;Welcome &lt;?=$user_name; ?&gt;! &lt;/H1&gt;
&lt;H1&gt;You are logged in! &lt;/H1&gt;
&lt;HR&gt;&lt;/HR&gt;
  &lt;H3&gt;Your User ID is: &lt;?=$uid; ?&gt;&lt;/H3&gt;
  &lt;H3&gt;Your System Role is: &lt;?=$role; ?&gt;&lt;/H3&gt;
  &lt;H3&gt;Your Menu options: &lt;?=$menu; ?&gt;&lt;/H3&gt;
&lt;DIV&gt;
  &lt;button id='user_ideas' style="cursor: pointer; position: relative; top:0px" title='Share your feedback/ideas'&gt; Add A New Feedback &lt;/button&gt;&lt;BR/&gt;
  &lt;button id="feedback_log" style= "cursor: pointer; position: relative; top:0px" title="Your feedback log"&gt; See Your Feedback Log &lt;/button&gt;
&lt;/DIV&gt;
  &lt;div id='feedback_log_view' style= "display: none; width: 800 px; border-style: solid;border-color: black; overflow-x: auto; height: 200 px; overflow-y: auto;"&gt;
&lt;/DIV&gt;
&lt;H2&gt;&lt;?php echo anchor ('index.php/auth/logout', 'Logout')?&gt;&lt;/H2&gt;

  &lt;div id= "ideas-form", title= "Your Feedback To Improve"&gt;
&lt;form&gt;
&lt;fieldset&gt;
&lt;span id= "user_name" class= "text ui-widget-content ui-corner-all"&gt; Thanks &lt;? = $user_name; ?&gt;, Please share your feedback with us&lt;/span&gt;
&lt;textarea name= "idea_desc", id = "user_feedback", rows = "10" cols = "83", placeholder = 'Your ideas'&gt;&lt;/textarea&gt;
&lt;/fieldset&gt;
&lt;/form&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec48"/>Summary</h1></div></div></div><p>In this chapter, we have reviewed the CI views, scope as well as their general MVC scope, and the different types of views and usage. In addition, we showed how to integrate our CodeIgniter code with the third-party template plugin (the CI library, configuration, and additional code assets) for providing the view template services to the application controllers.</p><p>We have also learned the examples of integrating the jQuery UI and AJAX in the CI view with the CI controllers/models.</p></div></body></html>