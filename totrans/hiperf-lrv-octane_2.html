<html><head></head><body>
<div id="_idContainer018">
<h1 class="chapter-number" id="_idParaDest-29"><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-30"><a id="_idTextAnchor037"/><span class="koboSpan" id="kobo.2.1">Configuring the RoadRunner Application Server</span></h1>
<p><span class="koboSpan" id="kobo.3.1">When developing a web application in Laravel, we are used to using a web server for the delivery of our web application over </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">the network.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">A web server exposes </span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.6.1">the application via the </span><strong class="bold"><span class="koboSpan" id="kobo.7.1">HTTP</span></strong><span class="koboSpan" id="kobo.8.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.9.1">HTTPS</span></strong><span class="koboSpan" id="kobo.10.1"> protocol and implements functionality that </span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.11.1">is typically closely related to the delivery of resources </span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.12.1">via the </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">HTTP protocol.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">An application server is a somewhat </span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.15.1">more structured and complex piece of software in that it can handle different protocols; it can handle HTTP, as well as lower-level </span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.16.1">protocols such as </span><strong class="bold"><span class="koboSpan" id="kobo.17.1">TCP</span></strong><span class="koboSpan" id="kobo.18.1">, or other protocols, such </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">as </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.20.1">WebSocket</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.22.1">In addition, an application server can implement an articulated worker structure. </span><span class="koboSpan" id="kobo.22.2">This means that the application server </span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.23.1">for the execution of the application logic delegates its execution to a worker. </span><span class="koboSpan" id="kobo.23.2">A worker is an isolated thread that is tasked with executing a </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">given task.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">Worker management allows applications running via the application server to have access to features </span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.26.1">such as concurrency and parallel </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">task execution.</span></span></p>
<p><span class="koboSpan" id="kobo.28.1">The application server to be able to manage the various workers must also be able to implement load distribution features across workers and must also be able to implement proper balancing (using a </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">load balancer).</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">There are many </span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.31.1">application servers in the PHP ecosystem, two of which are </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">RoadRunner</span></strong><span class="koboSpan" id="kobo.33.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.34.1">Swoole</span></strong><span class="koboSpan" id="kobo.35.1">. </span><span class="koboSpan" id="kobo.35.2">They are relevant to the Laravel ecosystem because they are directly </span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.36.1">supported by </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">Laravel Octane.</span></span></p>
<p><span class="koboSpan" id="kobo.38.1">These two solutions have different features; however, both allow Laravel Octane to start different workers that will take over the resolution of </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">HTTP requests.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">Additional features accessible through Laravel Octane and available only in Swoole (and not in RoadRunner) are the ability to execute multiple concurrent functions, manage shared data in an optimized manner through special tables, and start functions in a scheduled and repetitive mode. </span><span class="koboSpan" id="kobo.40.2">We will walk through the additional features provided by Swoole in </span><a href="B17728_03.xhtml#_idTextAnchor048"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.41.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.42.1">, </span><em class="italic"><span class="koboSpan" id="kobo.43.1">Configuring the Swoole </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.44.1">Application Server</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.46.1">RoadRunner is perhaps the </span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.47.1">simplest application server in terms of available features, and it is also the easiest </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">to install.</span></span></p>
<p><span class="koboSpan" id="kobo.49.1">Therefore, in order to become familiar with the Laravel Octane configuration, we will start with </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">using RoadRunner.</span></span></p>
<p><span class="koboSpan" id="kobo.51.1">The goal of this chapter is to show you how to set up a basic Laravel application, add Laravel Octane, start using Octane with RoadRunner, and </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">configure it.</span></span></p>
<p><span class="koboSpan" id="kobo.53.1">Understanding the setup and the configurations are the first steps that allow you to control the behavior of </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.55.1">In this chapter we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.57.1">Setting up a basic </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">Laravel application</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.59.1">Installing RoadRunner</span></span></li>
<li><span class="koboSpan" id="kobo.60.1">Installing </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">Laravel Octane</span></span></li>
<li><span class="koboSpan" id="kobo.62.1">Launching </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">Laravel Octane</span></span></li>
<li><span class="koboSpan" id="kobo.64.1">Laravel Octane and RoadRunner </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">advanced configuration</span></span></li>
</ul>
<h1 id="_idParaDest-31"><a id="_idTextAnchor038"/><span class="koboSpan" id="kobo.66.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.67.1">This chapter will cover the framework and the application server setup (installation </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">and configuration).</span></span></p>
<p><span class="koboSpan" id="kobo.69.1">The assumption is that you have already installed PHP and Composer. </span><span class="koboSpan" id="kobo.69.2">We recommend you have PHP (at least version 8.0) and Composer updated to the </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">latest version.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1">Typically, we have two main approaches for installing languages and development tools. </span><span class="koboSpan" id="kobo.71.2">The first one is to install the tools directly in the operating system of your machine. </span><span class="koboSpan" id="kobo.71.3">The second one is to install the tools in an isolated environment such as a virtual machine </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">or Docker.</span></span></p>
<p><span class="koboSpan" id="kobo.73.1">If you want to follow the instructions and the examples in the book with Docker, the assumption is that you have Docker Desktop already installed on </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">your machine.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">For Docker, we will provide you instructions in order to have an image up and running with PHP </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">and Composer.</span></span></p>
<p><span class="koboSpan" id="kobo.77.1">With this approach, you will be able to run commands and follow examples the same way, regardless of whether you have Docker or want to run PHP and </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">Composer natively.</span></span></p>
<p><span class="koboSpan" id="kobo.79.1">We will launch commands from the console application (or Terminal Emulator) so the expectation is that you are quite familiar with this type of application (Terminal, iTerm2, Warp for MacOS, Windows Terminal for Windows, Terminator, xterm, GNOME Terminal, Konsole for GNU/Linux, or Alacritty, which is available for all </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">operating systems).</span></span></p>
<p><span class="koboSpan" id="kobo.81.1">Within the terminal emulator, you will need a shell environment, typically Bash or ZSH (Z shell). </span><span class="koboSpan" id="kobo.81.2">We will use the shell configuration to set some environment variables, such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">PATH</span></strong><span class="koboSpan" id="kobo.83.1"> variable. </span><span class="koboSpan" id="kobo.83.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">PATH</span></strong><span class="koboSpan" id="kobo.85.1"> variable specifies the directories to be searched to find </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">a command.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.87.1">Source code</span></p>
<p class="callout"><span class="koboSpan" id="kobo.88.1">You can find the source code of the examples used in this chapter in the official GitHub repository of this </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">book: </span></span><a href="https://github.com/PacktPublishing/High-Performance-with-Laravel-Octane/tree/main/octane-ch02"><span class="No-Break"><span class="koboSpan" id="kobo.90.1">https://github.com/PacktPublishing/High-Performance-with-Laravel-Octane/tree/main/octane-ch02</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.91.1">.</span></span></p>
<h1 id="_idParaDest-32"><a id="_idTextAnchor039"/><span class="koboSpan" id="kobo.92.1">Setting up a basic Laravel application</span></h1>
<p><span class="koboSpan" id="kobo.93.1">Our aim in this chapter is to </span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.94.1">configure Laravel Octane with the RoadRunner application server. </span><span class="koboSpan" id="kobo.94.2">To do that, we have to install the RoadRunner application server. </span><span class="koboSpan" id="kobo.94.3">However, before that, we must first create a new Laravel application and then add and install the Laravel Octane package. </span><span class="koboSpan" id="kobo.94.4">In short, to demonstrate how to install RoadRunner, we will do </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">the following:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.96.1">Create a new Laravel application </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">from scratch.</span></span></li>
<li><span class="koboSpan" id="kobo.98.1">Add the Laravel Octane package to the new </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">Laravel application.</span></span></li>
<li><span class="koboSpan" id="kobo.100.1">Install Laravel Octane, executing a specific command provided by the Laravel Octane package. </span><span class="koboSpan" id="kobo.100.2">The command execution will create a basic configuration, which is useful when we start with Laravel Octane. </span><span class="koboSpan" id="kobo.100.3">We will show how to install Laravel Octane in the </span><em class="italic"><span class="koboSpan" id="kobo.101.1">Installing Laravel Octane</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.102.1">section later.</span></span></li>
</ol>
<h2 id="_idParaDest-33"><a id="_idTextAnchor040"/><span class="koboSpan" id="kobo.103.1">Getting the Laravel installer</span></h2>
<p><span class="koboSpan" id="kobo.104.1">To install Laravel from </span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.105.1">scratch, you could use the Laravel installer. </span><span class="koboSpan" id="kobo.105.2">To globally install the Laravel installer, in your terminal emulator, enter </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.107.1">
composer global require laravel/installer</span></pre>
<p><span class="koboSpan" id="kobo.108.1">Once Laravel is installed, be sure that your </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">PATH</span></strong><span class="koboSpan" id="kobo.110.1"> variable includes the directory where the global composer packages are stored, typically </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">.composer/vendor/bin/</span></strong><span class="koboSpan" id="kobo.112.1"> in your </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">home directory.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">To make the </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">PATH</span></strong><span class="koboSpan" id="kobo.116.1"> variable persistent and to ensure that it is loaded correctly after rebooting your operating system, you can add it to your shell configuration file. </span><span class="koboSpan" id="kobo.116.2">For example, if you are using Zshell, add this line in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">zshrc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.119.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.120.1">
export PATH=$PATH:~/.composer/vendor/bin/</span></pre>
<p><span class="koboSpan" id="kobo.121.1">To make sure that your shell configuration is reloaded correctly and you are using Zshell, enter </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.123.1">
source ~/.zshrc</span></pre>
<p><span class="koboSpan" id="kobo.124.1">If you have some doubts, restart the console application (the application you are using to </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">launch commands).</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">To check if everything is fine, try to execute the Laravel installer tool with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.127.1">-V</span></strong><span class="koboSpan" id="kobo.128.1"> option via </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">command line:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.130.1">
laravel -V</span></pre>
<p><span class="koboSpan" id="kobo.131.1">If you receive an output such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">Laravel Installer 4.2.11</span></strong><span class="koboSpan" id="kobo.133.1">, everything is fine; otherwise, you could see an error such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">command not found</span></strong><span class="koboSpan" id="kobo.135.1">. </span><span class="koboSpan" id="kobo.135.2">In this case, my suggestion is to check </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.137.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">laravel</span></strong><span class="koboSpan" id="kobo.139.1"> command is present </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">~/.composer/vendor/bin/</span></strong></span></li>
<li><span class="koboSpan" id="kobo.142.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">laravel</span></strong><span class="koboSpan" id="kobo.144.1"> command </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">is executable</span></span></li>
<li><span class="koboSpan" id="kobo.146.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">PATH</span></strong><span class="koboSpan" id="kobo.148.1"> variable includes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">~/.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">composer/vendor/bin/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.151.1"> directory</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.152.1">To check whether the Laravel installer command is present and executable, you can check it with the classic </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">ls</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.154.1"> command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.155.1">
ls -l ~/.composer/vendor/bin/laravel</span></pre>
<p><span class="koboSpan" id="kobo.156.1">And to see if the permissions include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">x</span></strong><span class="koboSpan" id="kobo.158.1"> char, you will see something </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">like </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">-rwxr-xr-x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.162.1">If the command exists in the right place without executable permission, you can fix it with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">chmod</span></strong><span class="koboSpan" id="kobo.164.1"> command, adding executable (</span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">+x</span></strong><span class="koboSpan" id="kobo.166.1">) permission to the </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">owner (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">u</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.170.1">
chmod u+x ~/.composer/vendor/bin/laravel</span></pre>
<p><span class="koboSpan" id="kobo.171.1">If the command exists and has the right permissions, check if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">PATH</span></strong><span class="koboSpan" id="kobo.173.1"> variable is correct and includes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">~/.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">composer/vendor/bin/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.176.1"> path.</span></span></p>
<p><span class="koboSpan" id="kobo.177.1">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">PATH</span></strong><span class="koboSpan" id="kobo.179.1"> variable doesn’t include the right path, check that you added it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">PATH</span></strong><span class="koboSpan" id="kobo.181.1"> variable and if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">PATH</span></strong><span class="koboSpan" id="kobo.183.1"> variable includes the right path, be sure to have reloaded the shell environment or, at least, restart your </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">terminal emulator.</span></span></p>
<p><span class="koboSpan" id="kobo.185.1">I wanted to spend a </span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.186.1">few additional words on this type of check. </span><span class="koboSpan" id="kobo.186.2">This type of check is useful and will continue to be useful as we add new commands. </span><span class="koboSpan" id="kobo.186.3">The existence of the command, its permissions, and its reachability are checks that can save time if we run into problems running a newly </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">installed command.</span></span></p>
<p><span class="koboSpan" id="kobo.188.1">Now, let me show you how to install a Laravel application before adding </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">Laravel Octane.</span></span></p>
<h2 id="_idParaDest-34"><a id="_idTextAnchor041"/><span class="koboSpan" id="kobo.190.1">Installing a new Laravel web application from scratch</span></h2>
<p><span class="koboSpan" id="kobo.191.1">To create a new </span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.192.1">basic Laravel application, we can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">Laravel installer:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.194.1">
laravel new octane-ch2</span></pre>
<p><span class="koboSpan" id="kobo.195.1">If you don’t have a Laravel installer, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">composer</span></strong><span class="koboSpan" id="kobo.197.1"> command to install the </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">Laravel application:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.199.1">
composer create-project laravel/laravel octane-ch2</span></pre>
<p><span class="koboSpan" id="kobo.200.1">In this basic usage, these commands (</span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">laravel new</span></strong><span class="koboSpan" id="kobo.202.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">composer create-project</span></strong><span class="koboSpan" id="kobo.204.1">) are pretty similar. </span><span class="koboSpan" id="kobo.204.2">They do </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.206.1">Clone the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">laravel/laravel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.208.1"> repository</span></span></li>
<li><span class="koboSpan" id="kobo.209.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">.env</span></strong><span class="koboSpan" id="kobo.211.1"> file </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">.env.example</span></strong></span></li>
<li><span class="koboSpan" id="kobo.214.1">Install all dependencies found </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">composer.json</span></strong></span></li>
<li><span class="koboSpan" id="kobo.217.1">Generate optimized </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">autoload files</span></span></li>
<li><span class="koboSpan" id="kobo.219.1">Register or discover any new supported packages via the execution of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">php artisan </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">package:discover</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.222.1"> command</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">Publish </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">laravel-assets</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.225.1"> files</span></span></li>
<li><span class="koboSpan" id="kobo.226.1">Generate the application key in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">env</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.229.1"> file</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.230.1">I suggest you use the Laravel command because it has some additional options and arguments that allow you to enable some nice features, such as adding Jetstream scaffolding, choosing the Livewire stack or Inertia for Jetstream, and enabling teams management for Jetstream. </span><span class="koboSpan" id="kobo.230.2">All these options, for the goal we currently have, are not needed, so for this reason using the first or second command has the </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">same result.</span></span></p>
<p><span class="koboSpan" id="kobo.232.1">So, now you can enter the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">octane-ch2</span></strong><span class="koboSpan" id="kobo.234.1"> directory to check your new </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">Laravel application.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">To launch the internal </span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.237.1">web server, you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">artisan</span></strong><span class="koboSpan" id="kobo.239.1"> command provided </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">by Laravel:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.241.1">
php artisan serve</span></pre>
<p><span class="koboSpan" id="kobo.242.1">If you open the browser at http://127</span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">.0.0.1:8000</span></strong><span class="koboSpan" id="kobo.244.1"> you can see the default home page </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">of Laravel.</span></span></p>
<p><span class="koboSpan" id="kobo.246.1">Now that we have our Laravel application up and running, it’s time to set up the RoadRunner </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">application server.</span></span></p>
<h1 id="_idParaDest-35"><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.248.1">Installing RoadRunner</span></h1>
<p><span class="koboSpan" id="kobo.249.1">RoadRunner is a PHP application </span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.250.1">server that is </span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.251.1">mature and stable, so you can </span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.252.1">use it in your production environment. </span><span class="koboSpan" id="kobo.252.2">It is written in the </span><strong class="bold"><span class="koboSpan" id="kobo.253.1">Go</span></strong><span class="koboSpan" id="kobo.254.1"> programming language, which means that under the hood, RoadRunner uses goroutines and the multi-threading capabilities provided by Go. </span><span class="koboSpan" id="kobo.254.2">Thanks to its Go implementation, RoadRunner runs on the most common operating systems, such as macOS, Windows, Linux, FreeBSD, </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">and ARM.</span></span></p>
<p><span class="koboSpan" id="kobo.256.1">Thanks again to its Go implementation, RoadRunner is released as a binary, so the installation process is </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">very simple.</span></span></p>
<p><span class="koboSpan" id="kobo.258.1">RoadRunner is an open source project, so you have access to the source code, binaries, </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">and documentation:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.260.1">The source </span><a id="_idIndexMarker121"/><span class="No-Break"><span class="koboSpan" id="kobo.261.1">code: </span></span><a href="https://github.com/roadrunner-server/roadrunner"><span class="No-Break"><span class="koboSpan" id="kobo.262.1">https://github.com/roadrunner-server/roadrunner</span></span></a></li>
<li><span class="koboSpan" id="kobo.263.1">The binary </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">releases: </span></span><a href="https://github.com/roadrunner-server/roadrunner/releases"><span class="No-Break"><span class="koboSpan" id="kobo.265.1">https://github.com/roadrunner-server/roadrunner/releases</span></span></a></li>
<li><span class="koboSpan" id="kobo.266.1">The main </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">documentation: </span></span><a href="https://roadrunner.dev/docs/readme/2.x/en"><span class="No-Break"><span class="koboSpan" id="kobo.268.1">https://roadrunner.dev/docs/readme/2.x/en</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.269.1">We can obtain RoadRunner in more than </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">one way.</span></span></p>
<p><span class="koboSpan" id="kobo.271.1">Just for starting </span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.272.1">quickly, I’m going to use the Composer method. </span><span class="koboSpan" id="kobo.272.2">The Composer approach requires </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">two steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.274.1">Install the </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">RoadRunner CLI.</span></span></li>
<li><span class="koboSpan" id="kobo.276.1">Get RoadRunner binaries via the </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">RoadRunner CLI.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.278.1">So, as a first step, let me install the RoadRunner CLI, according to the official documentation available </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">at </span></span><a href="https://roadrunner.dev/docs/intro-install"><span class="No-Break"><span class="koboSpan" id="kobo.280.1">https://roadrunner.dev/docs/intro-install</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.281.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.282.1">
composer require spiral/roadrunner:v2.0 nyholm/psr7</span></pre>
<p><span class="koboSpan" id="kobo.283.1">As you can see, we are going to add </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">two packages:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.285.1">RoadRunner CLI </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">version 2</span></span></li>
<li><span class="koboSpan" id="kobo.287.1">The Nyholm implementation </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">of </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.289.1">PSR7</span></strong></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.290.1">Nyholm</span></p>
<p class="callout"><span class="koboSpan" id="kobo.291.1">Nyholm is an open source PHP package </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.292.1">that implements the PSR7 standard. </span><span class="koboSpan" id="kobo.292.2">The source </span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.293.1">code is </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">here: </span></span><a href="https://github.com/Nyholm/psr7"><span class="No-Break"><span class="koboSpan" id="kobo.295.1">https://github.com/Nyholm/psr7</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.296.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.297.1">At the end, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">composer</span></strong><span class="koboSpan" id="kobo.299.1"> command adds two lines into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">require</span></strong><span class="koboSpan" id="kobo.301.1"> section of your </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">composer.json</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.303.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.304.1">
        "nyholm/psr7": "^1.5",
        "spiral/roadrunner": "v2.0"</span></pre>
<p><span class="koboSpan" id="kobo.305.1">The mentioned, PSR7 is a standard that defines the PHP interfaces for representing HTTP messages and URIs. </span><span class="koboSpan" id="kobo.305.2">In this way, if you are going to use a library to manage HTTP messages and URIs, and the library implements a PSR7 standard, you know that you have some methods with a standardized signature to manage the request. </span><span class="koboSpan" id="kobo.305.3">For example, you know that you have </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">getMethod()</span></strong><span class="koboSpan" id="kobo.307.1"> to retrieve the HTTP method, and the value is a string (because is defined by </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">the standard).</span></span></p>
<p><span class="koboSpan" id="kobo.309.1">After installing the RoadRunner CLI via Composer, you will find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">rr</span></strong><span class="koboSpan" id="kobo.311.1"> executable in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">vendor/bin/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.313.1"> directory.</span></span></p>
<p><span class="koboSpan" id="kobo.314.1">To check that it’s there, use </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">this command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.316.1">
ls -l vendor/bin/rr</span></pre>
<p><span class="koboSpan" id="kobo.317.1">You will see a file, more or less 3 KB, with executable permissions (denoted by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.318.1">x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.319.1"> symbol).</span></span></p>
<p><span class="koboSpan" id="kobo.320.1">This executable is the RoadRunner CLI, which allows you to install the RoadRunner application server </span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.321.1">executable. </span><span class="koboSpan" id="kobo.321.2">To obtain the executable, you can execute the RoadRunner CLI with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">get-binary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.323.1"> option:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.324.1">
vendor/bin/rr get-binary</span></pre>
<p><span class="koboSpan" id="kobo.325.1">The output generated by the command execution will show the version of the package, the operating system, and the architecture as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">figure below:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.327.1"><img alt="Figure 2.1: Getting the RoadRunner executable" src="image/Figure_2.1_B17728.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.328.1">Figure 2.1: Getting the RoadRunner executable</span></p>
<p><span class="koboSpan" id="kobo.329.1">You might have some confusion in that the RoadRunner CLI executable is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">rr</span></strong><span class="koboSpan" id="kobo.331.1">, like the RoadRunner executable. </span><span class="koboSpan" id="kobo.331.2">What you should know is that the RoadRunner CLI is stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">vendor/bin</span></strong><span class="koboSpan" id="kobo.333.1"> directory, while the RoadRunner application server executable is stored in the project root directory. </span><span class="koboSpan" id="kobo.333.2">Also, the CLI is about 3 KB, while the application server is about </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">50 MB.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.335.1"><img alt="Figure 2.2: The two rr executables, the CLI and the application server" src="image/Figure_2.2_B17728.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.336.1">Figure 2.2: The two rr executables, the CLI and the application server</span></p>
<p><span class="koboSpan" id="kobo.337.1">In addition, you can run </span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.338.1">the two executables with the option to show </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">the version:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.340.1"><img alt="Figure 2.3: The rr versions" src="image/Figure_2.3_B17728.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.341.1">Figure 2.3: The rr versions</span></p>
<p><span class="koboSpan" id="kobo.342.1">Now that we have installed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">rr</span></strong><span class="koboSpan" id="kobo.344.1"> executables (RoadRunner), we can start to </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">use it.</span></span></p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.346.1">Executing the RoadRunner application server (without Octane)</span></h2>
<p><span class="koboSpan" id="kobo.347.1">To execute the </span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.348.1">RoadRunner application server with a basic example, we need to do </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.350.1">Create a </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">configuration file</span></span></li>
<li><span class="koboSpan" id="kobo.352.1">Create a PHP script called by the application server once an HTTP request hits the </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">application server</span></span></li>
<li><span class="koboSpan" id="kobo.354.1">Launch the </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">application server</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.356.1">The configuration file for RoadRunner by default is </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">.rr.yaml</span></strong><span class="koboSpan" id="kobo.358.1">. </span><span class="koboSpan" id="kobo.358.2">It has a lot of configuration directives </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">and parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.360.1">A minimal configuration file requires a </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">few things:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.362.1">The command to launch for each worker </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">instance (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">server.command</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.366.1">The address and port to bind and listen for new HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">connections (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">http.address</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.370.1">The number of workers to </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">launch (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">http.pool.num_workers</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.374.1">The level of the </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">log (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">logs.level</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.378.1">An example of a configuration file with the preceding considerations is </span><span class="No-Break"><span class="koboSpan" id="kobo.379.1">shown here:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.380.1">
version: '2.7'
server:
  command: "php test-rr.php"
http:
  address: "0.0.0.0:8080"
  pool:
    num_workers: 2
logs:
  level: info</span></pre>
<p><span class="koboSpan" id="kobo.381.1">With this configuration file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">test-rr.php</span></strong><span class="koboSpan" id="kobo.383.1"> is the script to launch for workers, </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">8080</span></strong><span class="koboSpan" id="kobo.385.1"> is the port to listen to </span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.386.1">connections, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">2</span></strong><span class="koboSpan" id="kobo.388.1"> workers and </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">info</span></strong><span class="koboSpan" id="kobo.390.1"> for the </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">log levels.</span></span></p>
<p><span class="koboSpan" id="kobo.392.1">The script file for implementing the logic of the workers </span><span class="No-Break"><span class="koboSpan" id="kobo.393.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">test-rr.php</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.396.1">
&lt;?php
include 'vendor/autoload.php';
use Nyholm\Psr7;
use Spiral\RoadRunner;
$worker = RoadRunner\Worker::create();
$psrFactory = new Psr7\Factory\Psr17Factory();
$worker = new RoadRunner\Http\PSR7Worker($worker, $psrFactory, $psrFactory, $psrFactory);
// creating a unique identifier specific for the worker
$id = uniqid('', true);
echo "STARTING ${id}";
while ($req = $worker-&gt;waitRequest()) {
    try {
        $rsp = new Psr7\Response();
        $rsp-&gt;getBody()-&gt;write("Hello ${id}");
        echo "RESPONSE SENT from ${id}";
        $worker-&gt;respond($rsp);
    } catch (\Throwable $e) {
        $worker-&gt;getWorker()-&gt;error((string) $e);
        echo 'ERROR ' . </span><span class="koboSpan" id="kobo.396.2">$e-&gt;getMessage();
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.397.1">The script </span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.398.1">does </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">the following:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.400.1">Includes </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">vendor/autoload.php</span></strong></span></li>
<li><span class="koboSpan" id="kobo.402.1">Instances the </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">worker</span></strong><span class="koboSpan" id="kobo.404.1"> object with classes provided by </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">RoadRunner (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">RoadRunner\Http\PSR7Worker</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">Generates a unique ID for showing how the traffic is balanced and delegated to the two workers (</span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">$id = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">uniqid('', true)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.412.1">Waits for a new </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">connection (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">$worker-&gt;waitRequest()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.416.1">Generates a new response  (</span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">$worker-&gt;respond()</span></strong><span class="koboSpan" id="kobo.418.1">) when a new connection </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">request arrives</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.420.1">With the configuration file and the preceding worker script, you can launch the application server with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">serve</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.422.1"> option:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.423.1">
./rr serve</span></pre>
<p><span class="koboSpan" id="kobo.424.1">With this configuration, you will see one server started and two workers started by </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">the server.</span></span></p>
<p><span class="koboSpan" id="kobo.426.1">Now you can hit the </span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.427.1">serve via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">curl</span></strong><span class="koboSpan" id="kobo.429.1"> command. </span><span class="koboSpan" id="kobo.429.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">curl</span></strong><span class="koboSpan" id="kobo.431.1"> command is a command </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.432.1">that sends an HTTP request to a </span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">specific URL.</span></span></p>
<p><span class="koboSpan" id="kobo.434.1">In another instance for the terminal emulator (or another tab), launch </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.436.1">
curl localhost:8080</span></pre>
<p><span class="koboSpan" id="kobo.437.1">By executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">curl</span></strong><span class="koboSpan" id="kobo.439.1"> four times, we will send four different requests to the application server to </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">port </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">8080</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.443.1">On the terminal emulator, if you launch the application server, you will see the log of the </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">application server:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.445.1"><img alt="Figure 2.4: The INFO log of the application server" src="image/Figure_2.4_B17728.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.446.1">Figure 2.4: The INFO log of the application server</span></p>
<p><span class="koboSpan" id="kobo.447.1">The most relevant thing is that after the first two requests, the elapsed time is reduced by at least an order </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">of magnitude.</span></span></p>
<p><span class="koboSpan" id="kobo.449.1">If you look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">elapsed</span></strong><span class="koboSpan" id="kobo.451.1"> value, you will see that the first request takes 20 milliseconds to be executed, while subsequent requests take approximately some hundred microseconds (1 millisecond is equivalent to </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">1,000 microseconds).</span></span></p>
<p><span class="koboSpan" id="kobo.453.1">The response time in </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.454.1">milliseconds (the absolute value) probably depends on multiple factors (load, resources, memory, CPU). </span><span class="koboSpan" id="kobo.454.2">Take a look at the relative value and how much the response time decreases in the next requests. </span><span class="koboSpan" id="kobo.454.3">The response times are dramatically reduced from a few milliseconds to a </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">few microseconds.</span></span></p>
<p><span class="koboSpan" id="kobo.456.1">So, we are saying that thanks to the architecture based on workers implemented with RoadRunner, we can improve the performance, especially for requests after the </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">first request.</span></span></p>
<p><span class="koboSpan" id="kobo.458.1">But how do we include and use RoadRunner in our </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">Laravel application?</span></span></p>
<p><span class="koboSpan" id="kobo.460.1">The preceding example uses objects and methods shipped by RoadRunner in a pure PHP environment. </span><span class="koboSpan" id="kobo.460.2">Now we have to figure out how all of these features/improvements could be included in Laravel, especially </span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.461.1">for all things related to the bootstrap of </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">the framework.</span></span></p>
<p><span class="koboSpan" id="kobo.463.1">This is the goal of Octane. </span><span class="koboSpan" id="kobo.463.2">It allows us to use the RoadRunner features while hiding the complexity of the integration, the bootstrap process, and </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">the configuration.</span></span></p>
<h1 id="_idParaDest-37"><a id="_idTextAnchor044"/><span class="koboSpan" id="kobo.465.1">Installing Laravel Octane</span></h1>
<p><span class="koboSpan" id="kobo.466.1">The script file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">test-rr.php</span></strong><span class="koboSpan" id="kobo.468.1">) and the configuration file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.469.1">.rr.yaml</span></strong><span class="koboSpan" id="kobo.470.1">) were created so that the </span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.471.1">dynamics of the operation of RoadRunner can be understood. </span><span class="koboSpan" id="kobo.471.2">Now, let’s focus on the installation of Laravel Octane. </span><span class="koboSpan" id="kobo.471.3">Let’s pick up the discussion from the installation of the Laravel application via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">laravel new</span></strong><span class="koboSpan" id="kobo.473.1"> command and the installation of the RoadRunner executable by running </span><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">composer require</span></strong><span class="koboSpan" id="kobo.475.1"> and then running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">rr get-binaries</span></strong><span class="koboSpan" id="kobo.477.1">. </span><span class="koboSpan" id="kobo.477.2">Let me </span><span class="No-Break"><span class="koboSpan" id="kobo.478.1">recap quickly:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.479.1">
# installing Laravel application
laravel new octane-ch2b
# entering into the directory
cd octane-ch2b
# installing RoadRunner CLI
composer require spiral/roadrunner:v2.0 nyholm/psr7
# Obtaining Roadrunner Application Server executable, via CLI
vendor/bin/rr get-binary</span></pre>
<p><span class="koboSpan" id="kobo.480.1">Now you can install </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">Laravel Octane:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.482.1">
composer require laravel/octane</span></pre>
<p><span class="koboSpan" id="kobo.483.1">Then you can correctly configure Laravel Octane with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">octane:install</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.485.1"> command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.486.1">
php artisan octane:install</span></pre>
<p><span class="koboSpan" id="kobo.487.1">With the latest command, you have to decide whether to use RoadRunner or Swoole. </span><span class="koboSpan" id="kobo.487.2">For the purpose of this chapter, select RoadRunner. </span><span class="koboSpan" id="kobo.487.3">We will cover Swoole in the </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">next chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">The tasks performed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">octane:install</span></strong><span class="koboSpan" id="kobo.491.1"> are </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.493.1">Avoiding commit/push on </span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.494.1">Git repository RoadRunner files: check and eventually fix the </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">gitignore</span></strong><span class="koboSpan" id="kobo.496.1"> file that includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">rr</span></strong><span class="koboSpan" id="kobo.498.1"> (the RoadRunner executables) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">.rr.yaml</span></strong><span class="koboSpan" id="kobo.500.1"> (the RoadRunner </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">configuration file).</span></span></li>
<li><span class="koboSpan" id="kobo.502.1">Ensuring the RoadRunner package is installed in the project. </span><span class="koboSpan" id="kobo.502.2">If not, it executes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">composer </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">require</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.505.1"> command.</span></span></li>
<li><span class="koboSpan" id="kobo.506.1">Ensuring the RoadRunner binary is installed into the project. </span><span class="koboSpan" id="kobo.506.2">If not, it executes </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">./vendor/bin/rr get-binary</span></strong><span class="koboSpan" id="kobo.508.1"> to download the RoadRunner </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">application server.</span></span></li>
<li><span class="koboSpan" id="kobo.510.1">Ensuring the RoadRunner binary is executable (</span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">chmod 755</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.512.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.513.1">Checking some requirements, such as version 2.x, if the RoadRunner application server has already </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">been installed.</span></span></li>
<li><span class="koboSpan" id="kobo.515.1">Setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">OCTANE_SERVER</span></strong><span class="koboSpan" id="kobo.517.1"> environment variable in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">.env</span></strong><span class="koboSpan" id="kobo.519.1"> file (if it’s not </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">already present).</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.521.1">The last </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">octane:install</span></strong><span class="koboSpan" id="kobo.523.1"> command will create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">config/octane.php</span></strong><span class="koboSpan" id="kobo.525.1"> file and will also add a new </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.526.1">configuration key to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">.env</span></strong><span class="koboSpan" id="kobo.528.1"> file. </span><span class="koboSpan" id="kobo.528.2">The new key is named </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">OCTANE_SERVER</span></strong><span class="koboSpan" id="kobo.530.1"> and the value is set </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">roadrunner</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.534.1">This value is used in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">config/octane.php</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.536.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.537.1">
return [
    /*
    |--------------------------------------------------------------------------
    | Octane Server
    |--------------------------------------------------------------------------
    |
    | This value determines the default "server" that will
      be used by Octane
    | when starting, restarting, or stopping your server
      via the CLI. </span><span class="koboSpan" id="kobo.537.2">You
    | are free to change this to the supported server of
      your choosing.
</span><span class="koboSpan" id="kobo.537.3">    |
    | Supported: "roadrunner", "swoole"
    |
    */
    'server' =&gt; env('OCTANE_SERVER', 'roadrunner'),</span></pre>
<p><span class="koboSpan" id="kobo.538.1">So, with the environment </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.539.1">variable, you can control which application server you want </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">to use.</span></span></p>
<p><span class="koboSpan" id="kobo.541.1">Now that we have installed Laravel Octane, it’s time to </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">launch it.</span></span></p>
<h1 id="_idParaDest-38"><a id="_idTextAnchor045"/><span class="koboSpan" id="kobo.543.1">Launching Laravel Octane</span></h1>
<p><span class="koboSpan" id="kobo.544.1">To launch </span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.545.1">Laravel Octane, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.546.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.547.1">
php artisan octane:start</span></pre>
<p><span class="koboSpan" id="kobo.548.1">Once Laravel Octane is started you can visit </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">http://127.0.0.1:8000</span></strong><span class="koboSpan" id="kobo.550.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">your browser.</span></span></p>
<p><span class="koboSpan" id="kobo.552.1">Your browser will be shown the classic Laravel welcome page. </span><span class="koboSpan" id="kobo.552.2">There are no visual differences in the welcome pages of Laravel and Laravel Octane. </span><span class="koboSpan" id="kobo.552.3">The big difference is the way your application is served </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">via HTTP.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">You can control the execution of Octane with </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">some parameters:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">--host</span></strong><span class="koboSpan" id="kobo.557.1">: Default </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">127.0.0.1</span></strong><span class="koboSpan" id="kobo.559.1">, the IP address the server should </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">bind to</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">--port</span></strong><span class="koboSpan" id="kobo.562.1">: Default </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">8000</span></strong><span class="koboSpan" id="kobo.564.1">, the port the server should be </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">available on</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.566.1">--workers</span></strong><span class="koboSpan" id="kobo.567.1">: Default auto, the number of workers that should be available to </span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">handle requests</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">--max-requests</span></strong><span class="koboSpan" id="kobo.570.1">: Default </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">500</span></strong><span class="koboSpan" id="kobo.572.1">, the number of requests to process before reloading </span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">the server</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.574.1">For example, you can launch Octane with just </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">two workers:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.576.1">
php artisan octane:start --workers=2</span></pre>
<p><span class="koboSpan" id="kobo.577.1">So now, open the page at </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">http://localhost:8000</span></strong><span class="koboSpan" id="kobo.579.1"> more than twice (two is the number of workers). </span><span class="koboSpan" id="kobo.579.2">You can open the page via your browser or by </span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">launching </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">curl</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.583.1">
curl localhost:8000</span></pre>
<p><span class="koboSpan" id="kobo.584.1">You can see </span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.585.1">something that we already know because of the previous tests with RoadRunner installed without Laravel. </span><span class="koboSpan" id="kobo.585.2">The first two requests (two is the number of workers) are slower than the </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">next requests.</span></span></p>
<p><span class="koboSpan" id="kobo.587.1">The following output is related to the log shown by the Laravel </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">Octane server:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.589.1">
  200    GET / .................................. </span><span class="koboSpan" id="kobo.589.2">76.60 ms
  200    GET / .................................. </span><span class="koboSpan" id="kobo.589.3">60.39 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.589.4">3.46 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.589.5">2.70 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.589.6">2.66 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.589.7">3.66 ms</span></pre>
<p><span class="koboSpan" id="kobo.590.1">If you launch the server, define the maximum number of requests to process (for each worker) before starting the server with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">max-requests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.592.1"> parameter:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.593.1">
php artisan octane:start --workers=2 --max-requests=3</span></pre>
<p><span class="koboSpan" id="kobo.594.1">You can see a similar output but after six requests (a maximum of three requests for two workers), you will see that the message worker has stopped and the response after the stopped worker takes the same amount of time as the first </span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">two requests:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.596.1">
  200    GET / .................................. </span><span class="koboSpan" id="kobo.596.2">86.56 ms
  200    GET / .................................. </span><span class="koboSpan" id="kobo.596.3">52.30 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.596.4">2.38 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.596.5">2.73 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.596.6">2.57 ms
worker stopped
  200    GET / ................................... </span><span class="koboSpan" id="kobo.596.7">2.75 ms
worker stopped
  200    GET / .................................. </span><span class="koboSpan" id="kobo.596.8">63.95 ms
  200    GET / .................................. </span><span class="koboSpan" id="kobo.596.9">60.83 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.596.10">1.75 ms
  200    GET / ................................... </span><span class="koboSpan" id="kobo.596.11">2.74 ms</span></pre>
<p><span class="koboSpan" id="kobo.597.1">Why is restarting the server important? </span><span class="koboSpan" id="kobo.597.2">To ensure we prevent any memory leak issues due to the long life cycle of the objects (the server and the workers), it is a common practice to reset the status. </span><span class="koboSpan" id="kobo.597.3">If you are not going to define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">max-requests</span></strong><span class="koboSpan" id="kobo.599.1"> parameter in the command line, the default is set automatically by Laravel Octane </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">500</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.603.1">In the classic web server scenario (without Laravel Octane), the life cycles of all objects related to your application, but especially to the objects automatically instantiated and managed by the framework, are confined to each individual request. </span><span class="koboSpan" id="kobo.603.2">In every single request, all the objects </span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.604.1">necessary for the framework to work are instantiated, and the objects are destroyed when the response is sent back to the client. </span><span class="koboSpan" id="kobo.604.2">This also explains and helps you understand why the response times in a classic framework with a web server are longer than the response times of an already </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">initialized worker.</span></span></p>
<p><span class="koboSpan" id="kobo.606.1">Now that Laravel Octane is launched, we can look at </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">its configuration.</span></span></p>
<h1 id="_idParaDest-39"><a id="_idTextAnchor046"/><span class="koboSpan" id="kobo.608.1">Laravel Octane and RoadRunner advanced configuration</span></h1>
<p><span class="koboSpan" id="kobo.609.1">As mentioned in the </span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.610.1">previous section, we can control some parameters </span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.611.1">during the launch of Laravel Octane. </span><span class="koboSpan" id="kobo.611.2">This is because you want to change some options, such as the number of workers or the port and, like in the next examples, if you want to activate the </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">HTTPS protocol.</span></span></p>
<p><span class="koboSpan" id="kobo.613.1">Under the hood, Octane collects parameters from the command line and some Octane configuration and starts the RoadRunner process (it starts the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">rr</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.615.1"> command).</span></span></p>
<p><span class="koboSpan" id="kobo.616.1">In the Octane source code, there is a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">StartRoadRunnerCommand.php</span></strong><span class="koboSpan" id="kobo.618.1"> that implements a Laravel artisan command with the </span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.620.1">
$server = tap(new Process(array_filter([
    $roadRunnerBinary,
    '-c', $this-&gt;configPath(),
    '-o', 'version=2.7',
    '-o', 'http.address='.$this-&gt;option('host').':
      '.$this-&gt;option('port'),
    '-o', 'server.command='.(new PhpExecutableFinder)-
     &gt;find().' </span><span class="koboSpan" id="kobo.620.2">'.base_path(config('octane.roadrunner
     .command', 'vendor/bin/roadrunner-worker')),
    '-o', 'http.pool.num_workers='.$this-&gt;workerCount(),
    '-o', 'http.pool.max_jobs='.$this-&gt;option(
      'max-requests'),
    '-o', 'rpc.listen=tcp://'.$this-&gt;option('host').':
     '.$this-&gt;rpcPort(),
    '-o', 'http.pool.supervisor.exec_ttl='
     .$this-&gt;maxExecutionTime(),
    '-o', 'http.static.dir='.base_path('public'),
    '-o', 'http.middleware='.config(
     'octane.roadrunner.http_middleware', 'static'),
    '-o', 'logs.mode=production',
    '-o', app()-&gt;environment('local') ? </span><span class="koboSpan" id="kobo.620.3">'logs.level=debug'
     : 'logs.level=warn',
    '-o', 'logs.output=stdout',
    '-o', 'logs.encoding=json',
    'serve',
]), base_path(), [
    'APP_ENV' =&gt; app()-&gt;environment(),
    'APP_BASE_PATH' =&gt; base_path(),
    'LARAVEL_OCTANE' =&gt; 1,
]))-&gt;start();</span></pre>
<p><span class="koboSpan" id="kobo.621.1">Looking at this source code helps you understand which parameters are used to launch the </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">RoadRunner executable.</span></span></p>
<p><span class="koboSpan" id="kobo.623.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">-c</span></strong><span class="koboSpan" id="kobo.625.1"> option (</span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">$this-&gt;configPath()</span></strong><span class="koboSpan" id="kobo.627.1">), an additional configuration file is loaded. </span><span class="koboSpan" id="kobo.627.2">This </span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.628.1">means that if there are no basic options </span><a id="_idIndexMarker144"/><span class="koboSpan" id="kobo.629.1">managed by Octane that match your expectations, you can define them in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">.rr.yaml</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.631.1">configuration file.</span></span></p>
<p><span class="koboSpan" id="kobo.632.1">The basic parameters managed by Octane (shown in the previous section) are hostname, port, worker count, max requests, max execution time for supervisor, the HTTP middleware, and the </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">log level.</span></span></p>
<p><span class="koboSpan" id="kobo.634.1">The RoadRunner configuration file allows you to load special and advanced configurations. </span><span class="koboSpan" id="kobo.634.2">A classic example is the option to allow local RoadRunner instances to listen to and receive </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">HTTPS requests.</span></span></p>
<p><span class="koboSpan" id="kobo.636.1">Why do you need to serve HTTPS locally in the development environment? </span><span class="koboSpan" id="kobo.636.2">You might need to activate the HTTPS protocol because some browser features are available only when the page is served via HTTPS or localhost. </span><span class="koboSpan" id="kobo.636.3">These features are geolocation, device motion, device orientation, audio recording, notifications, and </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.638.1">Typically, during local development, we are used to serving pages via localhost. </span><span class="koboSpan" id="kobo.638.2">In this context, there is no need to serve the traffic via HTTPS. </span><span class="koboSpan" id="kobo.638.3">However, if we wanted to expose pages to the </span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.639.1">local network so that we could </span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.640.1">test our web application via a mobile device connected to the local network, we would have to make sure that the service is reachable via a valid local network address and thus localhost is not sufficient. </span><span class="koboSpan" id="kobo.640.2">In this case (for those special browser features), HTTPS </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">is needed.</span></span></p>
<p><span class="koboSpan" id="kobo.642.1">Or another scenario, wherein your page served locally is included in a web page (via iFrame or as assets) and the host page is served via HTTPS. </span><span class="koboSpan" id="kobo.642.2">In this case, including assets or including a page delivered by HTTP in an HTTPS context raises a security exception in </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">the browser.</span></span></p>
<p><span class="koboSpan" id="kobo.644.1">If you want to configure Octane to serve HTTPS requests, you have to do </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.646.1">Install a tool such as </span><strong class="bold"><span class="koboSpan" id="kobo.647.1">mkcert</span></strong><span class="koboSpan" id="kobo.648.1"> that allows you to create and manage certificates. </span><span class="koboSpan" id="kobo.648.2">Because of the </span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.649.1">design and implementation of HTTPS, the protocol requires public/private certificates </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">to work.</span></span></li>
<li><span class="koboSpan" id="kobo.651.1">Create certificates for localhost or addresses </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">you want.</span></span></li>
<li><span class="koboSpan" id="kobo.653.1">See the location of the CA certificate and key </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1">storage location.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.655.1">To better understand what is needed, let’s look at RoadRunner’s configuration </span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">for HTTPS:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.657.1">
version: "2.7"
http:
  # host and port separated by semicolon
  address: 127.0.0.1:8000
  ssl:
    # host and port separated by semicolon (default :443)
    address: :8893
    redirect: false
    # Path to the cert file. </span><span class="koboSpan" id="kobo.657.2">This option is required for
    # SSL working.
</span><span class="koboSpan" id="kobo.657.3">    # This option is required.
</span><span class="koboSpan" id="kobo.657.4">    cert: "./localhost.pem"
    # Path to the cert key file.
</span><span class="koboSpan" id="kobo.657.5">    # This option is required.
</span><span class="koboSpan" id="kobo.657.6">    key: "./localhost-key.pem"
    # Path to the root certificate authority file.
</span><span class="koboSpan" id="kobo.657.7">    # This option is optional.
</span><span class="koboSpan" id="kobo.657.8">    root_ca: "/Users/roberto/Library/Application\
              Support/mkcert/rootCA.pem"</span></pre>
<p><span class="koboSpan" id="kobo.658.1">The two mandatory fiels and one optional file are </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">Cert</span></strong><span class="koboSpan" id="kobo.661.1">: The </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">cert file</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">Key</span></strong><span class="koboSpan" id="kobo.664.1">: The cert </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">key file</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">Root_ca</span></strong><span class="koboSpan" id="kobo.667.1">: The root certificate </span><span class="No-Break"><span class="koboSpan" id="kobo.668.1">authority file</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.669.1">With the first two files, HTTPS works but a warning is raised by your browser (there’s not a valid certificate, because </span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.670.1">the certificate is self-signed). </span><span class="koboSpan" id="kobo.670.2">Filling </span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.671.1">only the two first parameters, the certificate is evaluated as self-signed and, typically, browsers tend not to consider such </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">certificates trustable.</span></span></p>
<p><span class="koboSpan" id="kobo.673.1">With the third file, the browser allows you to browse via HTTPS without any warnings (the certificate </span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">is valid).</span></span></p>
<p><span class="koboSpan" id="kobo.675.1">So, first, you have to </span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.676.1">install </span><strong class="bold"><span class="koboSpan" id="kobo.677.1">mkcert</span></strong><span class="koboSpan" id="kobo.678.1">. </span><span class="koboSpan" id="kobo.678.2">The Git repository of mkcert </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">is </span></span><a href="https://github.com/FiloSottile/mkcert"><span class="No-Break"><span class="koboSpan" id="kobo.680.1">https://github.com/FiloSottile/mkcert</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.681.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.682.1">mkcert is an open source tool </span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.683.1">available for </span><span class="No-Break"><span class="koboSpan" id="kobo.684.1">all platforms.</span></span></p>
<p><span class="koboSpan" id="kobo.685.1">The instructions to install mkcert and create certificates for macOS are </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.687.1">
brew install mkcert
mkcert -install
mkcert localhost</span></pre>
<p><span class="koboSpan" id="kobo.688.1">If you are using Windows, you </span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.689.1">could use the Chocolatey package manager (</span><a href="https://chocolatey.org/"><span class="koboSpan" id="kobo.690.1">https://chocolatey.org/</span></a><span class="koboSpan" id="kobo.691.1"> ) and use the </span><span class="No-Break"><span class="koboSpan" id="kobo.692.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.693.1">
choco install mkcert</span></pre>
<p><span class="koboSpan" id="kobo.694.1">For GNU/Linux, you can use the package manager provided by </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">your distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.696.1">Now you have two new files in the project directory: </span><strong class="source-inline"><span class="koboSpan" id="kobo.697.1">localhost-key.pem</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.698.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">localhost.pem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.701.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.702.1">I strongly recommend listing these two files in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">.gitignore</span></strong><span class="koboSpan" id="kobo.704.1"> file prevent them from being pushed into your Git repository (if it </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">is used).</span></span></p>
<p><span class="koboSpan" id="kobo.706.1">You can use the first one in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">.rr.yaml</span></strong><span class="koboSpan" id="kobo.708.1"> file for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">key</span></strong><span class="koboSpan" id="kobo.710.1"> parameter and the second one for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">cert</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.712.1"> parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.713.1">To fill the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">root_ca</span></strong><span class="koboSpan" id="kobo.715.1"> parameter, you have to see where CA files are stored via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">mkcert</span></strong><span class="koboSpan" id="kobo.717.1"> command (with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">CAROOT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.719.1"> option):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.720.1">
mkcert -CAROOT</span></pre>
<p><span class="koboSpan" id="kobo.721.1">This command will </span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.722.1">show you the directory </span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.723.1">where the CA files </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">are stored.</span></span></p>
<p><span class="koboSpan" id="kobo.725.1">To see the name of CA files, run </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.727.1">
ls "$(mkcert -CAROOT)"</span></pre>
<p><span class="koboSpan" id="kobo.728.1">You can fill the </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">root_ca</span></strong><span class="koboSpan" id="kobo.730.1"> parameter with the full path of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">rootCA.pem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.732.1"> file.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.733.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.734.1">If you are using Firefox and you are still getting the self-signed certificate warning, install </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">certutil</span></strong><span class="koboSpan" id="kobo.736.1"> (with Homebrew, </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1">certutil</span></strong><span class="koboSpan" id="kobo.738.1"> is included in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">nss</span></strong><span class="koboSpan" id="kobo.740.1"> package, so execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">brew install nss</span></strong><span class="koboSpan" id="kobo.742.1">) and then execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">mkcert -install</span></strong><span class="koboSpan" id="kobo.744.1"> again (and restart the </span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">Firefox browser).</span></span></p>
<p><span class="koboSpan" id="kobo.746.1">Now you can start Octane with </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.748.1">
php artisan octane:start</span></pre>
<p><span class="koboSpan" id="kobo.749.1">Open your browser at the URL defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.750.1">address</span></strong><span class="koboSpan" id="kobo.751.1"> parameter. </span><span class="koboSpan" id="kobo.751.2">According to the parameters used in </span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.752.1">the last example (the RoadRunner configuration </span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.753.1">in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">.rr.yaml</span></strong><span class="koboSpan" id="kobo.755.1"> file), you should open your browser and open the page at this URL: </span><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">https://127.0.0.1:8893</span></strong><span class="koboSpan" id="kobo.757.1">. </span><span class="koboSpan" id="kobo.757.2">(note that </span><strong class="source-inline"><span class="koboSpan" id="kobo.758.1">https://</span></strong><span class="koboSpan" id="kobo.759.1"> is the protocol instead </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.761.1">http://</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">)</span></span></p>
<p><span class="koboSpan" id="kobo.763.1">So, now you are familiar with installing RoadRunner with Laravel Octane, starting the Octane server, and accessing the </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">advanced configuration.</span></span></p>
<h1 id="_idParaDest-40"><a id="_idTextAnchor047"/><span class="koboSpan" id="kobo.765.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.766.1">In this chapter, we explored the installation and configuration of Laravel Octane with the RoadRunner application server. </span><span class="koboSpan" id="kobo.766.2">We took a look at the benefit we get from the usage of RoadRunner and how to enable advanced features such as the </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1">HTTPS protocol.</span></span></p>
<p><span class="koboSpan" id="kobo.768.1">In the next chapter, we will see how to do the same things with Swoole. </span><span class="koboSpan" id="kobo.768.2">We will see the additional features Swoole has, compared with RoadRunner, and in </span><a href="B17728_04.xhtml#_idTextAnchor065"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.769.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.770.1">, </span><em class="italic"><span class="koboSpan" id="kobo.771.1">Building a Laravel Octane Application</span></em><span class="koboSpan" id="kobo.772.1">, we will start to look at the code for the web application using the Octane service, which is now up </span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">and running.</span></span></p>
</div>
<div>
<div class="Content" id="_idContainer019">
</div>
</div>
</body></html>