<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer439">
<h1 class="chapter-number" id="_idParaDest-308" lang="en-GB"><a id="_idTextAnchor308"/>16</h1>
<h1 id="_idParaDest-309" lang="en-GB"><a id="_idTextAnchor309"/>Avoiding Sleepless Nights – Moodle Backup and Restore</h1>
<p lang="en-GB">Your Moodle application will contain important data such as coursework, assignments, grades, and all administrative data, for example, users, cohorts, and roles. Therefore, you must have a good backup strategy <span class="No-Break" lang="">in place.</span></p>
<p lang="en-GB">Preparing for the unexpected is always a good strategy when dealing with information systems, and having well-preserved backups allows for full application recovery upon unexpected hardware or software failures. Systems are not expected to fail, but there’s always a possibility for failure, and a good strategy for fast recovery ensures a low impact on users. This chapter presents strategies and options for managing backups and auto-backups of <span class="No-Break" lang="">your data.</span></p>
<p lang="en-GB">Moodle itself supports two types <span class="No-Break" lang="">of backups:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Course-level backups</strong>: Course backups <a id="_idIndexMarker1516"/>are usually ad hoc and only archive the selected course. You will learn how to create course backups, restore courses, and copy course content using the related course <span class="No-Break" lang="">import facility.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Site-level backups</strong>: The<a id="_idIndexMarker1517"/> site backup option saves all courses and related data to a specified location at regular intervals. You will learn how to set this up and recover data <span class="No-Break" lang="">from it.</span></li>
</ul>
<p lang="en-GB">Both mechanisms will be covered in detail before we <a id="_idIndexMarker1518"/>look at <strong class="bold" lang="">system-level backups</strong>, including Moodle backups (covering the Moodle software and the data stored in it) and snapshot creation (full system images). The three backup types are shown in the following diagram and are at the core of <span class="No-Break" lang="">this chapter:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer423">
<img alt="Figure 16.1 – Moodle backups " height="1118" src="image/Figure_16.01_B18779.jpg" width="1040"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.1 – Moodle backups</p>
<p lang="en-GB">We will conclude this chapter by looking at two applications that use backup and restore facilities: planning year-end procedures and implementing <span class="No-Break" lang="">course templates.</span></p>
<p lang="en-GB">We will cover the following main topics in <span class="No-Break" lang="">this chapter:</span></p>
<ul>
<li lang="en-GB">Managing <span class="No-Break" lang="">course-level backups</span></li>
<li lang="en-GB">Managing <span class="No-Break" lang="">site-level backups</span></li>
<li lang="en-GB">Managing <span class="No-Break" lang="">system-level backups</span></li>
<li lang="en-GB">Using backup and restore for <span class="No-Break" lang="">alternative tasks</span></li>
</ul>
<h1 id="_idParaDest-310" lang="en-GB"><a id="_idTextAnchor310"/>Managing course-level backups</h1>
<p lang="en-GB">Course-level backups <a id="_idIndexMarker1519"/>allow teachers and administrators to create copies of courses for safekeeping or to pass on to colleagues. If configured appropriately, course backups can save an administrator a lot of hassle <span class="No-Break" lang="">and time.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Course backups include some or all of the items of <span class="No-Break" lang="">a course.</span></p>
<p lang="en-GB">First, we will look at <a id="_idIndexMarker1520"/>the backup procedure before going into the details of recovering data during the <span class="No-Break" lang="">restore operation.</span></p>
<h2 id="_idParaDest-311" lang="en-GB"><a id="_idTextAnchor311"/>Creating course backups</h2>
<p lang="en-GB">To back up an<a id="_idIndexMarker1521"/> individual course, it is best if you are inside that course, where you have to select the <strong class="bold" lang="">Course reuse</strong> option in the course menu and then select <strong class="bold" lang="">Backup</strong> from <span class="No-Break" lang="">the dropdown.</span></p>
<p lang="en-GB">The backup <a id="_idIndexMarker1522"/>procedure comprises five steps, illustrated in the <span class="No-Break" lang="">following workflow:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer424">
<img alt="Figure 16.2 – Course backup workflow " height="532" src="image/Figure_16.02_B18779.jpg" width="1259"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.2 – Course backup workflow</p>
<p lang="en-GB">You can<a id="_idIndexMarker1523"/> navigate back to any step via the process links at the top of the screen or the navigation buttons at the bottom. We will go through the steps one by one in the <span class="No-Break" lang="">following subsections.</span></p>
<h3 lang="en-GB">Initial settings</h3>
<p lang="en-GB">Several<a id="_idIndexMarker1524"/> settings determine how the backup will be performed and what type of information will <span class="No-Break" lang="">be included:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer425">
<img alt="Figure 16.3 – Course backup – Initial settings " height="1164" src="image/Figure_16.03_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.3 – Course backup – Initial settings</p>
<p lang="en-GB">Some <a id="_idIndexMarker1525"/>settings are only available if other settings have been activated; for example, <strong class="bold" lang="">Include user role assignments</strong> can only be ticked if enrolled users are included. Most options are self-explanatory, but two options require <span class="No-Break" lang="">some commentary:</span></p>
<ul>
<li lang="en-GB">If <strong class="bold" lang="">Anonymize user information</strong> is selected (<strong class="bold" lang="">Include enrolled users</strong> is a prerequisite), user data (username, first name, last name, and email address) will be substituted by aliases. For example, <strong class="source-inline" lang="">Jonny Walker</strong> might become <span class="No-Break" lang=""><strong class="source-inline" lang="">anonfirstname69 anonlastname69</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">In addition to the standard Moodle backup format, <strong class="bold" lang="">IMS Common Cartridge 1.1</strong> is a special format that’s <a id="_idIndexMarker1526"/>supported. For more information on IMS CC, please consult the Moodle Docs <span class="No-Break" lang="">at </span><a href="http://docs.moodle.org/en/IMS_Common_Cartridge_import_and_export"><span class="No-Break" lang="">docs.moodle.org/en/IMS_Common_Cartridge_import_and_export</span></a><span class="No-Break" lang="">.</span></li>
</ul>
<p lang="en-GB">By default, all options can be selected for all users who have the appropriate permissions in the course context. If you wish to change the default values and/or lock specific settings (such as <strong class="bold" lang="">Include course logs</strong>, as shown in the previous screenshot), go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Courses</strong> | <strong class="bold" lang="">Backups</strong> | <strong class="bold" lang="">General </strong><span class="No-Break" lang=""><strong class="bold" lang="">backup defaults</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer426">
<img alt="Figure 16.4 – Course backup default settings " height="664" src="image/Figure_16.04_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.4 – Course backup default settings</p>
<p lang="en-GB">For every setting, there are two checkboxes. The first represents the parameter’s default, whereas the <a id="_idIndexMarker1527"/>second value indicates whether it is locked or not. Locking allows you to force specific settings, for instance, the exclusion <span class="No-Break" lang="">of users.</span></p>
<p lang="en-GB">There are usually two types of course backups that you are likely <span class="No-Break" lang="">to perform:</span></p>
<ul>
<li lang="en-GB"><span class="No-Break" lang=""><strong class="bold" lang="">Content-only backups</strong></span></li>
</ul>
<p lang="en-GB">As the <a id="_idIndexMarker1528"/>name suggests, this type of backup only <a id="_idIndexMarker1529"/>contains content that can be passed on to another person without transferring any information about its users, roles, grades, and so on. To perform a content-only backup, you must deselect <strong class="bold" lang="">Include enrolled users</strong>, which is a prerequisite for all user-related <span class="No-Break" lang="">backup options.</span></p>
<p lang="en-GB">A content-only backup is the best option if you wish to pass a course on to other educators or make it available for download. Another use case is to create a new instance of a course for yourself, for example, taking a course backup from one semester to use in a different semester. When you publish courses on a community hub or MoodleNet (refer to <a href="B18779_19.xhtml#_idTextAnchor344"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 19</em></span></a>, <em class="italic" lang="">Setting Up Moodle Networking</em>), you will also create a <span class="No-Break" lang="">content-only backup.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">By default, users with teaching rights can only perform content-only backups. This restriction can be changed via the <strong class="source-inline" lang="">moodle/backup:userinfo</strong> capability, but it should be <span class="No-Break" lang="">done carefully.</span></p>
<ul>
<li lang="en-GB"><span class="No-Break" lang=""><strong class="bold" lang="">Full-course backups</strong></span></li>
</ul>
<p lang="en-GB">If you wish<a id="_idIndexMarker1530"/> to back up a course for potential recovery<a id="_idIndexMarker1531"/> purposes, you should create a full-course backup, which includes user data (for example, forum posts), course data, and user information. To do this, you can leave all the settings at their default values and use the <strong class="bold" lang="">Jump to final </strong><span class="No-Break" lang=""><strong class="bold" lang="">step</strong></span><span class="No-Break" lang=""> button.</span></p>
<p lang="en-GB">If you wish to back up the course logs, the <strong class="bold" lang="">Include course logs</strong> setting must be enabled. Remember <a id="_idIndexMarker1532"/>that logs can be massive and often exceed multiple gigabytes when you’re backing <a id="_idIndexMarker1533"/>up <span class="No-Break" lang="">several </span><span class="No-Break" lang=""><a id="_idIndexMarker1534"/></span><span class="No-Break" lang="">courses.</span></p>
<p lang="en-GB">Before we move on to the next screen, a note of caution: some third-party course-level plugins (activities, blocks, or filters) might not support backups. If you encounter any issues, you will have to exclude items created by these from the backup or, better, avoid the <span class="No-Break" lang="">plugin altogether.</span></p>
<h3 lang="en-GB">Schema settings</h3>
<p lang="en-GB">All <a id="_idIndexMarker1535"/>learning resources and activities are shown in the order in which they appear in the course. Resources are only available if the <strong class="bold" lang="">Include activities</strong> parameter has not been deactivated on the previous screen. By default, all the available elements are selected; if you wish to exclude any individual items, you have to deselect them. Additionally, you can exclude/include all the items of a section by selecting/deselecting the section <span class="No-Break" lang="">name itself:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer427">
<img alt="Figure 16.5 – Course backup – Schema settings " height="1371" src="image/Figure_16.05_B18779.jpg" width="1475"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.5 – Course backup – Schema settings</p>
<p lang="en-GB">Moodle <a id="_idIndexMarker1536"/>distinguishes between <strong class="bold" lang="">course content</strong> and <strong class="bold" lang="">user data</strong>. For example, the forum description and all its settings are classified as course content<a id="_idIndexMarker1537"/> in a forum activity. In contrast, all topics, posts, and replies to a forum are classified as<a id="_idIndexMarker1538"/> user data. If the <strong class="bold" lang="">Include enrolled users</strong> option has been left activated on the initial setup screen, user data can be included/excluded for each selected activity <span class="No-Break" lang="">and resource.</span></p>
<p lang="en-GB">Selecting the <strong class="bold" lang="">Next</strong> button will take you to the last course backup <span class="No-Break" lang="">configuration screen.</span></p>
<h3 lang="en-GB">Confirmation and review</h3>
<p lang="en-GB">The <a id="_idIndexMarker1539"/>third screen lets you choose the backup filename and review the items to be included in the archive. The format of the default <strong class="bold" lang="">Filename</strong> is <span class="No-Break" lang="">as follows:</span></p>
<pre class="source-code" lang="en-GB">backup-&lt;type&gt;-&lt;format&gt;-&lt;course name/id&gt;-&lt;date&gt;-&lt;time&gt;[-nu|-an].mbz</pre>
<p lang="en-GB">At the time of writing, <strong class="source-inline" lang="">&lt;type&gt;</strong> is always set to <strong class="bold" lang="">moodle2</strong>, and the only value supported for <strong class="source-inline" lang="">&lt;format&gt;</strong> is <strong class="bold" lang="">course</strong>. The optional <strong class="source-inline" lang="">–nu</strong> parameter stands for no users, and <strong class="source-inline" lang="">-an</strong> is an indicator for <span class="No-Break" lang="">anonymous users.</span></p>
<p lang="en-GB">If you have opted to create <strong class="bold" lang="">IMS Common Cartridge</strong> as the backup form, the <strong class="source-inline" lang="">.imscc</strong> extension will be used instead <span class="No-Break" lang="">of </span><span class="No-Break" lang=""><strong class="source-inline" lang="">.mbz</strong></span><span class="No-Break" lang="">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer428">
<img alt="Figure 16.6 – Course backup – Confirmation and review " height="269" src="image/Figure_16.06_B18779.jpg" width="1414"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.6 – Course backup – Confirmation and review</p>
<p lang="en-GB">Moodle creates a bespoke file format for backups, known as the <strong class="bold" lang="">Moodle Backup Format</strong>, using<a id="_idIndexMarker1540"/> the <strong class="source-inline" lang="">.mbz</strong> extension. A Moodle backup file is a compressed file (in <strong class="source-inline" lang="">.tgz</strong> format) that consists of an XML file (which describes the file’s content) and the actual content, users, log data, and <span class="No-Break" lang="">so on.</span></p>
<p lang="en-GB">The additional <strong class="bold" lang="">Backup settings</strong> section shows which item has been selected and deselected on the initial settings screen. The <strong class="bold" lang="">Included items</strong> section indicates, with a green tick, all resources and activities that will be included, as well as any user data that will be part of the course backup. A red cross means that the item has been deselected, whereas a red cross followed by a lock indicates that it wasn’t possible to select the item since a prerequisite has not <span class="No-Break" lang="">been fulfilled.</span></p>
<p lang="en-GB">Once you <a id="_idIndexMarker1541"/>press the <strong class="bold" lang="">Perform backup</strong> button, the Moodle course archive will <span class="No-Break" lang="">be created.</span></p>
<h3 lang="en-GB">Finalizing the backup</h3>
<p lang="en-GB">The <a id="_idIndexMarker1542"/>created archive file is saved in the <strong class="bold" lang="">Course backup</strong> area. This process can take a few minutes, depending on the volume of data being backed up. If the <strong class="bold" lang="">Anonymize user data</strong> setting was chosen at the beginning, the backup file will be placed in the <strong class="bold" lang="">User private </strong><span class="No-Break" lang=""><strong class="bold" lang="">backup</strong></span><span class="No-Break" lang=""> area.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Moodle backups include the course configuration, which contains course settings, activity arrangements, and <span class="No-Break" lang="">block positions.</span></p>
<p lang="en-GB">After completion, a brief status message is shown; you will have to take appropriate actions if this contains any errors <span class="No-Break" lang="">or warnings.</span></p>
<p lang="en-GB">Backups sometimes fail on large courses, and the cause is usually that the backup process runs out of time or memory. If this happens, you have two options that are not <span class="No-Break" lang="">mutually exclusive:</span></p>
<ul>
<li lang="en-GB">First, you can increase the <strong class="bold" lang="">Extra PHP memory limit</strong> setting by going to <strong class="bold" lang="">Server</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Performance</strong></span><span class="No-Break" lang="">.</span></li>
<li lang="en-GB">Second, you can choose <strong class="bold" lang="">Enable synchronous backups</strong> by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Courses</strong> | <strong class="bold" lang="">Backups</strong> | <strong class="bold" lang="">Asynchronous backup/restore</strong>, which triggers Moodle to execute backups (and restores) as a separate <span class="No-Break" lang="">background process:</span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer429">
<img alt="Figure 16.7 – Asynchronous backup/restore " height="715" src="image/Figure_16.07_B18779.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.7 – Asynchronous backup/restore</p>
<p lang="en-GB">Asynchronous backups only allow a user to have one pending backup for a resource at a time. Multiple asynchronous backups of the same resource can’t be queued, as this would likely result in multiple backups that contain the <span class="No-Break" lang="">same content.</span></p>
<p lang="en-GB">If you wish to notify the user who initiated the course backup when the process is completed, choose <strong class="bold" lang="">Enable message notifications</strong> and customize the <strong class="bold" lang="">Subject</strong> and <strong class="bold" lang="">Message</strong> properties <a id="_idIndexMarker1543"/>of the notification that will be <span class="No-Break" lang="">sent out.</span></p>
<p lang="en-GB">This concludes this section on creating course backups. The reverse operation – restoring course backups – is the topic of the <span class="No-Break" lang="">following section.</span></p>
<h2 id="_idParaDest-312" lang="en-GB"><a id="_idTextAnchor312"/>Restoring course backups</h2>
<p lang="en-GB">To wholly <a id="_idIndexMarker1544"/>or partly restore a previously backed up course, it is best if you are inside that course, where you have to select the <strong class="bold" lang="">Course reuse</strong> option in the course menu and then select <strong class="bold" lang="">Restore</strong> from the dropdown. Alternatively, you can navigate to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Courses</strong> | <span class="No-Break" lang=""><strong class="bold" lang="">Restore course</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Once you have selected a <strong class="source-inline" lang="">.mbz</strong> file, the restore procedure comprises seven steps, illustrated in the <span class="No-Break" lang="">following diagram:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer430">
<img alt="Figure 16.8 – Course restore workflow " height="392" src="image/Figure_16.08_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.8 – Course restore workflow</p>
<p lang="en-GB">As with the<a id="_idIndexMarker1545"/> backup workflow, you can navigate back to any step via the process links at the top of the screen or using the navigation buttons at the bottom. We will go through the steps one by one in the <span class="No-Break" lang="">following subsections.</span></p>
<h3 lang="en-GB">File selection and confirmation</h3>
<p lang="en-GB">Moodle stores <a id="_idIndexMarker1546"/>its backup files in different <strong class="bold" lang="">backup areas</strong>. There are <a id="_idIndexMarker1547"/>four locations where you can choose a <strong class="source-inline" lang="">.mbz</strong> file to be restored, as shown in the <span class="No-Break" lang="">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer431">
<img alt="Figure 16.9 – Course backup areas " height="1616" src="image/Figure_16.09_B18779.jpg" width="1634"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.9 – Course backup areas</p>
<p lang="en-GB">The four <a id="_idIndexMarker1548"/>locations for Moodle archives are <span class="No-Break" lang="">as follows:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Import backup file</strong>: Archives that are usually stored outside of Moodle and selected via the file picker <span class="No-Break" lang="">or drag’n’drop</span></li>
<li lang="en-GB"><strong class="bold" lang="">Course backup area</strong>: Archives created using default settings are stored in <span class="No-Break" lang="">this area</span></li>
<li lang="en-GB"><strong class="bold" lang="">User private backup area</strong>: Archives with anonymized users are <span class="No-Break" lang="">stored here</span></li>
<li lang="en-GB"><strong class="bold" lang="">Automated backups</strong>: Archives that are created automatically (see the <em class="italic" lang="">Site </em><span class="No-Break" lang=""><em class="italic" lang="">backups</em></span><span class="No-Break" lang=""> section)</span></li>
</ul>
<p lang="en-GB">In the preceding example, a single<a id="_idIndexMarker1549"/> course is present in the course backup area, called <strong class="source-inline" lang="">backup-moodle2-course-14-packt_backup-20220712-2001.mbz</strong>. From its filename, we already know that the course ID is 14, its name is Packt Backup, and that it was backed up on July 12, 2022, <span class="No-Break" lang="">at 20:01.</span></p>
<p lang="en-GB">Select the <strong class="bold" lang="">Restore</strong> link beside a backup file to start the recovery process. The first screen displays <strong class="bold" lang="">Backup details</strong> (type, format, mode, backup date/time, Moodle version, backup version, and the URL of the <strong class="source-inline" lang="">.mbz</strong> file), <strong class="bold" lang="">Backup settings</strong> (identical to the initial settings in the backup), and <strong class="bold" lang="">Course details</strong>. Once you have confirmed this information-only screen, you have to specify where you wish to recover <span class="No-Break" lang="">the backup.</span></p>
<h3 lang="en-GB">Selecting the restore destination</h3>
<p lang="en-GB">There are various<a id="_idIndexMarker1550"/> options for restoring a <span class="No-Break" lang="">course backup:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Restore as a </strong><span class="No-Break" lang=""><strong class="bold" lang="">new course</strong></span></li>
<li lang="en-GB"><strong class="bold" lang="">Restore into this course</strong> and merge the backup into <span class="No-Break" lang="">this course</span></li>
<li lang="en-GB"><strong class="bold" lang="">Restore into this course</strong>, delete the contents of this course, and then <span class="No-Break" lang="">restore it</span></li>
<li lang="en-GB"><strong class="bold" lang="">Restore into an existing course</strong> and merge the backup into the <span class="No-Break" lang="">selected course</span></li>
<li lang="en-GB"><strong class="bold" lang="">Restore into an existing course</strong>, delete its contents, and <span class="No-Break" lang="">then restore:</span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer432">
<img alt="Figure 16.10 – Course restore – Destination" height="1013" src="image/Figure_16.10_B18779.jpg" width="1330"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.10 – Course restore – Destination</p>
<p lang="en-GB">If you <a id="_idIndexMarker1551"/>wish to <strong class="bold" lang="">Restore as a new course</strong>, you will have to select a category in which the new course will be created. You must use the provided search facility if the number of categories exceeds 20. Alternatively, you can choose the current course as the destination (<strong class="bold" lang="">Restore into this course</strong>). You can either combine the current course content with the backup (<strong class="bold" lang="">Merge the backup course into this existing course</strong>) or replace it (<strong class="bold" lang="">Delete the contents of this course and then restore</strong>). If you choose the merging option and an activity or resource with the same name exists, both will be kept and not overridden. The third option is to restore the course to another existing course, which you have to select. The same options (merge and replace) exist to restore the backup in the current course. Make sure you click on the correct <strong class="bold" lang="">Continue</strong> button before <span class="No-Break" lang="">you proceed.</span></p>
<h3 lang="en-GB">Restore settings</h3>
<p lang="en-GB">The <strong class="bold" lang="">Restore settings</strong> screen shows all the available options that were selected during the <a id="_idIndexMarker1552"/>backup process (refer to the preceding <em class="italic" lang="">Initial settings</em> section). As shown earlier, the choices made here determine the types of data that will be recovered, and which type of content will be offered for further selection. Also, most options have prerequisites that are identical to their <span class="No-Break" lang="">backup counterparts.</span></p>
<p lang="en-GB">If you wish to change the default values and/or lock specific settings, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Courses</strong> | <strong class="bold" lang="">Backups</strong> | <strong class="bold" lang="">General restore defaults</strong>. For every parameter, there are two checkboxes. The first represents the setting’s default, whereas the second value indicates whether it is locked or not. Locking allows you to force specific settings, for instance, the exclusion <span class="No-Break" lang="">of users.</span></p>
<h3 lang="en-GB">The backup schema</h3>
<p lang="en-GB">Depending on <a id="_idIndexMarker1553"/>your choices on the previous two screens, the schema step lets you specify several course settings. If you restore the backup to an existing course, you have the option to overwrite its settings. These are <strong class="bold" lang="">Course name</strong>, <strong class="bold" lang="">Course short name</strong>, and <strong class="bold" lang="">Course start date</strong>. You can further choose to <strong class="bold" lang="">Keep current roles and enrolments</strong> (if these are part of the backup), <strong class="bold" lang="">Keep current groups and groupings</strong> (if stored in the backup), and use the course settings of the backup file instead of the current ones (<strong class="bold" lang="">Overwrite </strong><span class="No-Break" lang=""><strong class="bold" lang="">course configuration</strong></span><span class="No-Break" lang="">):</span></p>
<div>
<div class="IMG---Figure" id="_idContainer433">
<img alt="Figure 16.11 – Course restore – Schema" height="528" src="image/Figure_16.11_B18779.jpg" width="1281"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.11 – Course restore – Schema</p>
<p lang="en-GB">You must also<a id="_idIndexMarker1554"/> choose which content and user data to include in the recovery procedure. The selection mechanism is very similar to the backup equivalent described earlier. By default, all the data that is present is selected. If you wish to narrow down the data to be restored, you must manually <span class="No-Break" lang="">deselect items.</span></p>
<h3 lang="en-GB">Finalizing restore</h3>
<p lang="en-GB">After the final<a id="_idIndexMarker1555"/> familiar-looking <strong class="bold" lang="">Review</strong> screen, the restore process is initiated once the <strong class="bold" lang="">Perform restore</strong> button is pressed. Any selected data will be recovered to the chosen destination. After completion, a summary message <span class="No-Break" lang="">is shown.</span></p>
<p lang="en-GB">If the restored course contains any roles that do not exist on your Moodle system, a role mappings step will be shown, where you must map roles manually to <span class="No-Break" lang="">ensure consistency:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer434">
<img alt="Figure 16.12 – Course restore – Restore role mappings " height="665" src="image/Figure_16.12_B18779.jpg" width="1553"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.12 – Course restore – Restore role mappings</p>
<p lang="en-GB">This <a id="_idIndexMarker1556"/>completes this section on restoring course backups. Before we move on to site backups, let’s cover a feature closely related to course restore: <span class="No-Break" lang="">course import.</span></p>
<h2 id="_idParaDest-313" lang="en-GB"><a id="_idTextAnchor313"/>Importing course data</h2>
<p lang="en-GB">It is<a id="_idIndexMarker1557"/> sometimes necessary to copy data from one course to another. To achieve this, Moodle provides <a id="_idIndexMarker1558"/>the <strong class="bold" lang="">import course data</strong> feature. However, unlike the backup function, it will not import user data, such as assignment submissions or forum posts – it will only import the structure of activities, blocks, and filters. For example, you might want to import a single quiz from one course <span class="No-Break" lang="">to another.</span></p>
<p lang="en-GB">Teachers can import content from courses for which they have editing rights; as an administrator, this restriction does not apply. This mechanism bypasses the requirement for a backup and restore procedure if you want to copy course content from one course to another and do not require <span class="No-Break" lang="">user data.</span></p>
<p lang="en-GB">To copy course data, you need to be inside the receiving course, where you have to select the <strong class="bold" lang="">Course reuse</strong> option in the course menu and then select <strong class="bold" lang="">Import</strong> from <span class="No-Break" lang="">the dropdown.</span></p>
<p lang="en-GB">The import procedure comprises six steps, as illustrated in the <span class="No-Break" lang="">following workflow:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer435">
<img alt="Figure 16.13 – Course import workflow " height="369" src="image/Figure_16.13_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.13 – Course import workflow</p>
<p lang="en-GB">As with <a id="_idIndexMarker1559"/>the backup and restore workflows, you can navigate back to any step via the process links at the top of the screen or the navigation buttons at the bottom. Since the course import feature is effectively a subset of the course backup and restore functionality, we will only briefly mention each step in <span class="No-Break" lang="">the process:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Course selection</strong>: You must select a course from which you wish to import content. Use the provided search facility if the list exceeds 10 courses (default value). You can also select the current course; this way, you can duplicate <span class="No-Break" lang="">multiple activities.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Initial settings</strong>: Choose which course items you wish to import. Note the absence of <span class="No-Break" lang="">user-related options.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Schema settings</strong>: A familiar screen for selecting topics <span class="No-Break" lang="">and activities.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Confirmation and review</strong>: Import settings and included items <span class="No-Break" lang="">are shown.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Perform import</strong>: Go, <span class="No-Break" lang="">go, go!</span></li>
<li lang="en-GB"><strong class="bold" lang="">Complete</strong>: A summary message <span class="No-Break" lang="">is shown.</span></li>
</ul>
<p lang="en-GB">If you wish to change the default values and/or lock specific settings, go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Courses</strong> | <strong class="bold" lang="">Backups</strong> | <strong class="bold" lang="">General import defaults</strong>. There are two checkboxes for every setting, and the same logic applies as for the backup and restore defaults. On this screen, you can also specify the <strong class="bold" lang="">Maximum number of courses listed for </strong><span class="No-Break" lang=""><strong class="bold" lang="">import</strong></span><span class="No-Break" lang=""> option.</span></p>
<p lang="en-GB">Importing <a id="_idIndexMarker1560"/>concludes this section on course-level archives, where the focus has been on creating and restoring individual course backups. To automate this process across courses, site-level backups are needed, which we will cover in the <span class="No-Break" lang="">following section.</span></p>
<h1 id="_idParaDest-314" lang="en-GB"><a id="_idTextAnchor314"/>Managing site-level backups</h1>
<p lang="en-GB">So far, we have dealt <a id="_idIndexMarker1561"/>with backing up single courses. Site-level backups perform the same operation for every course in your system, including hidden courses and the <span class="No-Break" lang="">home page.</span></p>
<p lang="en-GB">Before we look at backup reports and notifications, we will configure automated backups. We will conclude this section with some <span class="No-Break" lang="">backup strategies.</span></p>
<h2 id="_idParaDest-315" lang="en-GB"><a id="_idTextAnchor315"/>Configuring automated backups</h2>
<p lang="en-GB">Go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Courses</strong> | <strong class="bold" lang="">Backups</strong> | <strong class="bold" lang="">Automated backup setup</strong> to schedule site<a id="_idIndexMarker1562"/> backups. Here, you will see the <span class="No-Break" lang="">following settings:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer436">
<img alt="Figure 16.14 – Automated backup configuration " height="796" src="image/Figure_16.14_B18779.jpg" width="1385"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.14 – Automated backup configuration</p>
<p lang="en-GB">The <a id="_idIndexMarker1563"/>remainder of the configuration page covers <strong class="bold" lang="">Automated backup settings</strong>, which specify which elements will be included in the backup. These are identical to the initial backup settings, except for the anonymize option, which has <span class="No-Break" lang="">been excluded.</span></p>
<p lang="en-GB">For the backup to start automatically at the specified time, the <strong class="source-inline" lang="">cron</strong> process must be configured correctly, which we covered in <a href="B18779_01.xhtml#_idTextAnchor020"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 1</em></span></a>, <em class="italic" lang="">Installing Moodle</em>. Alternatively, you can initiate the backup process via the CLI, which executes the same script that’s called by the <strong class="source-inline" lang="">cron</strong> process. The command execution from the shell or for the inclusion in scripts is as follows (assuming the Apache user <span class="No-Break" lang="">is </span><span class="No-Break" lang=""><strong class="source-inline" lang="">www-data</strong></span><span class="No-Break" lang="">):</span></p>
<p class="source-code" lang="en-GB">sudo –u www-data /usr/bin/php admin/cli/automated_backups.php</p>
<p lang="en-GB">Recovering courses from an automated backup is identical to restoring data from course-level <span class="No-Break" lang="">backup archives.</span></p>
<p lang="en-GB">To <a id="_idIndexMarker1564"/>ensure that the backups are running correctly, Moodle provides a backup report and notifications, which we will explain in the <span class="No-Break" lang="">following subsection.</span></p>
<h2 id="_idParaDest-316" lang="en-GB"><a id="_idTextAnchor316"/>Backup reports and notifications</h2>
<p lang="en-GB">As a<a id="_idIndexMarker1565"/> Moodle administrator, you must ensure that the backup execution has been successful. For this purpose, Moodle provides a backup report, which you can find by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Reports</strong> | <strong class="bold" lang="">Backups</strong>. It shows a log of the <span class="No-Break" lang="">last execution:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer437">
<img alt="Figure 16.15 – Automated backup configuration " height="731" src="image/Figure_16.15_B18779.jpg" width="1499"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.15 – Automated backup configuration</p>
<p lang="en-GB">The report provides details for each <strong class="bold" lang="">Course</strong> being backed up, namely <strong class="bold" lang="">Time taken</strong> (start and end time), <strong class="bold" lang="">Status</strong>, and the date and time of its <span class="No-Break" lang=""><strong class="bold" lang="">Next backup</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Courses in which there hasn’t been any activity for 30 days – that is, no changes have been made to the course content, and no users have used the course – are excluded from the automated backup, and the status is shown <span class="No-Break" lang="">as </span><span class="No-Break" lang=""><strong class="bold" lang="">Skipped</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">As a Moodle administrator, you will receive an email after the scheduled site-level backup has been completed. It provides details on the total number of courses backed up and a split of how many course backups were okay, contained errors, were unfinished, and were skipped. Ensure your email settings have been configured correctly (refer to <a href="B18779_10.xhtml#_idTextAnchor204"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 10</em></span></a>, <em class="italic" lang="">Configuring Technical Features</em>). It is highly recommended that you check the content of this email <span class="No-Break" lang="">every day.</span></p>
<p lang="en-GB">To <a id="_idIndexMarker1566"/>ensure the smooth and reliable execution of your automated backups, you must have an adequate backup strategy in place, which we will <span class="No-Break" lang="">discuss next.</span></p>
<h2 id="_idParaDest-317" lang="en-GB"><a id="_idTextAnchor317"/>The backup strategy</h2>
<p lang="en-GB">There are<a id="_idIndexMarker1567"/> several issues to consider when running automatic site-wide <span class="No-Break" lang="">Moodle backups:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Backup content</strong>: Ensure that everything included in the archives is needed, and anything that is not required is excluded. Do you have to back up the entire logs and gradebook history <span class="No-Break" lang="">every night?</span></li>
<li lang="en-GB"><strong class="bold" lang="">Backup size</strong>: The size of the backup files can be potentially huge (multiple gigabytes). Ensure that you only keep the number of backups that are required and your setup can <span class="No-Break" lang="">cope with.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Backup timing</strong>: The backup operation is a CPU and hard disk-intensive operation. Make sure you schedule its execution when the load on the site is relatively low. If you run multiple sites on the same server, it is recommended to time-stagger backups or create a script that uses the described CLI. An alternative approach is to set up a dedicated <span class="No-Break" lang="">backup server.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Backup frequency</strong>: Do you need seven daily backups, or are weekly backups sufficient? Are there periods (such as weekends) when you can switch off the backup <span class="No-Break" lang="">facility altogether?</span></li>
<li lang="en-GB"><strong class="bold" lang="">Backup location</strong>: By default, all backup files are saved to the respective courses, which means that the backups are held on the same server as Moodle. If you have to recover multiple courses, you must locate each archive separately, a potentially mind-numbing and <span class="No-Break" lang="">time-consuming exercise.</span></li>
</ul>
<p lang="en-GB">You might want to consider storing your backups on an external device (external disk, NAS drive, SAN, and so on). An alternative to this approach is to mount a backup device and include its content in the <span class="No-Break" lang="">organization-wide backup.</span></p>
<p lang="en-GB">Site-level backups <a id="_idIndexMarker1568"/>are a great way to automate course backups and simplify educators’ lives. However, they only back up courses, not the entire system. While this is sufficient if you have to recover a single course or some activities, it is insufficient in a disaster scenario when the entire system has to <span class="No-Break" lang="">be recovered.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">You should not use the course backup facility as your sole <span class="No-Break" lang="">backup system.</span></p>
<p lang="en-GB">Instead, system-level backups should be used as a supplement, which we will look <span class="No-Break" lang="">at next.</span></p>
<h1 id="_idParaDest-318" lang="en-GB"><a id="_idTextAnchor318"/>Managing system-level backups</h1>
<p lang="en-GB">System-level backups <a id="_idIndexMarker1569"/>cannot be configured or executed from within Moodle. Instead, they must be set up at the system level. If your system is hosted externally, there is a possibility that you will not have access to the system level, which will prevent you from performing this type of backup. Unless the host already runs system-level backups on your behalf, it is time to change to <span class="No-Break" lang="">another provider!</span></p>
<p lang="en-GB">There are two types of system backups that are not <span class="No-Break" lang="">mutually exclusive:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Moodle backups</strong>: These <a id="_idIndexMarker1570"/>create an archive of Moodle itself, the application data, and <a id="_idIndexMarker1571"/>any <span class="No-Break" lang="">application configuration</span></li>
<li lang="en-GB"><strong class="bold" lang="">Snapshots</strong>: These <a id="_idIndexMarker1572"/>create an image of the system, which is used for disaster recovery <a id="_idIndexMarker1573"/>if the system has to be rolled back in <span class="No-Break" lang="">its totality</span></li>
</ul>
<p lang="en-GB">We will briefly cover both approaches in the following <span class="No-Break" lang="">two subsections.</span></p>
<h2 id="_idParaDest-319" lang="en-GB"><a id="_idTextAnchor319"/>Moodle backups</h2>
<p lang="en-GB">Moodle<a id="_idIndexMarker1574"/> distinguishes between<a id="_idIndexMarker1575"/> the application software and the data stored in it. The advantage of this separation becomes apparent when creating backups: a software backup is only required when an update has been installed or customization is taking place, whereas data should be backed up <span class="No-Break" lang="">more frequently.</span></p>
<p lang="en-GB">Backing up the <strong class="bold" lang="">Moodle software</strong> itself is straightforward: you must create a copy of the directory and all its subdirectories where the Moodle software is installed (usually called <strong class="source-inline" lang="">moodle</strong>). Most administrators would create a single archive of the directory for easier handling (in Unix, simply use <strong class="source-inline" lang="">tar -cvf &lt;backupfile&gt;</strong>). This step is usually only required before a system upgrade or when you need to archive your <span class="No-Break" lang="">entire system.</span></p>
<p lang="en-GB">Moodle stores its data in two <span class="No-Break" lang="">separate locations:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Moodle database</strong>: Most<a id="_idIndexMarker1576"/> content is stored in the Moodle database. You can either use the export feature of phpMyAdmin (if installed) or use the following <strong class="source-inline" lang="">mysqldump</strong> shell command for MySQL and MariaDB to create a single <span class="No-Break" lang="">backup file:</span><p class="source-code" lang="en-GB"><strong class="bold" lang="">mysqldump -u &lt;username&gt; -p [-h &lt;databasehost&gt;] -C -Q -e -a &lt;database&gt; &gt; &lt;backup-file&gt;.sql</strong></p></li>
</ul>
<p lang="en-GB"><strong class="source-inline" lang="">&lt;username&gt;</strong> has to be replaced with the database username, <strong class="source-inline" lang="">–p</strong> will ask you for a password, and <strong class="source-inline" lang="">–h &lt;databasehost&gt;</strong> is only required if the database is located on a separate server. The <strong class="source-inline" lang="">&lt;database&gt;</strong> option is the name of the database, and <strong class="source-inline" lang="">&lt;backup-file&gt;</strong> is the name of the archive to be created. It is common practice to use the <strong class="source-inline" lang="">.</strong><span class="No-Break" lang=""><strong class="source-inline" lang="">sql</strong></span><span class="No-Break" lang=""> extension.</span></p>
<p lang="en-GB">To recover the database dump, use the following <strong class="source-inline" lang="">mysql</strong> <span class="No-Break" lang="">shell command:</span></p>
<p class="source-code" lang="en-GB"><strong class="bold" lang="">mysql -p &lt;database&gt; &lt; &lt;backup-file&gt;.sql</strong></p>
<p lang="en-GB">For other database types, refer to the respective <span class="No-Break" lang="">administration guides.</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Moodle data directory ($CFG-&gt;dataroot)</strong>: This is where all contributed files reside – for<a id="_idIndexMarker1577"/> instance, submitted assignments, language customizations, user profile pictures, videos, and so on. Like the Moodle system, all you have to do is create a copy of the directory and all its subdirectories. It is crucial to stop Apache while performing the backup to guarantee that the content does not go out <span class="No-Break" lang="">of sync.</span></li>
</ul>
<p lang="en-GB">The advantage of this approach is that it is less resource-intensive, can be scripted, and recovering the entire Moodle system is far more straightforward. However, it is impossible to retrieve individual activities without setting up a temporary server, as is possible with <span class="No-Break" lang="">course backups.</span></p>
<h2 id="_idParaDest-320" lang="en-GB"><a id="_idTextAnchor320"/>Snapshot creation</h2>
<p lang="en-GB">Creating snapshots<a id="_idIndexMarker1578"/> is only briefly <a id="_idIndexMarker1579"/>mentioned here for completeness as it is not a Moodle administrator role but a system administrator task. However, you should ensure that such a mechanism is set up in case of hardware failures or other <span class="No-Break" lang="">system issues.</span></p>
<p lang="en-GB">A snapshot is <a id="_idIndexMarker1580"/>an image of the entire partition(s) on the hard disk(s) that contain(s) the Moodle software itself, as well as all the data (database and data directory). The advantage of the snapshot is that the entire system can be rolled back to the point when the image was created. However, any data that has been added or modified since this point in time will be overridden. Snapshots cannot be used to recover a single course or parts thereof but to fully replace <span class="No-Break" lang="">the system.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">No matter what combination of backups you choose, frequently verify that the backup procedure is working. There is nothing worse than a false sense of security – that is, assuming that all your data is backed up when <span class="No-Break" lang="">it isn’t!</span></p>
<p lang="en-GB">This concludes this<a id="_idIndexMarker1581"/> section on <a id="_idIndexMarker1582"/>site-wide backups, which covered Moodle backups and snapshots. The following checklist provides a quick summary of the backup and restore configurations that should be taken <span class="No-Break" lang="">care of:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer438">
<img alt="Figure 16.16 – Backup checklist " height="604" src="image/Figure_16.16_B18779.jpg" width="1386"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.16 – Backup checklist</p>
<p lang="en-GB">We will finish this chapter by looking at two use cases that utilize Moodle’s backup and <span class="No-Break" lang="">restore features.</span></p>
<h1 id="_idParaDest-321" lang="en-GB"><a id="_idTextAnchor321"/>Using backup and restore for alternative tasks</h1>
<p lang="en-GB">While the prime purpose of backups is the recovery of data in case of loss, some applications can be carried out using the techniques covered in this chapter. We will briefly describe two of them: year-end procedure and <span class="No-Break" lang="">course templates.</span></p>
<h2 id="_idParaDest-322" lang="en-GB"><a id="_idTextAnchor322"/>Planning the year-end procedure</h2>
<p lang="en-GB">Most organizations <a id="_idIndexMarker1583"/>have some sort of year-end procedure in place, which might be at the end of an academic year, a term, the financial year, or, in the case of roll-on-roll-off setups, every month. Given the nature and importance of the procedure, each step should be planned well in advance. The key considerations are <span class="No-Break" lang="">as follows:</span></p>
<ul>
<li lang="en-GB">When do you run the <span class="No-Break" lang="">year-end procedure?</span></li>
<li lang="en-GB">What has to <span class="No-Break" lang="">be done?</span></li>
<li lang="en-GB">Who <span class="No-Break" lang="">is involved?</span></li>
<li lang="en-GB">Where will the <span class="No-Break" lang="">archives go?</span></li>
</ul>
<p lang="en-GB">The following is a list of typical steps that might or might not apply to your setup. It gives you an idea of how such a procedure may look and demonstrates the importance of the <span class="No-Break" lang="">backup facility:</span></p>
<ol>
<li lang="en-GB"><strong class="bold" lang="">Archive</strong>: Create full backups of all courses and consider including a system backup. Ensure archives are stored on a <span class="No-Break" lang="">separate medium.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Grade export</strong>: Export grades course by course to store them on your student management <span class="No-Break" lang="">information system.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Course reset</strong>: Use the reset feature at the course level to remove any user data. (Resetting courses can also be done in batch mode. Refer to the <em class="italic" lang="">Managing courses in bulk</em> section in <a href="B18779_04.xhtml#_idTextAnchor074"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 4</em></span></a>, <em class="italic" lang="">Managing Courses </em><span class="No-Break" lang=""><em class="italic" lang="">and Enrolments</em></span><span class="No-Break" lang="">.)</span></li>
<li lang="en-GB"><strong class="bold" lang="">Delete users</strong>: Remove users who have left the organization or disable <span class="No-Break" lang="">their accounts.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Next-year preparation</strong>: Hide or delete obsolete courses and add new courses. Add<a id="_idIndexMarker1584"/> new users and assign roles <span class="No-Break" lang="">to courses.</span></li>
</ol>
<p lang="en-GB">This is only a crude outline of tasks to be considered. Ensure you have a detailed plan for this type of exercise before you kick off the <span class="No-Break" lang="">year-end procedure.</span></p>
<h2 id="_idParaDest-323" lang="en-GB"><a id="_idTextAnchor323"/>Implementing course templates</h2>
<p lang="en-GB">There is often a requirement to <a id="_idIndexMarker1585"/>create course templates, which are used as a basis to create multiple courses. This process might be in an organization that emphasizes the homogeneity of course structure and layout or an education establishment that wants to simplify the work of its course creators. The steps to achieve this are <span class="No-Break" lang="">as follows:</span></p>
<ol>
<li lang="en-GB" value="1">Create a course that will become your <span class="No-Break" lang="">course template.</span></li>
<li lang="en-GB">Add all the elements (activities, resources, filters, blocks, and so on) to the course, change its settings, and arrange the content <span class="No-Break" lang="">as required.</span></li>
<li lang="en-GB">Create a content-only backup of <span class="No-Break" lang="">the course.</span></li>
<li lang="en-GB">You can now use the restore mechanism to create as many courses from this template as you wish. (This operation can also be done in batch mode. Refer to the <em class="italic" lang="">Managing courses in bulk</em> section in <a href="B18779_04.xhtml#_idTextAnchor074"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 4</em></span></a>, <em class="italic" lang="">Managing Courses </em><span class="No-Break" lang=""><em class="italic" lang="">and Enrolments</em></span><span class="No-Break" lang="">.)</span></li>
<li lang="en-GB">Alternatively, use the <strong class="bold" lang="">Copy course</strong> feature in the <strong class="bold" lang="">Course reuse</strong> menu at the course level instead of performing <em class="italic" lang="">Steps 3</em> and <em class="italic" lang="">4</em>. However, course copying cannot be done in <span class="No-Break" lang="">batch mode.</span></li>
<li lang="en-GB">Optionally, you can grant users appropriate rights to the course so that they can use the<a id="_idIndexMarker1586"/> <span class="No-Break" lang="">import facility.</span></li>
</ol>
<p lang="en-GB">The preceding list requires you to perform some manual steps to implement a course templating mechanism. You may find more user-friendly approaches in the Moodle plugin <a id="_idIndexMarker1587"/>database at <a href="http://moodle.org/plugins">moodle.org/plugins</a>, such as <span class="No-Break" lang=""><strong class="bold" lang="">Kickstart</strong></span><span class="No-Break" lang=""> (</span><a href="http://moodle.org/plugins/format_kickstart"><span class="No-Break" lang="">moodle.org/plugins/format_kickstart</span></a><span class="No-Break" lang="">).</span></p>
<h1 id="_idParaDest-324" lang="en-GB"><a id="_idTextAnchor324"/>Summary</h1>
<p lang="en-GB">In this chapter, we dealt with various Moodle backup alternatives. You learned how to create course-level, site-level, and system-level backups, as well as how to perform data recovery from each type. Your Moodle backup strategy must fit in with your organization’s overall disaster recovery plan. We also saw some applications that use the covered backup and <span class="No-Break" lang="">restore facilities.</span></p>
<p lang="en-GB">Moodle offers a good range of backup and restore options. Ensure that they are configured correctly and run test recoveries to be on the safe(r) side. There is nothing worse than a false sense of security – that is, assuming that all your data is backed up when <span class="No-Break" lang="">it isn’t!</span></p>
<p lang="en-GB">In the next chapter, we will cover a collection of useful and not-so-useful Moodle <span class="No-Break" lang="">admin tools.</span></p>
</div>
</div></body></html>