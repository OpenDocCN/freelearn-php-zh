<html><head></head><body><div class="chapter" id="28FAO1-ae331331bc644dc9b658d3634f0748da" title="Chapter&#xA0;7.&#xA0;Official Extensions"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Official Extensions</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Authentication client</li><li class="listitem">SwiftMailer e-mail library</li><li class="listitem">Faker fixture data generator</li><li class="listitem">Imagine library</li><li class="listitem">MongoDB driver</li><li class="listitem">ElasticSearch engine adapter</li><li class="listitem">Gii code generator</li><li class="listitem">Pjax jQuery plugin</li><li class="listitem">Redis database driver</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec70"/>Introduction</h1></div></div></div><p>Yii2's official repository <a class="indexterm" id="id468"/>provides adapters for some popular libraries, databases, and search engines. In this chapter, we will show you how to install and use official extensions in your project. You will also learn how to write your own extension and share it with other developers.</p></div></div>
<div class="section" title="Authentication client"><div class="titlepage" id="29DRA2-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec71"/>Authentication client</h1></div></div></div><p>This <a class="indexterm" id="id469"/>extension adds OpenID, OAuth, and OAuth2 consumers for the Yii 2.0 framework.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec246"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</li><li class="listitem">Install <a class="indexterm" id="id470"/>the extension with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>composer require yiisoft/yii2-authclient</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec247"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your GitHub applications page <a class="ulink" href="https://github.com/settings/applications">https://github.com/settings/applications</a> and add your own new application:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00419.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem"> Get the <span class="strong"><strong>Client ID</strong></span> and <span class="strong"><strong>Client Secret</strong></span>:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00433.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Configure<a class="indexterm" id="id471"/> your web configuration and set the corresponding options for your <code class="literal">authClientCollection</code> component:<div class="informalexample"><pre class="programlisting">'components' =&gt; [
    // ...
    'authClientCollection' =&gt; [
        'class' =&gt; 'yii\authclient\Collection',
        'clients' =&gt; [
            'google' =&gt; [
                'class' =&gt;'yii\authclient\clients\GoogleOpenId'
            ],
            'github' =&gt; [
                'class' =&gt; 'yii\authclient\clients\GitHub',
                'clientId' =&gt; '87f0784aae2ac48f78a',
                'clientSecret' =&gt;'fb5953a54dea4640f3a70d8abd96fbd25592ff18',
             ],
                // etc.
        ],
    ],
],</pre></div></li><li class="listitem">Open your <code class="literal">SiteController</code> and add the <code class="literal">auth</code> standalone action and success callback method:<div class="informalexample"><pre class="programlisting">use yii\authclient\ClientInterface;

public function actions()
{
    return [
        // ...
        'auth' =&gt; [
            'class' =&gt; 'yii\authclient\AuthAction',
            'successCallback' =&gt; [$this, 'onAuthSuccess'],
        ],
    ];
}

public function onAuthSuccess(ClientInterface $client)
{
    $attributes = $client-&gt;getUserAttributes();
    \yii\helpers\VarDumper::dump($attributes, 10, true);
    exit;
}</pre></div></li><li class="listitem">Open<a class="indexterm" id="id472"/> the <code class="literal">views/site/login.php</code> file and insert the <code class="literal">AuthChoice</code> widget:<div class="informalexample"><pre class="programlisting">&lt;div class="site-login"&gt;
    &lt;h1&gt;&lt;?= Html::encode($this-&gt;title) ?&gt;&lt;/h1&gt;

    &lt;div class="panel panel-default"&gt;
        &lt;div class="panel-body"&gt;
            &lt;?= yii\authclient\widgets\AuthChoice::widget(['baseAuthUrl' =&gt; ['site/auth'],
            'popupMode' =&gt; false,
            ]) ?&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;p&gt;Please fill out the following fields to login:&lt;/p&gt;
   ...
&lt;/div&gt;</pre></div></li><li class="listitem">You will see icons for the providers you've configured:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00444.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Try <a class="indexterm" id="id473"/>to authorize with the GitHub provider:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00459.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">If successful, your callback will show authorized user attributes:<div class="informalexample"><pre class="programlisting">[
    'login' =&gt; 'Name'
    'id' =&gt; 0000000
    'avatar_url' =&gt;'https://avatars.githubusercontent.com/u/0000000?v=3'
    'gravatar_id' =&gt; ''
    'url' =&gt; 'https://api.github.com/users/Name'
    'html_url' =&gt; 'https://github.com/Name'
    ...
    'name' =&gt; 'YourName'
    'blog' =&gt;site.com'
    'email =&gt; mail@site.com'
    ...
]</pre></div></li><li class="listitem">Create your own authorization code in the <code class="literal">onAuthSuccess</code> method, like the example at <a class="ulink" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide/quick-start.md">https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide/quick-start.md</a>.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec248"/>How it works…</h2></div></div></div><p>The<a class="indexterm" id="id474"/> extension provides OpenID, OAuth, and OAuth2 auth clients for your application.</p><p>The <code class="literal">AuthChoice</code> widget opens an authenticate page on a selected service's site, storing the <code class="literal">auth</code> action URL. After authentication, the current service redirects users back while sending authentication data via a POST-request. <code class="literal">AuthAction</code> receives the request and calls the corresponding callback.</p><p>You can use any <a class="indexterm" id="id475"/>existing client or create your own one.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec249"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">To get more information about extension usage, refer to:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-authclient/tree/master/docs/guide">https://github.com/yiisoft/yii2-authclient/tree/master/docs/guide</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-authclient-index.html">http://www.yiiframework.com/doc-2.0/ext-authclient-index.html</a></li></ul></div></li><li class="listitem">To learn more about OpenID, OAuth, and OAuth2 authentication technologies, refer to:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://openid.net">http://openid.net</a></li><li class="listitem"><a class="ulink" href="http://oauth.net">http://oauth.net</a></li></ul></div></li></ul></div></div></div>
<div class="section" title="SwiftMailer e-mail library"><div class="titlepage" id="2ACBS2-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec72"/>SwiftMailer e-mail library</h1></div></div></div><p>Many web <a class="indexterm" id="id476"/>applications need to send notifications and confirm client actions by e-mail for security reasons. The Yii2 framework provides a wrapper, <code class="literal">yiisoft/yii2-swiftmailer</code>, for the established library <code class="literal">SwiftMailer</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec250"/>Getting ready</h2></div></div></div><p>Create a new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</p><p>Both basic and advanced applications contain this extension out of the box.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec251"/>How to do it…</h2></div></div></div><p>Now we<a class="indexterm" id="id477"/> will try to send any kind of e-mails from our own application.</p><div class="section" title="Sending plain text e-mails"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec24"/>Sending plain text e-mails</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set <a class="indexterm" id="id478"/>the mailer configuration into the <code class="literal">config/console.php </code>file:<div class="informalexample"><pre class="programlisting">'components' =&gt; [
    // ...
    'mailer' =&gt; [
        'class' =&gt; 'yii\swiftmailer\Mailer',
        'useFileTransport' =&gt; true,
    ],
    // ...
],</pre></div></li><li class="listitem">Create a test console controller, <code class="literal">MailController</code>, with the following code:<div class="informalexample"><pre class="programlisting">&lt;?php

    namespace app\commands;

    use yii\console\Controller;
    use Yii;

    class MailController extends Controller
    {
        public function actionSend()
        {
            Yii::$app-&gt;mailer-&gt;compose()
            -&gt;setTo('to@yii-book.app')
            -&gt;setFrom(['from@yii-book.app' =&gt; Yii::$app-&gt;name])
            -&gt;setSubject('My Test Message')
            -&gt;setTextBody('My Text Body')
            -&gt;send();
    }
}</pre></div></li><li class="listitem">Run the following console command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii mail/send</strong></span>
</pre></div></li><li class="listitem">Examine <a class="indexterm" id="id479"/>your <code class="literal">runtime/mail</code> directory. It should contain files with your mails.<div class="note" title="Note"><h3 class="title"><a id="note07"/>Note</h3><p>
<span class="strong"><strong>Note</strong></span>: Mail files contain messages in the special e-mail source format, compatible with any mailing software. You can open this field as a plain text too.</p></div></li><li class="listitem">Set the <code class="literal">useFileTransport</code> parameter as false or remove this string from the configuration:<div class="informalexample"><pre class="programlisting">'mailer' =&gt; [
    'class' =&gt; 'yii\swiftmailer\Mailer',
],</pre></div><p>Then put your real e-mail ID into the <code class="literal">setTo()</code> method:</p><div class="informalexample"><pre class="programlisting"> -&gt;setTo('my@real-email.com')</pre></div></li><li class="listitem">Run the console command again:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii mail/send</strong></span>
</pre></div></li><li class="listitem">Check your <code class="literal">inbox</code> directory.</li></ol><div style="height:10px; width: 1px"/></div><div class="note" title="Note"><h3 class="title"><a id="note08"/>Note</h3><p>
<span class="strong"><strong>Note</strong></span>: SwiftMailer uses a standard PHP function, <code class="literal">mail()</code>, for sending mails by default. Please check that your server is correctly configured for sending mails via the <code class="literal">mail()</code> function.</p><p>Many mail systems reject mails without DKIM and SPF signatures (sent by the <code class="literal">mail()</code> function as example) or put them into a <code class="literal">Spam</code> folder.</p></div></div><div class="section" title="Sending HTML content"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec25"/>Sending HTML content</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check <a class="indexterm" id="id480"/>that your application contains the <code class="literal">mail/layouts/html.php</code> file and add the <code class="literal">mail/layouts/text.php</code> file with the following content:<div class="informalexample"><pre class="programlisting">&lt;?php
/* @var $this \yii\web\View */
/* @var $message \yii\mail\MessageInterface */
/* @var $content string */
?&gt;
&lt;?php $this-&gt;beginPage() ?&gt;
&lt;?php $this-&gt;beginBody() ?&gt;
&lt;?= $content ?&gt;
&lt;?php $this-&gt;endBody() ?&gt;
&lt;?php $this-&gt;endPage() ?&gt;</pre></div></li><li class="listitem">Create<a class="indexterm" id="id481"/> your own view in the <code class="literal">mail/message-html.php</code> file:<div class="informalexample"><pre class="programlisting">&lt;?php
use yii\helpers\Html;

/* @var $this yii\web\View */
/* @var $name string */
?&gt;

&lt;p&gt;Hello, &lt;?= Html::encode($name) ?&gt;!&lt;/p&gt;</pre></div><p>Create a <code class="literal">mail/message-text.php</code> file with the same content, but without HTML tags:</p><div class="informalexample"><pre class="programlisting">&lt;?php
    use yii\helpers\Html;

/* @var $this yii\web\View */
/* @var $name string */
?&gt;

     Hello, &lt;?= Html::encode($name) ?&gt;!</pre></div></li><li class="listitem">Create a console controller, <code class="literal">MailController</code>, with the following code:<div class="informalexample"><pre class="programlisting">&lt;?php

    namespace app\commands;

    use yii\console\Controller;
    use Yii;

    class MailController extends Controller
    {
        public function actionSendHtml()
        {
            $name = 'John';

            Yii::$app-&gt;mailer-&gt;compose('message-html',['name' =&gt; $name])
            -&gt;setTo('to@yii-book.app')
            -&gt;setFrom(['from@yii-book.app' =&gt; Yii::$app-&gt;name])
            -&gt;setSubject('My Test Message')
            -&gt;send();
        }

        public function actionSendCombine()
        {
            $name = 'John';

            Yii::$app-&gt;mailer-&gt;compose(['html' =&gt; 
            'message-html', 'text' =&gt; 'message-text'], [
            'name' =&gt; $name,
            ])
            -&gt;setTo('to@yii-book.app')
            -&gt;setFrom(['from@yii-book.app' 
                =&gt; Yii::$app-&gt;name])
            -&gt;setSubject('My Test Message')
            -&gt;send();
        }
}</pre></div></li><li class="listitem">Run <a class="indexterm" id="id482"/>the following console commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii mail/send-html</strong></span>
<span class="strong"><strong>php yii mail/se</strong></span>
<span class="strong"><strong>nd-combine</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Working with SMTP transport"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec26"/>Working with SMTP transport</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Set<a class="indexterm" id="id483"/> the <code class="literal">transport</code> parameter for the <code class="literal">mailer</code> component like this:<div class="informalexample"><pre class="programlisting">'mailer' =&gt; [
    'class' =&gt; 'yii\swiftmailer\Mailer',
    'transport' =&gt; [
        'class' =&gt; 'Swift_SmtpTransport',
        'host' =&gt; 'smtp.gmail.com',
        'username' =&gt; 'username@gmail.com',
        'password' =&gt; 'password',
        'port' =&gt; '587',
        'encryption' =&gt; 'tls',
    ],
],</pre></div></li><li class="listitem">Write and run the following code:<div class="informalexample"><pre class="programlisting">Yii::$app-&gt;mailer-&gt;compose()
    -&gt;setTo('to@yii-book.app')
    -&gt;setFrom('username@gmail.com')
    -&gt;setSubject('My Test Message')
    -&gt;setTextBody('My Text Body')
    -&gt;send();</pre></div></li><li class="listitem">Check <a class="indexterm" id="id484"/>your Gmail inbox.</li></ol><div style="height:10px; width: 1px"/></div><div class="note" title="Note"><h3 class="title"><a id="note09"/>Note</h3><p>
<span class="strong"><strong>Note</strong></span>: Gmail automatically rewrites the <code class="literal">From</code> field to your default profile e-mail ID, but other e-mail systems do not do the same. Always use an identical e-mail ID in the transport configuration and in the <code class="literal">setFrom()</code> method for passing antispam policies for other e-mail systems.</p></div></div><div class="section" title="Attaching file and embedding images"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec27"/>Attaching file and embedding images</h3></div></div></div><p>Add the<a class="indexterm" id="id485"/> corresponding method to attach any file <a class="indexterm" id="id486"/>to your mail:</p><div class="informalexample"><pre class="programlisting">class MailController extends Controller
{
    public function actionSendAttach()
    {
        Yii::$app-&gt;mailer-&gt;compose()
            -&gt;setTo('to@yii-book.app')
            -&gt;setFrom(['from@yii-book.app' =&gt; Yii::$app-&gt;name])
            -&gt;setSubject('My Test Message')
            -&gt;setTextBody('My Text Body')
            -&gt;attach(Yii::getAlias('@app/README.md'))
            -&gt;send();
    }
}</pre></div><p>Or use the <code class="literal">embed()</code> method in your e-mail view file to paste an image in your e-mail content:</p><div class="informalexample"><pre class="programlisting">&lt;img src="&lt;?= $message-&gt;embed($imageFile); ?&gt;"&gt;</pre></div><p>It automatically attaches an image file and inserts its unique identifier.</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec252"/>How it works…</h2></div></div></div><p>The <a class="indexterm" id="id487"/>wrapper implements the base <code class="literal">\yii\mail\MailerInterface</code>. Its <code class="literal">compose()</code> method returns a message object (an implementation of <code class="literal">\yii\mail\MessageInterface</code>).</p><p>You can manually set plain text and HTML contents with the help of methods <code class="literal">setTextBody()</code> and <code class="literal">setHtmlBody()</code>, or you can pass your view and view parameters into the <code class="literal">compose()</code> method. In this case, the mailer calls the <code class="literal">\yii\web\View::render()</code> method for rendering corresponding content.</p><p>The <code class="literal">useFileTransport</code> parameter stores mails in files instead of real sending. It is helpful for local development and application testing.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec253"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information about the <code class="literal">yii2-swiftmailer</code> extension, visit the<a class="indexterm" id="id488"/> following guides:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-tutorial-mailing.html">http://www.yiiframework.com/doc-2.0/guide-tutorial-mailing.html</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-swiftmailer-index.html">http://www.yiiframework.com/doc-2.0/ext-swiftmailer-index.html</a></li></ul></div></li><li class="listitem">In order to learn more about the original <code class="literal">SwiftMailer</code> library, refer to the following URLs:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://swiftmailer.org/docs/introduction.html">http://swiftmailer.org/docs/introduction.html</a></li><li class="listitem"><a class="ulink" href="https://github.com/swiftmailer/swiftmailer">https://github.com/swiftmailer/swiftmailer</a></li></ul></div></li></ul></div></div></div>
<div class="section" title="Faker fixture data generator"><div class="titlepage" id="2BASE2-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec73"/>Faker fixture data generator</h1></div></div></div><p>The <a class="indexterm" id="id489"/>
<code class="literal">fzaninotto/faker</code> is <a class="indexterm" id="id490"/>a PHP library that generates fake data of many kinds: names, phones, addresses, random strings and numbers, and so on. It can help you to generate many randomized records for performance and logic testing. You can extend your supported types collection by writing your own formatters and generators.</p><p>In the Yii2 application skeletons, the <code class="literal">yiisoft/yii2-faker</code> wrapper is included in the <code class="literal">require-dev</code> section of the <code class="literal">composer.json</code> file and is used for testing code (<a class="link" href="part0115.xhtml#3DLGM1-ae331331bc644dc9b658d3634f0748da" title="Chapter 11. Testing">Chapter 11</a>, <span class="emphasis"><em>Testing</em></span>). This wrapper provides the <code class="literal">FixtureController</code> console for use in your console application and test environment.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec254"/>Getting ready</h2></div></div></div><p>Create a new application by using composer as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec255"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the directory <code class="literal">tests/codeception/templates</code> and add the fixture template file, <code class="literal">users.txt</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
/**
 * @var $faker \Faker\Generator
 * @var $index integer
 */
    return [
        'name' =&gt; $faker-&gt;firstName,
        'phone' =&gt; $faker-&gt;phoneNumber,
        'city' =&gt; $faker-&gt;city,
        'about' =&gt; $faker-&gt;sentence(7, true),
        'password' =&gt; Yii::$app-&gt;getSecurity()
        -&gt;generatePasswordHash('password_' . $index),
        'auth_key' =&gt; Yii::$app-&gt;getSecurity()
        -&gt;generateRandomString(),
    ];</pre></div></li><li class="listitem">Run<a class="indexterm" id="id491"/> the test console <code class="literal">yii</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php tests/codeception/bin/yii fixture/generate users --count=2</strong></span>
</pre></div></li><li class="listitem">Confirm migration generation.</li><li class="listitem">Check that the <code class="literal">tests/codeception/fixtures</code> directory contains the new <code class="literal">users.php</code> file, with autogenerated data like this:<div class="informalexample"><pre class="programlisting">return [
    [
        'name' =&gt; 'Isadore',
        'phone' =&gt; '952.877.8545x190',
        'city' =&gt; 'New Marvinburgh',
        'about' =&gt; 'Ut quidem voluptatem itaque veniam voluptas dolores.',
        'password' =&gt; '$2y$13$Fi3LOl/sKlomUH.DLgqBkOB/uCLmgCoPPL1KXiW0hffnkrdkjCzAC',
        'auth_key' =&gt; '1m05hlgaAG8zfm0cyDyoRGMkbQ9W6hj1',
    ],
    [
        'name' =&gt; 'Raleigh',
        'phone' =&gt; '1-655-488-3585x699',
        'city' =&gt; 'Reedstad',
        'about' =&gt; 'Dolorem quae impedit tempore libero doloribus nobis dicta tempora facere.',
        'password' =&gt; '$2y$13$U7Qte5Y1jVLrx/pnhwdwt.1uXDegGXuNVzEQyUsb65WkBtjyjUuYm',
        'auth_key' =&gt; 'uWWJDgy5jNRk6KjqpxS5JuPv0OHearqE',
    ],
],</pre></div></li></ol><div style="height:10px; width: 1px"/></div><div class="section" title="Working with your own data types"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec28"/>Working with your own data types</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create your <a class="indexterm" id="id492"/>own provider with your custom value generating logic:<div class="informalexample"><pre class="programlisting">&lt;?php
    namespace tests\codeception\faker\providers;

    use Faker\Provider\Base;

    class UserStatus extends Base
    {
        public function userStatus()
        {
            return $this-&gt;randomElement([0, 10, 20, 30]);
        }
    }</pre></div></li><li class="listitem">Add the provider into the providers list in the <code class="literal">/tests/codeception/config/config.php</code> file:<div class="informalexample"><pre class="programlisting">return [
    'controllerMap' =&gt; [
        'fixture' =&gt; [
            'class' =&gt; 'yii\faker\FixtureController',
            'fixtureDataPath' =&gt; '@tests/codeception/fixtures',
            'templatePath' =&gt; '@tests/codeception/templates',
            'namespace' =&gt; 'tests\codeception\fixtures',
            'providers' =&gt; [
                'tests\codeception\faker\providers\UserStatus',
            ],
        ],
    ],
    // ...
];</pre></div></li><li class="listitem"> Add the <code class="literal">status</code> field into your fixture template file:<div class="informalexample"><pre class="programlisting">&lt;?php
/**
 * @var $faker \Faker\Generator
 * @var $index integer
 */
    return [
        'name' =&gt; $faker-&gt;firstName,
        'status' =&gt; $faker-&gt;userStatus,
    ];</pre></div></li><li class="listitem">Regenerate fixtures with the console command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php tests/codeception/bin/yii fixture/generate users --count=2</strong></span>
</pre></div></li><li class="listitem">Check<a class="indexterm" id="id493"/> that the generated code in the <code class="literal">fixtures/users.php</code> file contains your custom values:<div class="informalexample"><pre class="programlisting">return [
    [
        'name' =&gt; 'Christelle',
        'status' =&gt; 30,
    ],
    [
        'name' =&gt; 'Theo',
        'status' =&gt; 10,
    ],
];</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec256"/>How it works…</h2></div></div></div><p>The <code class="literal">yii2-faker</code> extension <a class="indexterm" id="id494"/>contains a console generator (which uses your templates for generating fixture data files) and gives you a prepared instance of the original <code class="literal">Faker</code> object. You can generate all or specific fixtures and can pass custom counts or language in console arguments.</p><div class="note" title="Note"><h3 class="title"><a id="note10"/>Note</h3><p>
<span class="strong"><strong>Note</strong></span>: Be careful with the existing test files if your tests use these fixtures, because autogenerating totally rewrites old data.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec257"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For the source code and <a class="indexterm" id="id495"/>more information about the extension, see:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-faker/tree/master/docs/guide">https://github.com/yiisoft/yii2-faker/tree/master/docs/guide</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-faker-index.html">http://www.yiiframework.com/doc-2.0/ext-faker-index.html</a></li></ul></div></li><li class="listitem">And to learn more about the original library, refer to:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://github.com/fzaninotto/Faker">https://github.com/fzaninotto/Faker</a></li><li class="listitem"><a class="link" href="part0115.xhtml#3DLGM1-ae331331bc644dc9b658d3634f0748da" title="Chapter 11. Testing">Chapter 11</a>, <span class="emphasis"><em>Testing</em></span></li></ul></div></li></ul></div></div></div>
<div class="section" id="2C9D01-ae331331bc644dc9b658d3634f0748da" title="Imagine library"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec74"/>Imagine library</h1></div></div></div><p>Imagine is <a class="indexterm" id="id496"/>an OOP library for image manipulation. It allows you to crop, resize, and perform other manipulations with different images with the help of GD, Imagic, and Gmagic PHP extensions. Yii2-Imagine is a lightweight static wrapper for the library.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec258"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</li><li class="listitem">Install the extension with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>composer require yiisoft/yii2-imagine</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec259"/>How to do it…</h2></div></div></div><p>In your projects, you can use the extension in two ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Using it as a factory</li><li class="listitem">Using inner methods</li></ul></div><div class="section" title="Using it as a factory"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec29"/>Using it as a factory</h3></div></div></div><p>You can use<a class="indexterm" id="id497"/> an instance of the original <code class="literal">Imagine</code> library class:</p><div class="informalexample"><pre class="programlisting">$imagine = new Imagine\Gd\Imagine();
// or
$imagine = new Imagine\Imagick\Imagine();
// or
$imagine = new Imagine\Gmagick\Imagine();</pre></div><p>However, this depends on the existing corresponding PHP extensions in your system. You can use the <code class="literal">getImagine()</code> method:</p><div class="informalexample"><pre class="programlisting">$imagine = \yii\imagine\Image::getImagine();</pre></div></div><div class="section" title="Using inner methods"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec30"/>Using inner methods</h3></div></div></div><p>You can<a class="indexterm" id="id498"/> use the <code class="literal">crop()</code>, <code class="literal">thumbnail()</code>, <code class="literal">watermark()</code>, <code class="literal">text()</code>, and <code class="literal">frame()</code> methods for common high-level manipulations like this:</p><div class="informalexample"><pre class="programlisting">&lt;?php
    use yii\imagine\Image;
    Image::crop('path/to/image.jpg', 100, 100, ManipulatorInterface::THUMBNAIL_OUTBOUND)
    -&gt;save('path/to/destination/image.jpg', ['quality' =&gt; 90]);</pre></div><p>See the <a class="indexterm" id="id499"/>signatures of all supported methods in the source code of the <code class="literal">\yii\imagine\BaseIm</code>
<code class="literal">age</code> class for more details.</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec260"/>How it works…</h2></div></div></div><p>The extension prepares user data, creates an original Imagine object, and calls the corresponding method on it. All methods return this original image object. You can continue to manipulate the image or save the result to your disk.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec261"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information <a class="indexterm" id="id500"/>about the extension, refer to the following URLs:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-imagine-index.html">http://www.yiiframework.com/doc-2.0/ext-imagine-index.html</a></li><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-imagine">https://github.com/yiisoft/yii2-imagine</a></li></ul></div></li><li class="listitem">For information about the original library, refer to <a class="ulink" href="http://imagine.readthedocs.org/en/latest/">http://imagine.readthedocs.org/en/latest/</a></li></ul></div></div></div>
<div class="section" title="MongoDB driver"><div class="titlepage" id="2D7TI2-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec75"/>MongoDB driver</h1></div></div></div><p>This <a class="indexterm" id="id501"/>extension provides the MongoDB integration for the Yii2 framework and allows you to work with MongoDB collection's records via the <code class="literal">ActiveRecord-style</code> model.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec262"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a<a class="indexterm" id="id502"/> new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</li><li class="listitem">Install MongoDB using the correct installation process from <a class="ulink" href="https://docs.mongodb.org/manual/installation/">https://docs.mongodb.org/manual/installation/</a> for your system.</li><li class="listitem">Install the <code class="literal">php5-mongo</code> PHP extension.</li><li class="listitem">Install the component with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>composer require yiisoft/yii2-mongodb</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec263"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, create the new MongoDB database. Run it in the <code class="literal">mongo-client</code> shell and type the database name:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mongo</strong></span>
<span class="strong"><strong>&gt; use mydatabase</strong></span>
</pre></div></li><li class="listitem">Add this<a class="indexterm" id="id503"/> connection information to your <code class="literal">components</code> config section:<div class="informalexample"><pre class="programlisting">return [
    // ...
    'components' =&gt; [
        // ...
        'mongodb' =&gt; [
            'class' =&gt; '\yii\mongodb\Connection',
            'dsn' =&gt;
                'mongodb://localhost:27017/mydatabase',
        ],
    ],
];</pre></div></li><li class="listitem">Add the new console controller to your console configuration file:<div class="informalexample"><pre class="programlisting">return [
    // ...
    'controllerMap' =&gt; [
        'mongodb-migrate' =&gt;
        'yii\mongodb\console\controllers\MigrateController'
    ],
];</pre></div></li><li class="listitem">Create the new migration with the shell command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii mongodb-migrate/create create_customer_collection</strong></span>
</pre></div></li><li class="listitem">Type the following code into the <code class="literal">up()</code> and <code class="literal">down()</code> methods:<div class="informalexample"><pre class="programlisting">&lt;?php

    use yii\mongodb\Migration;

    class m160201_102003_create_customer_collection extends Migration
    {
        public function up()
        {
            $this-&gt;createCollection('customer');
        }

        public function down()
        {
            $this-&gt;dropCollection('customer');
        }
    }</pre></div></li><li class="listitem">Apply the migration:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii mongodb-migrate/up</strong></span>
</pre></div></li><li class="listitem">Put the <a class="indexterm" id="id504"/>MongoDB debug panel and models generator into your configuration:<div class="informalexample"><pre class="programlisting">if (YII_ENV_DEV) {
    // configuration adjustments for 'dev' environment
    $config['bootstrap'][] = 'debug';
    $config['modules']['debug'] = [
        'class' =&gt; 'yii\debug\Module',
        'panels' =&gt; [
            'mongodb' =&gt; [
                'class' =&gt; 'yii\mongodb\debug\MongoDbPanel',
            ],
        ],
    ];

    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = [
        'class' =&gt; 'yii\gii\Module',
        'generators' =&gt; [
            'mongoDbModel' =&gt; [
                'class' =&gt; 'yii\mongodb\gii\model\Generator'
            ]
        ],
    ];
}</pre></div></li><li class="listitem">Run the Gii generator:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00476.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Start <a class="indexterm" id="id505"/>the new <code class="literal">MongoDB Model Generator</code> to generate the new model for your own collection:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00491.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click the <span class="strong"><strong>Preview</strong></span> and <span class="strong"><strong>Generate</strong></span> buttons.</li><li class="listitem">Check that<a class="indexterm" id="id506"/> you have the new model, <code class="literal">app\models\Customer</code>:<div class="informalexample"><pre class="programlisting">&lt;?php

    namespace app\models;

    use Yii;
    use yii\mongodb\ActiveRecord;

/**
* This is the model class for collection "customer".
*
* @property \MongoId|string $_id
* @property mixed $name
* @property mixed $email
* @property mixed $address
* @property mixed $status
*/
    class Customer extends ActiveRecord
    {
        public static function collectionName()
        {
            return 'customer';
        }

        public function attributes()
        {
            return [
               '_id',
               'name',
               'email',
               'address',
               'status',
            ];
        }

        public function rules()
        {
            return [
            [['name', 'email', 'address', 'status'], 'safe']
            ];
        }

        public function attributeLabels()
        {
            return [
                '_id' =&gt; 'ID',
                'name' =&gt; 'Name',
                'email' =&gt; 'Email',
                'address' =&gt; 'Address',
                'status' =&gt; 'Status',
            ];
        }
    }</pre></div></li><li class="listitem">Run Gii<a class="indexterm" id="id507"/> again and generate the CRUD:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00507.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Check that you have generated the <code class="literal">CustomerController</code> class and run the new customer manager page:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00521.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You may <a class="indexterm" id="id508"/>create, update, and delete your customers' data right now.</li><li class="listitem">Look for the <span class="strong"><strong>Debug</strong></span> panel in the page footer:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00532.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You can see the total MongoDB query count and total execution time. Click on the count badge and inspect the queries:<div class="mediaobject"><img alt="How to do it…" src="../Images/image00379.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><div class="section" title="Basic usage"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec31"/>Basic usage</h3></div></div></div><p>You may<a class="indexterm" id="id509"/> access databases and collections via the <code class="literal">\yii\mongodb\Collection</code> instance:</p><div class="informalexample"><pre class="programlisting">$collection = Yii::$app-&gt;mongodb-&gt;getCollection('customer');$collection-&gt;insert(['name' =&gt; 'John Smith', 'status' =&gt; 1]);</pre></div><p>To perform the <code class="literal">find</code> queries, you should use <code class="literal">\yii\mongodb\Query</code>:</p><div class="informalexample"><pre class="programlisting">use yii\mongodb\Query;
$query = new Query;
// compose the query
$query-&gt;select(['name', 'status'])
    -&gt;from('customer')
    -&gt;limit(10);
// execute the query
$rows = $query-&gt;all();</pre></div><div class="note" title="Note"><h3 class="title"><a id="note11"/>Note</h3><p>
<span class="strong"><strong>Note</strong></span>: The MongoDB document id (<code class="literal">"_id"</code> field) is not scalar, but an instance of the <code class="literal">\MongoId</code> class.</p></div><p>You must not care about the conversion from integer or string <code class="literal">$id</code> values to <code class="literal">\MongoId</code>, because query builder converts it automatically:</p><div class="informalexample"><pre class="programlisting">$query = new \yii\mongodb\Query;
$row = $query-&gt;from('item')
    -&gt;where(['_id' =&gt; $id]) // implicit typecast to \MongoId
    -&gt;one();</pre></div><p>To get the actual Mongo ID string, you should typecast the <code class="literal">\MongoId</code> instance to a string:</p><p>$query = new Query;</p><div class="informalexample"><pre class="programlisting">$row = $query-&gt;from('customer')-&gt;one();
var_dump($row['_id']); // outputs: "object(MongoId)"var_dump((string)$row['_id']);</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec264"/>How it works…</h2></div></div></div><p>The <code class="literal">Query</code>, <code class="literal">ActiveQuery,</code> and <code class="literal">ActiveRecord</code> classes <a class="indexterm" id="id510"/>of this extension extends <code class="literal">yii\db\QueryInterface</code> and <code class="literal">yii\db\BaseActiveRecord</code>, and therefore they are compatible with the built-in framework <code class="literal">Query</code>, <code class="literal">ActiveQuery</code>, and <code class="literal">ActiveRecord</code> classes.</p><p>You can use the <code class="literal">yii\mongodb\ActiveRecord</code> class for your models and the <code class="literal">yii\mongodb\ActiveQuery</code> builder t<a class="indexterm" id="id511"/>o retrieve your models and use them in your data provider:</p><div class="informalexample"><pre class="programlisting">use yii\data\ActiveDataProvider;
use app\models\Customer;
$provider = new ActiveDataProvider([
    'query' =&gt; Customer::find(),
    'pagination' =&gt; [
        'pageSize' =&gt; 10,
    ]
]);</pre></div><p>For general information on how to use Yii's ActiveRecord, please refer to the <a class="link" href="part0039.xhtml#1565U1-ae331331bc644dc9b658d3634f0748da" title="Chapter 3. ActiveRecord, Model, and Database">Chapter 3</a>, <span class="emphasis"><em>ActiveRecord, Model, and Database</em></span>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec265"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information <a class="indexterm" id="id512"/>about the extension, refer to the following URLs:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide/README.md">https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide/README.md</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-mongodb-index.html">http://www.yiiframework.com/doc-2.0/ext-mongodb-index.html</a></li></ul></div></li><li class="listitem">And for information about the original library, refer to:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://docs.mongodb.org/manual/">https://docs.mongodb.org/manual/</a></li></ul></div></li><li class="listitem">For ActiveRecord usage refer to the <a class="link" href="part0039.xhtml#1565U1-ae331331bc644dc9b658d3634f0748da" title="Chapter 3. ActiveRecord, Model, and Database">Chapter 3</a>, <span class="emphasis"><em>ActiveRecord, Model, and Database</em></span></li></ul></div></div></div>
<div class="section" title="ElasticSearch engine adapter"><div class="titlepage" id="2E6E42-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec76"/>ElasticSearch engine adapter</h1></div></div></div><p>This <a class="indexterm" id="id513"/>extension is an ActiveRecord-like wrapper for ElasticSearch full text search engine integration into the Yii2 framework. It allows you to work with any model data and use the ActiveRecord pattern to retrieve and store records<a class="indexterm" id="id514"/> in ElasticSearch collections.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec266"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</li><li class="listitem">Install the <code class="literal">ElasticSearch</code> service found at <a class="ulink" href="https://www.elastic.co/downloads/elasticsearch">https://www.elastic.co/downloads/elasticsearch</a>.</li><li class="listitem">Install the extension with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>compose</strong></span>
<span class="strong"><strong>r require yiisoft/yii2-elasticsearch</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec267"/>How to do it…</h2></div></div></div><p>Set the <a class="indexterm" id="id515"/>new <code class="literal">ElasticSearch </code>connection in your application configuration:</p><div class="informalexample"><pre class="programlisting">return [
    //....
    'components' =&gt; [
        'elasticsearch' =&gt; [
            'class' =&gt; 'yii\elasticsearch\Connection',
            'nodes' =&gt; [
                ['http_address' =&gt; '127.0.0.1:9200'],
                // configure more hosts if you have a cluster
            ],
        ],
    ]
];</pre></div><div class="section" title="Using the Query class"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec32"/>Using the Query class</h3></div></div></div><p>You can use<a class="indexterm" id="id516"/> the <code class="literal">Query</code> class for the low-level querying of records from any collection:</p><div class="informalexample"><pre class="programlisting">use  \yii\elasticsearch\Query;

$query = new Query;
$query-&gt;fields('id, name')
    -&gt;from('myindex', 'users')
    -&gt;limit(10);

$query-&gt;search();</pre></div><p>You can also create a command and run it directly:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$command = $query-&gt;create</strong></span>
<span class="strong"><strong>Command();</strong></span>
<span class="strong"><strong>$rows = $command-&gt;search();</strong></span>
</pre></div></div><div class="section" title="Using ActiveRecord"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec33"/>Using ActiveRecord</h3></div></div></div><p>Using <code class="literal">ActiveRecord</code> is a <a class="indexterm" id="id517"/>common way to access your records. Just extend the <code class="literal">yii\elasticsearch\ActiveRecord</code> class and implement the <code class="literal">attributes()</code> method to define the attributes of your documents.</p><p>For example, you can write the <code class="literal">Customer</code> model:</p><div class="informalexample"><pre class="programlisting">class Buyer extends \yii\elasticsearch\ActiveRecord
{
    public function attributes()
    {
        return ['id', 'name', 'address', 'registration_date'];
    }
    public function getOrders()
    {
        return $this-&gt;hasMany(Order::className(), ['buyer_id' =&gt; 'id'])-&gt;orderBy('id');
    }
}</pre></div><p>Then <a class="indexterm" id="id518"/>write the <code class="literal">Order</code> model:</p><div class="informalexample"><pre class="programlisting">class Order extends \yii\elasticsearch\ActiveRecord
{
    public function attributes()
    {
        return ['id', 'user_id', 'date'];
    }

    public function getBuyer()
    {
        return $this-&gt;hasOne(Customer::className(), ['id' =&gt; 'buyer_id']);
    }
}</pre></div><p>You may override <code class="literal">index()</code> and <code class="literal">type()</code> to define the index and type this record represents.</p><p>The following is a usage example:</p><div class="informalexample"><pre class="programlisting">$buyer = new Buyer();
$buyer&gt;primaryKey = 1; // it equivalent to $customer-&gt;id = 1;
$buyer&gt;name = 'test';
$buyer&gt;save();

$buyer = Buyer::get(1);

$buyer = Buyer::mget([1,2,3]);

$buyer = Buyer::find()-&gt;where(['name' =&gt; 'test'])-&gt;one();</pre></div><p>You can use Query DSL for specific queries:</p><div class="informalexample"><pre class="programlisting">$result = Article::find()-&gt;query(["match" =&gt; ["title" =&gt; "yii"]])-&gt;all();
        $query = Article::find()-&gt;query([
        "fuzzy_like_this" =&gt; [
            "fields" =&gt; ["title", "description"],
            "like_text" =&gt; "Some search text",
            "max_query_terms" =&gt; 12
        ]
]);
$query-&gt;all();</pre></div><p>You <a class="indexterm" id="id519"/>can add facets to your search:</p><div class="informalexample"><pre class="programlisting">$query-&gt;addStatisticalFacet('click_stats', ['field' =&gt; 'visit_count']);
$query-&gt;search();</pre></div></div><div class="section" title="Using the ElasticSearch DebugPanel"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec34"/>Using the ElasticSearch DebugPanel</h3></div></div></div><p>This <a class="indexterm" id="id520"/>extension contains a special panel for the <code class="literal">yii2-debug</code> module. It allows you to view all executed queries. You can include this panel in your configuration file:</p><div class="informalexample"><pre class="programlisting">if (YII_ENV_DEV) {
    // configuration adjustments for 'dev' environment
    $config['bootstrap'][] = 'debug';
    $config['modules']['debug'] =  [
        'class' =&gt; 'yii\debug\Module',
        'panels' =&gt; [
            'elasticsearch' =&gt; [
                'class' =&gt; 'yii\elasticsearch\DebugPanel',
            ],
        ],
    ];

    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = 'yii\gii\Module';
}</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec268"/>How it works…</h2></div></div></div><p>The extension provides a low-level command builder and high-level <code class="literal">ActiveRecord</code> implementation for querying records from the <code class="literal">ElasticSearch</code> index.</p><p>The extension's ActiveRecord usage is very similar to the database <code class="literal">ActiveRecord</code> as described in <a class="link" href="part0039.xhtml#1565U1-ae331331bc644dc9b658d3634f0748da" title="Chapter 3. ActiveRecord, Model, and Database">Chapter 3</a>, <span class="emphasis"><em>ActiveRecord, Model, and Database</em></span>, besides the <code class="literal">join()</code>, <code class="literal">groupBy()</code>, <code class="literal">having(),</code> and <code class="literal">union()</code> ActiveQuery operators.</p><div class="note" title="Note"><h3 class="title"><a id="note12"/>Note</h3><p>
<span class="strong"><strong>Note</strong></span>: <code class="literal">ElasticSearch</code> limits the number of returned records to ten items by default. Take care with limits if you use relations with the <code class="literal">via()</code> option.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec269"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information about the extension, see:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide/README.md">https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide/README.md</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-elasticsearch-index.html">http://www.yiiframework.com/doc-2.0/ext-elasticsearch-index.html</a></li></ul></div></li><li class="listitem">You can<a class="indexterm" id="id521"/> also visit the official extension site at <a class="ulink" href="https://www.elastic.co/products/elasticsearch">https://www.elastic.co/products/elasticsearch</a>.</li><li class="listitem">For more information about Query DSL, you can visit:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html</a></li><li class="listitem"><a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-flt-query.html">http://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-flt-query.html</a></li></ul></div></li><li class="listitem">For ActiveRecord usage refer to the <a class="link" href="part0039.xhtml#1565U1-ae331331bc644dc9b658d3634f0748da" title="Chapter 3. ActiveRecord, Model, and Database">Chapter 3</a>, <span class="emphasis"><em>ActiveRecord, Model, and Database</em></span></li></ul></div></div></div>
<div class="section" title="Gii code generator"><div class="titlepage" id="2F4UM2-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec77"/>Gii code generator</h1></div></div></div><p>This extension <a class="indexterm" id="id522"/>provides a web-based code generator called Gii for Yii 2 applications. You can use Gii to quickly generate models, forms, modules, CRUD, and many more.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec270"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a<a class="indexterm" id="id523"/> new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</li><li class="listitem">Create a new migration with the shell command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii migrate/create create_customer_table</strong></span>
</pre></div></li><li class="listitem">Put the following code into the <code class="literal">up()</code> and <code class="literal">down()</code> methods:<div class="informalexample"><pre class="programlisting">use yii\db\Schema;
use yii\db\Migration;
class m160201_154207_create_customer_table extends Migration
{
    public function up()
    {
        $tableOptions = null;
        if ($this-&gt;db-&gt;driverName === 'mysql') {
            $tableOptions = 
                'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
       }
        $this-&gt;createTable('{{%customer}}', [
            'id' =&gt; Schema::TYPE_PK,
            'name' =&gt; Schema::TYPE_STRING . ' NOT NULL',
            'email' =&gt; Schema::TYPE_STRING . ' NOT NULL',
            'address' =&gt; Schema::TYPE_STRING,
        ], $tableOptions);
    }

    public function down()
    {
        $this-&gt;dropTable('{{%customer}}');
    }
}</pre></div></li><li class="listitem"> <a class="indexterm" id="id524"/>Apply the migration:<div class="informalexample"><pre class="programlisting">php yii migrate/up</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec271"/>How to do it…</h2></div></div></div><p>In your projects, you can use this extension in two ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Working with GUI</li><li class="listitem">Working with CLI</li></ul></div><div class="section" title="Working with GUI"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec35"/>Working with GUI</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check<a class="indexterm" id="id525"/> that your web configuration file contains the following code:<div class="informalexample"><pre class="programlisting">if (YII_ENV_DEV) {
    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = [
        'class' =&gt; 'yii\gii\Module',
    ];
}</pre></div></li><li class="listitem">Your <code class="literal">web/index.php</code> file will define the development environment:<div class="informalexample"><pre class="programlisting">defined('YII_ENV') or define('YII_ENV', 'dev');</pre></div><p>The previous configuration states that when in a development environment, the application should include a module named <code class="literal">gii</code>, which is of the class <code class="literal">yii\gii\Module</code>.</p><p>By default, the module allows access from the IP address, <code class="literal">127.0.0.1</code>. If you work from another location, add your address in the <code class="literal">allowedIPs</code> property:</p><div class="informalexample"><pre class="programlisting">$config['modules']['gii'] = [
    'class' =&gt; 'yii\gii\Module',
    allowedIPs = ['127.0.0.1', '::1', '192.168.0.*'],
];</pre></div></li><li class="listitem">Go to <a class="indexterm" id="id526"/>the <code class="literal">gii</code> route of your application: <code class="literal">http://localhost/index.php?r=gii</code>.<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00393.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Model Generator</strong></span> button and type your table name and model name in the form:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00405.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click<a class="indexterm" id="id527"/> the <span class="strong"><strong>Preview</strong></span> button. You must view the featured files list:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00417.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">If you want to regenerate existing files, Gii will mark those in yellow:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00430.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In this <a class="indexterm" id="id528"/>case, you can view the difference between existing and new files and overwrite the target if needed.</li><li class="listitem">After all that, click the <span class="strong"><strong>Generate</strong></span> button:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00441.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Check that the new class, <code class="literal">\app\models\Customer</code>, exists.</li><li class="listitem">CRUD is an abbreviation for the four common tasks using data on most websites: Create, Read, Update, and Delete. To create CRUD using Gii, select the <span class="strong"><strong>CRUD Generator</strong></span> section. Specify your model class and type the other fields:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00409.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem"><a class="indexterm" id="id529"/>Generate the new items:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00478.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">After<a class="indexterm" id="id530"/> that, try to open the new controller:<div class="mediaobject"><img alt="Working with GUI" src="../Images/image00381.jpeg"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>You will see a data grid showing the customers in the database table. Try to create a new item. You may sort the grid or filter it by entering filter conditions in the column headers.</p></div><div class="section" title="Working with CLI"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec36"/>Working with CLI</h3></div></div></div><p>Gii also provides a<a class="indexterm" id="id531"/> console controller for code generation.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Check that your console configuration contains the Gii module settings:<div class="informalexample"><pre class="programlisting">return [
    // ...
    'modules' =&gt; [
        'gii' =&gt; 'yii\gii\Module',
    ],
    // ...
];</pre></div></li><li class="listitem">Run any shell command for help:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii help gii</strong></span>
<span class="strong"><strong>php yii help gii/model</strong></span>
</pre></div></li><li class="listitem">Type the following command to start the model generation process:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>php yii gii/model --tableName=customer --modelClass=Customer --useTablePrefix=1</strong></span>
</pre></div></li><li class="listitem">Check that the new class, <code class="literal">\app\models\Customer</code>, exists.</li><li class="listitem">Generate CRUD for your model:<div class="informalexample"><pre class="programlisting">php yii gii/crud --modelClass=app\\models\\Customer \
    --searchModelClass=app\\models\\CustomerSearch \
    --controllerClass=app\\controllers\\CustomerController</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec272"/>How it works…</h2></div></div></div><p>Gii allows <a class="indexterm" id="id532"/>you to generate some standard code elements instead of manually typing. It provides web-based and console interfaces to work with every generator.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec273"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information about the <a class="indexterm" id="id533"/>extension's usage, see:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-gii.html">http://www.yiiframework.com/doc-2.0/guide-start-gii.html</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-gii-index.html">http://www.yiiframework.com/doc-2.0/ext-gii-index.html</a></li><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-gii/tree/master/docs/guide">https://github.com/yiisoft/yii2-gii/tree/master/docs/guide</a></li></ul></div></li><li class="listitem">For MongoDB integration refer to the <span class="emphasis"><em>Creating a widget</em></span> recipe in <a class="link" href="part0086.xhtml#2I0GC1-ae331331bc644dc9b658d3634f0748da" title="Chapter 8. Extending Yii">Chapter 8</a>, <span class="emphasis"><em>Extending Yii</em></span></li></ul></div></div></div>
<div class="section" title="Pjax jQuery plugin"><div class="titlepage" id="2G3F82-ae331331bc644dc9b658d3634f0748da"><div><div><h1 class="title"><a id="ch07lvl1sec78"/>Pjax jQuery plugin</h1></div></div></div><p>Pjax is a <a class="indexterm" id="id534"/>widget that integrates the <span class="strong"><strong>pjax jQuery</strong></span> plugin. All content that is wrapped by this widget will be reloaded by AJAX without refreshing the current page. The widget also uses the HTML5 History API to change the current URL in your browser's address line.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec274"/>Getting ready</h2></div></div></div><p>Create a new <a class="indexterm" id="id535"/>application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec275"/>How to do it…</h2></div></div></div><p>In the following example, you can see how you use Pjax with the <code class="literal">yii\grid\GridView</code> widget:</p><div class="informalexample"><pre class="programlisting">&lt;?php
    use yii\widgets\Pjax;
?&gt;
&lt;?php Pjax::begin(); ?&gt;
    &lt;?= GridView::widget([...]); ?&gt;
&lt;?php Pjax::end(); ?&gt;</pre></div><p>Just wrap any <a class="indexterm" id="id536"/>code fragment in the <code class="literal">Pjax::begin()</code> and <code class="literal">Pjax::end()</code> calls.</p><p>This will render the following HTML code:</p><div class="informalexample"><pre class="programlisting">&lt;div id="w1"&gt;
    &lt;div id="w2" class="grid-view"&gt;...&lt;/div&gt;
&lt;/div&gt;

&lt;script type="text/javascript"&gt;jQuery(document).ready(function () {
    jQuery(document).pjax("#w1 a", "#w1", {...});
});&lt;/script&gt;</pre></div><p>All the wrapped content with pagination and sorting links will be reloaded by AJAX.</p><div class="section" title="Specifying a custom ID"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec37"/>Specifying a custom ID</h3></div></div></div><p>Pjax gets page<a class="indexterm" id="id537"/> content from AJAX requests and then extracts its own DOM element with the same ID. You can optimize page rendering performance by rendering content without layout, especially for Pjax requests:</p><div class="informalexample"><pre class="programlisting">public function actionIndex()
{
    $dataProvider = …;
    
    if (Yii::$app-&gt;request-&gt;isPjax) {
        return $this-&gt;renderPartial('_items', [
            'dataProvider' =&gt; $dataProvider,
        ]);
    } else {
        return $this-&gt;render('index', [
            'dataProvider' =&gt; $dataProvider,
        ]);
    }
}</pre></div><p>By default, the <code class="literal">yii\base\Widget::getId</code> method increments identifiers, and therefore widgets, on any page that has incremented attributes:</p><div class="informalexample"><pre class="programlisting">&lt;nav id="w0"&gt;...&lt;/nav&gt; // Main navigation
&lt;ul id="w1"&gt;...&lt;/ul&gt; // Breadcrumbs widget
&lt;div id="w2"&gt;...&lt;/div&gt; // Pjax widget</pre></div><p>To render using the <code class="literal">renderPartial()</code> or <code class="literal">renderAjax()</code> methods, without rendering the layout, your own page will have only one widget with the number <code class="literal">0</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div id="w0"&gt;...&lt;/div&gt; // Pjax widget</pre></div><p>In the <a class="indexterm" id="id538"/>result, your own widget will not have found its own block with the <code class="literal">w2</code> selector at the next request.</p><p>However, Pjax will find the same block with the <code class="literal">w2</code> selector in the Ajax response. In the result, your own widget will not have found the block with the <code class="literal">w2</code> selector at the next request.</p><p>Therefore, you must manually specify a unique identifier for all your Pjax widgets to avoid different conflicts:</p><div class="informalexample"><pre class="programlisting">&lt;?php Pjax::begin(['id' =&gt; 'countries']) ?&gt;
    &lt;?= GridView::widget([...]); ?&gt;
&lt;?php Pjax::end() ?&gt;</pre></div></div><div class="section" title="Using ActiveForm"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec38"/>Using ActiveForm</h3></div></div></div><p>By default, Pjax<a class="indexterm" id="id539"/> works only with links in the wrapped block. If you want to use it with the <code class="literal">ActiveForm</code> widget, you must use the <code class="literal">data-pjax</code> option of the form:</p><div class="informalexample"><pre class="programlisting">&lt;?php
use \yii\widgets\Pjax
use \yii\widgets\ActiveForm;

&lt;?php yii\widgets\Pjax::begin(['id' =&gt; 'my-block']) ?&gt;
    &lt;?php $form = ActiveForm::begin(['options' =&gt; [
        'data-pjax' =&gt; true,
    ]]); ?&gt; 
        &lt;?= $form-&gt;field($model, 'name') ?&gt;
    &lt;?php ActiveForm::end(); ?&gt;
&lt;?php Pjax::end(); ?&gt;</pre></div><p>It adds corresponding listeners on the form submitting event.</p><p>You can also use the <code class="literal">$formSelector</code> option of the Pjax widget to specify which form submission may trigger <code class="literal">pjax</code>.</p></div><div class="section" title="Working with the client-side script"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec39"/>Working with the client-side script</h3></div></div></div><p>You can <a class="indexterm" id="id540"/>subscribe to container events:</p><div class="informalexample"><pre class="programlisting">&lt;?php $this-&gt;registerJs('
    $("#my-block").on("pjax:complete", function() {
        alert('Pjax is completed');
    });
'); ?&gt;</pre></div><p>Or, you can reload the container manually by using its selector:</p><div class="informalexample"><pre class="programlisting">&lt;?php $this-&gt;registerJs('
    $("#my-button").on("click", function() {
        $.pjax.reload({container:"#my-block"});
    });
'); ?&gt;</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec276"/>How it works…</h2></div></div></div><p>Pjax is a simple <a class="indexterm" id="id541"/>wrapper for any code fragment. It subscribes to click events of all links in the fragment and replaces the whole page, reloading it into Ajax calls. We can use the <code class="literal">data-pjax</code> attribute for wrapped forms, and any form submissions will trigger an Ajax request.</p><p>The widget will load and update on-the-fly widget body content without, loading the layout resources (JS, CSS).</p><p>You may configure the <code class="literal">$linkSelector</code> of the widget to specify which links should trigger Pjax, and configure <code class="literal">$formSelector</code> to specify which form submission may trigger Pjax.</p><p>You may disable Pjax for a specific link inside the container by adding the <code class="literal">data-pjax="0"</code> attribute to this link.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec277"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information <a class="indexterm" id="id542"/>about the extension's usage, see:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">http://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html</a></li><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/jquery-pjax">https://github.com/yiisoft/jquery-pjax</a></li></ul></div></li><li class="listitem">For more information about client-side options and methods, refer to <a class="ulink" href="https://github.com/yiisoft/jquery-pjax#usage">https://github.com/yiisoft/jquery-pjax#usage</a></li></ul></div></div></div>
<div class="section" id="2H1VQ1-ae331331bc644dc9b658d3634f0748da" title="Redis database driver"><div class="titlepage" id="aid-2H1VQ2"><div><div><h1 class="title"><a id="ch07lvl1sec79"/>Redis database driver</h1></div></div></div><p>This extension allows you to <a class="indexterm" id="id543"/>use Redis key-value storage in any project on the Yii2 framework. It contains the <code class="literal">Cache</code> and <code class="literal">Session</code> storage handlers, as well as the extension, which implements the ActiveRecord pattern for access to the Redis database records.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec278"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create<a class="indexterm" id="id544"/> a new application by using composer, as described in the official guide at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-start-installation.html">http://www.yiiframework.com/doc-2.0/guide-start-installation.html</a>.</li><li class="listitem">Install the storage: <a class="ulink" href="http://redis.io">http://redis.io</a>.</li><li class="listitem">Install all migrations with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>composer require yiisoft/yii2-redis</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec279"/>How to do it…</h2></div></div></div><p>First of all, configure the <code class="literal">Connection</code> class in your configuration file:</p><div class="informalexample"><pre class="programlisting">return [
    //....
    'components' =&gt; [
        'redis' =&gt; [
            'class' =&gt; 'yii\redis\Connection',
            'hostname' =&gt; 'localhost',
            'port' =&gt; 6379,
            'database' =&gt; 0,
        ],
    ]
];</pre></div><div class="section" title="Direct usage"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec40"/>Direct usage</h3></div></div></div><p>For low-level working <a class="indexterm" id="id545"/>with Redis commands, you can use the <code class="literal">executeCommand</code> method of the connection component:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Yii::$app-&gt;redis-&gt;executeCommand('hmset', ['test_collection', 'key1', 'val1', 'key2', 'val2']);</strong></span>
</pre></div><p>You can also use simplified shortcuts instead of <code class="literal">executeCommand</code> calls:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Yii::$app-&gt;redi</strong></span>
<span class="strong"><strong>s-&gt;hmset('test_collection', 'key1', 'val1', 'key2', 'val2')</strong></span>
</pre></div></div><div class="section" title="Using ActiveRecord"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec41"/>Using ActiveRecord</h3></div></div></div><p>For access <a class="indexterm" id="id546"/>to Redis records via the <code class="literal">ActiveRecord</code> pattern, your record class needs to extend from the <code class="literal">yii\redis\ActiveRecord</code> base class and implement the <code class="literal">attributes()</code> method:</p><div class="informalexample"><pre class="programlisting">class Customer extends \yii\redis\ActiveRecord
{
    public function attributes()
    {
        return ['id', 'name', 'address', 'registration_date'];
    }
    public function getOrders()
    {
        return $this-&gt;hasMany(Order::className(), ['customer_id' =&gt; 'id']);
    }
}</pre></div><p>A primary <a class="indexterm" id="id547"/>key of any model can be defined via the <code class="literal">primaryKey()</code> method, which defaults to <code class="literal">id</code> if not specified. The primary key needs to be placed in the attribute list if you do not manually specify it in the <code class="literal">primaryKey()</code> method.</p><p>The following is a usage example:</p><div class="informalexample"><pre class="programlisting">$customer = new Customer();
$customer-&gt;name = 'test';
$customer-&gt;save();
echo $customer-&gt;id; // id will automatically be incremented if not set explicitly
// find by query
$customer = Customer::find()-&gt;where(['name' =&gt; 'test'])-&gt;one();</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec280"/>How it works…</h2></div></div></div><p>The extension<a class="indexterm" id="id548"/> provides a <code class="literal">Connection</code> component for low-level access to Redis storage records.</p><p>You can also use an ActiveRecord-like model with a limited set of methods (<code class="literal">where()</code>,<code class="literal"> limit()</code>, <code class="literal">offset(),</code> and <code class="literal">indexBy()</code>). Other methods do not exist because Redis does not support SQL queries.</p><p>There are no tables in Redis, so you cannot define via relations via a junction table name. You can only define many-to-many relations via other <code class="literal">hasMany</code> relations.</p><p>For general information on how to use Yii's ActiveRecord, please refer to <a class="link" href="part0039.xhtml#1565U1-ae331331bc644dc9b658d3634f0748da" title="Chapter 3. ActiveRecord, Model, and Database">Chapter 3</a>, <span class="emphasis"><em>ActiveRecord, Model, and Database</em></span>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec281"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information about the<a class="indexterm" id="id549"/> extension's usage, see:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="https://github.com/yiisoft/yii2-redis/blob/master/docs/guide/README.md">https://github.com/yiisoft/yii2-redis/blob/master/docs/guide/README.md</a></li><li class="listitem"><a class="ulink" href="http://www.yiiframework.com/doc-2.0/ext-redis-index.html">http://www.yiiframework.com/doc-2.0/ext-redis-index.html</a></li></ul></div></li><li class="listitem">For information about Redis key-value storage, refer: <a class="ulink" href="http://redis.io/documentation">http://redis.io/documentation</a></li><li class="listitem"><a class="link" href="part0039.xhtml#1565U1-ae331331bc644dc9b658d3634f0748da" title="Chapter 3. ActiveRecord, Model, and Database">Chapter 3</a>, <span class="emphasis"><em>ActiveRecord, Model, and Database</em></span> for ActiveRecord usage</li></ul></div></div></div></body></html>