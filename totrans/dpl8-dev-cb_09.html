<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Configuration Management - Deploying in Drupal 8</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will explore the configuration management system and deployment of the configuration changes. The following is a list of the recipes covered in this chapter:</p>
<ul>
<li>Importing and exporting configurations</li>
<li>Synchronizing site configurations</li>
<li>Using command-line workflow processes</li>
<li>Updating and installing new module configurations</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Drupal 8 provides a new, unified system to manage configurations. In Drupal 8, all configurations are saved in configuration entities that match a defined configuration schema. This system provides a standard way of deploying the configuration between Drupal site environments and updating the site configuration.</p>
<p>Once the configuration is created, or imported, it goes into an immutable state. If a module tries to install the configuration that exists, it will throw an exception and be prevented. Outside the typical user interface, the configuration can only be modified through the configuration management system.</p>
<p>The configuration management system can be manipulated through a user interface provided by the Configuration management module or through the command-line interface tools. These tools allow you to follow the development paradigm of utilizing a production site and a development site, where changes are made to the development site and then pushed to production.</p>
<div class="mce-root packt_infobox">Instead of creating two different Drupal sites for the recipes in this chapter, you can utilize the Drupal multisite functionality. For more information on this functionality, refer to the <em>Installing Drupal</em> recipe of <span class="ChapterrefPACKT"><a href="f6d2ba3b-f85a-45e4-ac1d-35b6fba84240.xhtml"><em>Chapter 1</em></a>, <em>Up and Running with Drupal 8</em></span>. Note that if you use a multisite, you will need to clone your development site's database into the site acting as your production site to replicate a realistic development and production site workflow.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Importing and exporting configurations</h1>
                </header>
            
            <article>
                
<p>Configuration management in Drupal 8 provides a solution to common problems when working with a website across multiple environments. No matter what the workflow pattern is, at some point, the configuration needs to move from one place to another, such as from production to a local environment. When pushing the development work to production, you will need to have some way to put the configuration in place.</p>
<p>Drupal 8's user interface provides a way to import and export configuration entities via the YAML format. In this recipe, we will create a content type, export its configuration, and then import it into another Drupal site. The configuration YAML export will be imported into the production site to update its configuration.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You will need a base Drupal site to act as the development site. Another Drupal site, which is a clone of the development site, must be available to act as a production Drupal site.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>To get started, create a new content type on the development site. Name the content type <span class="packt_screen">Staff Page</span> and click on <span class="packt_screen">Save and manage fields</span> to save the content type. We will not add any additional fields.</li>
<li>Once the content type has been saved, go to <span class="packt_screen">Extend</span> and install the <span class="packt_screen">Configuration Manager</span> module if it is not installed:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/7d671b26-086e-4e28-a491-73b2a1df0286.png"/></div>
<ol start="3">
<li>From your Drupal site's <span class="packt_screen">Configuration</span> page, go to <span class="packt_screen">Configuration synchronization</span> under the <span class="packt_screen">Development</span> group. This section allows you to import and export configuration:</li>
</ol>
<p> </p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/e1e449e4-ceee-4f67-a0ce-812e83233930.png"/></div>
<ol start="4">
<li>Click on the <span class="packt_screen">Export</span> tab at the top of the page. The default page will be for a <span class="packt_screen">Full archive</span> export, that contains the configuration of your entire Drupal site. Click on the <span class="packt_screen">Single item</span> subtab to export a single configuration entity instead:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="161" width="527" class=" image-border" src="assets/2b7aa73c-96b9-4eaa-b41d-1003ecd8fa6d.png"/></div>
<ol start="5">
<li>Select <span class="packt_screen">Content type</span> from the <span class="packt_screen">Configuration type</span> drop-down menu. Then, choose your content type from the <span class="packt_screen">Configuration name</span> drop-down menu. Its configuration will populate the configuration textbox:
<div class="packt_figure CDPAlignCenter CDPAlign"><img height="361" width="442" class=" image-border" src="assets/42db8f86-f372-40f2-9407-a58e60716932.png"/></div>
</li>
<li>Copy the YAML content from the textbox so that you can import it into your other Drupal site.</li>
<li>On your production Drupal site, install the Configuration management module just as you did for the development site, if it is not yet installed.</li>
<li>Go to the <span class="packt_screen">Configuration synchronization</span> page and click on the <span class="packt_screen">Import</span> tab.</li>
<li>Click on <span class="packt_screen">Single item</span> and select <span class="packt_screen">Content type</span> from the <span class="packt_screen">Configuration type</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/35efbe19-9f7c-4dbf-bd01-989403a63684.png"/></div>
<ol start="10">
<li>Paste your exported configuration YAML into the textbox and click on <span class="packt_screen">Import</span>:
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/de177b4e-7b8a-4a3c-8a41-81ef161d3245.png"/></div>
</li>
<li>Click on <span class="packt_screen">Confirm</span> on the confirmation form to finalize your import to the production Drupal site for your custom content type.</li>
<li>Go to the <span class="packt_screen">Structure</span> page and then to the <span class="packt_screen">Content Types</span> page to verify that your content type has been imported.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>At the most basic level, configurations are just a mapping of keys and values, which can be represented as a PHP array and translated into the YAML format.</p>
<p>Configuration management uses schema definitions for configuration entities. The schema definition provides a configuration namespace and the available keys and data types. The schema definition provides a typed data definition for each option that allows validation of the individual values and configuration.</p>
<p>The export process reads the configuration data and translates it into the YAML format. The configuration manager then receives the configuration in the form of YAML and converts it back to a PHP array. The data is then updated in the database.</p>
<p>When importing the configuration, Drupal checks the value of the configuration YAML's <kbd>uuid</kbd> key, if present, against any current configuration with the same <strong>Universally Unique Identifier</strong> (<strong>UUID</strong>). A UUID is a pattern used in software to provide a method of identifying an object across different environments. This allows Drupal to correlate a piece of data from its UUID since the database identifier can differ across environments. If the configuration item has a matching machine name, but a mismatching UUID, an error will be thrown.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We will discuss importing and exporting configuration within your Drupal site <span>more in depth in a later section</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuration dependencies</h1>
                </header>
            
            <article>
                
<p>Configuration entities define dependencies when they are exported. The dependency definitions ensure that the configuration entity's schema and <span>other module functionalities are</span> available.</p>
<p>When you review the configuration export for <kbd>field.storage.node.body.yml</kbd>, it defines <kbd>node</kbd> and <kbd>text</kbd> as <kbd>dependencies</kbd>:</p>
<pre>dependencies: 
  module: 
    - node 
    - text </pre>
<p>If the <kbd>node</kbd> or <kbd>text</kbd> module is not enabled, the import will fail and throw an error.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Saving to a YAML file for a module's configuration installation</h1>
                </header>
            
            <article>
                
<p>The <em>Providing configuration on install or update</em> recipe of <a href="18026cd1-b8f0-48c0-9626-568ffd225eb5.xhtml"><em><span class="ChapterrefPACKT">Chapter 6</span></em></a><span class="ChapterrefPACKT">, <em>Creating Forms with the Form API</em></span><span>,</span> discusses how to use a module to provide configurations on the module's installation. Instead of manually writing configuration <kbd>YAML</kbd> files for installation, the <kbd>Configuration management</kbd> module can be used to export configurations and save them in your module's <kbd>config/install</kbd> directory.</p>
<p>Any item exported through the user interface can be used. The only requirement is that you will need to remove the <kbd>uuid</kbd> key, as it denotes the site's UUID value and invalidates the configuration when it tries to install it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuration schemas</h1>
                </header>
            
            <article>
                
<p>The configuration management system in Drupal 8 utilizes the configuration schema to describe configurations that can exist. Why is this important? It allows Drupal to properly implement typed data on stored configuration values and validate them, providing a standardized way of handling configurations for translation and configuration items.</p>
<p>When a module uses the configuration system to store data, it needs to provide a schema for each configuration definition it wishes to store. The schema definition is used to validate and provide typed data definitions for its values.</p>
<p>The following code defines the configuration schema for the <kbd>navbar_awesome</kbd> module, which holds two different Boolean configuration values:</p>
<pre>navbar_awesome.toolbar: 
  type: config_object 
  label: 'Navbar Awesome toolbar settings' 
  mapping: 
    cdn: 
      type: boolean 
      label: 'Use the FontAwesome CDN library' 
    roboto: 
      type: boolean 
      label: 'Include Roboto from Google Fonts CDN' </pre>
<p>This defines the <kbd>navbar_awesome.toolbar</kbd> configuration namespace; it belongs to the <kbd>navbar_awesome</kbd> module and has the <kbd>toolbar</kbd> configuration. We will then need two <kbd>cdn</kbd> and <kbd>roboto</kbd> subvalues that represent typed data values. A configuration YAML for this schema will be named <kbd>navbar_awesome.toolbar.yml</kbd> after the namespace, and it contains the following code:</p>
<pre>cdn: true 
roboto: true </pre>
<p>In turn, this is what the values will look like when represented as a PHP array:</p>
<pre>[ 
  'navbar_awesome' =&gt; [ 
    'cdn' =&gt; TRUE, 
    'roboto' =&gt; TRUE, 
  ] 
] </pre>
<p>The configuration factory classes then provide an object-based wrapper around these configuration definitions and provide validation of their values against the schema. For instance, if you try to save the <kbd>cdn</kbd> value as a string, a validation exception will be thrown.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ChapterrefPACKT">Refer to <a href="a634af62-2148-4382-9121-b8500df169ed.xhtml"><em>Chapter 4</em></a>, <em>Extending Drupal</em></span></li>
<li>Configuration schema/metadata in the Drupal.org community handbook at <a href="https://www.drupal.org/node/1905070"><span class="URLPACKT">https://www.drupal.org/node/1905070</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Synchronizing site configurations</h1>
                </header>
            
            <article>
                
<p>A key component for managing a Drupal website is configuration integrity. A key part of maintaining this integrity is ensuring that your configuration changes made in development are pushed upstream to your production environments. Maintaining configuration changes by manually exporting and importing through the user interface can be tedious and does not provide a way to track what has or has not been exported or imported. At the same time, manually writing module hooks to manipulate the configuration can be time-consuming. Luckily, the configuration management solution provides you with the ability to export and import the entire site's configuration.</p>
<p>A site export can only be imported into another copy of itself. Each site must have the same UUID, which is set during its installation. This allows you to export your local development environment's configuration and bring it to staging or production, without modifying the content or the database directly.</p>
<p>In this recipe, we will export the development site's complete configuration entities' definitions. We will then take the exported configuration and import it into the production site. This will simulate a typical deployment of a Drupal site with changes created in development that is ready to be released in production.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You will need a base Drupal site to act as the development site. Another Drupal site, which is a duplicate of the development site's database, must be available to act as the production Drupal site.</p>
<p>You will need to have the <strong>Configuration management</strong> module installed if it is not already.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Go to the development site. Modify the site to simulate creating changes that need to be deployed to our other Drupal site.</li>
<li>For example, let's modify the site's name; go to the <span class="packt_screen">Configuration</span> page and the <span class="packt_screen">Basic site settings</span> form.</li>
<li>From the <span class="packt_screen">Configuration</span> page, go to <span class="packt_screen">Configuration synchronization</span>.</li>
<li class="mce-root"><span>Navigate to the</span> <span class="packt_screen">Export</span> <span>tab; we will land on the</span> <span class="packt_screen">Full archive</span> <span>page. Click on the</span> <span class="packt_screen">Export</span> <span>button to begin the export and download process:</span></li>
</ol>
<div style="color: black;font-size: 1em" class="packt_figure CDPAlignCenter CDPAlign"><img height="249" width="455" class=" image-border" src="assets/54f7e627-f89d-4c7c-9967-267b53b33ca1.png"/></div>
<ol start="5">
<li>Save the <kbd>gzipped</kbd> archive; this contains an archive of all the site's configuration as YAML.</li>
<li>Navigate to your other Drupal site and then to its <span class="packt_screen">Configuration synchronization</span> page.</li>
<li>Click on the <span class="packt_screen">Import</span> tab and then on the <span class="packt_screen">Full archive</span> tab. Use the <span class="packt_screen">Configuration archive</span> file input, and click on <span class="packt_screen">Choose File</span> to select the tarball you just downloaded. Click on <span class="packt_screen">Upload</span> to begin the import process.</li>
<li>You will be taken to the <span class="packt_screen">Synchronize</span> tab to review changes that need to be imported:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="218" width="508" class=" image-border" src="assets/956ebba6-11a0-435b-ae81-cac9ab09b7e2.png"/></div>
<ol start="9">
<li>Click on <span class="packt_screen">Import all</span> to update the current site's configuration to the items in the archive.</li>
<li>A batch operation will begin with the import process:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/a8216528-5e59-4476-abef-9ef5a7aefc9a.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">Configuration synchronization</span> form provides a way to interface with the <kbd>config</kbd> database table for your Drupal site. When you go to the <span class="packt_screen">Export</span> page and create the tarball, Drupal effectively dumps the contents of the <kbd>config</kbd> table. Each row represents a configuration entity and will become its own <kbd>YAML</kbd> file. The contents of the <kbd>YAML</kbd> file represent its database value.</p>
<p>When you import the tarball, Drupal extracts its content. The files are placed in the available <kbd>CONFIG_SYNC_DIRECTORY</kbd> directory. The synchronization page parses the configuration entity YAML and provides a difference check against the current site's configuration. Each configuration item can be reviewed, and then all the items can be imported. You cannot choose to selectively import individual items.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We will now discuss things that are required for site configuration synchronization.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Universally Unique Identifier</h1>
                </header>
            
            <article>
                
<p>When a Drupal site is installed, the UUID is set. This UUID is added to the exported configuration entities and is represented by the <kbd>uuid</kbd> key. Drupal uses this key to identify the source of the configuration. Drupal will not synchronize configurations that do not have a matching UUID in their YAML definition.</p>
<p>You can review the site's current UUID value by reviewing the <kbd>system.site</kbd> configuration object. This can also be done using the Drush or Drupal Console command-line tool.</p>
<p>Using Drush, type the following command:</p>
<pre><strong>$ drush config-get system.site</strong></pre>
<p>Using Drupal Console, type the following command:</p>
<pre><strong>$ drupal debug:config system.site</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A synchronization folder</h1>
                </header>
            
            <article>
                
<p>Drupal uses a synchronization folder to hold the configuration YAML files that are to be imported into the current site. This folder is represented by the <kbd>CONFIG_SYNC_DIRECTORY</kbd> constant. If you have not defined this in the global <kbd>$config_directories</kbd> variable in your site's <kbd>settings.php</kbd>, then it will be a randomly named directory in your site's file directory.</p>
<div class="packt_infobox">When Drupal 8 entered its beta release cycle, this folder was referenced as a staging folder and referenced by the <kbd>CONFIG_STAGING_DIRECTORY</kbd>. This is now deprecated; however, the internals of the configuration management system support reading <kbd>CONFIG_STAGING_DIRECTORY</kbd> as <kbd>CONFIG_SYNC_DIRECTORY</kbd>. This will be removed in Drupal 9.</div>
<p>The synchronization form will use the configuration management discovery service to look for configuration changes that need to be imported from this folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing a configuration from a new site</h1>
                </header>
            
            <article>
                
<p>Drupal's configuration management system will not allow the import of configuration entities that originated at a different Drupal site. When a Drupal site is installed, the <kbd>system.site</kbd> configuration entity saves a UUID for the current site instance. Only cloned versions of this site's database can accept configuration imports from it.</p>
<p>The configuration installer profile is a custom distribution, that will allow you to import the configuration despite the configuration's site UUID. The profile doesn't install itself. When you use the profile, it will provide an interface to upload a configuration export that will then be imported, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/8936ae3c-8478-495a-910f-8f22f90b1dbd.png"/></div>
<p>The distribution can be found at <a href="https://www.drupal.org/project/config_installer"><span class="URLPACKT">https://www.drupal.org/project/config_installer</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using command-line workflow processes</h1>
                </header>
            
            <article>
                
<p>Drupal 8's configuration systems solve many problems encountered when exporting and deploying configurations in Drupal 7. However, the task of synchronizing the configuration is still a user interface task and requires the manipulation of archive files that contain the configuration exports for a Drupal 8 site.</p>
<p>Configuration management can be done on the command line through Drush, without requiring it to be installed. This mitigates any requirement to log in to the production website to import changes. It also opens the ability for more advanced workflows that place the configuration in version control.</p>
<p>In this recipe, we will use Drush to export the development site's configuration to the filesystem. The exported configuration files will then be copied to the production site's configuration directory. Using Drush, the configuration will be imported into production to complete the deployment.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready...</h1>
                </header>
            
            <article>
                
<p>You will need a base Drupal site to act as the development site. Another Drupal site, which is a clone of the development site, must be available to act as the production Drupal site.</p>
<p>This recipe uses Drush. If you have <span>not</span> installed <span>Drush</span>, instructions can be found at <a href="http://docs.drush.org/en/master/install/"><span class="URLPACKT">http://docs.drush.org/en/master/install/</span></a>. Drush needs to be installed at the locations of <span>both</span> your Drupal sites.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>For the purpose of demonstration, change your development site's name to <kbd>Drush Config Sync Demo!</kbd>. This way, there is at least one configuration change to be imported to the production Drupal site.</li>
<li>Open a command-line terminal and change your directory to the working directory of your development Drupal site.</li>
<li>Use the <kbd>drush config-export</kbd> command to export the configuration to a directory. The command will default to the <kbd>sync</kbd> configuration directory defined in your Drupal 8 site.</li>
</ol>
<div class="packt_infobox">If you have not explicitly defined a sync directory, Drupal automatically creates a protected folder in the current site's uploaded files' directory, with a unique hash suffix on the directory name.</div>
<ol start="4">
<li>You will receive a message that the configuration has been exported to the directory.</li>
<li>Using a method of your choice, copy the contents of the configuration <kbd>sync</kbd> folder to your other Drupal sites that match the <kbd>configuration sync</kbd> folder. For example, a default folder generated by Drupal can be <kbd>sites/default/files/config_XYZ/sync</kbd>.</li>
</ol>
<p> </p>
<ol start="6">
<li>Open a command-line terminal and change your directory to your production Drupal site's working directory.</li>
<li>Use the <kbd>drush config-import</kbd> command to begin the process of importing your configuration.</li>
<li>Review the changes made to the configuration entity keys and enter <kbd>y</kbd> to confirm the changes:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/01a99acb-4554-4cb6-be77-6443b5906d5a.png"/></div>
<ol start="9">
<li>Check whether your configuration changes have been imported.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <strong>Drush</strong> command-line tool can utilize the code found in Drupal to interact with it. The <kbd>config-export</kbd> command replicates the functionality provided by the <kbd>Configuration management</kbd> module's full site export. However, you do not need the Configuration management module enabled for the command to work. The command will extract the available site configuration and write it to a directory, which is unarchived.</p>
<p>The <kbd>config-import</kbd> command parses the files in a directory. It will make an attempt to run a difference check against the YAML files like the Configuration management module's synchronize overview form does. It will then import all the changes.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are additional ways to work with the configuration management system in Drupal. We will explore those options in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Drush config-pull</h1>
                </header>
            
            <article>
                
<p>Drush provides a way to simplify the transportation of configuration between sites. The <kbd>config-pull</kbd> command allows you to specify two Drupal sites and move the export configuration between them. You can either specify a name of a subdirectory under the <kbd>/sites</kbd> directory or a Drush alias.</p>
<p>The following command will copy a development site's configuration and import it into the staging server's site:</p>
<pre><strong>drush config-pull @mysite.local @mysite.staging</strong> </pre>
<p>Additionally, you can specify the <kbd>--label</kbd> option. This represents a folder key in the <kbd>$config_directories</kbd> setting. The option defaults to <kbd>sync</kbd> automatically. Alternatively, you can use the <kbd>--destination</kbd> parameter to specify an arbitrary folder that is not specified in the setting of <kbd>$config_directories</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Drupal Console</h1>
                </header>
            
            <article>
                
<p>Drush has been part of the Drupal community since Drupal 4.7 and is a custom-built command-line tool. The Drupal Console is a Symfony Console-based application used to interact with Drupal. The Drupal Console project provides a means for configuration management over the command line.</p>
<div class="packt_infobox">You can learn more about the Drupal Console in <a href="099b7376-2149-4af8-9649-45445745f068.xhtml"><em><span class="ChapterrefPACKT">Chapter 13</span></em></a>, <em>Drupal CLI</em> or at <a href="http://www.drupalconsole.com/"><span class="URLPACKT">http://www.drupalconsole.com/</span></a>.</div>
<p>The workflow is the same, except the naming of the command. The configuration export command is <kbd>config:export</kbd>, and it is automatically exported to your system's temporary folder until a directory is passed. You can then import the configuration using the <kbd>config:import</kbd> command.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Editing the configuration from the command line</h1>
                </header>
            
            <article>
                
<p>Both Drush and Drupal Console support the ability to edit the configuration through the command line in YAML format. Both the tools operate in the same fashion and have similar command names:</p>
<ul>
<li><strong>Drush</strong>: <kbd>config-edit [name]</kbd></li>
<li><strong>Console</strong>: <kbd>config:edit [name]</kbd></li>
</ul>
<p>The difference is that Drush will list all the available options to be edited if you do not pass a name, while Console allows you to search.</p>
<p>When you edit a configuration item, your default terminal-based text editor will open. You will be presented with a <kbd>YAML</kbd> file that can be edited. Once you save your changes, the configuration is then saved on your Drupal site:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/14a93d6a-e1bc-4b83-b2c6-5315555c0478.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Exporting a single configuration item</h1>
                </header>
            
            <article>
                
<p>Both Drush and Console provide their own mechanisms for exporting a single configuration entity:</p>
<ul>
<li><strong>Drush</strong>: <kbd>config-get [name]</kbd></li>
<li><strong>Console</strong>: <kbd>config:debug [name]</kbd></li>
</ul>
<p>Drush will print the configuration's output to the terminal, whereas Console's default behavior is to write the output to the file disk. For example, the following commands will output the values from <kbd>system.site</kbd> in the YAML format:</p>
<pre><strong>$ drush config-get system.site 
$ drupal debug:config system.site </strong></pre>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/b90942f1-1639-4071-be6a-7c6831bcef3c.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using version control and command-line workflow</h1>
                </header>
            
            <article>
                
<p>A benefit of having the configuration exportable to YAML files is the fact that the configuration can be kept in version control. The Drupal site's <kbd>CONFIG_SYNC_DIRECTORY</kbd> directory can be committed to version control to ensure that it is transported across environments and properly updated. Deployment tools can then use Drush or Console to automatically import changes.</p>
<p>The <kbd>config-export</kbd> command provided by Drush provides the Git integration:</p>
<pre><strong>drush config-export --add </strong> </pre>
<p>Appending the <kbd>--add</kbd> option will run <kbd>git add -p</kbd> for an interactive staging of the changed configuration files:</p>
<pre><strong>drush config-export --commit --message="Updating configuration "</strong> </pre>
<p>The <kbd>--commit</kbd> and optional <kbd>--message</kbd> options will stage all configuration file changes and commit them with your message:</p>
<pre><strong>drush config-export --push --message="Updating configuration " </strong> </pre>
<p>Finally, you can also specify <kbd>--push</kbd> to make a commit and push it to the remote repository.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to <a href="099b7376-2149-4af8-9649-45445745f068.xhtml"><em>Chapter 13</em></a>, <em>The Drupal CLI</em></li>
<li><span>Refer to</span> Drush at <a href="http://docs.drush.org/en/master/"><span class="URLPACKT">http://docs.drush.org/en/master/</span></a></li>
<li><span>Refer to</span> Drupal Console at <a href="http://www.drupalconsole.com/"><span class="URLPACKT">http://www.drupalconsole.com/</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating and installing new module configurations</h1>
                </header>
            
            <article>
                
<p>Modules in Drupal 8 provide configuration YAML files inside their <kbd>config/install</kbd> directory. A consequence of the site controlling configuration is that a new configuration in a module's <kbd>config/install</kbd> directory is not automatically installed. Module developers must write update functions, which will import the new configuration as it is added. While this is a practice contributed modules should follow, this process can be cumbersome for private projects.</p>
<p>Luckily, the Drupal community has come up with a solution that provides a configuration management flow that allows updating of a module's provided default configuration. The module <strong>Configuration Update Manager</strong> allows you to import a new configuration from a module or revert it to the original configuration if modified. In fact, the module is a dependency for the Features module discussed in <span class="ChapterrefPACKT"><a href="a634af62-2148-4382-9121-b8500df169ed.xhtml"><em>Chapter 4</em></a>, <em>Extending Drupal</em></span>.</p>
<p>In this recipe, we will use Configuration Update Manager to review configuration differences to a module and revert the modified configuration.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Add the Configuration Update Manager project to your Drupal installation using the following Composer command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ cd /path/to/drupal8</strong><br/><strong>$ composer require drupal/config_update</strong></pre>
<ol start="2">
<li>Go to the <span class="packt_screen">Extend</span> page and install the <span class="packt_screen">Configuration Update Reports</span> module, the user interface for Configuration Update Manager:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/381187b7-b0a5-4c7c-ad35-1a7192ea4995.png"/></div>
<ol start="3">
<li>To visit the configuration reports, go to <span class="packt_screen">Configuration</span> in the toolbar under the <span class="packt_screen">Development</span> section and click on <span class="packt_screen">Configuration synchronization</span>.</li>
<li>Go to the <span class="packt_screen">Updates Report</span> tab. This provides an overview of configuration reports to generate: by configuration type, module, theme, and profile.</li>
<li>Review the System module's configuration. Select the <span class="packt_screen">System</span> module from the module's drop-down button.</li>
</ol>
<p> </p>
<ol start="6">
<li>For the <kbd>system.site</kbd> row, click on the <span class="packt_screen">Show differences</span> button link. This will review a difference report between the default configuration and the current site configuration:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/dfb7febe-10d4-49f1-b61f-d328ea3b3417.png"/></div>
<ol start="7">
<li>Click on the <span class="packt_screen">Back to 'Updates report' page</span> to go back to the main report so that the configuration can be reverted.</li>
<li>Expand the drop-down button so that you can click on <span class="packt_screen">Revert to source</span>:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/2934becd-eeac-465a-b36d-2040a717433a.png"/></div>
<ol start="9">
<li>Click on <span class="packt_screen">Revert</span> on the confirmation form to finish the operation.</li>
<li>The configuration is now reverted to its original installation.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The Configuration Update Manager provides two modules: <strong>Configuration Update Base</strong> and <strong>Configuration Update Reports</strong>. The base module provides an underlying API for listing a configuration, reverting a configuration, and running difference checks with results. It extends Drupal core's configuration operations. The reports module provides a user interface on top of the base module. The Features module uses the base module to provide difference review and automatic reverting of a configuration.</p>
<p>When reverting a configuration, the raw values are collected and then used to overwrite what currently exists in the system. The reports also allow importing a new configuration added to a module.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are other contributed projects and methods for handling a configuration within modules.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Configuration Development module</h1>
                </header>
            
            <article>
                
<p>For module developers, there is the Configuration Development module. The Configuration Development module provides a command-line method for importing and exporting a configuration. This is useful for contributed module developers. It eases the exporting and update of a configuration intended for the <kbd>config/install</kbd> directory.</p>
<p>The module looks for a <kbd>config_devel</kbd> entry in the module's <kbd>info.yml</kbd> file. An example is taken from the Commerce Store submodule from Drupal Commerce module:</p>
<pre>config_devel: 
  install: 
    - commerce_store.commerce_store_type.online 
    - commerce_store.settings 
    - core.entity_view_display.commerce_store.online.default 
    - views.view.commerce_stores 
    - system.action.commerce_delete_store_action 
 </pre>
<p>Using Drush, commands provided by the Configuration Development can then be used to export and import the data. The following command will export the listed configuration to the <kbd>config/install</kbd> directory:</p>
<pre><strong>$ drush config-devel-export commerce_store</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to Configuration Update Manager project page at <a href="https://www.drupal.org/project/config_update"><span class="URLPACKT">https://www.drupal.org/project/config_update</span></a></li>
<li><span>Refer to</span> Configuration development, a command-line based alternative at <a href="https://www.drupal.org/project/config_devel"><span class="URLPACKT">https://www.drupal.org/project/config_devel</span></a></li>
</ul>


            </article>

            
        </section>
    </body></html>