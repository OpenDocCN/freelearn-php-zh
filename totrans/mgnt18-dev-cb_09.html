<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Creating a Shipping Module"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Creating a Shipping Module</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Initializing module configurations</li><li class="listitem" style="list-style-type: disc">Writing an adapter model</li><li class="listitem" style="list-style-type: disc">Extending the shipping method features</li><li class="listitem" style="list-style-type: disc">Adding the module in the frontend</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec66"/>Introduction</h1></div></div></div><p>Shipping ordered products to customers is one of the key parts of the e-commerce flow. In most cases, a shop owner has a contract with a shipping handler where everyone has their own business rules.</p><p>In a standard Magento, the<a id="id448" class="indexterm"/> following shipping handlers are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">DHL</li><li class="listitem" style="list-style-type: disc">FedEx</li><li class="listitem" style="list-style-type: disc">UPS</li><li class="listitem" style="list-style-type: disc">USPS</li></ul></div><p>If your handler is not on the list, have a look if there is a module available at Magento Connect. If not, you can configure a standard shipping method or you can create your own, which we will do in this chapter.</p></div></div>
<div class="section" title="Initializing module configurations"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec67"/>Initializing module configurations</h1></div></div></div><p>In <a class="link" href="ch04.html" title="Chapter 4. Creating a Module">Chapter 4</a>, <span class="emphasis"><em>Creating a Module</em></span>, we learned how we can create a custom module. In this recipe, we will create the necessary files <a id="id449" class="indexterm"/>for a shipping module, which we will extend with more features using the recipes of this chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec171"/>Getting ready</h2></div></div></div><p>Open your code editor with the Magento project. Also, get access to the backend where we will check some things.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec172"/>How to do it...</h2></div></div></div><p>The following steps describe how we<a id="id450" class="indexterm"/> can create the configuration for a shipping module:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the following <a id="id451" class="indexterm"/>folders:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Shipme/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Shipme/etc/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Shipme/Model/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Shipme/Model/Carrier</code></li></ul></div></li><li class="listitem">Create the module file named <code class="literal">Packt_Shipme.xml</code> in the folder <code class="literal">app/etc/modules</code> with the following content:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;config&gt;
  &lt;modules&gt;
    &lt;Packt_Shipme&gt;
      &lt;active&gt;true&lt;/active&gt;
      &lt;codePool&gt;local&lt;/codePool&gt;
      &lt;depends&gt;
        &lt;Mage_Shipping /&gt;
      &lt;/depends&gt;
    &lt;/Packt_Shipme&gt;
  &lt;/modules&gt;
&lt;/config&gt;</pre></div></li><li class="listitem">Create a <code class="literal">config.xml</code> file in the folder <code class="literal">app/code/local/Packt/Shipme/etc/</code> with the following content:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config&gt;
    
  &lt;modules&gt;
    &lt;Packt_Shipme&gt;
      &lt;version&gt;0.0.1&lt;/version&gt;
    &lt;/Packt_Shipme&gt;
  &lt;/modules&gt;
    
  &lt;global&gt;
    &lt;models&gt;  
      &lt;shipme&gt;
        &lt;class&gt;Packt_Shipme_Model&lt;/class&gt;
      &lt;/shipme&gt;
    &lt;/models&gt;
  &lt;/global&gt;
    
  &lt;default&gt;
    &lt;carriers&gt;
      &lt;shipme&gt;
        &lt;active&gt;1&lt;/active&gt;
        &lt;model&gt;shipme/carrier_shipme&lt;/model&gt;
        &lt;title&gt;Shipme shipping&lt;/title&gt;
                
        &lt;express_enabled&gt;1&lt;/express_enabled&gt;
        &lt;express_title&gt;Express delivery&lt;/express_title&gt;
        &lt;express_price&gt;4&lt;/express_price&gt;
                
        &lt;business_enabled&gt;1&lt;/business_enabled&gt;
        &lt;business_title&gt;Business delivery&lt;/business_title&gt;
        &lt;business_price&gt;5&lt;/business_price&gt;
      &lt;/shipme&gt;
    &lt;/carriers&gt;
  &lt;/default&gt;
    
&lt;/config&gt;</pre></div></li><li class="listitem">Clear the cache and navigate in the backend to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Advanced</strong></span> | <span class="strong"><strong>Disable Modules Output</strong></span>. Observe that the <code class="literal">Packt_Shipme</code> module is on the list.</li><li class="listitem">At this point, the module <a id="id452" class="indexterm"/>is initialized and working. Now, we have to create a <code class="literal">system.xml</code> file where we will put the configuration<a id="id453" class="indexterm"/> parameters for our shipping module. Create the file <code class="literal">app/code/local/Packt/Shipme/etc/system.xml</code>.</li><li class="listitem">In this file, we will create the configuration parameters for our shipping module. When you paste the following code in the file, you will create an extra group in the shipping method's configuration. In this group, we can set the settings for the new <a id="id454" class="indexterm"/>shipping method:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config&gt;
  &lt;sections&gt;
    &lt;carriers&gt;
      &lt;groups&gt;
        &lt;shipme translate="label" module="shipping"&gt;
          &lt;label&gt;Shipme&lt;/label&gt;
          &lt;sort_order&gt;15&lt;/sort_order&gt;
          &lt;show_in_default&gt;1&lt;/show_in_default&gt;
          &lt;show_in_website&gt;1&lt;/show_in_website&gt;
          &lt;show_in_store&gt;1&lt;/show_in_store&gt;
          &lt;fields&gt;
            &lt;!-- Define configuration fields below --&gt;
                        
            &lt;active translate="label"&gt;
              &lt;label&gt;Enabled&lt;/label&gt;
              &lt;frontend_type&gt;select&lt;/frontend_type&gt;
              &lt;source_model&gt;adminhtml/
              system_config_source_yesno&lt;/source_model&gt;
              &lt;sort_order&gt;10&lt;/sort_order&gt;
              &lt;show_in_default&gt;1&lt;/show_in_default&gt;
              &lt;show_in_website&gt;1&lt;/show_in_website&gt;
              &lt;show_in_store&gt;1&lt;/show_in_store&gt;
            &lt;/active&gt;
            
            &lt;title translate="label"&gt;
              &lt;label&gt;Title&lt;/label&gt;
              &lt;frontend_type&gt;text&lt;/frontend_type&gt;
              &lt;sort_order&gt;20&lt;/sort_order&gt;
              &lt;show_in_default&gt;1&lt;/show_in_default&gt;
              &lt;show_in_website&gt;1&lt;/show_in_website&gt;
              &lt;show_in_store&gt;1&lt;/show_in_store&gt;
            &lt;/title&gt;
                        
          &lt;/fields&gt;
        &lt;/shipme&gt;
      &lt;/groups&gt;
    &lt;/carriers&gt;
  &lt;/sections&gt;
&lt;/config&gt;</pre></div></li><li class="listitem">Clear the cache and navigate in the backend to the shipping method configuration page. To do that, <a id="id455" class="indexterm"/>navigate to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Sales</strong></span> | <span class="strong"><strong>Shipping methods</strong></span>. You will see that an extra<a id="id456" class="indexterm"/> group is added as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_09_01.jpg" alt="How to do it..."/></div></li><li class="listitem">You will see that there is a new shipping method called <span class="strong"><strong>Shipme</strong></span>. We will extend this configuration <a id="id457" class="indexterm"/>with some values. Add the following code under the <code class="literal">&lt;fields&gt;</code> tag of the module:<div class="informalexample"><pre class="programlisting">&lt;active translate="label"&gt;
  &lt;label&gt;Enabled&lt;/label&gt;
  &lt;frontend_type&gt;select&lt;/frontend_type&gt;
  &lt;source_model&gt;adminhtml/system_config_source_yesno&lt;/source_model&gt;
  &lt;sort_order&gt;10&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/active&gt;

&lt;title translate="label"&gt;
  &lt;label&gt;Title&lt;/label&gt;
  &lt;frontend_type&gt;text&lt;/frontend_type&gt;
  &lt;sort_order&gt;20&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/title&gt;

&lt;express_enabled translate="label"&gt;
  &lt;label&gt;Enable express&lt;/label&gt;
  &lt;frontend_type&gt;select&lt;/frontend_type&gt;
  &lt;source_model&gt;adminhtml/system_config_source_yesno&lt;/source_model&gt;
  &lt;sort_order&gt;30&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/express_enabled&gt;

&lt;express_title translate="label"&gt;
  &lt;label&gt;Title express&lt;/label&gt;
  &lt;frontend_type&gt;text&lt;/frontend_type&gt;
  &lt;sort_order&gt;40&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/express_title&gt;

&lt;express_price translate="label"&gt;
  &lt;label&gt;Price express&lt;/label&gt;
  &lt;frontend_type&gt;text&lt;/frontend_type&gt;
  &lt;sort_order&gt;50&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/express_price&gt;

&lt;business_enabled translate="label"&gt;
  &lt;label&gt;Enable business&lt;/label&gt;
  &lt;frontend_type&gt;select&lt;/frontend_type&gt;
  &lt;source_model&gt;adminhtml/system_config_source_yesno&lt;/source_model&gt;
  &lt;sort_order&gt;60&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/business_enabled&gt;

&lt;business_title translate="label"&gt;
  &lt;label&gt;Title business&lt;/label&gt;
  &lt;frontend_type&gt;text&lt;/frontend_type&gt;
  &lt;sort_order&gt;70&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/business_title&gt;

&lt;business_price translate="label"&gt;
  &lt;label&gt;Price business&lt;/label&gt;
  &lt;frontend_type&gt;text&lt;/frontend_type&gt;
  &lt;sort_order&gt;80&lt;/sort_order&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;1&lt;/show_in_store&gt;
&lt;/business_price&gt;</pre></div></li><li class="listitem">Clear the <a id="id458" class="indexterm"/>cache and reload the backend. You will now see the other configurations under the <span class="strong"><strong>Shipme – Express</strong></span> shipping <a id="id459" class="indexterm"/>method as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="graphics/3329OS_09_02.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec173"/>How it works...</h2></div></div></div><p>The first thing we have done is to create the necessary files to initialize the module. The following files are required to initialize a module:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">app/etc/modules/Packt_Shipme.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/code/local/Packt/Shipme/etc/config.xml</code></li></ul></div><p>In the first file, we will activate<a id="id460" class="indexterm"/> the module with the <code class="literal">&lt;active&gt;</code> tag. The <code class="literal">&lt;codePool&gt;</code> tag describes that the module is located in the local code pool, which represents the folder <code class="literal">app/code/local/</code>.</p><p>In this file, there is also the <code class="literal">&lt;depends&gt;</code> tag. First this will check if the <code class="literal">Mage_Shipping</code> module is installed or not. If not, Magento will throw an exception. If the module is available, the dependency will<a id="id461" class="indexterm"/> load this module after the <code class="literal">Mage_Shipping</code> module. This makes it possible to rewrite some values from the <code class="literal">Mage_Shipping</code> module.</p><p>In the second file, <code class="literal">config.xml</code>, we configured all the stuff that we will need in this module. These are the following things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The version number (<code class="literal">0.0.1</code>)</li><li class="listitem" style="list-style-type: disc">The models</li><li class="listitem" style="list-style-type: disc">Some default values for the configuration values</li></ul></div><p>The last thing we did was create a <code class="literal">system.xml</code> file so that we can create a custom configuration for the shipping module.</p><p>The configuration in the <code class="literal">system.xml</code> file adds some extra values to the shipping method configuration, which is available in the backend under the menu <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Sales</strong></span> | <span class="strong"><strong>Shipping methods</strong></span>.</p><p>In this module, we created a new shipping handler called <code class="literal">Shipme</code>. Within this handler, you can configure two shipping options:<a id="id462" class="indexterm"/> <span class="strong"><strong>express</strong></span> and <a id="id463" class="indexterm"/>
<span class="strong"><strong>business</strong></span>. In the <code class="literal">system.xml</code> file, we created the fields to configure the visibility, name, and price of the options.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec174"/>See also</h2></div></div></div><p>In this recipe, we used the <code class="literal">system.xml</code> file of the module to create the configuration values. You can find information about this in the <span class="emphasis"><em>Extending the system configuration</em></span> recipe from <a class="link" href="ch07.html" title="Chapter 7. Magento Backend">Chapter 7</a>, <span class="emphasis"><em>Magento Backend</em></span>.</p></div></div>
<div class="section" title="Writing an adapter model"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec68"/>Writing an adapter model</h1></div></div></div><p>A new shipping module is initialized in the previous recipe. What we did in the previous recipe was a preparation to continue with the business part we will see in this recipe. We will add a model with the business logic for the shipping method. The model is called an <span class="strong"><strong>adapter</strong></span> class because Magento <a id="id464" class="indexterm"/>requires an adapter class for each shipping method. This class will extend the <code class="literal">Mage_Shipping_Model_Carrier_Abstract</code> class.</p><p>This class will be used for the following things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Make the shipping<a id="id465" class="indexterm"/> method available</li><li class="listitem" style="list-style-type: disc">Calculate the shipping costs</li><li class="listitem" style="list-style-type: disc">Set the title in the frontend of the shipping methods</li></ul></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec175"/>How to do it...</h2></div></div></div><p>Perform the following steps to create the adapter<a id="id466" class="indexterm"/> class for the shipping method:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the folder <code class="literal">app/code/local/Packt/Shipme/Model/Carrier</code> if it doesn't already exist.</li><li class="listitem">In this folder, create a file<a id="id467" class="indexterm"/> named <code class="literal">Shipme.php</code> and add the following content to it:<div class="informalexample"><pre class="programlisting">&lt;?php
class Packt_Shipme_Model_Carrier_Shipme 
  extends Mage_Shipping_Model_Carrier_Abstract
  implements Mage_Shipping_Model_Carrier_Interface
{
  protected $_code = 'shipme';
  
  public function collectRates
  (Mage_Shipping_Model_Rate_Request $request)
  {
    $result = Mage::getModel('shipping/rate_result');
        
    //Check if express method is enabled
    if ($this-&gt;getConfigData('express_enabled'))
    {
      $method = Mage::getModel
      ('shipping/rate_result_method');
      $method-&gt;setCarrier($this-&gt;_code);
      $method-&gt;setCarrierTitle
      ($this-&gt;getConfigData('title'));
            
      $method-&gt;setMethod('express');
      $method-&gt;setMethodTitle
      ($this-&gt;getConfigData('express_title'));
            
      $method-&gt;setCost
      ($this-&gt;getConfigData('express_price'));
      $method-&gt;setPrice
      ($this-&gt;getConfigData('express_price'));
            
      $result-&gt;append($method);
    }
        
    //Check if business method is enabled
    if ($this-&gt;getConfigData('business_enabled'))
    {
      $method = Mage::getModel
      ('shipping/rate_result_method');
      $method-&gt;setCarrier($this-&gt;_code);
      $method-&gt;setCarrierTitle
      ($this-&gt;getConfigData('title'));
      
      $method-&gt;setMethod('business');
      $method-&gt;setMethodTitle
      ($this-&gt;getConfigData('business_title'));
            
      $method-&gt;setCost
      ($this-&gt;getConfigData('business_price'));
      $method-&gt;setPrice
      ($this-&gt;getConfigData('business_price'));
            
      $result-&gt;append($method);
    }
        
    return $result;
  }
    
  public function isActive()
  {
    $active = $this-&gt;getConfigData('active');
    return $active==1 || $active=='true';
  }
    
  public function getAllowedMethods()
  {
    return array('shipme'=&gt;$this-&gt;getConfigData('name'));
  }
}</pre></div></li><li class="listitem">Save the file and clear the cache; your adapter model has now created.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec176"/>How it works...</h2></div></div></div><p>The previously created class handles all the business logic that is needed for the shipping method. Because this adapter class is an<a id="id468" class="indexterm"/> extension of the <code class="literal">Mage_Shipping_Model_Carrier_Abstract</code> class<a id="id469" class="indexterm"/>, we can overwrite some methods to customize the business logic of the standard.</p><p>The first method we overwrite is the <code class="literal">isAvailable()</code> function<a id="id470" class="indexterm"/>. In this function, we have to return <code class="literal">true</code> or <code class="literal">false</code> to say that the module is active. In our code, we will activate the module based on the<a id="id471" class="indexterm"/> system configuration field <code class="literal">active</code>.</p><p>The second method is the<a id="id472" class="indexterm"/> <code class="literal">collectRates()</code> function. This function is used to set the right parameters for every shipping method. For every shipping method, we can set the title and price.</p><p>The class implements the interface <code class="literal">Mage_Shipping_Model_Carrier_Interface</code>. In this interface, two functions are declared: the<a id="id473" class="indexterm"/> <code class="literal">isTrackingAvailable()</code> and <a id="id474" class="indexterm"/>
<code class="literal">getAllowedMethods()</code> functions.</p><p>We created the function <code class="literal">getAllowedMethods()</code> in the adapter class. The <code class="literal">isTrackingAvailable()</code> function is declared in the parent class <code class="literal">Mage_Shipping_Model_Carrier_Abstract</code>.</p><p>We configured two options under the <span class="strong"><strong>Shipme</strong></span> shipping method. These options are called <span class="strong"><strong>Express delivery</strong></span> and <span class="strong"><strong>Business delivery</strong></span>. We will check if they are enabled in the configuration and set the configured title and price for each option.</p><p>The last thing to do is return the right values. We have to return an instance of the class <code class="literal">Mage_Shipping_Model_Rate_Result</code>. We created an empty instance of the class, where we will append the methods to when they are available.</p><p>To add a method, we have to use the function <code class="literal">append($method)</code>. This function requires an instance of the class <code class="literal">Mage_Shipping_Model_Rate_Result_Method</code>
<a id="id475" class="indexterm"/> that we created in the two <code class="literal">if</code> statements.</p></div></div>
<div class="section" title="Extending the shipping method features"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec69"/>Extending the shipping method features</h1></div></div></div><p>When all the files are installed, we can add more features to the shipping method. In this recipe, we will add a country <a id="id476" class="indexterm"/>configuration and we will enable tracking codes for the shipping method.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec177"/>How to do it...</h2></div></div></div><p>Perform the following steps to tracking codes and country-specific shipping:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the adapter file <code class="literal">app/code/local/Packt/Shipme/Model/Carrier/Shipme.php</code>.</li><li class="listitem">Add the following function in this file to enable tracking codes:<div class="informalexample"><pre class="programlisting">public function isTrackingAvailable() 
{
  return true;
}</pre></div><p>Tracking codes are now enabled for the <code class="literal">Shipme</code> shipping methods.</p></li><li class="listitem">To enable country-specific shipping, we have to add some configuration fields in the <code class="literal">system.xml</code> file of the module. Add the following code as the child of the <code class="literal">&lt;fields&gt;</code> tag:<div class="informalexample"><pre class="programlisting">&lt;sallowspecific translate="label"&gt;
  &lt;label&gt;Ship to Applicable Countries&lt;/label&gt;
  &lt;frontend_type&gt;select&lt;/frontend_type&gt;
  &lt;sort_order&gt;90&lt;/sort_order&gt;
  &lt;frontend_class&gt;shipping-applicable-country&lt;/frontend_class&gt;
  &lt;source_model&gt;adminhtml/system_config_source_shipping
  _allspecificcountries&lt;/source_model&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;0&lt;/show_in_store&gt;
&lt;/sallowspecific&gt;

&lt;specificcountry translate="label"&gt;
  &lt;label&gt;Ship to Specific Countries&lt;/label&gt;
  &lt;frontend_type&gt;multiselect&lt;/frontend_type&gt;
  &lt;sort_order&gt;100&lt;/sort_order&gt;
  &lt;source_model&gt;adminhtml/system_config_source_country
  &lt;/source_model&gt;
  &lt;show_in_default&gt;1&lt;/show_in_default&gt;
  &lt;show_in_website&gt;1&lt;/show_in_website&gt;
  &lt;show_in_store&gt;0&lt;/show_in_store&gt;
  &lt;can_be_empty&gt;1&lt;/can_be_empty&gt;
&lt;/specificcountry&gt;</pre></div></li><li class="listitem">Clear the cache and open the configuration page of the shipping method. You will see that there are<a id="id477" class="indexterm"/> two new configuration options. When you change <span class="strong"><strong>Ship to Applicable Countries</strong></span> to <span class="strong"><strong>Specific Countries</strong></span>, you can select multiple countries as seen in the following screenshot:</li></ol></div><div class="mediaobject"><img src="graphics/3329OS_09_03.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec178"/>How it works...</h2></div></div></div><p>The first thing we did was enable the possibility to create tracking codes for the <code class="literal">Shipme</code> shipping method<a id="id478" class="indexterm"/>. We overwrote the<a id="id479" class="indexterm"/> <code class="literal">isTrackingAvailable()</code> function, which returns the standard <code class="literal">false</code>. By returning <code class="literal">true</code>, we enable the tracking codes. </p><p>The second thing we did was enable country-specific shipping. We configured two fields with a standard naming convention. When we enable the configuration in the backend, we can only use the shipping method when the shipping address is in one of the selected countries.</p></div></div>
<div class="section" title="Adding the module in the frontend"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec70"/>Adding the module in the frontend</h1></div></div></div><p>In this recipe, we will test that the shipping <a id="id480" class="indexterm"/>method appears in the frontend. <a id="id481" class="indexterm"/>We prepared the code and configuration in the previous recipes to make this possible.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec179"/>How to do it...</h2></div></div></div><p>In this recipe, we will check the configuration and place a test order with the new shipping method:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the admin panel.</li><li class="listitem">Navigate to the shipping methods page by going to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Sales</strong></span> | <span class="strong"><strong>Shipping methods</strong></span>.</li><li class="listitem">Check that all the values are correct for the <a id="id482" class="indexterm"/><span class="strong"><strong>Shipme – Express</strong></span> method. Also make sure it is enabled.</li><li class="listitem">Save the configuration.</li><li class="listitem">Go to the frontend, add a product to the shopping cart, and checkout.</li><li class="listitem">Fill in the right data for the billing and shipping steps.</li><li class="listitem">In the shipping method step, new methods will appear as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3329OS_09_04.jpg" alt="How to do it..."/></div></li><li class="listitem">Select a method from the list and click on the <span class="strong"><strong>Continue</strong></span> button.</li><li class="listitem">In the payment method step, choose the <a id="id483" class="indexterm"/><span class="strong"><strong>Check Money Order</strong></span> method.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip36"/>Tip</h3><p>If you don't see the <span class="strong"><strong>Check Money Order</strong></span> payment method, you have to enable it in the system configuration.</p></div></div></li><li class="listitem">Click <span class="strong"><strong>Continue</strong></span> and place the order. You will see the success page.</li><li class="listitem">In the backend, go to <span class="strong"><strong>Sales</strong></span> | <span class="strong"><strong>Orders</strong></span> and click on the latest order.</li><li class="listitem">To complete the order,<a id="id484" class="indexterm"/> we have to create an invoice for it to confirm that the order is paid. When you click on the <span class="strong"><strong>Invoice</strong></span> button, you <a id="id485" class="indexterm"/>will be redirected to the invoice form where you can submit your invoice.</li><li class="listitem">When the invoice is saved, you will see that the status of the order has changed to <span class="strong"><strong>Processing</strong></span>. When the status is <span class="strong"><strong>Processing</strong></span>, you can click on the <span class="strong"><strong>Ship</strong></span> button to create the shipment. You will see the following screen:<div class="mediaobject"><img src="graphics/3329OS_09_05.jpg" alt="How to do it..."/></div></li><li class="listitem">When you click on the <a id="id486" class="indexterm"/><span class="strong"><strong>Add Tracking Number</strong></span> button, choose the <span class="strong"><strong>Shipme shipping </strong></span>option from<a id="id487" class="indexterm"/> the drop-down and add a<a id="id488" class="indexterm"/> tracking code such as <code class="literal">1234567890</code>:<div class="mediaobject"><img src="graphics/3329OS_09_06.jpg" alt="How to do it..."/></div></li><li class="listitem">When you click on the<a id="id489" class="indexterm"/> <span class="strong"><strong>Submit Shipment</strong></span> button, your shipment is processed and the status <a id="id490" class="indexterm"/>of the order will change to <span class="strong"><strong>Complete</strong></span>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec180"/>How it works...</h2></div></div></div><p>In this recipe, we tested<a id="id491" class="indexterm"/> the shipping method that we created in this chapter. We placed an order with the new shipping method to check that everything works the way we wanted it to.</p></div></div></body></html>