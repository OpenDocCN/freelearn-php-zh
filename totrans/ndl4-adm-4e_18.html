<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer465">
<h1 class="chapter-number" id="_idParaDest-336" lang="en-GB"><a id="_idTextAnchor337"/>18</h1>
<h1 id="_idParaDest-337" lang="en-GB"><a id="_idTextAnchor338"/>Integrating External Systems Using Moodle Web Services</h1>
<p lang="en-GB">In most organizations, the LMS is rarely an isolated, standalone system; instead, it is almost always part of an institution-wide infrastructure containing several best-of-breed components. Web services facilitate exchange and communication among these systems and Moodle is no exception. At the time of writing, Moodle ships with almost 700 web service functions, a number that is growing with <span class="No-Break" lang="">every release.</span></p>
<p lang="en-GB">After providing a brief overview of web services and giving some application examples, we will learn about the basic concepts of Moodle web services. Next, we will configure the generic Moodle web services functionality required for different setups. Then, we will learn how to set up the Moodle web service for another application to control Moodle. Lastly, we will learn how to set up the Moodle web service for a user as <span class="No-Break" lang="">the client.</span></p>
<p lang="en-GB">We will be covering the following topics in <span class="No-Break" lang="">this chapter:</span></p>
<ul>
<li lang="en-GB">Understanding Moodle <span class="No-Break" lang="">web services</span></li>
<li lang="en-GB">Configuring Moodle <span class="No-Break" lang="">web services</span></li>
<li lang="en-GB">Enabling web services for <span class="No-Break" lang="">external systems</span></li>
<li lang="en-GB">Enabling web services <span class="No-Break" lang="">for users</span></li>
</ul>
<p lang="en-GB">We will not cover any programming aspects of web services, as this is not an administrative task. You will find good documentation about the topic for users and developers <span class="No-Break" lang="">at </span><a href="http://docs.moodle.org/en/Web_Services"><span class="No-Break" lang="">docs.moodle.org/en/Web_Services</span></a><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">By the end of this chapter, you will know what web services are and how they are configured for external systems <span class="No-Break" lang="">and users.</span></p>
<h1 id="_idParaDest-338" lang="en-GB">Understanding <a id="_idTextAnchor339"/>Moodle web services</h1>
<p lang="en-GB">This section will familiarize you<a id="_idIndexMarker1653"/> with web services, how they work, and when to <span class="No-Break" lang="">use them.</span></p>
<p lang="en-GB">It has always been possible to extend Moodle via code (PHP and JavaScript). Due to Moodle’s open source code base, there is no limitation on what code a developer can modify or extend. As an administrator, this was not a satisfactory situation, as you have no control over what parts of Moodle are being changed as a result, and, equally importantly, what data is being accessed <span class="No-Break" lang="">or altered.</span></p>
<p lang="en-GB">Moodle has various APIs that provide abstract layers for certain functionalities. Examples are the Privacy API, Repository API, and File API. These are great for programmers, as they reduce the amount of code that has to be rewritten. In addition to these interfaces, Moodle provides us with an ever-growing number of <span class="No-Break" lang="">web services.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Web services enable other systems to perform operations inside Moodle, and <span class="No-Break" lang="">vice versa.</span></p>
<p lang="en-GB">Why would we want this? Well, there are four scenarios we can <span class="No-Break" lang="">think of:</span></p>
<ul>
<li lang="en-GB">Other systems in your organization – for instance, the HR system – have to trigger specific actions in your LMS; for example, once new staff has been added to the system, an account must be created in Moodle, and enrolments in several courses should take place. Web services simplify this <span class="No-Break" lang="">process greatly.</span></li>
<li lang="en-GB">Certain information stored in Moodle might have to be transferred to external applications. Examples are course completions, grades, or issued certificates, which have to be recorded in a student information system. Again, web services are predestined for the transfer of such <span class="No-Break" lang="">sensitive data.</span></li>
<li lang="en-GB">The Moodle app we covered in <a href="B18779_11.xhtml#_idTextAnchor216"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 11</em></span></a>, <em class="italic" lang="">Enabling Mobile Learning</em>, uses web services internally; all communication and data exchange between a mobile device and the Moodle backend takes place via <span class="No-Break" lang="">web services.</span></li>
<li lang="en-GB">The community hub feature requires web services, which we will cover in <a href="B18779_19.xhtml#_idTextAnchor344"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 19</em></span></a>, <em class="italic" lang="">Setting Up </em><span class="No-Break" lang=""><em class="italic" lang="">Moodle Networking</em></span><span class="No-Break" lang="">.</span></li>
</ul>
<p lang="en-GB">Why should you, as an administrator, care about web services when they have been designed for developers? Well, that’s the other advantage of <a id="_idIndexMarker1654"/>web services. You can control which system can talk to your Moodle system and which features these systems are allowed to use. This way, you can manage who has access to your system and limit what they <span class="No-Break" lang="">can do.</span></p>
<p lang="en-GB">The following diagram illustrates a (very) simplistic overview of how Moodle interacts with external applications via <span class="No-Break" lang="">web services:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer453">
<img alt="Figure 18.1 – Moodle web services " height="812" src="image/Figure_18.01_B18779.jpg" width="1387"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.1 – Moodle web services</p>
<p lang="en-GB">Let’s go through this schema from left to right: many Moodle features are represented as <strong class="bold" lang="">functions</strong> – for <a id="_idIndexMarker1655"/>example, creating a user account or enrolling a user into a course. A <strong class="bold" lang="">service</strong> is a <a id="_idIndexMarker1656"/>set thereof plus the definition of which user(s) can access the selected functions. For instance, the Moodle app uses a built-in (that is, predefined) service granting all users access to Moodle. In contrast, a custom service might only allow access to a single <span class="No-Break" lang="">dedicated account.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">A service<a id="_idIndexMarker1657"/> is a set of functions. A service can be user-restricted, token-restricted, IP-restricted, <span class="No-Break" lang="">or time-restricted.</span></p>
<p lang="en-GB">External applications must authenticate with Moodle through the web service <strong class="bold" lang="">authentication</strong> plugin<a id="_idIndexMarker1658"/> for security. Communication from external apps can be unidirectional or bidirectional, which is implicitly determined by the functions of the service. The supported web service <strong class="bold" lang="">protocols</strong> are <a id="_idIndexMarker1659"/>SOAP, REST, <span class="No-Break" lang="">and XML-RPC.</span></p>
<p lang="en-GB">Web services return feedback on whether the calls or transactions have succeeded. For instance, if the creation of a user account has failed in Moodle for whatever reason, the HR system will be notified and can repeat the attempt after a predefined period. Most web services-based infrastructure requires <a id="_idIndexMarker1660"/>some <strong class="bold" lang="">middleware</strong> to facilitate queueing and <span class="No-Break" lang="">error handling.</span></p>
<p lang="en-GB">Now that you have some basic understanding of Moodle web services, it is time to configure protocols, services, <span class="No-Break" lang="">and functions.</span></p>
<h1 id="_idParaDest-339" lang="en-GB"><a id="_idTextAnchor340"/>Configuring Moodle web services</h1>
<p lang="en-GB">First, you <a id="_idIndexMarker1661"/>must activate web services via the <strong class="bold" lang="">Enable web services</strong> setting in <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">General</strong> | <strong class="bold" lang="">Advanced features</strong>. The setting is linked to the <strong class="bold" lang="">Enable web services for mobile devices</strong> parameter on the same page; the latter cannot be enabled without <span class="No-Break" lang="">the former.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Enabling web services is a potential security risk, as you grant Moodle access to outside users and systems. The mantra should always be “open up as few services and functions <span class="No-Break" lang="">as possible.”</span></p>
<p lang="en-GB">Second, you have to enable the <strong class="bold" lang="">Web services authentication</strong> plugin (<strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Plugins</strong> | <strong class="bold" lang="">Authentication</strong> | <strong class="bold" lang="">Manage authentication</strong>). No configuration is needed, as Moodle handles all handshake operations and <span class="No-Break" lang="">communication internally.</span></p>
<p lang="en-GB">Moodle supports<a id="_idIndexMarker1662"/> two types of external services that can connect via <span class="No-Break" lang="">web services:</span></p>
<ul>
<li lang="en-GB"><strong class="bold" lang="">Built-in services</strong>: These are preconfigured services where the set of supported functions cannot be modified. The <strong class="bold" lang="">Moodle mobile web service</strong> is part of Moodle and lets users of the app interact with Moodle. We covered the app’s configuration in <a href="B18779_11.xhtml#_idTextAnchor216"><span class="No-Break" lang=""><em class="italic" lang="">Chapter 11</em></span></a>, <em class="italic" lang="">Enabling Mobile Learning</em>. Third-party plugins might add further entries to the list of <span class="No-Break" lang="">built-in services.</span></li>
<li lang="en-GB"><strong class="bold" lang="">Custom services</strong>: These are user-defined services where you configure which functions can be utilized. We will focus on custom services in this chapter, allowing two types of entities to access Moodle: external systems and users as clients <span class="No-Break" lang="">with tokens.</span></li>
</ul>
<p lang="en-GB">When you navigate to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Web services</strong> | <strong class="bold" lang="">External services</strong>, you see the services for the two described service types. We have installed the <strong class="source-inline" lang="">mod_attendance</strong> plugin in our system, which installs a built-in service alongside the mentioned mobile web service. We have also created two custom services, one for testing purposes (which is disabled) and one to connect to our HR system, as shown in the <span class="No-Break" lang="">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer454">
<img alt="Figure 18.2 – Built-in and custom web services " height="843" src="image/Figure_18.02_B18779.jpg" width="1029"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.2 – Built-in and custom web services</p>
<p lang="en-GB">To configure<a id="_idIndexMarker1663"/> web services, it is best to go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Web services</strong> | <strong class="bold" lang="">Overview</strong>, which acts as a dashboard for setting up Moodle web services. Two checklists are shown, one to <strong class="bold" lang="">Allow an external system to control Moodle</strong> (dealt with first) and one for <strong class="bold" lang="">Users as clients with token</strong> (<span class="No-Break" lang="">seen shortly):</span></p>
<div>
<div class="IMG---Figure" id="_idContainer455">
<img alt="Figure 18.3 – Allowing an external system to control Moodle " height="1143" src="image/Figure_18.03_B18779.jpg" width="1214"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.3 – Allowing an external system to control Moodle</p>
<p lang="en-GB">We have<a id="_idIndexMarker1664"/> already enabled web services (step 1). Moodle supports three web service protocols – <strong class="bold" lang="">SOAP</strong>, <strong class="bold" lang="">REST</strong>, and <strong class="bold" lang="">XML-RPC</strong>. We won’t provide details on those standards; for more information, check out <a href="http://docs.moodle.org/dev/Creating_a_web_service_client">docs.moodle.org/dev/Creating_a_web_service_client</a>. At least one protocol must be enabled, which depends entirely on the external application, the protocols supported, and the developer’s preference. Clicking on the <strong class="bold" lang="">Enabled protocols</strong> link in the overview table when you go to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Web services</strong> |<strong class="bold" lang=""> Manage protocols</strong> will guide you to this screen. Enable a protocol by toggling the show/hide icon in the <strong class="bold" lang="">Enable</strong> column. Here, <strong class="bold" lang="">SOAP</strong> has been enabled, which is common in, but <a id="_idIndexMarker1665"/>not limited to, Microsoft-based environments, as shown in the <span class="No-Break" lang="">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer456">
<img alt="Figure 18.4 – Protocols for web services " height="861" src="image/Figure_18.04_B18779.jpg" width="1034"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.4 – Protocols for web services</p>
<p lang="en-GB">Technically, it is possible that more<a id="_idIndexMarker1666"/> web service protocols will be added in the future, for example, a Java- and .Net-compatible WSDL, but to date, this has <span class="No-Break" lang="">not happened.</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Depending on the protocol chosen, you might have to install the respective PHP extension – for <span class="No-Break" lang="">example, </span><span class="No-Break" lang=""><strong class="source-inline" lang="">php-soap</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">Now that we have enabled web services and at least one protocol, let’s cover the configuration of the two types of web <span class="No-Break" lang="">service accesses.</span></p>
<h1 id="_idParaDest-340" lang="en-GB"><a id="_idTextAnchor341"/>Enabling web services for external systems</h1>
<p lang="en-GB">An external system <a id="_idIndexMarker1667"/>is an application that accesses Moodle and its data in <a id="_idIndexMarker1668"/>one way or another. Eight steps have to be performed to complete the setup, which<a id="_idIndexMarker1669"/> follows the workflow described on the web services <span class="No-Break" lang="">overview screen:</span></p>
<ol>
<li lang="en-GB"><strong class="bold" lang="">Create a </strong><span class="No-Break" lang=""><strong class="bold" lang="">specific user</strong></span></li>
</ol>
<p lang="en-GB">Each application <a id="_idIndexMarker1670"/>should have a separate user account. This way, you can control the capabilities each external system will use. Our user is aptly <span class="No-Break" lang="">called </span><span class="No-Break" lang=""><em class="italic" lang="">webservice</em></span><span class="No-Break" lang="">.</span></p>
<ol>
<li lang="en-GB" value="2"><strong class="bold" lang="">Check </strong><span class="No-Break" lang=""><strong class="bold" lang="">user capability</strong></span></li>
</ol>
<p lang="en-GB">Depending <a id="_idIndexMarker1671"/>on the protocol you’ve selected, you must allow specific permissions for the user. You achieve this by creating a new role with any of the three capabilities, <strong class="source-inline" lang="">webservice/rest:use</strong>, <strong class="source-inline" lang="">webservice/soap:use</strong>, <span class="No-Break" lang="">or </span><span class="No-Break" lang=""><strong class="source-inline" lang="">webservice/xmlrpc:use</strong></span><span class="No-Break" lang="">.</span></p>
<p lang="en-GB">This role has to be assigned to the web service user(s) in the <span class="No-Break" lang=""><strong class="bold" lang="">System</strong></span><span class="No-Break" lang=""> context.</span></p>
<ol>
<li lang="en-GB" value="3"><strong class="bold" lang="">Select </strong><span class="No-Break" lang=""><strong class="bold" lang="">a service</strong></span></li>
</ol>
<p lang="en-GB">A service is a <a id="_idIndexMarker1672"/>defined interface that an external application can connect to, represented by a set of functions (see step 4). Selecting a service takes place at <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Web services</strong> | <strong class="bold" lang="">External service</strong>. You have to add a <span class="No-Break" lang="">custom service:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer457">
<img alt="Figure 18.5 – Web services: adding a custom service " height="837" src="image/Figure_18.05_B18779.jpg" width="686"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.5 – Web services: adding a custom service</p>
<p lang="en-GB">Each <a id="_idIndexMarker1673"/>external service must have a given <strong class="bold" lang="">Name</strong> and a unique <strong class="bold" lang="">Short name</strong> and should be <strong class="bold" lang="">Enabled</strong> once configured. A service has to be accessed via a token. The <strong class="bold" lang="">Authorized users only</strong> setting restricts this access to selected users. All users with the token permission can access the service if it <span class="No-Break" lang="">remains unchecked.</span></p>
<p lang="en-GB">You can also specify download and upload permission for the web service with <strong class="bold" lang="">Can download files</strong> or <strong class="bold" lang="">Can upload files</strong>. In our HR role, this would be useful if you also managed profile pictures via web services. You can further restrict access by specifying the required capabilities that users need <span class="No-Break" lang="">to have.</span></p>
<p lang="en-GB">Once you have saved the service, select the <strong class="bold" lang="">Add functions</strong> <span class="No-Break" lang="">link shown.</span></p>
<ol>
<li lang="en-GB" value="4"><span class="No-Break" lang=""><strong class="bold" lang="">Add functions</strong></span></li>
</ol>
<p lang="en-GB">At the time<a id="_idIndexMarker1674"/> of writing, Moodle provides almost 700(!) functions that can be accessed via web services, and even more in Moodle Workplace. The function(s) selected depend(s) on what tasks the external system has to perform and should be set up <a id="_idIndexMarker1675"/>in liaison with the developer in charge. Since we are connecting to an HR system, we will allow the following <span class="No-Break" lang="">user-related functions:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer458">
<img alt="Figure 18.6 – Web services – adding functions " height="760" src="image/Figure_18.06_B18779.jpg" width="1096"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.6 – Web services – adding functions</p>
<p lang="en-GB">Once you have added the selected functions, you will be shown the required capabilities that a user must have to access the service. Ensure these have been allowed in the role assigned to the web <span class="No-Break" lang="">services user.</span></p>
<ol>
<li lang="en-GB" value="5"><strong class="bold" lang="">Select a </strong><span class="No-Break" lang=""><strong class="bold" lang="">specific user</strong></span></li>
</ol>
<p lang="en-GB">If you <a id="_idIndexMarker1676"/>selected <strong class="bold" lang="">Authorized users only</strong> when creating the preceding service, you must select this user(s), which takes place at <strong class="bold" lang="">Site administration</strong> |<strong class="bold" lang=""> Server</strong> | <strong class="bold" lang="">Web services</strong> | <strong class="bold" lang="">External services</strong>, where you see a list of all the services that have been set up. Select the <strong class="bold" lang="">Authorized users</strong> link, which will guide you to the familiar user selection screen. Select the web services user you created in <span class="No-Break" lang="">step 1:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer459">
<img alt="Figure 18.7 – Web services – selecting users " height="918" src="image/Figure_18.07_B18779.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.7 – Web services – selecting users</p>
<p lang="en-GB">Moodle <a id="_idIndexMarker1677"/>will check whether the account has sufficient permissions to access the selected functions. If any capabilities are missing, they will be displayed under the user selection screen in the <strong class="bold" lang="">Change settings for the authorized users</strong> section. Ensure that you add the listed capabilities to your web service’s permissions. Clicking on a username will <a id="_idIndexMarker1678"/>allow you to restrict access to an IP address and set an <span class="No-Break" lang="">expiry date.</span></p>
<ol>
<li lang="en-GB" value="6"><strong class="bold" lang="">Create a token for </strong><span class="No-Break" lang=""><strong class="bold" lang="">a user</strong></span></li>
</ol>
<p lang="en-GB">Web services<a id="_idIndexMarker1679"/> use tokens for security. These are created for each user and can be added by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Web services</strong> | <strong class="bold" lang="">Manage tokens</strong>. To add a token, select a user (or multiple users), select the service to be accessed, and optionally specify an IP address (or range) and an expiry date, as shown in the <span class="No-Break" lang="">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer460">
<img alt="Figure 18.8 – Web services – creating a token " height="624" src="image/Figure_18.08_B18779.jpg" width="873"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.8 – Web services – creating a token</p>
<p lang="en-GB">Users can access and reset their web services token by going to <strong class="bold" lang="">Security keys</strong> in <strong class="bold" lang="">Preferences</strong> if they have the <span class="No-Break" lang=""><strong class="source-inline" lang="">moodle/webservice:createtoken</strong></span><span class="No-Break" lang=""> capability.</span></p>
<ol>
<li lang="en-GB" value="7"><strong class="bold" lang="">Enable developer </strong><span class="No-Break" lang=""><strong class="bold" lang="">documentation (optional)</strong></span></li>
</ol>
<p lang="en-GB">Moodle <a id="_idIndexMarker1680"/>can be instructed to generate documentation for developers for the selected functions in the selected protocol format. When you set up the protocols (<strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Server</strong> | <strong class="bold" lang="">Web services</strong> | <strong class="bold" lang="">Manage protocols</strong>), you must tick the <strong class="bold" lang="">Web services documentation</strong> option. Developers can <a id="_idIndexMarker1681"/>view the documentation as part of their <span class="No-Break" lang="">security keys:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer461">
<img alt="Figure 18.9 – Web services – security keys and API documentation " height="569" src="image/Figure_18.09_B18779.jpg" width="1208"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.9 – Web services – security keys and API documentation</p>
<ol>
<li lang="en-GB" value="8"><strong class="bold" lang="">Test </strong><span class="No-Break" lang=""><strong class="bold" lang="">the service</strong></span></li>
</ol>
<p lang="en-GB">Once a <a id="_idIndexMarker1682"/>web service is set up, functions have been selected, and users have been assigned, it is imperative that you test the service to ensure that it works and, more importantly, that the external system has only opened up the required functionality. Web services are tested by navigating to <strong class="bold" lang="">Site administration</strong> |<strong class="bold" lang=""> Development</strong> | <strong class="bold" lang="">Web service test client</strong>. Unfortunately, the test client only supports some hardcoded functions, not those you have configured. I quote from the Moodle Docs at <a href="http://docs.moodle.org/en/Web_services_test_client">docs.moodle.org/en/Web_services_test_client</a>: “<em class="italic" lang="">The test client is not clever! It lets you choose disabled/unavailable functions (however it behaves well and produces an error in these case). This is normal because clients are going to be bad sometimes so we needed to simulate a </em><span class="No-Break" lang=""><em class="italic" lang="">bad client!</em></span><span class="No-Break" lang="">”</span></p>
<p class="callout-heading" lang="en-GB">Important note</p>
<p class="callout" lang="en-GB">Be careful with executing functions via the test client, as they perform them as though they are executed <span class="No-Break" lang="">for real!</span></p>
<p lang="en-GB">First, you <a id="_idIndexMarker1683"/>have to select the <strong class="bold" lang="">Authentication method</strong> (<strong class="bold" lang="">simple</strong> for a username and password and <strong class="bold" lang="">token</strong> for a security key), <strong class="bold" lang="">Protocol</strong>, and <strong class="bold" lang="">Function</strong> settings to test. The screen that follows depends on which authentication method has been selected and which function has been chosen. Here, we used <strong class="bold" lang="">token</strong> and <strong class="bold" lang="">core_course_create_categories</strong> (you have to temporarily add the <strong class="source-inline" lang="">moodle/category:manage</strong> permission to your web service role for this <span class="No-Break" lang="">to work):</span></p>
<div>
<div class="IMG---Figure" id="_idContainer462">
<img alt="Figure 18.10 – Web services testing " height="594" src="image/Figure_18.10_B18779.jpg" width="1209"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.10 – Web services testing</p>
<p lang="en-GB">Once you have filled in the required values and executed the command, you will see a return value in the XML format. If you press the <strong class="bold" lang="">Execute</strong> button, your database will be modified, and <a id="_idIndexMarker1684"/>changes cannot be reverted without manual intervention at the database level. It is also a good practice to try out some functions the web service should not be able <span class="No-Break" lang="">to access:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer463">
<img alt="Figure 18.11 – Web services testing " height="775" src="image/Figure_18.11_B18779.jpg" width="1218"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.11 – Web services testing</p>
<p lang="en-GB">To receive a more meaningful message, change the <strong class="bold" lang="">Debug messages</strong> setting by going to <strong class="bold" lang="">Site administration</strong> | <strong class="bold" lang="">Development</strong> | <strong class="bold" lang="">Debugging</strong> and then to <strong class="bold" lang="">DEVELOPER</strong>. If the result shown contains a line containing a DEBUGINFO element, an error has occurred. Otherwise, you should check that the function performed what it was supposed to when executed. We executed the operation twice; the first run was successful – that is, the category was created. The second run wasn’t because the category <span class="No-Break" lang="">already existed.</span></p>
<p lang="en-GB">Now that we have covered how to configure web services for external applications, let us briefly look at its little brother – enabling token-based access <span class="No-Break" lang="">for users.</span></p>
<h1 id="_idParaDest-341" lang="en-GB"><a id="_idTextAnchor342"/>Enabling web services for users</h1>
<p lang="en-GB">It is <a id="_idIndexMarker1685"/>sometimes necessary for users to have to access web services directly instead of applications – for example, a developer who needs to execute test runs against the system. The process is a subset of steps already covered in the previous section and follows the <strong class="bold" lang="">Users as clients with token</strong> section on the web services <span class="No-Break" lang="">overview screen:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer464">
<img alt="Figure 18.12 – Web services for users as clients with tokens " height="1041" src="image/Figure_18.12_B18779.jpg" width="1207"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 18.12 – Web services for users as clients with tokens</p>
<p lang="en-GB">These steps should be familiar by now; there are only two minor deviations from the previous scenario when web services were allowed for external systems instead <span class="No-Break" lang="">of users.</span></p>
<p lang="en-GB">In step 3, the <strong class="bold" lang="">Authorized users</strong> option must be unchecked. In addition to the protocol use capabilities, the<a id="_idIndexMarker1686"/> users must have the <strong class="source-inline" lang="">moodle/webservice:createtoken</strong> capability set to allowed (see <span class="No-Break" lang="">step 5).</span></p>
<p lang="en-GB">To test the service (see step 6), log in as the user, obtain a security token for testing, and avoid using the simple authentication method in the web service <span class="No-Break" lang="">test client.</span></p>
<h1 id="_idParaDest-342" lang="en-GB"><a id="_idTextAnchor343"/>Summary</h1>
<p lang="en-GB">In this chapter, you learned the basics about web services and how they are configured from within Moodle. We covered the two main administrative tasks: setting up web services for external applications and enabling token-based web services <span class="No-Break" lang="">for users.</span></p>
<p lang="en-GB">All the processes covered in this chapter are identical in Moodle and Moodle Workplace; the only difference is that Moodle Workplace supports significantly more web <span class="No-Break" lang="">service functions.</span></p>
<p lang="en-GB">In the following chapter, we will cover another option for Moodle to communicate with other systems, namely via <span class="No-Break" lang="">Moodle networking.</span></p>
</div>
</div></body></html>