<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Starting with Yii2"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Starting with Yii2</h1></div></div></div><p>Yii2<a id="id0" class="indexterm"/> is a complete rewrite of the first version of one of the most famous PHP frameworks. It is a well-documented framework with a very active community.</p><p>Officially, we can find three types of support: a guide, for a complete navigation through framework topics <a id="id1" class="indexterm"/>at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/guide-index.html">http://www.yiiframework.com/doc-2.0/guide-index.html</a>, a reference to explore all classes that compose the framework at <a class="ulink" href="http://www.yiiframework.com/doc-2.0/index.html">http://www.yiiframework.com/doc-2.0/index.html</a>, and finally forum support at <a class="ulink" href="http://www.yiiframework.com/forum/">http://www.yiiframework.com/forum/</a>.</p><p>In this chapter, we will go through the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Requirements and tools</li><li class="listitem" style="list-style-type: disc">Installing Yii2 with Composer</li><li class="listitem" style="list-style-type: disc">Application structure</li><li class="listitem" style="list-style-type: disc">Application properties<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Common application components</li><li class="listitem" style="list-style-type: disc">Handling application events</li><li class="listitem" style="list-style-type: disc">Pattern MVC in Yii2</li></ul></div></li><li class="listitem" style="list-style-type: disc">Naming convention<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Configuring debug toolbar</li><li class="listitem" style="list-style-type: disc">Using logger</li><li class="listitem" style="list-style-type: disc">Example – hello world from scratch with the Yii basic template and bootstrap template</li></ul></div></li></ul></div><div class="section" title="Requirements and tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Requirements and tools</h1></div></div></div><p>The basic <a id="id2" class="indexterm"/>requirements for <a id="id3" class="indexterm"/>Yii2 are a web server (local or remote) and PHP v.5.4 (or newer). It is recommended to have a shell (or command line) access to the machine (local or remote) where we store the code, as there are scripts that it will be very beneficial to use in the development of complex applications. We can also develop the application locally and upload it to the web server when we wish to test it.</p><p>For remote hosting, there are multiple options. We can use a simple web hosting service (with PHP v.5.4 support) or we can opt for virtual or dedicated server hosting. Keep in mind that with the former option, if the server doesn't meet the PHP requirements, it can be difficult to change whatever is wrong.</p><p>Yii2 has <a id="id4" class="indexterm"/>a script, <code class="literal">requirements.php</code>, which checks whether our hosting meets <a id="id5" class="indexterm"/>the requirements to run Yii2 application.</p></div></div>
<div class="section" title="Installing Yii2 with Composer"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Installing Yii2 with Composer</h1></div></div></div><p>Composer<a id="id6" class="indexterm"/> is a tool for dependency management in PHP. Yii2 uses it to install itself and other vendors' modules (for example, bootstrap).</p><p>It is also possible<a id="id7" class="indexterm"/> to install Yii2 in the old way, by downloading the<a id="id8" class="indexterm"/> complete package and transferring it to the host, local or remote, where the framework will be installed. However, Composer will give us many benefits, like the ability to easily update the framework and ensure that all package dependencies are satisfied. Composer is de facto the new way to install and maintain projects, so I recommend using it from the start. If you are unsure about using Composer, it's worth mentioning that most users will need to learn two or three commands at most, so it's not a steep learning curve.</p><p>Yii2 has two available templates to start with: basic and advanced. We will start with the basic template, but we will also see in the next chapters how to use advanced templates.</p><p>So, let's look at how to install Yii2 with Composer. We need to access the folder through the console, where the web server's httpdocs point to and launch these commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>curl -s http://getcomposer.org/installer | php</strong></span>
<span class="strong"><strong>php composer.phar global require "fxp/composer-asset-plugin:1.0.0"</strong></span>
<span class="strong"><strong>php composer.phar create-project --prefer-dist yiisoft/yii2-app-basic basic</strong></span>
</pre></div><p>These commands are useful if we are in the Linux or Mac environment. On Windows, you need to download <code class="literal">Composer-Setup.exe</code> from Composer's official website and run it.</p><p>The first <a id="id9" class="indexterm"/>command gets the <a class="ulink" href="http://getcomposer.org/installer">http://getcomposer.org/installer</a> URL and passes it to PHP to create the <code class="literal">composer.phar</code> file.</p><p>The second command installs the Composer asset plugin, which allows us to manage bower and npm package dependencies through Composer.</p><p>The third and final<a id="id10" class="indexterm"/> command installs Yii2 in a directory named <code class="literal">basic</code>. If you <a id="id11" class="indexterm"/>want, you can choose a different directory name.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>During the installation, Composer may ask for our GitHub login credentials and this is normal because Composer needs to get enough API rate limit to retrieve the dependent package information from GitHub. If you don't have a GitHub account, this is the right moment to create a new one!</p></div></div><p>If we are using Windows, we need to <a id="id12" class="indexterm"/>download it from <a class="ulink" href="https://getcomposer.org">https://getcomposer.org</a> and run it. The last two commands will be the same.</p><p>We have installed Yii2!</p><p>To test it, point to <code class="literal">http://hostname/basic/web</code> and we should see the <span class="emphasis"><em>My Yii Application</em></span> page.</p></div>
<div class="section" title="Application structure"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Application structure</h1></div></div></div><p>Yii2's application <a id="id13" class="indexterm"/>structure is very clear, precise, and redundant (for advanced applications).</p><p>The contents of the <code class="literal">basic</code> folder should be as follows:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Folder names</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">assets</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id14" class="indexterm"/> includes the files (<code class="literal">.js</code> and <code class="literal">.css</code>) referenced in the web page and dependencies of the app.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">commands</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id15" class="indexterm"/>includes the controllers used from the command line.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">config</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id16" class="indexterm"/> includes the controllers used from web.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mail</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id17" class="indexterm"/> mail layout repository.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">models</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id18" class="indexterm"/> includes the models used in the whole application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">runtime</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id19" class="indexterm"/> is used from Yii2 to store runtime data as logs.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tests</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id20" class="indexterm"/>includes all the test's repositories (unit, functional, fixtures, and so on).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">vendor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id21" class="indexterm"/>includes the third-party module repositories managed by Composer.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">views</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id22" class="indexterm"/> contains PHP files, divided into folders that refer to controller names, used to render the main content of the page template. It is mainly called from the controller's actions to render the display output. A folder named layout contains<a id="id23" class="indexterm"/> the page template's PHP files.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">web</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is <a id="id24" class="indexterm"/>the entry point from web </p>
</td></tr></tbody></table></div><p>Open <code class="literal">web/index.php</code> to view content:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// comment out the following two lines when deployed to production
defined('YII_DEBUG') or define('YII_DEBUG', true);
defined('YII_ENV') or define('YII_ENV', 'dev');

require(__DIR__ . '/../vendor/autoload.php');
require(__DIR__ . '/../vendor/yiisoft/yii2/Yii.php');

$config = require(__DIR__ . '/../config/web.php');

(new yii\web\Application($config))-&gt;run();</pre></div><p>Here, the first two constant definitions are very important.</p><p>
<code class="literal">YII_DEBUG</code> defines whether you are in debug mode or not. If we set this, we will have more log information and will see the detail error call stack.</p><p>
<code class="literal">YII_ENV</code> defines the environment mode we are working in, and its default value is <code class="literal">prod</code>. The available values are <code class="literal">test</code>, <code class="literal">dev</code>, and <code class="literal">prod</code>. These values are used in configuration files to define, for example, a different DB connection (local database different from remote database) or other values, always in configuration files.</p><p>Since we are at the start of our project, it is recommended to set <code class="literal">YII_DEBUG</code> to <code class="literal">true</code>, in order to have more <a id="id25" class="indexterm"/>detailed information in case we make a mistake in our code, instead of the unhelpful, blank.</p><p>The following table contains a list of all <a id="id26" class="indexterm"/>Yii2's objects:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Objects</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Models, Views, and Controllers</p>
</td><td style="text-align: left" valign="top">
<p>These are the <a id="id27" class="indexterm"/>common objects to <a id="id28" class="indexterm"/>apply the MVC pattern<a id="id29" class="indexterm"/> to:</p>
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Models are data representation and manipulation, usually from the database</li><li class="listitem" style="list-style-type: disc">Views are used to present data to the end user</li><li class="listitem" style="list-style-type: disc">Controllers are objects that process requests and generate responses</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Components</p>
</td><td style="text-align: left" valign="top">
<p>These are<a id="id30" class="indexterm"/> objects that contain logic. The user can write his own components to create reusable functionalities.</p>
<p>For example, a component could be a currency converter object, which can be used at many instances in our application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Application Components</p>
</td><td style="text-align: left" valign="top">
<p>They are<a id="id31" class="indexterm"/> singletons that can be called at any point in the app. Singleton means an object instanced just one time in the entire application (so the object will always be the same).</p>
<p>The difference between Application Components and Components is that the first can have just one instance in the whole application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Widgets</p>
</td><td style="text-align: left" valign="top">
<p>These <a id="id32" class="indexterm"/>view reusable objects, containing both logic and rendering code. A widget could be, for example, a box displaying today's weather info.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Filters</p>
</td><td style="text-align: left" valign="top">
<p>These <a id="id33" class="indexterm"/>are objects that run before or after the execution of Controller actions. A filter can be used to change the format response output of the page, for example, from HTML to JSON.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Modules</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id34" class="indexterm"/> contains all the objects of an app, such as Models, Views, Controller, Components, and so on; we can consider them as subapp, containing reusable sections (for example, user management).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Extensions</p>
</td><td style="text-align: left" valign="top">
<p>Extensions<a id="id35" class="indexterm"/> are<a id="id36" class="indexterm"/> modules packaged, that we can easily manage using Composer.</p>
</td></tr></tbody></table></div></div>
<div class="section" title="Application properties"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Application properties</h1></div></div></div><p>A Yii2 application can be <a id="id37" class="indexterm"/>configured through several properties.</p><p>The properties that need to be configured in any application are listed in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Properties</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">id</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id38" class="indexterm"/> indicates a unique ID to distinguish this application from others. It is mainly used programmatically. An example of this property is <code class="literal">basic</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">basePath</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id39" class="indexterm"/>specifies the root directory of the application. This path is the starting point for all the other types of application objects, such as models, controllers, and views. An example of this property is <code class="literal">dirname(__DIR__)</code>.</p>
</td></tr></tbody></table></div><p>The other common properties are listed in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Properties</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">aliases</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id40" class="indexterm"/>indicates an alias name for path definitions. They are defined using a key/value array and they are very useful when we need to set a path as a constant that live in the whole application. We type an alias preceded by an <code class="literal">@</code> character. An example of this property is <code class="literal">'@fileupload' =&gt; 'path/to/files/uploaded'</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">bootstrap</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id41" class="indexterm"/>property allows you to configure an array of components to be run during the application bootstrap process. A common usage is to load the log or profile component, gii, or any other component. Be careful not to load too many components, otherwise the response performance of your pages may degrade. An example of this property is <code class="literal">'log'</code>, <code class="literal">'gii'</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">catchAll</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id42" class="indexterm"/>property captures every request and it is used in the maintenance mode of the site.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">components</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id43" class="indexterm"/>property points out a list of application components that you can use in the whole application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">language</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id44" class="indexterm"/>property specifies the language used to display the content. An example of this property is <code class="literal">'language' =&gt; 'en'</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">modules</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id45" class="indexterm"/>property points out a list of application modules that can be used in the application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id46" class="indexterm"/>property indicates the name of your app. An example of this property is <code class="literal">'name' =&gt; 'My App'</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">params</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id47" class="indexterm"/> property specifies an array of parameters, through key/value pairs. This is a container for global params, such as the administrator's e-mail address.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">timeZone</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id48" class="indexterm"/>property indicates the time zone that should be used in the application. An example of this property is <code class="literal">'timeZone' =&gt; 'Europe/Rome'</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">charset</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id49" class="indexterm"/>property points out the charset used in the application. The default value is <code class="literal">UTF-8</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">defaultRoute</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id50" class="indexterm"/>property contains a route to be used when a request does not a specify one. This property has different default values according to the environment we are using.</p>
<p>For web applications, this value will be <code class="literal">site</code>, so that <code class="literal">SiteController</code> could be used to handle these requests.</p>
<p>For console applications, this value will be <code class="literal">help</code>, so that <code class="literal">yii\console\controllers\HelpController</code> can be used invoking its index action that will display help information.</p>
</td></tr></tbody></table></div><div class="section" title="Common application components"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Common application components</h2></div></div></div><p>Here's a list of the most-used application components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">request</code>: This <a id="id51" class="indexterm"/>component handles all client requests and <a id="id52" class="indexterm"/>provides methods to easily get parameters from server global variables, such as <code class="literal">$_SERVER</code>, <code class="literal">$_POST</code>, <code class="literal">$_GET</code>, and <code class="literal">$_COOKIES</code>.<p>The default state has <code class="literal">enableCookieValidation</code> set to true, so you need to set <code class="literal">cookieValidationKey</code> parameter as shown in this example:</p><div class="informalexample"><pre class="programlisting">'request' =&gt; [
'cookieValidationKey' =&gt; 'hPpnJs7tvs0T4N2OGAY',
],</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">cache</code>: This <a id="id53" class="indexterm"/>component helps you handle cache data. Yii2 <a id="id54" class="indexterm"/>defaults to the <code class="literal">FileCache</code> instance for the cache, but we can also configure an <code class="literal">ApcCache</code>, <code class="literal">DbCache</code>, <code class="literal">MemCache</code>, and so on.<p>The following is a standard installation of Yii2:</p><div class="informalexample"><pre class="programlisting">'cache' =&gt; [                     
'class' =&gt; 'yii\caching\FileCache',
],</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">user</code>: This<a id="id55" class="indexterm"/> component deals with user authentication in the app. The <a id="id56" class="indexterm"/>most important parameter is the <code class="literal">identityClass</code> parameter, which defines the class that contains the user's model data, in order to have a specific method to log in or log out a user from the app.<p>Consider the following example:</p><div class="informalexample"><pre class="programlisting">'user' =&gt; [
'identityClass' =&gt; 'app\models\User',
         'enableAutoLogin' =&gt; true,
 ],</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">errorHandler</code>: This<a id="id57" class="indexterm"/> component provides <a id="id58" class="indexterm"/>functionalities to handle uncaught errors and exceptions. It can be configured by specifying the action to run.<p>Consider the following example:</p><div class="informalexample"><pre class="programlisting">'errorHandler' =&gt; [
'errorAction' =&gt; 'site/error',
],</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">mailer</code>: This<a id="id59" class="indexterm"/> component configures mailer connection <a id="id60" class="indexterm"/>parameters to the system that will send an e-mail. Usually, it is the same machine hosting our website, so the default values are probably correct.<p>Consider the following example:</p><div class="informalexample"><pre class="programlisting">'mailer' =&gt; [
  'class' =&gt; 'yii\swiftmailer\Mailer',
  // send all mails to a file by default. You have to set
  // 'useFileTransport' to false and configure a transport
     // for the mailer to send real emails.
     'useFileTransport' =&gt; true,
],</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">log</code>: This <a id="id61" class="indexterm"/>component is mainly used in the debug<a id="id62" class="indexterm"/> environment to log the app execution. We can set the debug level and destination.<p>Consider the following example:</p><div class="informalexample"><pre class="programlisting">'log' =&gt; [
           'traceLevel' =&gt; YII_DEBUG ? 3 : 0,
            'targets' =&gt; [
                [
                    'class' =&gt; 'yii\log\FileTarget',
                    'levels' =&gt; ['error', 'warning'],
                ],
            ],
 ],</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">db</code>: This component <a id="id63" class="indexterm"/>handles a database connection. We can<a id="id64" class="indexterm"/> have several db configuration in our app; in this case, we can define more components with the <code class="literal">Connection</code> class located at <code class="literal">yii\db\</code>. <p>Consider the following example:</p><div class="informalexample"><pre class="programlisting">db =&gt; [
    'class' =&gt; 'yii\db\Connection',
    'dsn' =&gt; 'mysql:host=localhost;dbname=yii2basic',
    'username' =&gt; 'dbuser'',
    'password' =&gt; 'dbpassword',
    'charset' =&gt; 'utf8',
],</pre></div></li></ul></div></div><div class="section" title="Handling application events"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Handling application events</h2></div></div></div><p>During its lifecycle, an<a id="id65" class="indexterm"/> application can trigger many events. These events can be declared in application configuration or programmatically. Common triggers are <code class="literal">beforeRequest</code>, <code class="literal">afterRequest</code>, <code class="literal">beforeAction</code>, and <code class="literal">afterAction</code>, but every object can have its own events.</p><p>For example, a common use of events is to set <code class="literal">mysql db timezone</code>.</p><p>To set the time zone to UTC in db component configuration, we must define a handler for the <code class="literal">afterOpen</code> event:</p><div class="informalexample"><pre class="programlisting">'db' =&gt; [
  'class' =&gt; 'yii\db\Connection',
  'dsn' =&gt; 'mysql:host=localhost;dbname=mydb',
  'username' =&gt; 'dbuser',
  'password' =&gt; 'dbpassword',
  'charset' =&gt; 'utf8',

  'on afterOpen' =&gt; function($event) {
    $event-&gt;sender-&gt;createCommand("SET time_zone = '+00:00'")-&gt;execute();
       }
  ],</pre></div><p>An anonymous function, attached to <code class="literal">on afterOpen</code> event handlers, has an <code class="literal">$event</code> parameter, which is an instance of the <code class="literal">yii\base\ActionEvent</code> class. This class has a <code class="literal">$sender</code> object that refers to the sender of the event. In this case, <code class="literal">$sender</code> refers to the instance of database <a id="id66" class="indexterm"/>components (db). This property may also be null when this event is a class-level event.</p></div><div class="section" title="The MVC pattern in Yii2"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>The MVC pattern in Yii2</h2></div></div></div><p>Yii2 is built according to the <span class="strong"><strong>Model-View-Controller</strong></span> (<span class="strong"><strong>MVC</strong></span>) design pattern.</p><p>Models, representing logic, are <a id="id67" class="indexterm"/>objects extended <a id="id68" class="indexterm"/>from <code class="literal">\yii\base\Model</code>, which offer many features such as attribute, attribute labels, massive assignment (to fill object attributes directly for an array), validation rules, and data exporting.</p><p>Normally, in common apps, a Model will be generated from the database, extending <code class="literal">yii\db\ActiveRecord</code> that implements the Active Record design pattern, with many methods to manipulate data. Yii2 provides Gii, a tool used to generate Model classes directly from the database's table structure.</p><p>Controllers, the bridge between view and model, are class instances extending from <code class="literal">yii\base\Controller</code>, used to process requests and generate responses.</p><p>Controllers mainly contain functions whose name starts with the action prefix that allows the framework to recognize those functions as routes, which can be requested.</p><p>Finally, we will look at views that deal with displaying data to end users that are mainly rendered in the page layout from controllers.</p></div></div>
<div class="section" title="Naming convention"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Naming convention</h1></div></div></div><p>In order to allow <a id="id69" class="indexterm"/>auto-loading, Yii2 uses a simple standard to set names.</p><p>Routes that refer respectively to module, controller, and the action requested take the following format:</p><p>
<code class="literal">ModuleID/ControllerID/ActionID</code>
</p><p>We will look at each element in detail as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The ModuleID is optional, so often the format is ControllerID/ActionID</li><li class="listitem" style="list-style-type: disc">The ModuleID must be specified in the module's configuration property, under the same name</li><li class="listitem" style="list-style-type: disc">The ControllerID and ActionID should contain only English characters in lowercase, digits, underscores, dashes, and forward slashes</li></ul></div><p>An example of route is <code class="literal">http://hostname/index.php?r=site/index</code>, where <code class="literal">site</code> is the ControllerID and <code class="literal">index</code> is the ActionID.</p><p>Starting from ControllerID, it is very easy to create the Controller class name. Just turn into uppercase the first letter of each word separated by dashes, then remove dashes and append the suffix Controller. If ControllerID contains slashes, just apply the rules to the part after the last slash in the ID. This is possible because controllers can be collected in subfolders, starting from <code class="literal">app\controllers</code>.</p><p>The following are<a id="id70" class="indexterm"/> some examples:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Shop points to <code class="literal">app\controllers\ShopController</code></li><li class="listitem" style="list-style-type: disc">Preferred number points to <code class="literal">app\controllers\PreferredNumberController</code></li><li class="listitem" style="list-style-type: disc">Admin/users account points to <code class="literal">app\controllers\admin\UsersAccountController</code><div class="mediaobject"><img src="graphics/B04656_01_03.jpg" alt="Naming convention"/></div></li></ul></div><p>Routes are passed to entry script <code class="literal">basic/web/index.php</code> through the <code class="literal">r</code> parameter.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>The default page <code class="literal">http://hostname/basic/web/index.php</code> is equivalent to <code class="literal">http://hostname/basic/web/index.php?r=site/index</code>.</p></div></div><div class="section" title="Configuring the debug toolbar"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Configuring the debug toolbar</h2></div></div></div><p>It is important to have a rich <a id="id71" class="indexterm"/>collection of tools to make development easier in displaying some useful information about requests and responses.</p><p>For this purpose, Yii2 provides a toolbar that displays several types of info.</p><p>A common way to activate the debug toolbar is to set in <code class="literal">config/web.php</code>:</p><div class="informalexample"><pre class="programlisting">'bootstrap' =&gt; ['debug'],
'modules' =&gt; [
  'debug' =&gt; 'yii\debug\Module',
]</pre></div><p>Now you can set the following values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">debug</code> to <code class="literal">bootstrap</code> config node</li><li class="listitem" style="list-style-type: disc"><code class="literal">debug</code> to <code class="literal">modules</code> config node, using the <code class="literal">Module</code> class under <code class="literal">yii\debug\</code></li></ul></div><p>The default installation of the Yii2 basic template already enables the debug toolbar, as we can see at the bottom of the <code class="literal">config/web.php</code> configuration file. The Gii module is also enabled as well, but we will work with it later.</p><div class="informalexample"><pre class="programlisting">if (YII_ENV_DEV) {
    // configuration adjustments for 'dev' environment
    $config['bootstrap'][] = 'debug';
    $config['modules']['debug'] = 'yii\debug\Module';
    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = 'yii\gii\Module';
}</pre></div><p>This config entry is only valid in the <code class="literal">YII_ENV_DEV</code> mode. So, we must check whether the <code class="literal">web/index.php YII_ENV</code> variable has the <code class="literal">dev</code> value (as shown in the default installation).</p><div class="mediaobject"><img src="graphics/B04656_01_04.jpg" alt="Configuring the debug toolbar"/><div class="caption"><p>Debug toolbar closed</p></div></div><p>If we try to reload the<a id="id72" class="indexterm"/> web page at <code class="literal">basic/web/index.php</code> after these checks, we should see the following screenshot:</p><div class="mediaobject"><img src="graphics/B04656_01_02.jpg" alt="Configuring the debug toolbar"/><div class="caption"><p>Debug toolbar opened</p></div></div><p>The right arrow reports that the debug toolbar is active but closed. If we click on it, the complete toolbar will open. Now, click on any item, the debug panel will be displayed.</p><p>By default, the debug toolbar can be used only in localhost. However, if we are using Yii2 in the remote hosting environment, we set the <code class="literal">allowedIPs</code> property of the <code class="literal">debug</code> module.</p><div class="informalexample"><pre class="programlisting">$config['modules']['debug'] = [
    'class' =&gt; 'yii\debug\Module',
    'allowedIPs' =&gt; [ '127.0.0.1', '::1']
];</pre></div><p>In <code class="literal">allowedIPs</code> there is only localhost (in the IPv4 and IPv6 forms). We need to put our Internet connection and IP source address here, which can be easily found using any <code class="literal">my IP</code> service on the Internet, such<a id="id73" class="indexterm"/> as <a class="ulink" href="http://www.whatismyip.com/">http://www.whatismyip.com/</a>.</p><p>If our IP source is, for example, <code class="literal">1.2.3.4</code>, we must add this entry to <code class="literal">allowedIPs</code>, in this way:</p><div class="informalexample"><pre class="programlisting">$config['modules']['debug'] = [
    'class' =&gt; 'yii\debug\Module',
    'allowedIPs' =&gt; [ '127.0.0.1', '::1', '1.2.3.4']
];</pre></div><p>Remember that if<a id="id74" class="indexterm"/> we do not have an Internet connection with a static IP, this IP might change. So we need to check whether <code class="literal">allowedIPs</code> contains our current IP.</p><p>You could also use an asterisk <code class="literal">*</code> to allow all IP addresses, so you do not have to deal with dynamic IP issues. If you do this, you need to remember to remove the asterisk before deployment. Finally, at the bottom of our current configuration <code class="literal">config/web.php</code>, you will see the following code:</p><div class="informalexample"><pre class="programlisting">if (YII_ENV_DEV) {
    // configuration adjustments for 'dev' environment
    $config['bootstrap'][] = 'debug';
    $config['modules']['debug'] = [
        'class' =&gt; 'yii\debug\Module',
            'allowedIPs' =&gt; [ '127.0.0.1', '::1', '1.2.3.4']
    ];
    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = 'yii\gii\Module';
}</pre></div><p>Let's return to the <code class="literal">basic/web/index.php</code> webpage and take a look at the debug info panel.</p><p>The debug information is distributed in the menu:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Configuration</strong></span>: This is the installed PHP version and configuration and also the installed Yii2 framework version.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Request</strong></span>: This is the info about the request just sent, displaying parameters of the request, headers of the request and other useful data as response and session data.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Logs</strong></span>: This involves the actions performed by Yii2 during the execution. There are additional filters in this section to select the types of logs to be displayed.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Performance Profiling</strong></span>: This includes info about timing and duration of process.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Database</strong></span>: This includes info about all database query occurred; we can filter for type of query to locate a specific query.</li></ul></div><p>It is possible to filter all data using internal grid filter or to filter for all, latest or selecting among the last 10 rows of the log on top of the content pane.</p></div><div class="section" title="Using the logger"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Using the logger</h2></div></div></div><p>In the Yii2 application, the<a id="id75" class="indexterm"/> debug info is stored using the log component. We can use this tool both in the development and production environment, but for reasons of performance and security in production, we should log only the important messages.</p><p>The default configuration file of the Yii2 basic template provides log entry in the <code class="literal">components</code> property of <code class="literal">config/web.php</code>:</p><div class="informalexample"><pre class="programlisting">'log' =&gt; [
  'traceLevel' =&gt; YII_DEBUG ? 3 : 0,
      'targets' =&gt; [
      [
             'class' =&gt; 'yii\log\FileTarget',
             'levels' =&gt; ['error', 'warning'],
      ],
    ],
],</pre></div></div><div class="section" title="Example – Hello world from scratch with the Yii basic template and bootstrap template"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Example – Hello world from scratch with the Yii basic template and bootstrap template</h2></div></div></div><p>It is now time to code our<a id="id76" class="indexterm"/> first project using Yii2.</p><p>If we have not installed Yii2 yet, we will to do it now using Composer as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open Command Prompt to the web server.</li><li class="listitem">Go to the document root of the web server (<code class="literal">/var/www</code> in a Linux machine).</li><li class="listitem">Launch these commands (as described in the <span class="emphasis"><em>Installing Yii with Composer</em></span> section):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>curl -s http://getcomposer.org/installer | php</strong></span>
<span class="strong"><strong>php composer.phar global require "fxp/composer-asset-plugin:1.0.0"</strong></span>
<span class="strong"><strong>php composer.phar create-project --prefer-dist yiisoft/yii2-app-basic basic</strong></span>
</pre></div></li></ol></div><p>Now, we need a fresh installation of Yii2 in the basic folder of the web server document root. Point the browser to <code class="literal">http:/hostname/basic/web</code> and we should see Yii2's congratulations page:</p><div class="mediaobject"><img src="graphics/B04656_01_05.jpg" alt="Example – Hello world from scratch with the Yii basic template and bootstrap template"/><div class="caption"><p>An example of the Hello world page</p></div></div><p>We will create<a id="id77" class="indexterm"/> our first action to display a memorable <code class="literal">hello world</code> on the screen.</p><p>We know from the <span class="emphasis"><em>Application properties</em></span> section, in the defaultRoute entry, that the <code class="literal">SiteController</code> controller will be called when no route is specified in request.</p><p>So, we enter <code class="literal">basic/controllers</code> and open <code class="literal">SiteController.php</code>, which is the default controller.</p><p>In the <code class="literal">SiteController</code> class definition, we add a new method at the top, called <code class="literal">actionHelloWorld</code>, without parameters.</p><div class="informalexample"><pre class="programlisting">public function actionHelloWorld()
{
    echo 'hello world'
}</pre></div><p>Let's save the file and point to <code class="literal">http://hostname/basic/web/index.php?r=site/hello-world</code>.</p><p>You should see a blank page with <code class="literal">hello world</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Pay attention when using the name route convention. Uppercase letters are translated to lowercase and dashes.</p></div></div><p>This is fantastic, but now we just want to put <code class="literal">hello world</code> within the page template.</p><p>We must now create a view with the content of response hello world!. In order to do this, we need to create a file named <code class="literal">helloWorld.php</code> as the name of the action under <code class="literal">views/site</code>. The naming convention need not necessarily be the same here because the view file is not automatically called from the framework.</p><p>This file only contains the <code class="literal">hello world</code> text.</p><p>We update <code class="literal">SiteController</code> with the following code:</p><div class="informalexample"><pre class="programlisting">public function actionHelloWorld()
{
    return $this-&gt;render('helloWorld');
}</pre></div><p>In the <code class="literal">actionHelloWorld()</code> method, <code class="literal">$this</code> refers to the SiteController's instance, and <code class="literal">render()</code> will insert the <code class="literal">views/helloWorld.php</code> file content in the main content layout page.</p><p>The extension<a id="id78" class="indexterm"/> of the view file, <code class="literal">.php</code>, is automatically added from the framework to view the name parameter passed to the render method.</p><p>What if we want to pass a parameter, such as name, to <code class="literal">actionHelloWorld()</code>? Formally, we need to add just one parameter to <code class="literal">actionHelloWorld()</code> in SiteController as follows:</p><div class="informalexample"><pre class="programlisting">public function actionHelloWorld($nameToDisplay)
{
    return $this-&gt;render('helloWorld',
  [ 'nameToDisplay' =&gt; $nameToDisplay ]
    );
}</pre></div><p>Then, under <code class="literal">view/site/helloWorld.php</code> add the following code:</p><div class="informalexample"><pre class="programlisting">Hello World &lt;?php echo $nameToDisplay ?&gt;</pre></div><p>With the update of <code class="literal">actionHelloWorld()</code>, we will pass as a second parameter, an array of variables, that will be visible and used in View.</p><p>When we use parameters in the action function, we must remember that they will be mandatory and we must respect the order when passing it to the request.</p><p>To avoid this obligation, we can use the old method, parsing parameters into the function:</p><div class="informalexample"><pre class="programlisting">public function actionHelloWorld()
{
    $nameToDisplay = Yii::$app-&gt;request-&gt;get('nameToDisplay');
    // Equivalent to
// $nameToDisplay = isset($_GET['nameToDisplay'])?$_GET['nameToDisplay']:null;

    return $this-&gt;render('helloWorld',
    [ 'nameToDisplay' =&gt; $nameToDisplay ]
    );
}</pre></div><p>With this <a id="id79" class="indexterm"/>solution, we can decide whether to pass the <code class="literal">nameToDisplay</code> parameter to request. The default value of the <code class="literal">nameToDisplay</code> parameter will be null, but we can decide to assign a different value.</p><p>The following is a URL example passing the <code class="literal">nameToDisplay</code> parameter <code class="literal">Foo</code>:</p><p>
<code class="literal">http://hostname/basic/web/index.php?r=site/hello-world&amp;nameToDisplay=Foo</code>
</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Summary</h1></div></div></div><p>In this chapter, we looked at a basic understanding of the Yii2 framework, starting from requirements to explain the main features. Then we used debugging and logging tools to trace our code and were able to find errors. Finally, we wrote our first project based on the basic template.</p><p>Next, you will learn how to create our controllers and views, to create custom interaction with frontend users.</p></div></body></html>