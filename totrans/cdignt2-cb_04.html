<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Email, HTML Table, and Text Libraries"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Email, HTML Table, and Text Libraries</h1></div></div></div><p>In this chapter, you will learn:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Sending plain e-mails with CodeIgniter Email</li><li class="listitem" style="list-style-type: disc">Sending HTML e-mails with CodeIgniter Email</li><li class="listitem" style="list-style-type: disc">Sending attachments with CodeIgniter Email</li><li class="listitem" style="list-style-type: disc">Sending bulk e-mails with CodeIgniter Email</li><li class="listitem" style="list-style-type: disc">Using an HTML table with DataTable</li><li class="listitem" style="list-style-type: disc">Using an HTML table with DataTable and a database</li><li class="listitem" style="list-style-type: disc">Using <code class="literal">word_limiter()</code> for table output</li><li class="listitem" style="list-style-type: disc">Using <code class="literal">word_censor()</code> for cleaning input</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Introduction</h1></div></div></div><p>CodeIgniter comes with some useful libraries and functions for handling many aspects of application development. In this chapter we will look at Email and HTML tables. The CodeIgniter Email library is capable of sending plain text and HTML e-mails, with and without attachments that can be used (with a little configuration) instead of the standard PHP <code class="literal">mail()</code> <a id="id143" class="indexterm"/>function. CodeIgniter's HTML Table library is excellent at generating the HTML necessary for pretty much most of what you will need a table for—and, together with DataTable, can provide excellent interactive tables for your users.</p></div></div>
<div class="section" title="Sending plain e-mails with CodeIgniter Email"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Sending plain e-mails with CodeIgniter Email</h1></div></div></div><p>It's always useful to be able <a id="id144" class="indexterm"/>to send e-mails and CodeIgniter <a id="id145" class="indexterm"/>comes with an excellent library for sending e-mails. There are a few recipes in this chapter, which deal with sending e-mails. However, this is the basic Hello World type example that is very simple.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec47"/>How to do it...</h2></div></div></div><p>A simple way to send plain <a id="id146" class="indexterm"/>e-mails using CodeIgniter <a id="id147" class="indexterm"/>Email is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a file <code class="literal">email.php</code> at <code class="literal">path/to/codeigniter/application/controllers/</code>.</li><li class="listitem">Add the following code to the controller file <code class="literal">email.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Email extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;library('email');
    }

    public function index() {
        redirect('email/send_email');
    }

    public function send_email() {
        $config['protocol'] = 'sendmail';
        $config['mailpath'] = '/usr/sbin/sendmail';
        $config['charset'] = 'iso-8859-1';
        $config['wordwrap'] = TRUE;
        $config['mailtype'] = 'text';

        $this-&gt;email-&gt;initialize($config);
        $this-&gt;email-&gt;from('from@domain.com', 'Your Name');
        $this-&gt;email-&gt;to('to@domain.com');
        $this-&gt;email-&gt;subject('This is a text email');
        $this-&gt;email-&gt;message('And this is some content for the text email.');

        $this-&gt;email-&gt;send();

        echo $this-&gt;email-&gt;print_debugger();
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec48"/>How it works...</h2></div></div></div><p>In the constructor controller we load the Email library (highlighted in the following code), which provides support to send e-mails:</p><div class="informalexample"><pre class="programlisting">function __construct() {
    parent::__construct();
    $this-&gt;load-&gt;helper('url');
    <span class="strong"><strong>$this-&gt;load-&gt;library('email');</strong></span>
}</pre></div><p>Next, <code class="literal">public function index()</code> <a id="id148" class="indexterm"/>redirects us to the function <code class="literal">public function send_mail()</code>, <a id="id149" class="indexterm"/>which sets some initial configuration variables for CodeIgniter Email library to work with, such as the system used to send the e-mail (in this case, <code class="literal">sendmail</code>), the path to send e-mail on your <a id="id150" class="indexterm"/>system, the <a id="id151" class="indexterm"/>
<code class="literal">mailtype</code> variable (text or HTML), <a id="id152" class="indexterm"/>and so on. Take a look at the following line of code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$config['mailtype'] = 'text';</strong></span>
</pre></div><p>Here, we're telling CodeIgniter to <a id="id153" class="indexterm"/>send the e-mail as just plain text rather than HTML.</p><p>These configuration settings are initialized (that is, passed to the Email library), and we begin to build the e-mail by setting the <code class="literal">to</code>, <code class="literal">from, subject</code>, and <code class="literal">message</code> attributes:</p><div class="informalexample"><pre class="programlisting">$this-&gt;email-&gt;from('from@domain.com', 'Your Name');
$this-&gt;email-&gt;to('to@domain.com');

$this-&gt;email-&gt;subject('This is a text email');
$this-&gt;email-&gt;message('And this is some content for the text email.');</pre></div><p>Then, send the e-mail:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;email-&gt;send();</pre></div><p>If all works out as planned, you should see an output similar to the following one:</p><div class="informalexample"><pre class="programlisting">User-Agent: CodeIgniter
Date: Fri, 4 Oct 2013 08:51:03 +0200
From: "Your Name" &lt;from@domain.com&gt;
Return-Path: &lt;from@domain.com&gt;
To: to@domain.com
Subject: =?iso-8859-1?Q?This_is_a_text_email?=
Reply-To: "from@domain.com" &lt;from@domain.com&gt;
X-Sender: from@domain.com
X-Mailer: CodeIgniter
X-Priority: 3 (Normal)
Message-ID: &lt;524e6557968c5@domain.com&gt;
Mime-Version: 1.0


Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

And this is some content for the text email.</pre></div></div></div>
<div class="section" title="Sending HTML e-mails with CodeIgniter Email"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Sending HTML e-mails with CodeIgniter Email</h1></div></div></div><p>There might be times <a id="id154" class="indexterm"/>when you wish to display <a id="id155" class="indexterm"/>formatted e-mails <a id="id156" class="indexterm"/>rather than just plain text, so you may wish to include images, text formatting, and URLs in the body of your e-mail. HTML e-mails will allow you to do this and CodeIgniter Email library can easily be set to do just that.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec49"/>How to do it...</h2></div></div></div><p>HTML e-mails can be sent by executing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a file <code class="literal">email.php</code> at <code class="literal">/path/to/codeigniter/application/controllers/</code>.</li><li class="listitem">Add the following code to the controller file <code class="literal">email.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Email extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;library('email');
}

    public function index() {
        redirect('email/send_email');
    }

    public function send_email() {
        $config['protocol'] = 'sendmail';
        $config['mailpath'] = '/usr/sbin/sendmail';
        $config['charset'] = 'iso-8859-1';
        $config['wordwrap'] = TRUE;
        $config['mailtype'] = 'html';

        $this-&gt;email-&gt;initialize($config);

        $this-&gt;email-&gt;from('from@domain.com', 'Your Name');
        $this-&gt;email-&gt;to('to@domain.com');

        $this-&gt;email-&gt;subject('This is a html email');
        $html = 'This is an &lt;b&gt;HTML&lt;/b&gt; email';
        $this-&gt;email-&gt;message($html);

        $this-&gt;email-&gt;send();

        echo $this-&gt;email-&gt;print_debugger();
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec50"/>How it works...</h2></div></div></div><p>In the constructor <a id="id157" class="indexterm"/>controller we load the Email <a id="id158" class="indexterm"/>library (highlighted in the following code), which provides support for us to send e-mails:</p><div class="informalexample"><pre class="programlisting">function __construct() {
    parent::__construct();
    $this-&gt;load-&gt;helper('url');
    <span class="strong"><strong>$this-&gt;load-&gt;library('email');</strong></span>
}</pre></div><p>Next, <code class="literal">public function index()</code> redirects us to the function <code class="literal">public function send_mail()</code>, which sets some initial configuration variables for CodeIgniter Email library to work with, such as the system used to send the e-mail (in this case, <code class="literal">sendmail</code>), the path to send e-mail on your <a id="id159" class="indexterm"/>system, the <code class="literal">mailtype</code> <a id="id160" class="indexterm"/>variable (text or HTML), and so on. Take a look at the following line of code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$config['mailtype'] = 'html';</strong></span>
</pre></div><p>Here, we're telling CodeIgniter to send the e-mail as HTML rather than as text.</p><p>These configuration settings are initialized (that is, passed to the Email library) and we begin to build the e-mail by setting the <code class="literal">to</code>, <code class="literal">from, subject</code>, and <code class="literal">message</code> attributes:</p><div class="informalexample"><pre class="programlisting">$this-&gt;email-&gt;from('from@domain.com', 'Your Name');
$this-&gt;email-&gt;to('to@domain.com');
$this-&gt;email-&gt;subject('This is a text email');
$this-&gt;email-&gt;message('And this is some content for the text email.');</pre></div><p>Then, <a id="id161" class="indexterm"/>send the e-mail using the following code:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;email-&gt;send();</pre></div><p>If all works out as planned, you <a id="id162" class="indexterm"/>should see an output similar to the following code:</p><div class="informalexample"><pre class="programlisting">Your message has been successfully sent using the following protocol: sendmail
User-Agent: CodeIgniter
Date: Fri, 4 Oct 2013 08:56:59 +0200
From: "Your Name" &lt;from@domain.com&gt;
Return-Path: &lt;from@domain.com&gt;
To: to@domain.com
Subject: =?iso-8859-1?Q?This_is_a_html_email?=
Reply-To: "from@domain.com" &lt;from@domain.com&gt;
X-Sender: from@domain.com
X-Mailer: CodeIgniter
X-Priority: 3 (Normal)
Message-ID: &lt;524e66bbf282f@domain.com&gt;
Mime-Version: 1.0


Content-Type: multipart/alternative; boundary="B_ALT_524e66bbf2868"

This is a multi-part message in MIME format.
Your email application may not support this format.

--B_ALT_524e66bbf2868
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

This is an HTML email


--B_ALT_524e66bbf2868
Content-Type: text/html; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

This is an &lt;b&gt;HTML&lt;/b&gt; email

--B_ALT_524e66bbf2868--</pre></div></div></div>
<div class="section" title="Sending attachments with CodeIgniter Email"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Sending attachments with CodeIgniter Email</h1></div></div></div><p>There might be <a id="id163" class="indexterm"/>times when you wish to send an attachment along with the e-mail, such as an invoice to a customer for a recent purchase or <a id="id164" class="indexterm"/>perhaps an image. The CodeIgniter Email library can easily be set to do just that.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec51"/>How to do it...</h2></div></div></div><p>You can send attachments with CodeIgniter Email by executing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a file <code class="literal">email.php</code> at <code class="literal">/path/to/codeigniter/application/controllers/</code>.</li><li class="listitem">Add the following code to the controller file, <code class="literal">email.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
class Email extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;library('email');
}
    public function index() {
        redirect('email/send_email');
    }
    public function send_email() {
        $config['protocol'] = 'sendmail';
        $config['mailpath'] = '/usr/sbin/sendmail';
        $config['charset'] = 'iso-8859-1';
        $config['wordwrap'] = TRUE;
        $config['mailtype'] = 'html';
        $this-&gt;email-&gt;initialize($config);
        $this-&gt;email-&gt;from('from@domain.com', 'Your Name');
        $this-&gt;email-&gt;to('to@domain.com');
        $this-&gt;email-&gt;subject('This is a html email');
        $html = 'This is an &lt;b&gt;HTML&lt;/b&gt; email with an attachment, &lt;i&gt;lovely!&lt;/i&gt;';
        $this-&gt;email-&gt;message($html);
        $this-&gt;email-&gt;attach('/path/to/attachment');
        $this-&gt;email-&gt;send();
        echo $this-&gt;email-&gt;print_debugger();
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec52"/>How it works...</h2></div></div></div><p>In the constructor <a id="id165" class="indexterm"/>controller we load the Email library (highlighted in the following code), which provides support to send e-mails:</p><div class="informalexample"><pre class="programlisting">function __construct() {
    parent::__construct();
    $this-&gt;load-&gt;helper('url');
    <span class="strong"><strong>$this-&gt;load-&gt;library('email');</strong></span>
}</pre></div><p>Next, <code class="literal">public function index()</code> <a id="id166" class="indexterm"/>redirects us to the function, <code class="literal">public function send_mail()</code>, which sets some initial configuration variables for the CodeIgniter Email <a id="id167" class="indexterm"/>library to work with, such as the system used to send the e-mail (in this case, <code class="literal">sendmail</code>), the path to send mail on your <a id="id168" class="indexterm"/>system, the <code class="literal">mailtype</code> <a id="id169" class="indexterm"/>variable (text or HTML), and so on. These configuration settings are initialized (that is, passed to the Email library) and we begin to build the e-mail; setting the <code class="literal">to</code>, <code class="literal">from, subject</code>, and <code class="literal">message</code> attributes, as well as the path to the attachment we're <a id="id170" class="indexterm"/>sending in the e-mail (highlighted in the following code):</p><div class="informalexample"><pre class="programlisting">    $this-&gt;email-&gt;from('from@domain.com', 'Your Name');
    $this-&gt;email-&gt;to('to@domain.com');
    $this-&gt;email-&gt;subject('This is a html email');
    $html = 'This is an &lt;b&gt;HTML&lt;/b&gt; email with an attachment, &lt;i&gt;lovely!&lt;/i&gt;';
    $this-&gt;email-&gt;message($html);
    <span class="strong"><strong>$this-&gt;email-&gt;attach('/path/to/attachment');</strong></span>
</pre></div><p>Then, send the e-mail using the following code:</p><div class="informalexample"><pre class="programlisting">$this-&gt;email-&gt;send();</pre></div></div></div>
<div class="section" title="Sending bulk e-mails with CodeIgniter Email"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Sending bulk e-mails with CodeIgniter Email</h1></div></div></div><p>There may be times <a id="id171" class="indexterm"/>when you wish to send out bulk <a id="id172" class="indexterm"/>e-mails; perhaps to all the <a id="id173" class="indexterm"/>people who have paid to go on a tour. You may wish to send them each a personalized e-mail, and also add an attachment. You may also want to pull their e-mail preference (plain text or HTML) from the account on your database and send them the correct format of e-mail. That's what we're going to do here.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec53"/>Getting ready</h2></div></div></div><p>We need to know each person's preferences such as whether they want HTML e-mails or text, and also their individual reference number (or booking ID) for their trip. As per this requirement, we are going to have a database to hold all the information; so copy the following code into your database:</p><div class="informalexample"><pre class="programlisting">CREATE TABLE `bookers` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `firstname` varchar(50) NOT NULL,
    `lastname` varchar(50) NOT NULL,
    `email` varchar(255) NOT NULL,
    `email_pref` varchar(4) NOT NULL,
    `booking_ref` varchar(10) NOT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=3 ;
INSERT INTO `bookers` (`id`, `firstname`, `lastname`, `email`, `email_pref`, `booking_ref`) VALUES
(1, 'Robert', 'Foster', 'example1@domain1.com', 'html', 'ABC123'),
(2, 'Lucy', 'Welsh', 'example2@domain2.com', 'html', 'DEF456');</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec54"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a file <code class="literal">email.php</code> at <code class="literal">/path/to/codeigniter/application/controllers/</code>.</li><li class="listitem">Add the following <a id="id174" class="indexterm"/>code to the <a id="id175" class="indexterm"/>controller <a id="id176" class="indexterm"/>file, <code class="literal">email.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
class Email extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;library('email');
}
    public function index() {
        redirect('email/send_email');
}
    public function send_email() {
        $config['protocol'] = 'sendmail';
        $config['mailpath'] = '/usr/sbin/sendmail';
        $config['charset'] = 'iso-8859-1';
        $config['wordwrap'] = TRUE;
        $query = "SELECT * FROM bookers ";
        $result = $this-&gt;db-&gt;query($query);
        foreach ($result-&gt;result() as $row) {
            $this-&gt;email-&gt;clear();
            if ($row-&gt;email_pref == 'text') {
                $config['mailtype'] = 'text';
                $body = 'Hi ' . $row-&gt;firstname . ', Thanks you for booking with us, please find attached the itinerary for your trip. This is your booking reference number: ' . $row-&gt;booking_ref . ' Thanks for booking with us, have a lovely trip.';
            } else {
                $config['mailtype'] = 'html';
                $body = 'Hi ' . $row-&gt;firstname . ',&lt;br /&gt;&lt;br /&gt;Thanks you for booking with us, please find attached the itinerary for your trip. &lt;/p&gt;This is your booking reference number: &lt;b&gt;' . $row-&gt;booking_ref . '&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;Thanks for booking with us, have a lovely trip.';
            }

            $this-&gt;email-&gt;initialize($config);
            $this-&gt;email-&gt;to($row-&gt;email);
            $this-&gt;email-&gt;from('bookings@thecodeigniterholidaycompany.com');
            $this-&gt;email-&gt;subject('Holiday booking details');

            $this-&gt;email-&gt;message($body);
            $this-&gt;email-&gt;send();
            }

        echo $this-&gt;email-&gt;print_debugger();
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec55"/>How it works...</h2></div></div></div><p>In the constructor <a id="id177" class="indexterm"/>controller we load the Email <a id="id178" class="indexterm"/>library (highlighted in the following code), which provides support for <a id="id179" class="indexterm"/>us to send e-mails:</p><div class="informalexample"><pre class="programlisting">function __construct() {
    parent::__construct();
    $this-&gt;load-&gt;helper('url');
    <span class="strong"><strong>$this-&gt;load-&gt;library('email');</strong></span>
}</pre></div><p>Next, <code class="literal">public function index()</code> redirects us to the function, <code class="literal">public function send_mail()</code>, which sets some initial configuration variables for CodeIgniter Email library to work with, such as the system used to send the e-mail (in this case, <code class="literal">sendmail</code>), the path to send mail from your system.</p><p>We then query the database for each of the customer's booking details:</p><div class="informalexample"><pre class="programlisting">        $query = "SELECT * FROM bookers ";
        $result = $this-&gt;db-&gt;query($query);

        foreach ($result-&gt;result() as $row) {

        }</pre></div><p>The query will loop through each result and send a specific e-mail based on the values retrieved from the database in each loop.</p><p>Firstly, we give ourselves a clean <a id="id180" class="indexterm"/>slate by clearing all the settings and variables from a previous loop iteration by using the CodeIgniter <code class="literal">email</code> function:</p><div class="informalexample"><pre class="programlisting">$this-&gt;email-&gt;clear();</pre></div><p>We then look at their e-mail preference and set the e-mail sending (<code class="literal">mailtype</code>) variable accordingly, along with the text for <a id="id181" class="indexterm"/>the body of the e-mails. So, if someone prefers HTML, we look for that preference and define the body of the HTML e-mail, otherwise for a text e-mail, we look for the <a id="id182" class="indexterm"/>text e-mail preference and define the body for the text e-mail:</p><div class="informalexample"><pre class="programlisting">    if ($row-&gt;email_pref == 'text') {
        $config['mailtype'] = 'text';
        $body = 'Hi ' . $row-&gt;firstname . ', Thank you for booking with us, please find attached the itinerary for your trip. This is your booking reference number: ' . $row-&gt;booking_ref . ' Thanks for booking with us, have a lovely trip.';
    } else {
        $config['mailtype'] = 'html';
        $body = 'Hi ' . $row-&gt;firstname . ',&lt;br /&gt;&lt;br /&gt;Thank you for booking with us, please find attached the itinerary for your trip. &lt;/p&gt;This is your booking reference number: &lt;b&gt;' . $row-&gt;booking_ref . '&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;Thanks for booking with us, have a lovely trip.';
    }</pre></div><p>After this, we initialize the configuration variables. Those of you who have looked at the previous few recipes will notice that the initialization takes place later in the code of this recipe than in others. This is because we cannot initialize the <code class="literal">config</code> variables earlier as some of the variables rely on the preferences of individual customers, which are fetched from the database. So, we have to <a id="id183" class="indexterm"/>wait until each user's details are fetched from a database to initialize each iteration of the configuration settings. And finally, we send the e-mail:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;email-&gt;send();</pre></div><p>If all goes well, you should<a id="id184" class="indexterm"/> see an output similar to the following:</p><div class="informalexample"><pre class="programlisting">Your message has been successfully sent using the following protocol: sendmail
User-Agent: CodeIgniter
Date: Fri, 4 Oct 2013 20:06:13 +0200
To: to@domain.com
From: &lt;bookings@thecodeigniterholidaycompany.com&gt;
Return-Path: &lt;bookings@thecodeigniterholidaycompany.com&gt;
Subject: =?iso-8859-1?Q?Holiday_booking_details?=
Reply-To: "bookings@thecodeigniterholidaycompany.com" &lt;bookings@thecodeigniterholidaycompany.com&gt;
X-Sender: bookings@thecodeigniterholidaycompany.com
X-Mailer: CodeIgniter
X-Priority: 3 (Normal)
Message-ID: &lt;524f0395942a2@thecodeigniterholidaycompany.com&gt;
Mime-Version: 1.0


Content-Type: multipart/alternative; boundary="B_ALT_524f0395942bb"

This is a multi-part message in MIME format.
Your email application may not support this format.

--B_ALT_524f0395942bb
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

Hi RobertThanks you booking with us,
 please find attached the itinerary for your trip.
 This is your booking reference number:
 ABC123
 Thanks for booking with us, have a lovely trip.


--B_ALT_524f0395942bb
Content-Type: text/html; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Robert&lt;br /&gt;&lt;br /&gt;Thanks you booking with us,=20
                please find attached the itinerary for your trip.
                &lt;/p&gt;This is your booking reference number:=20
                &lt;b&gt;ABC123&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;
                Thanks for booking with us, have a lovely trip.

--B_ALT_524f0395942bb--</pre></div></div></div>
<div class="section" title="Using an HTML table with DataTable"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Using an HTML table with DataTable</h1></div></div></div><p>DataTable is a free to use library that turns your normal looking html table into an interactive marvel with sortable and searchable columns and a whole lot more; we're going to use it with CodeIgniter, merging DataTable and CodeIgniter table functionality. It's <a id="id185" class="indexterm"/>simple to use and is able to handle most of the things you will need it for. Here, in this recipe, we're going to use it with DataTable to create an interactive HTML table that is sortable and searchable. It has pagination too! If you want database results, move on to the next recipe, <span class="emphasis"><em>Using an HTML table with DataTable and a database</em></span>, where we'll look at populating a table from a database query.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec56"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to follow the given procedure:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Ensure that you've downloaded DataTable from the following link:<p>
<a class="ulink" href="https://datatables.net/download/">https://datatables.net/download/</a>
</p></li><li class="listitem">Unzip the downloaded <code class="literal">.zip</code> file, and move the files to a location on your web server or localhost, which will be accessible by CodeIgniter. For this recipe, I have put the folder at <code class="literal">application/views</code>; but you can make your own choice if you wish.</li></ol></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec57"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create four files as given:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/controllers/table.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/table_header.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/table_body.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/table_footer.php</code></li></ul></div></li><li class="listitem">Create the controller file, <code class="literal">table.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Table extends CI_Controller {

    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;library('table');
}

    public function index() {
        $tmpl = array (
            'table_open'          =&gt; '&lt;table border="0" cellpadding="4" cellspacing="0" id="example"&gt;',

            'heading_row_start'   =&gt; '&lt;tr&gt;',
            'heading_row_end'     =&gt; '&lt;/tr&gt;',
            'heading_cell_start'  =&gt; '&lt;th&gt;',
            'heading_cell_end'    =&gt; '&lt;/th&gt;',

            'row_start'           =&gt; '&lt;tr&gt;',
            'row_end'             =&gt; '&lt;/tr&gt;',
            'cell_start'          =&gt; '&lt;td&gt;',
            'cell_end'            =&gt; '&lt;/td&gt;',

            'row_alt_start'       =&gt; '&lt;tr&gt;',
            'row_alt_end'         =&gt; '&lt;/tr&gt;',
            'cell_alt_start'      =&gt; '&lt;td&gt;',
            'cell_alt_end'        =&gt; '&lt;/td&gt;',

            'table_close'         =&gt; '&lt;/table&gt;'
        );

        $this-&gt;table-&gt;set_template($tmpl);

        $this-&gt;table-&gt;set_heading(array('ID', 'First Name', 'Last Name'));

        $this-&gt;table-&gt;add_row(array('1', 'Rob', 'Foster'));
        $this-&gt;table-&gt;add_row(array('2', 'Lucy', 'Welsh'));
        $this-&gt;table-&gt;add_row(array('3', 'George', 'Foster'));
        $this-&gt;table-&gt;add_row(array('4', 'Jackie', 'Foster'));
        $this-&gt;table-&gt;add_row(array('5', 'Antony', 'Welsh'));
        $this-&gt;table-&gt;add_row(array('6', 'Rowena', 'Welsh'));
        $this-&gt;table-&gt;add_row(array('7', 'Peter', 'Foster'));
        $this-&gt;table-&gt;add_row(array('8', 'Jenny', 'Foster'));
        $this-&gt;table-&gt;add_row(array('9', 'Oliver', 'Welsh'));
        $this-&gt;table-&gt;add_row(array('10', 'Felicity', 'Foster'));
        $this-&gt;table-&gt;add_row(array('11', 'Harrison', 'Foster'));
        $this-&gt;table-&gt;add_row(array('12', 'Mia', 'The Cat'));

        $data['table'] = $this-&gt;table-&gt;generate();

        $this-&gt;load-&gt;view('tables/table_header');
        $this-&gt;load-&gt;view('tables/table_body',$data);
        $this-&gt;load-&gt;view('tables/table_footer');
    }

}</pre></div></li><li class="listitem">Create the <a id="id186" class="indexterm"/>view file, <code class="literal">table_header.php</code>, and <a id="id187" class="indexterm"/>add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;html&gt;
    &lt;head&gt;
        &lt;style type="text/css" title="currentStyle"&gt;
            @import "&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/css/demo_page.css";
            @import "&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/css/jquery.dataTables.css";
        &lt;/style&gt;
        &lt;script type="text/javascript" language="javascript" src="&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/js/jquery.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" language="javascript" src="&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/js/jquery.dataTables.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" charset="utf-8"&gt;
            $(document).ready(function() {
                $('#example').dataTable();
            } );
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;</pre></div><p>Take a look at the <code class="literal">&lt;script&gt;</code> tag:</p><div class="informalexample"><pre class="programlisting">    &lt;script type="text/javascript" charset="utf-8"&gt;
        $(document).ready(function() {
            $('#example').dataTable();
        } );
    &lt;/script&gt;</pre></div><p>The <code class="literal">#example</code> parameter is the ID of the table (detailed in the following <span class="emphasis"><em>How it works...</em></span> section). Ensure that the value <code class="literal">example</code> in <code class="literal">&lt;script&gt;</code> and table markup is the same.</p></li><li class="listitem">Create the view file, <code class="literal">table_body.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php echo $table ; ?&gt;</pre></div></li><li class="listitem">Create the <a id="id188" class="indexterm"/>controller file, t<code class="literal">able_footer.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">    &lt;/body&gt;
&lt;/html&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec58"/>How it works...</h2></div></div></div><p>The constructor in the table <a id="id189" class="indexterm"/>controller loads the CodeIgniter's Table library:</p><div class="informalexample"><pre class="programlisting">    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;library('table');
    }</pre></div><p>The <code class="literal">public function index()</code> <a id="id190" class="indexterm"/>function is called. We then define how we want our HTML table markup to appear. This is where you can place any markup for the specific CSS, using which you can style the elements of the table:</p><div class="informalexample"><pre class="programlisting">$tmpl = array (
    'table_open'          =&gt; '&lt;table border="0" cellpadding="4" cellspacing="0" <span class="strong"><strong>id="example</strong></span>"&gt;',

    'heading_row_start'   =&gt; '&lt;tr&gt;',
    'heading_row_end'     =&gt; '&lt;/tr&gt;',
    'heading_cell_start'  =&gt; '&lt;th&gt;',
    'heading_cell_end'    =&gt; '&lt;/th&gt;',

    'row_start'           =&gt; '&lt;tr&gt;',
    'row_end'             =&gt; '&lt;/tr&gt;',
    'cell_start'          =&gt; '&lt;td&gt;',
    'cell_end'            =&gt; '&lt;/td&gt;',

    'row_alt_start'       =&gt; '&lt;tr&gt;',
    'row_alt_end'         =&gt; '&lt;/tr&gt;',
    'cell_alt_start'      =&gt; '&lt;td&gt;',
    'cell_alt_end'        =&gt; '&lt;/td&gt;',

    'table_close'         =&gt; '&lt;/table&gt;'
);</pre></div><p>Take a closer look at the <code class="literal">table_open</code> element of the <code class="literal">$tmpl</code> array. Look for the item highlighted in the preceding code. The <code class="literal">id="example"</code> item is used by DataTable (in the <code class="literal">&lt;script&gt;</code> tag of the file <code class="literal">table_header.php</code>) to apply its CSS and functionality. You can, of course, name it anything you like, <a id="id191" class="indexterm"/>but be sure to reflect that change in the JavaScript.</p><p>We then call <code class="literal">$this-&gt;table-&gt;set_template()</code> to apply the HTML table markup:</p><div class="informalexample"><pre class="programlisting">$this-&gt;table-&gt;set_template($tmpl);</pre></div><p>We then set the table headers <a id="id192" class="indexterm"/>and apply the data for our rows. Ensure that the number of items in the table headers is the same as the number of items in the table data:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;table-&gt;set_heading(array('ID', 'First Name', 'Last Name'));

    $this-&gt;table-&gt;add_row(array('1', 'Rob', 'Foster'));
    $this-&gt;table-&gt;add_row(array('2', 'Lucy', 'Welsh'));
    $this-&gt;table-&gt;add_row(array('3', 'George', 'Foster'));
    $this-&gt;table-&gt;add_row(array('4', 'Jackie', 'Foster'));
    $this-&gt;table-&gt;add_row(array('5', 'Antony', 'Welsh'));
    $this-&gt;table-&gt;add_row(array('6', 'Rowena', 'Welsh'));
    $this-&gt;table-&gt;add_row(array('7', 'Peter', 'Foster'));
    $this-&gt;table-&gt;add_row(array('8', 'Jenny', 'Foster'));
    $this-&gt;table-&gt;add_row(array('9', 'Oliver', 'Welsh'));
    $this-&gt;table-&gt;add_row(array('10', 'Felicity', 'Foster'));
    $this-&gt;table-&gt;add_row(array('11', 'Harrison', 'Foster'));
    $this-&gt;table-&gt;add_row(array('12', 'Mia', 'The Cat'));</pre></div><p>We then generate the table. <a id="id193" class="indexterm"/>The <code class="literal">$this-&gt;table-&gt;generate()</code> function will return a string of HTML, which we save in <code class="literal">$data['table']</code>.</p><div class="informalexample"><pre class="programlisting">    $data['table'] = $this-&gt;table-&gt;generate();</pre></div><p>The <code class="literal">$data</code> array <a id="id194" class="indexterm"/>is then passed to <a id="id195" class="indexterm"/>our view files for rendering to the browser:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;load-&gt;view('tables/table_header');
    $this-&gt;load-&gt;view('tables/table_body',$data);
    $this-&gt;load-&gt;view('tables/table_footer');</pre></div></div></div>
<div class="section" title="Using an HTML table with DataTable and a database"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Using an HTML table with DataTable and a database</h1></div></div></div><p>CodeIgniter comes with a useful <a id="id196" class="indexterm"/>library to handle HTML tables. It's simple <a id="id197" class="indexterm"/>to use and is able to handle most of the things you would need it for. Here, in this recipe, we're going to use it with DataTable to create an <a id="id198" class="indexterm"/>interactive HTML table that is sortable and <a id="id199" class="indexterm"/>searchable. It even has pagination! This recipe populates the table using a database query. If you're not looking for that and just want a simple table, try the preceding recipe—<span class="emphasis"><em>Using an HTML table with DataTable</em></span>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec59"/>Getting ready</h2></div></div></div><p>For this recipe, you will have to:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Ensure that you've downloaded DataTable from <a class="ulink" href="https://datatables.net/download/">https://datatables.net/download/</a>.</li><li class="listitem">Unzip the downloaded <code class="literal">.zip</code> file, and move the files to a location on your web server or localhost, which will be accessible by CodeIgniter. For this recipe, I have put the folder in the <code class="literal">application/views</code> folder; but you can make your own choice if you wish.</li><li class="listitem">As we're using CodeIgniter's HTML Table library to create a table for us with data from a table, we will first need to create that table; so, copy the following code into your database:<div class="informalexample"><pre class="programlisting">CREATE TABLE IF NOT EXISTS `person` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `first_name` varchar(50) NOT NULL,
    `last_name` varchar(50) NOT NULL,
    `email` varchar(255) NOT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=5 ;
INSERT INTO `person` (`id`, `first_name`, `last_name`, `email`) VALUES
(1, 'Rob', 'Foster', 'rfoster@dudlydog.com'),
(2, 'Lucy', 'Welsh', 'lwelsh@cocopopet.com'),
(3, 'Chloe', 'Graves', 'cgraves@mia-cat.com'),
(4, 'Claire', 'Strickland', 'cstrickland@an-other-domain.com');</pre></div></li></ol></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec60"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create four <a id="id200" class="indexterm"/>files as given:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/controllers/table.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/table_header.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/table_body.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/table_footer.php</code></li></ul></div></li><li class="listitem">Create the <a id="id201" class="indexterm"/>controller <a id="id202" class="indexterm"/>file, <code class="literal">table.php</code>, and add the following <a id="id203" class="indexterm"/>code to it:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Table extends CI_Controller {

    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;library('table');
        $this-&gt;load-&gt;database();
    }

    public function index() {
        $tmpl = array (
            'table_open'          =&gt; '&lt;table border="0" cellpadding="4" cellspacing="0" id="example"&gt;',

            'heading_row_start'   =&gt; '&lt;tr&gt;',
            'heading_row_end'     =&gt; '&lt;/tr&gt;',
            'heading_cell_start'  =&gt; '&lt;th&gt;',
            'heading_cell_end'    =&gt; '&lt;/th&gt;',

            'row_start'           =&gt; '&lt;tr&gt;',
            'row_end'             =&gt; '&lt;/tr&gt;',
            'cell_start'          =&gt; '&lt;td&gt;',
            'cell_end'            =&gt; '&lt;/td&gt;',

            'row_alt_start'       =&gt; '&lt;tr&gt;',
            'row_alt_end'         =&gt; '&lt;/tr&gt;',
            'cell_alt_start'      =&gt; '&lt;td&gt;',
            'cell_alt_end'        =&gt; '&lt;/td&gt;',

            'table_close'         =&gt; '&lt;/table&gt;'
        );

        $this-&gt;table-&gt;set_template($tmpl);

        $this-&gt;table-&gt;set_heading(array('ID', 'First Name', 'Last Name', 'Email'));	
        $query = $this-&gt;db-&gt;query("SELECT * FROM person");
        $data['table'] = $this-&gt;table-&gt;generate($query);

        $this-&gt;load-&gt;view('tables/table_header');
        $this-&gt;load-&gt;view('tables/table_body',$data);
        $this-&gt;load-&gt;view('tables/table_footer');
    }
}</pre></div></li><li class="listitem">Create the <a id="id204" class="indexterm"/>view <a id="id205" class="indexterm"/>file, <code class="literal">table_header.php</code>, <a id="id206" class="indexterm"/>and <a id="id207" class="indexterm"/>add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;html&gt;
    &lt;head&gt;
        &lt;style type="text/css" title="currentStyle"&gt;
            @import "&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/css/demo_page.css";
            @import "&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/css/jquery.dataTables.css";
        &lt;/style&gt;
        &lt;script type="text/javascript" language="javascript" src="&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/js/jquery.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" language="javascript" src="&lt;?php echo $this-&gt;config-&gt;item('base_url') ; ?&gt;application/views/DataTables-1.9.4/media/js/jquery.dataTables.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" charset="utf-8"&gt;
        $(document).ready(function() {
            $('#example').dataTable();
            } );
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;</pre></div><p>The <code class="literal">#example</code> <a id="id208" class="indexterm"/>parameter is the ID of the table (<a id="id209" class="indexterm"/>detailed in the following <span class="emphasis"><em>How it works</em></span> section). Ensure that the value <code class="literal">example</code> in <code class="literal">&lt;script&gt;</code> and the table <a id="id210" class="indexterm"/>markup is the same.</p></li><li class="listitem">Create the view file <code class="literal">table_body.php</code> and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php echo $table ; ?&gt;</pre></div></li><li class="listitem">Create the controller file <code class="literal">table_footer.php</code> and add the following code to it:<div class="informalexample"><pre class="programlisting">    &lt;/body&gt;
&lt;/html&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec61"/>How it works...</h2></div></div></div><p>The constructor in the <code class="literal">table</code> <a id="id211" class="indexterm"/>controller loads CodeIgniter's Table library:</p><div class="informalexample"><pre class="programlisting">    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;library('table');
    }</pre></div><p>The <code class="literal">public function index()</code> <a id="id212" class="indexterm"/>function is called. We then define how we want our HTML table markup to look. This is <a id="id213" class="indexterm"/>where you can place any markup for the specific CSS, using which you can style the elements of the table:</p><div class="informalexample"><pre class="programlisting">$tmpl = array (
    'table_open'          =&gt; '&lt;table border="0" cellpadding="4" cellspacing="0" <span class="strong"><strong>id="example"</strong></span>&gt;',

    'heading_row_start'   =&gt; '&lt;tr&gt;',
    'heading_row_end'     =&gt; '&lt;/tr&gt;',
    'heading_cell_start'  =&gt; '&lt;th&gt;',
    'heading_cell_end'    =&gt; '&lt;/th&gt;',

    'row_start'           =&gt; '&lt;tr&gt;',
    'row_end'             =&gt; '&lt;/tr&gt;',
    'cell_start'          =&gt; '&lt;td&gt;',
    'cell_end'            =&gt; '&lt;/td&gt;',

    'row_alt_start'       =&gt; '&lt;tr&gt;',
    'row_alt_end'         =&gt; '&lt;/tr&gt;',
    'cell_alt_start'      =&gt; '&lt;td&gt;',
    'cell_alt_end'        =&gt; '&lt;/td&gt;',

    'table_close'         =&gt; '&lt;/table&gt;'
);</pre></div><p>Take a closer look at the <code class="literal">table_open</code> element of the <code class="literal">$tmpl</code> array. Look for the item I've highlighted in the preceding code. The <code class="literal">id="example"</code> item is used by DataTable (in the <code class="literal">&lt;script&gt;</code> tag of the file, <code class="literal">table_header.php</code>) to apply its CSS and functionality. You can, of course, name it anything you <a id="id214" class="indexterm"/>like but be sure to reflect that change in the JavaScript code.</p><p>We then call <code class="literal">$this-&gt;table-&gt;set_template()</code> to apply the HTML table markup:</p><div class="informalexample"><pre class="programlisting">$this-&gt;table-&gt;set_template($tmpl);</pre></div><p>We then set the table headers and <a id="id215" class="indexterm"/>apply the data for our rows from a database query. Ensure that the number of items in the table <a id="id216" class="indexterm"/>headers is the same as the number of items in the table data:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;table-&gt;set_heading(array('ID', 'First Name', 'Last Name', 'Email'));	
    $query = $this-&gt;db-&gt;query("SELECT * FROM person");
    $data['table'] = $this-&gt;table-&gt;generate($query);</pre></div><p>We then generate the table. The <a id="id217" class="indexterm"/>
<code class="literal">$this-&gt;table-&gt;generate()</code> function will return a string of HTML, which we save in <code class="literal">$data['table']</code>.</p><div class="informalexample"><pre class="programlisting">    $data['table'] = $this-&gt;table-&gt;generate();</pre></div><p>The <code class="literal">$data</code> array is then passed to <a id="id218" class="indexterm"/>our view files for rendering to the browser:</p><div class="informalexample"><pre class="programlisting">    $this-&gt;load-&gt;view('tables/table_header');
    $this-&gt;load-&gt;view('tables/table_body',$data);
    $this-&gt;load-&gt;view('tables/table_footer');</pre></div></div></div>
<div class="section" title="Using word_limiter() for table output"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Using word_limiter() for table output</h1></div></div></div><p>Suppose that you're making a <a id="id219" class="indexterm"/>CMS or some sort of admin interface and <a id="id220" class="indexterm"/>you're currently making a view which lists—oh I don't know—articles. Suppose that there are some articles in your database and you have to list them. It might be considered useful to the user of the CMS to provide them with a brief preview of the article so that they can be sure that they're deleting, editing, or just looking at the correct one. A preview—similar to the one found in an e-mail client—displays the first few lines, so that a user can be sure of what they're looking at. CodeIgniter comes with a handy function for limiting the number of words displayed from a string of text; this function is perfect for such a purpose. Here, we're going to build a very small example for our recipe of a view, listing some articles and previewing the first few lines of each article.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec62"/>Getting ready</h2></div></div></div><p>As the articles will be stored in the database we will need to build a table to store them in; this will be just a simple table containing the articles. In any application, you'll likely build the database tables for the articles and article management (or whatever content you’re hosting) yourself and have many more tables of a different design and schema than is in the example recipe here. However, this is merely a brief example—feel free to adapt and amend the recipe as you require:</p><p>Create the following table in your database:</p><div class="informalexample"><pre class="programlisting">CREATE TABLE `articles` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `title` varchar(255) NOT NULL,
    `body` text NOT NULL,
    `created_at` int(11) NOT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=3 ;</pre></div><p>Insert the following entries <a id="id221" class="indexterm"/>into the table:</p><div class="informalexample"><pre class="programlisting">INSERT INTO `articles` (`id`, `title`, `body`, `created_at`) VALUES
(1, 'Article One', '&lt;p&gt;It suddenly struck me that that tiny pea, pretty and blue, was the Earth. I put up my thumb and shut one eye, and my thumb blotted out the planet Earth. I didn't feel like a giant. I felt very, very small.&lt;/p&gt;\r\n&lt;p&gt;Houston, Tranquillity Base here. The Eagle has landed.&lt;/p&gt;\r\n&lt;p&gt;That's one small step for [a] man, one giant leap for mankind.&lt;/p&gt;', 1381009509),
(2, 'Article Two', '&lt;p&gt;Space, the final frontier. These are the voyages of the Starship Enterprise. Its five-year mission: to explore strange new worlds, to seek out new life and new civilizations, to boldly go where no man has gone before.&lt;/p&gt;\r\n&lt;p&gt;We choose to go to the moon in this decade and do the other things, not because they are easy, but because they are hard, because that goal will serve to organize and measure the best of our energies and skills, because that challenge is one that we are willing to accept, one we are unwilling to postpone, and one which we intend to win.&lt;/p&gt;\r\n&lt;p&gt;The sky is the limit only for those who aren't afraid to fly!&lt;/p&gt;', 1381003509);</pre></div><p>We're displaying articles here (which in general are fairly long). So, to save on space in the book and limit the amount of typing you need to do, I've only included 2 short articles. I got the text for the articles from the Space Ipsum website (<a class="ulink" href="http://spaceipsum.com/">http://spaceipsum.com/</a>). If you <a id="id222" class="indexterm"/>don't want to type all that text from the preceding code (and why would you), you can go to Space Ipsum and get your own article content for this recipe. Either way it's good.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec63"/>How to do it...</h2></div></div></div><p>We will be creating the following three files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">limit.php</code> at <code class="literal">/path/to/codeigniter/application/controllers/</code>: This will be running the show for us, calling the model and passing data to the view file <code class="literal">view_all.php</code> under <code class="literal">limit/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/limit/view_all.php</code>: This will display a table summary of each article with the content for the body field limited by <code class="literal">word_limiter()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/models/limit_model.php</code>: This will retrieve the articles from the database with Active Record</li></ul></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will be creating the following three files: Create the <a id="id223" class="indexterm"/>controller file, <code class="literal">limit.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Limit extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;helper('text');
        $this-&gt;load-&gt;model('Limit_model');
}

    public function index() {
        redirect('limit/view_all');
    }

    public function view_all() {
        $data['query'] = $this-&gt;Limit_model-&gt;get_all();
        $this-&gt;load-&gt;view('limit/view_all', $data);
    }
}</pre></div></li><li class="listitem">Create the view file, <code class="literal">views/limit/view_all.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;b&gt;Title&lt;/b&gt;&lt;/td&gt;
        &lt;td&gt;&lt;b&gt;Preview&lt;/b&gt;&lt;/td&gt;
        &lt;td&gt;&lt;b&gt;Created At&lt;/b&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;?php foreach ($query-&gt;result() as $row) : ?&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;?php echo $row-&gt;title ; ?&gt;&lt;/td&gt;
            &lt;td&gt;&lt;?php echo word_limiter($row-&gt;body, 15) ; ?&gt;&lt;/td&gt;
            &lt;td&gt;&lt;?php echo $row-&gt;created_at ; ?&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;?php endforeach ; ?&gt;

&lt;/table&gt;</pre></div></li><li class="listitem">Create <a id="id224" class="indexterm"/>the <a id="id225" class="indexterm"/>model file, <code class="literal">limit_model.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Limit_model extends CI_Model {
    function __construct() {
        parent::__construct();
    }

    function get_all() {
        $query = $this-&gt;db-&gt;get('articles');
        return $query;
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec64"/>How it works...</h2></div></div></div><p>We start by loading the support assets in the constructor:</p><div class="informalexample"><pre class="programlisting">    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;helper('text');
        $this-&gt;load-&gt;model('Limit_model');
    }</pre></div><p>The <code class="literal">url</code> and <code class="literal">text</code> variable will <a id="id226" class="indexterm"/>provide support for the <code class="literal">redirect()</code> and <code class="literal">word_limit()</code> functions respectively, <a id="id227" class="indexterm"/>and the <code class="literal">Limit_model</code> class will support access with the database for us.</p><p>The <code class="literal">public function index()</code> <a id="id228" class="indexterm"/>function redirects us to the public function <code class="literal">view_all</code>, which calls the <code class="literal">get_all()</code> function of <code class="literal">Limit_model</code>:</p><div class="informalexample"><pre class="programlisting">        $data['query'] = $this-&gt;Limit_model-&gt;get_all();
        $this-&gt;load-&gt;view('limit/view_all', $data);</pre></div><p>The <code class="literal">get_all()</code> function will query the database with Active Record and pull out the contents, passing this back to our controller and saving it in the <code class="literal">$data</code> array (highlighted in the following code) where it is passed to the <code class="literal">limit/view_all</code> view file:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>        $data['query']</strong></span> = $this-&gt;Limit_model-&gt;get_all();
        $this-&gt;load-&gt;view('limit/view_all', <span class="strong"><strong>$data</strong></span>);</pre></div><p>If all works out as planned, you <a id="id229" class="indexterm"/>should see something similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/2308OS_04_01.jpg" alt="How it works..."/></div><p>You can see that the word count of the <span class="strong"><strong>Preview</strong></span> column is limited to 15 words, where it is capped and appended with three periods (<span class="strong"><strong>...</strong></span>).</p></div></div>
<div class="section" title="Using word_censor() for cleaning input"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Using word_censor() for cleaning input</h1></div></div></div><p>There may be times when <a id="id230" class="indexterm"/>you're building your application that you'll need to not only validate against unwanted data, but also check the content of that data for any unwanted words or phrases. For example, imagine that you're building a simple blogging engine and you don't want people replying to your blog posts with rude words and phrases—fair enough. So, what you need to do is to be able to look through the user input and filter out any unwanted content that might be present. CodeIgniter provides just this facility with the function <code class="literal">word_censor()</code>. Let's look at how to use it.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec65"/>Getting ready</h2></div></div></div><p>We're going to store our censored words in a database; so, we'll look for words that we'll use in place of actual rude words, such as <code class="literal">rude_word_number_1</code>, and so on.</p><p>Run the following MySQL code in your database:</p><div class="informalexample"><pre class="programlisting">CREATE TABLE `censored_words` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `word` varchar(255) NOT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=5 ;

INSERT INTO `censored_words` (`id`, `word`) VALUES
(1, 'rude_word_number_1'),
(2, 'rude_word_number_2'),
(3, 'rude_word_number_3'),
(4, 'rude_word_number_4');</pre></div><p>We will store the censored text in another table. For want of a better title, I've called that table <code class="literal">censor</code>. The following code is the schema for that table, which you can run in your database:</p><div class="informalexample"><pre class="programlisting">CREATE TABLE `censor` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `name` varchar(255) NOT NULL,
    `body` text NOT NULL,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec66"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create three <a id="id231" class="indexterm"/>files as shown:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/controllers/censor.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/views/censor/create.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">/path/to/codeigniter/application/models/censor_model.php</code></li></ul></div></li><li class="listitem">Create the controller file, <code class="literal">censor.php</code>, and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Censor extends CI_Controller {
    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;helper('text');
        $this-&gt;load-&gt;model('Censor_model');
    }

    public function index() {
        redirect('censor/create');
    }

    public function create() {
        $this-&gt;load-&gt;library('form_validation');
        $this-&gt;form_validation-&gt;set_error_delimiters('', '&lt;br /&gt;');
        $this-&gt;form_validation-&gt;set_rules('name', 'Name', 'required|min_length[1]|max_length[225]|trim');
        $this-&gt;form_validation-&gt;set_rules('body', 'Body', 'required|min_length[1]|max_length[2000]|trim');

        if ($this-&gt;form_validation-&gt;run() == FALSE) {
            $this-&gt;load-&gt;view('censor/create');
        } else {
            $query = $this-&gt;Censor_model-&gt;get_censored_words();
            $censored_words = array();

            foreach ($query-&gt;result() as $row) {
                $censored_words[] = $row-&gt;word;
            }

            $data = array(
                'name' =&gt; $this-&gt;input-&gt;post('name'),
                'body' =&gt; word_censor($this-&gt;input-&gt;post('body'), $censored_words, 'BOOM')
            );

            if ($this-&gt;Censor_model-&gt;create($data)) {
                echo 'Entered into DB:&lt;br /&gt;&lt;pre&gt;';
                var_dump($data);
                echo '&lt;/pre&gt;';
            }
        }
    }
}</pre></div></li><li class="listitem">Create the <a id="id232" class="indexterm"/>view file <code class="literal">create.php</code> at <code class="literal">/path/to/codeigniter/application/views/censor/</code> and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php echo validation_errors() ; ?&gt;
&lt;?php echo form_open('censor/create');?&gt;
    &lt;input type="text" name="name" size="20" value="&lt;?php echo set_value('body') ; ?&gt;" /&gt;
    &lt;br /&gt;
    &lt;textarea name="body"&gt;&lt;?php echo set_value('body') ; ?&gt;&lt;/textarea&gt;
    &lt;br /&gt;
&lt;?php echo form_submit('submit','Submit!') ; ?&gt;
&lt;?php echo form_close() ; ?&gt;</pre></div></li><li class="listitem">Create the model file <code class="literal">censor_model.php</code> at <code class="literal">/path/to/codeigniter/application/models/</code> and add the following code to it:<div class="informalexample"><pre class="programlisting">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Censor_model extends CI_Model {
    function __construct() {
        parent::__construct();
    }

    function get_censored_words() {
        $query = $this-&gt;db-&gt;get('censored_words');
        return $query;
    }

    function create($data) {
        if ($this-&gt;db-&gt;insert('censor', $data)) {
            return true;
        } else {
            return false;
        }
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec67"/>How it works...</h2></div></div></div><p>The constructor in our <a id="id233" class="indexterm"/>
<code class="literal">Censor</code> class loads our support files: the helpers <code class="literal">url</code> and <code class="literal">text</code>, and our model <code class="literal">Censor_model</code>:</p><div class="informalexample"><pre class="programlisting">    function __construct() {
        parent::__construct();
        $this-&gt;load-&gt;helper('url');
        $this-&gt;load-&gt;helper('text');
        $this-&gt;load-&gt;model('Censor_model');
    }</pre></div><p>The <code class="literal">public function index()</code> <a id="id234" class="indexterm"/>function redirects us to <code class="literal">public function create()</code> where we begin form validation. We load the form validation library and set the error delimiters, after which we set the rules for the form elements in the view file <code class="literal">create.php</code> at <code class="literal">/path/to/codeigniter/application//views/censor/</code>.</p><p>If there is an error, or the controller is being accessed for the first time, <code class="literal">$this-&gt;form_validation-&gt;run()</code> will equal <code class="literal">FALSE</code> and we shall just display the view file for the user to fill in.</p><p>However, once the form has been submitted (and assuming that there were no errors picked up by CodeIgniter's validation functionality), we now want to check the input for any unwanted words. To do that, we must first get a list of the unwanted words. As we're storing those words in the <a id="id235" class="indexterm"/>database table <code class="literal">censored_words</code>, we also should fetch them. So, we grab them from the database with the <code class="literal">censor_model</code> <a id="id236" class="indexterm"/>function <code class="literal">get_censored_words()</code>, and add them to an array called <code class="literal">$censored_words</code>:</p><div class="informalexample"><pre class="programlisting">$query = $this-&gt;Censor_model-&gt;get_censored_words();
$censored_words = array();

foreach ($query-&gt;result() as $row) {
    $censored_words[] = $row-&gt;word;
}</pre></div><p>We then build the <code class="literal">$data</code> array ready to be passed to the <code class="literal">Censor_model</code> function, <code class="literal">create()</code>. Take a look at the <code class="literal">body</code> element of the array, which I've highlighted in the following code:</p><div class="informalexample"><pre class="programlisting">$data = array(
    'name' =&gt; $this-&gt;input-&gt;post('name'),
    'body' =&gt; word_censor($this-&gt;input-&gt;post('body'), $censored_words, 'BOOM')
   	);</pre></div><p>Here, we call the text helper <a id="id237" class="indexterm"/>function, <code class="literal">word_censor()</code>, passing the string that we wish to check. In this case, the body forms items from the submitted form, along with the array of censored words as a second parameter; the third parameter is optional. Leaving the third parameter blank will cause CodeIgniter to replace a censored word with the default string <code class="literal">####</code>. However, for this recipe we're replacing each censored word with the string <code class="literal">BOOM</code>.</p><p>The <code class="literal">$data</code> array is <a id="id238" class="indexterm"/>then written to the database table, <code class="literal">censor</code> (I really must think of a better name for that table).</p><p>Let's take it for a spin. Run the censor controller in your browser and you should see an output similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/2308OS_04_02.jpg" alt="How it works..."/></div><p>Here, we have entered the <a id="id239" class="indexterm"/>values <code class="literal">Rob</code> and <code class="literal">rude_word_number_1 TOWN</code>. When you click on the <span class="strong"><strong>Submit</strong></span> button you should see the array <code class="literal">var_dump</code> of <code class="literal">$data</code> showing:</p><div class="informalexample"><pre class="programlisting">Entered into DB:
array(2) {
  ["name"]=&gt;
  string(3) "Rob"
  ["body"]=&gt;
  string(9) "BOOM TOWN"
}</pre></div><p>If you see <span class="strong"><strong>BOOM TOWN</strong></span>, you know it has worked!</p></div></div></body></html>