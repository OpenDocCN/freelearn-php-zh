<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;9.&#xA0;Building REST APIs" id="2BASE1-edcc22b134104d5db0bf3aa086c86851"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09" class="calibre1"/>Chapter 9. Building REST APIs</h1></div></div></div><p class="calibre8">Most non-developers probably think that creating applications means building either software for your PC or Mac, games, or web pages, because that is what they can see and use. But once you join the developers' community, either by your own or professionally, you will eventually realize how much work is done for applications and tools that do not have a user interface.</p><p class="calibre8">Have you ever wondered how someone's website can access your Facebook profile, and later on, post an automatic message on your wall? Or how websites manage to send/receive information in order to update the content of the page, without refreshing or submitting any form? All of these features, and many more interesting ones, are possible thanks to the integration of applications working "behind the scenes". Knowing how to use them will open the doors for creating more interesting and useful web applications.</p><p class="calibre8">In this chapter, you will learn the following:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Introduction to APIs and REST APIs, and their use</li><li class="listitem">The foundation of REST APIs</li><li class="listitem">Using third-party APIs</li><li class="listitem">Tools for REST API developers</li><li class="listitem">Designing and writing REST APIs with Laravel</li><li class="listitem">Different ways of testing your REST APIs</li></ul></div></div>

<div class="book" title="Chapter&#xA0;9.&#xA0;Building REST APIs" id="2BASE1-edcc22b134104d5db0bf3aa086c86851">
<div class="book" title="Introducing APIs"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch09lvl1sec73" class="calibre1"/>Introducing APIs</h1></div></div></div><p class="calibre8">
<span class="strong"><strong class="calibre2">API</strong></span> <a id="id733" class="calibre1"/>stands for <span class="strong"><strong class="calibre2">Application Program Interface</strong></span>. Its goal is to provide an interface so that other programs can send commands that will trigger some process inside the application, possibly returning some output. The concept might seem a bit abstract, but in fact, there are APIs virtually in everything which is somehow related to computers. Let's see some real life examples:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Operating systems or OS, like Windows or Linux, are the programs that allow you to use computers. When you use any application from your computer, it most probably needs to talk to the OS in one way or another, for example by requesting a certain file, sending some audio to the speakers, and so on. All these interactions between the application and the OS are possible thanks to the APIs that the OS provides. In this way, the application need not interact with the hardware straight away, which is a very tiring task.</li><li class="listitem">To interact with the user, a mobile application provides a GUI. The interface captures all the events that the user triggers, like clicking or typing, in order to send them to the server. The GUI communicates with the server using an API in the same way the program communicates with the OS as explained earlier.</li><li class="listitem">When you<a id="id734" class="calibre1"/> create a website that needs to display tweets from the user's Twitter account, you need to communicate with Twitter. They provide an API that can be accessed via HTTP. Once authenticated, by sending the correct HTTP requests, you can update and/or retrieve data from their application.</li></ul></div><p class="calibre8">As you can see, there are different places where APIs are useful. In general, when you have a system that should be accessed externally, you need to provide potential users an API. When we say externally, we mean from another application or library, but it can very well be inside the same machine.</p></div></div>
<div class="book" title="Introducing REST APIs" id="2C9D01-edcc22b134104d5db0bf3aa086c86851"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec74" class="calibre1"/>Introducing REST APIs</h1></div></div></div><p class="calibre8">REST APIs<a id="id735" class="calibre1"/> are a specific type of APIs. They use HTTP as the protocol to communicate with them, so you can imagine that they will be the most used ones by web applications. In fact, they are not very different from the websites that you've already built, since the client sends an HTTP request, and the server replies with an HTTP response. The difference here is that REST APIs make heavy use of HTTP status codes to understand what the response is, and instead of returning HTML resources with CSS and JS, the response uses JSON, XML, or any other document format with just information, and not a graphic user interface.</p><p class="calibre8">Let's take an example. The Twitter API, once authenticated, allows developers to get the tweets of a given user by sending an HTTP GET request to <code class="email">https://api.twitter.com/1.1/statuses/user_timeline.json</code>. The response to this request is an HTTP message with a JSON map of tweets as the body and the status code 200. We've already mentioned status code in <a class="calibre1" title="Chapter 2. Web Applications with PHP" href="part0019_split_000.html#I3QM2-edcc22b134104d5db0bf3aa086c86851">Chapter 2</a>, <span class="strong"><em class="calibre12">Web Applications with PHP</em></span>, but we will review them shortly.</p><p class="calibre8">The REST API also allows developers to post tweets on behalf of the user. If you were already authenticated, as in the previous example, you just need to send a POST request to <code class="email">https://api.twitter.com/1.1/statuses/update.json</code> with the appropriate POST parameters in the body, like the text that you want to tweet. Even though this request is not a GET, and thus, you are not requesting data but rather sending it, the response of this request is quite important too. The server will use the status codes of the response to let the requester know if the tweet was posted successfully, or if they could not understand the request, there was an internal server error, the authentication was not valid, and so on. Each of these scenarios has a different status code, which is the same across all applications. This makes it very easy to communicate with different APIs, since you will not need to learn a new list of status code each time. The server can also add some extra information to the body in order to throw some light on why the error happened, but that will depend on the application.</p><p class="calibre8">You can imagine<a id="id736" class="calibre1"/> that these REST APIs are provided to developers so they can integrate them with their applications. They are not user-friendly, but HTTP-friendly.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="The foundations of REST APIs"><div class="book" id="2D7TI2-edcc22b134104d5db0bf3aa086c86851"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec75" class="calibre1"/>The foundations of REST APIs</h1></div></div></div><p class="calibre8">Even though <a id="id737" class="calibre1"/>REST APIs do not have an official standard, most developers agree on the same foundation. It helps that HTTP, which is the protocol that this technology uses to communicate, does have a standard. In this section, we will try to describe how REST APIs should work.</p></div>

<div class="book" title="The foundations of REST APIs">
<div class="book" title="HTTP request methods"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch09lvl2sec145" class="calibre1"/>HTTP request methods</h2></div></div></div><p class="calibre8">We've already <a id="id738" class="calibre1"/>introduced the idea of HTTP <a id="id739" class="calibre1"/>methods in <a class="calibre1" title="Chapter 2. Web Applications with PHP" href="part0019_split_000.html#I3QM2-edcc22b134104d5db0bf3aa086c86851">Chapter 2</a>, <span class="strong"><em class="calibre12">Web Applications with PHP</em></span>. We explained that an HTTP method is just the verb of the request, which defines what kind of action it is trying to perform. We've already defined this method when working with HTML forms: the <code class="email">form</code> tag can get an optional attribute, <code class="email">method</code>, which will make the form submit with that specific HTTP method.</p><p class="calibre8">You will not use forms when working with REST APIs, but you can still specify the method of the request. In fact, two requests can go to the same endpoint with the same parameters, headers, and so on, and yet have completely different behaviors due to their methods, which makes them a very important part of the request.</p><p class="calibre8">As we are giving so much importance to HTTP methods in order to identify what a request is trying to do, it is natural that we will need a handful of them. So far, we have introduced GET and POST, but there are actually eight different methods: GET, POST, PUT, DELETE, OPTIONS, HEAD, TRACE, and CONNECT. You will usually work with just four of them. Let's look at them in detail.</p><div class="book" title="GET"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch09lvl3sec23" class="calibre1"/>GET</h3></div></div></div><p class="calibre8">When a request uses the <a id="id740" class="calibre1"/>GET method, it means that it is requesting for information <a id="id741" class="calibre1"/>about a given entity. The endpoint should contain information of what that entity is, like the ID of a book. GET can also be used to query for a list of objects, either all of them, filtered, or paginated.</p><p class="calibre8">GET requests can add extra information to the request when needed. For example, if we are try to retrieve all the books that contain the string "rings", or if we want the page number 2 of the full list of books. As you already know, this extra information is added to the query string as GET parameters, which is a list of key-value pairs concatenated by an ampersand (<code class="email">&amp;</code>). So, that means that the request for <code class="email">http://bookstore.com/books?year=2001&amp;page3</code> is probably used for getting the second page of the list of books published during 2001.</p><p class="calibre8">REST APIs have extensive documentation on the available endpoints and parameters, so it should be easy for you to learn to query properly. Still, even though it will be documented, you should expect parameters with intuitive names, like the ones in the example.</p></div><div class="book" title="POST and PUT"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch09lvl3sec24" class="calibre1"/>POST and PUT</h3></div></div></div><p class="calibre8">POST<a id="id742" class="calibre1"/> is the second type of HTTP method that you <a id="id743" class="calibre1"/>already know about. You used it in forms with the<a id="id744" class="calibre1"/> intention of "posting" data, that is, trying to update a resource on the server side. When you wanted to add or update a new book, you sent a POST request with the data of the book as the POST parameters.</p><p class="calibre8">POST parameters are sent in a format similar to the GET parameters, but instead of being part of the query string, they are included as part of the request's body. Forms in HTML are already doing that for you, but when you need to talk to a REST API, you should know how to do this by yourself. In the next section, we will show you how to perform POST using tools other than forms. Also note that you can add any data to the body of the request; it is quite common to send JSON in the body instead of POST parameters.</p><p class="calibre8">The PUT method<a id="id745" class="calibre1"/> is quite similar to the POST method. This too tries to add or update data on the server side, and for this purpose, it also adds extra information on the body of the request. Why should we have two different methods that do the same thing? There are actually two main differences between these methods:</p><div class="book"><ul class="itemizedlist"><li class="listitem">PUT requests either create a resource or update it, but the affected resource is the one defined by the endpoint and nothing else. That means that if we want to update a book, the endpoint should state that the resource is a book, and specify it, for example, <code class="email">http://bookstore.com/books/8734</code>. On the other hand, if you do not identify the resource to be created or updated in the endpoint, or you affect other resources at the same time, you should use POST requests.</li><li class="listitem">Idempotent is a complicated word for a simple concept. An idempotent HTTP method is one that can be called many times, and the result will always be the same. For example, if you are trying to update the title of a book to "Don Quixote", it does not matter how many times you call it, the result will always be <a id="id746" class="calibre1"/>the same: the resource will have the title "Don Quixote". On <a id="id747" class="calibre1"/>the other hand, non-idempotent methods might return different results when executing the same request. An example could be an endpoint that increases the stock of some book. Each time you call it, you will increase the stock more<a id="id748" class="calibre1"/> and more, and thus, the result is not the same. PUT requests are idempotent, whereas POST requests are not.</li></ul></div><p class="calibre8">Even with this explanation in mind, misusing POST and PUT is quite a common mistake among developers, especially when they lack enough experience in developing REST APIs. Since forms in HTML only send data with POST and not PUT, the first one is more popular. You might find REST APIs where all the endpoints that update data are POST, even though some of <a id="id749" class="calibre1"/>them should be PUT.</p></div><div class="book" title="DELETE"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch09lvl3sec25" class="calibre1"/>DELETE</h3></div></div></div><p class="calibre8">The <a id="id750" class="calibre1"/>DELETE HTTP method is quite self-explanatory. It is used when you want to delete a resource on the server. As with PUT requests, <a id="id751" class="calibre1"/>DELETE endpoints should identify the specific resource to be deleted. An example would be when we want to remove one book from our database. We could send a DELETE request to an endpoint similar to <code class="email">http://bookstore.com/books/23942</code>.</p><p class="calibre8">DELETE requests just delete resources, and they are already determined by the URL. Still, if you need to send extra information to the server, you could use the body of the request as you do with POST or PUT. In fact, you can always send information within the body of the request, including GET requests, but that does not mean it is a good practice to do so.</p></div></div></div></body></html>