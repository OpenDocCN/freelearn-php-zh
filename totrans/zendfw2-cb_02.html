<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Translating and Mail Handling"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Translating and Mail Handling</h1></div></div></div><p>In this chapter we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Translating your application</li><li class="listitem" style="list-style-type: disc">Localizing your application</li><li class="listitem" style="list-style-type: disc">Sending mail</li><li class="listitem" style="list-style-type: disc">Receiving mail</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Introduction</h1></div></div></div><p>An application wouldn't be an application if it couldn't react to the users. One simple but effective way of reacting is obviously displaying text and sending e-mails. Over the last couple of years internationalization (i18n) and localization (l10n) have become increasingly important. Nowadays users expect to be greeted in their language, and even receive automated e-mails from applications in a normal day's work.</p></div></div>
<div class="section" title="Translating your application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Translating your application</h1></div></div></div><p>In this recipe we will be using the <a id="id60" class="indexterm"/>
<span class="strong"><strong>Zend Framework 2</strong></span> skeleton as a<a id="id61" class="indexterm"/> base, but we will create a new module to show how<a id="id62" class="indexterm"/> it all works.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Getting ready</h2></div></div></div><p>For this recipe, we assume that you have a working Zend Framework 2 application/skeleton in place. To ensure that we can actually run the code that we produce in the recipe, we need to make sure that the <code class="literal">intl</code> and <code class="literal">gettext</code> extensions in PHP are enabled.</p><p>For translating <a id="id63" class="indexterm"/>the strings we will be using <span class="strong"><strong>Poedit</strong></span>, a cross-platform open source application used for translating <code class="literal">gettext</code> catalogs. The current version is 1.5.5 and can be <a id="id64" class="indexterm"/>found at <a class="ulink" href="http://www.poedit.net/">http://www.poedit.net/</a> website. We are using gettext as this is a widely used internationalization and localization system for writing<a id="id65" class="indexterm"/> multilingual applications. The files generated by Poedit have the extensions <code class="literal">.po</code> or <code class="literal">.mo</code>. The <code class="literal">.po</code> file<a id="id66" class="indexterm"/> is used for editing; let's say this is an uncompiled translation file. The <code class="literal">.mo</code> file<a id="id67" class="indexterm"/> is the compiled<a id="id68" class="indexterm"/> translation file, which is used in our application.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>How to do it…</h2></div></div></div><p>In this recipe we will talk about getting our application translated, something that is of much use in applications nowadays.</p><div class="section" title="Setting up and checking the essentials"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec24"/>Setting up and checking the essentials</h3></div></div></div><p>We will <a id="id69" class="indexterm"/>assume that we have at least a basic module<a id="id70" class="indexterm"/> set up, containing a simple <code class="literal">IndexController</code> that outputs a simple View.</p><p>First thing we want to do is make sure we have a language directory in our module structure as shown in the following code:</p><div class="informalexample"><pre class="programlisting">SampleModule/
  config/
    module.config.php
  <span class="strong"><strong>language</strong></span>/
  src/
    SampleModule/
      Controller/
        IndexController.php
  view/
    samplemodule/
      index/
        index.phtml
  Module.php</pre></div><p>In this directory all the <code class="literal">gettext</code> files will be stored, which will make it easier for us to control them. Now, we have set up a simple folder structure, we need to make sure the module configuration also knows what we are doing. Now, we open up the <code class="literal">module.config.php</code> and add the following lines to the array:</p><div class="informalexample"><pre class="programlisting">// We want to have our translator available through the 
// ServiceManager.
'service_manager' =&gt; array(
  'factories' =&gt; array(
    // Make our translator available in the 
    // ServiceManager so we can retrieve it under the 
    // 'translator' key.
    'translator' =&gt; 'Zend\I18n\Translator\TranslatorServiceFactory',
  ),
),

// Now to configure the Translator
'translator' =&gt; array(
  'locale' =&gt; 'en_US',

  // We would like using file patterns when matching 
  // i18n files, as that makes our lives so much easier, 
  // this is default in the skeleton.
  'translation_file_patterns' =&gt;array(
    array(
      // The type of i18n we want to use is gettext.
      'type'     =&gt; 'gettext',

      // Here we define our i18n file directory, this is 
      // the directory we just made.
      'base_dir' =&gt; __DIR__ . '/../language',

      // We want to match our i18n files through this 
      // pattern, what will be for example 'nl_NL.mo'.
      'pattern'  =&gt; '%s.mo',
    ),
  ),
),</pre></div><p>With the<a id="id71" class="indexterm"/> above configuration we have set up our module <a id="id72" class="indexterm"/>exactly the way we need it to look That's it; our module is now set up to use i18n.</p></div><div class="section" title="Translating strings in the controller"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec25"/>Translating strings in the controller</h3></div></div></div><p>Once we have <a id="id73" class="indexterm"/>set up the translator, translating strings <a id="id74" class="indexterm"/>couldn't be simpler. In the following example (file: <code class="literal">/module/Application/src/Application/Controller/IndexController.php</code>) we will translate the strings in the controller, but this is not good practice if used in the real <a id="id75" class="indexterm"/>world<a id="id76" class="indexterm"/> and is only shown here as an example:</p><div class="informalexample"><pre class="programlisting">&lt;?php

// Set our namespace
namespace Application\Controller;

// We need to use the following abstract on our 
// controller
use Zend\Mvc\Controller\AbstractActionController;

// Begin our index controller class

class IndexController extends AbstractActionController
{
  // We can use this property to translate the strings, 
  // or do some other translator related stuff.
  public $i18n;

  // Lets attach the setLocale to the dispatch event, so 
  // it will be run before the action logic is executed
  public function setEventManager(EventManagerInterface $events) 
  {
    // Instantiate the i18n through our ServiceLocator.
    parent::setEventManager($events);

    // We want to use this controller in our event
    $c = $this;

    // Attach our locale setting to the dispatch event
    $events-&gt;attach(
      'dispatch', 

      // Variable $e is a Zend\Mvc\MvcEvent
      function ($e) use ($c) 
      {
        // Put our translator in a local property
        $c-&gt;i18n = $this-&gt;getServiceLocator()
                        -&gt;get('translator'); 

        // while we are here, let's change the locale 
        // to Dutch.
        $c-&gt;i18n-&gt;setLocale('nl_NL');
      }, 

      // Make sure this event is triggered before the 
      // action execution
      100
    ); 

    // Return our selves
    return $this;
  }
	
  public function indexAction()
  {
    // Now simply translate this string with our i18n.
    $myTranslatedString = $this-&gt;i18n
                               -&gt;translate("And how about me?");
  }
}</pre></div></div><div class="section" title="Translating strings in the View"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec26"/>Translating strings in the View</h3></div></div></div><p>Translation <a id="id77" class="indexterm"/>in the view is even simpler than the controller (and that was pretty simple already). The only thing we need is the string that we want to <a id="id78" class="indexterm"/>translate, and that's it. We do the following alterations to the <code class="literal">index.phtml</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;?php
  // Translate and display this text.
  echo $this-&gt;translate(
      "Hello, I am a translated text!"
  );</pre></div></div><div class="section" title="Translating strings with Poedit"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec27"/>Translating strings with Poedit</h3></div></div></div><p>Once we have<a id="id79" class="indexterm"/> installed Poedit, we need to set a couple of <a id="id80" class="indexterm"/>settings before we can start translating strings. Gettext<a id="id81" class="indexterm"/> works with files that are called catalogs. Catalogs are files that represent the source and translated text for one specific language.</p><p>First of all we should create a new catalog. After typing the first tab with the project name and language we want to translate (for example, nl-NL), we should go to the second tab called sources paths. That path should contain the path to the sources we would like to translate and is most likely per module, which means the base path should be the module directory.</p><p>In the <a id="id82" class="indexterm"/>third tab there should be a couple of identifiers <a id="id83" class="indexterm"/>to which Poedit can identify which strings <a id="id84" class="indexterm"/>should be translated or not. Because we will be using the <code class="literal">translate()</code> method, we need to make sure that at least the word 'translate' is in the list, we can keep the rest in there however as they won't do any harm.</p><p>After we have done all that we can, click on <span class="strong"><strong>OK</strong></span> and choose a location to save our file. This file needs to be saved in the languages directory within the module, and should have a name pattern, for example, <code class="literal">nl_NL.po</code>, <code class="literal">en_GB.po</code>, <code class="literal">en_US.po</code>. The naming convention for the file is <code class="literal">[language]_[COUNTRY]</code>; some countries (for example, Belgium and Canada) have multiple state languages which also need to be defined.</p><p>Once saved, press the <span class="strong"><strong>Update</strong></span> button, which will result in the code being scanned for translatable strings. Now a new list appears with all the strings that can be translated. We can easily put our translation in the <span class="strong"><strong>Translation</strong></span> box and save.</p><p>If we have done all that, our screen might look similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/4841OS_02_01.jpg" alt="Translating strings with Poedit"/></div><p>Congratulations, we have now successfully created an i18n application!</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>How it works…</h2></div></div></div><p>There are multiple ways of translating strings in ZF2, and all of them are relatively easy to do. </p><div class="section" title="Basic set up of translation in your module"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec28"/>Basic set up of translation in your module</h3></div></div></div><p>Although the <code class="literal">Application</code> module has an already set up translation functionality, this might<a id="id85" class="indexterm"/> not be what we want to use <a id="id86" class="indexterm"/>throughout our application. For instance, if we are (and we will be) using different modules, we wouldn't like to use the translation file in the <code class="literal">Application</code> module as that would make it less dynamic.</p><p>If we would use the same <code class="literal">gettext</code> file in all our modules, and store that in the <code class="literal">Application</code> module, this would mean that if we don't use a specific module, the translations would be loaded in anyway. Of course this would mean more memory use which we shouldn't have used.</p><p>That is why <a id="id87" class="indexterm"/>it is a good idea to set up<a id="id88" class="indexterm"/> translation for every module separately.</p><p>Translation within ZF2 works, obviously, because of the <code class="literal">Zend\I18n\Translator\Translator</code> class. This class then looks at the configuration and loads up the relevant <code class="literal">Zend\I18n\Translator\Loader</code> which we require. If found, it will look what the current selected locale, (which we have set through <code class="literal">setLocale()</code>) is (for example, <code class="literal">nl_NL</code>, <code class="literal">en_GB</code>, <code class="literal">en_US</code>, and so on) and then parse the relevant translation file—<code class="literal">.mo</code> for gettext, <code class="literal">.ini</code> for INI, <code class="literal">.php</code> for PHP Array, and so on—and let is parse through the loader.</p><p>Once we call the <code class="literal">translate()</code> or <code class="literal">translatePlural()</code> method, the translator will search for the <a id="id89" class="indexterm"/>relevant untranslated string in the session. If found, it can easily return the translated string, but in the case of a string which isn't translated, it will just return the untranslated string.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>There's more…</h2></div></div></div><p>Instead of using gettext, there are also several other methods that can be used as translation files. By default ZF2 has the option to use one of the following formats:</p><div class="section" title="PHP array"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec29"/>PHP array</h3></div></div></div><p>Although this<a id="id90" class="indexterm"/> is a viable and easy method of translating, personally I wouldn't recommend it. My personal experience is that the usage of this method limits the use of the translation files to PHP. For example, gettext is an industry standard, which can be used by many platforms and applications.</p><p>In the language directory we would name the PHP files in the format <code class="literal">[language]_[COUNTRY].php</code>, for example <code class="literal">nl_NL.php</code>. Our <code class="literal">module.config.php</code> would need an entry as shown in the following code:</p><div class="informalexample"><pre class="programlisting">'translator' =&gt; array(
  'locale' =&gt; 'en_US',
  'translation_file_patterns' =&gt;array(
    array(
      // This is the method we want to use.
      'type' =&gt; 'phparray',

      // We tell the config that our translations can be 
      // found in the language directory.
      'base_dir' =&gt; __DIR__ . '/../language',

      // It will now search for files like en_US.php and 
      // nl_NL.php.
      'pattern' =&gt; '%s.php',
    ),
  ),
),</pre></div><p>When this is <a id="id91" class="indexterm"/>defined in the <code class="literal">module.config.php</code> file, the translation itself will work exactly the same, the translation files (for example, <code class="literal">nl_NL.php</code>) will look similar as in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?php

// We need to return an array with the translated 
// strings.
return array(

  // The key is the untranslated string, while the value 
  // is the translated text.
  'And how about me?'=&gt; 'En hoe zit het met mij?',

  // More translations here [..]
);</pre></div></div><div class="section" title="Gettext"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec30"/>Gettext</h3></div></div></div><p>We used this format in the preceding examples, and as we could see they are easily editable by an <a id="id92" class="indexterm"/>application such as Poedit. According to Wikipedia, the most <a id="id93" class="indexterm"/>commonly used implementation of gettext is GNU gettext. Editing a gettext <a id="id94" class="indexterm"/>file is done in a so-called <code class="literal">.po</code> file where po stands for <span class="strong"><strong>portable object</strong></span>
<a id="id95" class="indexterm"/>, and once the files are compiled for use they will be placed in a <code class="literal">.mo</code> file where mo stands for <a id="id96" class="indexterm"/>
<span class="strong"><strong>machine object</strong></span>.</p><p>We can find the<a id="id97" class="indexterm"/> translation tool Poedit on the <a class="ulink" href="http://www.poedit.net/">http://www.poedit.net/</a> website.</p></div><div class="section" title="Ini"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec31"/>Ini</h3></div></div></div><p>The way this <code class="literal">ini</code> works is basically the same as any other method described earlier. The files<a id="id98" class="indexterm"/> in the language directory can be named <code class="literal">[locale].ini</code> (for example, <code class="literal">nl_NL.ini</code>), and in the <code class="literal">module.config.php</code> we would have an entry something like shown in the following code:</p><div class="informalexample"><pre class="programlisting">'translator' =&gt; array(
  'locale' =&gt;array('en_US', 'nl_NL'),
  'translation_file_patterns' =&gt;array(
    array(
      'type' =&gt; 'ini',
      'base_dir' =&gt; __DIR__ . '/../language',
      'pattern' =&gt; '%s.ini',
    ),
  ),
),</pre></div><p>As we can see we have defined two locales in our configuration, which means that these two are our available i18n's, but our <code class="literal">en_US</code> is our fallback locale. The fallback locale is used when no suitable locale can be found. Our translation files (<code class="literal">nl_NL.ini</code>) would then be looking something like the following example:</p><div class="informalexample"><pre class="programlisting">translation.0.message = "And how about me?"
translation.0.translation = "En hoe zit het met mij?"

translation.1.message = "Hello, I am a translated text!"
translation.1.translation = "Hallo, ik ben een vertaaldetekst!"</pre></div><p>We would always start a translation with <code class="literal">translation.X</code>, where <code class="literal">X</code> is a number which isn't used before. We should think of this as an INI array, similar to how it would work in PHP.</p></div></div></div>
<div class="section" title="Localizing your application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Localizing your application</h1></div></div></div><p>In this<a id="id99" class="indexterm"/> recipe, we will explain localization and its uses. Localization<a id="id100" class="indexterm"/> differs from internationalization in the way that localization refers to, for example, numeric, date and time formats, and the use of currency.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>How to do it…</h2></div></div></div><p>In this recipe we will be discussing the ever so important localization of our application.</p><div class="section" title="So it begins"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec32"/>So it begins</h3></div></div></div><p>When a user hits our website, we most likely want the user to automatically go to the right language. Although, there are several methods of doing this, we will be using a manual check to <a id="id101" class="indexterm"/>see if the language the user prefers is also in our list of <a id="id102" class="indexterm"/>languages.</p><p>We do this by a couple of simple tricks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">First, we are getting the <code class="literal">Accept-Language</code> headers from the HTTP request</li><li class="listitem" style="list-style-type: disc">Then we iterate through them and see if one of the languages mentioned in the header matches the language we have</li><li class="listitem" style="list-style-type: disc">Lastly, we set the language to the language we have found, or if nothing is found, the fallback language is set</li></ul></div><p>Let's see how this looks in our <code class="literal">Module.php</code> code:</p><div class="informalexample"><pre class="programlisting">// We will be using a modified version of the default 
// Module.php which comes with the Application module on 
// the ZF2 Skeleton.
namespace Application;

// onBootStrap requires a McvEvent.
use Zend\Mvc\MvcEvent;</pre></div><p>First, we need to start off by declaring the namespace (in our case <code class="literal">Application</code>) as we want the framework to know where to find our code. We then want to make sure we always put all the required classes in the use declaration so that we preload these before we go further in the code.</p><div class="informalexample"><pre class="programlisting">// Start of our Module class
class Module
{
  // Private storage of all our local languages
  // available.
  private $locales;
    
  /**
   * Retrieves any locale that is available in the 
   * language directory. This
   * assumes that our language directory contains files 
   * in the format of en_GB.ext, nl_NL.ext.
   */
  private function retrieveLocales()
  {
    // If we haven't already got all the locales,
    // please do it now.
    if ($this-&gt;locales === null) {
      $handle = opendir(__DIR__. '/language');
      $locales = array();

     if ($handle !== false) {
       // Loop through the directory
       while (false !== ($entry = readdir($handle))) {
         if ($entry === '..' || $entry === '.') {
            continue;
          }
          
         // We only want the front part of the filename
          $split = explode('.', $entry);
          
          // Split[0] should be en_GB if the file is 
          // en_GB.ext.
          if (in_array($split[0], $locales) === false) {
            $locales[] = $split[0];
          }

          unset($split);
        }
        
        // We are done, now close the directory again
        closedir($handle);
      }
    
      // Make sure the locale is available for next time
      $this-&gt;locales = $locales;
      
      unset($handle, $locales);
    }

    // Return our available locales
    return $this-&gt;locales;
  }</pre></div><p>In the <code class="literal">retrieveLocales()</code> method<a id="id103" class="indexterm"/> we are parsing through<a id="id104" class="indexterm"/> the languages directory and assume <a id="id105" class="indexterm"/>our filenames are called <code class="literal">en_GB.ext</code>. This way we can parse all the languages easily into one array:</p><div class="informalexample"><pre class="programlisting">public function onBootstrap(MvcEvent $e)
{
  // Retrieve the HTTP headers of the user's request
  $headers = $e-&gt;getApplication()
               -&gt;getRequest()
               -&gt;getHeaders();

  // Get the translator
  $translator = $e-&gt;getApplication()
                  -&gt;getServiceManager()
                  -&gt;get('translator');

  // Check if we have a user that accepts specific 
  // languages.
  if ($headers-&gt;has('Accept-Language')) {
    // Retrieve our locales that our user accepts
    $headerLocales = $headers-&gt;get('Accept-Language')
                             -&gt;getPrioritized();

    // Retrieve the locales that we have in our system
    $locales = $this-&gt;retrieveLocales();

    // Make sure that our fallback has been set in 
    // case we couldn't find a locale
    $translator-&gt;setFallbackLocale('en_US');
      
    // Go through all accepted languages, most of the 
    // time this will be only 1 or 2 languages.
    foreach ($headerLocales as $locale) {
      // getLanguage retrieves languages in a en-GB 
      // manner, but ZF2 only supports the underscore, 
      // like en_GB.
      $language = str_replace(
        '-', 
        '_', 
        $locale-&gt;getLanguage()
      );

      // See if this is a language we support in our application.
      if (in_array($language, $locales) === true) {
       // We have found our *exact* match
        break;
      }
    }
      
    // Now set our locale 
    $translator-&gt;setLocale($language);
  }
}

// We can just use the methods that are already in the 
// module.php, let's not repeat that code here.  
public function getConfig() {}

public function getAutoloaderConfig() {}
}
</pre></div><p>As we<a id="id106" class="indexterm"/> can see in the previous code, what we try to achieve is to see if <a id="id107" class="indexterm"/>we have an exact match with any of the language (<code class="literal">en_GB</code>, <code class="literal">nl_NL</code>) that we support. If we don't have an exact match we already made sure our fallback language (<code class="literal">en_US</code>) is being used.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>Please make sure that the <code class="literal">intl</code> extension of PHP is enabled in the configuration, otherwise this example will not work correctly.</p></div></div></div><div class="section" title="Localizing currencies"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec33"/>Localizing currencies</h3></div></div></div><p>In Zend Framework 2 localizing currencies within a View can be done through the i18n view helper, which<a id="id108" class="indexterm"/> comes standard with ZF2. The view <a id="id109" class="indexterm"/>helper, which is called <code class="literal">CurrencyFormat</code>, can easily be used in the view by the following method call. We do the following alterations to the <code class="literal">sometemplate.phtml</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;?php

// We always use $this for accessing a view helper.
echo $this-&gt;currencyFormat(45312.56, "EUR", "nl_NL");</pre></div><p>This piece of code will give the output <code class="literal">45.312,56 €</code>, as we specified to localize to a Euro currency symbol with a Dutch localization format, which in this case is dot for thousands<a id="id110" class="indexterm"/> and a comma for decimal separation. We <a id="id111" class="indexterm"/>can also leave the locale <code class="literal">nl_NL</code> out, and then the <code class="literal">CurrencyFormat</code> view helper will automatically select the default locale of the application.</p></div><div class="section" title="Localizing date/times"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec34"/>Localizing date/times</h3></div></div></div><p>To format any<a id="id112" class="indexterm"/> dates and times in our applications we <a id="id113" class="indexterm"/>can use the <code class="literal">DateFormat</code> view helper, which is just as easy to use as the currency view helper, but has a few more options to use. We do the following alterations to the <code class="literal">sometemplate.phtml</code> file.</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo $this-&gt;dateFormat(
    // Format the current UNIX timestamp.
    time(),

    // Our date is to be a LONG date format.
    IntlDateFormatter::LONG,

    // We want to omit the time, defining this is 
    // optional as the default is NONE.
    IntlDateFormatter::NONE
);</pre></div><p>The preceding code will only display the date, which is going to be formatted as <code class="literal">Monday, May 14, 2012 AD</code>. We can omit giving any parameters, but then nothing will be displayed as the default options are <code class="literal">IntlDateFormatter::NONE</code>.</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/>How it works…</h2></div></div></div><p>Localization (l10n) is like internationalization (i18n), a very important aspect of a public application. We <a id="id114" class="indexterm"/>spoke about how to make sure your application can <a id="id115" class="indexterm"/>be translatable in the last recipe, but now it is time to make sure that we are able to find out how to use any l10n.</p><p>Zend Framework 2 works closely together with the i18n/l10n functionality that is already built in PHP. Although, we could use the <code class="literal">Locale</code> class of PHP separately of the ZF2 classes, it is not <a id="id116" class="indexterm"/>recommended as the ZF2 already use <a id="id117" class="indexterm"/>the Locale from PHP itself, but provide a much nicer and quicker interface to it.</p><p>In the background, however, ZF2 communicates directly with the <code class="literal">Locale</code> of PHP itself, but if we want to use the more robust functionalities, we should use the ZF2 libraries (which are handy when we are creating multilingual web applications).</p><div class="section" title="Identifying the client language"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec35"/>Identifying the client language</h3></div></div></div><p>The previous <a id="id118" class="indexterm"/>example code relies on the client browser sending the <code class="literal">Accept-Language</code> header. Although most modern browsers do this, it's still something that might not always work. Overall it is a pretty good tool to preselect any languages.</p><p>Instead of making everything ourselves like shown previously, there is also a very nifty module called <code class="literal">SlmLocale</code>
<a id="id119" class="indexterm"/> made by <span class="emphasis"><em>Jurian Sluiman</em></span> (<a class="ulink" href="https://github.com/juriansluiman/SlmLocale">https://github.com/juriansluiman/SlmLocale</a>) which we can recommend for detecting and <a id="id120" class="indexterm"/>selecting the default locale.</p></div><div class="section" title="Localizing currencies and dates"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec36"/>Localizing currencies and dates</h3></div></div></div><p>Localizing<a id="id121" class="indexterm"/> currencies and dates are usually done in View, as<a id="id122" class="indexterm"/> it basically is only formatting a piece of <a id="id123" class="indexterm"/>information. You can do it somewhere else but we should <a id="id124" class="indexterm"/>always be wary to make sure we won't localize anything in, for example, models, as they only should contain logic. In most cases the language is not part of the logic, but simply a nice way of making the view a bit more user friendly.</p></div></div></div>
<div class="section" title="Sending mail"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Sending mail</h1></div></div></div><p>Sending e-mail through <code class="literal">sendmail</code> is usually a pretty standard way of working, as it is probably one<a id="id125" class="indexterm"/> of the most used ways of transporting e-mail (or proxying the<a id="id126" class="indexterm"/> e-mail to an SMTP server) on a Linux-based system. On most Linux servers <code class="literal">sendmail</code> is already installed and therefore it's very easy to start sending e-mail with that.</p><p>That is why we will be discussing this method of sending e-mail first, so that we can start off easy.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How to do it…</h2></div></div></div><p>In this recipe we will discuss the method of sending mail from within our application.</p><div class="section" title="Transport\Sendmail"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec37"/>Transport\Sendmail</h3></div></div></div><p>Let's take a <a id="id127" class="indexterm"/>look at the following example of sending an <a id="id128" class="indexterm"/>e-mail through <code class="literal">sendmail</code>, and although this functionality is placed in a controller, in real life this needs to stay far away from that and be placed safely away in a model:</p><div class="informalexample"><pre class="programlisting">&lt;?php

namespace Application\Controller;

// We need the following libraries at a minimum to 
// send an e-mail.
use Zend\Mail\Message;
use Zend\Mail\Transport\Sendmail;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {
    // We start off by creating a new Message, which 
    // will contain our message body, subject, to, 
    // etcetera.
    $message = new Message();

    // Add the options we would like to give the 
    // message, in this case we will be creating a text 
    // message.
    $message-&gt;addFrom('awesome.coder@example.com')
            -&gt;addTo('rookie.coder@example.com')
            -&gt;setSubject('Watch and learn.')
            -&gt;setBody('My wisdom in a message.');

    // Now we have set up our message, let's initialize 
    // the transport.
    $sendmail = new Sendmail();

    // Although checking isValid is optional, it is a 
    // great way of checking if our message would send 
    //if we are getting input from outside.
    if ($message-&gt;isValid() === true) {
      // Send the message through sendmail.
      $sendmail-&gt;send($message);
    }
  }
}</pre></div><p>No<a id="id129" class="indexterm"/> configuration is usually required for setting up e-mail <a id="id130" class="indexterm"/>to be sent through <code class="literal">sendmail</code>, as it is a mail transport application on the local host only.</p></div><div class="section" title="Transport\Smtp"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec38"/>Transport\Smtp</h3></div></div></div><p>We can easily<a id="id131" class="indexterm"/> send our e-mail through SMTP if we <a id="id132" class="indexterm"/>want (if we know our SMTP server details obviously):</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Usually this sort of code is defined in the Model, 
// but to test it out we can place it in the 
// controller as well.
namespace Application\Controller;

// We need these classes to initiate a SMTP sending.
use Zend\Mail\Message;
use Zend\Mail\Transport\Smtp;
use Zend\Mail\Transport\SmtpOptions;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {
    // First we built up a small message that we want to 
    // send off.
    $message = new Message();

    // We need at least one recipient and a message body 
    // to send off a message.
    $message-&gt;addTo('someone@example.com')
            -&gt;addFrom('developer@example.com')
            -&gt;setSubject('An example message!')
            -&gt;setBody('This is a test message!');

    // Now we created our message we need to set up our 
    // SMTP transportation.
    $smtp = new Smtp();

    // Set our authentication and host details of our 
    // SMTP server.
    $smtp-&gt;setOptions(new SmtpOptions(array(
      // Name represents our domain name.
      'name' =&gt; 'ourdomain.com',

      // Host represents the SMTP server that will 
      // handle the sending of our mail. This could also 
      // be 'localhost' if the sending happens on our 
      // local server.
      'host' =&gt; 'smtp.somewhere.com',

      // Port is default 25, which in most cases is 
      // fine, but this is just to show how we can 
      // change it.
      'port' =&gt; '1234',

      // Connection class is the class used for 
      // authenticating with the SMTP server. Normally 
      // login will suffice, but sometimes the SMTP 
      // server requires a PLAIN (plain) or CRAM-MD5 
      // (crammd5) authentication method.
      'connection_class' =&gt; 'login',

      // This tells the connection_class which 
      // properties to set. The default three connection
      // classes only require username and password.
      'connection_config' =&gt;array(
        'username' =&gt; 'someuser',
        'password' =&gt; 'someplainpassword',
      ),
    ))); 

    // We have set the options, now let's send the 
    // message.
    $smtp-&gt;send($message);
  }
}</pre></div></div><div class="section" title="Transport\File"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec39"/>Transport\File</h3></div></div></div><p>Let's take a<a id="id133" class="indexterm"/> look at an example of how to send our e-mail in to files…</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Usually this sort of code is defined in the Model, 
// but to test it out we can place it in the 
// controller as well.
namespace Application\Controller;

// We need these classes to initiate a SMTP sending.
use Zend\Mail\Message;
use Zend\Mail\Transport\File;
use Zend\Mail\Transport\FileOptions;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {
    // First we create our simple message. 
    $message = new Message();

    // Set the essential fields send it off.
    $message-&gt;addTo('someone@example.com')
            -&gt;addFrom('developer@example.com')
            -&gt;setSubject('An example message!')
            -&gt;setBody('This is a test message!');

    // Now we will initialize our File transport.
     $file = new File();

    // Set the options for the File transport.
    $file-&gt;setOptions(new FileOptions(array(
      // We want to save our e-mail in the /tmp path,   
      // this can be anything where we have write  
      // permission on.
      'path' =&gt; '/tmp',

      // Define our callback, which will be ran when 
      // the e-mail is being saved to our system. This 
      // also called an anonymous function, as it 
      // isn't defined as a normal method.
      'callback' = function(File $file) {
 
      // We want to return a name in which the file 
      // should be saved, which should be a unique.
      return 'mail_'. time(). '.txt';
    }
   )));

   // Now send off the message.
   $file-&gt;send($message);
  }
}</pre></div><p>After sending<a id="id134" class="indexterm"/> the e-mail the file transporter will create a file which might look something like <code class="literal">mail_453421020.txt</code>. We have given <code class="literal">/tmp</code> as the directory to where this file should be saved, we should look there to see if our file exists.</p><p>Of course we can do anything in the callback function, for example, we can check if a certain file exists, or pull a name from the database. The options are endless.</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>How it works…</h2></div></div></div><p>Zend Framework 2 needs a minimum of two objects to make the sending of e-mails work. First is the <code class="literal">Zend\Mail\Message</code> object, which is used to completely define the message that needs to<a id="id135" class="indexterm"/> be sent. We can define <code class="literal">to</code>, <code class="literal">cc</code>, <code class="literal">bcc</code>, and <code class="literal">from</code> addresses in<a id="id136" class="indexterm"/> this object. The object is also used to set the body of the message; this can be either HTML or plain-text, completely depending on our own requirements.</p><p>Then as a second object we need a class that implements the <code class="literal">Zend\Mail\Transport\TransportInterface</code> class that handles the actual sending of the e-mail. This class only (at the moment anyway) has a <code class="literal">send(Mail\Message $message)</code> method defined that needs to be added when we implement the transport.</p><p>What happens <a id="id137" class="indexterm"/>after defining the two objects is that we give our <code class="literal">Message</code> object <a id="id138" class="indexterm"/>to our <code class="literal">Transport</code> object and tell it to send it off. How the sending is handled, is obviously determined by the <code class="literal">Transport</code> object.</p><div class="section" title="Sending mail through SMTP"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec40"/>Sending mail through SMTP</h3></div></div></div><p>Transporting mail through SMTP might not sound familiar to us, but it is a common method of<a id="id139" class="indexterm"/> sending e-mail through another system. Think about a desktop e-mail client that retrieves our e-mail from another server. When we <a id="id140" class="indexterm"/>send off an e-mail from that same e-mail client, it could very well be that we will be using SMTP to send it off. In a nutshell, SMTP is sending an e-mail to another mail server that then handles our mail transportation for us.</p></div><div class="section" title="Sending mail through files"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec41"/>Sending mail through files</h3></div></div></div><p>Although not <a id="id141" class="indexterm"/>used often, there are e-mail senders that simply pick up clear text files with the complete message which needs sending from a specific directory, and send them off. And obviously if we have no way of testing our actual e-mail sending, this is also a great way of testing if the system works.</p></div></div></div>
<div class="section" title="Receiving mail"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Receiving mail</h1></div></div></div><p>Now, let's <a id="id142" class="indexterm"/>deal with the part of receiving mails.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Getting ready</h2></div></div></div><p>In this recipe<a id="id143" class="indexterm"/> we will be giving examples on the different methods of connecting to mailbox through ZF2, and therefore it would be nice if we had access to a mailbox we connect to. Of course this is not required, but it sure adds to the fun to have an actual working mailbox.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>How to do it…</h2></div></div></div><p>We will now <a id="id144" class="indexterm"/>discuss receiving e-mail within an application, which can be <a id="id145" class="indexterm"/>useful on some occasions.</p><div class="section" title="Connecting to an IMAP mail server"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec42"/>Connecting to an IMAP mail server</h3></div></div></div><p>The first method of connecting to a mail server is through IMAP. The protocol basically lets us connect <a id="id146" class="indexterm"/>to the mail server, and looking in the different <a id="id147" class="indexterm"/>folders on the server if there are unread e-mails.</p><p>Let's take a look at our example:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Usually this sort of code is defined in the Model,
// but to test it out we can place it in the 
// controller as well.
namespace Application\Controller;

// We need these classes to initiate an IMAP connection
use Zend\Mail\Storage\Imap;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {

    // We will create a new IMAP connection here:
    // host: user/password: The username and password 
    // to use. 
    $mail = new Imap(array(
   // Refers to the host where we want to connect to.
   'host' =&gt; 'imap.example.com',

   // The username/password to connect to the server 
   // with.
   'user' =&gt; 'some_user',
   'password' =&gt; 'some_password',

   // Do we want to explicitly use a secure 
   // connection.
   'ssl' =&gt; true,

   // If we want to use a port that is different to 
   // the default port, we can do that here.
   'port' =&gt; 1234,

   // Specify the folder we want to use, if none 
   // given it will always use INBOX. This will also 
   // work with the Mbox and Maildir protocol.
   'folder' =&gt; 'Some_Folder',
 ));

 // We want to parse through all our e-mails.
 foreach ($mail as $message) {
   // Display the from and subject line.
      echo $message-&gt;from. ': '. $message-&gt;subject;
    }
  }
}</pre></div></div><div class="section" title="Connecting to a POP3 mail server"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec43"/>Connecting to a POP3 mail server</h3></div></div></div><p>Let's take a<a id="id148" class="indexterm"/> look at our simple connection example:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Usually this sort of code is defined in the Model, 
// but to test it out we can place it in the 
// controller as well.
namespace Application\Controller;

// We need these classes to initiate a POP3 connection
use Zend\Mail\Storage\Pop3;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {        
    // We will create a new POP3 connection here
    $mail = new Pop3(array(
      // Refers to the host where we want to connect 
      // to
      'host' =&gt; 'pop3.example.com',

      // The username/password to connect to the 
      // server with.
      'user' =&gt; 'some_user',
      'password' =&gt; 'some_password',

      // Do we want to explicitly use a secure 
      // connection.
      'ssl' =&gt; true,

      // If we want to use a port that is different to 
      // the default port, we can do that here.
      'port' =&gt; 4321
    ));

    // We want to parse through all our e-mails.
    foreach ($mail as $message) {
      // Display the from and subject line.
      echo $message-&gt;from. ': '. $message-&gt;subject;
    }
  }
}</pre></div></div><div class="section" title="Working with flags on IMAP or Maildir connections"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec44"/>Working with flags on IMAP or Maildir connections</h3></div></div></div><p>Flags are <a id="id149" class="indexterm"/>attributes that are attached to a message in which we can see the specific property of a message. To put it simpler, it can tell us, for example, if a message is read or answered. We can either get the flags from a message by using the <code class="literal">getFlags()</code> method<a id="id150" class="indexterm"/>, or by using the <code class="literal">hasFlag()</code> method. The<a id="id151" class="indexterm"/> flags that can be used are to be found in the <code class="literal">Zend\Mail\Storage</code> class.</p></div><div class="section" title="Maildir++ Quota system"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec45"/>Maildir++ Quota system</h3></div></div></div><p>Let's <a id="id152" class="indexterm"/>take a look at the following example:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Usually this sort of code is defined in the Model,
// but to test it out we can place it in the 
// controller as well.
namespace Application\Controller;

// We need these classes to initiate a Maildir storage 
// connection
use Zend\Mail\Storage\Maildir;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {	
    // Open up a new Maildir connection
    $mail = new Maildir(array(
      // Our mail folder on the server.
      'dirname' =&gt; '/home/user/.mymail/'
    ));
    
    if ($mail-&gt;checkQuota() === true) {
      // We are over quote, let's check what we are 
      // using!

      // Give us extended information about the quota.
      $quota = $mail-&gt;checkQuota(true);
  
      // Normalise the string if we are over the
      // quota.
      $overQuota = $quota['over_quota'] ? 'Yes' : 'No';
      
      // Display the information.
      echo "
        -- QUOTA --
        Total quota size: {$quota['quota']['size']}
        Total quota objects: {$quota['quota']['count']}
        -- USE --
        Total used size: {$quota['size']}
        Total used objects: {$quota['count']}
        Are we over quota: {$overQuota}
     ";
    }
  }
}</pre></div></div><div class="section" title="Keeping a connection alive"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec46"/>Keeping a connection alive</h3></div></div></div><p>The<a id="id153" class="indexterm"/> following is an example of the use of NOOP:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// Usually this sort of code is defined in the Model,
// but to test it out we can place it in the 
// controller as well.
namespace Application\Controller;

// We need these classes to initiate a IMAP connection
use Zend\Mail\Storage\IMAP;
use Zend\Mvc\Controller\AbstractActionController;

class IndexController extends AbstractActionController
{
  public function indexAction()
  {
    // Open up a new connection to the mail server.
    $mail = new Imap(array(
     'host' =&gt; 'imap.example.com',
     'user' =&gt; 'some_user',
     'password' =&gt; 'some_password'
  ));

 // Loop through the messages.
 foreach ($mail as $message) {
   /** Do stuff which takes a lot of time.. **/

   // Now let the server know we are still alive..
   $mail-&gt;noop(); 

   /** Do some more stuff..  **/

   // Let the server know again we are still here..
   $mail-&gt;noop();
    }
  }
}</pre></div><p>The tricky <a id="id154" class="indexterm"/>part here is when to use <code class="literal">noop()</code>, as sometimes it is really hard to predict which process is taking the longest. That is why we created a <a id="id155" class="indexterm"/>special example to show you how easy it is to make sure that <code class="literal">noop()</code> is being carried out regularly, until we are done with our process.</p><p>We can do this by utilizing <code class="literal">register_tick_function</code>, which enables us to call a specific process <a id="id156" class="indexterm"/>on every tick. What we'll do is create a class that handles <code class="literal">noop()</code>, and executes it every 5 minutes until we say it should stop:</p><div class="informalexample"><pre class="programlisting">&lt;?php

// We can make this anything we want, we just decided on 
// this though
namespace Application\System;

// Lets call our class this
class NoopTick
{
  // This is our Zend\Mail\Storage\Imap which is a 
  // static so we can call from outside the context of 
  // this class without instantiating the class
  private static $imap;

  // This is the time value in seconds of the next time 
  // we want to execute our noop functionality
  private static $newTime;

  // This is the amount of seconds between noop
  // executions, which in this case is 5 minutes
  private static $timeInBetween = 300;

  // This is our main method, which will only call the 
  // noop method
  public static function tickTock()
  {
    if (time() &gt;= self::$newTime) {
      // We can execute our noop now
      self::$imap-&gt;noop();

      // Now set the new time
      self::$newTime = (time() + self::$timeInBetween);
    }
  }

  // Now we want to have a method that starts up the 
  // noop triggering
  public static function start($imap)
  {
    // Set our imap storage to use
    self::$imap = $imap;

    // Now we register the tick function, which executes 
    // every tick of the process, we will use the class 
    // NoopTicks (this class) and method 'tickTock'
    register_tick_function(array(
      'Application\System\NoopTick','tickTock'
    ));
  }

  // And we now unregister our tick function again when 
  // we are done with our operation
  public static function stop()
  {
    // Unregister our tick function again, mind that we 
    // don't have to provide our class name here
    unregister_tick_function('tickTock');
  }
}</pre></div><p>If we now are at a piece of code that requires us to execute for a long time, we can easily call the <code class="literal">start()</code> method<a id="id157" class="indexterm"/> to do the NOOP'ing for us as shown in the following <a id="id158" class="indexterm"/>line of code:</p><div class="informalexample"><pre class="programlisting">Application\System\NoopTick::start($imapStorage);</pre></div><p>And when we are done, we simply <a id="id159" class="indexterm"/>
<code class="literal">stop()</code> the NOOP'ing again as shown in the following line of code:</p><div class="informalexample"><pre class="programlisting">Application\System\NoopTick::stop();</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>How it works…</h2></div></div></div><p>Mailboxes<a id="id160" class="indexterm"/> are being connected to; however we will see them in ZF2 as <a id="id161" class="indexterm"/>storage objects. Because of this we can easily parse through all the messages, and in some cases are able to manipulate messages on the storage, such as copying or moving them. We need to remember that messages are always read <a id="id162" class="indexterm"/>only, and storages are the ones that can be manipulated. It<a id="id163" class="indexterm"/> is possible, for example, to create and delete a folder, but never edit an existing message.</p><p>The only writeable functionality we have for manipulating a message is <code class="literal">appendMessage()</code>, which appends a message to the storage. But when it is stored, we are not able to edit it again.</p><div class="section" title="Connecting to a POP3 server"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec47"/>Connecting to a POP3 server</h3></div></div></div><p>Connecting<a id="id164" class="indexterm"/> with a POP3 server is very similar to using an IMAP server (handy, isn't it?). The only major difference is normally with a POP3 server the messages disappear from the mail server after retrieving them, unless we specifically tell the server otherwise.</p></div><div class="section" title="About the Maildir++ Quota system"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec48"/>About the Maildir++ Quota system</h3></div></div></div><p>Maildir++ is an <a id="id165" class="indexterm"/>extended version of Maildir, but still compatible with the normal Maildir routine and supports quota systems. This is a very useful system because of its quota and how it stores messages (on filesystem). This is used in a lot of companies, but obviously it comes with its own troubles. For example, when trying to write/copy a message on a Maildir++ server, it can be that this will throw an exception because we are over the system quota.</p><p>That is why that – unless you know for certain Maildir++ isn't used – to implement a check for the quota before trying to do any write-based functionality.</p></div><div class="section" title="Keeping the connection alive"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec49"/>Keeping the connection alive</h3></div></div></div><p>Once a connection has been opened and parsing through messages is instantiated, the connection has a fair chance of closing once too much time has passed. At that point it is always wise to implement a <a id="id166" class="indexterm"/>
<code class="literal">No Operation</code> command, or NOOP. This will tell the mail server that we are still there, but are just doing something else at the moment.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>There's more…</h2></div></div></div><p>There is obviously a lot more to tell about retrieving e-mails from a mail server, and it would be a great adventure to find them all out. Unfortunately, going in for all the advanced details would almost be a book in itself, so we have put down a couple of subjects which are worth exploring:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Caching instances (see also <a class="link" href="ch08.html" title="Chapter 8. Optimizing Performance">Chapter 8</a>, <span class="emphasis"><em>Optimizing Performance</em></span>)</li><li class="listitem" style="list-style-type: disc">Reading HTML messages, or multi part messages with attachments</li><li class="listitem" style="list-style-type: disc">Advanced use of folders on IMAP/Maildir/Mbox</li><li class="listitem" style="list-style-type: disc">Protocol class extensions</li><li class="listitem" style="list-style-type: disc">Setting up e-mail box settings through the configuration</li></ul></div></div></div></body></html>