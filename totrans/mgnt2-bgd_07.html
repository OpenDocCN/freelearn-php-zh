<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;7.&#xA0;Backend Development"><div class="book" id="1ENBI2-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07" class="calibre1"/>Chapter 7. Backend Development</h1></div></div></div><p class="calibre7"><span class="strong"><strong class="calibre8">Backend development</strong></span> is a term that is most commonly used to describe work closely related to <a id="id218" class="calibre1"/>the server side. This usually implies the actual server, application code, and the database. For example, if we open a storefront of a web shop, add a few products to the cart, and then check out, the application will store the information provided. This information is managed on a server with a server-side language, such as PHP, and then saved in a database. In <a class="calibre1" title="Chapter 4. Models and Collections" href="part0028_split_000.html#QMFO2-818f5224668745eb9070ddf1d85e6bfa">Chapter 4</a>, <span class="strong"><em class="calibre9">Models and Collections</em></span>, we took a look at the backbone of backend development. In this chapter, we will explore other backend-related aspects.</p><p class="calibre7">We will use the <code class="email">Foggyline_Office</code> module that was defined in one of the previous chapters as we go through the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Cron jobs</li><li class="listitem">Notification messages</li><li class="listitem">Sessions and cookies</li><li class="listitem">Logging</li><li class="listitem">The profiler</li><li class="listitem">Events and observers</li><li class="listitem">Caches</li><li class="listitem">Widgets</li><li class="listitem">Custom variables</li><li class="listitem">i18n (internationalization)</li><li class="listitem">Indexers</li></ul></div><p class="calibre7">These individual isolated units of functionality are mostly used in everyday backend-related development.</p></div>

<div class="book" title="Chapter&#xA0;7.&#xA0;Backend Development">
<div class="book" title="Cron jobs"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch07lvl1sec43" class="calibre1"/>Cron jobs</h1></div></div></div><p class="calibre7">Speaking of <code class="email">cron</code> jobs, it is worth noting one important thing. A <code class="email">Magento cron</code> job is not the <a id="id219" class="calibre1"/>same as an operating system <code class="email">cron</code> job. An operating system <code class="email">cron</code> is driven by a <code class="email">crontab</code> (short for <code class="email">cron</code> table) file. The <code class="email">crontab</code> file, is a configuration file that specifies shell commands that need to be run periodically on a given schedule.</p><p class="calibre7">A <code class="email">Magento cron</code> job is driven by a periodic execution of PHP code that handles entries in the <code class="email">cron_schedule</code> table. The <code class="email">cron_schedule</code> table is where <code class="email">Magento cron</code> jobs are queued once they are picked up from the individual <code class="email">crontab.xml</code> file.</p><p class="calibre7">The <code class="email">Magento cron</code> jobs cannot be executed without the operating system <code class="email">cron</code> job being set to execute the <code class="email">php bin/magento cron:run</code> command. Ideally, an operating system <code class="email">cron</code> job should be set to trigger <code class="email">Magento's cron:run</code> every minute. <code class="email">Magento</code> will then internally execute its <code class="email">cron</code> jobs according to the way an individual <code class="email">cron</code> job is defined in the <code class="email">crontab.xml</code> file.</p><p class="calibre7">To define a new <code class="email">cron</code> job in <code class="email">Magento cron</code>, we first need to define a <code class="email">crontab.xml</code> file in the module. Let's create a <code class="email">app/code/Foggyline/Office/etc/crontab.xml</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;config  xsi:noNamespaceSchemaLocation= "urn:magento:module:Magento_Cron:etc/crontab.xsd"&gt;
    &lt;group id="default"&gt;
        &lt;job name="foggyline_office_logHello" instance= "Foggyline\Office\Model\Cron" method="logHello"&gt;
            &lt;schedule&gt;*/2 * * * *&lt;/schedule&gt;
        &lt;/job&gt;
    &lt;/group&gt;
&lt;/config&gt;</pre></div><p class="calibre7">Note that the <code class="email">XSD</code> schema location points to <code class="email">crontab.xsd</code> from within the <code class="email">Magento_Cron</code> module.</p><p class="calibre7">The <code class="email">id</code> attribute of a <code class="email">group</code> element is set to the <code class="email">default</code> value. In its modules, <code class="email">Magento</code> defines two different groups, namely default and index. We used the <code class="email">default</code> value, as this is the one that gets executed when the standard <code class="email">php bin/magento cron:run</code> command is triggered on the console.</p><p class="calibre7">Within the <code class="email">group</code> element, we have individual jobs defined under the <code class="email">job</code> element. The <code class="email">job</code> element requires us to specify the <code class="email">name</code>, <code class="email">instance</code>, and <code class="email">method</code> attributes. The <code class="email">name</code> attribute has to be unique within the <code class="email">group</code> element. The value of the <code class="email">instance</code> and <code class="email">method</code> attributes should point to the class that will be instantiated and the method within the class that needs to be executed.</p><p class="calibre7">The <code class="email">schedule</code> element nested within the <code class="email">cron</code> job specifies the desired time of job execution. It uses the same time expression as that of the entries in an operating system <code class="email">crontab</code> file. The specific example that we will look at defines an expression (<code class="email">*/2 * * * *</code>) that is<a id="id220" class="calibre1"/> executed every two minutes.</p><p class="calibre7">Once we have defined the <code class="email">crontab.xml</code> file, we need to define the <code class="email">Foggyline\Office\Model\Cron</code> class file, as follows:</p><div class="informalexample"><pre class="programlisting">namespace Foggyline\Office\Model;

class Cron
{
    protected $logger;

    public function __construct(
        \Psr\Log\LoggerInterface $logger
    )
    {
        $this-&gt;logger = $logger;
    }

    public function logHello()
    {
        $this-&gt;logger-&gt;info('Hello from Cron job!');
        return $this;
    }
}</pre></div><p class="calibre7">The preceding code simply defines a <code class="email">logHello</code> method used by the <code class="email">cron</code> job. In the <code class="email">logHello</code> method, we used the <code class="email">logger</code> method that was instantiated via the constructor. The <code class="email">logger</code> method will make a log entry in the <code class="email">var/log/system.log</code> file once it is executed.</p><p class="calibre7">Once the command is executed, you will see the <code class="email">Ran</code> jobs by schedule message in the console. Additionally, the <code class="email">cron_schedule</code> table should get filled with all the <code class="email">Magento cron</code> jobs that were defined.</p><p class="calibre7">At this point, we should trigger the <code class="email">php bin/magento cron:run</code> command in the console.</p><p class="calibre7">The <code class="email">cron_schedule</code> table contains the following columns:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">schedule_id</code>: The auto-increment <code class="email">primary</code> field.</li><li class="listitem"><code class="email">job_code</code>: The value of the job <code class="email">name</code> attribute, as defined in <code class="email">crontab.xml</code> file, which equals to <code class="email">foggyline_office_logHello</code> table in our example.</li><li class="listitem"><code class="email">status</code>: Defaults to the pending value for the newly created entries in the table and allows for a <code class="email">pending</code>, <code class="email">running</code>, <code class="email">success</code>, <code class="email">missed</code> or <code class="email">error</code> value. Its value changes as the <code class="email">cron</code> job traverses through its life cycle.</li><li class="listitem"><code class="email">messages</code>: Stores the possible exception error message if the exception has occurred during a job's execution.</li><li class="listitem"><code class="email">created_at</code>: The <code class="email">timestamp</code> value that denotes when a job was created.</li><li class="listitem"><code class="email">scheduled_at</code>: The <code class="email">timestamp</code> value that denotes when a job was scheduled for execution.</li><li class="listitem"><code class="email">executed_at</code>: The <code class="email">timestamp</code> value that denotes when a job's execution started.</li><li class="listitem"><code class="email">finished_at</code>: The <code class="email">timestamp</code> value that denotes when a job has finished executing.</li></ul></div><p class="calibre7">Unless we<a id="id221" class="calibre1"/> have already set the operating system <code class="email">cron</code> to trigger the <code class="email">php bin/magento cron:run</code> command, we need to trigger it on our own a few times every two minutes in order to actually execute the job. The first time a command is run, if the job does not exist in the <code class="email">cron_schedule</code> table, <code class="email">Magento</code> will merely queue it, but it won't execute it. The subsequent <code class="email">cron</code> runs will execute the command. Once we are sure that the <code class="email">cron</code> job entry in the <code class="email">cron_schedule</code> table has the <code class="email">finished_at</code> column value filled, we will see an entry that looks like <code class="email">[2015-11-21 09:42:18] main.INFO: Hello from Cron job! [] []</code> in the <code class="email">var/log/system.log</code> file.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip08" class="calibre1"/>Tip</h3><p class="calibre7">While developing and testing <code class="email">cron</code> jobs in <code class="email">Magento</code>, we might need to truncate the <code class="email">cron_schedule</code> table, delete <code class="email">Magento's var/cache</code> value, and execute the <code class="email">php bin/magento cron:run</code> command repetitively until we get it tested and working.</p></div></div></div>
<div class="book" title="Notification messages" id="1FLS41-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec44" class="calibre1"/>Notification messages</h1></div></div></div><p class="calibre7"><code class="email">Magento</code> implements<a id="id222" class="calibre1"/> the notification message mechanism via the <code class="email">Messages</code> module. The <code class="email">Messages</code> module conforms to <code class="email">\Magento\Framework\Message\ManagerInterface</code>. Though the interface itself does not impose any session relation, an implementation adds interface-defined types of messages to a session and allows access to those messages later. In the <code class="email">app/etc/di.xml</code> file, there is a preference defined for <code class="email">\Magento\Framework\Message\ManagerInterface</code> towards the <code class="email">Magento\Framework\Message\Manager</code> class.</p><p class="calibre7"><code class="email">Message\ManagerInterface</code> specifies four types of messages, namely <code class="email">error</code>, <code class="email">warning</code>, <code class="email">notice</code>, and <code class="email">success</code>. The types of messages are followed by several key methods in the <code class="email">Message\Manager</code> class, such as <code class="email">addSuccess</code>, <code class="email">addNotice</code>, <code class="email">addWarning</code>, <code class="email">addError</code>, and <code class="email">addException</code>. The <code class="email">addException</code> method is basically a wrapper for <code class="email">addError</code> that accepts an <code class="email">exception</code> object as a parameter.</p><p class="calibre7">Let's try to<a id="id223" class="calibre1"/> run the following code in the <code class="email">execute</code> method of <code class="email">app/code/Foggyline/Office/Controller/Test/Crud.php</code>:</p><div class="informalexample"><pre class="programlisting">$resultPage = $this-&gt;resultPageFactory-&gt;create();
$this-&gt;messageManager-&gt;addSuccess('Success-1');
$this-&gt;messageManager-&gt;addSuccess('Success-2');
$this-&gt;messageManager-&gt;addNotice('Notice-1');
$this-&gt;messageManager-&gt;addNotice('Notice-2');
$this-&gt;messageManager-&gt;addWarning('Warning-1');
$this-&gt;messageManager-&gt;addWarning('Warning-2');
$this-&gt;messageManager-&gt;addError('Error-1');
$this-&gt;messageManager-&gt;addError('Error-2');
return $resultPage;</pre></div><p class="calibre7">Once this code executed, the result, as shown in the following screenshot, will appear on the page in the browser:</p><div class="mediaobject"><img src="../images/00039.jpeg" alt="Notification messages" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">Notification messages appear both in the frontend and admin area.</p><p class="calibre7">The frontend layout <code class="email">vendor/magento/module-theme/view/frontend/layout/default.xml</code> file defines it as follows:</p><div class="informalexample"><pre class="programlisting">&lt;page layout="3columns"  xsi:noNamespaceSchemaLocation= "../../../../../../../lib/internal/Magento/Framework /View/Layout/etc/page_configuration.xsd"&gt;
    &lt;update handle="default_head_blocks"/&gt;
    &lt;body&gt;
        &lt;!-- ... --&gt;
        &lt;referenceContainer name="columns.top"&gt;
            &lt;container name="page.messages" htmlTag="div" htmlClass="page messages"&gt;
                &lt;block class="Magento\Framework\View\Element \Messages" name="messages" as="messages" template="Magento_Theme::messages.phtml"/&gt;
            &lt;/container&gt;
        &lt;/referenceContainer&gt;
        &lt;!-- ... --&gt;
    &lt;/body&gt;
&lt;/page&gt;</pre></div><p class="calibre7">The <code class="email">template</code> file that renders the messages is <code class="email">view/frontend/templates/messages.phtml</code> in the <code class="email">Magento_Theme</code> module. By looking <a id="id224" class="calibre1"/>at the <code class="email">Magento\Framework\View\Element\Messages</code> class, you will see that the <code class="email">_toHtml</code> method branches into <code class="email">if-else</code> statements, depending on whether template is set or not. In case the template is not set, <code class="email">_toHtml</code> internally calls the <code class="email">_renderMessagesByType</code> method, which renders messages in the HTML format that are grouped by type.</p><p class="calibre7">The <code class="email">view/adminhtml/layout/default.xml</code> admin layout file in the <code class="email">Magento_AdminNotification</code> module defines it as follows:</p><div class="informalexample"><pre class="programlisting">&lt;page  xsi:noNamespaceSchemaLocation="urn:magento: framework:View/Layout/etc/page_configuration.xsd"&gt;
    &lt;body&gt;
        &lt;referenceContainer name="notifications"&gt;
            &lt;block class="Magento\AdminNotification\Block \System\Messages" name="system_messages" as="system_messages" before="-" template= "Magento_AdminNotification::system/messages.phtml"/&gt;
        &lt;/referenceContainer&gt;
    &lt;/body&gt;
&lt;/page&gt;</pre></div><p class="calibre7">The <code class="email">template</code> file that renders the messages is <code class="email">view/adminhtml/templates/system/messages.phtml</code> in the <code class="email">Magento_AdminNotification</code> module. When you look at the <code class="email">Magento\AdminNotification\Block\System\Messages</code> class, you will see that its <code class="email">_toHtml</code> is calling the <code class="email">_toHtml</code> parent method, where the parent belongs to the <code class="email">\Magento\Framework\View\Element\Template</code> class. This means that the output is relying<a id="id225" class="calibre1"/> on the <code class="email">view/adminhtml/templates/system/messages.phtml</code> file in the <code class="email">Magento_AdminNotification</code> module.</p></div>
<div class="book" title="Session and cookies"><div class="book" id="1GKCM2-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec45" class="calibre1"/>Session and cookies</h1></div></div></div><p class="calibre7">Sessions<a id="id226" class="calibre1"/> in <code class="email">Magento</code> conform to <code class="email">Magento\Framework\Session\SessionManagerInterface</code>. In the <code class="email">app/etc/di.xml</code> file, there <a id="id227" class="calibre1"/>is a definition preference for the <code class="email">SessionManagerInterface</code> class which points to the <code class="email">Magento\Framework\Session\Generic</code> class type. The <code class="email">Session\Generic</code> class is just an empty class that extends the <code class="email">Magento\Framework\Session\SessionManager</code> class, which in turn implements the <code class="email">SessionManagerInterface</code> class.</p><p class="calibre7">There is one important object that gets instantiated in the <code class="email">SessionManager</code> instance that conforms to <code class="email">\Magento\Framework\Session\Config\ConfigInterface</code>. On looking at <code class="email">app/etc/di.xml</code> file, we can see a preference for <code class="email">ConfigInterface</code> pointing to a <code class="email">Magento\Framework\Session\Config</code> class type.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip09" class="calibre1"/>Tip</h3><p class="calibre7">To fully understand the session behavior in <code class="email">Magento</code>, we should study the inner workings of both the <code class="email">SessionManager</code> and <code class="email">Session\Config</code> classes.</p></div><p class="calibre7"><code class="email">Magento</code> uses cookies to keep track of a session. These cookies have a default lifetime of 3,600 seconds. When a session is established, a cookie with the name of <code class="email">PHPSESSID</code> is created in the browser. The value of the cookie equals the session name. By default, sessions are stored in files in the <code class="email">var/session</code> directory of <code class="email">Magento</code>'s root installation.</p><p class="calibre7">If you have a look at these session files, you will see that session information is being stored in serialized strings that are divided into groupings such as <code class="email">_session_validator_data, _session_hosts</code>, <code class="email">default</code>, <code class="email">customer_website_1</code>, and <code class="email">checkout</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00040.jpeg" alt="Session and cookies" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">This is not the finite list of grouping. Modules that implement their own session handling bits can add their own groups.</p><p class="calibre7">We can <a id="id228" class="calibre1"/>store and retrieve information in a session by simply using expressions like<a id="id229" class="calibre1"/> the following ones:</p><div class="informalexample"><pre class="programlisting">$this-&gt;sessionManager-&gt;setFoggylineOfficeVar1('Office1');
$this-&gt;sessionManager-&gt;getFoggylineOfficeVar1();</pre></div><p class="calibre7">The preceding expressions will create and get an entry from the session under the default group.</p><p class="calibre7">We can get the entire content of the default session group simply by using the <code class="email">$this-&gt;sessionManager-&gt;getData()</code> expression, which will return an array of data that is similar to the following one:</p><div class="informalexample"><pre class="programlisting">array(3) {
  ["_form_key"] =&gt; string(16) "u3sNaa26Ii21nveV"
  ["visitor_data"] =&gt; array(14) {
    ["last_visit_at"] =&gt; string(19) "2015-08-19 07:40:03"
    ["session_id"] =&gt; string(26) "8p82je0dkqq1o00lanlr6bj6m2"
    ["visitor_id"] =&gt; string(2) "35"
    ["server_addr"] =&gt; int(2130706433)
    ["remote_addr"] =&gt; int(2130706433)
    ["http_secure"] =&gt; bool(false)
    ["http_host"] =&gt; string(12) "magento2.loc"
    ["http_user_agent"] =&gt; string(121) "Mozilla/5.0 …"
    ["http_accept_language"] =&gt; string(41) "en-US,en;"
    ["http_accept_charset"] =&gt; string(0) ""
    ["request_uri"] =&gt; string(38) "/index.php/foggyline_office/test/crud/"
    ["http_referer"] =&gt; string(0) ""
    ["first_visit_at"] =&gt; string(19) "2015-08-19 07:40:03"
    ["is_new_visitor"] =&gt; bool(false)
  }
  ["foggyline_office_var_1"] =&gt; string(7) "Office1"
}</pre></div><p class="calibre7">As you can see, the <code class="email">foggyline_office_var_1</code> value is right there among other session values.</p><p class="calibre7">There are several useful methods of <code class="email">ConfigInterface</code> that we can use to fetch session configuration information; a few of these methods are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">getCookieSecure</code></li><li class="listitem"><code class="email">getCookieDomain</code></li><li class="listitem"><code class="email">getCookieHttpOnly</code></li><li class="listitem"><code class="email">getCookieLifetime</code></li><li class="listitem"><code class="email">getName</code></li><li class="listitem"><code class="email">getSavePath</code></li><li class="listitem"><code class="email">getUseCookies</code></li><li class="listitem"><code class="email">getOptions</code></li></ul></div><p class="calibre7">Here's a <a id="id230" class="calibre1"/>result <a id="id231" class="calibre1"/>example of the <code class="email">getOptions</code> method call on the <code class="email">Session\Config</code> instance:</p><div class="informalexample"><pre class="programlisting">array(9) {
  ["session.save_handler"] =&gt; string(5) "files"
  ["session.save_path"] =&gt; string(39) "/Users/branko/www/magento2/var/session/"
  ["session.cookie_lifetime"] =&gt; int(3600)
  ["session.cookie_path"] =&gt; string(1) "/"
  ["session.cookie_domain"] =&gt; string(12) "magento2.loc"
  ["session.cookie_httponly"] =&gt; bool(true)
  ["session.cookie_secure"] =&gt; string(0) ""
  ["session.name"] =&gt; string(9) "PHPSESSID"
  ["session.use_cookies"] =&gt; bool(true)
}</pre></div><p class="calibre7">Cookies often go hand in hand with sessions. Besides being used to link to a certain session, cookies are often used to store some information on the client side, thus tracking or identifying the return users and customers.</p><p class="calibre7">Besides the pure PHP approach with the <code class="email">setcookie</code> function, we can manage cookies in <code class="email">Magento</code> through an instance of <code class="email">Magento\Framework\Stdlib\CookieManagerInterface</code>. When you look at <code class="email">app/etc/di.xml</code> file, you will see that the preference for <code class="email">CookieManagerInterface</code> points to a class of the <code class="email">Magento\Framework\Stdlib\Cookie\PhpCookieManager</code> type.</p><p class="calibre7">The following restrictions are worth noting when it comes to <code class="email">Magento</code> cookies:</p><div class="book"><ul class="itemizedlist"><li class="listitem">We can set maximum of 50 cookies in the system. Otherwise, <code class="email">Magento</code> will throw an <code class="email">Unable to send the cookie. Maximum number of cookies would be exceeded</code> exception.</li><li class="listitem">We can store a cookie with a maximum size of 4096 bytes. Otherwise, <code class="email">Magento</code> will throw an <code class="email">Unable to send the cookie. Size of \'%name\' is %size bytes</code> exception.</li></ul></div><p class="calibre7">By imposing these restrictions, <code class="email">Magento</code> ensures that we are compatible with most browsers.</p><p class="calibre7">The <code class="email">CookieManagerInterface</code> class, among other things, specifies the <code class="email">setSensitiveCookie</code> method requirement. This method sets a value in a private cookie with the given <code class="email">$name $value</code> pairing. Sensitive cookies have <span class="strong"><strong class="calibre8">HttpOnly</strong></span> set to true and thus cannot be accessed by JavaScript.</p><p class="calibre7">As we will <a id="id232" class="calibre1"/>soon demonstrate in the following examples, to set a public or private <a id="id233" class="calibre1"/>cookie, we can help ourselves by using instances of the following:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">\Magento\Framework\Stdlib\Cookie\CookieMetadataFactory</code></li><li class="listitem"><code class="email">\Magento\Framework\Stdlib\CookieManagerInterface</code></li><li class="listitem"><code class="email">\Magento\Framework\Session\Config\ConfigInterface</code></li></ul></div><p class="calibre7">We can set public cookies in the following way:</p><div class="informalexample"><pre class="programlisting">$cookieValue = 'Just some value';
$cookieMetadata = $this-&gt;cookieMetadataFactory
    -&gt;createPublicCookieMetadata()
    -&gt;setDuration(3600)
    -&gt;setPath($this-&gt;sessionConfig-&gt;getCookiePath())
    -&gt;setDomain($this-&gt;sessionConfig-&gt;getCookieDomain())
    -&gt;setSecure($this-&gt;sessionConfig-&gt;getCookieSecure())
    -&gt;setHttpOnly($this-&gt;sessionConfig-&gt;getCookieHttpOnly());

$this-&gt;cookieManager
  -&gt;setPublicCookie('cookie_name_1', $cookieValue, $cookieMetadata);</pre></div><p class="calibre7">The preceding code will result in a cookie, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00041.jpeg" alt="Session and cookies" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">We can set private cookies in the following way:</p><div class="informalexample"><pre class="programlisting">$cookieValue = 'Just some value';

$cookieMetadata = $this-&gt;cookieMetadataFactory
    -&gt;createSensitiveCookieMetadata()
    -&gt;setPath($this-&gt;sessionConfig-&gt;getCookiePath())
    -&gt;setDomain($this-&gt;sessionConfig-&gt;getCookieDomain());

$this-&gt;cookieManager
  -&gt;setSensitiveCookie('cookie_name_2', $cookieValue, $cookieMetadata);</pre></div><p class="calibre7">The <a id="id234" class="calibre1"/>preceding<a id="id235" class="calibre1"/> code will result in a cookie, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00042.jpeg" alt="Session and cookies" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">Interestingly, both the public and private cookies in the preceding example show that <span class="strong"><strong class="calibre8">HttpOnly</strong></span> is checked off because by default, a <code class="email">Magento</code> admin has <span class="strong"><strong class="calibre8">Stores</strong></span> | <span class="strong"><strong class="calibre8">Settings</strong></span> | <span class="strong"><strong class="calibre8">Configuration</strong></span> | <span class="strong"><strong class="calibre8">General</strong></span> | <span class="strong"><strong class="calibre8">Web</strong></span> | <span class="strong"><strong class="calibre8">Default Cookie Settings</strong></span> | <span class="strong"><strong class="calibre8">Use HTTP Only</strong></span> set to <span class="strong"><strong class="calibre8">Yes</strong></span>. Since we are using the <code class="email">setHttpOnly</code> method in the public cookie example, we simply picked up the <code class="email">config</code> value via <code class="email">$this-&gt;sessionConfig-&gt;getCookieHttpOnly()</code> and passed it on. If we comment out that line, we will see that the public cookie does not really set <span class="strong"><strong class="calibre8">HttpOnly</strong></span> by default.</p></div>
<div class="book" title="Logging"><div class="book" id="1HIT82-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec46" class="calibre1"/>Logging</h1></div></div></div><p class="calibre7"><code class="email">Magento</code> supports<a id="id236" class="calibre1"/> the messages logging mechanism via its <code class="email">\Psr\Log\LoggerInterface</code> class. The <code class="email">LoggerInterface</code> class has a preference defined within <code class="email">app/etc/di.xml</code> file for the <code class="email">Magento\Framework\Logger\Monolog</code> class type. The actual <code class="email">crux</code> of implementation is actually in the <code class="email">Monolog</code> parent class named <code class="email">Monolog\Logger</code>, which <a id="id237" class="calibre1"/>comes from the <code class="email">Monolog</code> vendor.</p><p class="calibre7">The <code class="email">LoggerInterface</code> class uses the following eight methods to write logs to the eight RFC 5424 levels:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">debug</code></li><li class="listitem"><code class="email">info</code></li><li class="listitem"><code class="email">notice</code></li><li class="listitem"><code class="email">warning</code></li><li class="listitem"><code class="email">error</code></li><li class="listitem"><code class="email">critical</code></li><li class="listitem"><code class="email">alert</code></li><li class="listitem"><code class="email">emergency</code></li></ul></div><p class="calibre7">To use a logger, we need to pass the <code class="email">LoggerInterface </code>class to a constructor of a class from within we want to use it and then simply make one of the following method calls:</p><div class="informalexample"><pre class="programlisting">$this-&gt;logger-&gt;log(\Monolog\Logger::DEBUG, 'debug msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::INFO, 'info msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::NOTICE, 'notice msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::WARNING, 'warning msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::ERROR, 'error msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::CRITICAL, 'critical msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::ALERT, 'alert msg');
$this-&gt;logger-&gt;log(\Monolog\Logger::EMERGENCY, 'emergency msg');</pre></div><p class="calibre7">Alternatively, the preferred shorter version through individual log level type methods is as follows:</p><div class="informalexample"><pre class="programlisting">$this-&gt;logger-&gt;debug('debug msg');
$this-&gt;logger-&gt;info('info msg');
$this-&gt;logger-&gt;notice('notice msg');
$this-&gt;logger-&gt;warning('warning msg');
$this-&gt;logger-&gt;error('error msg');
$this-&gt;logger-&gt;critical('critical msg');
$this-&gt;logger-&gt;alert('alert msg');
$this-&gt;logger-&gt;emergency('emergency msg');</pre></div><p class="calibre7">Both approaches result in the same two log files being created in <code class="email">Magento</code>, which are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">var/log/debug.log</code></li><li class="listitem"><code class="email">var/log/system.log</code></li></ul></div><p class="calibre7">The <code class="email">debug.log</code> file contains only the debug level type of the log, while the rest are saved under <code class="email">system.log</code>.</p><p class="calibre7">Entries <a id="id238" class="calibre1"/>within these logs will then look like this:</p><div class="informalexample"><pre class="programlisting">[2015-11-21 09:42:18] main.DEBUG: debug msg {"is_exception":false} []
[2015-11-21 09:42:18] main.INFO: info msg [] []
[2015-11-21 09:42:18] main.NOTICE: notice msg [] []
[2015-11-21 09:42:18] main.WARNING: warning msg [] []
[2015-11-21 09:42:18] main.ERROR: error msg [] []
[2015-11-21 09:42:18] main.CRITICAL: critical msg [] []
[2015-11-21 09:42:18] main.ALERT: alert msg [] []
[2015-11-21 09:42:18] main.EMERGENCY: emergency msg [] []</pre></div><p class="calibre7">Each of these <code class="email">logger</code> methods can accept an entire array of arbitrary data called <code class="email">context</code>, as follows:</p><div class="informalexample"><pre class="programlisting">$this-&gt;logger-&gt;info('User logged in.', ['user'=&gt;'Branko', 'age'=&gt;32]);</pre></div><p class="calibre7">The preceding expression will produce the following entry in <code class="email">system.log</code>:</p><div class="informalexample"><pre class="programlisting">[2015-11-21 09:42:18] main.INFO: User logged in. {"user":"Branko","age":32} []</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip10" class="calibre1"/>Tip</h3><p class="calibre7">We can manually delete any of the <code class="email">.log</code> files from the <code class="email">var/log</code> directory, and <code class="email">Magento</code> will automatically create it again when needed.</p></div><p class="calibre7"><code class="email">Magento</code> also has another logging mechanism in place, where it logs the following actions in the <code class="email">log_*</code> tables in a database:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">log_customer</code></li><li class="listitem"><code class="email">log_quote</code></li><li class="listitem"><code class="email">log_summary</code></li><li class="listitem"><code class="email">log_summary_type</code></li><li class="listitem"><code class="email">log_url</code></li><li class="listitem"><code class="email">log_url_info</code></li><li class="listitem"><code class="email">log_visitorz</code></li><li class="listitem"><code class="email">log_visitor_info</code></li><li class="listitem"><code class="email">log_visitor_online</code></li></ul></div><p class="calibre7">It is worth noting that this database logging is not related in any way to <code class="email">Psr</code> logger that was described previously. While <code class="email">Psr</code> logger serves developers within the code to group and log certain messages according to the <code class="email">Psr</code> standard, the database logging logs the live data that is a result of <code class="email">user/customer</code> interaction in the browser.</p><p class="calibre7">By default, <code class="email">Magento</code> keeps database logs for around 180 days. This is a configurable option that can be controlled in the <code class="email">Magento</code> admin area under the <span class="strong"><strong class="calibre8">Stores</strong></span> | <span class="strong"><strong class="calibre8">Settings</strong></span> | <span class="strong"><strong class="calibre8">Configuration</strong></span> | <span class="strong"><strong class="calibre8">Advanced</strong></span> | <span class="strong"><strong class="calibre8">System</strong></span> | <span class="strong"><strong class="calibre8">Log Cleaning</strong></span> tab with other log related options, as shown in<a id="id239" class="calibre1"/> the following screenshot:</p><div class="mediaobject"><img src="../images/00043.jpeg" alt="Logging" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7"><span class="strong"><strong class="calibre8">Configuration</strong></span> options that are shown in the preceding screenshot only bare meaning operating system <code class="email">cron</code> is triggering <code class="email">Magento cron</code>.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip11" class="calibre1"/>Tip</h3><p class="calibre7">We can execute two commands on terminal: <code class="email">php bin/magento log:status</code> to get the current state information about log tables and <code class="email">php bin/magento log:clean</code> to force the clearing of tables.</p></div></div>
<div class="book" title="The profiler" id="1IHDQ1-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec47" class="calibre1"/>The profiler</h1></div></div></div><p class="calibre7"><code class="email">Magento</code> has<a id="id240" class="calibre1"/> an in-built profiler that can be used to identify performance problems on the server side. In a nutshell, the profiler can tell us the execution time of certain chunks of code. There is nothing that great with its behavior. We can only get the execution time of code blocks or individual expressions that have been wrapped by the profiler's start and stop methods. On its own, <code class="email">Magento</code> calls for the profiler extensively across its code. However, we can't see it in effect as the profiler output is disabled by default.</p><p class="calibre7"><code class="email">Magento</code> supports three profiler outputs, namely <code class="email">html</code>, <code class="email">csvfile</code>, and <code class="email">firebug</code>.</p><p class="calibre7">To enable<a id="id241" class="calibre1"/> the profiler, we can edit <code class="email">.htaccess</code> and add one of the following expressions:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">SetEnv MAGE_PROFILER "html"</code></li><li class="listitem"><code class="email">SetEnv MAGE_PROFILER "csvfile"</code></li><li class="listitem"><code class="email">SetEnv MAGE_PROFILER "firebug"</code></li></ul></div><p class="calibre7">The HTML type of profiler will show its output into the footer area of a page that we open in the browser, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00044.jpeg" alt="The profiler" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">The <code class="email">csv</code> file type of profiler will output into <code class="email">var/log/profiler.csv</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00045.jpeg" alt="The profiler" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">The firebug<a id="id242" class="calibre1"/> type of profiler will output into <code class="email">var/log/profiler.csv</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00046.jpeg" alt="The profiler" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">The profiler outputs<a id="id243" class="calibre1"/> the following pieces of information:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">Time</code> profiler shows the time spent from <code class="email">Profiler::start</code> to <code class="email">Profiler::stop</code>.</li><li class="listitem"><code class="email">Avg</code> profiler shows the average time spent from <code class="email">Profiler::start</code> to <code class="email">Profiler::stop</code> for cases where <code class="email">Cnt</code> is greater than one.</li><li class="listitem"><code class="email">Cnt</code> profiler shows the integer value of how many times we have started the profiler with the same timer name. For example, if we have called <code class="email">\Magento\Framework\Profiler::start('foggyline:office')</code>; twice somewhere in the code, then <code class="email">Cnt</code> will show the value of <code class="email">2</code>.</li><li class="listitem"><code class="email">Emalloc</code> profiler stands for the amount of memory allocated to PHP. It is a mix of the core PHP <code class="email">memory_get_usage</code> function without the true parameter passed to it and the timer values.</li><li class="listitem"><code class="email">RealMem</code> profiler <a id="id244" class="calibre1"/>also stands for the amount of memory allocated to PHP whose final value is also obtained via the <code class="email">memory_get_usage</code> function minus the timer values, but this time with the true parameter passed to it.</li></ul></div><p class="calibre7">We can<a id="id245" class="calibre1"/> easily add our own <code class="email">Profiler::start</code> calls anywhere in the code. Every <code class="email">Profiler::start</code> should be followed by some code expressions and then finalized with a <code class="email">Profiler::stop</code> call, as follows:</p><div class="informalexample"><pre class="programlisting">\Magento\Framework\Profiler::start('foggyline:office');
sleep(2); /* code block or single expression here */
\Magento\Framework\Profiler::stop('foggyline:office');</pre></div><p class="calibre7">Depending on where we call the profiler in the code, the resulting output should be similar to the one shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00047.jpeg" alt="The profiler" class="calibre10"/></div><p class="calibre11"> </p></div>
<div class="book" title="Events and observers"><div class="book" id="1JFUC2-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec48" class="calibre1"/>Events and observers</h1></div></div></div><p class="calibre7"><code class="email">Magento</code> implements<a id="id246" class="calibre1"/> the observer pattern through <code class="email">\Magento\Framework\Event\ManagerInterface</code>. In <code class="email">app/etc/di.xml</code>, there is a preference<a id="id247" class="calibre1"/> for <code class="email">ManagerInterface</code> that points to the <code class="email">Magento\Framework\Event\Manager\Proxy</code> class type. The <code class="email">Proxy</code> class further extends the <code class="email">\Magento\Framework\Event\Manager</code> class that implements the actual event dispatch method.</p><p class="calibre7">Events are dispatched by calling a dispatch method on the instance of the <code class="email">Event\Manager</code> class and passing the name and some data, which is optional, to it. Here's an example of a <code class="email">Magento</code> core event:</p><div class="informalexample"><pre class="programlisting">$this-&gt;eventManager-&gt;dispatch(
    'customer_customer_authenticated',
    ['model' =&gt; $this-&gt;getFullCustomerObject($customer), 'password' =&gt; $password]
);</pre></div><p class="calibre7">The <code class="email">$this-&gt;eventManager</code> is an instance of the previously mentioned <code class="email">Event\Manager</code> class. In this case, the event name equals to <code class="email">customer_customer_authenticated</code>, while the data passed to the event is the array with two elements. The preceding event is fired when the authenticate method is called on <code class="email">\Magento\Customer\Model\AccountManagement</code>, that is, when a customer logs in.</p><p class="calibre7">Dispatching <a id="id248" class="calibre1"/>an event only makes sense if we expect someone to observe it <a id="id249" class="calibre1"/>and execute their code when the event is dispatched. Depending on the area from which we want to observe events, we can define observers in one of the following XML files:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">app/code/{vendorName}/{moduleName}/etc/events.xml</code></li><li class="listitem"><code class="email">app/code/{vendorName}/{moduleName}/etc/frontend/events.xml</code></li><li class="listitem"><code class="email">app/code/{vendorName}/{moduleName}/etc/adminhtml/events.xml</code></li></ul></div><p class="calibre7">Let's define an observer that will log an e-mail address of an authenticated user into a <code class="email">var/log/system.log</code> file. We can use the <code class="email">Foggyline_Office</code> module and add some code to it. As we are interested in the storefront, it makes sense to put the observer in the <code class="email">etc/frontend/events.xml</code> module.</p><p class="calibre7">Let's define the <code class="email">app/code/Foggyline/Office/etc/frontend/events.xml</code> file with content, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;config  xsi:noNamespaceSchemaLocation="urn:magento:framework: Event/etc/events.xsd"&gt;
    &lt;event name="customer_customer_authenticated"&gt;
        &lt;observer name="foggyline_office_customer_authenticated" instance="Foggyline\Office\Observer\LogCustomerEmail" /&gt;
    &lt;/event&gt;
&lt;/config&gt;</pre></div><p class="calibre7">Here, we are specifying a <code class="email">foggyline_office_customer_authenticated</code> observer for the <code class="email">customer_customer_authenticated</code> event. The observer is defined in the <code class="email">LogCustomerEmail</code> class that is placed in the <code class="email">Observer</code> module directory. The <code class="email">Observer</code> class has to implement the <code class="email">Magento\Framework\Event\ObserverInterface</code> class. The <code class="email">Observer</code> interface defines a single execute method. The execute method hosts the observer code and is executed when the <code class="email">customer_customer_authenticated</code> event is dispatched.</p><p class="calibre7">Let's go ahead and define the <code class="email">Foggyline\Office\Observer\LogCustomerEmail</code> class in the <code class="email">app/code/Foggyline/Office/Observer/LogCustomerEmail.php</code> file, as follows:</p><div class="informalexample"><pre class="programlisting">namespace Foggyline\Office\Observer;

use Magento\Framework\Event\ObserverInterface;

class LogCustomerEmail implements ObserverInterface
{
    protected $logger;

    public function __construct(
        \Psr\Log\LoggerInterface $logger
    )
    {
        $this-&gt;logger = $logger;
    }

    /**
     * @param \Magento\Framework\Event\Observer $observer
     * @return self
     */
    public function execute(\Magento\Framework\Event\Observer $observer)
    {
        //$password = $observer-&gt;getEvent()-&gt;getPassword();
        $customer = $observer-&gt;getEvent()-&gt;getModel();
        $this-&gt;logger-&gt;info('Foggyline\Office: ' . $customer-&gt; getEmail());
        return $this;
    }
}</pre></div><p class="calibre7">The <code class="email">execute</code> method<a id="id250" class="calibre1"/> takes a single parameter called <code class="email">$observer</code> of the <code class="email">\Magento\Framework\Event\Observer</code> type. The event that we are observing is <a id="id251" class="calibre1"/>passing two pieces of data within the array, namely the <code class="email">model</code> and <code class="email">password</code>. We can access this by using the <code class="email">$observer-&gt;getEvent()-&gt;get{arrayKeyName}</code> expression. The <code class="email">$customer</code> object is an instance of the <code class="email">Magento\Customer\Model\Data\CustomerSecure</code> class, which contains properties such as <code class="email">email</code>, <code class="email">firstname</code>, <code class="email">lastname</code>, and so on. Thus, we can extract the e-mail address from it and pass it to logger's <code class="email">info</code> method.</p><p class="calibre7">Now that we know how to observe existing events, let's see how we can dispatch our own events. We can dispatch events from almost anywhere in the code, with or without data, as shown in the following example:</p><div class="informalexample"><pre class="programlisting">$this-&gt;eventManager-&gt;dispatch('foggyline_office_foo');
// or
$this-&gt;eventManager-&gt;dispatch(
    'foggyline_office_bar',
    ['var1'=&gt;'val1', 'var2'=&gt;'val2']
);</pre></div><p class="calibre7">It is worth noting that there are two types of events; we can group them in the following way according <a id="id252" class="calibre1"/>to<a id="id253" class="calibre1"/> the way their name is assigned:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre8">Static</strong></span>: <code class="email">$this-&gt;eventManager-&gt;dispatch('event_name', ...)</code></li><li class="listitem"><span class="strong"><strong class="calibre8">Dynamic</strong></span>: <code class="email">$this-&gt;eventManager-&gt;dispatch({expression}.'_event_name', ...)</code></li></ul></div><p class="calibre7">The static <a id="id254" class="calibre1"/>events have a fixed string for a name, while the dynamic ones <a id="id255" class="calibre1"/>have a name that is determined during the runtime. Here's a nice example of the core <code class="email">Magento</code> functionality from the <code class="email">afterLoad</code> method that is defined under <code class="email">lib/internal/Magento/Framework/Data/AbstractSearchResult.php</code>, which showcases how to use both types of events:</p><div class="informalexample"><pre class="programlisting">protected function afterLoad()
{
    $this-&gt;eventManager-&gt;dispatch ('abstract_search_result_load_after', ['collection' =&gt; $this]);
    if ($this-&gt;eventPrefix &amp;&amp; $this-&gt;eventObject) {
        $this-&gt;eventManager-&gt;dispatch($this-&gt;eventPrefix . '_load_after', [$this-&gt;eventObject =&gt; $this]);
    }
}</pre></div><p class="calibre7">We can see a <span class="strong"><em class="calibre9">static</em></span> event (<code class="email">abstract_search_result_load_after</code>) and a dynamic event (<code class="email">$this-&gt;eventPrefix . '_load_after'</code>). The <code class="email">$this-&gt;eventPrefix</code> is an expression that gets evaluated during the runtime. We should be careful when using dynamic events as they are triggered under multiple situations. Some interesting dynamic events are the one defined on classes like the following ones:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">Magento\Framework\Model\AbstractModel</code><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_load_before'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_load_after'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_save_commit_after'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_save_before'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_save_after'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_delete_before'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_delete_after'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_delete_commit_after'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_clear'</code></li></ul></div></li><li class="listitem"><code class="email">\Magento\Framework\Model\ResourceModel\Db\Collection\AbstractCollection</code><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_load_before'</code></li><li class="listitem"><code class="email">$this-&gt;_eventPrefix . '_load_after'</code></li></ul></div></li><li class="listitem"><code class="email">\Magento\Framework\App\Action\Action</code><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="email">'controller_action_predispatch_' . $request-&gt; getRouteName()</code></li><li class="listitem"><code class="email">'controller_action_predispatch_' . $request-&gt; getFullActionName()</code></li><li class="listitem"><code class="email">'controller_action_postdispatch_' . $request-&gt; getFullActionName()</code></li><li class="listitem"><code class="email">'controller_action_postdispatch_' . $request-&gt; getRouteName()</code></li></ul></div></li><li class="listitem"><code class="email">Magento\Framework\View\Result\Layout</code></li><li class="listitem"><code class="email">'layout_render_before_' . $this-&gt;request-&gt; getFullActionName()</code></li></ul></div><p class="calibre7">These <a id="id256" class="calibre1"/>events are fired on the <code class="email">model</code>, <code class="email">collection</code>, <code class="email">controller</code>, and <code class="email">layout</code> classes, which <a id="id257" class="calibre1"/>are probably among the most used backend elements that often require observing and interacting. Even though we can say that the full event name is known during the runtime along with the dynamic event, this can be assumed even before the runtime.</p><p class="calibre7">For example, assuming that we want to observe <code class="email">'controller_action_predispatch_' . $request-&gt;getFullActionName()</code> for the <code class="email">Foggyline_Office</code> module's <code class="email">Crud</code> controller action, the actual full event name will be <code class="email">'controller_action_predispatch_foggyline_office_test_crud'</code>, given that <code class="email">$request-&gt;getFullActionName()</code> will resolve to <code class="email">foggyline_office_test_crud</code> during the runtime.</p></div>
<div class="book" title="Cache(s)"><div class="book" id="1KEEU2-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec49" class="calibre1"/>Cache(s)</h1></div></div></div><p class="calibre7"><code class="email">Magento</code> has eleven<a id="id258" class="calibre1"/> out-of-the-box cache types, according to the following list. These are used across many levels within the system:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre8">Configuration</strong></span>: Various XML configurations that were collected across modules and merged</li><li class="listitem"><span class="strong"><strong class="calibre8">Layouts</strong></span>: Layout building instructions</li><li class="listitem"><span class="strong"><strong class="calibre8">Blocks HTML output</strong></span>: Page blocks HTML</li><li class="listitem"><span class="strong"><strong class="calibre8">Collections data</strong></span>: Collection data files</li><li class="listitem"><span class="strong"><strong class="calibre8">Reflection data</strong></span>: API interfaces reflection data</li><li class="listitem"><span class="strong"><strong class="calibre8">Database DDL operations</strong></span>: Results of DDL queries, such as describing tables or indexes</li><li class="listitem"><span class="strong"><strong class="calibre8">EAV types and attributes</strong></span>: Entity types declaration cache</li><li class="listitem"><span class="strong"><strong class="calibre8">Page cache</strong></span>: Full page caching</li><li class="listitem"><span class="strong"><strong class="calibre8">Translations</strong></span>: Translation files</li><li class="listitem"><span class="strong"><strong class="calibre8">Integrations configuration</strong></span>: Integration configuration file</li><li class="listitem"><span class="strong"><strong class="calibre8">Integrations API configuration</strong></span>: Integrations API configuration file</li><li class="listitem"><span class="strong"><strong class="calibre8">Web services configuration</strong></span>: REST and SOAP configurations, generated WSDL file</li></ul></div><p class="calibre7">There is also <span class="strong"><strong class="calibre8">Additional Cache Management</strong></span> that manages the cache for the following files:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Previously<a id="id259" class="calibre1"/> generated product image files</li><li class="listitem">Themes JavaScript and CSS files combined to one file</li><li class="listitem">Preprocessed view files and static files</li></ul></div><p class="calibre7">Each of these caches can be cleared separately.</p><p class="calibre7">We can easily define our own cache type. We can do so by first creating an <code class="email">app/code/Foggyline/Office/etc/cache.xml</code> file with content, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;config  xsi:noNamespaceSchemaLocation="urn:magento:framework:Cache/etc/ cache.xsd"&gt;
    &lt;type name="foggyline_office"
          instance="Foggyline\Office\Model\Cache"&gt;
        &lt;label&gt;Foggyline Office Example&lt;/label&gt;
        &lt;description&gt;Example cache from Foggyline Office module.&lt;/description&gt;
    &lt;/type&gt;
&lt;/config&gt;</pre></div><p class="calibre7">When defining a new cache type, we need to specify its <code class="email">name</code> and <code class="email">instance</code> attributes. The <code class="email">name</code> attribute of the <code class="email">type</code> element should be set to <code class="email">foggyline_office</code> and should be unique across <code class="email">Magento</code>. This value should match the <code class="email">TYPE_IDENTIFIER</code> constant value on the <code class="email">Foggyline\Office\Model\Cache</code> class, which will be created soon. The <code class="email">instance</code> attribute holds the class name that we will use for caching.</p><p class="calibre7">Then, we will define the <code class="email">Foggyline\Office\Model\Cache</code> class in the <code class="email">app/code/Foggyline/Office/Model/Cache.php</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">namespace Foggyline\Office\Model;

class Cache extends \Magento\Framework\Cache\Frontend\Decorator\TagScope
{
    const TYPE_IDENTIFIER = 'foggyline_office';

    const CACHE_TAG = 'OFFICE';

    public function __construct(
        \Magento\Framework\App\Cache\Type\FrontendPool $cacheFrontendPool
    )
    {
        parent::__construct(
            $cacheFrontendPool-&gt;get(self::TYPE_IDENTIFIER), self::CACHE_TAG
        );
    }
}</pre></div><p class="calibre7">The <code class="email">Cache</code> class <a id="id260" class="calibre1"/>extends from <code class="email">TagScope</code> and specifies its own values for <code class="email">TYPE_IDENTIFIER</code> and <code class="email">CACHE_TAG</code>, passing them along to the parent constructor in the <code class="email">__construct</code> method. With these two files (<code class="email">cache.xml</code> and <code class="email">Cache</code>), we have basically defined a new cache type.</p><p class="calibre7">Once we have specified the <code class="email">cache.xml</code> file and the referenced <code class="email">cache</code> class, we should be able to see our cache type in the <code class="email">Magento</code> admin under the <span class="strong"><strong class="calibre8">System</strong></span> | <span class="strong"><strong class="calibre8">Tools</strong></span> | <span class="strong"><strong class="calibre8">Cache Management</strong></span> menu, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00048.jpeg" alt="Cache(s)" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">On its own, simply defining a new cache does not mean that it will get filled and used by <code class="email">Magento</code>.</p><p class="calibre7">If you would <a id="id261" class="calibre1"/>like to use the cache anywhere within your code, you can do so by first passing the instance of the cache class to the constructor, as follows:</p><div class="informalexample"><pre class="programlisting">protected $cache;

public function __construct(
    \Foggyline\Office\Model\Cache $cache
)
{
    $this-&gt;cache = $cache;
}</pre></div><p class="calibre7">Then, you can execute a chunk of code, as follows:</p><div class="informalexample"><pre class="programlisting">$cacheId = 'some-specific-id';
$objInfo = null;
$_objInfo = $this-&gt;cache-&gt;load($cacheId);

if ($_objInfo) {
    $objInfo = unserialize($_objInfo);
} else {
    $objInfo = [
        'var1'=&gt; 'val1',
        'var2' =&gt; 'val2',
        'var3' =&gt; 'val3'
    ];
    $this-&gt;cache-&gt;save(serialize($objInfo), $cacheId);
}</pre></div><p class="calibre7">The preceding code shows how we first try to load the value from the existing cache entry, and if there is none, we save it. If the cache type is set to <code class="email">disabled</code> under the <span class="strong"><strong class="calibre8">Cache Management</strong></span> menu, then the preceding code will never save and pull the data from the cache, as it is not in effect.</p><p class="calibre7">If you take a look at the <code class="email">var/cache</code> folder of <code class="email">Magento</code> at this point, you will see something similar to what's shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00049.jpeg" alt="Cache(s)" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7"><code class="email">Magento</code> created<a id="id262" class="calibre1"/> two cache entries for us, namely <code class="email">var/cache/mage-tags/mage---a8a_OFFICE</code> and <code class="email">var/cache/mage--f/mage---a8a_SOME_SPECIFIC_ID</code>. The <code class="email">mage---a8a_OFFICE</code> file has only a single line of entry in this specific case, and the entry is the <code class="email">a8a_SOME_SPECIFIC_ID</code> string, which obviously points to the other file. The <code class="email">mage---a8a_SOME_SPECIFIC_ID</code> file contains the actual serialized <code class="email">$objInfo</code> array.</p><p class="calibre7">The <code class="email">a8a_</code> prefix and other prefixes in the <code class="email">cache</code> file names are not really relevant to us; this is something that <code class="email">Magento</code> adds on its own. What is relevant to us is the passing of proper individual cache tags to the chunks or variables that we want to cache, like in the preceding example, and the <code class="email">TYPE_IDENTIFIER</code> and <code class="email">CACHE_TAG</code> tags that we set for the <code class="email">Cache</code> class.</p></div>
<div class="book" title="Widgets" id="1LCVG1-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec50" class="calibre1"/>Widgets</h1></div></div></div><p class="calibre7"><code class="email">Magento</code> provides<a id="id263" class="calibre1"/> support for widgets. Though the word "widget" might imply frontend development skills and activities, we will look at them as a part of the backend development flow because creating useful and robust widgets requires a significant amount of backend knowledge.</p><p class="calibre7"><code class="email">Magento</code> provides several out-of-the-box widgets; some of them are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem">CMS page link</li><li class="listitem">CMS static block</li><li class="listitem">Catalog category link</li><li class="listitem">Catalog new products list</li><li class="listitem">Catalog product link</li><li class="listitem">Catalog products list</li><li class="listitem">Orders and returns</li><li class="listitem">Recently compared products</li><li class="listitem">Recently viewed products</li></ul></div><p class="calibre7">To create a<a id="id264" class="calibre1"/> fully custom widget, we start by defining <code class="email">app/code/Foggyline/Office/etc/widget.xml</code> with content, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;widgets  xsi:noNamespaceSchemaLocation="urn:magento:module: Magento_Widget:etc/widget.xsd"&gt;
    &lt;widget id="foggyline_office"
        class="Foggyline\Office\Block\Widget\Example"
            placeholder_image="Magento_Cms::images/ widget_block.png"&gt;
        &lt;label translate="true"&gt;Foggyline Office&lt;/label&gt;
        &lt;description translate="true"&gt;Example Widget&lt;/description&gt;
        &lt;parameters&gt;
            &lt;parameter name="var1" xsi:type="select" visible="true" source_model="Magento\Config\Model \Config\Source\Yesno"&gt;
                &lt;label translate="true"&gt;Yes/No var1&lt;/label&gt;
            &lt;/parameter&gt;
            &lt;parameter name="var2" xsi:type="text" required="true" visible="true"&gt;
                &lt;label translate="true"&gt;Number var2&lt;/label&gt;
                &lt;depends&gt;
                    &lt;parameter name="var1" value="1"/&gt;
                &lt;/depends&gt;
                &lt;value&gt;5&lt;/value&gt;
            &lt;/parameter&gt;
        &lt;/parameters&gt;
    &lt;/widget&gt;
&lt;/widgets&gt;</pre></div><p class="calibre7">The <code class="email">id</code>  widget has been set to <code class="email">foggyline_office</code>, while the class powering widget has been set to <code class="email">Foggyline\Office\Block\Widget\Example</code>. the <code class="email">widget</code> class is basically a <code class="email">block</code> class that extends from <code class="email">\Magento\Framework\View\Element\AbstractBlock</code> and implements <code class="email">\Magento\Widget\Block\BlockInterface</code>. The <code class="email">label</code> and <code class="email">description</code> element set values appear under the <code class="email">Magento</code> admin when we select the widget for use.</p><p class="calibre7">The parameters of a widget are its configurable options that translate into HTML form elements, depending on the <code class="email">type</code> and <code class="email">source_model</code> options that we have selected. In the following <a id="id265" class="calibre1"/>example, we will demonstrate the usage of the <code class="email">select</code> and <code class="email">text</code> elements to retrieve input from a user, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00050.jpeg" alt="Widgets" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">Let's proceed by creating the actual <code class="email">Widget</code>\<code class="email">Example</code> class in the <code class="email">app/code/Foggyline/Office/Block/Widget/Example.php</code> file with content, as follows:</p><div class="informalexample"><pre class="programlisting">namespace Foggyline\Office\Block\Widget;

class Example extends \Magento\Framework\View\Element\Text implements \Magento\Widget\Block\BlockInterface
{
    protected function _beforeToHtml()
    {
        $this-&gt;setText(sprintf(
            'example widget: var1=%s, var2=%s',
            $this-&gt;getData('var1'),
            $this-&gt;getData('var2')
        ));

        return parent::_beforeToHtml();
    }
}</pre></div><p class="calibre7">What is happening here is that we are using <code class="email">Element\Text</code> as a block type and not <code class="email">Element\Template</code> because we want to simplify the example, as <code class="email">Element\Template</code> will require the <code class="email">phtml</code> template to be defined as well. By using <code class="email">Element\Text</code>, we can simply define <code class="email">_beforeToHtml</code> and call the <code class="email">setText</code> method to set the text string of the block's output. We will build the output string by picking up the <code class="email">var1</code> and <code class="email">var2</code> variables, which were passed as parameters to the block.</p><p class="calibre7">Now, if we <a id="id266" class="calibre1"/>open the <code class="email">Magento</code> admin area, go to <span class="strong"><strong class="calibre8">Content</strong></span> | <span class="strong"><strong class="calibre8">Elements</strong></span> | <span class="strong"><strong class="calibre8">Pages</strong></span>, and select <span class="strong"><strong class="calibre8">Home Page</strong></span> to edit, we should be able to click on the <span class="strong"><strong class="calibre8">Insert Frontend App</strong></span> button and add our widget to the page. Alternatively, if we are not editing the page content in the <code class="email">WYSIWYG</code> mode, we can also add the widget manually to the page by using the following expression:</p><div class="informalexample"><pre class="programlisting">{{widget type="Foggyline\\Office\\Block\\Widget\\Example" var1="1" var2="5"}}</pre></div><p class="calibre7">Finally, we should see the example widget: <code class="email">var1=1, var2=5</code> string in the browser while visiting the home page of the storefront.</p><p class="calibre7">We can use frontend apps to create highly configurable and embeddable widgets that users can easily assign to a CMS page or block.</p></div>
<div class="book" title="Custom variables" id="1MBG21-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec51" class="calibre1"/>Custom variables</h1></div></div></div><p class="calibre7">Variables<a id="id267" class="calibre1"/> are a handy little feature of a core <code class="email">Magento_Variable</code> module. <code class="email">Magento</code> allows you to create custom variables and then use them in e-mail templates, the <code class="email">WYSIWYG</code> editor, or even code expressions.</p><p class="calibre7">The following steps outline how we can create a new variable manually:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In the <code class="email">Magento</code> admin area, navigate to <span class="strong"><strong class="calibre8">System</strong></span> | <span class="strong"><strong class="calibre8">Other Settings</strong></span> | <span class="strong"><strong class="calibre8">Custom Variables</strong></span>.</li><li class="listitem" value="2">Click on the <span class="strong"><strong class="calibre8">Add New Variable</strong></span> button.</li><li class="listitem" value="3">While keeping in mind the <span class="strong"><strong class="calibre8">Store View</strong></span> switcher, fill in the required <span class="strong"><strong class="calibre8">Variable Code</strong></span> and <span class="strong"><strong class="calibre8">Variable Name</strong></span> options, and preferably one of the optional options, either <span class="strong"><strong class="calibre8">Variable HTML Value</strong></span> or <span class="strong"><strong class="calibre8">Variable Plain Value</strong></span>.</li><li class="listitem" value="4">Click on the <span class="strong"><strong class="calibre8">Save</strong></span> button.</li></ol><div class="calibre14"/></div><p class="calibre7">Now that we have created the custom variable, we can use it in an e-mail template or the <code class="email">WYSIWYG</code> editor by calling it using the following expression:</p><div class="informalexample"><pre class="programlisting">{{customVar code=foggyline_hello}}</pre></div><p class="calibre7">The preceding expression will call for the value of the <code class="email">custom</code> variable with code <code class="email">foggyline_hello</code>.</p><p class="calibre7">Variables can be used within various code expressions, though it is not recommended to rely on the existence of an individual variable, as an admin user can delete it at any point. The following example demonstrates how we can use an existing variable in the code:</p><div class="informalexample"><pre class="programlisting">$storeId =0;

$variable = $this-&gt;_variableFactory-&gt;create()-&gt;setStoreId(
    $storeId
)-&gt;loadByCode(
    'foggyline_hello'
);

$value = $variable-&gt;getValue(
    \Magento\Variable\Model\Variable::TYPE_HTML
);</pre></div><p class="calibre7">The <code class="email">$this-&gt;_variableFactory</code> is an instance of <code class="email">\Magento\Variable\Model\VariableFactory</code>.</p><p class="calibre7">If used in<a id="id268" class="calibre1"/> the right way, variables can be useful. Storing information such as phone numbers or specialized labels that are used in CMS pages, blogs, and e-mail templates is a nice example of using custom variables.</p></div>
<div class="book" title="i18n"><div class="book" id="1NA0K2-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec52" class="calibre1"/>i18n</h1></div></div></div><p class="calibre7"><span class="strong"><strong class="calibre8">i18n</strong></span> is<a id="id269" class="calibre1"/> the abbreviation for <span class="strong"><strong class="calibre8">internationalization</strong></span>. <code class="email">Magento</code> adds i18n support out of the box, thus adapting to various languages and regions without application changes. Within <code class="email">app/functions.php</code>, there is a <code class="email">__()</code> translation function, which is defined as follows:</p><div class="informalexample"><pre class="programlisting">function __()
{
    $argc = func_get_args();

    $text = array_shift($argc);
    if (!empty($argc) &amp;&amp; is_array($argc[0])) {
        $argc = $argc[0];
    }

    return new \Magento\Framework\Phrase($text, $argc);
}</pre></div><p class="calibre7">This <code class="email">translation</code> function accepts a variable number of arguments and passes them to a constructor of the <code class="email">\Magento\Framework\Phrase</code> class and returns its instance. The <code class="email">Phrase</code> class has the <code class="email">__toString</code> method, which then returns the translated string.</p><p class="calibre7">Here are a few examples of how we can use the <code class="email">__()</code> function:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">__('Translate me')</code></li><li class="listitem"><code class="email">__('Var1 %1, Var2 %2, Var %3', time(), date('Y'), 32)</code></li><li class="listitem"><code class="email">__('Copyright %1 &lt;a href="%2"&gt;Magento&lt;/a&gt;', date('Y'), 'http://magento.com')</code></li></ul></div><p class="calibre7">Strings passed through the <code class="email">translation</code> function are expected to be found under the local CSV files, such as <code class="email">app/code/{vendorName}/{moduleName}/i18n/{localeCode}.csv</code>. Let's imagine for a moment<a id="id270" class="calibre1"/> that we have two different store views defined in the <code class="email">Magento</code> admin area under <span class="strong"><strong class="calibre8">Stores</strong></span> | <span class="strong"><strong class="calibre8">Settings</strong></span> | <span class="strong"><strong class="calibre8">All Stores</strong></span>. One store has <span class="strong"><strong class="calibre8">Store</strong></span> | <span class="strong"><strong class="calibre8">Settings</strong></span> | <span class="strong"><strong class="calibre8">Configuration</strong></span> | <span class="strong"><strong class="calibre8">General</strong></span> | <span class="strong"><strong class="calibre8">Locale Options</strong></span> | <span class="strong"><strong class="calibre8">Locale</strong></span> set to <span class="strong"><strong class="calibre8">English (United Kingdom)</strong></span> and the other one to <span class="strong"><strong class="calibre8">German (Germany)</strong></span>. The local code for <span class="strong"><strong class="calibre8">English (United Kingdom)</strong></span> is <code class="email">en_GB</code>, and for <span class="strong"><strong class="calibre8">German (Germany)</strong></span>, it is <code class="email">de_DE</code>.</p><p class="calibre7">For the <code class="email">de_DE</code> locale, we will add translation entries in the <code class="email">app/code/Foggyline/Office/i18n/de_DE.csv</code> file, as follows:</p><div class="informalexample"><pre class="programlisting">"Translate me","de_DE Translate me"
"Var1 %1, Var2 %2, Var %3","de_DE Var1 %1, Var2 %2, Var %3"
"Copyright %1 &lt;a href=""%2""&gt;Magento&lt;/a&gt;","de_DE Copyright %1 &lt;a href=""%2""&gt;Magento&lt;/a&gt;"</pre></div><p class="calibre7">For the <code class="email">en_GB</code> locale, we will add translation entries in the <code class="email">app/code/Foggyline/Office/i18n/en_GB.csv</code> file, as follows:</p><div class="informalexample"><pre class="programlisting">"Translate me","en_GB Translate me"
"Var1 %1, Var2 %2, Var %3", "en_GB Var1 %1, Var2 %2, Var %3"
"Copyright %1 &lt;a href=""%2""&gt;Magento&lt;/a&gt;","en_GB Copyright %1 &lt;a href=""%2""&gt;Magento&lt;/a&gt;"</pre></div><p class="calibre7">Looking at <a id="id271" class="calibre1"/>the two CSV files, a pattern emerges. We can see that the CSV files function in the following way:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Individual translation strings are provided according to every line of CSV</li><li class="listitem">Each line further comprises two individual strings that are separated by a comma</li><li class="listitem">Both individual strings are surrounded by quotes</li><li class="listitem">If a string contains quotes, it is escaped by a double quote so that it does not break translation</li><li class="listitem">The <code class="email">%1</code>, <code class="email">%2</code>, <code class="email">%3</code>...<code class="email">%n</code> pattern is used to mark variable placeholders that we provided during application runtime through the code</li></ul></div><p class="calibre7"><code class="email">Magento</code> supports several commands related to its <code class="email">bin/magento</code> console tool:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">i18n</strong></span>
<span class="strong"><strong class="calibre8">    i18n:collect-phrases   Discovers phrases in the codebase</strong></span>
<span class="strong"><strong class="calibre8">    i18n:pack              Saves language package</strong></span>
<span class="strong"><strong class="calibre8">    i18n:uninstall         Uninstalls language packages</strong></span>
</pre></div><p class="calibre7">If we execute a console command as follows, Magento will recursively look for translatable expressions within PHP, PHTML, or XML files that have phrases to translate:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">php bin/magento i18n:collect-phrases -o "/Users/branko/www/magento2/app/code/Foggyline/Office/i18n/en_GB.csv" /Users/branko/www/magento2/app/code/Foggyline/Office</strong></span>
</pre></div><p class="calibre7">The output<a id="id272" class="calibre1"/> of the preceding command will basically overwrite the <code class="email">app/code/Foggyline/Office/i18n/en_GB.csv</code> file, which has all the <code class="email">Foggyline/Office</code> module translatable phrases. This is a nice way of aggregating all the translatable phrases into appropriate locale files, such as <code class="email">en_GB.csv</code> in this case.</p><p class="calibre7">The translation CSV files can also be placed under the individual theme. For example, let's imagine a situation where we add content to <code class="email">app/design/frontend/Magento/blank/i18n/en_GB.csv</code>, as follows:</p><div class="informalexample"><pre class="programlisting">"Translate me","Theme_en_GB Translate me"
"Var1 %1, Var2 %2, Var %3", "Theme_en_GB Var1 %1, Var2 %2, Var %3"
"Copyright %1 &lt;a href=""%2""&gt;Magento&lt;/a&gt;","Theme_en_GB Copyright %1 &lt;a href=""%2""&gt;Magento&lt;/a&gt;"</pre></div><p class="calibre7">Now, a <code class="email">Translate me</code> string output of the storefront for the <code class="email">en_GB</code> locale would resolve to <code class="email">Theme_en_GB Translate me</code> and not to the <code class="email">en_GB Translate me</code> string.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip12" class="calibre1"/>Tip</h3><p class="calibre7">Theme CSV translations take higher precedence than module CSV translations, thus enabling developers to override individual module translations.</p></div><p class="calibre7">Along with CSV translation files, <code class="email">Magento</code> also supports a feature called <span class="strong"><strong class="calibre8">inline translation</strong></span>. We <a id="id273" class="calibre1"/>can activate the inline translation in the <code class="email">Magento</code> admin area by navigating to <span class="strong"><strong class="calibre8">Store</strong></span> | <span class="strong"><strong class="calibre8">Settings</strong></span> | <span class="strong"><strong class="calibre8">Configuration</strong></span> | <span class="strong"><strong class="calibre8">Advanced</strong></span> | <span class="strong"><strong class="calibre8">Developer</strong></span> | <span class="strong"><strong class="calibre8">Translate Inline</strong></span>. This feature can be turned on separately for admin and storefront, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00051.jpeg" alt="i18n" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">As shown in<a id="id274" class="calibre1"/> the preceding screenshot, when a feature is activated, red dotted borders appear around the HTML elements. Hovering over an individual element shows a little book icon near the individual element at the bottom left corner. Clicking on the book icon opens a popup, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00052.jpeg" alt="i18n" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">It is important to<a id="id275" class="calibre1"/> note that these red dotted borders and the book icon will only appear for strings that we passed through the <code class="email">__()</code> translate function.</p><p class="calibre7">Here, we can see various pieces of information about the string, such as the <code class="email">Shown</code>, <code class="email">Translated</code>, and <code class="email">Original</code> string. There is also an input field called <code class="email">Custom</code>, where we can add a new translation. Inline translation strings are stored in the <code class="email">translation</code> table in the database.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip13" class="calibre1"/>Tip</h3><p class="calibre7">Inline translation takes higher precedence than theme CSV translation files.</p></div></div></body></html>