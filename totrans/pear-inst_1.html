<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Acquiring PEAR: What is it and How do I Get It?"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Acquiring PEAR: What is it and How do I Get It?</h1></div></div></div><p>Chances are, you've seen the acronym PEAR at some point in your use of PHP, whether it was in passing or when installing and using a package from <code class="literal"> pear.php.net</code>. If you've investigated, you might have probably heard of popular software provided by PEAR, such as the DB database abstraction package, or the HTML_QuickForm package. What you may not realize is that PEAR is much more than just a collection of packages that you can use. PEAR also contains the most versatile installation program for PHP, the PEAR installer. With the PEAR installer, you can do much more than just install packages from <code class="literal"> pear.php.net</code>. You can install packages from other PEAR channels, distribute your own software projects using your own PEAR channel, and even maintain a complex intranet web project, all using the PEAR installer. Surprised? Read on, this book will reveal the intimate secrets of the PEAR installer and how it will revolutionize your everyday development with the PHP programming language.<a id="id0" class="indexterm"/>
</p><p>The primary purpose of PEAR is to support code reuse.<span class="strong"><strong> PEAR</strong></span> stands for the<span class="strong"><strong> PHP Extension and Application Repository</strong></span>. PEAR provides both an advanced installer and a code repository at <a class="ulink" href="http://pear.php.net"> http://pear.php.net</a>. Unlike competing PHP code repositories that you may be familiar with such as <a class="ulink" href="http://www.phpclasses.org"> http://www.phpclasses.org</a> or general purpose development sites like <a class="ulink" href="http://www.sourceforge.net"> http://www.sourceforge.net</a>, all PEAR code is organized into discrete reusable components called packages. A<span class="strong"><strong> package</strong></span> consists of a group of files and a descriptor file called<code class="literal"> package.xml</code> that contains meta-data about the package's contents, such as the package version, any special dependencies, and textual information such as the package description and authors.<a id="id1" class="indexterm"/>
</p><p>Although most packages contain PHP code, there is no special restriction on the contents of a package. Some packages, such as <a class="ulink" href="http://pear.php.net/HTML_AJAX"> http://pear.php.net/HTML_AJAX</a> provide JavaScript files as well as PHP files. One of the example packages mentioned in <a class="link" href="ch04.html" title="Chapter 4. Clever Website Coordination Using the PEAR Installer">Chapter 4</a> bundles only MP3 music files. Literally anything you can save as a file can be distributed in a PEAR package.</p><p>The software that transforms a package from an inert grouping of files into a dynamic software package is called the<span class="strong"><strong> PEAR installer</strong></span> and is itself a PEAR package, located at <a class="ulink" href="http://pear.php.net/PEAR"> http://pear.php.net/PEAR</a>. In other words, the PEAR installer can be used to upgrade itself. It is truly a very powerful application.<a id="id2" class="indexterm"/>
</p><p>Traditionally, PHP software has been distributed with a passive installation approach, following these typical steps:<a id="id3" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download a<code class="literal"> .zip</code> or a<code class="literal"> .tar.gz</code> containing all the files of the application</li><li class="listitem">Decompress the files into a folder in your website's document root</li><li class="listitem">Read the<span class="emphasis"><em> Readme</em></span> and<span class="emphasis"><em> Install</em></span> files</li><li class="listitem">Do various post-installation tasks, creating files, checking requirements</li><li class="listitem">Test it</li><li class="listitem">Often, changes are required at the system-level changes (adding extensions to<code class="literal"> php.ini</code>, changing<code class="literal"> php.ini</code> settings, upgrading PHP itself)</li></ol></div><p>For lack of a better name, we'll call this the "<span class="emphasis"><em>unzip-and-go</em></span>" system of PHP software distribution. Although this in fact works very well for small, single-developer low-traffic websites, it contains a hidden cost that is not immediately apparent. There is one single fact about the unzip-and-go software installation system that limits its ultimate usefulness:</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"/>Tip</h3><p>Upgrading unzip-and-go installations is very hard</p></div><p>In today's fast-paced development world, one of the weaknesses of the Internet is security. Quite often, serious security vulnerabilities are discovered in software that requires an immediate upgrade to fix. When using a complete unzip-and-go software application, upgrading involves a large degree of risk. First of all, once the upgrade is complete, if the software is broken, reverting the upgrade requires either restoring from a backup or re-installing the old software. Reverting to an earlier package version with the PEAR installer is a one-line command and is very straightforward.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note02"/>Note</h3><p><span class="strong"><strong>Why is Upgrading Necessary at all if the Code is Working?</strong></span></p><p>Just a month before writing this chapter, our hosting provider's website was compromised. Due to a number of unfortunate events, I was completely locked out of our server for an unacceptable period of time and we lost business as a result of the delay in receiving important emails.</p><p>The cause of this compromise was — an innocent installation of an outdated copy of a CVS viewing program. The program contained an arbitrary PHP execution vulnerability, and the systems administrator had not upgraded to the latest version because it was tremendously difficult to upgrade the viewing software.</p><p>Had this same software been distributed as a PEAR package, upgrading would have been a one-line command as follows:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear upgrade PackageName
</strong></span>
</pre></div><p>The lost business would have never been a problem then. In today's world, upgrading software is in fact critical to the long-term success of any website, no matter how large or small.</p></div><p>The advantages of using the PEAR installer over a simple unzip-and-go solution are most apparent when projects grow in complexity. Let's look at a short list of the advantages:<a id="id4" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">File conflicts are not possible</li><li class="listitem" style="list-style-type: disc">Problems caused by incompatible PHP versions/PHP extensions/PHP code are all handled by advanced dependency resolution</li><li class="listitem" style="list-style-type: disc">Distributing application development between different sites is simple due to the revolutionary new PEAR channels feature introduced in PEAR version 1.4.0 (<a class="link" href="ch05.html" title="Chapter 5. Releasing to the World: PEAR Channels">Chapter 5</a> is devoted to exploration of PEAR channels)</li><li class="listitem" style="list-style-type: disc">All installation configurations can be handled in a standardized and consistent way for all packages — once you learn how to handle one PEAR package; all the others are handled in the same way.</li><li class="listitem" style="list-style-type: disc">Versioning of code allows clear fault resolution as well as the ability to revert changes that break code.</li></ul></div><p>Before using the PEAR installer, it is important to understand the disadvantages of using the PEAR installer over unzip-and-go:<a id="id5" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The PEAR installer itself must be installed on the development machine and preferably on the server (although this is no longer required thanks to the PEAR_RemoteInstaller package, discussed in section 1.3.3.1, Synchronizing to a server with no shell access using PEAR_RemoteInstaller).</li><li class="listitem" style="list-style-type: disc">If you are distributing your own packages, you need a full understanding of the<code class="literal"> package.xml</code> description file, and possibly an understanding of PEAR channels in order to set one up yourself.</li><li class="listitem" style="list-style-type: disc">Depending on relative file locations is not always possible through traditional means. This is due to the flexibility of PEAR configuration. Rather than relying upon<code class="literal"> dirname(__FILE__)</code>, a PEAR-specific way must be used, such as file replacement tasks (discussed in <a class="link" href="ch02.html" title="Chapter 2. Mastering PHP Software Management with the PEAR Installer">Chapter 2</a>).</li><li class="listitem" style="list-style-type: disc">Additional configuration outside of<code class="literal"> php.ini</code> may be needed in<code class="literal"> pear.conf/pear.ini</code> (most of this configuration is handled when the PEAR installer is installed).<a id="id6" class="indexterm"/></li></ul></div><p>The most significant barrier to using PEAR has traditionally been the effort it takes to install the PEAR installer itself, and this has been the focus of recent efforts to improve the installer's installation process. There is a great deal of possibility in recent innovations made possible by PHP version 5.1.0 or newer, as evidenced by work made possible by the PHP_Archive PEAR package ( <a class="ulink" href="http://pear.php.net/PHP_Archive">http://pear.php.net/PHP_Archive</a>) and its sibling, the phar PECL extension ( <a class="ulink" href="http://pecl.php.net/phar">http://pecl.php.net/phar</a>). These packages enable the distribution of an application in a single file that greatly enhances the capabilities of an installer.</p><div class="section" title="A Democratic Innovation for PHP: PEAR Channels"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec01"/>A Democratic Innovation for PHP: PEAR Channels</h1></div></div></div><p>The most important innovation of the PEAR installer is PEAR channels, something that no other package distribution mechanism supports. PEAR channels are a simple way to easily install packages from multiple sources over the Internet.<a id="id7" class="indexterm"/>
</p><p>Through the use of PEAR channels, applications can reliably depend on code from several unrelated sources. Some of the more prominent channels are:<a id="id8" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">pear.php.net:</code> PEAR itself is a channel</li><li class="listitem" style="list-style-type: disc"><code class="literal">pecl.php.net:</code> PECL is for PHP extensions what PEAR is to regular PHP packages</li><li class="listitem" style="list-style-type: disc"><code class="literal">gnope.org:</code> PHP-GTK2 channel</li><li class="listitem" style="list-style-type: disc"><code class="literal">pear.chiaraquartet.net:</code> The first PEAR channel outside the<code class="literal"> php.net</code> domain</li><li class="listitem" style="list-style-type: disc"><code class="literal">components.ez.no:</code> eZ components PEAR channel</li><li class="listitem" style="list-style-type: disc"><code class="literal">pearified.com:</code> source of PEAR-packaged Smarty, phpMyAdmin and others</li></ul></div><p>Also of interest are channel aggregators like:<a id="id9" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"> <a class="ulink" href="http://www.pearadise.com">http://www.pearadise.com:</a> Tobias Schlitt's PEAR channel aggregator</li><li class="listitem" style="list-style-type: disc"> <a class="ulink" href="http://www.pearified.com">http://www.pearified.com:</a> The channel aggregator portion of the pearified channel</li><li class="listitem" style="list-style-type: disc"> <a class="ulink" href="http://www.upear.com">http://www.upear.com:</a> Another aggregator</li></ul></div><p>Each PEAR channel distributes code fitting a wide variety of needs.</p></div></div>
<div class="section" title="What is PEAR? A Code Repository or an Installer?"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec02"/>What is PEAR? A Code Repository or an Installer?</h1></div></div></div><p>PEAR has a tendency to confuse people as the name is used interchangeably for the PEAR installer and for the PEAR repository at<code class="literal"> http://pear.php.net</code>. This confusion naturally arises from the fact that the front page of<code class="literal"> pear.php.net</code> says <span class="strong"><strong>"PEAR is a framework and distribution system for reusable PHP components"</strong></span> but the PEAR installer's package name is "PEAR". In fact, PEAR is both a code repository and an installer; the two are linked inextricably by the fact that much of PEAR's strength is the ability to update a local installation from packages on a remote server over the Internet.<a id="id10" class="indexterm"/>
</p><div class="section" title="PEAR Package Repository and PEAR Channel"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec01"/>PEAR Package Repository and PEAR Channel</h2></div></div></div><p>The PEAR package repository at<code class="literal"> pear.php.net</code> is the official PEAR channel, and is the oldest PEAR channel, predating the concept of PEAR channels by five years. Many popular packages are distributed via<code class="literal"> pear.php.net</code> such as<span class="strong"><strong> HTML_QuickForm, DB_DataObject, MDB2</strong></span>, and<span class="strong"><strong> PhpDocumentor</strong></span>. Most of the time, when people refer to "PEAR" in the abstract, one of the packages distributed at<code class="literal"> pear.php.net</code> is what they are talking about.<a id="id11" class="indexterm"/>
</p><p>The package repository at<code class="literal"> pear.php.net</code> was established in 1999 by Stig Bakken and a few others to help fill in the gaps in PHP. PEAR's first usable release coincided with approximately PHP version 4.0.6. At this time, PEAR was designed as a framework, providing several base classes and an installer to manage them. The PEAR package provided two of the base classes,<code class="literal"> PEAR</code> and<code class="literal"> System</code>. The PEAR class, located in file <code class="literal">PEAR.php</code> was designed to provide basic error handling and a few other add-ons beyond what is available in PHP's internal<code class="literal"> trigger_error()</code> error handling.<a id="id12" class="indexterm"/>
</p><p>Several basic packages were designed to handle common tasks, such as DB for database-independent code,<span class="strong"><strong> HTML_Form</strong></span> for<span class="strong"><strong> HTML Forms, Log</strong></span> for basic logging, and this list expanded (to make a long story short) until the present day where there are 374 packages available from<code class="literal"> pear.php.net</code> at the time of this chapter, and more on the way via pending proposals.<a id="id13" class="indexterm"/>
</p><p>PEAR has had its share of woes since its rosy beginnings. PHP has evolved, and introduced several features that supersede the functionality provided by PEAR. For instance, the<code class="literal"> Exception</code> class introduced in PHP 5.0.0 provides similar functionality to the<code class="literal"> PEAR_Error class</code>, the PDO extension provides similar functionality to the DB package, and so on. In addition, as PEAR has grown, some problems in its initial design as a repository have surfaced and led to both minor and major crises.</p><p>Several good things have come out of these growing pains, including the efficient PEPr proposal system for proposing new packages, and a strong push towards both stability and innovation. Much of the push towards innovation is coming from external pressure due to the advent of new ideas from projects like SolarPHP, eZ components, Phing, Propel, Agavi, and the Zend Framework. However, one of the significant forces of innovation in PEAR is the PEAR installer itself, specifically with the new features found in version 1.4.0 and newer.</p><p>One of the crucial new features in the newer versions of the PEAR installer is PEAR channels. A<span class="strong"><strong> PEAR channel</strong></span> is simply a server that provides packages like<code class="literal"> pear.php.net</code>, and also provides special web services that enable the PEAR installer to communicate with the server; channels are covered in detail in <a class="link" href="ch04.html" title="Chapter 4. Clever Website Coordination Using the PEAR Installer">Chapter 4</a>.<a id="id14" class="indexterm"/>
</p></div><div class="section" title="PEAR Installer"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec02"/>PEAR Installer</h2></div></div></div><p>Most books that discuss PEAR spend a great deal of time on using popular packages from the PEAR repository ( <a class="ulink" href="http://pear.php.net">http://pear.php.net</a>) such as DB ( <a class="ulink" href="http://pear.php.net/DB">http://pear.php.net/DB</a>) or HTML_QuickForm ( <a class="ulink" href="http://pear.php.net/HTML_QuickForm">http://pear.php.net/HTML_QuickForm</a>). This book takes a different route, instead focusing exclusively on the power surrounding the installation mechanism of the PEAR installer itself. When you see a reference to<span class="emphasis"><em> PEAR</em></span> in this book, you should know that it is in fact a reference to the PEAR installer ( <a class="ulink" href="http://pear.php.net/PEAR">http://pear.php.net/PEAR</a>) and not to the repository at large.</p><p>The PEAR installer consists of four abstract task-oriented sections:<a id="id15" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">package.xml</code> parser and dependency processor</li><li class="listitem" style="list-style-type: disc">File installation processor, configuration processor, and package registry</li><li class="listitem" style="list-style-type: disc">User front end and command processor</li><li class="listitem" style="list-style-type: disc">Remote server synchronization and downloading engine</li></ul></div><p>Fortunately, as an end-user, you don't really need to know or care about any of these beyond the way that your application communicates with the installer and how people will actually use the installer to install your code.</p><p>First and foremost, you need to understand how PEAR actually installs its packages, as this is a little different from the old unzip-and-go philosophy. PEAR categorizes files into different types, and installs each file type differently. For instance, files of type php will be installed into a subdirectory of the user's configuration variable<code class="literal"> php_dir</code>. So if the user has set<code class="literal"> php_dir</code> to<code class="literal"> /usr/local/lib/php/pear</code>, a file that is packaged in directory<code class="literal"> Foo/Bar/Test.php</code> will be installed into<code class="literal"> /usr/local/lib/php/pear/Foo/Bar/Test.php</code>. Files of type data will be installed into a subdirectory of the user's configuration variable<code class="literal"> data_dir</code>, but unlike PHP files, data files are installed into their own private sub-directory based on the package name. If the user has set<code class="literal"> data_dir</code> to be<code class="literal"> /usr/local/lib/php/data</code> and the package is named "TestPackage", a file that is packaged in directory<code class="literal"> Foo/Bar/Test.dat</code> will not be installed at<code class="literal"> /usr/local/lib/php/data/Foo/Bar/Test.dat</code>, but instead be installed in<code class="literal"> /usr/local/lib/php/data/TestPackage/Foo/Bar/Test.dat!</code> This and other details of PEAR's installation are covered in <a class="link" href="ch02.html" title="Chapter 2. Mastering PHP Software Management with the PEAR Installer">Chapter 2</a>.</p><p>Next, you need to know a bit about how PEAR knows which files are in a package, what it needs in order to work (i.e. "This package only works in PHP 4.3.0 and newer, and needs any version of the DB_DataObject package, and only versions 1.2.3 of the Log package, recommending version 1.4.6 be installed"), or its dependencies. This information is also covered in <a class="link" href="ch02.html" title="Chapter 2. Mastering PHP Software Management with the PEAR Installer">Chapter 2</a>, where we learn about the<code class="literal"> package.xml</code> file format.<a id="id16" class="indexterm"/>
</p><p>After reading <a class="link" href="ch02.html" title="Chapter 2. Mastering PHP Software Management with the PEAR Installer">Chapters 2</a> and <a class="link" href="ch03.html" title="Chapter 3. Leveraging Full Application Support with the PEAR Installer">3</a>, you should know enough about PEAR to manage the creation of your own packages for local installation, or to propose a new package to the official <code class="literal"> pear.php.net</code> repository. Should you wish to distribute your packages for others to use, whether it be free, for private clients, or for sale, you will need to have an understanding of how PEAR channels work. Setting up a channel server is a relatively easy task. At the time of writing this chapter, there was one option available for setting up a channel, but several potential competing options are on the verge of completion. It's an exciting time to be involved in PHP! Setting up your own channel is covered in <a class="link" href="ch05.html" title="Chapter 5. Releasing to the World: PEAR Channels">Chapter 5</a>.</p><p>Of course, not everyone is distributing their code publicly. Most developers are busy designing their own websites either by themselves or in a team. The PEAR installer is a highly effective tool for managing a complete website when used in conjunction with a revision control system. <a class="link" href="ch04.html" title="Chapter 4. Clever Website Coordination Using the PEAR Installer">Chapter 4</a> covers this topic in great detail.</p><p>In short, the PEAR installer is one of the most effective tools for managing a high-quality software library, high-quality application, or a high-quality website.</p></div></div>
<div class="section" title="Installing the PEAR Installer"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec03"/>Installing the PEAR Installer</h1></div></div></div><p>There are three methods of acquiring PEAR. The first way has been available since PHP 4.2.0, and simply involves installing PHP and either configuring<code class="literal"> --with-pear</code> (on Unix) or running<code class="literal"> go-pear</code> from within the PHP directory.<a id="id17" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip03"/>Tip</h3><p><span class="strong"><strong>I'm Running Windows and my PHP doesn't have PEAR in it, Where is it?</strong></span></p><p>If you are running PHP version 5.1 or older, to get a copy of PHP that bundles PEAR, you need to download the<code class="literal"> .zip</code> file rather than the Windows installer (<code class="literal">.msi</code>). PHP 5.2.0 and newer has vastly improved the Windows Installer (<code class="literal">.msi</code>) distribution, and this is recommended to acquire PEAR. The installer (at least at this time) is not really useful at all, as it is never updated unless there is a critical error. As such, getting the truly useful elements of PHP requires using the<code class="literal"> .zip</code> file. Never fear, PHP is pretty much an unzip-and-go language on Windows.</p><p>If I were less diplomatic, I might say something like "Don't even think about running PHP on Windows as a production server." However, I do feel it is important to say this: "In my opinion, running PHP on Windows as a production server is not worth the effort and expense." Although it can be done, the only reason it should ever be considered is if your boss will fire you on installing Unix. Or you work for a company that maintains the Windows operating system. In that case, you will be forgiven.</p></div><p>The second involves grabbing the go-pear script from <a class="ulink" href="http://pear.php.net/go-pear"> http://pear.php.net/go-pear</a>, and saving it as<code class="literal"> go-pear.php</code>, then running this file. Last, there are a few unofficial sources for acquiring PEAR, the most notable being the Gnope installer that sets up PHP 5.1, PEAR, and PHP-GTK2 in one step.</p><div class="section" title="PEAR Bundled with PHP"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec03"/>PEAR Bundled with PHP</h2></div></div></div><p>As mentioned above, if you are running Windows, installing PEAR is relatively simple. Running the<code class="literal"> go-pear</code> command will run the installation script. In addition, as of PHP version 5.2.0, there is an excellent Windows Installer-based (<code class="literal">.msi</code> file extension) installation mechanism that bundles PEAR in its distribution, and is recommended. For earlier PHP versions, in order to obtain a bundled PEAR, you must download the<code class="literal"> .zip</code> file distribution instead of the<code class="literal"> .msi</code> Windows Installer-based installation mechanism.<a id="id18" class="indexterm"/>
</p><p>If you are running Unix, you need to use at least this minimal configure line to set up PEAR:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ ./configure --enable-cli --enable-tokenizer --with-pcre-regex -- enable-xml
</strong></span>
</pre></div><p>To take full advantage of PEAR, it is a good idea to enable the<code class="literal"> zlib</code> extension for accessing compressed PEAR packages as well:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ ./configure --enable-cli --enable-tokenizer --with-pcre-regex -- enable-xml --with-zlib
</strong></span>
</pre></div><p>When you install, be sure that you have full write access to the directory that PEAR will be installed in (usually<code class="literal"> /usr/local/lib</code>, but configurable with the<code class="literal"> --prefix</code> option;<code class="literal"> /lib</code> is appended to the prefix). When you install PEAR, it will also install the needed packages<code class="literal"> Console_Getopt</code> and<code class="literal"> Archive_Tar</code>.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ make install-pear
Installing PEAR Environment: /usr/local/lib/php/
[PEAR] Archive_Tar - installed : 1.3.1
[PEAR] Console_Getopt installed : 1.2
pear/PEAR can optionally use package "pear/XML_RPC" (version &gt;= 1.4.0)
[PEAR] PEAR - installed : 1.4.9
Wrote PEAR system config file at: /usr/local/etc/pear.conf
You may want to add: /usr/local/lib/php to your php.ini include_path
</strong></span>
</pre></div><p>After completing PEAR installation, as the last line of installation suggests, you will want to ensure that PEAR is in<code class="literal"> php.ini's include_path</code> setting. The easiest way to determine this is to first find<code class="literal"> php.ini:</code>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ php i |grep php[.]ini
Configuration File (php.ini) Path =&gt; /usr/local/lib
</strong></span>
</pre></div><p>This example shows that<code class="literal"> php.ini</code> is located at<code class="literal"> /usr/local/lib/php.ini</code>. Open this file with your favorite editor, and either find the line that says "<code class="literal">include_path=</code>" or add a new one that is something like this:<a id="id19" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">include_path=.:/usr/local/lib/php
</pre></div><p>Of course, substitute the suggested path from your specific installation (the last line of output) for<code class="literal"> /usr/local/lib/php</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip04"/>Tip</h3><p><span class="strong"><strong>What is this so-called "include_path"?</strong></span></p><p>Oh dear — time to pull out the PHP manual again, to be specific, <a class="ulink" href="http://www.php.net/include"> http://www.php.net/include</a>. To summarize, the<code class="literal"> include</code> statement and its cousins<code class="literal"> include_once, require</code> and<code class="literal"> require_once</code> all serve to dynamically include external PHP code. If you pass a full path like<code class="literal"> /path/to/my.php:</code>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>include '/path/to/PEAR.php';
</strong></span>
</pre></div><p>then naturally<code class="literal"> /path/to/my.php</code> will<span class="emphasis"><em> replace</em></span> the include statement and be executed. If, however, you pass in a relative path like:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>include 'PEAR.php';
</strong></span>
</pre></div><p>This will instead search through the<code class="literal"> include_path</code> and try to find a<code class="literal"> PEAR.php</code> file. If the<code class="literal"> include_path</code> is<code class="literal"> .:/usr/local/lib/php</code>, then PHP will first try to find<code class="literal"> PEAR.php</code> in the current directory<code class="literal"> (.)</code>, and if it is not found, then it will search for<code class="literal"> PEAR.php</code> in<code class="literal"> /usr/local/lib/php/PEAR.php</code>. This allows customization of library locations on the disk, which is precisely what PEAR attempts to accomplish.</p></div><p>If you are running Windows, the<code class="literal"> go-pear</code> batch file will prompt you to choose a location to install PEAR, defaulting to either<code class="literal"> C:\php4</code> for version 4,<code class="literal"> C:\php5</code> for version 5.0, or the current directory for version 5.1 or newer. Unless you have a compelling reason to install PEAR elsewhere, it is a good idea to accept the default locations, as it will save some potential trouble later on. If you are installing PEAR from version 5.1.0 or newer, the installer will ask you if you are installing a local or a system installation.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Are you installing a system-wide PEAR or a local copy?
(system|local) [system] :
</strong></span>
</pre></div><p>Simply hit <span class="emphasis"><em> Return</em></span> to install a system-wide PEAR (in general, with installation of PEAR, if you don't know what it is asking you, always choose the default value). Next, it will ask you for a location to install your copy of PEAR:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Below is a suggested file layout for your new PEAR installation. To
change individual locations, type the number in front of the
directory. Type 'all' to change all of them or simply press Enter to
accept these locations.
1. Installation base ($prefix) : C:\php51
2. Binaries directory : C:\php51
3. PHP code directory ($php_dir) : C:\php51\pear
4. Documentation directory : C:\php51\pear\docs
5. Data directory : C:\php51\pear\data
6. Tests directory : C:\php51\pear\tests
7. Name of configuration file : C:\php5\pear.ini
8. Path to CLI php.exe : C:\php51\.
1-8, 'all' or Enter to continue:
</strong></span>
</pre></div><p>Change any values you wish to change by typing the number in front of the item and hit<span class="emphasis"><em> Enter</em></span>. If you wish to change the installation base directory, type<span class="strong"><strong> 1</strong></span> and hit<span class="emphasis"><em> Enter</em></span>. If you want to modify all of the values, type<span class="strong"><strong> all</strong></span> and hit<span class="emphasis"><em> Enter</em></span>. Once you are satisfied, hit<span class="emphasis"><em> Enter</em></span> without typing anything to continue. At this point, it will install packages (which should look similar to what is displayed in Unix installation of PEAR) and finally ask if you would like to modify<code class="literal"> php.ini</code>. If you choose to do this, it will automatically update the<code class="literal"> include_path</code> setting in<code class="literal"> php.ini</code>, and you will be good to go.<a id="id20" class="indexterm"/>
</p></div><div class="section" title="Installation for PHP Versions Older than 5.1.0"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec04"/>Installation for PHP Versions Older than 5.1.0</h2></div></div></div><p>If you have a version of PHP older than 5.1.0 and wish to install PEAR, you should not use the bundled version of PEAR, but instead install PEAR via the<code class="literal"> go-pear</code> script. To retrieve this script, browse to <a class="ulink" href="http://pear.php.net/go-pear"> http://pear.php.net/go-pear</a> in any web browser and save it to disk as<code class="literal"> go-pear.php</code>, or if on Unix, then you have the<code class="literal"> wget</code> command:<a id="id21" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ wget -O go-pear.php http://pear.php.net/go-pear
</strong></span>
</pre></div><p>Once you have<code class="literal"> go-pear.php</code> accessible, simply run it:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ php go-pear.php
</strong></span>
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"/>Tip</h3><p><span class="strong"><strong>Why Just for PHP 5.1.0 and Older?</strong></span></p><p>As I was asked once, "Why is it important to only use the<code class="literal"> go-pear</code> script for PHP versions older than 5.1.0? Will this not also change over time when there is a new PEAR installer released with PHP 6.0.0?"</p><p>The reason for this has to do with how<code class="literal"> go-pear</code> works. The<code class="literal"> go-pear</code> script is a brilliant design that extracts key files directly from CVS based on their release tags and then downloads packages and installs them based on their latest stable version. Although brilliant, this is a dangerous approach that guarantees your installation will break if there is a problem in CVS.</p><p>The PEAR installer bundled with PHP version 5.1.0 and newer is in fact self-contained, does not contact the Internet at all, and is tested and guaranteed to work with that version of PHP. Once PEAR is installed, grabbing the latest version is both easy and safer than using<code class="literal"> go-pear:</code>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>pear upgrade PEAR
</strong></span>
</pre></div></div><p>Output will be very similar to<code class="literal"> go-pear</code> from bundled PHP, but will instead begin with:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ php go-pear.php
Welcome to go-pear!
Go-pear will install the 'pear' command and all the files needed by
it. This command is your tool for PEAR installation and maintenance.
Use 'php go-pear.php local' to install a local copy of PEAR.
Go-pear also lets you download and install the PEAR packages bundled
with PHP: DB, Net_Socket, Net_SMTP, Mail, XML_Parser, PHPUnit.
If you wish to abort, press Control-C now, or press Enter to continue:
</strong></span>
</pre></div><p>Because<code class="literal"> go-pear</code> requires internet access, the next question will be for a proxy. Be sure that if you are behind a firewall, you know whether you need to use a proxy:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>HTTP proxy (http://user:password@proxy.myhost.com:port), or Enter for none::
</strong></span>
</pre></div><p>The next step of the installation process should look pretty familiar:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Below is a suggested file layout for your new PEAR installation. To change individual locations, type the number in front of the directory. Type 'all' to change all of them or simply press Enter to accept these locations.
1. Installation prefix : C:\php51
2. Binaries directory : $prefix
3. PHP code directory ($php_dir) : $prefix\pear
4. Documentation base directory : $php_dir\docs
5. Data base directory : $php_dir\data
6. Tests base directory : $php_dir\tests
7. Temporary files directory :
8. php.exe path : C:\php51\php.exe
1-8, 'all' or Enter to continue:
</strong></span>
</pre></div><p>After choosing location,<code class="literal"> go-pear</code> will download the needed code, and install PEAR packages. It will also ask whether to install a few more packages, and at the end whether to modify<code class="literal"> php.ini</code>.</p><p>If you are feeling adventurous, you might also simply try opening<code class="literal"> go-pear.php</code> inside a web browser. This will install the web front end to PEAR, which is very nice but not as actively maintained as the<span class="strong"><strong> Command-Line Installer</strong></span> (<span class="strong"><strong>CLI</strong></span>).</p></div><div class="section" title="Other Unofficial Sources"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec05"/>Other Unofficial Sources</h2></div></div></div><p>Before we continue, it is important to note that everything in this section is unofficial and therefore not supported by the folks over at <a class="ulink" href="http://pear.php.net"> pear.php.net</a>. Any problems you encounter are the domain of the site from which you downloaded it! Ok, enough preambles.<a id="id22" class="indexterm"/>
</p><p>Christian Weiske over at <a class="ulink" href="http://www.gnope.org"> http://www.gnope.org</a> has been working hard at both making PHP-GTK2 work in PHP 5.1 and making it easy to install PHP-GTK2 applications using PEAR. As such, he worked very closely with me to create a GTK2 front end to the PEAR installer, which is now available through PEAR at <a class="ulink" href="http://pear.php.net/PEAR_Frontend_Gtk2"> http://pear.php.net/PEAR_Frontend_Gtk2</a>. This is the official PHP-GTK2 front end for PEAR. The front end requires that PEAR already be installed in order to use it.</p><p>However, Christian has taken it up a notch, and has written a Windows installer that provides the latest stable PHP 5.1, PEAR, and PHP-GTK2 that sets up everything for you. This is a great way to get started with PEAR, if you are new to the whole process. The current release is version 1.0, but this is an alpha release, so things may not work properly.</p><p>The first thing you should note is that if you have already set up PHP, the PATH environment variable in Windows may cause some conflicts with the existing PHP installation. In short, don't try to install both a regular copy of PHP and the gnope PHP unless you know what you are doing.</p><p>Installing gnope is really easy, just download the installer and run it. The prompts are just like any other Windows installation.</p></div></div>
<div class="section" title="Synchronizing to a Server with no Shell Access Using PEAR_RemoteInstaller"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec04"/>Synchronizing to a Server with no Shell Access Using PEAR_RemoteInstaller</h1></div></div></div><p>Once you have successfully installed PEAR on a development machine, how do you properly install PEAR on the live server? For many developers, this is simply a matter of repeating the same steps on the live server that are performed on the development server. However, many developers out there have the misfortune of using a shared hosting provider who does not provide a shell, but does provide PHP. In the past, this essentially eliminated any possibility of successfully installing PEAR packages.<a id="id23" class="indexterm"/>
</p><p>As of PEAR 1.4.0, this is no longer an issue, thanks to the PEAR_RemoteInstaller package ( <a class="ulink" href="http://pear.php.net/PEAR_RemoteInstaller">http://pear.php.net/PEAR_RemoteInstaller</a>). This package provides special commands for synchronizing a customized PEAR server and the remote server. Unlike other solutions, the only tools required to implement this are PHP 5 on your development machine, and access to an FTP server.<a id="id24" class="indexterm"/>
</p><p>To get started, install PEAR_RemoteInstaller onto your development machine:<a id="id25" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear install PEAR_RemoteInstaller
</strong></span>
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"/>Tip</h3><p><span class="strong"><strong>Publication Limitation</strong></span></p><p>Note that at the time this book was written, the latest version of PEAR_RemoteInstaller was 0.3.0, stability alpha. To install, you will need to append<code class="literal"> alpha</code> or<code class="literal"> -0.3.0</code> as in:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear install PEAR_RemoteInstaller-alpha
</strong></span>
</pre></div><p>Or</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear install PEAR_RemoteInstaller-0.3.0
</strong></span>
</pre></div></div><p>Next, you need to create a configuration file for the remote machine using the<code class="literal"> config-create</code> command. However, before this is possible, it is important to know the full path to your host. The easiest system to determine this is to run this simple script on your web host:</p><div class="informalexample"><pre class="programlisting">&lt;?php
echo __FILE__;
?&gt;
</pre></div><p>Save this as<code class="literal"> me.php</code>, and upload it to your web host. When run, this will output something similar to:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>/home/myuser/htdocs/me.php
</strong></span>
</pre></div><p>Once you have this information, you can begin</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear config-create /home/myuser pear.ini
</strong></span>
</pre></div><p>This will display something similar to:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>CONFIGURATION (CHANNEL PEAR.PHP.NET):
=====================================
Auto-discover new Channels auto_discover &lt;not set&gt;
Default Channel default_channel pear.php.net
HTTP Proxy Server Address http_proxy &lt;not set&gt;
PEAR server [DEPRECATED] master_server &lt;not set&gt;
Default Channel Mirror preferred_mirror &lt;not set&gt;
Remote Configuration File remote_config &lt;not set&gt;
PEAR executables directory bin_dir /home/myuser/pear
PEAR documentation directory doc_dir /home/myuser/pear/docs
PHP extension directory ext_dir /home/myuser/pear/ext
PEAR directory php_dir /home/myuser/pear/php
PEAR Installer cache directory cache_dir /home/myuser/pear/cache
PEAR data directory data_dir /home/myuser/pear/data
PHP CLI/CGI binary php_bin C:\php5\php.exe
PEAR test directory test_dir /home/myuser/pear/tests
Cache TimeToLive cache_ttl &lt;not set&gt;
Preferred Package State preferred_state &lt;not set&gt;
Unix file mask umask &lt;not set&gt;
Debug Log Level verbose &lt;not set&gt;
PEAR password (for password &lt;not set&gt; maintainers)
Signature Handling Program sig_bin &lt;not set&gt;
Signature Key Directory sig_keydir &lt;not set&gt;
Signature Key Id sig_keyid &lt;not set&gt;
Package Signature Type sig_type &lt;not set&gt;
PEAR username (for username &lt;not set&gt; maintainers)
User Configuration File Filename C:\test\pear.ini
System Configuration File Filename #no#system#config#
Successfully created default configuration file "C:\test\pear.ini"
</strong></span>
</pre></div><p>Once you have the<code class="literal"> pear.ini</code> file, upload it to your remote web host and save it in the<code class="literal"> /home/myuser</code> directory (the default directory of your FTP login). Next, we need to create our local working copy of PEAR:<a id="id26" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ mkdir remote
$ cd remote
</strong></span>
</pre></div><p>If you are running Windows:<a id="id27" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear config-create -w C:\remote\ pear.ini
</strong></span>
</pre></div><p>Otherwise (assuming you are running as user<code class="literal"> foo</code> on your development machine):</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear config-create /home/foo pear.ini
</strong></span>
</pre></div><p>Next, determine the kind of FTP connection you use. You'll need to know your username and password for accessing FTP, and the host name. For our example, we will use<code class="literal"> myuser</code> and<code class="literal"> password</code> as the user/password combination, and<code class="literal"> yourwebsite.example.com</code> as the host.</p><p>If you use regular FTP, you will want to do:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini config-set remote_config ftp://myuser:password@yourwebsite.example.com/
</strong></span>
</pre></div><p>If you use FTPS, you will want to do:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini config-set remote_config ftps://myuser:password@yourwebsite.example.com/
</strong></span>
</pre></div><p>If you use SFTP, you will want to do:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini config-set remote_config ssh2.sftp://myuser:password@yourwebsite.example.com/
</strong></span>
</pre></div><p>In order to use SFTP, you need to install the SSH2 extension from<code class="literal"> pecl.php.net</code> ( <a class="ulink" href="http://pecl.php.net/ssh2">http://pecl.php.net/ssh2</a>), an excellent extension written by Sara Golemon. On Unix, this is simple; SSH2 can be installed via:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pecl install ssh2
</strong></span>
</pre></div><p>On Windows,<code class="literal"> php_ssh2.dll</code> should be distributed with your distribution of PHP 5. If not, you can grab a copy from <a class="ulink" href="http://pecl4win.php.net"> http://pecl4win.php.net</a>.</p><p>Once we reach this stage, the next step is to try installing a package. Let's install Savant3, an excellent template engine for PHP 5+ that utilizes the elegance of PHP itself as a templating language.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini channel-discover savant.pearified.com
$ pear -c pear.ini remote-install savant/Savant3
</strong></span>
</pre></div><p>If everything works, you will see:<a id="id28" class="indexterm"/>
</p><p>
<span class="strong"><strong>remote install OK: savant.pearified.com/Savant3-3.0.0</strong></span>
</p><p>At this point, fire up your FTP browser and you'll see that the files were uploaded to <code class="literal"> /home/myuser/pear/php/Savant3.php</code> and to the<code class="literal"> /home/myuser/pear/php/Savant3</code> directory.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip07"/>Tip</h3><p>Errors about alpha/beta</p><p>If installation fails with a notice about preferred state, try appending <a class="ulink" href="http://-alpha"> -alpha</a> as in:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini remote-install savant/Savant3-alpha
</strong></span>
</pre></div><p>This will work because it instructs the installer to temporarily ignore your<code class="literal"> preferred_state</code> configuration variable and to instead download the latest alpha or more stable version. In other words, with a preferred_state of stable, if Savant3 version 3.2.0 stable is available, it will be installed. However, if version 3.2.1 alpha is available, a newer version, it will not be installed because its stability is too low. However, by appending<code class="literal"> -alpha</code>, the installer is instructed to instead grab the newest version 3.2.1 and install that version.</p></div><p>You may be thinking, how does this differ from just extracting the files and uploading them manually? The answer becomes apparent when managing more complex packages like DB_DataObject or LiveUser. Both of these packages have dependencies that must be installed in order to work. Although it is possible to manually install them and upload, it is very easy to forget a dependency. Worse, the entire process has to be repeated upon upgrade.</p><p>Installing DB_DataObject with its dependency on PEAR, Validate, and DB is as simple as:<a id="id29" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini remote-install o DB_DataObject
</strong></span>
</pre></div><p>The same is true of upgrading:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini remote-upgrade o DB_DataObject
</strong></span>
</pre></div><p>Uninstalling is also simple, and responds to the full strength of the PEAR installer's dependency validation:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>$ pear -c pear.ini remote-uninstall DB_DataObject
</strong></span>
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip08"/>Tip</h3><p><span class="strong"><strong>The rsync Method</strong></span></p><p>If you are developing a complex website for a customer who has money, it may be best to develop on an identical machine with identical software and hardware configuration. Set up the entire website locally, and synchronize it with the remote website using<code class="literal"> rsync</code>. This still works well with using source control and a PEAR-installable package, as development should be synced with discrete package versions.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec05"/>Summary</h1></div></div></div><p>In this chapter, we learned about the split personality of PEAR as code repository at <code class="literal">pear.php.net</code> and as the PEAR installer. We investigated the predominant unzip-and-go method of distributing PHP software and compared its advantages and disadvantages to the PEAR installer's package-based method of distributing PHP software. After a quick look into the exciting new innovation of PEAR channels, we took a peek inside the basics of how the PEAR installer installs files from packages and how it knows where to install them. Finally, we learned the many ways to acquire the PEAR installer and even how to install PEAR remotely onto a web host that does not provide shell access.</p></div></body></html>