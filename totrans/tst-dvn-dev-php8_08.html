<html><head></head><body>
<div id="_idContainer126">
<h1 class="chapter-number" id="_idParaDest-120"><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-121"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.2.1">Using TDD with SOLID Principles</span></h1>
<p><span class="koboSpan" id="kobo.3.1">When I first started programming, I instantly got addicted to it. </span><span class="koboSpan" id="kobo.3.2">I felt so excited about the thought of coming up with a solution to a problem using programs and my own imagination. </span><span class="koboSpan" id="kobo.3.3">Back in school, there was a time when the instructor gave us the task of solving some simple algebraic challenges using Turbo-C. </span><span class="koboSpan" id="kobo.3.4">I had goosebumps and felt very excited as I quickly realized I could just write programs to solve these types of challenges repeatedly. </span><span class="koboSpan" id="kobo.3.5">Write the program once, pass different arguments, and get different results. </span><span class="koboSpan" id="kobo.3.6">I loved it. </span><span class="koboSpan" id="kobo.3.7">I remember a challenge to compute the height of a bridge if someone is standing on it, drops a ball, and hears a sound after several seconds. </span><span class="koboSpan" id="kobo.3.8">Easy! </span><span class="koboSpan" id="kobo.3.9">Now, I can just use my program to compute the height of the bridge for me repeatedly. </span><span class="koboSpan" id="kobo.3.10">Now, I don’t have to keep remembering that the Earth’s gravitational acceleration is at around 9.8 m/s2 – I can just declare it in the program! </span><span class="koboSpan" id="kobo.3.11">I learned that in programming, I can follow my own rules to get from point A to point B. </span><span class="koboSpan" id="kobo.3.12">Give me a task, and I can come up with a solution using my own imagination to finish the task. </span><span class="koboSpan" id="kobo.3.13">This, for me, is the best thing about programming. </span><span class="koboSpan" id="kobo.3.14">I was one proud spaghetti-code-writing machine. </span><span class="koboSpan" id="kobo.3.15">I didn’t care about how clean my code was – I just needed to solve problems using code! </span><span class="koboSpan" id="kobo.3.16">Learning about other programming languages made me even more excited, and I thought the possibilities were endless – if the task or challenge did not defy the laws of physics, I thought it could be solved using programming! </span><span class="koboSpan" id="kobo.3.17">I did not pay attention to code cleanliness or maintainability. </span><span class="koboSpan" id="kobo.3.18">What are those? </span><span class="koboSpan" id="kobo.3.19">I don’t need those! </span></p>
<p><span class="koboSpan" id="kobo.4.1">When I started working professionally as a software developer, I continued with my mindset of just enjoying solving problems using programming. </span><span class="koboSpan" id="kobo.4.2">I didn’t care how disorganized my solutions were – they solved the problems, and my employers and clients were happy. </span><span class="koboSpan" id="kobo.4.3">Done, I’m out of here. </span><span class="koboSpan" id="kobo.4.4">Too easy. </span><span class="koboSpan" id="kobo.4.5">I thought I knew everything and that I was unstoppable. </span><span class="koboSpan" id="kobo.4.6">Oh boy, I was so wrong. </span><span class="koboSpan" id="kobo.4.7">The more I learned, the more I realized how little I knew how </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">to program.</span></span></p>
<p><span class="koboSpan" id="kobo.6.1">As I continued working on more complex projects with other developers while having to maintain these projects, I learned the hard way how difficult I had made my life by writing code I couldn’t easily maintain myself. </span><span class="koboSpan" id="kobo.6.2">I’m probably not the only developer on the planet to have experienced this problem. </span><span class="koboSpan" id="kobo.6.3">I was sure other people had encountered these issues before, and I was sure there were solutions out there. </span><span class="koboSpan" id="kobo.6.4">One of the solutions that helped make my life a lot easier was by trying to follow the </span><strong class="bold"><span class="koboSpan" id="kobo.7.1">SOLID</span></strong><span class="koboSpan" id="kobo.8.1"> principles by </span><em class="italic"><span class="koboSpan" id="kobo.9.1">Robert C. </span><span class="koboSpan" id="kobo.9.2">Martin</span></em><span class="koboSpan" id="kobo.10.1">. </span><span class="koboSpan" id="kobo.10.2">They really helped change my programming life, and using these principles with </span><strong class="bold"><span class="koboSpan" id="kobo.11.1">Test-Driven Development</span></strong><span class="koboSpan" id="kobo.12.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.13.1">TDD</span></strong><span class="koboSpan" id="kobo.14.1">) made my programming life even easier! </span><span class="koboSpan" id="kobo.14.2">There are more principles and architectural design patterns out there to help make your application more maintainable, but in this chapter, we will be focusing on the SOLID principles one by one while </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">doing TDD.</span></span></p>
<p><span class="koboSpan" id="kobo.16.1">We’ll go through the process of interpreting a Jira ticket into a BDD test, which, in turn, will help us in creating our integration tests, down to the development of the solution code. </span><span class="koboSpan" id="kobo.16.2">Then, one by one, we will go through each of the SOLID principles by using TDD as you would do in a </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">real project.</span></span></p>
<p><span class="koboSpan" id="kobo.18.1">In this chapter, we will go through the </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.20.1">Jira to BDD </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">to TDD</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">TDD with the </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">Single-Responsibility Principle</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">TDD with the </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">Open-Closed Principle</span></span></li>
<li><span class="koboSpan" id="kobo.26.1">TDD with the Liskov </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">Substitution Principle</span></span></li>
<li><span class="koboSpan" id="kobo.28.1">TDD with the Interface </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">Segregation Principle</span></span></li>
<li><span class="koboSpan" id="kobo.30.1">TDD with the Dependency </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">Inversion Principle</span></span></li>
</ul>
<h1 id="_idParaDest-122"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.32.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.33.1">In this chapter, the reader needs to use the base code from the repository found </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">at </span></span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%208"><span class="No-Break"><span class="koboSpan" id="kobo.35.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%208</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.36.1">.</span></span></p>
<h2 id="_idParaDest-123"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.37.1">Preparing the development environment for the chapter</span></h2>
<p><span class="koboSpan" id="kobo.38.1">First, get the base code for this chapter found at https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%206/base/phptdd or simply run the </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.40.1">
curl -Lo phptdd.zip "https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/raw/main/Chapter%208/base.zip" &amp;&amp; unzip -o phptdd.zip &amp;&amp; cd base &amp;&amp; ./demoSetup.sh</span></pre>
<p><span class="koboSpan" id="kobo.41.1">To run the containers and execute the commands in this chapter, you should be inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">docker-server-web-1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.43.1"> container.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">Run the following command to confirm the container name for our </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">web server:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.46.1">
docker ps</span></pre>
<p><span class="koboSpan" id="kobo.47.1">To run the containers, run the following command from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">/docker</span></strong><span class="koboSpan" id="kobo.49.1"> directory from the repository in your </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">host machine:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.51.1">
docker-compose build &amp;&amp; docker-compose up -d
docker exec -it docker-server-web-1 /bin/bash</span></pre>
<p><span class="koboSpan" id="kobo.52.1">Once inside the container, run the following commands to install the libraries required </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">through </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">composer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.56.1">
/var/www/html/symfony# ./setup.sh
/var/www/html/behat# ./setup.sh </span></pre>
<h1 id="_idParaDest-124"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.57.1">Jira to BDD to TDD</span></h1>
<p><span class="koboSpan" id="kobo.58.1">The SOLID principles, as </span><a id="_idIndexMarker341"/><span class="koboSpan" id="kobo.59.1">defined by Robert C. </span><span class="koboSpan" id="kobo.59.2">Martin, are a set of coding guidelines or standards that help developers write more organized, decoupled, maintainable, extensible software. </span><span class="koboSpan" id="kobo.59.3">In this chapter, we’ll go through them one by one, but we will try to simulate the process by working on a real project and then implementing each of the principles. </span></p>
<p><span class="koboSpan" id="kobo.60.1">In this chapter, we will be writing solution code that will try to adhere to the SOLID principles, but before that, we need an example problem to solve. </span><span class="koboSpan" id="kobo.60.2">As we did in </span><a href="B18318_07.xhtml#_idTextAnchor108"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.61.1">Chapter 7</span></em></span></a><em class="italic"><span class="koboSpan" id="kobo.62.1">, Building Solution Code with BDD and TDD</span></em><span class="koboSpan" id="kobo.63.1">, we’ll start with a Jira ticket, write some Gherkin features, write Behat tests, write integration and unit tests, and then write the SOLID-adhering solution code as depicted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">following flowchart:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer111">
<span class="koboSpan" id="kobo.65.1"><img alt="Figure 8.1 ﻿– Development flow" src="image/Figure_8.01_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.66.1">Figure 8.1 – Development flow</span></p>
<p><span class="koboSpan" id="kobo.67.1">Let’s use one of the </span><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.68.1">Jira tickets we created in </span><a href="B18318_02.xhtml#_idTextAnchor027"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.69.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.70.1">, </span><em class="italic"><span class="koboSpan" id="kobo.71.1">Understanding and Organizing the Business Requirements for Our Project</span></em><span class="koboSpan" id="kobo.72.1">. </span><span class="koboSpan" id="kobo.72.2">We created a story to let a logged-in user input and save some toy car model data. </span><span class="koboSpan" id="kobo.72.3">This will be a nice simple feature to use to demonstrate the SOLID principles: </span></p>
<div>
<div class="IMG---Figure" id="_idContainer112">
<span class="koboSpan" id="kobo.73.1"><img alt="Figure 8.2 – Ticket for creating toy model data" src="image/Figure_8.02_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.74.1">Figure 8.2 – Ticket for creating toy model data</span></p>
<p><span class="koboSpan" id="kobo.75.1">As we did in </span><a href="B18318_07.xhtml#_idTextAnchor108"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.76.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.77.1">, </span><em class="italic"><span class="koboSpan" id="kobo.78.1">Building Solution Code with BDD and TDD</span></em><span class="koboSpan" id="kobo.79.1">, create a new git branch for your Jira ticket. </span><span class="koboSpan" id="kobo.79.2">Check out the git branch from the repository you set up in </span><a href="B18318_02.xhtml#_idTextAnchor027"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.80.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.81.1">, </span><em class="italic"><span class="koboSpan" id="kobo.82.1">Understanding and Organizing the Business Requirements for Our Project</span></em><span class="koboSpan" id="kobo.83.1">, and let’s start writing some tests </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">and programs!</span></span></p>
<p><span class="koboSpan" id="kobo.85.1">Before we start learning about</span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.86.1"> the SOLID principles, first, we need to work on the BDD tests</span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.87.1"> that will drive us to write the solution code while trying to follow the SOLID principles. </span><span class="koboSpan" id="kobo.87.2">Remember, we always need to start with failing tests. </span><span class="koboSpan" id="kobo.87.3">Next, to start with BDD, we need to write a Gherkin </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">feature first.</span></span></p>
<h2 id="_idParaDest-125"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.89.1">Gherkin feature</span></h2>
<p><span class="koboSpan" id="kobo.90.1">Let’s start </span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.91.1">by writing a Gherkin feature to describe what behavior we expect to build. </span><span class="koboSpan" id="kobo.91.2">Create the following feature file with the following content inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">behat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.93.1"> directory:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.94.1">codebase/behat/features/create_toy_car_record.feature</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.95.1">
Feature: Clerk creates new toy car record
  In order to have a collection of toy car model records
  As an Inventory Clerk
  I need to be able to create a single record
  Scenario: Create new record
    Given I am in the inventory system page
    When I submit the form with correct details
    Then I should see a success message</span></pre>
<p><span class="koboSpan" id="kobo.96.1">Now that we have our feature, let’s generate the Behat PHP context class for it. </span></p>
<h2 id="_idParaDest-126"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.97.1">Behat context</span></h2>
<p><span class="koboSpan" id="kobo.98.1">We will now </span><a id="_idIndexMarker346"/><span class="koboSpan" id="kobo.99.1">take the Gherkin feature and make a PHP context class for it. </span><span class="koboSpan" id="kobo.99.2">Follow </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.101.1">First, update the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">behat.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.103.1"> file:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.104.1">codebase/behat/behat.yml</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.105.1">
default:
  suites:
    default:
      contexts:
        - FeatureContext
        - HomeContext
    suite_a:
      contexts:
        - InventoryClerkRegistrationContext
    suite_create:
      contexts:
        - CreateToyCarRecordContext</span></pre>
<ol>
<li value="2"><span class="koboSpan" id="kobo.106.1">After </span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.107.1">updating the main </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">behat.yml</span></strong><span class="koboSpan" id="kobo.109.1"> file, run the following commands to create the PHP </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">context class:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.111.1">/var/www/html/behat# ./vendor/bin/behat --init</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.112.1">/var/www/html/behat# ./vendor/bin/behat features/</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.113.1">    create_toy_car_record.feature --append-snippets –</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.114.1">        suite=suite_create</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.115.1">There should now be a new class created in </span><strong class="source-inline"><span class="koboSpan" id="kobo.116.1">features/bootstrap/CreateToyCarRecordContext.php</span></strong><span class="koboSpan" id="kobo.117.1">. </span><span class="koboSpan" id="kobo.117.2">Refactor the </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">iAmInTheInventorySystemPage</span></strong><span class="koboSpan" id="kobo.119.1"> method so that it throws </span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">\Exception</span></strong><span class="koboSpan" id="kobo.121.1">. </span></li>
<li><span class="koboSpan" id="kobo.122.1">Next, let’s make sure we can execute this feature test by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.124.1">/var/www/html/behat# ./vendor/bin/behat features/</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.125.1">create_toy_car_record.feature --suite=suite_create</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.126.1">You should then see the following </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">test result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer113">
<span class="koboSpan" id="kobo.128.1"><img alt="Figure 8.3 – Failed test" src="image/Figure_8.03_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.129.1">Figure 8.3 – Failed test</span></p>
<p><span class="koboSpan" id="kobo.130.1">Good – now, we know</span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.131.1"> that the Behat test for this feature can be executed and fails as expected, so let’s move on to the </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">Symfony application.</span></span></p>
<h2 id="_idParaDest-127"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.133.1">Functional test</span></h2>
<p><span class="koboSpan" id="kobo.134.1">The</span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.135.1"> Behat test we created is already a functional test – do we still have to create a functional test inside the Symfony directory? </span><span class="koboSpan" id="kobo.135.2">I think this is optional, but it will help us to quickly run basic smoke tests – for example, if we want to quickly check whether our controller loads and doesn’t encounter a fatal error. </span><span class="koboSpan" id="kobo.135.3">We don’t need to run the bigger and slower Behat test to find that out: </span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.136.1">Create the following test class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.138.1">codebase/symfony/tests/Functional/Controller/InventoryAdminControllerTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.139.1">
&lt;?php
namespace App\Tests\Functional\Controller;
use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;
class InventoryControllerTest extends WebTestCase
{
    public function testCanLoadIndex(): void
    {
        $client     = static::createClient();
        $client-&gt;request(‘GET’, ‘/inventory-admin’);
        $this-&gt;assertResponseIsSuccessful();
    }
}</span></pre>
<ol>
<li value="2"><span class="koboSpan" id="kobo.140.1">After </span><a id="_idIndexMarker350"/><span class="koboSpan" id="kobo.141.1">creating our controller test class, let’s run the following command to make sure that PHPUnit can execute this test and that </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">it fails:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.143.1">/var/www/html/symfony# ./vendor/bin/phpunit --filter </span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.144.1">    InventoryAdminControllerTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.145.1">After running the test, make sure that you get a test failure. </span><span class="koboSpan" id="kobo.145.2">Remember the </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">red phase?</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">Great – we can forget about creating the controller for now. </span><span class="koboSpan" id="kobo.147.2">Let’s move on to the integration tests. </span><span class="koboSpan" id="kobo.147.3">These tests will be used to develop the mechanism to persist the toy car model in </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">the database.</span></span></p>
<h2 id="_idParaDest-128"><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.149.1">Integration test</span></h2>
<p><span class="koboSpan" id="kobo.150.1">We will now need to </span><a id="_idIndexMarker351"/><span class="koboSpan" id="kobo.151.1">start writing integration tests that will help us write the code to persist or create a new toy car model. </span><span class="koboSpan" id="kobo.151.2">After passing these tests, then we can go back to the Behat tests we created earlier and make sure </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">they pass:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.153.1">Create the following test class, with the </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.155.1">codebase/symfony/tests/Integration/Processor/ToyCarProcessorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.156.1">
&lt;?php
namespace App\Tests\Integration\Repository;
use Symfony\Bundle\FrameworkBundle\Test\
    KernelTestCase;
class ToyCarProcessorTest extends KernelTestCase
{
    public function testCanCreate()
    {
        $this-&gt;fail(“--- RED ---”);
    }
}</span></pre>
<ol>
<li value="2"><span class="koboSpan" id="kobo.157.1">After creating </span><a id="_idIndexMarker352"/><span class="koboSpan" id="kobo.158.1">the test class, make sure that PHPUnit can recognize the new test class by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.160.1">/var/www/html/symfony# ./vendor/bin/phpunit --filter ToyCarRepositoryTest</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.161.1">After running the command, you should see the familiar and soothing PHPUnit </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">failure result:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer114">
<span class="koboSpan" id="kobo.163.1"><img alt="Figure 8.4 – Failing processor test" src="image/Figure_8.04_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1">Figure 8.4 – Failing processor test</span></p>
<p><span class="koboSpan" id="kobo.165.1">Now that </span><a id="_idIndexMarker353"/><span class="koboSpan" id="kobo.166.1">we have a failing integration test, let’s build the code to pass it. </span><span class="koboSpan" id="kobo.166.2">We want to be able to persist a new toy car model into the persistence layer which is our database. </span><span class="koboSpan" id="kobo.166.3">Do we even have a DB table for it? </span><span class="koboSpan" id="kobo.166.4">Nope, not yet. </span><span class="koboSpan" id="kobo.166.5">But we don’t care. </span><span class="koboSpan" id="kobo.166.6">We can continue working on the solution code. </span><span class="koboSpan" id="kobo.166.7">Next, we will be trying to follow</span><a id="_idIndexMarker354"/><span class="koboSpan" id="kobo.167.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.168.1">Single-Responsibility Principle</span></strong><span class="koboSpan" id="kobo.169.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.170.1">SRP</span></strong><span class="koboSpan" id="kobo.171.1">) to write our </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">solution code.</span></span></p>
<h1 id="_idParaDest-129"><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.173.1">TDD with the Single-Responsibility Principle</span></h1>
<p><span class="koboSpan" id="kobo.174.1">Let’s </span><a id="_idIndexMarker355"/><span class="koboSpan" id="kobo.175.1">start with what I think is one of the most important principles in the SOLID principles. </span><span class="koboSpan" id="kobo.175.2">Are you familiar </span><a id="_idIndexMarker356"/><span class="koboSpan" id="kobo.176.1">with god classes or objects – where</span><a id="_idIndexMarker357"/><span class="koboSpan" id="kobo.177.1"> one class can do almost everything? </span><span class="koboSpan" id="kobo.177.2">A single class for login, registration, displaying registered users, and so on? </span><span class="koboSpan" id="kobo.177.3">If there are two developers working on the same god class, can you already imagine how challenging that can be? </span><span class="koboSpan" id="kobo.177.4">And what happens after you deploy it to production and then an issue is found in the part where you display a list of registered users? </span><span class="koboSpan" id="kobo.177.5">You will have to change or fix that god class, but now the same class for login and registration has been modified and these processes may be compromised too. </span><span class="koboSpan" id="kobo.177.6">You run a bigger risk of introducing regressions to your login and registration functionalities by just trying to fix the list of registered users. </span><span class="koboSpan" id="kobo.177.7">You fix one feature, and there’s a greater risk of breaking </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">other features.</span></span></p>
<p><span class="koboSpan" id="kobo.179.1">This is </span><a id="_idIndexMarker358"/><span class="koboSpan" id="kobo.180.1">where the SRP </span><a id="_idIndexMarker359"/><span class="koboSpan" id="kobo.181.1">will start to make sense. </span><span class="koboSpan" id="kobo.181.2">The SRP mandates that a class should only have one main responsibility, and one reason to be changed. </span><span class="koboSpan" id="kobo.181.3">Is it that simple? </span><span class="koboSpan" id="kobo.181.4">Sometimes not. </span><span class="koboSpan" id="kobo.181.5">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">Login</span></strong><span class="koboSpan" id="kobo.183.1"> class should only know about letting a user log in, and not have the program responsible for displaying a list of registered users or checking out a shopping cart, but sometimes where to draw the line can become </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">very subjective.</span></span></p>
<p><span class="koboSpan" id="kobo.185.1">Next, we’ll start writing the actual solution code while trying to implement </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">the SRP.</span></span></p>
<h2 id="_idParaDest-130"><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.187.1">Writing the solution code</span></h2>
<p><span class="koboSpan" id="kobo.188.1">We </span><a id="_idIndexMarker360"/><span class="koboSpan" id="kobo.189.1">have a failing test that tests whether our application can create a toy car model and persist it in the database, but we don’t even have a database table for it yet. </span><span class="koboSpan" id="kobo.189.2">It’s okay – we will only focus on the PHP side of things </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">for now.</span></span></p>
<h3><span class="koboSpan" id="kobo.191.1">Model class</span></h3>
<p><span class="koboSpan" id="kobo.192.1">It’s better </span><a id="_idIndexMarker361"/><span class="koboSpan" id="kobo.193.1">for our processor PHP class to deal with objects and not to directly know about database table rows and so on. </span><span class="koboSpan" id="kobo.193.2">Let’s create a </span><strong class="bold"><span class="koboSpan" id="kobo.194.1">Plain Old PHP Object</span></strong><span class="koboSpan" id="kobo.195.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.196.1">POPO</span></strong><span class="koboSpan" id="kobo.197.1">) that </span><a id="_idIndexMarker362"/><span class="koboSpan" id="kobo.198.1">will represent what a toy car model is, without caring about the </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">database structure:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.200.1">Create the following file with the </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.202.1">codebase/symfony/src/Model/ToyCar.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.203.1">
&lt;?php
namespace App\Model;
class ToyCar
{
    /**
     * @var int
     */
    private $id;
    /**
     * @var string
     */
    private $name;
    /**
     * @var CarManufacturer
     */
    private $manufacturer;
    /**
     * @var ToyColor
     */
    private $colour;
    /**
     * @var int
     */
    private $year; 
}</span></pre>
<p><span class="koboSpan" id="kobo.204.1">After declaring the properties, it’s best to generate the accessors and mutators for all of these properties, rather than accessing </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">them directly.</span></span></p>
<p><span class="koboSpan" id="kobo.206.1">As you </span><a id="_idIndexMarker363"/><span class="koboSpan" id="kobo.207.1">can see, this is just a POPO class. </span><span class="koboSpan" id="kobo.207.2">Nothing fancy. </span><span class="koboSpan" id="kobo.207.3">No information whatsoever about how to persist it in our database. </span><span class="koboSpan" id="kobo.207.4">Its responsibility is just to be a model that represents what a toy </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">car is.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.209.1">Let’s also create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">CarManufacturer</span></strong><span class="koboSpan" id="kobo.211.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">ToyColor</span></strong><span class="koboSpan" id="kobo.213.1"> models. </span><span class="koboSpan" id="kobo.213.2">Create the following classes with the </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.215.1">codebase/symfony/src/Model/ToyColor.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.216.1">
&lt;?php
namespace App\Model;
class ToyColor
{
    /**
     * @var int
     */
    private $id;
    /**
     * @var string
     */
    private $name; 
}</span></pre>
<p><span class="koboSpan" id="kobo.217.1">After declaring the properties, generate the accessors and mutators for </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">the class.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.219.1">See the</span><a id="_idIndexMarker364"/><span class="koboSpan" id="kobo.220.1"> following for the </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">car manufacturer:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.222.1">codebase/symfony/src/Model/CarManufacturer.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.223.1">
&lt;?php
namespace App\Model;
class CarManufacturer
{
    /**
     * @var int
     */
    private $id;
    /**
     * @var string
     */
    private $name; 
}</span></pre>
<p><span class="koboSpan" id="kobo.224.1">Now, generate the accessors and mutators for this class </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.226.1">Now, we have the main </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">ToyCar</span></strong><span class="koboSpan" id="kobo.228.1"> model, which is also using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">ToyColor</span></strong><span class="koboSpan" id="kobo.230.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">CarManufacturer</span></strong><span class="koboSpan" id="kobo.232.1"> models. </span><span class="koboSpan" id="kobo.232.2">As you can see, as with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">ToyCar</span></strong><span class="koboSpan" id="kobo.234.1"> model, these two classes are not responsible for persisting or reading </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">data either.</span></span></p>
<p><span class="koboSpan" id="kobo.236.1">As you remember, we are using the Doctrine ORM as a tool to interact with our database. </span><span class="koboSpan" id="kobo.236.2">We can also use Doctrine entities directly in our processor class if we want to, but that </span><a id="_idIndexMarker365"/><span class="koboSpan" id="kobo.237.1">would mean that our processor class would now be using a class that has a dependency on Doctrine. </span><span class="koboSpan" id="kobo.237.2">What if we need to use a different ORM? </span><span class="koboSpan" id="kobo.237.3">To keep things a little bit less coupled, we will just use </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">codebase/symfony/src/Model/ToyCar.php</span></strong><span class="koboSpan" id="kobo.239.1"> in the processor class we will be </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">creating next.</span></span></p>
<h3><span class="koboSpan" id="kobo.241.1">Processor class</span></h3>
<p><span class="koboSpan" id="kobo.242.1">For us to</span><a id="_idIndexMarker366"/><span class="koboSpan" id="kobo.243.1"> create and</span><a id="_idIndexMarker367"/><span class="koboSpan" id="kobo.244.1"> persist a toy car model, we will need a class that will need to process it for us. </span><span class="koboSpan" id="kobo.244.2">The thing is, we still don’t have a database at this stage – where do we persist the toy car model? </span><span class="koboSpan" id="kobo.244.3">For now, nowhere, but we can still pass </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">the test:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.246.1">Create the following interface with the </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.248.1">codebase/symfony/src/DAL/Writer/WriterInterface.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.249.1">
&lt;?php
namespace App\DAL\Writer;
interface WriterInterface
{
    /**
     * @param $model
     * @return bool
     */
    public function write($model): bool;
}</span></pre>
<p><span class="koboSpan" id="kobo.250.1">We created a very simple interface that our data-writer objects can implement. </span><span class="koboSpan" id="kobo.250.2">We’ll then use this interface for our </span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">processor class.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.252.1">Now, let’s </span><a id="_idIndexMarker368"/><span class="koboSpan" id="kobo.253.1">create</span><a id="_idIndexMarker369"/><span class="koboSpan" id="kobo.254.1"> the toy car workflow or processor class. </span><span class="koboSpan" id="kobo.254.2">Create the following class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">codebase/symfony/src/Processor/ToyCarProcessor.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.257.1">
&lt;?php
namespace App\Processor;
use App\DAL\Writer\WriterInterface;
use App\Model\ToyCar;
use App\Validator\ToyCarValidationException;
class ToyCarProcessor
{
    /**
     * @var WriterInterface
     */
    private $dataWriter;
    /**
     * @param ToyCar $toyCar
     * @return bool
     * @throws ToyCarValidationException
     */
    public function create(ToyCar $toyCar)
    {
        // Do some validation here
        $this-&gt;validate($toyCar);
        // Write the data
        $result = $this-&gt;getDataWriter()-&gt;
            write($toyCar);
        // Do other stuff.
        </span><span class="koboSpan" id="kobo.257.2">return $result;
    }
    /**
     * @param ToyCar $toyCar
     * @throws ToyCarValidationException
     */
    public function validate(ToyCar $toyCar)
    {
        if (is_null($toyCar-&gt;getName())) {
            throw new ToyCarValidationException
                (‘Invalid Toy Car Data’);
        }
    }
    /**
     * @return WriterInterface
     */
    public function getDataWriter(): WriterInterface
    {
        return $this-&gt;dataWriter;
    }
    /**
     * @param WriterInterface $dataWriter
     */
    public function setDataWriter(WriterInterface 
        $dataWriter): void
    {
        $this-&gt;dataWriter = $dataWriter;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.258.1">We have</span><a id="_idIndexMarker370"/><span class="koboSpan" id="kobo.259.1"> created a processor class that has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">create</span></strong><span class="koboSpan" id="kobo.261.1"> method that accepts the toy car model we created previously, and </span><a id="_idIndexMarker371"/><span class="koboSpan" id="kobo.262.1">then tries to write the model using an instance of a writer class that doesn’t exist. </span><span class="koboSpan" id="kobo.262.2">What if another developer in your company is working on the data-writer class and it will take him 2 weeks to complete it? </span><span class="koboSpan" id="kobo.262.3">Do you wait for 2 weeks to pass your integration test? </span></p>
<p><span class="koboSpan" id="kobo.263.1">If your processor class must validate the data and do other things after the data has been written into the database, should those programs be delayed too just because you are waiting for the other developer to complete their work? </span><span class="koboSpan" id="kobo.263.2">Probably not! </span><span class="koboSpan" id="kobo.263.3">We can use test doubles to replace the missing dependencies </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">for now.</span></span></p>
<h4><span class="koboSpan" id="kobo.265.1">Test doubles</span></h4>
<p><span class="koboSpan" id="kobo.266.1">Most of the time, it’s just difficult or impractical to be able to run a test against a feature with all its </span><a id="_idIndexMarker372"/><span class="koboSpan" id="kobo.267.1">dependencies already built. </span><span class="koboSpan" id="kobo.267.2">Sometimes, we need to have a solution to be able to test the specific feature we want, even if we have not built the other dependencies yet, or simply want to isolate or only focus our test on a certain feature. </span><span class="koboSpan" id="kobo.267.3">Here, we can use test doubles. </span><span class="koboSpan" id="kobo.267.4">You can read more about test doubles for PHPUnit </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">at </span></span><a href="https://phpunit.readthedocs.io/en/9.5/test-doubles.html"><span class="No-Break"><span class="koboSpan" id="kobo.269.1">https://phpunit.readthedocs.io/en/9.5/test-doubles.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.270.1">.</span></span></p>
<h4><span class="koboSpan" id="kobo.271.1">Mock and Stub</span></h4>
<p><span class="koboSpan" id="kobo.272.1">The processor class we just created needs a concrete instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">ToyValidatorInterface</span></strong><span class="koboSpan" id="kobo.274.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">WriterInterface</span></strong><span class="koboSpan" id="kobo.276.1">. </span><span class="koboSpan" id="kobo.276.2">Since we have not created those classes yet, we can still proceed in passing the test just by using a </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">Mock</span></strong><span class="koboSpan" id="kobo.278.1"> object. </span><span class="koboSpan" id="kobo.278.2">In PHPUnit, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">Mock</span></strong><span class="koboSpan" id="kobo.280.1"> object is an</span><a id="_idIndexMarker373"/><span class="koboSpan" id="kobo.281.1"> interface that extends the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">Stub</span></strong><span class="koboSpan" id="kobo.283.1"> interface. </span><span class="koboSpan" id="kobo.283.2">This means that in the code, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">Mock</span></strong><span class="koboSpan" id="kobo.285.1"> object is an implementation of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">Stub</span></strong><span class="koboSpan" id="kobo.287.1"> interface. </span><span class="koboSpan" id="kobo.287.2">The process of replacing the instances of </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">ToyValidatorInterface</span></strong><span class="koboSpan" id="kobo.289.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">WriterInterface</span></strong><span class="koboSpan" id="kobo.291.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">Mock</span></strong><span class="koboSpan" id="kobo.293.1"> object and setting a </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">return</span></strong><span class="koboSpan" id="kobo.295.1"> value when a specific method is executed is called stubbing. </span><span class="koboSpan" id="kobo.295.2">Let’s try it </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">for real:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.297.1">Go back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">ToyCarProcessorTest</span></strong><span class="koboSpan" id="kobo.299.1"> class and refactor it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.301.1">codebase/symfony/tests/Integration/Processor/ToyCarProcessorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.302.1">
&lt;?php
namespace App\Tests\Integration\Repository;
use App\DAL\Writer\WriterInterface;
use App\Model\CarManufacturer;
use App\Model\ToyCar;
use App\Model\ToyColor;
use App\Processor\ToyCarProcessor;
use Symfony\Bundle\FrameworkBundle\Test\
    KernelTestCase;
class ToyCarProcessorTest extends KernelTestCase
{
    /**
     * @param ToyCar $toyCarModel
     * @throws \App\Validator
         \ToyCarValidationException
     * @dataProvider provideToyCarModel
     */
    public function testCanCreate
       (ToyCar $toyCarModel): void
    {
        // Mock: Data writer
        $toyWriterStub = $this-&gt;createMock
            (WriterInterface::class);
        $toyWriterStub
            -&gt;method(‘write’)
            -&gt;willReturn(true);
        // Processor Class
        $processor = new ToyCarProcessor();
        $processor-&gt;setDataWriter($toyWriterStub);
        // Execute
        $result = $processor-&gt;create($toyCarModel);
        $this-&gt;assertTrue($result);
    }
    public function provideToyCarModel(): array
    {
        // Toy Car Color
        $toyColor = new ToyColor();
        $toyColor-&gt;setName(‘Black’);
        // Car Manufacturer
        $carManufacturer = new CarManufacturer();
        $carManufacturer-&gt;setName(‘Ford’);
        // Toy Car
        $toyCarModel = new ToyCar();
        $toyCarModel-&gt;setName(‘Mustang’);
        $toyCarModel-&gt;setColour($toyColor);
        $toyCarModel-&gt;setManufacturer
            ($carManufacturer);
        $toyCarModel-&gt;setYear(1968);
        return [
            [$toyCarModel],
        ];
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.303.1">In</span><a id="_idIndexMarker374"/><span class="koboSpan" id="kobo.304.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">testCanCreate</span></strong><span class="koboSpan" id="kobo.306.1"> function here, we are creating mock objects for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">ValidationModel</span></strong><span class="koboSpan" id="kobo.308.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.310.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">ToyCarWriter</span></strong><span class="koboSpan" id="kobo.312.1"> classes. </span><span class="koboSpan" id="kobo.312.2">We then instantiate the main </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">ToyCarCreator</span></strong><span class="koboSpan" id="kobo.314.1"> class while passing the mock </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.316.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">ToyCarWriter</span></strong><span class="koboSpan" id="kobo.318.1"> classes into its constructor. </span><span class="koboSpan" id="kobo.318.2">This is called dependency injection, which will be discussed further later in the chapter. </span><span class="koboSpan" id="kobo.318.3">Lastly, we then run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">ToyCarCreator</span></strong><span class="koboSpan" id="kobo.320.1">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">create</span></strong><span class="koboSpan" id="kobo.322.1"> method to simulate a developer trying to create a new toy </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">car record:</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.324.1">Let’s run the test by entering the following command and see what result </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">we get:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.326.1">/var/www/html/symfony# ./vendor/bin/phpunit --filter ToyCarProcessorTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.327.1">You should then see the </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer115">
<span class="koboSpan" id="kobo.329.1"><img alt="Figure 8.5 – Passed the test using a stub" src="image/Figure_8.05_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.330.1">Figure 8.5 – Passed the test using a stub</span></p>
<p><span class="koboSpan" id="kobo.331.1">We passed the test, even though we have not really persisted anything in the database yet. </span><span class="koboSpan" id="kobo.331.2">It’s very common in bigger and more complex projects that you’ll have to rely on test doubles just to isolate and focus on your test even if other dependencies are either not built yet or are too cumbersome to include as a part of </span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">your test.</span></span></p>
<p><span class="koboSpan" id="kobo.333.1">Now </span><a id="_idIndexMarker375"/><span class="koboSpan" id="kobo.334.1">going back to the SRP, our </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">ToyCarProcessor</span></strong><span class="koboSpan" id="kobo.336.1"> now has two responsibilities – to validate and create a toy car model. </span><span class="koboSpan" id="kobo.336.2">Equally, other developers are using your class’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">validate</span></strong><span class="koboSpan" id="kobo.338.1"> method. </span><span class="koboSpan" id="kobo.338.2">Let’s refactor our code to redefine the focus and responsibility of our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">ToyCarProcessor</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.340.1"> class:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.341.1">Rename the </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">following classes:</span></span><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">ToyCarProcessor.php</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.344.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">ToyCarCreator.php</span></strong></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">ToyCarProcessorTest.php</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.347.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">ToyCarCreatorTest.php</span></strong></span></li></ul></li>
<li><span class="koboSpan" id="kobo.349.1">Next, let’s refactor the </span><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">ToyCarCreatorTest.php</span></strong><span class="koboSpan" id="kobo.351.1"> class. </span><span class="koboSpan" id="kobo.351.2">Open the following class and replace the content with </span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">the following:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.353.1">codebase/symfony/tests/Integration/Processor/ToyCarCreatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.354.1">
&lt;?php
namespace App\Tests\Integration\Repository;
use App\DAL\Writer\WriterInterface;
use App\Model\CarManufacturer;
use App\Model\ToyCar;
use App\Model\ToyColor;
use App\Processor\ToyCarCreator;
use App\Validator\ValidatorInterface;
use Symfony\Bundle\FrameworkBundle\Test\KernelTestCase;
class ToyCarCreatorTest extends KernelTestCase
{
    /**
     * @param ToyCar $toyCarModel
     * @throws \App\Validator
         \ToyCarValidationException
     * @dataProvider provideToyCarModel
     */
    public function testCanCreate
        (ToyCar $toyCarModel): void
    {
        // Mock 1: Validator
        $validatorStub = $this-&gt;createMock
            (ValidatorInterface::class);
        $validatorStub
            -&gt;method(‘validate’)
            -&gt;willReturn(true);
        // Mock 2: Data writer
        $toyWriterStub = $this-&gt;createMock
            (WriterInterface::class);
        $toyWriterStub
            -&gt;method(‘write’)
            -&gt;willReturn(true);
        // Processor Class
        $processor = new ToyCarCreator();
        $processor-&gt;setValidator($validatorStub);
        $processor-&gt;setDataWriter($toyWriterStub);
        // Execute
        $result = $processor-&gt;create($toyCarModel);
        $this-&gt;assertTrue($result);
    }
    public function provideToyCarModel(): array
    {
        // Toy Car Color
        $toyColor = new ToyColor();
        $toyColor-&gt;setName(‘Black’);
        // Car Manufacturer
        $carManufacturer = new CarManufacturer();
        $carManufacturer-&gt;setName(‘Ford’);
        // Toy Car
        $toyCarModel = new ToyCar();
        $toyCarModel-&gt;setName(‘Mustang’);
        $toyCarModel-&gt;setColour($toyColor);
        $toyCarModel-&gt;setManufacturer
            ($carManufacturer);
        $toyCarModel-&gt;setYear(1968);
        return [
            [$toyCarModel],
        ];
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.355.1">As you</span><a id="_idIndexMarker376"/><span class="koboSpan" id="kobo.356.1"> can see, we added a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">Mock</span></strong><span class="koboSpan" id="kobo.358.1"> object for the validation. </span><span class="koboSpan" id="kobo.358.2">I will explain why we must do that after we refactor the content of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">ToyCarCreator.php</span></strong><span class="koboSpan" id="kobo.360.1"> class. </span><span class="koboSpan" id="kobo.360.2">Let’s create a validator interface, and then refactor the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">ToyCarCreator</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.362.1"> class.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.363.1">Create the following file with the </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.365.1">codebase/symfony/src/Validator/ValidatorInterface.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.366.1">
&lt;?php
namespace App\Validator;
interface ValidatorInterface
{
    /**
     * @param $input
     * @return bool
     * @throws ToyCarValidationException
     */
    public function validate($input): bool;
}</span></pre>
<ol>
<li value="4"><span class="koboSpan" id="kobo.367.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">codebase/symfony/src/Processor/ToyCarCreator.php</span></strong><span class="koboSpan" id="kobo.369.1"> and use </span><a id="_idIndexMarker377"/><span class="koboSpan" id="kobo.370.1">the </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">following content:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.372.1">
&lt;?php</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.373.1">
namespace App\Processor;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.374.1">
use App\DAL\Writer\WriterInterface;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.375.1">
use App\Model\ToyCar;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.376.1">
use App\Validator\ToyCarValidationException;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.377.1">
use App\Validator\ValidatorInterface;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.378.1">
class ToyCarCreator</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.379.1">
{</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.380.1">
    /**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.381.1">
     * @var ValidatorInterface</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.382.1">
     */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.383.1">
    private $validator;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.384.1">
    /**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.385.1">
     * @var WriterInterface</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.386.1">
     */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.387.1">
    private $dataWriter;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.388.1">
    /**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.389.1">
     * @param ToyCar $toyCar</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.390.1">
     * @return bool</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.391.1">
     * @throws ToyCarValidationException</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.392.1">
     */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.393.1">
    public function create(ToyCar $toyCar): bool</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.394.1">
    {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.395.1">
        // Do some validation here and so on...</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.396.1">
        $this-&gt;getValidator()-&gt;validate($toyCar);</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.397.1">
        // Write the data</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.398.1">
        $result = $this-&gt;getDataWriter()-&gt;write</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.399.1">
            ($toyCar);</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.400.1">
        // Do other stuff.</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.401.1">
        return $result;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.402.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.403.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.404.1">Next, add</span><a id="_idIndexMarker378"/><span class="koboSpan" id="kobo.405.1"> the necessary accessors and mutators for the private properties we have declared in </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">the class.</span></span></p>
<p><span class="koboSpan" id="kobo.407.1">We renamed the class just to give it a more specific name. </span><span class="koboSpan" id="kobo.407.2">Sometimes, just naming the class to something else helps you clean up your code. </span><span class="koboSpan" id="kobo.407.3">Also, you will notice that we have removed the publicly visible </span><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">validate</span></strong><span class="koboSpan" id="kobo.409.1"> class. </span><span class="koboSpan" id="kobo.409.2">This class will no longer contain any validation logic – it only knows that it will run a validation routine before it tries to persist the data. </span><span class="koboSpan" id="kobo.409.3">This is the class’s </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">main responsibility.</span></span></p>
<p><span class="koboSpan" id="kobo.411.1">We still </span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.412.1">have not written any validation and data persistence code, but let’s see whether we can still pass the test to test the main responsibility of the class, which is to do </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">the following:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.414.1">Accept a </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">ToyCar</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.416.1">model object.</span></span></li>
<li><span class="koboSpan" id="kobo.417.1">Run a </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">validation routine.</span></span></li>
<li><span class="koboSpan" id="kobo.419.1">Attempt to persist </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">the data.</span></span></li>
<li><span class="koboSpan" id="kobo.421.1">Return </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">the result.</span></span></li>
</ol>
<ol>
<li value="5"><span class="koboSpan" id="kobo.423.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.425.1">/var/www/html/symfony# ./vendor/bin/phpunit --filter ToyCarCreatorTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.426.1">Now, you should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer116">
<span class="koboSpan" id="kobo.428.1"><img alt="Figure 8.6 – Passing the test using two stubs" src="image/Figure_8.06_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.429.1">Figure 8.6 – Passing the test using two stubs</span></p>
<p><span class="koboSpan" id="kobo.430.1">In this section, we used BDD and TDD to direct us into writing the solution code. </span><span class="koboSpan" id="kobo.430.2">We have created POPOs with a single responsibility. </span><span class="koboSpan" id="kobo.430.3">We have also created a </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">ToyCarCreator</span></strong><span class="koboSpan" id="kobo.432.1"> class that does not contain the validation logic, nor the persistence mechanism. </span><span class="koboSpan" id="kobo.432.2">It knows it needs to do some validation and some persistence, but it does not have the</span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.433.1"> concrete implementation of those programs. </span><span class="koboSpan" id="kobo.433.2">Each class will have its own specialization or a specific job, or a specific </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">single responsibility.</span></span></p>
<p><span class="koboSpan" id="kobo.435.1">Great – now, we can pass the test again even after refactoring. </span><span class="koboSpan" id="kobo.435.2">Next, let’s continue writing the solution code by </span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.436.1">following the O in the SOLID principle, which is the </span><strong class="bold"><span class="koboSpan" id="kobo.437.1">Open-Closed </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.438.1">Principle</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.439.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.440.1">OCP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">).</span></span></p>
<h1 id="_idParaDest-131"><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.442.1">TDD with the Open-Closed Principle</span></h1>
<p><span class="koboSpan" id="kobo.443.1">The </span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.444.1">OCP was first defined by </span><em class="italic"><span class="koboSpan" id="kobo.445.1">Bertrand Meyer</span></em><span class="koboSpan" id="kobo.446.1">, but in this chapter, we will follow the later version defined by </span><em class="italic"><span class="koboSpan" id="kobo.447.1">Robert C. </span><span class="koboSpan" id="kobo.447.2">Martin</span></em><span class="koboSpan" id="kobo.448.1">, which is also called the polymorphic OCP. </span></p>
<p><span class="koboSpan" id="kobo.449.1">The OCP </span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.450.1">states that objects should be open to extension</span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.451.1"> and closed to modification. </span><span class="koboSpan" id="kobo.451.2">The aim is that we should be able to modify the behaviour or a feature by extending the original code instead of directly refactoring the original code. </span><span class="koboSpan" id="kobo.451.3">That’s great because that will help us developers and testers be more confident about the ticket we’re working on, as we haven’t touched the original code that might be used somewhere else – less risk </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">of regression.</span></span></p>
<p><span class="koboSpan" id="kobo.453.1">In our </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">ToyCarCreateTest</span></strong><span class="koboSpan" id="kobo.455.1"> class, we are stubbing a validator object because we have not written a concrete validator class yet. </span><span class="koboSpan" id="kobo.455.2">There are a lot of different ways of implementing </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.456.1">validation, but for this example, we’ll try to make it very simple. </span><span class="koboSpan" id="kobo.456.2">Let’s go back to the code</span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.457.1"> and create </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">a validator:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.459.1">Create a new test class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.461.1">codebase/symfony/tests/Unit/Validator/ToyCarValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.462.1">
&lt;?php
namespace App\Tests\Unit\Validator;
use App\Model\CarManufacturer;
use App\Model\ToyCar;
use App\Model\ToyColor;
use App\Validator\ToyCarValidator;
use PHPUnit\Framework\TestCase;
class ToyCarValidatorTest extends TestCase
{
    /**
     * @param ToyCar $toyCar
     * @param bool $expected
     * @dataProvider provideToyCarModel
     */
    public function testCanValidate(ToyCar $toyCar, 
        bool $expected): void
    {
        $validator  = new ToyCarValidator();
        $result     = $validator-&gt;validate($toyCar);
        $this-&gt;assertEquals($expected, $result);
    }
    public function provideToyCarModel(): array
    {
        // Toy Car Color
        $toyColor = new ToyColor();
        $toyColor-&gt;setName(‘White’);
        // Car Manufacturer
        $carManufacturer = new CarManufacturer();
        $carManufacturer-&gt;setName(‘Williams’);
        // Toy Car
        $toyCarModel = new ToyCar();
        $toyCarModel-&gt;setName(‘’); // Should fail.
        </span><span class="koboSpan" id="kobo.462.2">$toyCarModel-&gt;setColour($toyColor);
        $toyCarModel-&gt;setManufacturer
            ($carManufacturer);
        $toyCarModel-&gt;setYear(2004);
        return [
            [$toyCarModel, false],
        ];
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.463.1">After creating the test </span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.464.1">class, as usual, we need to run the test to make sure that PHPUnit recognizes </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">your test.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.466.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.468.1">/var/www/html/symfony# ./vendor/bin/phpunit --testsuite=Unit --filter ToyCarValidatorTest </span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.469.1">Make</span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.470.1"> sure that you get an error, as we have not created the validator class yet. </span><span class="koboSpan" id="kobo.470.2">Remember the red phase? </span><span class="koboSpan" id="kobo.470.3">You’ll notice that in the data provider, we have set an empty string for the name. </span><span class="koboSpan" id="kobo.470.4">We will make the validator class return </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1">false</span></strong><span class="koboSpan" id="kobo.472.1"> whenever it sees an empty string for the toy </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">car name.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.474.1">Now, that </span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.475.1">we have the failing test, let’s proceed with creating the class to pass it. </span><span class="koboSpan" id="kobo.475.2">Create a new PHP class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.477.1">codebase/symfony/src/Validator/ToyCarValidator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.478.1">
&lt;?php
namespace App\Validator;
use App\Model\ToyCar;
class ToyCarValidator
{
    public function validate(ToyCar $toyCar): bool
    {
        if (!$toyCar-&gt;getName()) {
            return false;
        }
        return true;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.479.1">We </span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.480.1">have created a very simple validation logic where we only check for the toy car’s name if it’s not an empty string. </span><span class="koboSpan" id="kobo.480.2">Now, let’s run the </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">test again.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.482.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.484.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter ToyCarValidatorTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.485.1">You should now see a </span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">passing test.</span></span></p>
<p><span class="koboSpan" id="kobo.487.1">Okay, so for </span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.488.1">now, we can make sure that the toy car model’s name should always be a string that is not empty – but here’s the thing, what if we want to add more validation logic? </span><span class="koboSpan" id="kobo.488.2">We will have to keep on modifying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.490.1"> class. </span><span class="koboSpan" id="kobo.490.2">That’s not wrong. </span><span class="koboSpan" id="kobo.490.3">It’s just that it’s arguably better to follow the OCP so that we don’t keep modifying our code – less class modification, less risk of breaking things. </span><span class="koboSpan" id="kobo.490.4">Let’s refactor our solution code to pass the test again: </span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.491.1">Let’s add some validation logic for the year and retain the toy car name validation </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">as well.</span></span></li>
<li><span class="koboSpan" id="kobo.493.1">Right now, we are in the green phase, moving to the refactor phase. </span><span class="koboSpan" id="kobo.493.2">We’ll be using polymorphism, which we discussed in </span><a href="B18318_04.xhtml#_idTextAnchor050"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.494.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.495.1">, </span><em class="italic"><span class="koboSpan" id="kobo.496.1">Using Object-Oriented Programming in PHP</span></em><span class="koboSpan" id="kobo.497.1">, instead of inheritance in this solution. </span><span class="koboSpan" id="kobo.497.2">Create the following interface with the </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.499.1">codebase/symfony/src/Validator/ToyCarValidatorInterface.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.500.1">
&lt;?php
namespace App\Validator;
use App\Model\ToyCar;
use App\Model\ValidationModel;
interface ToyCarValidatorInterface
{
    public function validate(ToyCar $toyCar): 
        ValidationModel;
}</span></pre>
<ol>
<li value="3"><span class="koboSpan" id="kobo.501.1">We </span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.502.1">created a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">ToyCarValidatorInterface</span></strong><span class="koboSpan" id="kobo.504.1"> interface that will replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.506.1"> concrete class. </span><span class="koboSpan" id="kobo.506.2">You </span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.507.1">will notice that the validate method returns an object – let’s create that </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1">object too:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.509.1">codebase/symfony/src/Model/ValidationModel.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.510.1">
&lt;?php
namespace App\Model;
class ValidationModel
{
    /**
     * @var bool
     */
    private $valid = false;
    /**
     * @var array
     */
    private $report = [];
}</span></pre>
<p><span class="koboSpan" id="kobo.511.1">After creating the class, generate the accessors and mutators for </span><span class="No-Break"><span class="koboSpan" id="kobo.512.1">the properties.</span></span></p>
<p><span class="koboSpan" id="kobo.513.1">Instead of simply returning </span><strong class="source-inline"><span class="koboSpan" id="kobo.514.1">true</span></strong><span class="koboSpan" id="kobo.515.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">false</span></strong><span class="koboSpan" id="kobo.517.1"> on our validation program, we can now return an array containing the field name and validation result for that field name as well. </span><span class="koboSpan" id="kobo.517.2">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">continue coding.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.519.1">Create </span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.520.1">the following </span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.521.1">test class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.523.1">codebase/symfony/tests/Unit/Validator/ToyCarValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.524.1">
&lt;?php
namespace App\Tests\Unit\Validator;
use PHPUnit\Framework\TestCase;
use App\Validator\YearValidator;
class YearValidatorTest extends TestCase
{
    /**
     * @param $data
     * @param $expected
     * @dataProvider provideYear
     */
    public function testCanValidateYear(int $year, 
        bool $expected): void
    {
        $validator  = new YearValidator();
        $isValid    = $validator-&gt;validate($year);
        $this-&gt;assertEquals($expected, $isValid);
    }
    /**
     * @return array
     */
    public function provideYear(): array
    {
        return [
            [1,     false],
            [2005,  true],
            [1955,  true],
            [312,   false],
        ];
    }
}</span></pre>
<ol>
<li value="5"><span class="koboSpan" id="kobo.525.1">If you </span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.526.1">run this test, you </span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.527.1">will see four failures, as we have four sets of values inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">provideYear</span></strong><span class="koboSpan" id="kobo.529.1"> data provider. </span><span class="koboSpan" id="kobo.529.2">Run the test by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.531.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter YearValidatorTest --debug</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.532.1">If the test fails, that’s good. </span><span class="koboSpan" id="kobo.532.2">Let’s proceed with the </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">solution code:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.534.1">Create the following solution class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.535.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.536.1">codebase/symfony/src/Validator/YearValidator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.537.1">
&lt;?php
namespace App\Validator;
class YearValidator implements ValidatorInterface
{
    /**
     * @param $input
     * @return bool
     */
    public function validate($input): bool
    {
        if (preg_match(“/^(\d{4})$/”, $input, 
            $matches)) {
            return true;
        }
        return false;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.538.1">Now, we </span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.539.1">have a simple </span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.540.1">validation class for checking whether a year is acceptable for our car. </span><span class="koboSpan" id="kobo.540.2">If we want to add more logic here, such as checking for the minimum and maximum acceptable value, we can put all that logic here.  </span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.541.1">Run the following command again and see whether the </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">tests pass:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.543.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter YearValidatorTest --debug</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.544.1">You should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer117">
<span class="koboSpan" id="kobo.546.1"><img alt="Figure 8.7 – Simple date validation test" src="image/Figure_8.07_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.547.1">Figure 8.7 – Simple date validation test</span></p>
<p><span class="koboSpan" id="kobo.548.1">Now that we </span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.549.1">have passed the very</span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.550.1"> simple test for the year validator, next, let’s move on to the </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">name validator:</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.552.1">Create the following test class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.554.1">codebase/symfony/tests/Unit/Validator/NameValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.555.1">
&lt;?php
namespace App\Tests\Unit\Validator;
use App\Validator\NameValidator;
use PHPUnit\Framework\TestCase;
class NameValidatorTest extends TestCase
{
    /**
     * @param $data
     * @param $expected
     * @dataProvider provideNames
     */
    public function testCanValidateName(string $name, 
        bool $expected): void
    {
        $validator  = new NameValidator();
        $isValid    = $validator-&gt;validate($name);
        $this-&gt;assertEquals($expected, $isValid);
    }
    /**
     * @return array
     */
    public function provideNames(): array
    {
        return [
            [‘’,            false],
            [‘$50’,         false],
            [‘Mercedes’,    true],
            [‘RedBull’,     true],
            [‘Williams’,    true],
        ];
    }
}</span></pre>
<ol>
<li value="4"><span class="koboSpan" id="kobo.556.1">As with the</span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.557.1"> year validator, if you run this test now, you will encounter multiple errors, but we have to make sure that it does fail or error out. </span><span class="koboSpan" id="kobo.557.2">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.558.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.559.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter NameValidatorTest</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.560.1">After running</span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.561.1"> the command, you should see five errors. </span><span class="koboSpan" id="kobo.561.2">That’s okay. </span><span class="koboSpan" id="kobo.561.3">Let’s build the solution code for it now. </span><span class="koboSpan" id="kobo.561.4">Create the following class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.563.1">codebase/symfony/src/Validator/NameValidator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.564.1">
&lt;?php
namespace App\Validator;
class NameValidator implements ValidatorInterface
{
    public function validate($input): bool
    {
        if (preg_match(“/^([a-zA-Z’ ]+)$/”, $input)) {
            return true;
        }
        return false;
    }
}</span></pre>
<ol>
<li value="6"><span class="koboSpan" id="kobo.565.1">Now, we have a simple logic to validate a name. </span><span class="koboSpan" id="kobo.565.2">Let’s run the name validator test again, and see whether it passes. </span><span class="koboSpan" id="kobo.565.3">Run the following </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">command again:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.567.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter NameValidatorTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.568.1">You should now see five passing tests. </span></p>
<p><span class="koboSpan" id="kobo.569.1">Let’s </span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.570.1">summarize </span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.571.1">what we have added so far. </span><span class="koboSpan" id="kobo.571.2">We created two new validation classes, and both are working as expected based on our unit tests – but how is this better than the first solution we created? </span><span class="koboSpan" id="kobo.571.3">How is this relevant to the OCP? </span><span class="koboSpan" id="kobo.571.4">Well, first we need to tie things together and pass the bigger </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">ToyCarValidatorTest</span></strong><span class="koboSpan" id="kobo.573.1">. </span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.574.1">Let’s refactor the </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.576.1"> class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.578.1">codebase/symfony/src/Validator/ToyCarValidator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.579.1">
&lt;?php
namespace App\Validator;
use App\Model\ToyCar;
use App\Model\ValidationModel as ValidationResult;
class ToyCarValidator implements 
    ToyCarValidatorInterface
{
    /**
     * @var array
     */
    private $validators = [];
    public function __construct()
    {
        $this-&gt;setValidators([
            ‘year’  =&gt; new YearValidator(),
            ‘name’  =&gt; new NameValidator(),
        ]);
    }
    /**
     * @param ToyCar $toyCar
     * @return ValidationResult
     */
    public function validate(ToyCar $toyCar
        ValidationResult
    {
        $result     = new ValidationResult();
        $allValid   = true;
        foreach ($this-&gt;getValidators() as $key =&gt; 
            $validator) {
            $accessor   = ‘get’ . </span><span class="koboSpan" id="kobo.579.2">ucfirst(strtolower
                ($key));
            $value      = $toyCar-&gt;$accessor();
            $isValid    = false;
            try {
                $isValid = $validator-&gt;validate
                    ($value);
                $results[$key][‘message’]   = ‘’;
            } catch (ToyCarValidationException $ex) {
                $results[$key][‘message’]   = $ex-&gt;
                    getMessage();
            } finally {
                $results[$key][‘is_valid’]  = 
                     $isValid;
            }
            if (!$isValid) {
                $allValid = false;
            }
        }
        $result-&gt;setValid($allValid);
        $result-&gt;setReport($results);
        return $result;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.580.1">Then, generate the accessors and mutators for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">validators</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.583.1"> property.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.584.1">You</span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.585.1"> will notice that</span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.586.1"> in the constructor, we are instantiating two validator classes, and within the validate method, we are using those validator classes. </span><span class="koboSpan" id="kobo.586.2">Each validator class will then have its own custom logic on how to run the validate method. </span><span class="koboSpan" id="kobo.586.3">Now, refactor the following test class with the </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.588.1">codebase/symfony/tests/Unit/Validator/ToyCarValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.589.1">
&lt;?php
namespace App\Tests\Unit\Validator;
use App\Model\CarManufacturer;
use App\Model\ToyCar;
use App\Model\ToyColor;
use App\Validator\ToyCarValidator;
use PHPUnit\Framework\TestCase;
class ToyCarValidatorTest extends TestCase
{
    /**
     * @param ToyCar $toyCar
     * @param array $expected
     * @dataProvider provideToyCarModel
     */
    public function testCanValidate(ToyCar $toyCar, 
        array $expected): void
    {
        $validator  = new ToyCarValidator();
        $result     = $validator-&gt;validate($toyCar);
        $this-&gt;assertEquals($expected[‘is_valid’], 
            $result-&gt;isValid());
        $this-&gt;assertEquals($expected[‘name’], 
            $result-&gt;getReport()[‘name’][‘is_valid’]);
        $this-&gt;assertEquals($expected[‘year’], 
            $result-&gt;getReport()[‘year’][‘is_valid’]);
    }
    public function provideToyCarModel(): array
    {
        // Toy Car Color
        $toyColor = new ToyColor();
        $toyColor-&gt;setName(‘White’);
        // Car Manufacturer
        $carManufacturer = new CarManufacturer();
        $carManufacturer-&gt;setName(‘Williams’);
        // Toy Car
        $toyCarModel = new ToyCar();
        $toyCarModel-&gt;setName(‘’); // Should fail.
        </span><span class="koboSpan" id="kobo.589.2">$toyCarModel-&gt;setColour($toyColor);
        $toyCarModel-&gt;setManufacturer
            ($carManufacturer);
        $toyCarModel-&gt;setYear(2004);
        return [
            [$toyCarModel, [‘is_valid’ =&gt; false, 
                ‘name’ =&gt; false, ‘year’ =&gt; true]],
        ];
    }
}</span></pre>
<ol>
<li value="9"><span class="koboSpan" id="kobo.590.1">Now, in </span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.591.1">this test, we </span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.592.1">are checking for the validity of the entire toy car model object, as well as checking which specific field of the toy car model has passed or failed the validation. </span><span class="koboSpan" id="kobo.592.2">Let’s see whether the test passes. </span><span class="koboSpan" id="kobo.592.3">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.594.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter ToyCarValidatorTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.595.1">Now, you should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer118">
<span class="koboSpan" id="kobo.597.1"><img alt="Figure 8.8 – Passing toy car validation test" src="image/Figure_8.08_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.598.1">Figure 8.8 – Passing toy car validation test</span></p>
<p><span class="koboSpan" id="kobo.599.1">You will </span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.600.1">notice that we passed three assertions. </span><span class="koboSpan" id="kobo.600.2">It looks like we are starting to get a test with more responsibilities. </span><span class="koboSpan" id="kobo.600.3">It’s still better to do one assertion per test, just so that we don’t end up having a god test class! </span><span class="koboSpan" id="kobo.600.4">For now, we’ll </span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">move on.</span></span></p>
<p><span class="koboSpan" id="kobo.602.1">Now, what </span><a id="_idIndexMarker411"/><span class="koboSpan" id="kobo.603.1">have we achieved by refactoring? </span><span class="koboSpan" id="kobo.603.2">Well, first, we no longer have the validation logic for checking the validity of the toy name inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">ToyCarValidatorTest</span></strong><span class="koboSpan" id="kobo.605.1"> class. </span><span class="koboSpan" id="kobo.605.2">Second, we can now check for the validity of the year. </span><span class="koboSpan" id="kobo.605.3">If we want to improve the date and name validation logic, we won’t have to do it in the main </span><strong class="source-inline"><span class="koboSpan" id="kobo.606.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.607.1"> class – but what if we want to add more validator classes? </span><span class="koboSpan" id="kobo.607.2">Such as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.608.1">ToyColorValidator</span></strong><span class="koboSpan" id="kobo.609.1"> class? </span><span class="koboSpan" id="kobo.609.2">Well, we can still do that without even touching the main class! </span><span class="koboSpan" id="kobo.609.3">We’ll refactor </span><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.611.1"> and discuss how to do so later in the chapter in the </span><em class="italic"><span class="koboSpan" id="kobo.612.1">TDD with the Dependency Inversion </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.613.1">Principle</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.614.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.615.1">But what if we want to change the entire behavior of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">ToyCarValidator.php</span></strong><span class="koboSpan" id="kobo.617.1"> class we created and change the logic entirely? </span><span class="koboSpan" id="kobo.617.2">Well, there’s no need to modify it – we can just replace the entire </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">ToyCarValidator.php</span></strong><span class="koboSpan" id="kobo.619.1"> class with a different concrete implementation of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">ToyCarValidatorInterface</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.621.1"> interface!</span></span></p>
<p><span class="koboSpan" id="kobo.622.1">Next, we’ll talk about the </span><strong class="bold"><span class="koboSpan" id="kobo.623.1">Liskov Substitution </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.624.1">Principle</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.625.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.626.1">LSP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">).</span></span></p>
<h1 id="_idParaDest-132"><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.628.1">TDD with the Liskov Substitution Principle</span></h1>
<p><span class="koboSpan" id="kobo.629.1">The </span><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.630.1">LSP was introduced by Barbara Liskov. </span><span class="koboSpan" id="kobo.630.2">The way that I </span><a id="_idIndexMarker413"/><span class="koboSpan" id="kobo.631.1">use it is that an implementation of an interface should be replaceable with another implementation </span><a id="_idIndexMarker414"/><span class="koboSpan" id="kobo.632.1">of that interface</span><a id="_idIndexMarker415"/><span class="koboSpan" id="kobo.633.1"> without changing the behavior. </span><span class="koboSpan" id="kobo.633.2">If you are extending a superclass, the child class must be able to substitute the superclass without breaking </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">the behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.635.1">In this example, let’s try adding a business rule to reject toy car models that were built on or </span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">before 1950.</span></span></p>
<p><span class="koboSpan" id="kobo.637.1">As usual, let’s start with a test: </span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.638.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">YearValidatorTest.php</span></strong><span class="koboSpan" id="kobo.640.1"> class we created earlier and modify the test </span><a id="_idIndexMarker416"/><span class="koboSpan" id="kobo.641.1">class with </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">the</span></span><span class="No-Break"><a id="_idIndexMarker417"/></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1"> following:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.644.1">codebase/symfony/tests/Unit/Validator/YearValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.645.1">
&lt;?php
namespace App\Tests\Unit\Validator;
use App\Validator\ToyCarTooOldException;
use PHPUnit\Framework\TestCase;
use App\Validator\YearValidator;
class YearValidatorTest extends TestCase
{
    /**
     * @param $data
     * @param $expected
     * @dataProvider provideYear
     */
    public function testCanValidateYear(int $year, 
        bool $expected): void
    {
        $validator  = new YearValidator();
        $isValid    = $validator-&gt;validate($year);
        $this-&gt;assertEquals($expected, $isValid);
    }
    /**
     * @return array
     */
    public function provideYear(): array
    {
        return [
            [1,     false],
            [2005,  true],
            [1955,  true],
            [312,   false],
        ];
    }
    /**
     * @param int $year
     * @dataProvider provideOldYears
     */
    public function testCanRejectVeryOldCar(int 
        $year): void
    {
        $this-&gt;expectException
            (ToyCarTooOldException::class);
        $validator  = new YearValidator();
        $validator-&gt;validate($year);
    }
    /**
     * @return array
     */
    public function provideOldYears(): array
    {
        return [
            [1944],
            [1933],
            [1922],
            [1911],
        ];
    }
}</span></pre>
<ol>
<li value="2"><span class="koboSpan" id="kobo.646.1">We added a</span><a id="_idIndexMarker418"/><span class="koboSpan" id="kobo.647.1"> new test so that we check for </span><strong class="source-inline"><span class="koboSpan" id="kobo.648.1">ToyCarTooOldException</span></strong><span class="koboSpan" id="kobo.649.1">. </span><span class="koboSpan" id="kobo.649.2">Let’s add this</span><a id="_idIndexMarker419"/><span class="koboSpan" id="kobo.650.1"> exception class as well, but first, let’s run </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">the test.</span></span></li>
<li><span class="koboSpan" id="kobo.652.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.654.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter testCanRejectVeryOldCar</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.655.1">Now you </span><a id="_idIndexMarker420"/><span class="koboSpan" id="kobo.656.1">will see four errors. </span><span class="koboSpan" id="kobo.656.2">That’s okay. </span><span class="koboSpan" id="kobo.656.3">Now, let’s add the missing </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">exception class:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.658.1">codebase/symfony/src/Validator/ToyCarTooOldException.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.659.1">
&lt;?php
namespace App\Validator;
class ToyCarTooOldException extends \Exception
{
}</span></pre>
<p><span class="koboSpan" id="kobo.660.1">As you can see, it’s just a simple exception class that extends the main PHP </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">\</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">Exception</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.663.1"> class.</span></span></p>
<p><span class="koboSpan" id="kobo.664.1">If we run </span><a id="_idIndexMarker421"/><span class="koboSpan" id="kobo.665.1">the test again, we should now pass the test, as we have told PHPUnit that we are expecting exceptions for this test by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">this-&gt;expectException()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.668.1"> method.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.669.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.671.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter testCanRejectVeryOldCar</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.672.1">Now, we should be able to pass the test – you should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer119">
<span class="koboSpan" id="kobo.674.1"><img alt="Figure 8.9 – Passing the old car rejection test" src="image/Figure_8.09_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.675.1">Figure 8.9 – Passing the old car rejection test</span></p>
<p><span class="koboSpan" id="kobo.676.1">This </span><a id="_idIndexMarker422"/><span class="koboSpan" id="kobo.677.1">means that we are correctly throwing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">ToyCarTooOldException</span></strong><span class="koboSpan" id="kobo.679.1"> object whenever we submit a year that is less than or equal to 1950 – but what will happen to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">ToyCarValidatorTest</span></strong><span class="koboSpan" id="kobo.681.1">? </span></p>
<p><span class="koboSpan" id="kobo.682.1">Let’s modify the</span><a id="_idIndexMarker423"/><span class="koboSpan" id="kobo.683.1"> test data with a year less than 1950 and see </span><span class="No-Break"><span class="koboSpan" id="kobo.684.1">what happens:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.685.1">Modify the data provider content with </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">the following:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.687.1">codebase/symfony/tests/Unit/Validator/ToyCarValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.688.1">
public function provideToyCarModel(): array
{
    // Toy Car Color
    $toyColor = new ToyColor();
    $toyColor-&gt;setName(‘White’);
    // Car Manufacturer
    $carManufacturer = new CarManufacturer();
    $carManufacturer-&gt;setName(‘Williams’);
    // Toy Car
    $toyCarModel = new ToyCar();
    $toyCarModel-&gt;setName(‘’); // Should fail.
    </span><span class="koboSpan" id="kobo.688.2">$toyCarModel-&gt;setColour($toyColor);
    $toyCarModel-&gt;setManufacturer($carManufacturer);
    $toyCarModel-&gt;setYear(1935);
    return [
        [$toyCarModel, [‘is_valid’ =&gt; false, ‘name’ =&gt; 
            false, ‘year’ =&gt; false]],
    ];
}</span></pre>
<ol>
<li value="2"><span class="koboSpan" id="kobo.689.1">Now, run</span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.690.1"> the</span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.691.1"> following command and see </span><span class="No-Break"><span class="koboSpan" id="kobo.692.1">what happens:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.693.1">/var/www/html/symfony# ./runDebug.sh --filter ToyCarValidatorTest </span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.694.1">You will notice that we have failed the test with the </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">following message:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer120">
<span class="koboSpan" id="kobo.696.1"><img alt="Figure 8.10 – Failed toy car validation" src="image/Figure_8.10_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.697.1">Figure 8.10 – Failed toy car validation</span></p>
<p><span class="koboSpan" id="kobo.698.1">Now, we </span><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.699.1">can see that we have an uncaught exception. </span><span class="koboSpan" id="kobo.699.2">Our </span><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.701.1"> program is not programmed to handle this exception object. </span><span class="koboSpan" id="kobo.701.2">Why is that? </span><span class="koboSpan" id="kobo.701.3">Well, the interface in this example is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.702.1">codebase/symfony/src/Validator/ValidatorInterface.php</span></strong><span class="koboSpan" id="kobo.703.1"> interface. </span><span class="koboSpan" id="kobo.703.2">This interface throws a </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">ToyCarValidationException</span></strong><span class="koboSpan" id="kobo.705.1"> object. </span><span class="koboSpan" id="kobo.705.2">The </span><a id="_idIndexMarker427"/><span class="koboSpan" id="kobo.706.1">problem now is that our implementing class, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">YearValidator.php</span></strong><span class="koboSpan" id="kobo.708.1"> class, throws a different exception compared to its contract or interface. </span><span class="koboSpan" id="kobo.708.2">Therefore, it breaks the behavior. </span><span class="koboSpan" id="kobo.708.3">To fix this problem, we simply need to throw the correct exception as declared in the interface. </span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.709.1">Let’s modify the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">ToyCarTooOldException</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.711.1"> class:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.712.1">codebase/symfony/src/Validator/ToyCarTooOldException.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.713.1">
&lt;?php
namespace App\Validator;
class ToyCarTooOldException extends 
    ToyCarValidationException
{
}</span></pre>
<p><span class="koboSpan" id="kobo.714.1">As you</span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.715.1"> can see, we simply replaced the class it extends to </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">ToyCarValidationException</span></strong><span class="koboSpan" id="kobo.717.1">. </span><span class="koboSpan" id="kobo.717.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">ToyCarValidator.php</span></strong><span class="koboSpan" id="kobo.719.1"> class is designed to catch </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">this exception.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.721.1">Now, let’s run the test by running the following command and see whether it </span><span class="No-Break"><span class="koboSpan" id="kobo.722.1">really works:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.723.1">/var/www/html/symfony# ./runDebug.sh --filter ToyCarValidatorTest</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.724.1">We should now pass the test and see the </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer121">
<span class="koboSpan" id="kobo.726.1"><img alt="Figure 8.11 – Passing the toy car validator test, with old car validation" src="image/Figure_8.11_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.727.1">Figure 8.11 – Passing the toy car validator test, with old car validation</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.728.1">Now that we are passing the test again, let’s see what is being returned by our </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.730.1"> program. </span><span class="koboSpan" id="kobo.730.2">Remember the shell scripts we wrote back in </span><a href="B18318_05.xhtml#_idTextAnchor070"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.731.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.732.1">, </span><em class="italic"><span class="koboSpan" id="kobo.733.1">Unit Testing</span></em><span class="koboSpan" id="kobo.734.1">? </span><span class="koboSpan" id="kobo.734.2">Let’s use one of them. </span><span class="koboSpan" id="kobo.734.3">Put a breakpoint in </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">codebase/symfony/tests/Unit/Validator/ToyCarValidatorTest.php</span></strong><span class="koboSpan" id="kobo.736.1"> at line </span><strong class="bold"><span class="koboSpan" id="kobo.737.1">23</span></strong><span class="koboSpan" id="kobo.738.1">. </span><span class="koboSpan" id="kobo.738.2">Then, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.740.1">/var/www/html/symfony# ./runDebug.sh --filter ToyCarValidatorTest</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.741.1">Inspect the </span><strong class="source-inline"><span class="koboSpan" id="kobo.742.1">$result</span></strong><span class="koboSpan" id="kobo.743.1"> variable, and you should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.744.1">following content:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer122">
<span class="koboSpan" id="kobo.745.1"><img alt="Figure 8.12 – Validation model" src="image/Figure_8.12_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.746.1">Figure 8.12 – Validation model</span></p>
<p><span class="koboSpan" id="kobo.747.1">You</span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.748.1"> can see that our </span><strong class="source-inline"><span class="koboSpan" id="kobo.749.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.750.1">’s validate method returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">ValidationModel</span></strong><span class="koboSpan" id="kobo.752.1"> object. </span><span class="koboSpan" id="kobo.752.2">It gives a summary of the</span><a id="_idIndexMarker430"/><span class="koboSpan" id="kobo.753.1"> fields we validated for, as well as the exception message for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">year</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.755.1"> field.</span></span></p>
<p><span class="koboSpan" id="kobo.756.1">We’ve seen how interfaces can be useful, but sometimes they become too powerful. </span><span class="koboSpan" id="kobo.756.2">Next, we’ll talk about the </span><strong class="bold"><span class="koboSpan" id="kobo.757.1">Interface Segregation Principle</span></strong><span class="koboSpan" id="kobo.758.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.759.1">ISP</span></strong><span class="koboSpan" id="kobo.760.1">) to help stop this </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">from happening.</span></span></p>
<h1 id="_idParaDest-133"><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.762.1">TDD with the Interface Segregation Principle</span></h1>
<p><span class="koboSpan" id="kobo.763.1">Interfaces </span><a id="_idIndexMarker431"/><span class="koboSpan" id="kobo.764.1">are very helpful, but sometimes it can be very </span><a id="_idIndexMarker432"/><span class="koboSpan" id="kobo.765.1">easy to pollute</span><a id="_idIndexMarker433"/><span class="koboSpan" id="kobo.766.1"> them with capabilities </span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.767.1">that are not really supposed to be a part of the interface. </span><span class="koboSpan" id="kobo.767.2">I used to encounter this violation a lot. </span><span class="koboSpan" id="kobo.767.3">I was asking myself how I kept on creating empty methods with to-do comments, only to find classes a few months or years later, still with those to-do comments and the methods still empty. </span></p>
<p><span class="koboSpan" id="kobo.768.1">I used to touch my interfaces first and stuff them with all the methods I thought I needed. </span><span class="koboSpan" id="kobo.768.2">Then, when I finally wrote the concrete implementations, these concrete classes mostly had empty methods </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">in them.</span></span></p>
<p><span class="koboSpan" id="kobo.770.1">An</span><a id="_idIndexMarker435"/><span class="koboSpan" id="kobo.771.1"> interface</span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.772.1"> should only have methods that are specific to that interface. </span><span class="koboSpan" id="kobo.772.2">If there’s a method in there that is not entirely related to that interface, you need to segregate it into a </span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">different interface.</span></span></p>
<p><span class="koboSpan" id="kobo.774.1">Let’s see that in action. </span><span class="koboSpan" id="kobo.774.2">Again, let’s start with a – you guessed it right – test: </span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.775.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1">codebase/symfony/tests/Unit/Validator/NameValidatorTest.php</span></strong><span class="koboSpan" id="kobo.777.1"> test class and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">following content:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.779.1">
/**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.780.1">
 * @param $data</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.781.1">
 * @param $expected</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.782.1">
 * @dataProvider provideLongNames</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.783.1">
 */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.784.1">
public function testCanValidateNameLength(string </span></pre><pre class="source-code"><span class="koboSpan" id="kobo.785.1">
    $name, bool $expected): void</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.786.1">
{</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.787.1">
    $validator  = new NameValidator();</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.788.1">
    $isValid    = $validator-&gt;validateLength($name);</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.789.1">
    $this-&gt;assertEquals($expected, $isValid);</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.790.1">
}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.791.1">
/**</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.792.1">
 * @return array</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.793.1">
 */</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.794.1">
public function provideLongNames(): array</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.795.1">
{</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.796.1">
    return [</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.797.1">
        [‘TheQuickBrownFoxJumpsOverTheLazyDog’, </span></pre><pre class="source-code"><span class="koboSpan" id="kobo.798.1">
            false],</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.799.1">
    ];</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.800.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.801.1">We</span><a id="_idIndexMarker437"/><span class="koboSpan" id="kobo.802.1"> introduced a new function in the test called </span><strong class="source-inline"><span class="koboSpan" id="kobo.803.1">validateLength</span></strong><span class="koboSpan" id="kobo.804.1">, which is common for strings. </span><span class="koboSpan" id="kobo.804.2">We also added a very long name, and we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">false</span></strong><span class="koboSpan" id="kobo.806.1"> to be </span><a id="_idIndexMarker438"/><span class="koboSpan" id="kobo.807.1">expected to be returned in the </span><span class="No-Break"><span class="koboSpan" id="kobo.808.1">data provider.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.809.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">following test:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.811.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter testCanValidateNameLength</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.812.1">You should get an error, as we have not created the new </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">method yet.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.814.1">Now, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.815.1">ValidatorInterface.php</span></strong><span class="koboSpan" id="kobo.816.1"> interface and add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.817.1">validateLength</span></strong><span class="koboSpan" id="kobo.818.1"> method we are expecting to have in </span><span class="No-Break"><span class="koboSpan" id="kobo.819.1">our test:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.820.1">codebase/symfony/src/Validator/ValidatorInterface.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.821.1">
&lt;?php
namespace App\Validator;
interface ValidatorInterface
{
    /**
     * @param $input
     * @return bool
     * @throws ToyCarValidationException
     */
    public function validate($input): bool;
    /**
     * @param string $input
     * @return bool
     */
    public function validateLength(string $input): 
        bool;
}</span></pre>
<ol>
<li value="4"><span class="koboSpan" id="kobo.822.1">Great – now </span><a id="_idIndexMarker439"/><span class="koboSpan" id="kobo.823.1">we</span><a id="_idIndexMarker440"/><span class="koboSpan" id="kobo.824.1"> have the contract for validating a string’s length. </span><span class="koboSpan" id="kobo.824.2">If we go back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.825.1">NameValidator.php</span></strong><span class="koboSpan" id="kobo.826.1"> class, we’ll get the following error from </span><span class="No-Break"><span class="koboSpan" id="kobo.827.1">the IDE:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer123">
<span class="koboSpan" id="kobo.828.1"><img alt="Figure 8.13 – Must implement the method" src="image/Figure_8.13_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.829.1">Figure 8.13 – Must implement the method</span></p>
<p><span class="koboSpan" id="kobo.830.1">Obviously, we</span><a id="_idIndexMarker441"/><span class="koboSpan" id="kobo.831.1"> need to implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">validateLength</span></strong><span class="koboSpan" id="kobo.833.1"> method for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">NameValidator.php</span></strong><span class="koboSpan" id="kobo.835.1"> class, which is okay, as we want to validate the string length – but what would happen if we also wanted to create a validator for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">ToyCar</span></strong><span class="koboSpan" id="kobo.837.1"> model’s color? </span><span class="koboSpan" id="kobo.837.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">ToyCar</span></strong><span class="koboSpan" id="kobo.839.1"> model’s color property expects a </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">ToyColor.php</span></strong><span class="koboSpan" id="kobo.841.1"> object, not a string! </span><span class="koboSpan" id="kobo.841.2">Therefore, the solution is to delete the </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">validateLength</span></strong><span class="koboSpan" id="kobo.843.1"> method from </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1">ValidatorInterface</span></strong><span class="koboSpan" id="kobo.845.1">. </span><span class="koboSpan" id="kobo.845.2">Certain classes will implement </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">ValidatorInterface</span></strong><span class="koboSpan" id="kobo.847.1"> without the need to implement this logic. </span><span class="koboSpan" id="kobo.847.2">What we can do instead is create a new interface called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">StringValidator</span></strong><span class="koboSpan" id="kobo.849.1"> interface that can have the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.850.1">validateLength</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.851.1"> method.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.852.1">Refactor the </span><strong class="source-inline"><span class="koboSpan" id="kobo.853.1">codebase/symfony/src/Validator/ValidatorInterface.php</span></strong><span class="koboSpan" id="kobo.854.1"> interface</span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.855.1"> and delete the </span><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">validateLength</span></strong><span class="koboSpan" id="kobo.857.1"> method we just added, and create the following file with the </span><span class="No-Break"><span class="koboSpan" id="kobo.858.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.859.1">codebase/symfony/src/Validator/StringValidatorInterface.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.860.1">
&lt;?php
namespace App\Validator;
interface StringValidatorInterface
{
    /**
     * @param string $input
     * @return bool
     */
    public function validateLength(string $input): 
        bool;
}</span></pre>
<p><span class="koboSpan" id="kobo.861.1">At </span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.862.1">this stage, we have segregated the </span><strong class="source-inline"><span class="koboSpan" id="kobo.863.1">validateLength</span></strong><span class="koboSpan" id="kobo.864.1"> method into a separate interface, removing it from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">ValidatorInterface.php</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.866.1"> interface.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.867.1">Now, open</span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.868.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">NameValidator.php</span></strong><span class="koboSpan" id="kobo.870.1"> class, and refactor it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.871.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.872.1">codebase/symfony/src/Validator/NameValidator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.873.1">
&lt;?php
namespace App\Validator;
class NameValidator implements ValidatorInterface, 
    StringValidatorInterface
{
    const MAX_LENGTH = 10;
    /**
     * @param $input
     * @return bool
     */
    public function validate($input): bool
    {
        $isValid = false;
        if (preg_match(“/^([a-zA-Z’ ]+)$/”, $input)) {
            $isValid = true;
        }
        if ($isValid) {
            $isValid = $this-&gt;validateLength($input);
        }
        return $isValid;
    }
    /**
     * @param string $input
     * @return bool
     */
    public function validateLength(string $input): 
        bool
    {
        if (strlen($input) &gt; self::MAX_LENGTH) {
            return false;
        }
        return true;
    }
}</span></pre>
<ol>
<li value="7"><span class="koboSpan" id="kobo.874.1">We</span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.875.1"> have refactored the </span><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">NameValidator</span></strong><span class="koboSpan" id="kobo.877.1"> class so that it now also checks for the name’s length. </span><span class="koboSpan" id="kobo.877.2">Let’s run the test and see whether </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">it passes:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.879.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter testCanValidateNameLength</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.880.1">Now, you should see the </span><span class="No-Break"><span class="koboSpan" id="kobo.881.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer124">
<span class="koboSpan" id="kobo.882.1"><img alt="Figure 8.14 – Passing the string length validation test" src="image/Figure_8.14_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.883.1">Figure 8.14 – Passing the string length validation test</span></p>
<p><span class="koboSpan" id="kobo.884.1">What we</span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.885.1"> did is instead of combining different methods into </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">ValidatorInterface</span></strong><span class="koboSpan" id="kobo.887.1">, we segregated them into two different interfaces. </span><span class="koboSpan" id="kobo.887.2">Then, we only implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.888.1">StringValidator</span></strong><span class="koboSpan" id="kobo.889.1"> interface for the validator objects that will need this </span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1">validateLength</span></strong><span class="koboSpan" id="kobo.891.1"> method. </span><span class="koboSpan" id="kobo.891.2">That’s basically what the ISP is all about. </span><span class="koboSpan" id="kobo.891.3">This is a very basic example, but it is very easy to fall victim to these very powerful interfaces if you don’t </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1">watch out.</span></span></p>
<p><span class="koboSpan" id="kobo.893.1">Next, we will go back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.895.1"> class and see how we can improve what we had earlier in the </span><em class="italic"><span class="koboSpan" id="kobo.896.1">TDD with the Open-Closed Principle</span></em><span class="koboSpan" id="kobo.897.1"> example, using the </span><strong class="bold"><span class="koboSpan" id="kobo.898.1">Dependency Inversion </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.899.1">Principle</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.900.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.901.1">DIP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.902.1">).</span></span></p>
<h1 id="_idParaDest-134"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.903.1">TDD with the Dependency Inversion Principle</span></h1>
<p><span class="koboSpan" id="kobo.904.1">In terms of making </span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.905.1">a class more testable, the DIP is probably the most important principle on the list for me. </span><span class="koboSpan" id="kobo.905.2">The</span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.906.1"> DIP suggests that details should depend on abstractions. </span><span class="koboSpan" id="kobo.906.2">To me, this means that the specifics of a program that does not really belong to a class should be abstracted. </span><span class="koboSpan" id="kobo.906.3">The DIP allows us as </span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.907.1">developers to remove a concrete implementation of a routine or program and put it in a different object altogether. </span><span class="koboSpan" id="kobo.907.2">We can then use the DIP to inject the object that we need, whenever we need it. </span><span class="koboSpan" id="kobo.907.3">We can inject the object that we need in the constructor, passed as an argument upon class instantiation, or simply expose a mutator function. </span></p>
<p><span class="koboSpan" id="kobo.908.1">Let’s </span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.909.1">revisit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.911.1"> class that we created earlier in this chapter to see how we can implement </span><span class="No-Break"><span class="koboSpan" id="kobo.912.1">the DIP.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.913.1">How will this look in </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.914.1">our code?</span></strong></span></p>
<p><span class="koboSpan" id="kobo.915.1">Going back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">ToyCarValidator.php</span></strong><span class="koboSpan" id="kobo.917.1"> class, you will notice that in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.918.1">__constructor</span></strong><span class="koboSpan" id="kobo.919.1"> method, we have instantiated </span><span class="No-Break"><span class="koboSpan" id="kobo.920.1">two classes:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer125">
<span class="koboSpan" id="kobo.921.1"><img alt="Figure 8.15 – Hardcoded dependencies" src="image/Figure_8.15_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.922.1">Figure 8.15 – Hardcoded dependencies</span></p>
<p><span class="koboSpan" id="kobo.923.1">How can we improve this? </span><span class="koboSpan" id="kobo.923.2">Well, this program works – as you have seen, we are passing </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">ToyCarValidatorTest</span></strong><span class="koboSpan" id="kobo.925.1">. </span><span class="koboSpan" id="kobo.925.2">The only problem is that our </span><strong class="source-inline"><span class="koboSpan" id="kobo.926.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.927.1"> class is now hardcoded to its dependencies – the </span><strong class="source-inline"><span class="koboSpan" id="kobo.928.1">YearValidator</span></strong><span class="koboSpan" id="kobo.929.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.930.1">NameValidator</span></strong><span class="koboSpan" id="kobo.931.1"> classes. </span><span class="koboSpan" id="kobo.931.2">What</span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.932.1"> if we want to replace these classes – or what if we want to add more validators? </span><span class="koboSpan" id="kobo.932.2">Well, what we can do is remove the dependency from inside of the class. </span><span class="koboSpan" id="kobo.932.3">Follow </span><span class="No-Break"><span class="koboSpan" id="kobo.933.1">these steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.934.1">Refactor the following test class, and replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">testCanValidate</span></strong><span class="koboSpan" id="kobo.936.1"> method with the </span><span class="No-Break"><span class="koboSpan" id="kobo.937.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.938.1">codebase/symfony/tests/Unit/Validator/ToyCarValidatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.939.1">
/**
 * @param ToyCar $toyCar
 * @param array $expected
 * @dataProvider provideToyCarModel
 */
public function testCanValidate(ToyCar $toyCar, array 
    $expected): void
{
    $validators = [
        ‘year’  =&gt; new YearValidator(),
        ‘name’  =&gt; new NameValidator(),
    ];
    // Inject the validators
    $validator = new ToyCarValidator();
    $validator-&gt;setValidators($validators);
    $result = $validator-&gt;validate($toyCar);
    $this-&gt;assertEquals($expected[‘is_valid’], 
        $result-&gt;isValid());
    $this-&gt;assertEquals($expected[‘name’], 
        $result-&gt;getReport()[‘name’][‘is_valid’]);
    $this-&gt;assertEquals($expected[‘year’], 
        $result-&gt;getReport()[‘year’][‘is_valid’]);
}</span></pre>
<p><span class="koboSpan" id="kobo.940.1">You </span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.941.1">will notice that the objects that </span><strong class="source-inline"><span class="koboSpan" id="kobo.942.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.943.1"> depends on are now being instantiated outside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.945.1"> class – and we then set the validators using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">setValidators</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.947.1"> mutator.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.948.1">Now, remove</span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.949.1"> the hardcoded validator instantiations from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.950.1">ToyCarValidator</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.951.1">’s constructor:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.952.1">codebase/symfony/src/Validator/ToyCarValidator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.953.1">
&lt;?php
namespace App\Validator;
use App\Model\ToyCar;
use App\Model\ValidationModel as ValidationResult;
class ToyCarValidator implements 
    ToyCarValidatorInterface
{
    /**
     * @var array
     */
    private $validators = [];
    /**
     * @param ToyCar $toyCar
     * @return ValidationResult
     */
    public function validate(ToyCar $toyCar): 
        ValidationResult
    {
        $result     = new ValidationResult();
        $allValid   = true;
        $results    = [];
        foreach ($this-&gt;getValidators() as $key =&gt; 
            $validator) {
            $accessor   = ‘get’ . </span><span class="koboSpan" id="kobo.953.2">ucfirst(strtolower
                ($key));
            $value      = $toyCar-&gt;$accessor();
            $isValid    = false;
            try {
                $isValid = $validator-&gt;validate
                    ($value);
                $results[$key][‘message’]   = ‘’;
            } catch (ToyCarValidationException $ex) {
                $results[$key][‘message’]   = 
                    $ex-&gt;getMessage();
            } finally {
                $results[$key][‘is_valid’]  = 
                    $isValid;
            }
            if (!$isValid) {
                $allValid = false;
            }
        }
        $result-&gt;setValid($allValid);
        $result-&gt;setReport($results);
        return $result;
    }
    /**
     * @return array
     */
    public function getValidators(): array
    {
        return $this-&gt;validators;
    }
    /**
     * @param array $validators
     */
    public function setValidators(array $validators): 
        void
    {
        $this-&gt;validators = $validators;
    }
}</span></pre>
<ol>
<li value="3"><span class="koboSpan" id="kobo.954.1">We no longer have the hardcoded validator instantiations – now, let’s run the test and see whether the tests </span><span class="No-Break"><span class="koboSpan" id="kobo.955.1">still pass:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.956.1">/var/www/html/symfony# ./runDebug.sh --testsuite=Unit --filter testCanValidateNameLength</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.957.1">After </span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.958.1">running the command, you should see that the tests still pass. </span><span class="koboSpan" id="kobo.958.2">At this point, we can keep creating new validators and just add them to the array of validators we want to inject into the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">ToyCarValidator.php</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.960.1"> class.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.961.1">Now, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">ToyCarCreator.php</span></strong><span class="koboSpan" id="kobo.963.1"> class we created earlier in this chapter, and</span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.964.1"> you’ll see that it’s already prepared to accept dependencies from the outside. </span><span class="koboSpan" id="kobo.964.2">We can also refactor the class so that we can automatically inject the dependencies it needs </span><span class="No-Break"><span class="koboSpan" id="kobo.965.1">during instantiation.</span></span></li>
<li><span class="koboSpan" id="kobo.966.1">Open the following test class and refactor it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.968.1">codebase/symfony/tests/Integration/Processor/ToyCarCreatorTest.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.969.1">
&lt;?php
namespace App\Tests\Integration\Repository;
use App\DAL\Writer\WriterInterface;
use App\Model\CarManufacturer;
use App\Model\ToyCar;
use App\Model\ToyColor;
use App\Model\ValidationModel;
use App\Processor\ToyCarCreator;
use App\Validator\ToyCarValidatorInterface;
use Symfony\Bundle\FrameworkBundle\Test\KernelTestCase;
class ToyCarCreatorTest extends KernelTestCase
{
    /**
     * @param ToyCar $toyCarModel
     * @throws \App\Validator
           \ToyCarValidationException
     * @dataProvider provideToyCarModel
     */
    public function testCanCreate(ToyCar 
        $toyCarModel): void
    {
        $validationResultStub = $this-&gt;createMock
            (ValidationModel::class);
        $validationResultStub
            -&gt;method(‘isValid’)
            -&gt;willReturn(true);
        // Mock 1: Validator
        $validatorStub = $this-&gt;createMock
            (ToyCarValidatorInterface::class);
        $validatorStub
            -&gt;method(‘validate’)
            -&gt;willReturn($validationResultStub);
        // Mock 2: Data writer
        $toyWriterStub = $this-&gt;createMock
            (WriterInterface::class);
        $toyWriterStub
            -&gt;method(‘write’)
            -&gt;willReturn(true);
        // Processor Class
        $processor = new ToyCarCreator($validatorStub, 
            $toyWriterStub);
        // Execute
        $result = $processor-&gt;create($toyCarModel);
        $this-&gt;assertTrue($result);
    }
    public function provideToyCarModel(): array
    {
        // Toy Car Color
        $toyColor = new ToyColor();
        $toyColor-&gt;setName(‘Black’);
        // Car Manufacturer
        $carManufacturer = new CarManufacturer();
        $carManufacturer-&gt;setName(‘Ford’);
        // Toy Car
        $toyCarModel = new ToyCar();
        $toyCarModel-&gt;setName(‘Mustang’);
        $toyCarModel-&gt;setColour($toyColor);
        $toyCarModel-&gt;setManufacturer
            ($carManufacturer);
        $toyCarModel-&gt;setYear(1968);
        return [
            [$toyCarModel],
        ];
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.970.1">As you</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.971.1"> can see, we </span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.972.1">have instantiated the dependencies of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">ToyCarCreator.php</span></strong><span class="koboSpan" id="kobo.974.1"> class and then injected them as a parameter when we instantiated the class in </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.975.1">ToyCarCreator($validatorStub, $toyWriterStub);</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.976.1">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.977.1">Then, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.978.1">ToyCarCreator.php</span></strong><span class="koboSpan" id="kobo.979.1"> solution class and refactor it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.980.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.981.1">codebase/symfony/src/Processor/ToyCarCreator.php</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.982.1">
&lt;?php
namespace App\Processor;
use App\DAL\Writer\WriterInterface;
use App\Model\ToyCar;
use App\Validator\ToyCarValidationException;
use App\Validator\ToyCarValidatorInterface;
class ToyCarCreator
{
    /**
     * @var ToyCarValidatorInterface
     */
    private $validator;
    /**
     * @var WriterInterface
     */
    private $dataWriter;
    public function __construct
        (ToyCarValidatorInterface $validator, 
            WriterInterface $dataWriter)
    {
        $this-&gt;setValidator($validator);
        $this-&gt;setDataWriter($dataWriter);
    }
    /**
     * @param ToyCar $toyCar
     * @return bool
     * @throws ToyCarValidationException
     */
    public function create(ToyCar $toyCar): bool
    {
        // Do some validation here and so on...
        </span><span class="koboSpan" id="kobo.982.2">$this-&gt;getValidator()-&gt;validate($toyCar);
        // Write the data
        $result = $this-&gt;getDataWriter()-&gt;write
            ($toyCar);
        // Do other stuff.
        </span><span class="koboSpan" id="kobo.982.3">return $result;
    }
    /**
     * @return WriterInterface
     */
    public function getDataWriter(): WriterInterface
    {
        return $this-&gt;dataWriter;
    }
    /**
     * @param WriterInterface $dataWriter
     */
    public function setDataWriter(WriterInterface 
        $dataWriter): void
    {
        $this-&gt;dataWriter = $dataWriter;
    }
    /**
     * @return ToyCarValidatorInterface
     */
    public function getValidator(): 
        ToyCarValidatorInterface
    {
        return $this-&gt;validator;
    }
    /**
     * @param ToyCarValidatorInterface $validator
     */
    public function setValidator
        (ToyCarValidatorInterface $validator): void
    {
        $this-&gt;validator = $validator;
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.983.1">Upon</span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.984.1"> instantiation, both </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.985.1">the validator and writer dependencies are set through </span><span class="No-Break"><span class="koboSpan" id="kobo.986.1">the constructor.</span></span></p>
<p><span class="koboSpan" id="kobo.987.1">If we run the test, it should </span><span class="No-Break"><span class="koboSpan" id="kobo.988.1">still pass:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.989.1">
/var/www/html/symfony# ./runDebug.sh --testsuite=Integration --filter ToyCarCreatorTest</span></pre>
<p><span class="koboSpan" id="kobo.990.1">After running the command, you should still see a passing test. </span></p>
<p><span class="koboSpan" id="kobo.991.1">The most obvious thing that you will notice with this approach is that you will have to manage all the dependencies yourself and then inject them into the object that needs them. </span><span class="koboSpan" id="kobo.991.2">Luckily, we are not the first people to encounter this headache. </span><span class="koboSpan" id="kobo.991.3">There are a lot of service containers out there that help manage the dependencies that your application needs, but the most important thing when selecting a service container for PHP is that it should follow the PSR-11 standards. </span><span class="koboSpan" id="kobo.991.4">You can read more about PSR-11 </span><span class="No-Break"><span class="koboSpan" id="kobo.992.1">at </span></span><a href="https://www.php-fig.org/psr/psr-11/"><span class="No-Break"><span class="koboSpan" id="kobo.993.1">https://www.php-fig.org/psr/psr-11/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.994.1">.</span></span></p>
<h1 id="_idParaDest-135"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.995.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.996.1">In this chapter, we’ve gone through the SOLID principles one by one. </span><span class="koboSpan" id="kobo.996.2">We used our tests to kickstart the development of our solution code so that we can use them as examples for implementing the SOLID principles in real life. </span></p>
<p><span class="koboSpan" id="kobo.997.1">We have covered the SRP, which helped us make a PHP class’s responsibility or capability more focused. </span><span class="koboSpan" id="kobo.997.2">The OCP helped us avoid the need for touching or modifying a class in some instances when we want to change its behavior. </span><span class="koboSpan" id="kobo.997.3">The LSP helped us be stricter about the behavior of an interface, making it easier for us to switch concrete objects implementing that interface without breaking the parent class’s behavior. </span><span class="koboSpan" id="kobo.997.4">The ISP helped us make the responsibility of an interface more focused – classes that implement this interface will no longer have empty methods just because they were declared by the interface. </span><span class="koboSpan" id="kobo.997.5">The DIP helped us quickly test our </span><strong class="source-inline"><span class="koboSpan" id="kobo.998.1">ToyCarCreator</span></strong><span class="koboSpan" id="kobo.999.1"> class even without creating a concrete implementation of its dependencies, such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">ToyCarValidator</span></strong><span class="koboSpan" id="kobo.1001.1"> class. </span></p>
<p><span class="koboSpan" id="kobo.1002.1">When working on real-life projects, some principles are hard to strictly follow, and sometimes the boundaries are vague. </span><span class="koboSpan" id="kobo.1002.2">Add the pressure of real-life deadlines and it gets even more interesting. </span><span class="koboSpan" id="kobo.1002.3">One thing is for sure, using BDD and TDD will help you be more confident about the features you are developing, especially when you are already a few months deep into a project. </span><span class="koboSpan" id="kobo.1002.4">Adding SOLID principles on top of that makes your solution </span><span class="No-Break"><span class="koboSpan" id="kobo.1003.1">even better!</span></span></p>
<p><span class="koboSpan" id="kobo.1004.1">In the next chapter, we will try to utilize automated tests to help us make sure that any code changes that any developer in your team pushes into your code repository will not break the expected behavior of your software. </span><span class="koboSpan" id="kobo.1004.2">We will try to automate this process by using </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">Continuous Integration.</span></span></p>
</div>


<div class="Content" id="_idContainer127">
<h1 id="_idParaDest-136"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.1.1">Part 3 – Deployment Automation and Monitoring</span></h1>
<p><span class="koboSpan" id="kobo.2.1">In this part of the book, you will learn how to utilize automated tests to improve and automate the code integration process, as well as automate the deployment process of an application. </span><span class="koboSpan" id="kobo.2.2">You will also learn how to monitor a PHP application after it’s </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">been deployed.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This section comprises the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B18318_09.xhtml#_idTextAnchor138"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 9</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Continuous Integration</span></em></li>
<li><a href="B18318_10.xhtml#_idTextAnchor146"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Continuous Delivery</span></em></li>
<li><a href="B18318_11.xhtml#_idTextAnchor162"><em class="italic"><span class="koboSpan" id="kobo.12.1">Chapter 11</span></em></a><span class="koboSpan" id="kobo.13.1">, </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Monitoring</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer128">
</div>
</div>
</body></html>