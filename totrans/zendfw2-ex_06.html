<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Media Sharing"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Media Sharing</h1></div></div></div><p>
<span class="emphasis"><em>Uploading and managing images/videos on the Internet has become very common with the advent<a id="id540" class="indexterm"/> of social media. More and more applications now allow you to share and retrieve media with external media hosts/services such as Google, Flickr, and YouTube. In Zend Framework 1.0, the <code class="literal">Zend_Service</code> package offered a large number<a id="id541" class="indexterm"/> of third-party integrations. This has changed with ZF2 and the new module framework.</em></span>
</p><p>In this chapter, we will use various external Zend Framework 2.0 modules to manage images and videos. Let's quickly look at the topics that we will be learning in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing external modules in the Zend Framework application</li><li class="listitem" style="list-style-type: disc">Setting up a simple photo gallery</li><li class="listitem" style="list-style-type: disc">Resizing <a id="id542" class="indexterm"/>and manipulating images using <code class="literal">WebinoImageThumb</code></li><li class="listitem" style="list-style-type: disc">Introduction to the Zend GData API</li><li class="listitem" style="list-style-type: disc">Using the GData API to fetch albums from Google Photos and YouTube</li></ul></div><div class="section" title="External modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec55"/>External modules</h1></div></div></div><p>One of the most important features of Zend Framework 2.0 is the ability to integrate external modules in your PHP application, and this integration is completely managed using a <a id="id543" class="indexterm"/>dependency management tool (in our case, <code class="literal">Composer</code>).</p><p>This feature allows development of PHP applications without having to worry about maintaining external libraries inside your application. Libraries and applications can be decoupled and maintained separately.</p><p>In this chapter, we will be using an external module for resizing images; we will also make use of external libraries for connecting to Google services.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip28"/>Tip</h3><p>
<span class="strong"><strong>Composer</strong></span>
</p><p>Composer <a id="id544" class="indexterm"/>is the one of the dependency management solutions used in Zend Framework. Composer allows developers to declare the dependencies needed for their application and will handle the installation of those libraries.<a id="id545" class="indexterm"/> The dependency configuration is stored in a file named <code class="literal">composer.json</code>.</p></div></div></div></div>
<div class="section" title="Resizing images"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec56"/>Resizing images</h1></div></div></div><p>Zend Framework 1.0 had a resize filter that allowed images to be resized on upload; with Zend <a id="id546" class="indexterm"/>Framework 2.0, this option no longer exists. Our next task will be to find a simple image-resizing module and install it in our application. So let's get started.</p></div>
<div class="section" title="Time for action &#x2013; resizing images using modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec57"/>Time for action – resizing images using modules</h1></div></div></div><p>Carry out the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go <a id="id547" class="indexterm"/>to the Zend Framework 2 module's<a id="id548" class="indexterm"/> site:<p>
<a class="ulink" href="http://modules.zendframework.com/">http://modules.zendframework.com/</a>
</p></li><li class="listitem">Run a search for <code class="literal">WebinoImageThumb</code>.</li><li class="listitem">To install this module, you will need to update <code class="literal">composer.json</code> in the application root and include this module as a required module.</li><li class="listitem">To do this, edit <code class="literal">CommunicationApp/composer.json</code> and modify the required section:<div class="informalexample"><pre class="programlisting">"require": {
    "php": "&gt;=5.3.3",
    "zendframework/zendframework": "2.0.*",
    "webino/webino-image-thumb": "1.*",
}</pre></div></li><li class="listitem">Now run <code class="literal">composer.phar update</code> to install the newly added dependency.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar update</strong></span>
<span class="strong"><strong>Loading composer repositories with package information</strong></span>
<span class="strong"><strong>Updating dependencies</strong></span>
<span class="strong"><strong>  - Installing webino/webino-image-thumb (1.0.0)</strong></span>
<span class="strong"><strong>    Downloading: 100%</strong></span>

<span class="strong"><strong>Writing lock file</strong></span>
<span class="strong"><strong>Generating autoload files</strong></span>
</pre></div></li><li class="listitem">You <a id="id549" class="indexterm"/>will be able to see the newly installed modules in the <code class="literal">vendor</code> folder as follows:<div class="mediaobject"><img src="graphics/1929OS_06_01.jpg" alt="Time for action – resizing images using modules"/></div></li><li class="listitem">Now <a id="id550" class="indexterm"/>that the module is downloaded, we will need to activate the module in <code class="literal">CommunicationApp/config/application.config.php</code> by adding <code class="literal">'WebinoImageThumb'</code> to the <code class="literal">modules</code> array.<div class="informalexample"><pre class="programlisting">return array(
    'modules' =&gt; array(
        'Application',
      'WebinoImageThumb',
    'Users',
    ),</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec59"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We<a id="id551" class="indexterm"/> have installed an external module into our application<a id="id552" class="indexterm"/> using the dependency management tool, Composer. We have also activated the module in our application so that the module is accessible across the application.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec60"/>Have a go hero</h2></div></div></div><p>Now that you know how to install new modules in the Zend Framework 2 application, here is a simple task for you. Install the Zend GData package on this application. Instructions<a id="id553" class="indexterm"/> for installing this package are available at <a class="ulink" href="https://packages.zendframework.com/">https://packages.zendframework.com/</a>. We will be using this module in the subsequent sections of this chapter.</p></div></div>
<div class="section" title="The Photo gallery application"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec58"/>The Photo gallery application</h1></div></div></div><p>Let us get started with implementing our custom photo gallery using Zend Framework 2. Since we<a id="id554" class="indexterm"/> have already implemented a file management interface, we will use a similar interface to implement a photo gallery.</p><p>The schema for a photo gallery will be similar to the <code class="literal">Upload</code> entity; additionally, we will have<a id="id555" class="indexterm"/> a field <a id="id556" class="indexterm"/>to store the <code class="literal">thumbnail</code> filename, which is generated during upload. Both the images and the generated thumbnails will be stored in the <code class="literal">&lt;Module&gt;\data\images</code> folder. We will use a custom action to display the images in the browser.</p><p>Before we get started, let's quickly review some of the important methods that are supported by <code class="literal">WebinoImageThumb</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">resize ($maxWidth = 0, $maxHeight = 0)</code>: This function resizes the image<a id="id557" class="indexterm"/> to <a id="id558" class="indexterm"/>the specified height and width; if either of the values is set to <code class="literal">0</code>, that dimension will not be considered as a limiter</li><li class="listitem" style="list-style-type: disc"><code class="literal">adaptiveResize ($width, $height)</code>: This<a id="id559" class="indexterm"/> function attempts<a id="id560" class="indexterm"/> to get the image as close to the provided dimensions as possible, and then crops the remaining overflow (from the center) to get the image to be the size specified</li><li class="listitem" style="list-style-type: disc"><code class="literal">crop ($startX, $startY, $cropWidth, $cropHeight)</code>: This function crops <a id="id561" class="indexterm"/>the<a id="id562" class="indexterm"/> images from the given coordinates to the specified width and height</li><li class="listitem" style="list-style-type: disc"><code class="literal">rotateImage ($direction = 'CW')</code>: Rotates the image by 90 degrees clockwise<a id="id563" class="indexterm"/> or<a id="id564" class="indexterm"/> counterclockwise</li><li class="listitem" style="list-style-type: disc"><code class="literal">rotateImageNDegrees ($degrees)</code>: Rotates<a id="id565" class="indexterm"/> the image <a id="id566" class="indexterm"/>by the specified degrees</li><li class="listitem" style="list-style-type: disc"><code class="literal">save ($fileName, $format = null)</code>: Saves<a id="id567" class="indexterm"/> the image<a id="id568" class="indexterm"/> by the specified filename</li></ul></div></div>
<div class="section" title="Time for action &#x2013; implementing a simple photo gallery"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec59"/>Time for action – implementing a simple photo gallery</h1></div></div></div><p>Carry <a id="id569" class="indexterm"/>out the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new<a id="id570" class="indexterm"/> entity called <code class="literal">ImageUpload</code> with the following table structure:<div class="informalexample"><pre class="programlisting">      CREATE TABLE IF NOT EXISTS image_uploads (
        id INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
        filename VARCHAR( 255 ) NOT NULL ,
        thumbnail VARCHAR( 255 ) NOT NULL ,
        label VARCHAR( 255 ) NOT NULL ,
        user_id INT NOT NULL,
        UNIQUE KEY (filename)
      );</pre></div></li><li class="listitem">Create<a id="id571" class="indexterm"/> the relevant <code class="literal">ImageUpload</code> entity in the <code class="literal">src/Users/Model/ImageUpload.php</code> file<a id="id572" class="indexterm"/>, the <a id="id573" class="indexterm"/><code class="literal">TableGateway</code> object in the <code class="literal">src/Users/Model/ImageUploadTable.php</code> file<a id="id574" class="indexterm"/>, and the <code class="literal">Controller</code> (<code class="literal">MediaManagerController</code>) inside the module (<code class="literal">CommunicationApp/module/Users</code>) in the <code class="literal">src/Users/Controller/MediaManagerController.php</code> file.</li><li class="listitem">In the <code class="literal">Upload</code> form's <code class="literal">Submit</code> process, generate the thumbnail by using a new method called <code class="literal">generateThumbnail()</code>; this method will take the filename of the <a id="id575" class="indexterm"/>existing image as the parameter. The <code class="literal">resize</code> method<a id="id576" class="indexterm"/> resizes the image to 75x75 px and saves it to the image upload directory with a <code class="literal">tn_</code> prefix.<p>This<a id="id577" class="indexterm"/> method needs to be placed in the <code class="literal">MediaManagerController</code> file, <code class="literal">src/Users/Controller/MediaManagerController.php</code>.</p><div class="informalexample"><pre class="programlisting">    public function generateThumbnail($imageFileName) 
    {
      $path = $this-&gt;getFileUploadLocation();
      $sourceImageFileName = $path . '/' . $imageFileName;
      $thumbnailFileName = 'tn_' . $imageFileName;
      
      $imageThumb = $this-&gt;getServiceLocator()
            -&gt;get('WebinoImageThumb');
      $thumb = $imageThumb-&gt;create($sourceImageFileName, $options = array());
<span class="strong"><strong>      $thumb-&gt;resize(75, 75);</strong></span>
<span class="strong"><strong>      $thumb-&gt;save($path . '/' . $thumbnailFileName);</strong></span>
      
      return $thumbnailFileName;
  }</pre></div></li><li class="listitem">Our<a id="id578" class="indexterm"/> next step is to write an action to render <a id="id579" class="indexterm"/>the<a id="id580" class="indexterm"/> image in the <code class="literal">Full</code> and <code class="literal">Thumbnail</code> modes; for this we will need to create a custom route that will take the <code class="literal">action</code>, <code class="literal">id</code>, and <code class="literal">subaction</code> parameters. This is achieved by the following <a id="id581" class="indexterm"/>route definition in the module configuration file, <code class="literal">CommunicationApp/module/Users/config/module.config.php</code>:<div class="informalexample"><pre class="programlisting">    'media' =&gt; array(
      'type'    =&gt; 'Segment',
      'options' =&gt; array(
<span class="strong"><strong>        'route'    =&gt; '/media[/:action[/:id[/:subaction]]]',</strong></span>
        'constraints' =&gt; array(
<span class="strong"><strong>          'action'     =&gt; '[a-zA-Z][a-zA-Z0-9_-]*',</strong></span>
<span class="strong"><strong>          'id'     =&gt; '[a-zA-Z0-9_-]*',</strong></span>
<span class="strong"><strong>          'subaction'     =&gt; '[a-zA-Z][a-zA-Z0-9_-]*',</strong></span>
          
        ),
        'defaults' =&gt; array(
          'controller' =&gt; 'Users\Controller\MediaManager',
          'action'     =&gt; 'index',
        ),
      ),
    ),   </pre></div></li><li class="listitem">Our next step is to write an action that will respond to the various image requests. This action needs to be placed in the <code class="literal">MediaManagerController</code> file<a id="id582" class="indexterm"/>, <code class="literal">src/Users/Controller/MediaManagerController.php</code>.<div class="informalexample"><pre class="programlisting">    public function showImageAction()
    {  
      $uploadId = $this-&gt;params()-&gt;fromRoute('id');
      $uploadTable = $this-&gt;getServiceLocator()
          -&gt;get('ImageUploadTable');
      $upload = $uploadTable-&gt;getUpload($uploadId);
       
      // Fetch Configuration from Module Config
      $uploadPath    = $this-&gt;getFileUploadLocation();
<span class="strong"><strong>      if ($this-&gt;params()-&gt;fromRoute('subaction') == 'thumb') </strong></span>
<span class="strong"><strong>      {</strong></span>
<span class="strong"><strong>        $filename = $uploadPath ."/" . $upload-&gt;thumbnail;</strong></span>
<span class="strong"><strong>      } else {</strong></span>
<span class="strong"><strong>        $filename = $uploadPath ."/" . $upload-&gt;filename;</strong></span>
<span class="strong"><strong>      }</strong></span>
      $file = file_get_contents($filename);
       
      // Directly return the Response 
      $response = $this-&gt;getEvent()-&gt;getResponse();
      $response-&gt;getHeaders()-&gt;addHeaders(array(
        'Content-Type' =&gt; 'application/octet-stream',
        'Content-Disposition' =&gt; 'attachment;filename="' .$upload-&gt;filename . '"',

      ));
      $response-&gt;setContent($file);
      return $response;	    
    }</pre></div></li><li class="listitem">Make<a id="id583" class="indexterm"/> sure the process works completely, from uploading the picture to the gallery to displaying it in the photo page. See the following code for the usage of <code class="literal">showImageAction()</code> in the <code class="literal">upload</code> view<a id="id584" class="indexterm"/> in the media manager, <code class="literal">CommunicationApp/module/Users/view/users/media-manager/view.phtml</code>:<div class="informalexample"><pre class="programlisting">    &lt;section class="upload"&gt;
    &lt;h2&gt;&lt;?php echo $this-&gt;escapeHtml($upload-&gt;label);?&gt;&lt;/h2&gt;
    &lt;h4&gt;&lt;?php echo $this-&gt;escapeHtml($upload-&gt;filename);?&gt;&lt;/h4&gt;
<span class="strong"><strong>    &lt;img src="&lt;?php echo $this-&gt;url('users/media',</strong></span>
<span class="strong"><strong>                array('action'=&gt;'showImage', </strong></span>
<span class="strong"><strong>                      'id' =&gt; $upload-&gt;id, </strong></span>
<span class="strong"><strong>                      'subaction' =&gt; 'full'));?&gt;" /&gt;</strong></span>
    &lt;/section&gt;
    &lt;a href="&lt;?php echo $this-&gt;url('users/media');?&gt;"&gt;
          &amp;raquo; Show Gallery&lt;/a&gt;</pre></div></li><li class="listitem">Now<a id="id585" class="indexterm"/> test the application on a browser of your choice. The image upload page should look like the following screenshot:<div class="mediaobject"><img src="graphics/1929OS_06_02.jpg" alt="Time for action – implementing a simple photo gallery"/></div></li></ol></div><p>Once<a id="id586" class="indexterm"/> the image upload form is successfully submitted, the image will be resized and shown in the gallery as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/1929OS_06_03.jpg" alt="Time for action – implementing a simple photo gallery"/></div><p>The <span class="strong"><strong>View Image</strong></span> link<a id="id587" class="indexterm"/> on top of the resized image takes you to a page with the full-sized image:</p><div class="mediaobject"><img src="graphics/1929OS_06_04.jpg" alt="Time for action – implementing a simple photo gallery"/></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec61"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We <a id="id588" class="indexterm"/>have implemented a simple photo gallery by making use of an external image manipulation library. We utilized the <code class="literal">resize</code> function to create thumbnails and we created a custom action to handle image rendering in the web browser.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec62"/>Have a go hero</h2></div></div></div><p>Now that you understand how to work with the <code class="literal">WebinoImageThumb</code> module, your next task will be<a id="id589" class="indexterm"/> to extend the photo gallery to support the <code class="literal">rotate</code> function. Add a <code class="literal">rotate</code> function<a id="id590" class="indexterm"/> to the <span class="strong"><strong>View Image</strong></span> page<a id="id591" class="indexterm"/> and allow the user to rotate the image both clockwise and anticlockwise.</p></div></div>
<div class="section" title="Google Data APIs"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec60"/>Google Data APIs</h1></div></div></div><p>Google Data APIs<a id="id592" class="indexterm"/> provide a simple interface for applications to read and write data into various Google services. The Data APIs use a protocol similar to the Atom Publishing Protocol for data transfer. All the services are implemented in the package called <code class="literal">ZendGdata</code>.</p><p>Some of the most frequently used Google services that are supported by the <code class="literal">ZendGdata</code> API are listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Picasa<a id="id593" class="indexterm"/> Web Albums</li><li class="listitem" style="list-style-type: disc">YouTube<a id="id594" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">Google <a id="id595" class="indexterm"/>Calendar</li><li class="listitem" style="list-style-type: disc">Google <a id="id596" class="indexterm"/>Spreadsheets</li><li class="listitem" style="list-style-type: disc">Google<a id="id597" class="indexterm"/> Documents</li><li class="listitem" style="list-style-type: disc">Google<a id="id598" class="indexterm"/> Provisioning</li><li class="listitem" style="list-style-type: disc">Google<a id="id599" class="indexterm"/> Analytics</li><li class="listitem" style="list-style-type: disc">Google <a id="id600" class="indexterm"/>Blogger</li><li class="listitem" style="list-style-type: disc">Google<a id="id601" class="indexterm"/> CodeSearch</li><li class="listitem" style="list-style-type: disc">Google <a id="id602" class="indexterm"/>Notebook</li></ul></div><p>Since <code class="literal">ZendGdata</code> is not provided with the default Zend Framework installation, this needs to be installed manually. This can be performed using Composer and by fetching <code class="literal">"zendframework/zendgdata": "2.*"</code>.</p><div class="section" title="The Google Photos API"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec63"/>The Google Photos API</h2></div></div></div><p>The Google Photos API<a id="id603" class="indexterm"/> allows you to fetch, edit, and manage your photos and albums in your Picasa or Google+ accounts. The Data API provides <a id="id604" class="indexterm"/>all kinds of services; some of the key functions are listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">getUserFeed()</code>: Gets<a id="id605" class="indexterm"/> all the associated<a id="id606" class="indexterm"/> albums for that user</li><li class="listitem" style="list-style-type: disc"><code class="literal">insertAlbumEntry()</code>: Creates <a id="id607" class="indexterm"/>a new<a id="id608" class="indexterm"/> album</li><li class="listitem" style="list-style-type: disc"><code class="literal">getAlbumFeed()</code>: Fetches<a id="id609" class="indexterm"/> the specified<a id="id610" class="indexterm"/> album</li><li class="listitem" style="list-style-type: disc"><code class="literal">insertPhotoEntry()</code>: Creates <a id="id611" class="indexterm"/>a new<a id="id612" class="indexterm"/> photo</li><li class="listitem" style="list-style-type: disc"><code class="literal">getPhotoFeed()</code>: Fetches<a id="id613" class="indexterm"/> the specified<a id="id614" class="indexterm"/> photo</li><li class="listitem" style="list-style-type: disc"><code class="literal">insertCommentEntry()</code>: Creates<a id="id615" class="indexterm"/> a new<a id="id616" class="indexterm"/> comment</li><li class="listitem" style="list-style-type: disc"><code class="literal">getCommentEntry()</code>: Fetches<a id="id617" class="indexterm"/> the specified<a id="id618" class="indexterm"/> comment</li><li class="listitem" style="list-style-type: disc"><code class="literal">insertTagEntry()</code>: Creates<a id="id619" class="indexterm"/> a new<a id="id620" class="indexterm"/> tag</li><li class="listitem" style="list-style-type: disc"><code class="literal">getTagEntry()</code>: Fetches <a id="id621" class="indexterm"/>the specified<a id="id622" class="indexterm"/> tag</li><li class="listitem" style="list-style-type: disc"><code class="literal">deleteAlbumEntry()</code>: Deletes <a id="id623" class="indexterm"/>the<a id="id624" class="indexterm"/> album</li><li class="listitem" style="list-style-type: disc"><code class="literal">deletePhotoEntry()</code>: Deletes<a id="id625" class="indexterm"/> the<a id="id626" class="indexterm"/> photo</li><li class="listitem" style="list-style-type: disc"><code class="literal">deleteCommentEntry()</code>: Deletes<a id="id627" class="indexterm"/> the<a id="id628" class="indexterm"/> comment</li><li class="listitem" style="list-style-type: disc"><code class="literal">deleteTagEntry()</code>: <a id="id629" class="indexterm"/>Deletes<a id="id630" class="indexterm"/> the tag</li></ul></div><p>In this example we will fetch the user's existing albums and the photos stored inside those albums.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip29"/>Tip</h3><p>Before moving on, ensure that the <code class="literal">ZendGdata</code> library is installed in your application<a id="id631" class="indexterm"/> using Composer. Refer to the following installation instructions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add the following line to the <code class="literal">requires</code> section of <code class="literal">CommunicationApp/composer.json</code>:<div class="informalexample"><pre class="programlisting">"zendframework/zendgdata": "2.*"
</pre></div></li><li class="listitem" style="list-style-type: disc">Update the application dependencies using Composer:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar update</strong></span>
</pre></div></li></ul></div><div class="informalexample"><pre class="programlisting">"zendframework/zendgdata": "2.*"
<span class="strong"><strong>$ php composer.phar update</strong></span>
</pre></div></div></div><p>Before getting started, make sure you have uploaded some photos on your Google Photos account.</p></div></div>
<div class="section" title="Time for action &#x2013; fetching photos from Google Photos"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Time for action – fetching photos from Google Photos</h1></div></div></div><p>Follow <a id="id632" class="indexterm"/>these steps to fetch photos from your Google Photos account:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a method, <code class="literal">getGooglePhotos()</code>, in your controller that will connect to Google<a id="id633" class="indexterm"/> Photos and fetch all albums from Google Photos. This method needs to be placed in the <code class="literal">MediaManagerController</code><a id="id634" class="indexterm"/> file, <code class="literal">src/Users/Controller/MediaManagerController.php</code>.</li><li class="listitem">Set up the API client to make use of the <code class="literal">Curl</code> request with the option to disable <code class="literal">sslverifypeer</code>.<div class="informalexample"><pre class="programlisting">    $adapter = new \Zend\Http\Client\Adapter\Curl();
    $adapter-&gt;setOptions(array(
      'curloptions' =&gt; array(
        CURLOPT_SSL_VERIFYPEER =&gt; false,
      )
    ));
      
    $httpClient = new \ZendGData\HttpClient();
    $httpClient-&gt;setAdapter($adapter);

    $client = \ZendGData\ClientLogin::getHttpClient(
            self::GOOGLE_USER_ID, 
            self::GOOGLE_PASSWORD, 
            \ZendGData\Photos::AUTH_SERVICE_NAME, 
            $httpClient);</pre></div></li><li class="listitem">Now create a new Google Photos client using the API client.<div class="informalexample"><pre class="programlisting">    $gp = new \ZendGData\Photos($client);</pre></div></li><li class="listitem">Now fetch the list of albums using<a id="id635" class="indexterm"/> <code class="literal">getUserFeed()</code> and get the list of images inside<a id="id636" class="indexterm"/> the album using <code class="literal">getAlbumFeed()</code>.<div class="informalexample"><pre class="programlisting">    $userFeed = $gp-&gt;getUserFeed( self::GOOGLE_USER_ID );
    foreach ($userFeed as $userEntry) {
      
      $albumId = $userEntry-&gt;getGphotoId()-&gt;getText();
      $gAlbums[$albumId]['label'] = $userEntry-&gt;getTitle()-&gt;getText();
       
      $query = $gp-&gt;newAlbumQuery();
      $query-&gt;setUser( self::GOOGLE_USER_ID );
      $query-&gt;setAlbumId( $albumId  );
      $albumFeed = $gp-&gt;getAlbumFeed($query);
      foreach ($albumFeed as $photoEntry) {
        $photoId = $photoEntry-&gt;getGphotoId()-&gt;getText();
        if ($photoEntry-&gt;getMediaGroup()-&gt;getContent() != null) {
          $mediaContentArray = $photoEntry-&gt;getMediaGroup()-&gt;getContent();
          $photoUrl = $mediaContentArray[0]-&gt;getUrl();
        }
      
        if ($photoEntry-&gt;getMediaGroup()-&gt;getThumbnail() != null) {
          $mediaThumbnailArray = $photoEntry-&gt;getMediaGroup()-&gt;getThumbnail();
          $thumbUrl = $mediaThumbnailArray[0]-&gt;getUrl();
        }
        
        $albumPhoto = array();
        $albumPhoto['id'] = $photoId;
        $albumPhoto['photoUrl'] = $photoUrl;
        $albumPhoto['thumbUrl'] = $thumbUrl;
        
        $gAlbums[$albumId]['photos'][] =$albumPhoto;   
      }
    }
// Return the consolidated array back to the view for rendering
return $gAlbums;</pre></div></li><li class="listitem">The following<a id="id637" class="indexterm"/> code block in the <code class="literal">album</code> view<a id="id638" class="indexterm"/> is used to render the albums; this can be placed in<a id="id639" class="indexterm"/> the media manager's <code class="literal">index</code> view, <code class="literal">CommunicationApp/module/Users/view/users/media-manager/index.phtml</code>:<div class="informalexample"><pre class="programlisting">    &lt;?php foreach ($googleAlbums as $googleAlbum) : ?&gt;
    &lt;h4&gt; &lt;?php echo $this-&gt;escapeHtml($googleAlbum['label']);?&gt; &lt;/h4&gt;
    &lt;?php foreach ($googleAlbum['photos'] as $googleAlbumPhoto) : ?&gt;
      &lt;div class = "googleAlbumPhoto" style="padding:10px; display:inline"&gt;
        &lt;a href="&lt;?php echo $this-&gt;escapeHtml($googleAlbumPhoto['photoUrl']);?&gt;"&gt;
        &lt;img src="&lt;?php echo $this-&gt;escapeHtml($googleAlbumPhoto['thumbUrl']);?&gt;" /&gt;
        &lt;/a&gt; 
      &lt;/div&gt;
      &lt;?php endforeach; ?&gt;
    &lt;?php endforeach; ?&gt;
    &lt;hr /&gt;</pre></div></li><li class="listitem">Upload pictures to your Google Photos album:<div class="mediaobject"><img src="graphics/1929OS_06_05.jpg" alt="Time for action – fetching photos from Google Photos"/></div></li><li class="listitem">Open<a id="id640" class="indexterm"/> the page in a browser window; you should be able to see all available albums and photos inside the album:<div class="mediaobject"><img src="graphics/1929OS_06_06.jpg" alt="Time for action – fetching photos from Google Photos"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec64"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have <a id="id641" class="indexterm"/>successfully used Google Data APIs to fetch Picasa upload information from Google and used that information to render galleries in our application.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec65"/>Have a go hero</h2></div></div></div><p>Your next task will be to implement the photo upload option using Google Data APIs when viewing a photo in the photo gallery; you will have a button that will allow you to upload the photo to Google Photos.</p></div></div>
<div class="section" title="YouTube Data API"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec62"/>YouTube Data API</h1></div></div></div><p>The YouTube Data API<a id="id642" class="indexterm"/> allows access to YouTube content; you can use this API to fetch videos, playlists, channels, post comments, and upload and manage videos. Users are allowed to perform unauthenticated requests for the retrieval of feeds on popular videos, post comments, and so on.</p><p>Some of the most frequently used YouTube API methods are listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">getVideoFeed()</code>: Retrieve<a id="id643" class="indexterm"/> videos<a id="id644" class="indexterm"/> from a video query</li><li class="listitem" style="list-style-type: disc"><code class="literal">getTopRatedVideoFeed()</code>: Retrieve<a id="id645" class="indexterm"/> top-rated videos for the specific video<a id="id646" class="indexterm"/> query</li><li class="listitem" style="list-style-type: disc"><code class="literal">getUserUploads()</code>: Retrieve <a id="id647" class="indexterm"/>the user's <a id="id648" class="indexterm"/>uploaded videos</li><li class="listitem" style="list-style-type: disc"><code class="literal">getUserFavorites()</code>: Retrieve<a id="id649" class="indexterm"/> the user's<a id="id650" class="indexterm"/> favorite videos</li><li class="listitem" style="list-style-type: disc"><code class="literal">getVideoResponseFeed()</code>: Get <a id="id651" class="indexterm"/>video<a id="id652" class="indexterm"/> responses for a specific video</li><li class="listitem" style="list-style-type: disc"><code class="literal">getVideoCommentFeed()</code>: Get<a id="id653" class="indexterm"/> comments <a id="id654" class="indexterm"/>for a specific video</li><li class="listitem" style="list-style-type: disc"><code class="literal">getPlaylistListFeed()</code>: Get<a id="id655" class="indexterm"/> a <a id="id656" class="indexterm"/>user's playlists</li><li class="listitem" style="list-style-type: disc"><code class="literal">getSubscriptionFeed()</code>: Get<a id="id657" class="indexterm"/> a <a id="id658" class="indexterm"/>user's subscriptions</li><li class="listitem" style="list-style-type: disc"><code class="literal">insertEntry()</code>: Upload<a id="id659" class="indexterm"/> a video<a id="id660" class="indexterm"/> to YouTube</li></ul></div><p>In this example, we will be retrieving videos for a specific keyword and then render them in the web page.</p></div>
<div class="section" title="Time for action &#x2013; listing YouTube videos for a keyword"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Time for action – listing YouTube videos for a keyword</h1></div></div></div><p>Perform the <a id="id661" class="indexterm"/>following steps for listing YouTube videos for a keyword:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create<a id="id662" class="indexterm"/> a function that will get the YouTube videos for the <code class="literal">Zend Framework</code> keyword.</li><li class="listitem">Establish the connection in a similar way to the previous connection made for Google Photos. This needs to be placed in a new method, <code class="literal">getYoutubeVideos()</code><a id="id663" class="indexterm"/>, in the <code class="literal">MediaManagerController</code> <a id="id664" class="indexterm"/>file, <code class="literal">src/Users/Controller/MediaManagerController.php</code>:<div class="informalexample"><pre class="programlisting">  $adapter = new \Zend\Http\Client\Adapter\Curl();
  $adapter-&gt;setOptions(array(
    'curloptions' =&gt; array(
      CURLOPT_SSL_VERIFYPEER =&gt; false,
    )
  ));

  $httpClient = new \ZendGData\HttpClient();
  $httpClient-&gt;setAdapter($adapter);
  
  $client = \ZendGData\ClientLogin::getHttpClient(
    self::GOOGLE_USER_ID,
    self::GOOGLE_PASSWORD,
    \ZendGData\YouTube::AUTH_SERVICE_NAME,
    $httpClient);      </pre></div></li><li class="listitem">Initialize the YouTube client and execute a video query for the keyword <code class="literal">Zend Framework</code>:<div class="informalexample"><pre class="programlisting">  $yt = new \ZendGData\YouTube($client);
  $yt-&gt;setMajorProtocolVersion(2);
  $query = $yt-&gt;newVideoQuery();
  $query-&gt;setOrderBy('relevance');
  $query-&gt;setSafeSearch('none');
  $query-&gt;setVideoQuery('Zend Framework');    </pre></div></li><li class="listitem">Parse the query results and store it in an array:<div class="informalexample"><pre class="programlisting">  $videoFeed = $yt-&gt;getVideoFeed($query-&gt;getQueryUrl(2));
  
  $yVideos = array();
  foreach ($videoFeed as $videoEntry) {
     $yVideo = array();
     $yVideo['videoTitle'] = $videoEntry-&gt;getVideoTitle();
     $yVideo['videoDescription'] = $videoEntry-&gt;getVideoDescription();
     $yVideo['watchPage'] = $videoEntry-&gt;getVideoWatchPageUrl();
     $yVideo['duration'] = $videoEntry-&gt;getVideoDuration();
     $videoThumbnails = $videoEntry-&gt;getVideoThumbnails();
      
     $yVideo['thumbnailUrl'] = $videoThumbnails[0]['url'];
     $yVideos[] = $yVideo;
  }
  return $yVideos;</pre></div></li><li class="listitem">The<a id="id665" class="indexterm"/> resulting content is rendered in the view and a video listing as shown in the following screenshot:<div class="mediaobject"><img src="graphics/1929OS_06_07.jpg" alt="Time for action – listing YouTube videos for a keyword"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec66"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We<a id="id666" class="indexterm"/> have utilized the <code class="literal">ZendGData</code> API's YouTube APIs to retrieve a simple list of videos from YouTube for a specific keyword.</p></div><div class="section" title="Pop quiz – media sharing"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec67"/>Pop quiz – media sharing</h2></div></div></div><p>Q1. Which command is used in Composer to install a newly configured dependency?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">php composer.phar setup</code></li><li class="listitem"><code class="literal">php composer.phar self-update</code></li><li class="listitem"><code class="literal">php composer.phar show</code></li><li class="listitem"><code class="literal">php composer.phar update</code></li></ol></div><p>Q2. Which of the following is a valid method to upload a new photo to Google Photos?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">uploadPhoto()</code></li><li class="listitem"><code class="literal">insertPhoto()</code></li><li class="listitem"><code class="literal">uploadNewPhoto()</code></li><li class="listitem"><code class="literal">insertPhotoEntry()</code></li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Summary</h1></div></div></div><p>In this chapter, we have learned various techniques to manage media; initially we started with implementing our own photo gallery and later on we moved on to using Google GData APIs to retrieve and store media on the Web.</p><p>In our next chapter, we will be working on implementing a simple search interface.</p></div></body></html>