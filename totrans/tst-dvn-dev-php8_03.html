<html><head></head><body>
<div id="_idContainer048">
<h1 class="chapter-number" id="_idParaDest-39"><a id="_idTextAnchor039"/><span class="koboSpan" id="kobo.1.1">3</span></h1>
<h1 id="_idParaDest-40"><a id="_idTextAnchor040"/><span class="koboSpan" id="kobo.2.1">Setting Up Our Development Environment Using Docker Containers</span></h1>
<p><span class="koboSpan" id="kobo.3.1">“</span><em class="italic"><span class="koboSpan" id="kobo.4.1">It works on my machine</span></em><span class="koboSpan" id="kobo.5.1">” is a phrase you’ve probably heard as a software developer; you might even have said it yourself as well. </span><span class="koboSpan" id="kobo.5.2">I’m sure I did! </span><span class="koboSpan" id="kobo.5.3">And to be fair, my colleague Ben Hansen, who was our test automation engineer at that time, also pointed out that he’s also allowed to say, “</span><em class="italic"><span class="koboSpan" id="kobo.6.1">It doesn’t work on my machine</span></em><span class="koboSpan" id="kobo.7.1">” in response to us developers. </span><span class="koboSpan" id="kobo.7.2">As a developer myself, I’ve had my fair share of frustrating experiences caused by running the same PHP application across different environments with inconsistent server setups. </span><span class="koboSpan" id="kobo.7.3">There were times in my career when I struggled to replicate some production environment bugs from my local development machine. </span><span class="koboSpan" id="kobo.7.4">We would find out that the PHP application we were developing would be deployed in staging or production on a different operating system with various libraries installed, which were out of sync with the developers’ development environment setups. </span><span class="koboSpan" id="kobo.7.5">It was </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">a nightmare!</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">When we develop PHP applications, we need to ensure that the applications we develop behave consistently across different deployment environments such as staging or production. </span><span class="koboSpan" id="kobo.9.2">Also, when a new developer joins your team, it’s great if they can set up their local development environments on their development machines easily and quickly. </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">Containers</span></strong><span class="koboSpan" id="kobo.11.1"> can help solve these challenges. </span></p>
<p><span class="koboSpan" id="kobo.12.1">In our example project, we will need a development environment to run our PHP application consistently wherever we deploy it. </span><span class="koboSpan" id="kobo.12.2">If our PHP tests and applications pass and run properly from our local machines, they should also pass and run correctly when we </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">deploy them.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">We will go through the concept of containers and define what they are. </span><span class="koboSpan" id="kobo.14.2">We will learn how to create a Docker image and run Docker containers. </span><span class="koboSpan" id="kobo.14.3">Docker containers will help us easily package our application, making it easy to run our application in other server environments more consistently.  </span></p>
<p><span class="koboSpan" id="kobo.15.1">In this chapter, we will define and cover </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.17.1">What is </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">a container?</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Setting up our PHP </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">development container</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Running </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">Docker containers</span></span></li>
</ul>
<h1 id="_idParaDest-41"><a id="_idTextAnchor041"/><span class="koboSpan" id="kobo.23.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.24.1">This chapter requires you to have access to </span><em class="italic"><span class="koboSpan" id="kobo.25.1">Bash</span></em><span class="koboSpan" id="kobo.26.1">. </span><span class="koboSpan" id="kobo.26.2">If you are using a Mac or Linux OS, you can just use </span><em class="italic"><span class="koboSpan" id="kobo.27.1">terminal</span></em><span class="koboSpan" id="kobo.28.1">. </span><span class="koboSpan" id="kobo.28.2">If you’re on a Windows OS, you will need to install a third-party </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">Bash program.</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">For the instructions defined in this chapter, you can experiment with the complete Docker setup found in </span><a href="B18318_03.xhtml#_idTextAnchor039"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.31.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.32.1"> Git repository </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">at </span></span><a href="https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%203"><span class="No-Break"><span class="koboSpan" id="kobo.34.1">https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%203</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.35.1">.</span></span></p>
<h2 id="_idParaDest-42"><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.36.1">Quick Setup</span></h2>
<p><span class="koboSpan" id="kobo.37.1">To run the complete development setup with Docker containers for this chapter, in a macOS development machine, follow the instructions in this chapter to install Docker Desktop, and then simply run the following command from </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">your terminal:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.39.1">
curl -Lo phptdd.zip "https://github.com/PacktPublishing/Test-Driven-Development-with-PHP-8/tree/main/Chapter%203.zip" &amp;&amp; unzip -o phptdd.zip &amp;&amp; cd complete &amp;&amp; ./demoSetup.sh</span></pre>
<h1 id="_idParaDest-43"><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.40.1">What is a container?</span></h1>
<p><span class="koboSpan" id="kobo.41.1">A container is a </span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.42.1">packaging solution that will contain all the software dependencies that your application needs to run correctly. </span><span class="koboSpan" id="kobo.42.2">Different container platforms are available, but we will be using Docker in this book. </span><span class="koboSpan" id="kobo.42.3">We will be using Docker to build and run our containers for our </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">example project.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">Docker is an open source containerization solution that will enable us to package our PHP solution and run it on different development machines and deployment environments, including</span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.45.1"> our </span><strong class="bold"><span class="koboSpan" id="kobo.46.1">continuous integration (CI) solution</span></strong><span class="koboSpan" id="kobo.47.1">, which will be discussed more in </span><a href="B18318_09.xhtml#_idTextAnchor138"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.48.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.49.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.50.1">Continuous Integration</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.52.1">Now that we have defined what containers are and the containerization solution we will be using for our project, let’s start setting up our </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">development containers.</span></span></p>
<h1 id="_idParaDest-44"><a id="_idTextAnchor044"/><span class="koboSpan" id="kobo.54.1">Setting up our PHP development container</span></h1>
<p><span class="koboSpan" id="kobo.55.1">We will need a</span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.56.1"> development environment for our PHP application. </span><span class="koboSpan" id="kobo.56.2">We will be separating our development environment structure into two main parts: the Docker container (server) and the </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">PHP application.</span></span></p>
<p><span class="koboSpan" id="kobo.58.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">docker</span></strong><span class="koboSpan" id="kobo.60.1"> directory will contain </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">the following:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">Dockerfile</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">docker-compose.yml </span></strong></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.64.1">Server configurations</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.65.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">codebase</span></strong><span class="koboSpan" id="kobo.67.1"> directory will serve as </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.69.1">The root directory for our </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">PHP application</span></span></li>
<li><span class="koboSpan" id="kobo.71.1">Vendor directory for </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">composer packages</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.73.1">Now, let us set up our PHP </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">development container:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.75.1">Create </span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.76.1">the following directory structure in your machine: </span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer042">
<span class="koboSpan" id="kobo.77.1"><img alt="Figure 3.1 – Base tree" src="image/Figure_3.2_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.78.1">Figure 3.1 – Base tree</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.79.1">Run the </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">following commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.81.1">$ mkdir -p ~/phptdd/docker</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.82.1">$ mkdir -p ~/phptdd/codebase</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.83.1">Install </span><strong class="bold"><span class="koboSpan" id="kobo.84.1">Docker Desktop</span></strong><span class="koboSpan" id="kobo.85.1">. </span><span class="koboSpan" id="kobo.85.2">Before </span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.86.1">we create the required Docker files, we will need to download and install Docker Desktop. </span></li>
</ol>
<p><span class="koboSpan" id="kobo.87.1">For </span><strong class="bold"><span class="koboSpan" id="kobo.88.1">macOS</span></strong><span class="koboSpan" id="kobo.89.1"> users, Docker </span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.90.1">can be downloaded from </span><a href="https://docs.docker.com/desktop/mac/install/"><span class="koboSpan" id="kobo.91.1">https://docs.docker.com/desktop/mac/install/</span></a><span class="koboSpan" id="kobo.92.1">. </span></p>
<p><span class="koboSpan" id="kobo.93.1">For </span><strong class="bold"><span class="koboSpan" id="kobo.94.1">Windows</span></strong><span class="koboSpan" id="kobo.95.1"> users, the </span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.96.1">download link </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">is </span></span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">https://docs.docker.com/desktop/windows/install/</span></span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.100.1">Once Docker Desktop has been installed on your macOS machine, we can now organize our </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">development directories.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.102.1">We will need to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">Dockerfile</span></strong><span class="koboSpan" id="kobo.104.1"> within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">phptdd/docker/</span></strong><span class="koboSpan" id="kobo.106.1"> directory. </span><span class="koboSpan" id="kobo.106.2">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">phptdd/docker/Dockerfile</span></strong><span class="koboSpan" id="kobo.108.1"> file, </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">like so:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.110.1">FROM php:8.1.3RC1-apache-buster</span></strong></pre><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.111.1">RUN docker-php-ext-install mysqli pdo pdo_mysql</span></strong></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.112.1">We declare the base Docker image in the first line using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">FROM</span></strong><span class="koboSpan" id="kobo.114.1"> keyword. </span><span class="koboSpan" id="kobo.114.2">Every </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">Dockerfile</span></strong><span class="koboSpan" id="kobo.116.1"> must start with this keyword. </span><span class="koboSpan" id="kobo.116.2">The second line is an instruction to run a command on top of the current image. </span><span class="koboSpan" id="kobo.116.3">Since we will also need a database for our project, we</span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.117.1"> can install the </span><strong class="bold"><span class="koboSpan" id="kobo.118.1">MySQL</span></strong><span class="koboSpan" id="kobo.119.1"> extensions </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">we need.</span></span></p>
<p><span class="koboSpan" id="kobo.121.1">We will need more </span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.122.1">than just PHP for our example project: we will need a database, a web server, and other tools. </span><span class="koboSpan" id="kobo.122.2">Therefore, we need a way to run and organize multiple containers. </span><span class="koboSpan" id="kobo.122.3">Let’s see how to do </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">that next.</span></span></p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor045"/><span class="koboSpan" id="kobo.124.1">Creating multiple containers</span></h2>
<p><span class="koboSpan" id="kobo.125.1">To run </span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.126.1">multiple containers, let’s use the Compose tool that is pre-installed when you install </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">Docker Desktop.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1">phptdd/docker/docker-compose.yml</span></strong><span class="koboSpan" id="kobo.130.1"> file, </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">like so:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.132.1">
version: "3.7"
services:
  # Web Server
  server-web:
    build:
      dockerfile: ./Dockerfile
      context: .
</span><span class="koboSpan" id="kobo.132.2">    restart: always
    volumes:
      - "../codebase/:/var/www/html/"
    ports:
      - "8081:80"
  # MySQL Database
  server-mysql:
    image: mysql:8.0.19
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: mypassword
    volumes:
      - mysql-data:/var/lib/mysql
  # Optional MySQL Management Tool
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:5.0.1
    restart: always
    environment:
      PMA_HOST: server-mysql
      PMA_USER: root
      PMA_PASSWORD: mypassword
    ports:
      - "3333:80"
volumes:
  mysql-data:</span></pre>
<p><span class="koboSpan" id="kobo.133.1">In our </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">docker-compose.yml</span></strong><span class="koboSpan" id="kobo.135.1"> file, we have declared and configured three main containers, which </span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.136.1">are</span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.137.1"> all </span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.138.1">accessible through </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">different ports:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.140.1">Web </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.141.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">server-web</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.144.1">MySQL DB </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.145.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">server-mysql</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.148.1">phpMyAdmin</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">app-phpmyadmin</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.151.1">We were able to install Docker Desktop and create the required </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">Dockerfile</span></strong><span class="koboSpan" id="kobo.153.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">docker-compose.yml</span></strong><span class="koboSpan" id="kobo.155.1"> files that contain the template to build our containers. </span><span class="koboSpan" id="kobo.155.2">Let’s try running all</span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.156.1"> the containers and make sure that they are configured correctly and can communicate with </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">each other.</span></span></p>
<h1 id="_idParaDest-46"><a id="_idTextAnchor046"/><span class="koboSpan" id="kobo.158.1">Running Docker containers</span></h1>
<p><span class="koboSpan" id="kobo.159.1">Now that we have </span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.160.1">the two base Docker files that we need, let’s create an example PHP program that we can use to make sure that our containers are working </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">as expected.</span></span></p>
<p><span class="koboSpan" id="kobo.162.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">phptdd/codebase/index.php</span></strong><span class="koboSpan" id="kobo.164.1"> PHP file, </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">like so:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.166.1">
&lt;?php
$dbHost         = "server-mysql";
$dbUsername     = "root";
$dbPassword     = "mypassword";
$dbName         = "mysql";
try {
    $conn = new PDO("mysql:host=$dbHost;dbname=$dbName", 
        $dbUsername, $dbPassword);
    $conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::
        ERRMODE_EXCEPTION);
    echo "MySQL: Connected successfully";
} catch(PDOException $e) {
    echo "Connection failed: " . </span><span class="koboSpan" id="kobo.166.2">$e-&gt;getMessage();
}
// Show PHP info:
phpinfo();
?&gt;</span></pre>
<p><span class="koboSpan" id="kobo.167.1">At this stage, we have</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.168.1"> created three files and have the following </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">directory structure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.170.1"><img alt="Figure 3.2 – Base files" src="image/Figure_3.3_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.171.1">Figure 3.2 – Base files</span></p>
<p><span class="koboSpan" id="kobo.172.1">Let’s go through this </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">directory structure:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">Dockerfile</span></strong><span class="koboSpan" id="kobo.175.1">: The file where we declared which base Docker image to use and added instructions to install </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">MySQL extensions</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">docker-compose.yml</span></strong><span class="koboSpan" id="kobo.178.1">: The file where we added configurations for the three base containers </span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.179.1">we want to run to serve as our </span><strong class="bold"><span class="koboSpan" id="kobo.180.1">Linux Apache MySQL PHP</span></strong><span class="koboSpan" id="kobo.181.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.182.1">LAMP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">) stack</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">index.php</span></strong><span class="koboSpan" id="kobo.185.1">: The test PHP file we created to test if the PHP application was able to connect to the MySQL container and show some details about the </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">PHP server</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.187.1">Before being able</span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.188.1"> to run our containers, we need to build the main image that we need to run the </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">containers first.</span></span></p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor047"/><span class="koboSpan" id="kobo.190.1">Building a Docker image and running containers</span></h2>
<p><span class="koboSpan" id="kobo.191.1">Run the </span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.192.1">following </span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.193.1">command to download the base image and build our </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">Docker image:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.195.1">
$ cd ~/phptdd/docker
$ docker-compose build</span></pre>
<p><span class="koboSpan" id="kobo.196.1">It will take a few minutes to run on the first try. </span><span class="koboSpan" id="kobo.196.2">The command will pull the base image that we have declared inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">Dockerfile</span></strong><span class="koboSpan" id="kobo.198.1"> from the Docker repository, and it will also execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">RUN</span></strong><span class="koboSpan" id="kobo.200.1"> command we added in the second line of </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">Dockerfile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">Once the build is done, we can run the three containers we have configured by using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">docker-compose.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.206.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.207.1">
$ docker-compose up -d</span></pre>
<p><span class="koboSpan" id="kobo.208.1">After running the command, you should see all three containers </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">being created:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.210.1"><img alt="Figure 3.3 – Containers created" src="image/Figure_3.4_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.211.1">Figure 3.3 – Containers created</span></p>
<p><span class="koboSpan" id="kobo.212.1">Now, let’s see if the containers are running properly; run the </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.214.1">
$ docker ps -a</span></pre>
<p><span class="koboSpan" id="kobo.215.1">You should see the three containers we have created, and the status should indicate that they </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">are running:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.217.1"><img alt="Figure 3.4 – Containers are running" src="image/Figure_3.5_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.218.1">Figure 3.4 – Containers are running</span></p>
<p><span class="koboSpan" id="kobo.219.1">We can see from the list in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.220.1">Figure 3</span></em></span><em class="italic"><span class="koboSpan" id="kobo.221.1">.4</span></em><span class="koboSpan" id="kobo.222.1"> that the containers are running. </span></p>
<p><span class="koboSpan" id="kobo.223.1">Now, let’s try to run the PHP test program we wrote: open a web browser and try to access </span><a href="http://127.0.0.1:8081"><span class="koboSpan" id="kobo.224.1">http://127.0.0.1:8081</span></a><span class="koboSpan" id="kobo.225.1">. </span><span class="koboSpan" id="kobo.225.2">If you check the </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">docker-compose.yml</span></strong><span class="koboSpan" id="kobo.227.1"> file, you will see we have declared that we want to route port </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">8081</span></strong><span class="koboSpan" id="kobo.229.1"> from your host machine to port </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">80</span></strong><span class="koboSpan" id="kobo.231.1"> of the container. </span><span class="koboSpan" id="kobo.231.2">You will also be able to see the port routing for running containers using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">docker ps -</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">a</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.234.1"> command.</span></span></p>
<p><span class="koboSpan" id="kobo.235.1">You </span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.236.1">should </span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.237.1">see a </span><strong class="bold"><span class="koboSpan" id="kobo.238.1">MySQL: Connected Successfully</span></strong><span class="koboSpan" id="kobo.239.1"> message and a standard PHP info output. </span><span class="koboSpan" id="kobo.239.2">This shows that our PHP application running inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">server-web</span></strong><span class="koboSpan" id="kobo.241.1"> container is connected to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">server-mysql</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.243.1"> container:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.244.1"><img alt="Figure 3.5 – Test script: successful PHP to MySQL connection and PHP info" src="image/Figure_3.6_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.245.1">Figure 3.5 – Test script: successful PHP to MySQL connection and PHP info</span></p>
<p><span class="koboSpan" id="kobo.246.1">We have also configured the third container to serve our </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">phpMyAdmin</span></strong><span class="koboSpan" id="kobo.248.1"> application; this is entirely optional. </span><span class="koboSpan" id="kobo.248.2">Using your web browser, go </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">http://127.0.0.1:3333</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.252.1"><img alt="Figure 3.6 – phpMyAdmin screen" src="image/Figure_3.7_B18318.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.253.1">Figure 3.6 – phpMyAdmin screen</span></p>
<p><span class="koboSpan" id="kobo.254.1">You should now see the </span><strong class="bold"><span class="koboSpan" id="kobo.255.1">phpMyAdmin</span></strong><span class="koboSpan" id="kobo.256.1"> main dashboard, with the default databases listed in the left column. </span></p>
<p><span class="koboSpan" id="kobo.257.1">This is all looking good. </span><span class="koboSpan" id="kobo.257.2">The three containers we have configured are running correctly and are able </span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.258.1">to</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.259.1"> communicate and link to each other. </span><span class="koboSpan" id="kobo.259.2">We now have a basic development environment for our PHP application. </span><span class="koboSpan" id="kobo.259.3">Next, let’s try to stop </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">the containers.</span></span></p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor048"/><span class="koboSpan" id="kobo.261.1">Stopping containers </span></h2>
<p><span class="koboSpan" id="kobo.262.1">There are times </span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.263.1">when you need to stop containers, such as when you want to reload new configurations, or if you just want to stop containers that you no </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">longer need.</span></span></p>
<p><span class="koboSpan" id="kobo.265.1">To stop running containers, as well as remove their configurations, run the </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.267.1">
$ docker-compose down</span></pre>
<p><span class="koboSpan" id="kobo.268.1">Now, if you try to check the status of the containers by running </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">docker ps</span></strong><span class="koboSpan" id="kobo.270.1">, you will see that our three containers are gone from the list. </span><span class="koboSpan" id="kobo.270.2">You can also use </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">docker kill &lt;container_name&gt;</span></strong><span class="koboSpan" id="kobo.272.1"> to stop a specific container. </span></p>
<h1 id="_idParaDest-49"><a id="_idTextAnchor049"/><span class="koboSpan" id="kobo.273.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.274.1">In this chapter, we introduced Docker and used it to create and run containers. </span><span class="koboSpan" id="kobo.274.2">Containers are instances of packaged applications. </span><span class="koboSpan" id="kobo.274.3">Although we have seen that containers are packages and isolated, they can also communicate with each other. </span><span class="koboSpan" id="kobo.274.4">For instance, our example PHP program is running inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">server-web</span></strong><span class="koboSpan" id="kobo.276.1"> container and then connects to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">server-mysql</span></strong><span class="koboSpan" id="kobo.278.1"> container that runs our MySQL server. </span></p>
<p><span class="koboSpan" id="kobo.279.1">We’ve seen how simple it is to launch containers. </span><span class="koboSpan" id="kobo.279.2">We have two PHP containers running (</span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">server-web</span></strong><span class="koboSpan" id="kobo.281.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">app-phpmyadmin</span></strong><span class="koboSpan" id="kobo.283.1">) and one database container (</span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">server-mysql</span></strong><span class="koboSpan" id="kobo.285.1">), and we can run more containers if we need to. </span><span class="koboSpan" id="kobo.285.2">We will be using the base containers we have created to build our PHP project; we will continue modifying our containers and will install more libraries and tools as we </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">go along.</span></span></p>
<p><span class="koboSpan" id="kobo.287.1">In the next chapter, we will start building our base PHP application. </span><span class="koboSpan" id="kobo.287.2">We will try to go through the features and reasons why we decided to use PHP in the first place. </span><span class="koboSpan" id="kobo.287.3">We will be installing the </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">Laravel framework</span></strong><span class="koboSpan" id="kobo.289.1"> to simplify the process of writing our solution so that we can focus more on </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">test-driven development</span></strong><span class="koboSpan" id="kobo.291.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.292.1">TDD</span></strong><span class="koboSpan" id="kobo.293.1">) itself and not on writing tons of </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">bootstrap code.</span></span></p>
</div>
</body></html>