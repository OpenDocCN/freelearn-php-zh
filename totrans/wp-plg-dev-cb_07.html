<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Customizing User Data</h1>
                </header>
            
            <article>
                
<p>This chapter will show us how to augment the WordPress user editor and use the additional data associated with users through the following topics:</p>
<ul>
<li class="western"><span>Adding custom fields to the user editor</span></li>
<li class="western">Processing and storing user custom data</li>
<li class="western"><span>Displaying new user data in the user list page</span></li>
<li class="western"><span>Using custom user data in containing shortcode</span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>After learning how to customize the post editor and taxonomies with custom data fields, the next area that we will be making additions to is the user creation and edition tool. This type of addition can be used for many different purposes, including tracking when users have last visited a site or storing additional data on the types of services they are interested in. This chapter expands on the private content plugin that we started in <a href="">Chapter 2</a>, <em>Plugin Framework Basics</em> and <a href="0346c3c6-27ee-45fb-bfd6-df398e04b2b4.xhtml">Chapter 3</a>, <em>User Settings and Administration Pages</em> in the recipes entitled <em>Creating a new enclosing shortcode</em> and <em>Storing stylesheet data in user settings,</em> by adding a second level of content protection that will restrict some posts or pages so that they are only available to paid users.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding custom fields to the user editor</h1>
                </header>
            
            <article>
                
<p>Similar to the taxonomy editor, the user editor allows developers to add extra fields through action hooks and facilitates this task by using the same HTML structure, whether a new user is being created or an existing one is modified. This recipe shows how to assign a callback function to add a new section to the user editor.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p><span>To create a complete plugin with a stylesheet and administration panel, you should have already followed the <em>Storing stylesheet data in user settings</em></span> <span>recipe in <a href="0346c3c6-27ee-45fb-bfd6-df398e04b2b4.xhtml">Chapter 3</a>, <em>User Settings and Administration Pages</em></span>, <span>to have a starting point for this recipe. Alternatively, you can get the resulting code (<kbd>Chapter 3/ch2-private-item-text-edit-stylesheet/ch2-private-item-text.php</kbd></span><span>) from the downloaded code bundle and rename <kbd>ch2-private-item-text-edit-stylesheet</kbd> to <kbd>ch2-private-item-text</kbd>.</span></p>
<p><span>It is also possible to just create a new empty plugin file and follow this chapter's recipes by making a folder called <kbd>ch2-private-item-text</kbd> in your plugin directory with a text file called <kbd>ch2-private-item-text.php</kbd>, and only adding a standard plugin header at the top.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch2-private-item-text</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch2-private-item-text.php</kbd> file in a text editor.</li>
<li>Add the following code snippet at the end of the file to declare a global variable and initialize the variable's content:</li>
</ol>
<pre style="padding-left: 60px">global $user_levels;<br/>$user_levels = array( 'regular' =&gt; 'Regular', 'paid' =&gt; 'Paid' );</pre>
<ol start="4">
<li>Add the following lines of code to register a function to be called when new users are added to the site through the administration interface or when users are edited:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'user_new_form', 'ch2pit_show_user_profile' );<br/>add_action( 'edit_user_profile', 'ch2pit_show_user_profile' );</pre>
<ol start="5">
<li>Add the following block of code to provide an implementation for the <kbd>ch2pit_show_user_profile</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_show_user_profile( $user ) {<br/>    global $user_levels;<br/>    if ( 'add-new-user' == $user ) {<br/>        $current_user_level = '';<br/>    } elseif ( !empty( $user ) &amp;&amp; isset( $user-&gt;data-&gt;ID ) ) {<br/>        $user_id = $user-&gt;data-&gt;ID;<br/>        $current_user_level =<br/>            get_user_meta( $user_id, 'user_level', true );<br/>    } ?&gt; <br/><br/>    &lt;h3&gt;Site membership level&lt;/h3&gt;<br/>    &lt;table class="form-table"&gt;<br/>        &lt;tr&gt;<br/>            &lt;th&gt;Level&lt;/th&gt;<br/>            &lt;td&gt;&lt;select name="user_level" id="user_level"&gt;<br/>            &lt;?php foreach( $user_levels as <br/>                           $user_level_index =&gt; $user_level ) { ?&gt;<br/>            &lt;option value="&lt;?php echo $user_level_index; ?&gt;"<br/>            &lt;?php selected( $current_user_level,<br/>                            $user_level_index ); ?&gt;&gt;<br/>            &lt;?php echo $user_level; ?&gt;&lt;/option&gt;<br/>            &lt;?php } ?&gt;<br/>            &lt;/select&gt;&lt;/td&gt;<br/>        &lt;/tr&gt;<br/>    &lt;/table&gt; <br/>&lt;?php }</pre>
<ol start="6">
<li>Save and close the plugin file.</li>
<li>Go to the <span class="packt_screen">Plugins</span> section of the administration interface and make sure that the <kbd>Chapter 2 - Private Item Text</kbd> plugin is activated.</li>
<li>Select the <span class="packt_screen">Add New User</span> menu item under the <span class="packt_screen">Users</span> section to view the user creation page and see the new <span class="packt_screen">Site membership level</span> section at the bottom of the form:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="133" width="317" class="image-border" src="assets/717c062c-5d9b-4a21-87da-0ff870e3a66c.png"/></div>
<ol start="9">
<li>Edit one of the existing users on the site to see that the additional section is also displayed. If you try to save the user in either situation, the newly added field will not be saved until you perform the steps in the next recipe.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>user_new_form</kbd> and <kbd>edit_user_profile</kbd> action hooks allow developers to add content to the user editor when a new user is added to the site and when users are edited, respectively.</p>
<div class="packt_infobox packt_tip">WordPress offers a third action hook called <kbd>show_user_profile</kbd>. Functions associated with that hook get called when users view their own profile. You should carefully consider whether or not it makes sense to register a function with this action hook, depending on the nature of your plugin and the additional information to be stored. That being said, if you do not register any function with this hook, as we are doing in this recipe, you will not see the additional fields created when viewing your own user profile on the site, even if you are the administrator. You will still be able to see paid content, since we will display it to users with administrator privileges.</div>
<p>Our callback function first checks to see whether it received a valid user through the <kbd>$user</kbd> parameter or whether a new user is being created. Based on the result, it retrieves the associated user level data by calling the <kbd>get_user_meta</kbd> function or initializes a blank variable. The syntax of <kbd>get_user_meta</kbd> follows the same structure as the <kbd>get_post_meta</kbd> and <kbd>get_term_meta</kbd> functions, with the first parameter being used to specify the user ID and the remaining fields indicating the field name to be retrieved and whether data should be returned as a single variable or an array:</p>
<pre>get_user_meta( $user_id, $field_name, $single );</pre>
<p>The rest of our callback functions are responsible for rendering a basic HTML select list and selecting one of the items in the list based on the current user membership level.</p>
<p>The only additional element that we put in place in this recipe is the declaration of an array of user membership levels as a <kbd>global</kbd> variable that we will be referencing in multiple functions in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Storing stylesheet data in user settings</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Processing and storing user custom data</h1>
                </header>
            
            <article>
                
<p>As user profiles are created or updated, WordPress offers an easy way to register a callback to save custom user data in the site's database. This recipe shows how to use this action hook.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p><span>You should have already followed the <em>Adding custom fields to the user editor</em></span> <span>recipe to have a starting point for this recipe and the resulting plugin should still be active in your development site. Alternatively, you can get the resulting code (<kbd>Chapter 7/ch2-private-item-text/ch2-private-item-text-v3.php</kbd></span><span>) from the downloaded code bundle, renaming it as <kbd>ch2-private-item-text.php</kbd>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch2-private-item-text</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch2-private-item-text.php</kbd> file in a text editor.</li>
<li>Add the following lines of code at the end of the file to register functions to be called when user data is stored upon initial creation or when a user is updated:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'user_register', 'ch2pit_save_user_data' );<br/>add_action( 'profile_update', 'ch2pit_save_user_data' );</pre>
<ol start="4">
<li>Add the following block of code to provide an implementation for the <kbd>ch2pit_save_user_data</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_save_user_data( $user_id ) {<br/>    global $user_levels;<br/>    if ( isset( $_POST['user_level'] ) &amp;&amp;<br/>         !empty( $_POST['user_level'] ) &amp;&amp;<br/>         array_key_exists( $_POST['user_level'], <br/>                           $user_levels ) ) {<br/>        update_user_meta( $user_id, 'user_level',<br/>                          $_POST['user_level'] );<br/>    } else {<br/>        update_user_meta( $user_id, 'user_level', 'regular' );<br/>    }<br/>}</pre>
<ol start="5">
<li>Save and close the plugin file.</li>
<li>Edit one of the existing users on the site or create a new one to see that the user level value is saved.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Similarly to adding fields to the user editor, WordPress offers two different action hooks to register functions that will be called when a user is initially registered (<kbd>user_register</kbd>) and when a user profile is updated (<kbd>profile_update</kbd>). As you can see, we are registering the same callback function in both cases, where we check to see whether we received a value indicating the desired user level and use the <kbd>update_user_meta</kbd> function to save it. Similar to the post and term meta update functions, this function has three parameters to indicate the user ID that the information should be associated with, the name of the custom data field, and the value to be stored:</p>
<pre>update_user_meta( $user_id, $field_name, $single );</pre>
<p>As an additional precaution, we check to see whether the value we received is present in our global array of user levels using the PHP <kbd>array_key_exists</kbd> function.</p>
<p>The <kbd>else</kbd> branch of the <kbd>if</kbd> statement is put in place to set a default user level if the field is absent, which can happen if the site allows visitors to register for accounts by themselves.</p>
<p>Of course, this current process of classifying users as regular users or paid users is very manual, requiring site administrators to log in to the site's dashboard and update their status individually. A more elaborate solution could be to set the value of this field based on receiving a payment to the site using an online payment service.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span>The <em>Adding custom fields to the user editor</em></span> <span><span>recipe</span></span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Displaying new user data in user list page</h1>
                </header>
            
            <article>
                
<p>As new fields are added to user profiles, it can be very useful for site administrators to see this data in the site user list and be able to filter users to see only the ones that were assigned certain values. This recipe shows how to add extra columns to the user listing of the WordPress administration area and how to add a filter function to reduce the number of records shown.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Processing and storing user custom data</em> recipe to have a starting point for this recipe and the resulting plugin should still be active in your development site. Alternatively, you can get the resulting code (<kbd>Chapter 7/ch2-private-item-text/ch2-private-item-text-v4.php</kbd>) from the downloaded code bundle, renaming it <kbd>ch2-private-item-text.php</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch2-private-item-text</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch2-private-item-text.php</kbd> file in a text editor.</li>
<li>Add the following line of code to register a function to be called when WordPress is preparing the list of columns to be displayed in the user listing page:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'manage_users_columns', 'ch2pit_add_user_columns' );</pre>
<ol start="4">
<li>Add an implementation for the <kbd>ch2pit_add_user_columns</kbd> function with the following block of code:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_add_user_columns( $columns ) {<br/>    $new_columns = array_slice( $columns, 0, 2, true ) +<br/>                   array( 'level' =&gt; 'User Level' ) +<br/>                   array_slice( $columns, 2, NULL, true );<br/>    return $new_columns;<br/>}</pre>
<ol start="5">
<li>Add the following line of code to assign a function to be called when WordPress prepares the content of each column as it displays a list of all the users:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'manage_users_custom_column', <br/>            'ch2pit_display_user_columns_data', 10, 3 );</pre>
<ol start="6">
<li>Provide an implementation for the <kbd>ch2pit_display_user_columns_data</kbd> function by inserting the following code section:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_display_user_columns_data( $val, $column_name,<br/>                                           $user_id ) {<br/>    global $user_levels;<br/>    if ( 'level' == $column_name ) {<br/>        $current_user_level = get_user_meta( $user_id, <br/>                                             'user_level', true );<br/>        if ( !empty( $current_user_level ) ) {<br/>            $val = $user_levels[$current_user_level];<br/>        }<br/>    }<br/>    return $val;<br/>}</pre>
<ol start="7">
<li>Add the following code snippet to register a function to be called when WordPress prepares the list of quick actions that can be performed by administrators on the user listing page:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'restrict_manage_users', 'ch2pit_add_user_filter' );</pre>
<ol start="8">
<li>Add this code section to provide a body for the <kbd>ch2pit_add_user_filter</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_add_user_filter() {<br/>    global $user_levels;<br/>    $filter_value = '';<br/>    if ( isset( $_GET['user_level'] ) ) {<br/>        $filter_value = $_GET['user_level'];<br/>    } ?&gt;<br/> <br/>    &lt;select name="user_level" class="user_level" <br/>            style="float:none;"&gt;<br/>    &lt;option value=""&gt;No filter&lt;/option&gt;<br/>    &lt;?php foreach( $user_levels as<br/>                       $user_level_index =&gt; $user_level ) { ?&gt;<br/>        &lt;option value="&lt;?php echo $user_level_index; ?&gt;" <br/>        &lt;?php selected( $filter_value, $user_level_index ); ?&gt;&gt;<br/>        &lt;?php echo $user_level; ?&gt;&lt;/option&gt;<br/>    &lt;?php } ?&gt;<br/>    &lt;input type="submit" class="button" value="Filter"&gt;<br/>&lt;?php }</pre>
<ol start="9">
<li>Add the following line of code to register a function to be called when WordPress is rendering the footer of the administration pages:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'admin_footer', 'ch2pit_user_filter_js' );</pre>
<ol start="10">
<li>Provide an implementation for the <kbd>ch2pit_user_filter_js</kbd> function by adding the following code section:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_user_filter_js() {<br/>    global $current_screen;<br/>    if ( 'users' != $current_screen-&gt;id ) {<br/>        return;<br/>    } ?&gt;<br/> <br/>    &lt;script type="text/javascript"&gt;<br/>        jQuery( document ).ready( function() {<br/>            jQuery( '.user_level' ).first().change( function() {<br/>                jQuery( '.user_level' ).<br/>                    last().val( jQuery( this ).val() );<br/>            });<br/><br/>            jQuery( '.user_level' ).last().change( function() {<br/>                jQuery( '.user_level' ).<br/>                    first().val( jQuery( this ).val() );<br/>            });<br/>        });<br/>    &lt;/script&gt;<br/>&lt;?php }</pre>
<ol start="11">
<li>Add this line of code to register a function that will be executed when WordPress is preparing the query to retrieve the list of users from the database:</li>
</ol>
<pre style="padding-left: 60px">add_filter( 'pre_get_users', 'ch2pit_filter_users' );</pre>
<ol start="12">
<li>Insert the following block of code to define the <kbd>ch2pit_filter_users</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_filter_users( $query ) {<br/>    global $pagenow;<br/>    global $user_levels;<br/><br/>    if ( is_admin() &amp;&amp; 'users.php' == $pagenow &amp;&amp; <br/>         isset( $_GET['user_level'] ) ) {<br/>        $filter_value = $_GET['user_level'];<br/>        if ( !empty( $filter_value ) &amp;&amp; <br/>             array_key_exists( $_GET['user_level'], <br/>                               $user_levels ) ) {<br/>            $query-&gt;set( 'meta_key', 'user_level' );<br/>            $query-&gt;set( 'meta_query', array(<br/>                         array( 'key' =&gt; 'user_level',<br/>                                'value' =&gt; $filter_value ) ) );<br/>        } <br/>    }<br/>}</pre>
<ol start="13">
<li>Save and close the plugin file.</li>
<li>Visit the <span class="packt_screen">Users</span> section of the administration interface to see the new <span class="packt_screen">User Level</span> column.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="154" width="721" class="image-border" src="assets/baf5e7bb-3131-475b-8b85-47bc8b1cc42a.png"/></div>
<ol start="15">
<li>Use the filter drop-down list and click on <span class="packt_screen">Filter</span> to limit the number of records displayed.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The first code section in this recipe is a filter function that gets a list of all columns that the system intends on displaying in the users section of the administration interface. While we could have just added our new entry at the end of the array, similar to what we did in the <em>Displaying additional columns in the custom post list page</em> recipe in <a href="6298bc2b-19d5-4e3a-833c-3c4b667b22e5.xhtml" target="_blank">Chapter 4</a>, <em>The Power of Custom Post Types</em>, we take a more advanced approach in this recipe; we use the PHP <kbd>array_slice</kbd> function to split the columns array into two sections and insert our new column name between the existing items.</p>
<p>We continue this recipe by providing a function that displays the user level assigned to each user. This is done by simply retrieving the information based on the current user ID and returning the data to be displayed. It should be noted that the user management page takes an approach that is slightly different from the post and pages custom column content, since it uses a filter function where we return data instead of using an action hook that directly sends content to the browser.</p>
<p>The next code section is responsible for rendering a drop-down list of user levels that can be used to filter the user list; this is done by using standard HTML and code to loop through the list of user levels and display them. Unfortunately, WordPress complicates things by calling our function twice, before and after listing users, resulting in two drop-down lists on the same page with no way to differentiate them. To avoid having issues with the two drop-down lists being set to different values and sending these conflicting values to our filtering code, the next function places Javascript code in the page footer of all the user listing pages. This allows us to synchronize either drop-down list with the other's value when the user interacts with them.</p>
<p>Our last step consists of modifying the user query if we find a filtering argument in the page URL when displaying the user listing. If an argument is found and the page is the correct one, we will check whether the value is part of our user levels array and then add it to the system's current query variables.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Processing and storing user custom data</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using custom user data in containing shortcode</h1>
                </header>
            
            <article>
                
<p>Now that we have additional data stored in user profiles and have facilitated the viewing of this information in the administration pages, the only missing component to achieve our goal of restricting some site content to paid users is to introduce a new enclosing shortcode that will check a user's level before displaying content. The recipe will show how to create this new shortcode.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p><span>You should have already followed the <em>Display new user data in user list page</em></span> <span>recipe to have a starting point for this recipe and the resulting plugin should still be active in your development site. Alternatively, you can get the resulting code (<kbd>Chapter 7/ch2-private-item-text/ch2-private-item-text-v5.php</kbd>)</span> <span>from the <a href="3a74e0e8-c6b8-4641-a7d2-badf67c6f1f2.xhtml" target="_blank">Chapter 7</a>, <em>Customizing User Data</em> section of the downloaded code bundle, renaming it as</span> <kbd>ch2-private-item-text.php</kbd><span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch2-private-item-text</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch2-private-item-text.php</kbd> file in a text editor.</li>
<li>Add the following line of code to define a new shortcode and define the function to be called when it is used:</li>
</ol>
<pre style="padding-left: 60px">add_shortcode( 'paid', 'ch2pit_paid_shortcode' );</pre>
<ol start="4">
<li>Provide an implementation for <kbd>ch2pit_paid_shortcode</kbd> with the following code section:</li>
</ol>
<pre style="padding-left: 60px">function ch2pit_paid_shortcode( $atts, $content = null ) {<br/>    if ( is_user_logged_in() ) {<br/>        $current_user = wp_get_current_user();<br/>        $current_user_level = get_user_meta( $current_user-&gt;ID, <br/>                                             'user_level', true );<br/>        if ( 'paid' == $current_user_level ||  <br/>             current_user_can( 'activate_plugins' ) ) {<br/>            return '&lt;div class="paid"&gt;' . $content . '&lt;/div&gt;';<br/>        }<br/>    }<br/>    $output = '&lt;div class="register"&gt;';<br/>    $output .= 'You need to be a paid member to access ';<br/>    $output .= 'this content.&lt;/div&gt;';<br/>    return $output; <br/>}</pre>
<ol start="5">
<li>Save and close the plugin file.</li>
<li>Create a new post and wrap some or all of the content with the <kbd>[paid]</kbd> and <kbd>[/paid]</kbd> tags. View the page as an administrator, a visitor who is not logged in, a registered regular user, and a registered paid user to validate that the content is only displayed in the first and last cases.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="144" width="398" class="image-border" src="assets/4cb4cf44-1383-4b87-a8eb-6a3a0851a413.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Similar to the <kbd>[private]</kbd> shortcode that we created back in the <em>Creating a new enclosing shortcode</em> recipe in <a href="f7395811-9e4a-4913-8a02-cc68875d0071.xhtml" target="_blank">Chapter 2</a>, <em>Plugin Framework Basics</em>, the new <kbd>[paid]</kbd> shortcode that this recipe puts in place can be used by content creators to identify one or more sections of a post or page that can only be viewed by users whose user level is set as a paid member.</p>
<p>To do this, our shortcode implementation first checks whether the visitor is logged in. If that is the case, it further validates the user by asking WordPress to provide data on the current user, then uses the user ID to retrieve the <kbd>user_level</kbd> metadata that we stored in the previous recipes in this chapter. Alternatively, it checks if the user is a site administrator by using the <kbd>current_user_can</kbd> WordPress function and specifying <kbd>'activate_plugins'</kbd> as the argument, since only administrators can perform this action. If all of these conditions are met, the enclosed post content will be displayed. Otherwise, a message will be shown to indicate that users must be paid members to see this content.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Display new user data in user list page</em> recipe</li>
</ul>


            </article>

            
        </section>
    </body></html>