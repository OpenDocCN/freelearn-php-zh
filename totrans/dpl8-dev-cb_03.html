<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Displaying Content through Views</h1>
                </header>
            
            <article>
                
<p>This chapter will cover the Views module and how to use a variety of its major features. In this chapter, we will cover the following recipes:</p>
<ul>
<li>Listing content</li>
<li>Editing the default admin interfaces</li>
<li>Creating a block from a View</li>
<li>Utilizing dynamic arguments</li>
<li>Adding a relationship in a View</li>
<li>Providing an Entity Reference result View</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>For those who have used Drupal previously, Views is in core for Drupal 8. If you are new to Drupal, note that Views has been one of the most used contributed projects for Drupal 6 and Drupal 7.</p>
<p>Briefly described, Views is a visual query builder that allows you to pull content from the database and render it in multiple formats. Select administrative areas and content listings provided out of the box by Drupal are all powered by Views. We'll dive into how to use Views to customize the administrative interface, customize ways to display your content, and interact with the entity reference field.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing content</h1>
                </header>
            
            <article>
                
<p>Views does one thing, and it does it well--listing content. The power behind the Views module is the amount of configurable power it gives the end user to display content in various forms.</p>
<p>This recipe will cover creating a content listing and linking it in the main menu. We will use the <kbd>Article</kbd> content type provided by the standard installation and make an article's landing page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>The <strong>Views UI</strong> module must be installed to manipulate Views from the user interface. By default, this is enabled with the standard installation profile.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Let's list the Views listing content:</p>
<ol>
<li>Go to <span class="packt_screen">Structure</span> and then <span class="packt_screen">Views</span>, as shown in the following screenshot; this will bring you to the administrative overview of all the views that have been created:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="278" width="560" class="image-border" src="assets/17b25f88-a4a0-455e-8138-9e248898c692.png"/></div>
<ol start="2">
<li>Click on <span class="packt_screen">Add view</span> to create a new view.</li>
<li>The first step is to provide the <span class="packt_screen">View name</span> of articles, which will serve as the administrative and (by default) displayed title.</li>
<li>Next, we will modify the <span class="packt_screen">VIEW SETTINGS</span>. We want to display <span class="packt_screen">Content</span> of the type <kbd>Article</kbd> and leave the <span class="packt_screen">tagged with</span> field empty. This will force the view to only show content of the <kbd>Article</kbd> content type.</li>
<li>Check the <span class="packt_screen">Create a page</span> option. The <span class="packt_screen">Page title</span> and <span class="packt_screen">Path</span> will be autopopulated based on the view name and can be modified as desired. For now, leave the display and other settings at their default values:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/30ed2460-fc3c-4ff5-8bb1-23c474d7d0d5.png"/></div>
<ol start="6">
<li>Click on <span class="packt_screen">Save and edit</span> to continue modifying your new view.</li>
<li>In the middle column, under the <span class="packt_screen">PAGE SETTINGS</span> section, we will change the <span class="packt_screen">Menu item</span> settings. Click on <span class="packt_screen">No menu</span> to change the default.</li>
</ol>
<p> </p>
<ol start="8">
<li>Select <span class="packt_screen">Normal menu entry</span>. Provide a menu link title and an optional description. Set <span class="packt_screen">Parent</span> to <span class="packt_screen">&lt;Main Navigation&gt;</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img style="text-align: center;color: #333333;font-size: 1em" height="320" width="584" class="image-border" src="assets/e91c5b3c-4763-4af8-86f8-bfb802065cc3.png"/></div>
<ol start="9">
<li>Click on <span class="packt_screen">Apply</span> at the bottom of the form.</li>
<li>Click on <span class="packt_screen">Save</span> to save your view.</li>
<li>Once your view is saved, click on <span class="packt_screen">Back to site</span> from the administrative menu. You will now see the link in your Drupal site's main menu.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The first step to create a view involves selecting the type of data you will be displaying. This is referred to as the base table, which can be any type of entity or data specifically exposed to Views.</p>
<div class="packt_infobox">Nodes are labeled as <strong>Content</strong> in Views, and you will find <span>this interchanged terminology</span> throughout Drupal.</div>
<p>When creating a Views page, we add a menu path that can be accessed. It tells Drupal to invoke Views to render the page, which will load the view you create and render it.</p>
<p>There are display <kbd>style</kbd> and <kbd>row</kbd> plugins that format the data to be rendered. Our recipe used the unformatted list style to wrap each row in a simple <kbd>div</kbd> element. We could have changed this to a table for a formatted list. The row display controls how each row is outputted.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The Views module has been one of the must-use modules since it first debuted, to the point that almost every Drupal 7 site used this module. In the following section, we will dive further into Views.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Views in Drupal core initiative</h1>
                </header>
            
            <article>
                
<p>The Views module has been a contributed module up until Drupal 8. In fact, it was one of the most used modules. Although the module is now part of Drupal core, it still has many improvements that are needed, and are being committed.</p>
<p>Through their 8.1, 8.2, and 8.3 <span>releases</span>, there have been many improvements. We will continue to see this pattern with each future minor release.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Views and displays</h1>
                </header>
            
            <article>
                
<p>When working with Views, you will see some different terminologies. One of the key items to be grasped is what a display is. A view can contain multiple displays. Each display is of a certain type. Views comes with the following display types:</p>
<ul>
<li><strong>Attachment</strong>: This is a display that becomes attached to another display in the same view</li>
<li><strong>Block</strong>: This allows you to place the view as a block</li>
<li><strong>Embed</strong>: The display is meant to be embedded programmatically</li>
<li><strong>Entity Reference</strong>: This allows Views to provide results for an entity reference field</li>
<li><strong>Feed</strong>: This display returns a XML-based feed and can be attached to another display to render a feed icon</li>
<li><strong>Page</strong>: This allows you to display the view from a specific route</li>
</ul>
<p>Each display can have its own configuration, too. However, each display will share the same base table (content, files, and so on). This allows you to take the same data and represent it in different ways.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Format style plugins - style and row</h1>
                </header>
            
            <article>
                
<p>Within Views, there are two types of style plugins that represent how your data is displayed: style and row:</p>
<ul>
<li>The <strong>style</strong> plugin represents the overall format</li>
<li>The <strong>row</strong> plugin represents each result row's format</li>
</ul>
<p>For example, the <kbd>grid</kbd> style will output multiple <kbd>div</kbd> elements with specified classes to create a responsive <kbd>grid</kbd>. At the same time, the <kbd>table</kbd> style creates a tabular output with labels used as table headings.</p>
<p>Row plugins define how to render the row. The default content will render the entity as defined by its selected display mode. If you choose <span class="packt_screen">Fields</span>, you can manually select which fields to include in your view.</p>
<p>Each format style plugin has a corresponding <kbd>Twig</kbd> file that the theme layer uses. Refer to the <span><em>Twig templating</em> recipe of</span> <a href="991ad206-3a73-4c3a-b6b7-c680a0a74a53.xhtml"><em>Chapter 5</em></a>, <em>Frontend for the Win</em> to learn more about Twig in Drupal 8.</p>
<p>You can define new plugins in custom modules or use contributed modules to access different options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Embed display</h1>
                </header>
            
            <article>
                
<p>Each of the available display types has a method to expose itself through the user interface, except for Embed. Often, contributed and custom modules use Views to render displays instead of manually writing queries and rendering the output. Drupal 8 provides a special display type to simplify this.</p>
<p>If we were to add an Embed display to the view created in the recipe, we could pass the following render array to output our view programmatically:</p>
<pre>$view_render = [ 
  '#type' =&gt; 'view', 
  '#name' =&gt; 'articles', 
  '#display_id' =&gt; 'embed_1', 
]; </pre>
<p>When rendered, the <kbd>#type</kbd> key tells Drupal that this is a view element. We then point it to our new display <kbd>embed_1</kbd>. The Embed display type has no special functionality, in fact, it is a simplistic display plugin. The benefit is that it does not have additional operations conducted for the sake of performance.</p>
<p>Using an Embed display is beneficial when you want to use a View in a custom page, block, or even form. For example, Drupal Commerce uses this pattern for its shopping cart block and the order summary in the checkout. A view is used to display the order information within a custom block and form.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Refer to the VDC initiative at <a href="https://www.drupal.org/community-initiatives/drupal-core/vdc"><span class="URLPACKT">https://www.drupal.org/community-initiatives/drupal-core/vdc</span></a>.</li>
<li><span class="ChapterrefPACKT"><span>Refer to</span> <a href="3994173f-3d31-4f01-b808-99e01368564b.xhtml"><em>Chapter 7</em></a></span>, <em>Plug and Play with Plugins</em>, to learn more about plugins.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Editing the default admin interfaces</h1>
                </header>
            
            <article>
                
<p>With the addition of Views in Drupal core, many of the administrative interfaces are powered by Views. This allows customization of default admin interfaces to enhance site management and content authoring experiences.</p>
<div class="packt_infobox">In Drupal 6 and 7, there was the Administrative Views contributed module, which provided a way to override administrative pages with Views. This module is no longer required, as the functionality comes with Drupal core out of the box.</div>
<p>In this recipe, we will modify the default content overview form that is used to find and edit content. We will add the ability to filter content by the user who authored it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol start="1">
<li>Go to <span class="packt_screen">Structure</span> and then <span class="packt_screen">Views</span>. This will bring you to the administrative overview of all existing views.</li>
<li>From the <span class="packt_screen">Enabled</span> section, select the <span class="packt_screen">Edit</span> option from the operations column for the <span class="packt_screen">Content</span> view. This is the view displayed on <kbd>/admin/content</kbd> when managing content.</li>
</ol>
<p> </p>
<ol start="3">
<li>To filter by the content author, we must add a <span class="packt_screen">FILTER CRITERIA</span> to our view, where we will expose the following for users to modify:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="127" width="322" class="image-border" src="assets/48fb308c-2061-4b8f-a2ed-45ea404cc44b.png"/></div>
<ol start="4">
<li>Click on <span class="packt_screen">Add</span> in the <span class="packt_screen">FILTER CRITERIA</span> section to add a new filter. In the search textbox, type <span class="packt_screen">Authored by</span> to search the available options. Select <span class="packt_screen">A</span><span class="packt_screen">uthored by</span> for the <span class="packt_screen">Content</span> category. Click on <span class="packt_screen">Add and configure filter criteria</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/5cfdd734-81a1-43fc-ba87-a1e5df3011c0.png"/></div>
<ol start="5">
<li>Check the <span class="packt_screen">Expose this filter to visitors</span> <span class="packt_screen">to allow them to change it</span> checkbox. This will allow users to modify the data for the filter.</li>
</ol>
<p> </p>
<ol start="6">
<li>You may modify the <span class="packt_screen">Label</span> and add a <span class="packt_screen">Description</span> to improve the usability of the filter option for your use case.</li>
<li>Click on <span class="packt_screen">Apply</span> once more to finish configuring the filter. It will now show up in the list of filter criteria. You will also see the new filter in the preview below the form.</li>
<li>Click on <span class="packt_screen">Save</span> to commit all changes to the view.</li>
<li>Take a look at <kbd>/admin/content</kbd>, and you will have your filter. Content editors will be able to search for content authored by a user through autocompleted username searches:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/298a6694-4ed4-4e67-89ae-aea0288d12f8.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>When a view is created that has a path matching an existing route, it will override it and present itself. That is how the <kbd>/admin/content</kbd> and other administrative pages are able to be powered by Views.</p>
<div class="packt_infobox">If you were to disable the Views module, you can still manage content and users. The default forms are tables that do not provide filters or other extra features.</div>
<p>Drupal uses the overridden route and uses Views to render the page. From that point on, the page is handled like any other Views page would be rendered.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We will dive into additional features available through Views that can enhance the way you use Views and present them on your Drupal site.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Exposed versus non-exposed</h1>
                </header>
            
            <article>
                
<p>Filters allow you to narrow the scope of the data displayed in a view. Filters can either be exposed or not; by default, a filter is not exposed. An example would be using the <span class="packt_screen">Content: Publishing status</span> set to <span class="packt_screen">Yes (published)</span> to ensure that a view always contains published content. This is an item you would configure to display content to site visitors. However, if it were for an administrative display, you may want to expose that filter. This way, content editors can view, easily, what content has not been published yet or been unpublished.</p>
<p>All filter and sort criteria can be marked as exposed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Filter identifiers</h1>
                </header>
            
            <article>
                
<p>Exposed filters work by parsing query parameters in the URL. For instance, on the content management form, changing the <kbd>Type</kbd> filter will add <kbd>type=Article</kbd>, among others to the current URL.</p>
<p>With this recipe, the author filter would show up as <span class="packt_screen">uid</span> in the URL. Exposed filters have a<br/>
<span class="packt_screen">Filter identifier</span> option that can change the URL component:</p>
<div class="CDPAlignCenter CDPAlign"><img height="69" width="436" class="image-border" src="assets/20463777-4e06-45ef-b4f7-0b1556142cf7.png"/></div>
<p>This could be changed to <kbd>author</kbd> or some other value to enhance the user experience behind the URL, or mask the Drupal-ness of it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Overriding routes with Views</h1>
                </header>
            
            <article>
                
<p>Views can replace administrative pages with enhanced versions due to the way the route and module system works in Drupal. Modules are executed in order of the module's weight or alphabetical order if weights are the same. Naturally, in the English alphabet, the letter <em>V</em> comes toward the end of the alphabet. That means any route that Views provides will be added toward the end of the route discovery cycle.</p>
<p>If a view is created and it provides a route path, it will override any that exist on that path. There is no collision checking mechanism (and there was not one present in Views before merging into Drupal core) that prevents this.</p>
<p>This allows you to easily customize most existing routes, but, beware that you could easily have conflicting routes, and Views will normally override the other.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a block from a View</h1>
                </header>
            
            <article>
                
<p>Previous recipes have shown how to create and manipulate a page created by a view. Views provides different display types that can be created, such as a block. In this recipe, we will create a block powered by Views. The Views block will list all Tag taxonomy terms that have been added to the <kbd>Article</kbd> content type.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>This recipe assumes that you have installed the standard installation profile and have the default node content types available for use.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Go to <span class="packt_screen">Structure</span> and then <span class="packt_screen">Views</span>. This will bring you to the administrative overview of all the views that are created.</li>
<li>Click on <span class="packt_screen">Add view</span> to create a new view.</li>
<li>The first step is to provide the View name of <span class="packt_screen">Tags</span>, which will serve as the administrative and (by default) displayed title.</li>
</ol>
<p> </p>
<ol start="4">
<li>Next, we will modify the <span class="packt_screen">VIEW SETTINGS</span>. We want to display <span class="packt_screen">Taxonomy terms</span> of the type <span class="packt_screen">Tags</span>. This will make the view default to only displaying taxonomy terms created under the <span class="packt_screen">Tags</span> vocabulary.</li>
<li>Check the <span class="packt_screen">Create a block</span> checkbox in the <span class="packt_screen">BLOCK SETTINGS</span> section.</li>
<li>Select the <span class="packt_screen">HTML List</span> option from the <span class="packt_screen">Display</span> <span class="packt_screen">format</span> choices. Leave the style as <span class="packt_screen">Fields</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/ab2627b8-ca4e-4313-8622-92438f51f138.png"/></div>
<ol start="7">
<li>Click on <span class="packt_screen">Save and edit</span> to create the view.</li>
<li>We want to display all the available tags. Under the <span class="packt_screen">PAGER</span> section, click on the field next to <span class="packt_screen">Use Pager</span> and select <span class="packt_screen">Display all items</span> and click on <span class="packt_screen">Apply</span>.</li>
</ol>
<p> </p>
<ol start="9">
<li>Next, we will sort the view by tag name instead of order of creation. Click on <span class="packt_screen">Add</span> on the <span class="packt_screen">SORT CRITERIA</span> section.Select the checkbox where <span class="packt_screen">Name</span> : <span class="packt_screen">Taxonomy term</span> and click on <span class="packt_screen">Add and configure sort criteria</span> to use the default, that is, ascending. Click on <span class="packt_screen">Apply</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/e5ba86c9-5461-4924-a973-1cd5918eed60.png"/></div>
<ol start="10">
<li>Click on <span class="packt_screen">Save</span> to save the view.</li>
<li>Go to <span class="packt_screen">Structure</span> and <span class="packt_screen">Block layout</span> to place the block on your Drupal site. Click on <span class="packt_screen">Place block</span> for the <span class="packt_screen">Sidebar first</span> region in the <span class="packt_screen">Bartik</span> theme.</li>
<li>Filter the list by typing your view's name (<kbd>Tags</kbd>). Click on <span class="packt_screen">Place block</span> to add your view's block to the block layout.</li>
<li>Finally, click on <span class="packt_screen">Save</span> <span class="packt_screen">block</span> to commit your changes.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>In the Drupal 8 plugin system, there is a concept called Derivatives. Plugins are small pieces of swappable functionality within Drupal 8. Plugins and plugin development are covered in <span class="ChapterrefPACKT"><a href="3994173f-3d31-4f01-b808-99e01368564b.xhtml"><em>Chapter 7</em></a>, <em>Plug and Play with Plugins</em></span>. A derivative allows a module to present multiple variations of a plugin dynamically. In the case of Views, it allows the module to provide variations of a <kbd>ViewsBlock</kbd> plugin for each view that has a block display. Views implements the <kbd>\Drupal\views\Plugin\Block\ViewsBlock\ViewsBlock</kbd> class, providing the base for the dynamic availability of these blocks. Each derived block is an instance of this class.</p>
<p>When Drupal initiates the block, Views passes the proper configuration required. The view is then executed and the display is rendered whenever the block is displayed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We will now explore some of the other ways in which Views interacts with blocks.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Exposed forms as blocks</h1>
                </header>
            
            <article>
                
<p>If your view utilizes exposed filters, you have the option to place the exposed form in a block. With this option enabled, you may place the block anywhere on the page, even pages not for your view.</p>
<p>An example of using an exposed form in a block is for a search result view. You will add an exposed filter for keywords that control the search results. With the exposed filters in a block, you can easily place it in your site's header. When an exposed filter block is submitted, it will direct users to your view's display.</p>
<p>To enable the exposed filters as a block, you must first expand the <span class="packt_screen">Advanced</span> section on the right side of the Views edit form. Click on the <span class="packt_screen">Exposed form in block</span> option from the <span class="packt_screen">Advanced</span> section. In the options modal that opens, select the <span class="packt_screen">Yes</span> radio button, and click on <span class="packt_screen">Apply</span>. You can <span>then</span> place the block from the <span class="packt_screen">Block layout</span> form:</p>
<div class="CDPAlignCenter CDPAlign"><img height="173" width="642" class="image-border" src="assets/59c6d702-44b6-4d89-bd44-718dd7510e01.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ChapterrefPACKT">Refer to <a href="3994173f-3d31-4f01-b808-99e01368564b.xhtml"><em>Chapter 7</em></a>, <em>Plug and Play with Plugins</em></span>, to learn more about derivatives</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Utilizing dynamic arguments</h1>
                </header>
            
            <article>
                
<p>Views can be configured to accept <strong>contextual filters</strong>. Contextual filters allow you to provide a dynamic argument that modifies the view's output. The value is expected to be passed from the URL; however, if it is not present, there are ways to provide a default value.</p>
<p>In this recipe, we will create a new page called <kbd>My Content</kbd>, which will display a user's authored content on the <kbd>/user/%/content</kbd> <span>route.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Go to <span class="packt_screen">Structure</span> and then <span class="packt_screen">Views</span>. This will bring you to the administrative overview of all the views created. Click on <span class="packt_screen">Add view</span> to create a new view.</li>
<li>Set the <span class="packt_screen">View name</span> to <span class="packt_screen">My Content</span>.</li>
<li>Next, we will modify the <span class="packt_screen">View</span> settings. We want to display <span class="packt_screen">Content of the type All</span> and leave the <span class="packt_screen">Tagged</span> with empty. This will allow all content to be displayed.</li>
</ol>
<p> </p>
<ol start="4">
<li>Select <span class="packt_screen">Create</span> <span class="packt_screen">a page</span>. Keep the page title the same. We will need to change the path to <kbd>user/%user/content</kbd>. Click on <span class="packt_screen">Save and edit</span> to move to the next screen and add the contextual filter.</li>
</ol>
<div class="packt_infobox">When building a views page, adding a percent sign to the path identifies a route variable. By adding an entity type's name, Drupal will match the input as an identifier to an entity of that type.</div>
<ol start="5">
<li>Toggle the <span class="packt_screen">Advanced</span> portion of the form on the right-hand side of the page. Click on <span class="packt_screen">Add</span> in the <span class="packt_screen">Contextual filters</span> section.</li>
<li>Select <span class="packt_screen">Authored by: Content</span> and then click on <span class="packt_screen">Add and configure contextual filters</span>.</li>
<li>Change the default value of <span class="packt_screen">WHEN THE FILTER VALUE IS <em>NOT</em> IN THE URL</span> to <span class="packt_screen">Display "Access Denied"</span> to prevent all content from being displayed with a bad route value:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/b6b8c9ed-d4b7-4df9-b355-1b1ad1ef1d55.png"/></div>
<ol start="8">
<li>Click on <span class="packt_screen">Apply</span> and then click on <span class="packt_screen">Save</span> to save the view.</li>
<li>Go to <kbd>/user/1/content</kbd>, and you will see content created by the first user.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Contextual filters mimic the route variables found in the Drupal routing system. Variables are represented by percentage signs as placeholders in the view's path. Views will match up each placeholder with contextual filters by order of their placement. This allows you to have multiple contextual filters; you just need to ensure that they are ordered properly.</p>
<p>The Views module is aware of how to handle the placeholder because the type of data is selected when you add the filter. Once the contextual filter is added, there are extra options available for handling the route variable.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We will now explore the extra options available when using contextual filters.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Previewing with contextual filters</h1>
                </header>
            
            <article>
                
<p>You are still able to preview a view from the edit form. You simply add the contextual filter values to the text form concatenated by a forward slash (<kbd>/</kbd>). In this recipe, you could<br/>
replace navigating to <kbd>/user/1/content</kbd> with simply inputting <kbd>1</kbd> into the preview form and updating the preview.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Displaying as a tab on the user page</h1>
                </header>
            
            <article>
                
<p>Even though the view created in the recipe follows a route under <kbd>/user</kbd>, it will not show up as a local task tab until it has a menu entry defined.</p>
<p>Go back and edit the <span class="packt_screen">My Content</span> view. From the <span class="packt_screen">Page settings</span> section, you will need to change <span class="packt_screen">No menu</span> from the <span class="packt_screen">Menu</span> option. Clicking on that link will open the menu link settings dialog.</p>
<p>Select <span class="packt_screen">Menu tab</span> and provide a <span class="packt_screen">Menu link title</span>, such as <span class="packt_screen">My Content</span>. Select <span class="packt_screen">&lt;User account menu&gt;</span> for the <span class="packt_screen">Parent</span>. Click on <span class="packt_screen">Apply</span> and save your view. When you go to the <kbd>/user</kbd> page again, it will have the <span class="packt_screen">My Content</span> page available.</p>
<div class="packt_tip">You may need to rebuild Drupal's caches in order for the routing system to be rebuilt, making Drupal aware of the menu tab.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Altering the page title</h1>
                </header>
            
            <article>
                
<p>With contextual filters, you have the ability to manipulate the current page's title. When adding or editing a contextual filter, you can modify the page title. <span>You may check the</span> <span class="packt_screen">Override title</span> <span>option</span> in <span class="packt_screen">When the filter value is present in the URL</span> <span class="packt_screen">or a <span class="packt_screen"><span class="packt_screen">default</span></span></span> <span class="packt_screen">is provided</span> section.</p>
<p>This textbox allows you to enter in a new title that will be displayed. Additionally, you can use the information passed from the route context using the format of <kbd>%#</kbd>, where <kbd>#</kbd> is the argument order.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Validation</h1>
                </header>
            
            <article>
                
<p>Contextual filters can have validation attached. Without specifying extra validation, Views will take the expected argument and try to make it <em>just work</em>. You can add validation to help limit this scope and filter out invalid route variables.</p>
<p>You can enable validation by checking <span class="packt_screen">Specify validation criteria</span> from the <span class="packt_screen">When the filter value is present in the URL or a default is provided</span> section. The default is set to <span class="packt_screen">Basic Validation</span>, which allows you to specify how the view should react if the data is invalid; based on our recipe, this would be if the user is not found.</p>
<p>The list of <span class="packt_screen">Validator</span> options is not filtered by the contextual filter item you selected, so some may not apply. For our recipe, one might want <span class="packt_screen">User ID</span> and select the <span class="packt_screen">Validate user has access to the <em>User</em></span>. This validator would make sure that the current user is able to view the route's user's profile. Additionally, it can be restricted further based on its role:</p>
<div class="CDPAlignCenter CDPAlign"><img height="217" width="444" class="image-border" src="assets/00213ac7-0123-44b5-9a34-ef43aa6edb25.png"/></div>
<p>This gives you more granular control over how the view operates when using contextual filters for route arguments.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Multiple and exclusion</h1>
                </header>
            
            <article>
                
<p>You may also configure the contextual filter to allow <kbd>AND</kbd> or <kbd>OR</kbd> operations along with exclusion. These options are under the <span class="packt_screen">More</span> section when adding or editing a contextual filter.</p>
<p>The <span class="packt_screen">Allow multiple values</span> option can be checked to enable <kbd>AND</kbd> or <kbd>OR</kbd> operations. If the contextual filter argument contains a series of values concatenated by plus (<kbd>+</kbd>) signs, it acts as an <kbd>OR</kbd> operation. If the values are concatenated by commas (<kbd>,</kbd>) it acts as an <kbd>AND</kbd> operation.</p>
<p>When the <span class="packt_screen">Exclude</span> option is checked, the value will be excluded from the results rather than the view being limited by it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a relationship in a View</h1>
                </header>
            
            <article>
                
<p>As stated at the beginning of the chapter, Views is a visual query builder. When you first create a view, a base table is specified from which to pull data. Views automatically knows how to join tables for field data, such as body text or custom-attached fields.</p>
<p>When using an entity reference field, you can display the value as the raw identifier, the referenced entity's label, or the entire rendered entity. However, if you add a relationship based on a reference field, you will have access to display any of that entity's available fields.</p>
<p>In this recipe, we will update the Files view, used for administering files, to display the username of the user who uploaded the file.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Got to <span class="packt_screen">Structure</span> and then <span class="packt_screen">Views</span>. This will bring you to the administrative overview of all the views that have been created</li>
<li>Find the <span class="packt_screen">Files</span> view and click on <span class="packt_screen">Edit</span>.</li>
</ol>
<p> </p>
<ol start="3">
<li>Click on <span class="packt_screen">Advanced</span> to expand the section and then click on <span class="packt_screen">Add</span> that is next to <span class="packt_screen">Relationships</span>.</li>
<li>Search for <span class="packt_screen">user</span>. Select the <span class="packt_screen">User who uploaded</span> relationship option and click on <span class="packt_screen">Apply (this display):</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/2db21e32-514a-4203-a6e3-43cf5c55c7da.png"/></div>
<ol start="5">
<li>Next, we will be presented with a configuration form for the relationship. Click on <span class="packt_screen">Apply (this display)</span> to use the defaults.</li>
<li>Add a new field by clicking on <span class="packt_screen">Add</span> in the <span class="packt_screen">Fields</span> section.</li>
<li>Search for <span class="packt_screen">name</span> and select the <span class="packt_screen">Name: User</span> field and, click on <span class="packt_screen">Apply (all display)</span>.</li>
<li>This view uses aggregation, which presents a new configuration form when you first add a field. Click on <span class="packt_screen">Apply and continue</span> to use the defaults.</li>
</ol>
<div class="packt_infobox">We will discuss Views and aggregation in the <em>There's more...</em> section <span>of this recipe</span>.</div>
<ol start="9">
<li>We will use the default field settings that will provide the label <span class="packt_screen">Name</span> and format it as the username and link to the user's profile. Click on <span class="packt_screen">Apply (this display).</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/5a59ff8f-241a-48c7-bcb8-15d46501a728.png"/></div>
<ol start="10">
<li>Click on <span class="packt_screen">Save</span> to finish editing the view and commit your changes.</li>
</ol>
<p> </p>
<ol start="11">
<li>When viewing the <span class="packt_screen">Files</span> list in <kbd>/admin/content/files</kbd>, the username that uploaded the file will now be displayed:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/41305fde-09c3-4f24-a263-460316587ab1.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Drupal stores data in a normalized format. Database normalization, in short, involves the organization of data in specifically related tables. Each entity type has its own database table, and all fields have their own database table. When you create a view and specify what kind of data will be shown, you are specifying a base table in the database that Views will query. Views will automatically associate fields that belong to the entity and it's relationship to those tables for you.</p>
<p>When an entity has an entity reference field, you can add a relationship to the referenced entity type's table. This is an explicit definition, whereas fields are implicit. When the relationship is explicitly defined, all the referenced entity type's fields come into scope. The fields on the referenced entity type can then be displayed, filtered, and sorted.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Using relationships in Views allows you to create some powerful displays. We will discuss aggregation and additional information about relationships.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Relationships provided by entity reference fields</h1>
                </header>
            
            <article>
                
<p>The Views module uses a series of hooks to retrieve data that it then uses to represent ways to interact with the database. One of these is the <kbd>hook_field_views_data</kbd> hook, which processes a field storage configuration entity and registers its data with Views. The Views module implements this on behalf of the Drupal core to add relationships and reverse relationship, for Entity reference fields.</p>
<p>Since Entity reference fields have set schema information, Views can dynamically generate these relationships by understanding the field's table name, destination entity's table name, and the destination entity's identifier column.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Relationships provided through custom code</h1>
                </header>
            
            <article>
                
<p>There are times where you will need to define a relation on your own with custom code. Typically, when working with custom data in Drupal, you would more than likely create a new entity type; this topic is covered in <a href="b2659986-a8dc-4503-a043-6071ab7b6722.xhtml"><em><span class="ChapterrefPACKT">Chapter 9</span></em></a>, <em>Configuration Management - Deploying in Drupal 8</em>. This is not always the case, however, and you may just need a simple method of storing data. An example can be found in the Database Logging module. The Database Logging module defines a schema for a database table and then uses <kbd>hook_views_data</kbd> to expose its database table to Views.</p>
<p>The <kbd>dblog_schema</kbd> hook implementation returns a <kbd>uid</kbd> column on the watchdog database table created by the module. That column is then exposed to Views using the following definition:</p>
<pre>  $data['watchdog']['uid'] = array( 
    'title' =&gt; t('UID'), 
    'help' =&gt; t('The user ID of the user on which the log entry <br/>       was written..'), 
    'field' =&gt; array( 
      'id' =&gt; 'numeric', 
    ), 
    'filter' =&gt; array( 
      'id' =&gt; 'numeric', 
    ), 
    'argument' =&gt; array( 
      'id' =&gt; 'numeric', 
    ), 
    'relationship' =&gt; array( 
      'title' =&gt; t('User'), 
      'help' =&gt; t('The user on which the log entry as written.'), 
      'base' =&gt; 'users', 
      'base field' =&gt; 'uid', 
      'id' =&gt; 'standard', 
    ), 
  ); </pre>
<p>This array tells Views that the <kbd>watchdog</kbd> table has a column named <kbd>uid</kbd>. It is numeric in nature for its display, filtering capabilities, and sorting capabilities. The <kbd>relationship</kbd><br/>
key is an array of information that instructs Views how to use this to provide a relationship (<kbd>LEFT JOIN</kbd>) on the <kbd>users</kbd> table. The <kbd>User</kbd> entity uses the <kbd>users</kbd> table and has the primary key of <kbd>uid</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using aggregation and views.</h1>
                </header>
            
            <article>
                
<p>There is a view setting under the <span class="packt_screen">Advanced</span> section that allows you to enable aggregation.<br/>
This feature allows you to enable the usage of SQL aggregate functions, such as <kbd>MIN</kbd>, <kbd>MAX</kbd>, <kbd>SUM</kbd>, <kbd>AVG</kbd>, and <kbd>COUNT</kbd>. In this recipe, the Files view uses aggregation to sum the usage counts of each file on the Drupal site.</p>
<p>Aggregation settings are set for each field, and when enabled, they have their own link to configure these settings:</p>
<div class="CDPAlignCenter CDPAlign"><img height="170" width="257" class="image-border" src="assets/1afe7dec-0b03-4960-8afd-5b5909f5e0fb.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Providing an Entity Reference result View</h1>
                </header>
            
            <article>
                
<p>The Entity reference field, covered in <a href="953ad256-0342-45c8-84d9-5cda80d2d099.xhtml"><em><span class="ChapterrefPACKT">Chapter 2</span></em></a>, <em>The Content Authoring Experience</em>, can utilize a custom view for providing the available field values. The default entity reference field will display all available entities of the type it can reference. The only available filter is based on the entity bundle, such as only returning <kbd>Article</kbd> nodes. Using an entity reference view, you can provide more filters, such as only returning the content that your user has authored.</p>
<p>In this recipe, we will create an entity reference view that filters content by the author. We will add the field to the user account form, allowing users to select their favorite contributed content.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Go to <span class="packt_screen">Structure</span> and then <span class="packt_screen">Views</span>. This will bring you to the administrative overview of all the views that have been created. Click on <span class="packt_screen">Add view</span> to create a new view.</li>
<li>Set the <span class="packt_screen">View name</span> to <span class="packt_screen">My Content Reference View</span>, and retain the current <span class="packt_screen">View settings</span> configuration.</li>
<li>Do not choose to create a page or block. Click on <span class="packt_screen">Save and edit</span> to continue working on your view.</li>
<li>Click on the <span class="packt_screen">Add</span> button to create a new display. Select the <span class="packt_screen">Entity Reference</span> option to create the display:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/21b255ab-9329-4014-9ab6-9256db61bc7c.png"/></div>
<ol start="5">
<li>The <span class="packt_screen">Format</span> will be automatically set to <span class="packt_screen">Entity Reference List</span>, which utilizes fields. Click on <span class="packt_screen">Settings</span> next to it to modify the style format.</li>
<li>For <span class="packt_screen">Search Fields</span>, check the <span class="packt_screen">Content: Title</span> option and then click on <span class="packt_screen">Apply</span>. This is what the field will perform the autocomplete search on.</li>
<li>You will need to modify the <span class="packt_screen">Content: Title</span> field to stop it from wrapping the result as a link. Click on the field label and uncheck <span class="packt_screen">Link to the Content</span>. Click on <span class="packt_screen">Apply</span> to save the field settings:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/963ae57c-96a3-432a-8f2b-cf27921827fa.png"/></div>
<ol start="8">
<li>We will then use a contextual filter to limit the results to the currently loggedin user. Click on <span class="packt_screen">Add</span> from <span class="packt_screen">Contextual Filters</span> in the <span class="packt_screen">Advanced</span> section.</li>
<li>Select the <span class="packt_screen">Authored by: Content</span> option and click on <span class="packt_screen">Add and configure contextual filters</span>.</li>
<li>Change the <span class="packt_screen">When the filter value is not available</span> setting to <span class="packt_screen">Provide a default value</span>. Select <span class="packt_screen">User ID from the logged in user</span> for the type value. Click on <span class="packt_screen">Apply</span> to configure the contextual filter.</li>
<li>Click on <span class="packt_screen">Save</span> to save the view.</li>
<li>Go to <span class="packt_screen">Configuration</span> and then <span class="packt_screen">Account settings</span> to be able to manage fields on user accounts.</li>
</ol>
<p> </p>
<ol start="13">
<li>Add a new <span class="packt_screen">Entity Reference</span> field that references <span class="packt_screen">Content</span>, call it Highlighted Contributions, and allow it to have unlimited values. Click on the <span class="packt_screen">Save field settings</span> button.</li>
<li>Change the <span class="packt_screen">Reference type</span> method to use <span class="packt_screen">View: Filter by an entity reference view</span> and select the view we have just created:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="212" width="550" class="image-border" src="assets/378d90f3-c07c-4bcb-82e4-60c58f92f1a0.png"/></div>
<ol start="15">
<li>Now, when a user edits their account, they can reference only content that they have created in this reference field.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The entity reference field definition provides selection plugins. The Views module provides an entity reference selection plugin. This allows entity reference to gather data into a view to receive available results.</p>
<p>The display type for Views requires you to select which fields will be used to search against when using the autocomplete widget. If you are not using the autocomplete widget and instead use the select list or checkboxes and radio buttons, then it will return the view's entire results.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ChapterrefPACKT">Refer to <a href="3994173f-3d31-4f01-b808-99e01368564b.xhtml"><em>Chapter 7</em></a>, <em>Plug and Play with Plugins</em></span>, to learn more about plugins</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    </body></html>