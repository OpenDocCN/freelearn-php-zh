- en: '17'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '17'
- en: Working with Moodle Admin Tools
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Moodle 管理工具
- en: Moodle ships with several administration tools that have not been allocated
    to a particular topic; some are not even directly accessible via the familiar
    admin web interface.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 预装了几个未分配给特定主题的管理工具；其中一些甚至不能通过熟悉的行政网页界面直接访问。
- en: '![Figure 17.1 – Moodle admin tools ](img/Figure_17.01_B18779.jpg)'
  id: totrans-3
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.1 – Moodle 管理工具](img/Figure_17.01_B18779.jpg)'
- en: Figure 17.1 – Moodle admin tools
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.1 – Moodle 管理工具
- en: 'We have grouped the admin tools into the following categories, each presented
    in a separate section:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将管理工具分为以下类别，每个类别都在单独的章节中介绍：
- en: '**Site admin presets**: Presets allow you to create backups of site settings
    that can be rolled back in case something goes wrong.'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**站点管理员预设**：预设允许您创建站点设置的备份，以便在出现问题时可以回滚。'
- en: '**Database tools**: These tools let you apply specific database actions. In
    addition to the tools part of Moodle core, we will cover a useful external tool
    called **Adminer** that lets you manage the underlying database directly from
    within Moodle.'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据库工具**：这些工具允许您应用特定的数据库操作。除了 Moodle 核心部分的部分工具外，我们还将介绍一个有用的外部工具 **Adminer**，它允许您直接从
    Moodle 内部管理底层数据库。'
- en: '**Command Line Interface (CLI)**: The CLI is a built-in mechanism that allows
    us to automate administrative processes via the command line or shell scripts.'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**命令行界面 (CLI)**：CLI 是一个内置机制，允许我们通过命令行或 shell 脚本来自动化管理过程。'
- en: '**Moosh**: A powerful alternative to the CLI, Moosh is the third-party Moodle
    Shell. We will learn how Moosh works and provide some practical examples.'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moosh**：CLI 的强大替代品，Moosh 是第三方 Moodle Shell。我们将学习 Moosh 的工作原理并提供一些实际示例。'
- en: Before we cover these admin tools in detail, let’s explore how they are organized
    in Moodle.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们详细介绍这些管理工具之前，让我们探索它们在 Moodle 中的组织方式。
- en: Exploring Moodle admin tools
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索 Moodle 管理工具
- en: 'Moodle’s classification of what constitutes an admin tool is a little vague.
    When you navigate to **Site administration** | **Plugins** | **Admin tools** |
    **Manage admin tools**, a long list of plugins is shown:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 对构成管理工具的分类有些模糊。当您导航到 **站点管理** | **插件** | **管理工具** | **管理管理工具** 时，会显示一个长长的插件列表：
- en: '![Figure 17.2 – Moodle admin tools ](img/Figure_17.02_B18779.jpg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.2 – Moodle 管理工具](img/Figure_17.02_B18779.jpg)'
- en: Figure 17.2 – Moodle admin tools
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.2 – Moodle 管理工具
- en: 'We can group admin tools into the following categories:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将管理工具分为以下类别：
- en: '**Conversion tools**: These tools are usually only applied once to migrate
    a feature from an old state to its current counterpart. Examples are the **HTTPS
    conversion tool** (see [*Chapter 13*](B18779_13.xhtml#_idTextAnchor251), *Ensuring
    Moodle Security*) and **Multilang upgrade** (see [*Chapter 10*](B18779_10.xhtml#_idTextAnchor204),
    *Configuring* *Technical Features*).'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**转换工具**：这些工具通常只应用一次，用于将功能从旧状态迁移到当前状态。例如，**HTTPS 转换工具**（见 [*第 13 章*](B18779_13.xhtml#_idTextAnchor251)
    的 *确保 Moodle 安全性*）和 **多语言升级**（见 [*第 10 章*](B18779_10.xhtml#_idTextAnchor204) 的
    *配置技术功能*）。'
- en: '**Database tools**: These are tools to work with Moodle’s underlying database.
    We have dedicated an entire section to database tools in this chapter.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据库工具**：这些工具用于与 Moodle 的底层数据库进行工作。在本章中，我们专门用一节来介绍数据库工具。'
- en: '**Development tools**: These tools are aimed at Moodle programmers – for instance,
    **Acceptance testing** (Behat), **PHPUnit tests**, and the **XMLDB****editor**.
    You came across a development tool in [*Chapter 15*](B18779_15.xhtml#_idTextAnchor289),
    *Optimizing Moodle Performance*, when we dealt with profiling and used the course
    generator. We are not going to deal with development tools here.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开发工具**：这些工具针对 Moodle 程序员——例如，**验收测试**（Behat）、**PHPUnit 测试**和 **XMLDB 编辑器**。您在
    [*第 15 章*](B18779_15.xhtml#_idTextAnchor289) 的 *优化 Moodle 性能* 中遇到了开发工具，当时我们处理了性能分析并使用了课程生成器。我们在这里不会处理开发工具。'
- en: '**Design tools**: These tools are aimed at theme designers – for example, the
    **Template library** or the **UI component library**. We are not going to deal
    with design tools, either.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**设计工具**：这些工具针对主题设计师——例如，**模板库**或**UI 组件库**。我们也不会处理设计工具。'
- en: '**Standard Moodle features**: Some admin features have been implemented as
    admin tools, such as the recycling bin, learning plans, or the task scheduler.
    This way, they could be uninstalled from Moodle if not needed, though this is
    not recommended.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标准 Moodle 功能**：一些管理功能已作为管理工具实现，例如回收站、学习计划或任务调度器。这样，如果不需要，它们可以从 Moodle 中卸载，尽管这不被推荐。'
- en: 'Many tools of the first four categories are hidden from the Moodle admin web
    interface and can only be accessed by calling them directly via the URL: `<yoursite>/admin/tool/<tool>`.
    All core admin tools are located in subdirectories in `$CFG->dirroot/admin/tool`.
    For details of mostly non-standard admin tools, refer to [docs.moodle.org/en/Admin_tools](http://docs.moodle.org/en/Admin_tools).'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 前四个类别的许多工具在Moodle管理员网络界面中是隐藏的，只能通过直接通过URL调用它们来访问：`<yoursite>/admin/tool/<tool>`。所有核心管理工具都位于`$CFG->dirroot/admin/tool`的子目录中。有关大多数非标准管理工具的详细信息，请参阅[docs.moodle.org/en/Admin_tools](http://docs.moodle.org/en/Admin_tools)。
- en: We are not covering any admin tools classified as standard Moodle features,
    since they are either dealt with elsewhere in the book or are irrelevant in the
    administrator context. However, one exception are site admin presets, the only
    feature that does not belong to any category in the site administration menu.
    So, let’s get started with our first admin tool.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不涵盖任何被归类为标准Moodle功能的行政工具，因为它们要么在本书的其他地方有所涉及，要么在管理员环境中不相关。然而，有一个例外是网站管理员预设，这是唯一不属于网站管理菜单任何类别的功能。因此，让我们从我们的第一个管理工具开始。
- en: Site admin presets
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网站管理员预设
- en: 'Presets allow you to create backups of site settings that can then be restored.
    There are several use cases where this facility comes in handy:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 预设允许您创建网站设置的备份，然后可以恢复。有几个用例中，这个功能非常有用：
- en: Experimenting with a set of system settings and rolling back in case they didn’t
    work
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尝试一组系统设置，并在它们不起作用时回滚
- en: Applying the same set of configurations to multiple sites
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将相同的配置集应用于多个网站
- en: Migrating one Moodle site’s settings to another – for instance, your test instance
    to your production system
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将一个Moodle网站的设置迁移到另一个网站 – 例如，您的测试实例到您的生产系统
- en: 'The workflow of Moodle admin presets is illustrated in the following diagram
    – a straightforward but very powerful tool:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle管理员预设的工作流程如下所示 – 一个简单但非常强大的工具：
- en: '![Figure 17.3 – Site admin presets workflow ](img/Figure_17.03_B18779.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图17.3 – 网站管理员预设工作流程](img/Figure_17.03_B18779.jpg)'
- en: Figure 17.3 – Site admin presets workflow
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.3 – 网站管理员预设工作流程
- en: You find the **Site admin presets** tool in the **General** section of the **Site
    administration** area. It is the only Moodle feature that has not been placed
    in a menu category, hence its coverage in this chapter.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在**网站管理**区域的**常规**部分找到**网站管理员预设**工具。这是唯一没有被放置在菜单类别的Moodle功能，因此在本章中对其进行了介绍。
- en: Moodle ships with two preconfigured presets that have been labelled **Starter**
    and **Full**. Details about its content are provided in the respective descriptions,
    as shown in the following screenshot, which contains a third preset that we will
    create in this section.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle附带两个预配置的预设，分别标记为**入门**和**完整**。其内容的详细信息在相应的描述中提供，如下面的截图所示，其中包含我们将在此部分创建的第三个预设。
- en: '![Figure 17.4 – Site admin presets ](img/Figure_17.04_B18779.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图17.4 – 网站管理员预设](img/Figure_17.04_B18779.jpg)'
- en: Figure 17.4 – Site admin presets
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.4 – 网站管理员预设
- en: 'To make your first preset, click the **Create preset** button, and then you
    have to provide a name, an optional description, and an author, which is pre-populated
    with your name:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建您的第一个预设，请点击**创建预设**按钮，然后您必须提供一个名称、可选的描述和一个作者，该作者预先填写了您的姓名：
- en: '![Figure 17.5 – Creating a site admin preset ](img/Figure_17.05_B18779.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![图17.5 – 创建网站管理员预设](img/Figure_17.05_B18779.jpg)'
- en: Figure 17.5 – Creating a site admin preset
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.5 – 创建网站管理员预设
- en: The **Include settings with passwords** option will add any sensitive information
    – passwords, keys, and IPs – of your site to the preset, so ensure that this will
    only be applied internally. You can view and modify the list of fields to be excluded
    in the **Settings with password** field in **Site administration** | **General**
    | **Security** | **Site** **security settings**.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**包含带密码的设置**选项将把您网站的任何敏感信息（密码、密钥和IP）添加到预设中，因此请确保这只会应用于内部。您可以在**网站管理** | **常规**
    | **安全** | **网站** **安全设置**中的**带密码的设置**字段中查看和修改要排除的字段列表。'
- en: 'Once the preset has been created, it will appear in the list alongside the
    two default presets. The following actions are available for each preset:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 创建预设后，它将出现在列表中，与两个默认预设并列。每个预设都可用以下操作：
- en: '**Review settings and apply**: Details about the preset are shown, which include
    information on who created the preset (author), when (date and time), where (site
    URL), and on which Moodle version. As soon as you apply the admin preset, any
    site settings that differ from the preset will be applied, as shown in the following
    list of setting changes.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**审查设置并应用**：预设的详细信息显示，包括有关创建预设的人（作者）、何时（日期和时间）、在哪里（站点 URL）以及哪个 Moodle 版本的信息。一旦应用管理员预设，任何与预设不同的站点设置都将应用，如下列设置更改列表所示。'
- en: '![Figure 17.6 – Applying a site admin preset ](img/Figure_17.06_B18779.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.6 – 应用站点管理员预设](img/Figure_17.06_B18779.jpg)'
- en: Figure 17.6 – Applying a site admin preset
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.6 – 应用站点管理员预设
- en: '**Download**: Moodle exports the settings as an XML file. You can load an exported
    file via the **Import** **preset** button.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**下载**：Moodle 将设置导出为 XML 文件。您可以通过 **导入** **预设** 按钮加载已导出的文件。'
- en: '**Delete**: Remove the preset permanently. The two default presets cannot be
    deleted.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**删除**：永久删除预设。两个默认预设不能被删除。'
- en: '**Show version history**: If you change your mind after applying a preset,
    you can undo the setting changes via this action.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**显示版本历史**：如果您在应用预设后改变主意，可以通过此操作撤销设置更改。'
- en: Site admin presets is a powerful tool during setup, maintenance, and when experimenting
    with new features.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 站点管理员预设是在设置、维护以及尝试新功能时的一种强大工具。
- en: Tip
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: It is good practice to store the presets of your production site as part of
    your system documentation.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 将生产站点的预设作为系统文档的一部分存储是良好的实践。
- en: Admin presets deal with your site’s configuration, stored in the underlying
    database. A number of dedicated database tools are discussed in the following
    section.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员预设处理您站点的配置，这些配置存储在底层数据库中。以下章节将讨论一些专门的数据库工具。
- en: Database tools
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据库工具
- en: Moodle’s database tools transfer databases from one server to another, perform
    search-and-replace operations on text strings in the entire database, and let
    you view or change any data in the database itself.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 的数据库工具可以将数据库从一个服务器传输到另一个服务器，在整个数据库中对文本字符串执行搜索和替换操作，并允许您查看或更改数据库中的任何数据。
- en: Transferring your Moodle database
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 迁移您的 Moodle 数据库
- en: If you have to move the database of a Moodle instance from one server to another
    or migrate to another Moodle system, you have two broad options. You can either
    create a database dump manually (or via the Adminer tool, which is covered later)
    or use the built-in **database** **transfer** facility.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您必须将 Moodle 实例的数据库从一个服务器移动到另一个服务器或迁移到另一个 Moodle 系统，您有两个主要选项。您可以选择手动创建数据库转储（或通过稍后介绍的
    Adminer 工具）或使用内置的 **数据库** **迁移** 功能。
- en: The database migration tool is available at `<yoursite>/admin/tool/dbtransfer`.
    At the time of writing, the feature can also be accessed via **Site administration**
    | **Development** | **Experimental** | **Database migration**. As the category
    name suggests, the tool is experimental and might make it into core or might disappear
    again from the admin interface in future releases.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库迁移工具位于 `<yoursite>/admin/tool/dbtransfer`。在撰写本文时，此功能也可以通过 **站点管理** | **开发**
    | **实验** | **数据库迁移** 访问。正如类别名称所暗示的，该工具是实验性的，可能在未来的版本中进入核心或从管理员界面中消失。
- en: '![Figure 17.7 – Database transfer ](img/Figure_17.07_B18779.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.7 – 数据库迁移](img/Figure_17.07_B18779.jpg)'
- en: Figure 17.7 – Database transfer
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.7 – 数据库迁移
- en: You must provide the details of the database to which the content of the current
    database will be copied. These settings are identical to the ones applied during
    installation (see [*Chapter 1*](B18779_01.xhtml#_idTextAnchor020), *Installing
    Moodle*).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须提供数据库的详细信息，该数据库将复制当前数据库的内容。这些设置与安装期间应用的设置相同（参见 [*第 1 章*](B18779_01.xhtml#_idTextAnchor020)，*安装
    Moodle*）。
- en: You further have the `$CFG->dataroot/climaintenance.xhtml` file afterwards manually
    or via **Site administration** | **Server** | **Server** | **Maintenance mode**.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 您随后可以通过手动或通过 **站点管理** | **服务器** | **服务器** | **维护模式** 来手动或通过 **站点管理** | **服务器**
    | **服务器** | **维护模式** 来处理 `$CFG->dataroot/climaintenance.xhtml` 文件。
- en: Searching and replacing database content
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 搜索和替换数据库内容
- en: A tool related to the database migration facility is `<yoursite>/admin/tool/replace`.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 与数据库迁移功能相关的工具是 `<yoursite>/admin/tool/replace`。
- en: '![Figure 17.8 – Database search and replace ](img/Figure_17.08_B18779.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.8 – 数据库搜索和替换](img/Figure_17.08_B18779.jpg)'
- en: Figure 17.8 – Database search and replace
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.8 – 数据库搜索和替换
- en: The last option, labeled **I understand the risks of this operation**, indicates
    the potential risk of the execution – unless you are 100% certain that the replacements
    will not have any impact on the system, you had better stay away from it. Once
    completed, the script will display all executed SQL queries.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个选项，标记为**我了解此操作的潜在风险**，表明执行的潜在风险——除非你100%确信替换不会对系统有任何影响，否则你最好不要接近它。一旦完成，脚本将显示所有执行的SQL查询。
- en: Moodle Adminer
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Moodle Adminer
- en: Adminer is an open source tool to administer different types of SQL databases.
    A wrapper has been created that lets you access the tool directly from within
    Moodle. Moodle Adminer must be installed in your `local` plugins section (see
    [*Chapter 8*](B18779_08.xhtml#_idTextAnchor168), *Understanding Moodle Plugins*
    for details). You will find the installer at [moodle.org/plugins/local_adminer](http://moodle.org/plugins/local_adminer).
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Adminer是一个开源工具，用于管理不同类型的SQL数据库。已经创建了一个包装器，让你可以直接从Moodle中访问该工具。Moodle Adminer必须安装在你的`local`插件部分（有关详细信息，请参阅[*第8章*](B18779_08.xhtml#_idTextAnchor168)“理解Moodle插件”）。你可以在[moodle.org/plugins/local_adminer](http://moodle.org/plugins/local_adminer)找到安装程序。
- en: 'Once installed, you access the database management console via **Site administration**
    | **Server** | **Moodle Adminer**, which opens the tool in a modal window:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装，你通过**站点管理** | **服务器** | **Moodle Adminer**访问数据库管理控制台，它将在模态窗口中打开工具：
- en: '![Figure 17.9 – The Moodle Adminer interface ](img/Figure_17.09_B18779.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![图17.9 – Moodle Adminer界面](img/Figure_17.09_B18779.jpg)'
- en: Figure 17.9 – The Moodle Adminer interface
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.9 – Moodle Adminer界面
- en: By default, you must select a database. However, you can skip this step if you
    enable the **Start adminer with current database** setting in **Site administration**
    | **Plugins** | **Local plugins** | **Moodle Adminer**.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，你必须选择一个数据库。但是，如果你在**站点管理** | **插件** | **本地插件** | **Moodle Adminer**中启用**以当前数据库启动adminer**设置，则可以跳过此步骤。
- en: Once a (Moodle) database has been opened, you can perform operations (such as
    querying, altering data, or creating an SQL dump) without any SQL knowledge.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦打开（Moodle）数据库，你就可以执行操作（如查询、更改数据或创建SQL转储）而无需任何SQL知识。
- en: Important note
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Ensure you only change data if you know what you are doing; otherwise, you might
    introduce database inconsistencies, and Moodle will not work as expected.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你只有在了解自己在做什么的情况下才更改数据；否则，你可能会引入数据库不一致性，Moodle将无法按预期工作。
- en: We will not go into using Adminer in detail since this is beyond the scope of
    this chapter. You can find all the information you are looking for at [www.adminer.org](http://www.adminer.org).
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会详细介绍如何使用Adminer，因为这超出了本章的范围。你可以在[www.adminer.org](http://www.adminer.org)找到你所需的所有信息。
- en: This concludes the database tools section, where we covered database transfer,
    database search and replace, and Moodle Adminer. We ignored one tool that only
    applies to MySQL/MariaDB and is only needed when migrating a database still using
    the legacy MyISAM format. This tool can be found at `<yoursite>/admin/tool/innodb`,
    which converts any tables from MyISAM to the InnoDB storage engine.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 这就结束了数据库工具部分，我们介绍了数据库迁移、数据库搜索和替换以及Moodle Adminer。我们忽略了一个仅适用于MySQL/MariaDB的工具，并且只有在迁移仍在使用旧版MyISAM格式的数据库时才需要。这个工具可以在`<yoursite>/admin/tool/innodb`找到，它可以将任何表从MyISAM转换为InnoDB存储引擎。
- en: There are also CLI scripts supporting database-related operations, such as `mysql_engine`
    and `check_database_schema`. What’s a CLI script? Find out in the following section.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有一些支持数据库相关操作的CLI脚本，例如`mysql_engine`和`check_database_schema`。什么是CLI脚本？在下一节中找出答案。
- en: CLI
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: CLI
- en: We already encountered the CLI selectively throughout the book and during [*Chapter
    1*](B18779_01.xhtml#_idTextAnchor020), *Installing Moodle*, when we dealt with
    Moodle upgrades. However, the CLI has a few more tricks up its sleeve, which we
    will deal with in this section.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在书中和在第[*第1章*](B18779_01.xhtml#_idTextAnchor020)“安装Moodle”时已经遇到了CLI的选择性使用，当时我们处理了Moodle升级。然而，CLI还有一些额外的技巧，我们将在本节中处理。
- en: 'First, let’s look at how you call CLI scripts, which are either located in
    `admin/cli/*` or in the sub-folder of plugins that offer a CLI option – for example,
    `auth/ldap/cli`. To call a CLI script, follow the following notation:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们看看如何调用CLI脚本，这些脚本位于`admin/cli/*`或提供CLI选项的插件的子文件夹中——例如，`auth/ldap/cli`。要调用CLI脚本，请遵循以下标记：
- en: '[PRE0]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Your `<apache_user>` is usually `www-data`, `httpd`, or `apache`.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 你的`<apache_user>`通常是`www-data`、`httpd`或`apache`。
- en: Important note
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Always run Moodle CLI scripts under the identity of the web server user.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 总是在网络服务器用户的身份下运行 Moodle CLI 脚本。
- en: Every CLI script has a `--help` parameter that offers additional information
    and also describes calling options and parameters. The following is a list of
    some useful CLI commands and chapter numbers in which they have been covered.
    Look in their respective CLI directories or at [docs.moodle.org/en/Administration_via_command_line](http://docs.moodle.org/en/Administration_via_command_line)
    for all other commands. We do not list any parameters here, as these are explained
    well in the `--``help` options.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 每个CLI脚本都有一个`--help`参数，它提供额外的信息，并描述调用选项和参数。以下是一些有用的CLI命令及其所在的章节编号。查看它们各自的CLI目录或访问[docs.moodle.org/en/Administration_via_command_line](http://docs.moodle.org/en/Administration_via_command_line)以获取所有其他命令。这里没有列出任何参数，因为这些在`--help`选项中解释得很好。
- en: '![Figure 17.10 – A selection of Moodle CLI scripts ](img/Figure_17.10_B18779.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.10 – 一组 Moodle CLI 脚本](img/Figure_17.10_B18779.jpg)'
- en: Figure 17.10 – A selection of Moodle CLI scripts
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.10 – 一组 Moodle CLI 脚本
- en: 'The real power of the CLI lies in the ability to embed CLI commands in shell
    scripts, which allows for powerful **automation** of otherwise time-consuming
    or error-prone routines. We presented a small installation script in [*Chapter
    1*](B18779_01.xhtml#_idTextAnchor020), *Installing Moodle*. Here is another sample
    script that kills all user sessions and clears caches, utilizing some CLI scripts:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: CLI 的真正力量在于能够将 CLI 命令嵌入到 shell 脚本中，这使得对通常耗时或易出错的常规程序进行强大的**自动化**成为可能。我们在[*第
    1 章*](B18779_01.xhtml#_idTextAnchor020)，“安装 Moodle”中展示了一个小的安装脚本。以下是一个另一个示例脚本，它终止所有用户会话并清除缓存，利用了一些
    CLI 脚本：
- en: '![Figure 17.11 – A sample Bash script utilizing the Moodle CLI ](img/Figure_17.11_B18779.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![图 17.11 – 使用 Moodle CLI 的示例 Bash 脚本](img/Figure_17.11_B18779.jpg)'
- en: Figure 17.11 – A sample Bash script utilizing the Moodle CLI
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图 17.11 – 使用 Moodle CLI 的示例 Bash 脚本
- en: While useful for the supported operations, the CLI provides a relatively restricted
    set of commands. Moosh, which we will cover next, overcomes this limitation.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然对于支持的运算很有用，但 CLI 提供的命令集相对有限。我们将要介绍的 Moosh 可以克服这一限制。
- en: Moosh – the Moodle Shell
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Moosh – Moodle Shell
- en: Moosh stands for Moodle Shell and is a command-line tool that allows you to
    perform the most common Moodle tasks.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: Moosh 代表 Moodle Shell，是一个命令行工具，允许您执行最常见的学习管理系统任务。
- en: Before you can make use of Moosh, you have to install it (see [*Chapter 8*](B18779_08.xhtml#_idTextAnchor168),
    *Understanding Moodle Plugins*). Once installed, you will have a vast number of
    commands (at the time of writing, over 150!) at your disposal.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在您可以使用 Moosh 之前，您必须安装它（参见[*第 8 章*](B18779_08.xhtml#_idTextAnchor168)，“理解学习管理系统插件”）。安装后，您将拥有大量的命令（截至编写时，超过
    150 个！）可供使用。
- en: 'The general syntax of Moosh is as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: Moosh 的一般语法如下：
- en: '[PRE1]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To give you an idea of the types of things you can do with Moosh, here are
    a few examples:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让您了解可以使用 Moosh 做哪些事情，这里有一些示例：
- en: '`moosh user-create test`: Creates a user with the username `test`.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`moosh user-create test`：创建用户名为 `test` 的用户。'
- en: '`moosh user-create test{1..10}`: Creates 10 users. This type of enumeration
    can be used with many Moosh commands.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`moosh user-create test{1..10}`：创建 10 个用户。这种枚举类型可以与许多 Moosh 命令一起使用。'
- en: '`moosh user-create --email packt@openumlaut.com --city "Heidelberg" --country
    DE --firstname "Alex" --lastname "Büchner" packt`: All user profile values are
    supported; this is just a sample.'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`moosh user-create --email packt@openumlaut.com --city "Heidelberg" --country
    DE --firstname "Alex" --lastname "Büchner" packt`：所有用户配置文件值都受支持；这只是一个示例。'
- en: '`moosh info-plugins`: Displays a list of all plugins installed and their locations.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`moosh info-plugins`：显示所有已安装插件及其位置的列表。'
- en: '`moosh file-list course=42`: Outputs information on all files in the course
    with the ID `42`. There are more file-related commands, such as showing the system
    path of a file or the ability to upload files directly.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`moosh file-list course=42`：输出 ID 为 `42` 的课程中所有文件的信息。还有更多与文件相关的命令，例如显示文件的系统路径或直接上传文件的能力。'
- en: '`moosh plugin-install mod_videotime`: Downloads and installs the latest version
    of the versatile Videotime plugin. How cool is that?'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`moosh plugin-install mod_videotime`：下载并安装多功能 Videotime 插件的最新版本。这有多酷？'
- en: Once you combine Moosh commands with standard shell commands via pipes and streams,
    you have a powerful arsenal of commands at hand. For example, you might want to
    find all backups that are larger than 10 GB, archive them, and reclaim the space.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你通过管道和流将Moosh命令与标准shell命令结合使用，你将手头拥有一套强大的命令库。例如，你可能想要找到所有大于10 GB的备份，归档它们，并回收空间。
- en: 'The following example demonstrates the execution and output of three Moosh
    commands:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例展示了三个Moosh命令的执行和输出：
- en: '![Figure 17.12 – Playing with Moosh ](img/Figure_17.12_B18779.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![图17.12 – 与Moosh玩耍](img/Figure_17.12_B18779.jpg)'
- en: Figure 17.12 – Playing with Moosh
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图17.12 – 与Moosh玩耍
- en: The first (`moosh course-list`) shows the information on all courses; the second
    (`moosh category-list`) does the same for categories; the last (`moosh user-create
    test{1..10}`) shows the IDs of the 10 user accounts after they have been created.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个(`moosh course-list`)显示了所有课程的信息；第二个(`moosh category-list`)对类别做了同样的操作；最后一个(`moosh
    user-create test{1..10}`)显示了创建后的10个用户账户的ID。
- en: For a complete list of over 150 commands and hundreds of options, refer to the
    Moosh website at [moosh-online.com/commands](http://moosh-online.com/commands).
    The list is constantly growing, so ensure you have installed the latest version.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取超过150个命令和数百个选项的完整列表，请参考Moosh网站[moosh-online.com/commands](http://moosh-online.com/commands)。该列表不断增长，请确保你已经安装了最新版本。
- en: This concludes the section on Moosh and the chapter on Moodle admin tools. Hopefully,
    some facilities will streamline your day-to-day job and optimize some of the routine
    tasks you need to carry out.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分关于Moosh和Moodle管理员工具的章节到此结束。希望其中的一些功能能够简化你的日常工作，并优化你需要执行的某些常规任务。
- en: Summary
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have covered a range of admin tools, some hidden and unsupported
    but nonetheless very useful. We first explored how admin tools are organized,
    before we covered site admin presets and some database tools, including the external
    Adminer, the Moodle CLI, and the powerful third-party Moosh tool.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了一系列管理员工具，其中一些是隐藏的且不受支持的，但仍然非常有用。我们首先探讨了管理员工具的组织方式，然后介绍了站点管理员预设和一些数据库工具，包括外部Adminer、Moodle
    CLI和强大的第三方Moosh工具。
- en: Other ways to extend the reach of Moodle are web services, which we will cover
    in the following chapter.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展Moodle的其他方式是网络服务，我们将在下一章中介绍。
