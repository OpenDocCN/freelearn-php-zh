<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Backend Development"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Backend Development</h1></div></div></div><p>In the previous chapter, we added all the frontend functionality for the gift registry. Now, customers are able to create registries and add products to the customer registries, and in general, have full <a id="id269" class="indexterm"/>control over their own registries.</p><p>In this chapter, we are going build all the functionality that store owners need to manage and control the registries through the Magento backend.</p><p>The Magento backend can be considered, in many senses, as a separate application from the Magento frontend. It uses a completely separate theme, style, and a different base controller.</p><p>For our gift registry, we want to allow store owners to see all customer registries, modify the information, and add/remove items. In this chapter, we will cover the following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Extending Adminhtml with configuration</li><li class="listitem" style="list-style-type: disc">Using the grid widget</li><li class="listitem" style="list-style-type: disc">Using the form widget</li><li class="listitem" style="list-style-type: disc">Restricting access and permissions with <span class="strong"><strong>Access Control Lists</strong></span> (<span class="strong"><strong>ACLs</strong></span>)</li></ul></div><div class="section" title="Extending Adminhtml"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Extending Adminhtml</h1></div></div></div><p>
<code class="literal">Mage_Adminhtml</code> is<a id="id270" class="indexterm"/> a <a id="id271" class="indexterm"/>single module that provides all the backend functionality for Magento<a id="id272" class="indexterm"/> through the usage of configuration. As we learned before, Magento uses scopes to define the configuration. In the previous chapter, we used the frontend scope to set up the configuration for our custom module.</p><p>To modify the backend, we need to create a new scope in our configuration file called <code class="literal">admin</code>. Perform<a id="id273" class="indexterm"/> the following steps to do so:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">config.xml</code> file.</li><li class="listitem">Add the following code to the file located at <code class="literal">app/code/local/Mdg/Giftregistry/etc/config.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;admin&gt;
  &lt;routers&gt;
    &lt;mdg_giftregistry&gt;
      &lt;use&gt;admin&lt;/use&gt;
        &lt;args&gt;
          &lt;module&gt;Mdg_Giftregistry_Adminhmtl&lt;/module&gt;
          &lt;frontName&gt;giftregistry&lt;/frontName&gt;
        &lt;/args&gt;
    &lt;/mdg_giftregistry&gt;
  &lt;/routers&gt;
&lt;/admin&gt;</pre></div></li></ol></div><p>This code is <a id="id274" class="indexterm"/>very similar to the one we used before to specify our frontend route. However, by declaring the route this way, we are breaking an unwritten Magento design pattern.</p><p>In order to keep things consistent on the backend, all new modules should extend the main admin route.</p><p>Instead of defining the route with the previous code, we are creating a completely new admin route.</p><p>Normally, you don't want to do this for the Magento backend unless you are creating a new route that requires admin access but not the rest of the Magento backend. A callback URL for an admin action would be a good example of something like this.</p><p>Fortunately, there is a very easy way to share route names among Magento modules.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>Sharing route names was introduced in Magento 1.3, but to this day, we still see extensions that don't use this pattern properly.</p></div></div><p>Let's update our code:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">config.xml</code> file.</li><li class="listitem">Update the route's configuration file located at <code class="literal">app/code/local/Mdg/Giftregistry/etc/config.xml</code> with the following code:<div class="informalexample"><pre class="programlisting">&lt;admin&gt;
  &lt;routers&gt;
    &lt;adminhtml&gt;
      &lt;args&gt;
        &lt;modules&gt;
          &lt;mdg_giftregistry before="Mage_Adminhtml"&gt; Mdg_Giftregistry_Adminhtml&lt;/mdg_giftregistry&gt;
        &lt;/modules&gt;
      &lt;/args&gt;
    &lt;/adminhtml&gt;
  &lt;/routers&gt;
&lt;/admin&gt;</pre></div></li></ol></div><p>After<a id="id275" class="indexterm"/> making <a id="id276" class="indexterm"/>this change, we can properly access our <code class="literal">admin</code> controllers through the <code class="literal">admin</code> namespace, for example, <code class="literal">http://magento.localhost.com/giftregistry/index</code> will now be <code class="literal">http://magento.localhost.com/admin/giftregistry/index</code>.</p><p>Our next step is to create a new controller that we can use to manage the customer registries. Let's call this controller <code class="literal">GiftregistryController.php</code>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to your module's <code class="literal">controllers</code> folder.</li><li class="listitem">Create a new folder named <code class="literal">Adminhtml</code>.</li><li class="listitem">Create a file named <code class="literal">GiftregistryController.php</code>.</li><li class="listitem">Insert the following code into this file located at <code class="literal">app/code/local/Mdg/Giftregistry/controllers/Adminhtml/GiftregistryController.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
class Mdg_Giftregistry_Adminhtml_GiftregistryController extends Mage_Adminhtml_Controller_Action
{
  public function indexAction()
  {
    $this-&gt;loadLayout();
    $this-&gt;renderLayout();
    return $this;
  }

  public function editAction()
  {
    $this-&gt;loadLayout();
    $this-&gt;renderLayout();
    return $this;
  }

  public function saveAction()
  {
    $this-&gt;loadLayout();
    $this-&gt;renderLayout();
    return $this;
  }

  public function newAction()
  {
    $this-&gt;loadLayout();
    $this-&gt;renderLayout();
    return $this;
  }

  public function massDeleteAction()
  {
    $this-&gt;loadLayout();
    $this-&gt;renderLayout();
    return $this;
  }
}</pre></div></li></ol></div><p>Notice something <a id="id277" class="indexterm"/>important; this new controller extends <code class="literal">Mage_Adminhtml_Controller_Action</code> instead of <code class="literal">Mage_Core_Controller_Front_Action</code>, which we have been using so far. This is because the <code class="literal">Adminhtml</code> controller has additional validation to prevent non-admin users from accessing their actions.</p><p>Notice that we are<a id="id278" class="indexterm"/> placing our controller inside a new subfolder inside the <code class="literal">controllers/</code> directory. By using this subdirectory, we are keeping the frontend and backend controllers organized. This is a widely accepted Magento standard practice.</p><p>For now, let's leave this blank controller alone, extend the Magento backend navigation, and add some extra tabs to the customer edit page.</p><div class="section" title="Back to the configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec40"/>Back to the configuration</h2></div></div></div><p>As we<a id="id279" class="indexterm"/> have seen so far, much of Magento is controlled by XML configuration files and the backend layout is no different. We need a new <code class="literal">adminhtml</code> layout file. We create it as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the <code class="literal">design</code> folder.</li><li class="listitem">Create a new folder named <code class="literal">adminhtml</code>, and inside it, create the following folder structure:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">adminhtml/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">--default/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">----default/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">------template/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">------layout/</code></li></ul></div></li><li class="listitem">Inside the <code class="literal">layout</code> folder, let's create a new layout file called <code class="literal">giftregistry.xml</code>.</li><li class="listitem">Copy the following code to the <code class="literal">layout</code> file located at <code class="literal">app/design/adminhtml/default/default/layout/giftregistry.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;layout version="0.1.0"&gt;
  &lt;adminhtml_customer_edit&gt;
    &lt;reference name="left"&gt;
      &lt;reference name="customer_edit_tabs"&gt;
        &lt;block type="mdg_giftregistry/ adminhtml_customer_edit_tab_giftregistry" name="tab_giftregistry_main" template= "mdg_giftregistry/giftregistry/ customer/main.phtml" /&gt;
        &lt;action method="addTab"&gt;
          &lt;name&gt;mdg_giftregistry&lt;/name&gt;
          &lt;block&gt;tab_giftregistry_main&lt;/block&gt;
        &lt;/action&gt;
      &lt;/reference&gt;
    &lt;/reference&gt;
  &lt;/adminhtml_customer_edit&gt;
&lt;/layout&gt;</pre></div></li></ol></div><p>We also need<a id="id280" class="indexterm"/> to add the new layout file to the <code class="literal">config.xml</code> module:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the <code class="literal">etc/</code> folder.</li><li class="listitem">Open the <code class="literal">config.xml</code> file.</li><li class="listitem">Copy the following code to the <code class="literal">config.xml</code> file located at <code class="literal">app/code/local/Mdg/Giftregistry/etc/config.xml</code>:<div class="informalexample"><pre class="programlisting">…
  &lt;adminhtml&gt;
    &lt;layout&gt;
      &lt;updates&gt;
        &lt;mdg_giftregistry module="mdg_giftregistry"&gt;
          &lt;file&gt;giftregistry.xml&lt;/file&gt;
        &lt;/mdg_giftregistry&gt;
      &lt;/updates&gt;
    &lt;/layout&gt;
  &lt;/adminhtml&gt;
…</pre></div></li></ol></div><p>What we are doing inside the layout is creating a new container block and declaring a new tab that contains this block.</p><p>Let's quickly test our changes so far by logging in to the Magento backend and opening the customer information by going into <span class="strong"><strong>Customer Manager</strong></span> by navigating to <span class="strong"><strong>Customers</strong></span> | <span class="strong"><strong>Manage Customers</strong></span>.</p><p>We should get the following error at the backend:</p><div class="mediaobject"><img src="graphics/4195OS_04_01.jpg" alt="Back to the configuration"/></div><p>This is because<a id="id281" class="indexterm"/> we are trying to add a block that has not been declared yet. </p><p>To fix this, we need to create a new block class:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the <code class="literal">Block</code> folder and create a new block class following the directory structure named <code class="literal">Giftregistry.php</code>.</li><li class="listitem">Add the following code to the <code class="literal">Giftregistry.php</code> file located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Customer/Edit/Tab/Giftregistry.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
class Mdg_Giftregistry_Block_Adminhtml_Customer_Edit_Tab_Giftregistry
  extends Mage_Adminhtml_Block_Template
  implements Mage_Adminhtml_Block_Widget_Tab_Interface {

  public function __construct()
  {
    $this- &gt;setTemplate ('mdg/giftregistry/customer/main.phtml');
    parent::__construct();
  }

  public function getCustomerId()
  {
    return Mage::registry('current_customer')-&gt;getId();
  }

  public function getTabLabel()
  {
    return $this-&gt;__('GiftRegistry List');
  }

  public function getTabTitle()
  {
    return $this-&gt;__('Click to view the customer Gift Registries');
  }

  public function canShowTab()
  {
    return true;
  }

  public function isHidden()
  {
    return false;
  }
}</pre></div></li></ol></div><p>There are a couple of <a id="id282" class="indexterm"/>interesting things happening with this block class. For starters, we are extending a different block class, <code class="literal">Mage_Adminhtml_Block_Template</code>, and implementing a new interface, <code class="literal">Mage_Adminhtml_Block_Widget_Tab_Interface</code>. This is done in order to access all the features and functionality of the Magento backend.</p><p>We are also setting the block template inside the <code class="literal">construct</code> function of our class. Additionally, under <code class="literal">getCustomerId</code>, we are making use of the Magento global variables to get the current customer.</p><p>Our next step is to<a id="id283" class="indexterm"/> create the corresponding template file for this block, otherwise, we will get an error on the block initialization.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a template file named <code class="literal">main.phtml</code> under the <code class="literal">adminhtml</code> template folder.</li><li class="listitem">Copy the following code into <code class="literal">main.phtml</code>, located at <code class="literal">app/design/adminhtml/default/default/template/mdg/giftregistry/customer/main.phtml</code>:<div class="informalexample"><pre class="programlisting">&lt;div class="entry-edit"&gt;
  &lt;div class="entry-edit-head"&gt;
    &lt;h4 class="icon-head head-customer-view"&gt;&lt;?php echo $this-&gt;__('Customer Gift Registry List') ?&gt;&lt;/h4&gt;
  &lt;/div&gt;
  &lt;table cellspacing="2" class="box-left"&gt;
    &lt;tr&gt;
      &lt;td&gt;
        Nothing here
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;</pre></div></li></ol></div><p>For now, we are just adding the placeholder content to the template, so we can actually see our tabs in action. Now, if we go to the customer section in the backend, we should see that a new tab is available. Clicking on that tab will display our placeholder content.</p><p>By now, we have modified the backend and added a <span class="strong"><strong>Customers</strong></span> tab to the customer section just by changing a configuration and adding some simple blocks and template files. However, so far, this hasn't been particularly useful, so we need a way of displaying all the customer gift registries under the <span class="strong"><strong>Gift registry</strong></span> tab.</p></div></div></div>
<div class="section" title="The grid widget"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>The grid widget</h1></div></div></div><p>Instead<a id="id284" class="indexterm"/> of having to write our own grid blocks from scratch, we can reuse the ones that are already provided by the Magento <code class="literal">Adminhtml</code> module.</p><p>The block that we will be extending is called the grid widget. The grid widget is a special type of block designed to render a collection of Magento objects in a particular table grid.</p><p>A grid widget is normally rendered inside a grid container. The combination of both elements not only allows us to display our data in grid form, but also adds search, filtering, sorting, and mass action capabilities. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the block's <code class="literal">Adminhtml/</code> folder and create a folder named <code class="literal">Giftregistry/</code>.</li><li class="listitem">Create a <a id="id285" class="indexterm"/>class called <code class="literal">List.php</code> inside that folder.</li><li class="listitem">Copy the following code inside <code class="literal">List.php</code>, located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Customer/Edit/Tab/Giftregistry/List.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
class Mdg_Giftregistry_Block_Adminhtml_Customer_Edit_Tab_Giftregistry_List extends Mage_Adminhtml_Block_Widget_Grid
{
  public function __construct()
  {
    parent::__construct();
    $this-&gt;setId('registryList');
    $this-&gt;setUseAjax(true);
    $this-&gt;setDefaultSort('event_date');
    $this-&gt;setFilterVisibility(false);
    $this-&gt;setPagerVisibility(false);
  }

  protected function _prepareCollection()
  {
    $collection = Mage::getModel('mdg_giftregistry/entity')
      -&gt;getCollection()
      -&gt;addFieldToFilter('main_table.customer_id', $this -&gt;getRequest()-&gt;getParam('id'));
    $this-&gt;setCollection($collection);
    return parent::_prepareCollection();
  }

  protected function __prepareColumns()
  {
    $this-&gt;addColumn('entity_id', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Id'),
      'width'    =&gt; 50,
      'index'    =&gt; 'entity_id',
      'sortable' =&gt; false,
    ));

    $this-&gt;addColumn('event_location', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Location'),
      'index'    =&gt; 'event_location',
      'sortable' =&gt; false,
    ));

    $this-&gt;addColumn('event_date', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Date'),
      'index'    =&gt; 'event_date',
      'sortable' =&gt; false,
    ));

    $this-&gt;addColumn('type_id', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Type'),
      'index'    =&gt; 'type_id',
      'sortable' =&gt; false,
    ));
    return parent::_prepareColumns();
  }
}</pre></div></li></ol></div><p>Looking at<a id="id286" class="indexterm"/> the class we just created, there are only three functions involved:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">__construct()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">_prepareCollection()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">_prepareColumns()</code></li></ul></div><p>In the <code class="literal">__construct</code> function, we <a id="id287" class="indexterm"/>are specifying a few important options about our grid class, we are setting the grid ID, and the default sort to by <code class="literal">event_date</code>, and we are enabling pagination and filtering.</p><p>The <code class="literal">_prepareCollection()</code> function <a id="id288" class="indexterm"/>loads a collection of registries filtered by the current customer ID. This function can be used for more complex operations in our collection as well. For example, joining a secondary table to get more information about the customer or another related record.</p><p>Finally, by using the<a id="id289" class="indexterm"/> <code class="literal">_prepareColumns()</code> function, we are telling Magento which attributes and columns of our data collection should be shown and how to render them.</p><p>Now that we have created a functional grid block, let's make some changes to our layout XML file in<a id="id290" class="indexterm"/> order to display it:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">giftregistry.xml</code> folder under the <code class="literal">adminhtml</code> layout folder.</li><li class="listitem">Make the following changes in this folder, which is located at <code class="literal">app/design/adminhtml/default/default/layout/giftregistry.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;layout&gt;
  &lt;adminhtml_customer_edit&gt;
    &lt;reference name="left"&gt;
      &lt;reference name="customer_edit_tabs"&gt;
        &lt;block type="mdg_giftregistry/ adminhtml_customer_edit_tab_giftregistry" name="tab_giftregistry_main" template="mdg/giftregistry/customer/main.phtml"&gt;
          &lt;block type="mdg_giftregistry/ adminhtml_customer_edit_tab_giftregistry_list" name="tab_giftregistry_list" as="giftregistry_list" /&gt;
        &lt;/block&gt;
        &lt;action method="addTab"&gt;
          &lt;name&gt;mdg_giftregistry&lt;/name&gt;
          &lt;block&gt;mdg_giftregistry/ adminhtml_customer_edit_tab_giftregistry &lt;/block&gt;
        &lt;/action&gt;
      &lt;/reference&gt;
    &lt;/reference&gt;
  &lt;/adminhtml_customer_edit&gt;
&lt;/layout&gt;</pre></div></li></ol></div><p>What we did was add the grid block as part of our main block, but if we go to the customer edit page and click on the <span class="strong"><strong>Gift Registry</strong></span> tab, we still see the old placeholder text where the grid is not displayed:</p><div class="mediaobject"><img src="graphics/4195OS_04_02.jpg" alt="The grid widget"/></div><p>This is because we <a id="id291" class="indexterm"/>haven't made the necessary changes to our <code class="literal">main.phtml</code> template file. In order to display children blocks, we specifically need to tell the templating system to load any or a specific child. For now, let's just load our specific grid block:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">main.phtml</code> template file.</li><li class="listitem">Replace the template code located at <code class="literal">app/design/adminhtml/default/default/template/mdg/giftregistry/customer/main.phtml</code> with the following code:<div class="informalexample"><pre class="programlisting">&lt;div class="entry-edit"&gt;
  &lt;div class="entry-edit-head"&gt;
    &lt;h4 class="icon-head head-customer-view"&gt;&lt;?php echo $this-&gt;__('Customer Gift Registry List') ?&gt;&lt;/h4&gt;
  &lt;/div&gt;
  &lt;?php echo $this-&gt;getChildHtml('giftregistry_list'); ?&gt;
&lt;/div&gt;</pre></div></li></ol></div><p>The <code class="literal">getChildHtml()</code> function is responsible for rendering all the child blocks.</p><p>The <a id="id292" class="indexterm"/>
<code class="literal">getChildHtml()</code> function<a id="id293" class="indexterm"/> can be called with a specific child block name or without parameters. When called without parameters, it will load all the available children blocks.</p><p>In our extension, we are only interested in instantiating a particular child block. So, we will be passing the block name as the function parameter. Now, if we refresh the page, we should see our grid block loaded with all the gift registries available for that particular customer.</p><div class="section" title="Managing the registries"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec41"/>Managing the registries</h2></div></div></div><p>Now, this<a id="id294" class="indexterm"/> comes in handy if we want to manage the registries for a specific customer, but it does not really help us if we want to manage all the registries available in a store. For the latter, we need to create a grid that loads all the available gift registries.</p><p>As we have already created a <code class="literal">giftregistry</code> controller for the backend, we can use the index action to display all the available registries.</p><p>The first thing we need to do is modify the Magento backend navigation to show a link to our new controller index action. Again, we can achieve this by using XML. In this particular case, we are going to create a new XML file named <code class="literal">adminhtml.xml</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to your module <code class="literal">etc</code> folder.</li><li class="listitem">Create a new file named <code class="literal">adminhtml.xml</code>.</li><li class="listitem">Place the following content in the file located at <code class="literal">app/code/local/Mdg/Giftregistry/etc/adminhtml.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;config&gt;
  &lt;menu&gt;
    &lt;mdg_giftregistry module="mdg_giftregistry"&gt;
      &lt;title&gt;Gift Registry&lt;/title&gt;
      &lt;sort_order&gt;71&lt;/sort_order&gt;
      &lt;children&gt;
        &lt;items module="mdg_giftregistry"&gt;
          &lt;title&gt;Manage Registries&lt;/title&gt;
          &lt;sort_order&gt;0&lt;/sort_order&gt;
          &lt;action&gt;adminhtml/giftregistry/index&lt;/action&gt;
        &lt;/items&gt;
      &lt;/children&gt;
    &lt;/mdg_giftregistry&gt;
  &lt;/menu&gt;
&lt;/config&gt;</pre></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>Note that while the standard is to have this configuration added inside the <code class="literal">adminhtml.xml</code> file, you are likely to encounter extensions where this standard is not followed. This configuration can be located inside the <code class="literal">config.xml</code> file.</p></div></div><p>This configuration<a id="id295" class="indexterm"/> code creates a new main level menu and a new child-level option under it. We are also specifying which action the menu should be mapped to, in this case, the index action of our <code class="literal">giftregistry</code> controller.</p><p>If we refresh the backend now, we should see a new gift registry menu added to the top-level navigation.</p></div><div class="section" title="Permissions and ACL"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec42"/>Permissions and ACL</h2></div></div></div><p>Sometimes <a id="id296" class="indexterm"/>we need to restrict access to certain features of our module, or even the whole module, based on the admin rule. Magento allows us to do this by using a power feature called Access Control List (ACL). Each role in the Magento backend can have different permissions and different ACLs.</p><p>The first step to<a id="id297" class="indexterm"/> enable ACLs with our custom module is to define which resources should be restricted by the ACL. Not so surprisingly, this is controlled by the configuration XML files. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">adminhtml.xml</code> configuration file.</li><li class="listitem">Add the following code after the menu path <code class="literal">app/code/local/Mdg/Giftregistry/etc/adminhtml.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;config&gt;
  &lt;acl&gt;
    &lt;resources&gt;
      &lt;admin&gt;
        &lt;children&gt;
          &lt;giftregistry translate="title" module="mdg_giftregistry"&gt;
            &lt;title&gt;Gift Registry&lt;/title&gt;
            &lt;sort_order&gt;300&lt;/sort_order&gt;
            &lt;children&gt;
              &lt;items translate="title" module="mdg_giftregistry"&gt;
                &lt;title&gt;Manage Registries&lt;/title&gt;
                &lt;sort_order&gt;0&lt;/sort_order&gt;
              &lt;/items&gt;
            &lt;/children&gt;
          &lt;/giftregistry&gt;
        &lt;/children&gt;
      &lt;/admin&gt;
    &lt;/resources&gt;
  &lt;/acl&gt;
&lt;/config&gt;</pre></div></li></ol></div><p>Now, we go to <a id="id298" class="indexterm"/>the <a id="id299" class="indexterm"/>Magento backend by navigating to <span class="strong"><strong>System</strong></span> | <span class="strong"><strong>Permissions</strong></span> | <span class="strong"><strong>Roles</strong></span>. Next, we select the administrator's role and try to set <span class="strong"><strong>Role Resources</strong></span> at the bottom of the list. We will see the new ACL resources we created:</p><div class="mediaobject"><img src="graphics/4195OS_04_06.jpg" alt="Permissions and ACL"/></div><p>By doing this, we gain granular control over which operations each user has access to.</p><p>If we click on the <span class="strong"><strong>Manage Registries</strong></span> menu, we should get a blank page. As we haven't created the corresponding grid block, layouts, and templates, we should see a completely blank page.</p><p>So, let's start by <a id="id300" class="indexterm"/>creating the blocks that we need for our new grid. The way we create our <code class="literal">giftregistry</code> grid will be slightly different from what we did for our <span class="strong"><strong>Customers</strong></span> tab.</p><p>We need to <a id="id301" class="indexterm"/>create a grid container block and a grid block. The grid container is used to hold the grid header, the buttons, and the grid content, while the grid block is only in charge of rendering the grid with pagination, filtering, and mass actions. </p><p>Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to your block <code class="literal">Adminhtml</code> folder.</li><li class="listitem">Create a new block named <code class="literal">Registries.php</code>.</li><li class="listitem">Add the following code to the block located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
class Mdg_Giftregistry_Block_Adminhtml_Registries extends Mage_Adminhtml_Block_Widget_Grid_Container
{
public function __construct(){
  $this-&gt;_controller = 'adminhtml_registries';
  $this-&gt;_blockGroup = 'mdg_giftregistry';
  $this-&gt;_headerText = Mage::helper('mdg_giftregistry') -&gt;__('Gift Registry Manager');
  parent::__construct();
  }
}</pre></div></li></ol></div><p>One important thing we are setting up in the <code class="literal">construct</code> function inside our grid container is the protected value of _<code class="literal">controller</code> and <code class="literal">_blockGroup</code>. Both are used by the Magento grid container to identify the corresponding grid block.</p><p>It is important to clarify that <code class="literal">$this-&gt;_controller</code> is not the actual controller's name but the <code class="literal">block</code> class' name, and <code class="literal">$this-&gt;_blockGroup</code> is actually the module's name.</p><p>Let's continue by creating the grid block that as we learned previously. It has three main functions, namely _<code class="literal">construct</code>, <code class="literal">_prepareCollection()</code>, and <code class="literal">_prepareColumns()</code>. However, in this case, we will add a new function called <code class="literal">_prepareMassActions()</code>, which allow us to modify selected sets of records without having to edit each individually. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate<a id="id302" class="indexterm"/> to your block's <code class="literal">Adminhtml</code> folder and create a new folder called <code class="literal">Registries</code>.</li><li class="listitem">Under<a id="id303" class="indexterm"/> the <code class="literal">Model</code> folder, create a new block called <code class="literal">Grid.php</code>.</li><li class="listitem">Add the following code in the block located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries/Grid.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
class Mdg_Giftregistry_Block_Adminhtml_Registries_Grid extends Mage_Adminhtml_Block_Widget_Grid
{
  public function __construct(){
    parent::__construct();
    $this-&gt;setId('registriesGrid');
    $this-&gt;setDefaultSort('event_date');
    $this-&gt;setDefaultDir('ASC');
    $this-&gt;setSaveParametersInSession(true);
  }

  protected function _prepareCollection(){
    $collection = Mage::getModel('mdg_giftregistry/entity') -&gt;getCollection();
    $this-&gt;setCollection($collection);
    return parent::_prepareCollection();
  }

  protected function _prepareColumns()
  {
    $this-&gt;addColumn('entity_id', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Id'),
      'width'    =&gt; 50,
      'index'    =&gt; 'entity_id',
      'sortable' =&gt; false,
    ));

    $this-&gt;addColumn('event_location', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Location'),
      'index'    =&gt; 'event_location',
      'sortable' =&gt; false,
    ));

    $this-&gt;addColumn('event_date', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Date'),
      'index'    =&gt; 'event_date',
      'sortable' =&gt; false,
    ));

    $this-&gt;addColumn('type_id', array(
      'header'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Type'),
      'index'    =&gt; 'type_id',
      'sortable' =&gt; false,
    ));
    return parent::_prepareColumns();
  }

  protected function _prepareMassaction(){
  }
}</pre></div></li></ol></div><p>This grid code is <a id="id304" class="indexterm"/>very similar to what we created before for the <span class="strong"><strong>Customers</strong></span> tab <a id="id305" class="indexterm"/>with the exception that, this time, we are not specifically filtering by a customer record. Also, this time, we are also creating a grid container block instead of implementing a custom block.</p><p>Finally, in order to show the grid in our controller action, we need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">giftregistry.xml</code> file inside the <code class="literal">adminhtml</code> layout folder.</li><li class="listitem">Add the following code in the <code class="literal">giftregistry.xml</code> file located at <code class="literal">app/code/design/adminhtml/default/default/layout/giftregistry.xml</code>:<div class="informalexample"><pre class="programlisting">…
  &lt;adminhtml_giftregistry_index&gt;
    &lt;reference name="content"&gt;
      &lt;block type="mdg_giftregistry/adminhtml_registries" name="registries" /&gt;
    &lt;/reference&gt;
  &lt;/adminhtml_giftregistry_index&gt;
…</pre></div></li></ol></div><p>As we are using a <a id="id306" class="indexterm"/>grid container, we only need to specify the grid container block; Magento will take care of loading the matching grid container.</p><p>There is no need to <a id="id307" class="indexterm"/>specify or create a template file for the grid or the grid container. Both blocks automatically load the base templates from the <code class="literal">adminhtml/default/default</code> theme.</p><p>Now, we can check our newly added gift registry by going to the backend. To do so, navigate to <span class="strong"><strong>Gift Registry</strong></span> | <span class="strong"><strong>Manage Registries</strong></span> and to the screen shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4195OS_04_03.jpg" alt="Permissions and ACL"/></div></div><div class="section" title="Updating in bulk with mass actions"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec43"/>Updating in bulk with mass actions</h2></div></div></div><p>When creating<a id="id308" class="indexterm"/> our base grid block, we defined a function called <code class="literal">_prepareMassactions()</code>. Mass actions provide an easy way of manipulating multiple records from the grid. In our case, for now, let's just implement a mass delete action. Perform the following steps to do so:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <a id="id309" class="indexterm"/>the <code class="literal">Giftregistry</code> grid block.</li><li class="listitem">Replace the <code class="literal">_prepareMassaction()</code> function with the following code in this block located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries/Grid.php</code>:<div class="informalexample"><pre class="programlisting">protected function _prepareMassaction(){
  $this-&gt;setMassactionIdField('entity_id');
  $this-&gt;getMassactionBlock() -&gt;setFormFieldName('registries');

  $this-&gt;getMassactionBlock()-&gt;addItem('delete', array(
    'label'     =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Delete'),
    'url'       =&gt; $this-&gt;getUrl('*/*/massDelete'),
    'confirm'   =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Are you sure?')
  ));
  return $this;
}</pre></div></li></ol></div><p>The way mass actions work is that they pass a series of selected IDs to our specified controller action (in this case <code class="literal">massDelete()</code>). Inside, the <code class="literal">massDelete()</code> action will add code to iterate through the registry collection and delete each of the specified registries. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">GiftregistryController.php</code> file.</li><li class="listitem">Replace the blank <code class="literal">massDelete()</code> action with the following code in the file located at <code class="literal">app/code/local/Mdg/Giftregistry/controllers/Adminhtml/GiftregistryController.php</code>:<div class="informalexample"><pre class="programlisting">…
public function massDeleteAction()
{
  $registryIds = $this-&gt;getRequest() -&gt;getParam('registries');
    if(!is_array($registryIds)) {
      Mage::getSingleton('adminhtml/session') -&gt;addError(Mage::helper('mdg_giftregistry') -&gt;__('Please select one or more registries.'));
    } else {
      try {
        $registry = Mage::getModel('mdg_giftregistry/entity');
        foreach ($registryIds as $registryId) {
          $registry-&gt;reset()
                   -&gt;load($registryId)
                   -&gt;delete();
        }
        Mage::getSingleton('adminhtml/session') -&gt;addSuccess(
        Mage::helper('adminhtml')-&gt;__('Total of %d record(s) were deleted.', count($registryIds))
        );
        } catch (Exception $e) {
        Mage::getSingleton('adminhtml/session') -&gt;addError($e-&gt;getMessage());
        }
      }
    $this-&gt;_redirect('*/*/index');
}
…</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>
<span class="strong"><strong>Challenge</strong></span>: Add two new mass actions to change the status of the registries to enabled or disabled. To see the answer with the complete code and full breakdown, visit <a class="ulink" href="http://www.magedevguide.com/">http://www.magedevguide.com/</a>.</p></div></div></li></ol></div><p>Finally, we<a id="id310" class="indexterm"/> also want to be able to edit the records listed in our grid. For that, we need to add a new function to our registries' grid class. This function is called <code class="literal">getRowUrl()</code> and is used to specify the action to be taken when clicking on a grid row. In our particular case, we want to map that function to the <code class="literal">editAction()</code> function. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">Grid.php</code> file.</li><li class="listitem">Add the following function to the file located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries/Grid.php</code>:<div class="informalexample"><pre class="programlisting">…
public function getRowUrl($row)
{
  return $this-&gt;getUrl('*/*/edit', array('id' =&gt; $row -&gt;getEntityId()));
}
…</pre></div></li></ol></div></div></div>
<div class="section" title="The form widget"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>The form widget</h1></div></div></div><p>So far, we <a id="id311" class="indexterm"/>have a working gift registry grid, but right now, we aren't able to do much more than just getting the list of all the available registries or deleting registries in bulk. We need a way of getting the details for a specific registry. We can map this to the edit controller action.</p><p>The edit controller action will display the registry-specific details and will also allow us to modify the registry details and status. We need to create a few blocks and templates for this action.</p><p>In order to view and edit the registry information, we must implement a form widget block. Form widgets work in a similar fashion to the grid widget blocks and need to have a form block and a form container block that extend the <code class="literal">Mage_Adminhtml_Block_Widget_Form_Container</code> class. </p><p>In order to create the form container, let's take the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the <code class="literal">Registries</code> folder.</li><li class="listitem">Create a new class file named <code class="literal">Edit.php</code>.</li><li class="listitem">Add the following code to the class file located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries/Edit.php</code>:<div class="informalexample"><pre class="programlisting">class Mdg_Giftregistry_Block_Adminhtml_Registries_Edit extends Mage_Adminhtml_Block_Widget_Form_Container
{
  public function __construct(){
    parent::__construct();
    $this-&gt;_objectId = 'id';
    $this-&gt;_blockGroup = 'registries';
    $this-&gt;_controller = 'adminhtml_giftregistry';
    $this-&gt;_mode = 'edit';

    $this-&gt;_updateButton('save', 'label',
      Mage::helper('mdg_giftregistry')-&gt;__('Save Registry'));
    $this-&gt;_updateButton('delete', 'label', Mage::helper('mdg_giftregistry')-&gt;__('Delete Registry'));
  }

  public function getHeaderText(){
    if(Mage::registry('registries_data') &amp;&amp; Mage::registry('registries_data')-&gt;getId())
      return Mage::helper('mdg_giftregistry')-&gt;__("Edit Registry '%s'", $this -&gt;htmlEscape(Mage::registry('registries_data') -&gt;getTitle()));
      return Mage::helper('mdg_giftregistry')-&gt;__('Add Registry');
    }
}</pre></div></li></ol></div><p>Like the <a id="id312" class="indexterm"/>grid widget, the form container widget will automatically identify and load the matching form block.</p><p>One additional protected attribute that is being declared in the form container is the <code class="literal">mode</code> attribute. This protected attribute is used by the container to specify the location of the form block.</p><p>We can find the code responsible for the creation of the form block inside the <code class="literal">Mage_Adminhtml_Block_Widget_Form_Container</code> class:</p><div class="informalexample"><pre class="programlisting">$this-&gt;getLayout()-&gt;createBlock($this-&gt;_blockGroup . '/' . $this -&gt;_controller . '_' . $this-&gt;_mode . '_form')</pre></div><p>Now that we have created the form container block, we can proceed to create the matching form block:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to the <code class="literal">Registries</code> folder.</li><li class="listitem">Create a new folder called <code class="literal">Edit</code>.</li><li class="listitem">Inside the <code class="literal">Edit</code> folder, create a new file called<code class="literal"> Form.php</code>.</li><li class="listitem">Add the following code to the file located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries/Edit/Form.php</code>:<div class="informalexample"><pre class="programlisting">&lt;?php
class Mdg_Giftregistry_Block_Adminhtml_Registries_Edit_Form extends Mage_Adminhtml_Block_Widget_Form
{
  protected function _prepareForm()
  {
    $form = new Varien_Data_Form(array(
      'id' =&gt; 'edit_form',
      'action' =&gt; $this-&gt;getUrl('*/*/save', array(
        'id' =&gt; $this-&gt;getRequest()-&gt;getParam('id')
      )),
      'method' =&gt; 'post',
      'enctype' =&gt; 'multipart/form-data'
    ));
    $form-&gt;setUseContainer(true);
    $this-&gt;setForm($form);
    
    if(Mage::getSingleton('adminhtml/session') -&gt;getFormData()) {
      $data = Mage::getSingleton('adminhtml/session') -&gt;getFormData();
      Mage::getSingleton('adminhtml/session') -&gt;setFormData(null);
    } elseif(Mage::registry('registry_data'))
      $data = Mage::registry('registry_data')-&gt;getData();
    
    $fieldset = $form-&gt;addFieldset('registry_form', array(
      'legend' =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Gift Registry information')
    ));
    
    $fieldset-&gt;addField('type_id', 'text', array(
      'label' =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Registry Id'),
      'class' =&gt; 'required-entry',
      'required' =&gt; true,
      'name' =&gt; 'type_id'
    ));
    
    $fieldset-&gt;addField('website_id', 'text', array(
      'label' =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Website Id'),
      'class' =&gt; 'required-entry',
      'required' =&gt; true,
      'name' =&gt; 'website_id'
    ));
    
    $fieldset-&gt;addField('event_location', 'text', array(
      'label' =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Location'),
      'class' =&gt; 'required-entry',
      'required' =&gt; true,
      'name' =&gt; 'event_location'
    ));
    
    $fieldset-&gt;addField('event_date', 'text', array(
      'label' =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Date'),
      'class' =&gt; 'required-entry',
      'required' =&gt; true,
      'name' =&gt; 'event_date'
    ));
    
    $fieldset-&gt;addField('event_country', 'text', array(
      'label' =&gt; Mage::helper('mdg_giftregistry') -&gt;__('Event Country'),
      'class' =&gt; 'required-entry',
      'required' =&gt; true,
      'name' =&gt; 'event_country'
    ));
    
    $form-&gt;setValues($data);
    return parent::_prepareForm();
  }
}</pre></div></li></ol></div><p>We also need<a id="id313" class="indexterm"/> to modify our layout file and tell Magento to load our form container:</p><p>Copy the following code to the <code class="literal">giftregistry.xml</code> layout file located at <code class="literal">app/code/design/adminhtml/default/default/layout/giftregistry.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;layout version="0.1.0"&gt;
  …
  &lt;adminhtml_giftregistry_edit&gt;
    &lt;reference name="content"&gt;
      &lt;block type="mdg_giftregistry/adminhtml_registries_edit" name="new_registry_tabs" /&gt;
    &lt;/reference&gt;
  &lt;/adminhtml_giftregistry_edit&gt;
  …</pre></div><p>We can check <a id="id314" class="indexterm"/>our progress at this point by going into the Magento backend and clicking on one of our example registries. We should see the following form:</p><div class="mediaobject"><img src="graphics/4195OS_04_04.jpg" alt="The form widget"/></div><p>However, there seems to be an issue. None of the data is loaded; we just have an empty form. We have to modify our <code class="literal">editAction()</code> controller in order to load the data.</p><div class="section" title="Loading the data"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec44"/>Loading the data</h2></div></div></div><p>Let's start by <a id="id315" class="indexterm"/>modifying the <code class="literal">editAction()</code> function inside our <code class="literal">GiftregistryController.php</code> file located at <code class="literal">app/code/local/Mdg/Giftregistry/controllers/Adminhtml/GiftregistryController.php</code>:</p><div class="informalexample"><pre class="programlisting">…
public function editAction()
{
  $id = $this-&gt;getRequest()-&gt;getParam('id', null);
  $registry  = Mage::getModel('mdg_giftregistry/entity');
  
  if ($id) {
    $registry-&gt;load((int) $id);
    if ($registry-&gt;getId()) {
      $data = Mage::getSingleton('adminhtml/session') -&gt;getFormData(true);
      if ($data) {
        $registry-&gt;setData($data)-&gt;setId($id);
      }
    } else {
            Mage::getSingleton('adminhtml/session') -&gt;addError(Mage::helper('awesome')-&gt;__('The Gift Registry does not exist'));
            $this-&gt;_redirect('*/*/');
        }
    }
    Mage::register('registry_data', $registry);

    $this-&gt;loadLayout();
    $this-&gt;getLayout()-&gt;getBlock('head')-&gt;setCanLoadExtJs(true);
    $this-&gt;renderLayout();
}</pre></div><p>What we <a id="id316" class="indexterm"/>are doing inside our <code class="literal">editAction()</code> controller is checking for a registry with the same ID, and if it exists, we load that registry entity and make it available to our form. Previously, when adding the form code to the <code class="literal">Form.php</code> file located at <code class="literal">app/code/local/Mdg/Giftregistry/Block/Adminhtml/Registries/Edit/Form.php</code>, we included the following code:</p><div class="informalexample"><pre class="programlisting">…
if (Mage::getSingleton('adminhtml/session')-&gt;getFormData()){
  $data = Mage::getSingleton('adminhtml/session') -&gt;getFormData();
  Mage::getSingleton('adminhtml/session')-&gt;setFormData(null);
}elseif(Mage::registry('registry_data'))
  $data = Mage::registry('registry_data')-&gt;getData();
…</pre></div><p>Now, we can test our changes by reloading the form:</p><div class="mediaobject"><img src="graphics/4195OS_04_05.jpg" alt="Loading the data"/></div></div><div class="section" title="Saving the data"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec45"/>Saving the data</h2></div></div></div><p>Now that <a id="id317" class="indexterm"/>we have created the form to edit a registry, we need to create the corresponding action to process and save the data posted by the form. We can use the <code class="literal">saveAction()</code> function to handle this. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">GiftregistryController.php</code> class.</li><li class="listitem">Replace the blank <code class="literal">saveAction()</code> function with the following code to the file located at <code class="literal">app/code/local/Mdg/Giftregistry/controllers/Adminhtml/GiftregistryController.php</code>:<div class="informalexample"><pre class="programlisting">public function saveAction()
{
  if ($this-&gt;getRequest()-&gt;getPost())
  {
    try {
      $data = $this-&gt;getRequest()-&gt;getPost();
      $id = $this-&gt;getRequest()-&gt;getParam('id');

      if ($data &amp;&amp; $id) {
        $registry = Mage::getModel('mdg_giftregistry/entity') -&gt;load($id);
        $registry-&gt;setData($data);
        $registry-&gt;save();
        $this-&gt;_redirect('*/*/edit', array('id' =&gt; $this -&gt;getRequest()-&gt;getParam('registry_id')));
      }
    } catch (Exception $e) {
      $this-&gt;_getSession()-&gt;addError(
        Mage::helper('mdg_giftregistry')-&gt;__('An error occurred while saving the registry data. Please review the log and try again.')
      );
      Mage::logException($e);
      $this-&gt;_redirect('*/*/edit', array('id' =&gt; $this -&gt;getRequest()-&gt;getParam('registry_id')));
      return $this;
    }
  }
}</pre></div></li></ol></div><p>Let's break<a id="id318" class="indexterm"/> down what this code does step by step:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">It checks whether the request has valid post data.</li><li class="listitem">It checks that both the <code class="literal">$data</code> and the <code class="literal">$id</code> variables are set.</li><li class="listitem">If both variables are set, we load a new <code class="literal">registry</code> entity and set the data.</li><li class="listitem">Finally, we try to save the <code class="literal">registry</code> entity.</li></ol></div><p>The first thing we do is check that the data posted is not empty and that we are getting a registry ID as part of the parameters. We also check whether the registry ID is a valid instance of the registry entity.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Summary</h1></div></div></div><p>In this chapter, we learned how to modify and extend the Magento backend in accordance with our specific needs.</p><p>While extending, the frontend extends the functionality that the customers and users can use. Extending the backend allows us to control this custom functionality and how customers interact with it.</p><p>Grids and forms are important parts of the Magento backend and, by using them properly, we can add a lot of functionality without having to write a lot of code or reinventing the wheel.</p><p>Finally, we learned how to use the permissions and Magento ACL to control and restrict the permissions of our custom extension and Magento in general.</p><p>In the next chapter, we will dive deep into the Magento API and learn how to extend it to manipulate our registry data using several methods such as SOAP, XML-RPC, and REST.</p></div></body></html>