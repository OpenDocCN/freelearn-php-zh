<html><head></head><body>
<div id="_idContainer048">
<h1 class="chapter-number" id="_idParaDest-211"><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-212"><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.2.1">Creating Forms with the Form API</span></h1>
<p><span class="koboSpan" id="kobo.3.1">This chapter will cover the usage of the Form API, which is used to create forms in Drupal without writing any HTML! </span><span class="koboSpan" id="kobo.3.2">This chapter will walk you through creating a form to manage a custom piece of configuration with validation. </span><span class="koboSpan" id="kobo.3.3">You will also learn how to implement conditional form fields using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.4.1">states</span></strong><span class="koboSpan" id="kobo.5.1"> property to control whether an element is hidden, visible, required, or more. </span><span class="koboSpan" id="kobo.5.2">We will also demonstrate how AJAX can be implemented in Drupal forms to provide dynamic form elements. </span><span class="koboSpan" id="kobo.5.3">Finally, you will learn how to alter other forms in Drupal to customize </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">their application.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we will go through the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Creating a custom form and saving </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">configuration changes</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Validating </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">form data</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Specifying conditional </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">form elements</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Using AJAX in a </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">Drupal form</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Customizing existing forms </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">in Drupal</span></span></li>
</ul>
<h1 id="_idParaDest-213"><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.20.1">This chapter will require an installed custom module. </span><span class="koboSpan" id="kobo.20.2">In the following recipes, the module name is </span><strong class="source-inline"><span class="koboSpan" id="kobo.21.1">mymodule</span></strong><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">Replace as appropriate. </span><span class="koboSpan" id="kobo.22.3">You can find the full code used in this chapter on </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">GitHub: </span></span><a href="https://github.com/PacktPublishing/Drupal-10-Development-Cookbook/tree/main/chp07"><span class="No-Break"><span class="koboSpan" id="kobo.24.1">https://github.com/PacktPublishing/Drupal-10-Development-Cookbook/tree/main/chp07</span></span></a></p>
<h1 id="_idParaDest-214"><a id="_idTextAnchor243"/><span class="koboSpan" id="kobo.25.1">Creating a custom form and saving configuration changes</span></h1>
<p><span class="koboSpan" id="kobo.26.1">In this recipe, we will </span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.27.1">create a form that allows saving the company </span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.28.1">name and phone number for the website to the configuration. </span><span class="koboSpan" id="kobo.28.2">Forms are defined as classes that implement </span><strong class="source-inline"><span class="koboSpan" id="kobo.29.1">\Drupal\Core\Form\FormInterface</span></strong><span class="koboSpan" id="kobo.30.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.31.1">\Drupal\Core\Form\FormBase</span></strong><span class="koboSpan" id="kobo.32.1"> serves as a standard base class for forms. </span><span class="koboSpan" id="kobo.32.2">We will extend this class to create a new form that saves the </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">custom configuration.</span></span></p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor244"/><span class="koboSpan" id="kobo.34.1">How to do it…</span></h2>
<ol>
<li><span class="koboSpan" id="kobo.35.1">First, we need to create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.36.1">src/Form</span></strong><span class="koboSpan" id="kobo.37.1"> directory in the module’s directory. </span><span class="koboSpan" id="kobo.37.2">We will put </span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.38.1">our form class in this directory, which gives our </span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.39.1">form class the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.40.1">Form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.41.1"> namespace:</span></span><pre class="console"><span class="koboSpan" id="kobo.42.1">
mkdir -p src/Form</span></pre></li>
<li><span class="koboSpan" id="kobo.43.1">Create a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.44.1">CompanyForm.php</span></strong><span class="koboSpan" id="kobo.45.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">Form</span></strong><span class="koboSpan" id="kobo.47.1"> directory. </span><span class="koboSpan" id="kobo.47.2">This will hold our </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">CompanyForm</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.49.1">form class.</span></span></li>
<li><span class="koboSpan" id="kobo.50.1">Our </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">CompanyForm</span></strong><span class="koboSpan" id="kobo.52.1"> class will extend the </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">FormBase</span></strong><span class="koboSpan" id="kobo.54.1"> class provided by </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">Drupal core:</span></span><pre class="console"><span class="koboSpan" id="kobo.56.1">
&lt;?php</span></pre><pre class="console"><span class="koboSpan" id="kobo.57.1">
namespace Drupal\mymodule\Form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.58.1">
use Drupal\Core\Form\FormBase;</span></pre><pre class="console"><span class="koboSpan" id="kobo.59.1">
use Drupal\Core\Form\FormStateInterface;</span></pre><pre class="console"><span class="koboSpan" id="kobo.60.1">
class CompanyForm extends FormBase {</span></pre><pre class="console"><span class="koboSpan" id="kobo.61.1">
  public function getFormId() {}</span></pre><pre class="console"><span class="koboSpan" id="kobo.62.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.63.1">
    FormStateInterface $form_state) {}</span></pre><pre class="console"><span class="koboSpan" id="kobo.64.1">
  public function submitForm(array &amp;$form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.65.1">
    FormStateInterface $form_state) {}</span></pre><pre class="console"><span class="koboSpan" id="kobo.66.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.67.1">Following </span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.68.1">PSR-4 autoloading conventions, our class is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.69.1">\Drupal\mymodule\Form</span></strong><span class="koboSpan" id="kobo.70.1"> namespace, which Drupal can determine </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.71.1">as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">src/Form</span></strong><span class="koboSpan" id="kobo.73.1"> directory in our module. </span><span class="koboSpan" id="kobo.73.2">Per PSR-4, the filename and class name must also be </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">the same.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">\Drupal\Core\Form\FormBase</span></strong><span class="koboSpan" id="kobo.77.1"> class provides internal logic for handling forms. </span><span class="koboSpan" id="kobo.77.2">It only requires us to implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">getFormId</span></strong><span class="koboSpan" id="kobo.79.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">buildForm</span></strong><span class="koboSpan" id="kobo.81.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">submitForm</span></strong><span class="koboSpan" id="kobo.83.1"> methods, which will be explained and implemented in the </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">following steps.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.85.1">All forms must have a unique string that identifies the form. </span><span class="koboSpan" id="kobo.85.2">Let’s give our form the ID of </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">company_form</span></strong><span class="koboSpan" id="kobo.87.1"> by updating the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">getFormId</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.89.1"> method:</span></span><pre class="console"><span class="koboSpan" id="kobo.90.1">
  public function getFormId() {</span></pre><pre class="console"><span class="koboSpan" id="kobo.91.1">
    return 'company_form';</span></pre><pre class="console"><span class="koboSpan" id="kobo.92.1">
  }</span></pre></li>
<li><span class="koboSpan" id="kobo.93.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">buildForm</span></strong><span class="koboSpan" id="kobo.95.1"> method returns the form structure as an array of form elements. </span><span class="koboSpan" id="kobo.95.2">We provide a text field for a company name </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">and telephone:</span></span><pre class="console"><span class="koboSpan" id="kobo.97.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.98.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.99.1">
    $form['company_name'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.100.1">
      '#type' =&gt; 'textfield',</span></pre><pre class="console"><span class="koboSpan" id="kobo.101.1">
      '#title' =&gt; 'Company name',</span></pre><pre class="console"><span class="koboSpan" id="kobo.102.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.103.1">
    $form['company_telephone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.104.1">
      '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.105.1">
      '#title' =&gt; 'Company telephone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.106.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.107.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.108.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.109.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">buildForm</span></strong><span class="koboSpan" id="kobo.111.1"> method is passed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">$form</span></strong><span class="koboSpan" id="kobo.113.1"> array argument, which is where our form </span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.114.1">structure is added. </span><span class="koboSpan" id="kobo.114.2">Both </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">company_name</span></strong><span class="koboSpan" id="kobo.116.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">company_telephone</span></strong><span class="koboSpan" id="kobo.118.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">$form</span></strong><span class="koboSpan" id="kobo.120.1"> array are called </span><strong class="bold"><span class="koboSpan" id="kobo.121.1">form elements</span></strong><span class="koboSpan" id="kobo.122.1">. </span><span class="koboSpan" id="kobo.122.2">Form </span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.123.1">elements are defined with a minimum of </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">#type</span></strong><span class="koboSpan" id="kobo.125.1"> (to specify what the element is) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">#title</span></strong><span class="koboSpan" id="kobo.127.1"> (to act as </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">the label).</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.129.1">Next, we </span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.130.1">want to load an existing configuration and pass its values to </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">the elements:</span></span><pre class="console"><span class="koboSpan" id="kobo.132.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.133.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.134.1">
    $company_settings = $this-&gt;config</span></pre><pre class="console"><span class="koboSpan" id="kobo.135.1">
         ('company_settings');</span></pre><pre class="console"><span class="koboSpan" id="kobo.136.1">
    $form['company_name'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.137.1">
      '#type' =&gt; 'textfield',</span></pre><pre class="console"><span class="koboSpan" id="kobo.138.1">
      '#title' =&gt; 'Company name',</span></pre><pre class="console"><span class="koboSpan" id="kobo.139.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.140.1">
        get('company_name'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.141.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.142.1">
    $form['company_telephone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.143.1">
      '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.144.1">
      '#title' =&gt; 'Company telephone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.145.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.146.1">
        get('company_telephone'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.147.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.148.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.149.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.150.1">We load a </span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.151.1">configuration object named </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">company_settings</span></strong><span class="koboSpan" id="kobo.153.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">config</span></strong><span class="koboSpan" id="kobo.155.1"> method, which will store our values. </span><span class="koboSpan" id="kobo.155.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">#default_value</span></strong><span class="koboSpan" id="kobo.157.1"> property allows specifying an initial value that should be used for </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">an element.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.159.1">Then, we </span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.160.1">must add a </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">submit button:</span></span><pre class="console"><span class="koboSpan" id="kobo.162.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.163.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.164.1">
    $company_settings = $this-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.165.1">
        config('mymodule.company_settings');</span></pre><pre class="console"><span class="koboSpan" id="kobo.166.1">
    $form['company_name'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.167.1">
      '#type' =&gt; 'textfield',</span></pre><pre class="console"><span class="koboSpan" id="kobo.168.1">
      '#title' =&gt; 'Company name',</span></pre><pre class="console"><span class="koboSpan" id="kobo.169.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.170.1">
        get('company_name'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.171.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.172.1">
    $form['company_telephone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.173.1">
      '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.174.1">
      '#title' =&gt; 'Company telephone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.175.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.176.1">
        get('company_telephone'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.177.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.178.1">
    $form['actions']['#type'] = 'actions';</span></pre><pre class="console"><span class="koboSpan" id="kobo.179.1">
    $form['actions']['submit'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.180.1">
      '#type' =&gt; 'submit',</span></pre><pre class="console"><span class="koboSpan" id="kobo.181.1">
      '#value' =&gt; 'Submit',</span></pre><pre class="console"><span class="koboSpan" id="kobo.182.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.183.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.184.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.185.1">We provide </span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.186.1">a submit button as a form element with </span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.187.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">submit</span></strong><span class="koboSpan" id="kobo.189.1"> type. </span><span class="koboSpan" id="kobo.189.2">It is best practice to place the submit button and other buttons in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">actions</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.191.1">render element.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.192.1">Fill in </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">submitForm</span></strong><span class="koboSpan" id="kobo.194.1"> and save it to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">mymodule.company_data</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.196.1"> object:</span></span><pre class="console"><span class="koboSpan" id="kobo.197.1">
  public function submitForm(array &amp;$form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.198.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.199.1">
    $config = $this-&gt;configFactory()-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.200.1">
        getEditable('mymodule.company_settings');</span></pre><pre class="console"><span class="koboSpan" id="kobo.201.1">
    $config-&gt;set('company_name', $form_state-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.202.1">
        getValue('company_name'));</span></pre><pre class="console"><span class="koboSpan" id="kobo.203.1">
    $config-&gt;set('company_telephone', $form_state-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.204.1">
        getValue('company_telephone'));</span></pre><pre class="console"><span class="koboSpan" id="kobo.205.1">
    $config-&gt;save();</span></pre><pre class="console"><span class="koboSpan" id="kobo.206.1">
    $this-&gt;messenger()-&gt;addStatus('Updated company</span></pre><pre class="console"><span class="koboSpan" id="kobo.207.1">
        information');</span></pre><pre class="console"><span class="koboSpan" id="kobo.208.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.209.1">In order to save our configuration, we must fetch it from the configuration factory with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">getEditable</span></strong><span class="koboSpan" id="kobo.211.1"> method. </span><span class="koboSpan" id="kobo.211.2">This allows us to save changes to the </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">configuration object.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.213.1">Add a </span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.214.1">new route to make the form </span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.215.1">accessible at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">company-form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.218.1"> path:</span></span><pre class="console"><span class="koboSpan" id="kobo.219.1">
mymodule.company_form:</span></pre><pre class="console"><span class="koboSpan" id="kobo.220.1">
  path: /company-form</span></pre><pre class="console"><span class="koboSpan" id="kobo.221.1">
  defaults:</span></pre><pre class="console"><span class="koboSpan" id="kobo.222.1">
    _form: Drupal\mymodule\Form\CompanyForm</span></pre><pre class="console"><span class="koboSpan" id="kobo.223.1">
    _title: Company form</span></pre><pre class="console"><span class="koboSpan" id="kobo.224.1">
  requirements:</span></pre><pre class="console"><span class="koboSpan" id="kobo.225.1">
    _access: 'TRUE'</span></pre></li>
<li><span class="koboSpan" id="kobo.226.1">Rebuild your Drupal site’s cache to make it aware of the </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">new route:</span></span><pre class="console"><span class="koboSpan" id="kobo.228.1">
php vendor/bin/drush cr</span></pre></li>
<li><span class="koboSpan" id="kobo.229.1">Now, you may visit </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">/company-form</span></strong><span class="koboSpan" id="kobo.231.1"> and access </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">your form:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.233.1"><img alt="Figure 7.1 – The output of the CompanyForm form" src="image/Figure_7.01_B18548.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.234.1">Figure 7.1 – The output of the CompanyForm form</span></p>
<h2 id="_idParaDest-216"><a id="_idTextAnchor245"/><span class="koboSpan" id="kobo.235.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.236.1">This recipe </span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.237.1">creates a form that is accessible </span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.238.1">from a route, using a </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">_form</span></strong><span class="koboSpan" id="kobo.240.1"> property in place of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">_controller</span></strong><span class="koboSpan" id="kobo.242.1"> property. </span><span class="koboSpan" id="kobo.242.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">_form</span></strong><span class="koboSpan" id="kobo.244.1"> property contains the form class name. </span><span class="koboSpan" id="kobo.244.2">When Drupal’s routing system is built, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">_controller</span></strong><span class="koboSpan" id="kobo.246.1"> entry is added that is handled by </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">\Drupal\Core\Controller\HtmlFormController::getContentResult</span></strong><span class="koboSpan" id="kobo.248.1">. </span><span class="koboSpan" id="kobo.248.2">This addition is done by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">\Drupal\Core\Routing\Enhancer\FormRouteEnhancer</span></strong><span class="koboSpan" id="kobo.250.1"> enhancer. </span><span class="koboSpan" id="kobo.250.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">HtmlFormController</span></strong><span class="koboSpan" id="kobo.252.1"> passes the class name from </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">_form</span></strong><span class="koboSpan" id="kobo.254.1"> into the form builder and returns the complete form </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">render array.</span></span></p>
<p><span class="koboSpan" id="kobo.256.1">The form builder is responsible for determining whether the form is being rendered or whether it is handling a submission if the request is an HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">GET</span></strong><span class="koboSpan" id="kobo.258.1"> or </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">HTTP </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">POST</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.262.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.263.1">The Form API has existed in Drupal since Drupal 4.7. </span><span class="koboSpan" id="kobo.263.2">In fact, the render array system was born out of the Form API and created in </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">Drupal 7.</span></span></p>
<p><span class="koboSpan" id="kobo.265.1">When the </span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.266.1">form builder handles a form submission, the form structure is also built from </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">buildForm</span></strong><span class="koboSpan" id="kobo.268.1">. </span><span class="koboSpan" id="kobo.268.2">This is done to prevent </span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.269.1">additional invalid values from being submitted. </span><span class="koboSpan" id="kobo.269.2">Incoming input data is mapped to elements in the form and pushed to the form’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">state</span></strong><span class="koboSpan" id="kobo.271.1"> values, which are retrieved using </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">getValue</span></strong><span class="koboSpan" id="kobo.273.1"> for a specific element value or </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">getValues</span></strong><span class="koboSpan" id="kobo.275.1"> for all values. </span><span class="koboSpan" id="kobo.275.2">Once the values have been set in the form state, the form builder invokes the form validator service. </span><span class="koboSpan" id="kobo.275.3">Form validation is handled in the next recipe, </span><em class="italic"><span class="koboSpan" id="kobo.276.1">Validating </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.277.1">form data</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.279.1">If the form has no errors, then the form build invokes the form submission service and invokes the form’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">submitForm</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.281.1"> method.</span></span></p>
<h2 id="_idParaDest-217"><a id="_idTextAnchor246"/><span class="koboSpan" id="kobo.282.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.283.1">Many components make up a form created through Drupal’s Form API. </span><span class="koboSpan" id="kobo.283.2">We will explore a few of them </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">in depth.</span></span></p>
<h3><span class="koboSpan" id="kobo.285.1">The form state</span></h3>
<p><span class="koboSpan" id="kobo.286.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">\Drupal\Core\Form\FormStateInterface</span></strong><span class="koboSpan" id="kobo.288.1"> object represents the current state of the form and its data. </span><span class="koboSpan" id="kobo.288.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.289.1">form</span></strong><span class="koboSpan" id="kobo.290.1"> state </span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.291.1">contains user-submitted data for the form along with build state information. </span><span class="koboSpan" id="kobo.291.2">It can also store arbitrary information between the form being built and the submissions. </span><span class="koboSpan" id="kobo.291.3">The form state also handles redirection after the form submission. </span><span class="koboSpan" id="kobo.291.4">You will interact more with the form state in the </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">following recipes.</span></span></p>
<h3><span class="koboSpan" id="kobo.293.1">The form cache</span></h3>
<p><span class="koboSpan" id="kobo.294.1">Drupal utilizes a </span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.295.1">cache table for forms. </span><span class="koboSpan" id="kobo.295.2">This holds the build table, as identified by form build identifiers. </span><span class="koboSpan" id="kobo.295.3">This allows Drupal to validate forms during AJAX requests and easily build them when required. </span><span class="koboSpan" id="kobo.295.4">It is important to keep the form cache in persistent storage; otherwise, there may be repercussions, such as loss of form data or invalidating forms. </span><span class="koboSpan" id="kobo.295.5">We will cover AJAX forms in the </span><em class="italic"><span class="koboSpan" id="kobo.296.1">Using AJAX in a Drupal </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.297.1">form</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.298.1"> recipe.</span></span></p>
<h3><span class="koboSpan" id="kobo.299.1">The ConfigFormBase class</span></h3>
<p><span class="koboSpan" id="kobo.300.1">Drupal provides </span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.301.1">a base form class to simplify forms that modify a configuration object. </span><span class="koboSpan" id="kobo.301.2">This is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">\Drupal\Core\Form\ConfigFormBase</span></strong><span class="koboSpan" id="kobo.303.1"> class. </span><span class="koboSpan" id="kobo.303.2">This class prevents the need to call </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">getEditable</span></strong><span class="koboSpan" id="kobo.305.1"> from the configuration factory when retrieving your configuration object. </span><span class="koboSpan" id="kobo.305.2">It also adds a default submit button and messaging when the form </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">is submitted.</span></span></p>
<p><span class="koboSpan" id="kobo.307.1">Here is an updated version of our form class using </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">ConfigFormBase</span></strong><span class="koboSpan" id="kobo.309.1">. </span><span class="koboSpan" id="kobo.309.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">getEditableConfigNames</span></strong><span class="koboSpan" id="kobo.311.1"> method contains our configuration object’s name and allows it to be editable </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">whenever loaded:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.313.1">
&lt;?php
namespace Drupal\mymodule\Form;
use Drupal\Core\Form\ConfigFormBase;
use Drupal\Core\Form\FormStateInterface;
class CompanyForm extends ConfigFormBase {
  public function getFormId() {
    return 'company_form';
  }
  protected function getEditableConfigNames() {
    return ['mymodule.company_settings'];
  }
  public function buildForm(array $form, FormStateInterface
    $form_state) {
    $company_settings = $this-&gt;
        config('mymodule.company_settings');
    $form['company_name'] = [
      '#type' =&gt; 'textfield',
      '#title' =&gt; 'Company name',
      '#default_value' =&gt; $company_settings-&gt;
        get('company_name'),
    ];
    $form['company_telephone'] = [
      '#type' =&gt; 'tel',
      '#title' =&gt; 'Company telephone',
      '#default_value' =&gt; $company_settings-&gt;
        get('company_telephone'),
    ];
    return parent::buildForm($form, $form_state);
  }
  public function submitForm(array &amp;$form,
    FormStateInterface $form_state) {
    parent::submitForm($form, $form_state);
    $this-&gt;config('mymodule.company_settings')
      -&gt;set('company_name', $form_state-&gt;
        getValue('company_name'))
      -&gt;set('company_telephone', $form_state-&gt;
        getValue('company_telephone'))
      -&gt;save();
  }
}</span></pre>
<h2 id="_idParaDest-218"><a id="_idTextAnchor247"/><span class="koboSpan" id="kobo.314.1">See also</span></h2>
<ul>
<li><span class="koboSpan" id="kobo.315.1">Form </span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.316.1">and render elements </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">documentation: </span></span><a href="https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements "><span class="No-Break"><span class="koboSpan" id="kobo.318.1">https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements</span></span></a></li>
<li><span class="koboSpan" id="kobo.319.1">List of available form and render </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">elements: </span></span><a href="https://api.drupal.org/api/drupal/elements/10.0.x "><span class="No-Break"><span class="koboSpan" id="kobo.321.1">https://api.drupal.org/api/drupal/elements/10.0.x</span></span></a></li>
</ul>
<h1 id="_idParaDest-219"><a id="_idTextAnchor248"/><span class="koboSpan" id="kobo.322.1">Validating form data</span></h1>
<p><span class="koboSpan" id="kobo.323.1">We will expand </span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.324.1">on the form created in the last recipe to add validation. </span><span class="koboSpan" id="kobo.324.2">We will add validation information to form elements in the company form. </span><span class="koboSpan" id="kobo.324.3">There is also a </span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1">validateForm</span></strong><span class="koboSpan" id="kobo.326.1"> method that can be used to programmatically identify errors and prevent </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">form submission.</span></span></p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor249"/><span class="koboSpan" id="kobo.328.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.329.1">This recipe will use the form class created in the </span><em class="italic"><span class="koboSpan" id="kobo.330.1">Creating a custom form and saving configuration </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.331.1">changes</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.332.1"> recipe.</span></span></p>
<h2 id="_idParaDest-221"><a id="_idTextAnchor250"/><span class="koboSpan" id="kobo.333.1">How to do it…</span></h2>
<ol>
<li value="1"><span class="koboSpan" id="kobo.334.1">First, we will make the form elements </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">required</span></strong><span class="koboSpan" id="kobo.336.1">. </span><span class="koboSpan" id="kobo.336.2">This will prevent submitting the form without providing values. </span><span class="koboSpan" id="kobo.336.3">Update the form elements in </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">buildForm</span></strong><span class="koboSpan" id="kobo.338.1"> to match </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">the following:</span></span><pre class="console"><span class="koboSpan" id="kobo.340.1">
    $form['company_name'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.341.1">
      '#type' =&gt; 'textfield',</span></pre><pre class="console"><span class="koboSpan" id="kobo.342.1">
      '#title' =&gt; 'Company name',</span></pre><pre class="console"><span class="koboSpan" id="kobo.343.1">
      '#required' =&gt; TRUE,</span></pre><pre class="console"><span class="koboSpan" id="kobo.344.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.345.1">
        get('company_name'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.346.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.347.1">
    $form['company_telephone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.348.1">
      '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.349.1">
      '#title' =&gt; 'Company telephone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.350.1">
      '#required' =&gt; TRUE,</span></pre><pre class="console"><span class="koboSpan" id="kobo.351.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.352.1">
        get('company_telephone'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.353.1">
    ];</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.354.1">This is </span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.355.1">achieved by adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">'#required' =&gt; TRUE</span></strong><span class="koboSpan" id="kobo.357.1"> to the form element. </span><span class="koboSpan" id="kobo.357.2">When a form element is marked as </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">required</span></strong><span class="koboSpan" id="kobo.359.1">, Drupal will automatically validate that the field has a non-empty value. </span><span class="koboSpan" id="kobo.359.2">It also specifies the HTML5 </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">required</span></strong><span class="koboSpan" id="kobo.361.1"> attribute on the input, adding </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">client-side validation.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.363.1">Second, we will add input constraints to the telephone form element. </span><span class="koboSpan" id="kobo.363.2">Even though we have an HTML5 </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">tel</span></strong><span class="koboSpan" id="kobo.365.1"> element, it does not validate the </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">input characters:</span></span><pre class="console"><span class="koboSpan" id="kobo.367.1">
    $form['company_telephone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.368.1">
      '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.369.1">
      '#title' =&gt; 'Company telephone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.370.1">
      '#required' =&gt; TRUE,</span></pre><pre class="console"><span class="koboSpan" id="kobo.371.1">
      '#pattern' =&gt; '^[0-9-+\s()]*$',</span></pre><pre class="console"><span class="koboSpan" id="kobo.372.1">
      '#default_value' =&gt; $company_settings-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.373.1">
        get('company_telephone'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.374.1">
    ];</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.375.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">#pattern</span></strong><span class="koboSpan" id="kobo.377.1"> property allows specifying the HTML5 </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">pattern</span></strong><span class="koboSpan" id="kobo.379.1"> attribute on the rendered </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">input</span></strong><span class="koboSpan" id="kobo.381.1"> element. </span><span class="koboSpan" id="kobo.381.2">This pattern expression allows numbers, dashes, and parentheses to be input, but not regular </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">alphabetical characters.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.383.1">Next, we will </span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.384.1">override the </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">validateForm</span></strong><span class="koboSpan" id="kobo.386.1"> method, which allows for </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">programmatic validation:</span></span><pre class="console"><span class="koboSpan" id="kobo.388.1">
  public function validateForm(array &amp;$form, FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.389.1">
    $company_name = $form_state-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.390.1">
        getValue('company_name');</span></pre><pre class="console"><span class="koboSpan" id="kobo.391.1">
    if (str_contains($company_name, 'foo')) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.392.1">
      $form_state-&gt;setErrorByName(</span></pre><pre class="console"><span class="koboSpan" id="kobo.393.1">
        'company_name',</span></pre><pre class="console"><span class="koboSpan" id="kobo.394.1">
        'Name cannot contain "foo"'</span></pre><pre class="console"><span class="koboSpan" id="kobo.395.1">
      );</span></pre><pre class="console"><span class="koboSpan" id="kobo.396.1">
    }</span></pre><pre class="console"><span class="koboSpan" id="kobo.397.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.398.1">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">getValue</span></strong><span class="koboSpan" id="kobo.400.1"> method on the form state to get the submitted value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">company_name</span></strong><span class="koboSpan" id="kobo.402.1">. </span><span class="koboSpan" id="kobo.402.2">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">str_contains</span></strong><span class="koboSpan" id="kobo.404.1">, we check whether the company name contains the word </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">foo</span></strong><span class="koboSpan" id="kobo.406.1">. </span><span class="koboSpan" id="kobo.406.2">If it does, we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">setErrorByName</span></strong><span class="koboSpan" id="kobo.408.1"> method to set an error on the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">company_name</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.410.1"> input.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.411.1">When the form is submitted, the company name cannot contain the </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">word </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.413.1">foo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.415.1"><img alt="Figure 7.2 – The company name field with a validation error" src="image/Figure_7.02_B18548.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.416.1">Figure 7.2 – The company name field with a validation error</span></p>
<h2 id="_idParaDest-222"><a id="_idTextAnchor251"/><span class="koboSpan" id="kobo.417.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.418.1">When a form is submitted, the form builder creates the form state values as a mapping based on </span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.419.1">the incoming user input and the form elements. </span><span class="koboSpan" id="kobo.419.2">The form builder invokes the form validation service. </span><span class="koboSpan" id="kobo.419.3">Form validation runs from the inside out. </span><span class="koboSpan" id="kobo.419.4">The form validation service iterates through each form element and then invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">validateForm</span></strong><span class="koboSpan" id="kobo.421.1"> method for the </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">form class.</span></span></p>
<p><span class="koboSpan" id="kobo.423.1">When an element is validated, this is when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">#required</span></strong><span class="koboSpan" id="kobo.425.1"> attribute is evaluated. </span><span class="koboSpan" id="kobo.425.2">If the form state is missing a value for the element, it is marked as having an error. </span><span class="koboSpan" id="kobo.425.3">The same is true for </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">#pattern</span></strong><span class="koboSpan" id="kobo.427.1">. </span><span class="koboSpan" id="kobo.427.2">The backend still validates the incoming input to make sure it matches the </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">pattern provided.</span></span></p>
<h2 id="_idParaDest-223"><a id="_idTextAnchor252"/><span class="koboSpan" id="kobo.429.1">See also</span></h2>
<ul>
<li><span class="koboSpan" id="kobo.430.1">Additional properties for validation on the form and render elements </span><span class="No-Break"><span class="koboSpan" id="kobo.431.1">documentation: </span></span><a href="https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements"><span class="No-Break"><span class="koboSpan" id="kobo.432.1">https://www.drupal.org/docs/drupal-apis/form-api/form-render-elements</span></span></a></li>
</ul>
<h1 id="_idParaDest-224"><a id="_idTextAnchor253"/><span class="koboSpan" id="kobo.433.1">Specifying conditional form elements</span></h1>
<p><span class="koboSpan" id="kobo.434.1">The Form API provides a mechanism for defining form element states. </span><span class="koboSpan" id="kobo.434.2">These states are mapped to </span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.435.1">JavaScript interactions that can control whether an element is required, visible, and more. </span><span class="koboSpan" id="kobo.435.2">In this example, we will demonstrate a form that has a disabled submit button until a checkbox </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">is checked.</span></span></p>
<h2 id="_idParaDest-225"><a id="_idTextAnchor254"/><span class="koboSpan" id="kobo.437.1">How to do it…</span></h2>
<ol>
<li value="1"><span class="koboSpan" id="kobo.438.1">Create a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">ApprovalRequiredForm.php</span></strong><span class="koboSpan" id="kobo.440.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">src/Form</span></strong><span class="koboSpan" id="kobo.442.1"> directory for your module to hold the </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">ApprovalRequiredForm</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.444.1">form class.</span></span></li>
<li><span class="koboSpan" id="kobo.445.1">We will define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">ApprovalRequiredForm</span></strong><span class="koboSpan" id="kobo.447.1"> class with a form ID </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">mymodule_approval_form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">:</span></span><pre class="console"><span class="koboSpan" id="kobo.451.1">
&lt;?php</span></pre><pre class="console"><span class="koboSpan" id="kobo.452.1">
namespace Drupal\mymodule\Form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.453.1">
use Drupal\Core\Form\FormBase;</span></pre><pre class="console"><span class="koboSpan" id="kobo.454.1">
use Drupal\Core\Form\FormStateInterface;</span></pre><pre class="console"><span class="koboSpan" id="kobo.455.1">
class ApprovalRequiredForm extends FormBase {</span></pre><pre class="console"><span class="koboSpan" id="kobo.456.1">
  public function getFormId() {</span></pre><pre class="console"><span class="koboSpan" id="kobo.457.1">
    return 'mymodule_approval_form';</span></pre><pre class="console"><span class="koboSpan" id="kobo.458.1">
  }</span></pre><pre class="console"><span class="koboSpan" id="kobo.459.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.460.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.461.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.462.1">
  }</span></pre><pre class="console"><span class="koboSpan" id="kobo.463.1">
  public function submitForm(array &amp;$form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.464.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.465.1">
  }</span></pre><pre class="console"><span class="koboSpan" id="kobo.466.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.467.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">buildForm</span></strong><span class="koboSpan" id="kobo.469.1"> method, we will start by creating a </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">checkbox</span></strong><span class="koboSpan" id="kobo.471.1"> element that will </span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.472.1">be required for submitting the form and controlling the state of our </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">submit button:</span></span><pre class="console"><span class="koboSpan" id="kobo.474.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.475.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.476.1">
    $form['approval'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.477.1">
      '#type' =&gt; 'checkbox',</span></pre><pre class="console"><span class="koboSpan" id="kobo.478.1">
      '#title' =&gt; 'I acknowledge',</span></pre><pre class="console"><span class="koboSpan" id="kobo.479.1">
      '#required' =&gt; TRUE,</span></pre><pre class="console"><span class="koboSpan" id="kobo.480.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.481.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.482.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.483.1">We add a checkbox and mark it as </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">#required</span></strong><span class="koboSpan" id="kobo.485.1">, so that the form has client-side validation of the checkbox and </span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">backend validation.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.487.1">Next, we </span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.488.1">add our submit button. </span><span class="koboSpan" id="kobo.488.2">This will contain the logic to control its state based on </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">the checkbox:</span></span><pre class="console"><span class="koboSpan" id="kobo.490.1">
    $form['actions']['#type'] = 'actions';</span></pre><pre class="console"><span class="koboSpan" id="kobo.491.1">
    $form['actions']['submit'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.492.1">
      '#type' =&gt; 'submit',</span></pre><pre class="console"><span class="koboSpan" id="kobo.493.1">
      '#value' =&gt; 'Submit',</span></pre><pre class="console"><span class="koboSpan" id="kobo.494.1">
      '#states' =&gt; [</span></pre><pre class="console"><span class="koboSpan" id="kobo.495.1">
        'disabled' =&gt; [</span></pre><pre class="console"><span class="koboSpan" id="kobo.496.1">
          ':input[name="approval"]' =&gt; ['checked' =&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.497.1">
            FALSE],</span></pre><pre class="console"><span class="koboSpan" id="kobo.498.1">
        ],</span></pre><pre class="console"><span class="koboSpan" id="kobo.499.1">
      ],</span></pre><pre class="console"><span class="koboSpan" id="kobo.500.1">
    ];</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.501.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">#states</span></strong><span class="koboSpan" id="kobo.503.1"> property of an element allows you to specify a state and the conditions that trigger it via element selectors to other inputs. </span><span class="koboSpan" id="kobo.503.2">We want the button to be in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">disabled</span></strong><span class="koboSpan" id="kobo.505.1"> state if our checkbox </span><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">approval</span></strong><span class="koboSpan" id="kobo.507.1"> is </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1">not checked.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.509.1">Add a new route to make the form accessible at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">approval-form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.512.1"> path:</span></span><pre class="console"><span class="koboSpan" id="kobo.513.1">
mymodule.approval_form:</span></pre><pre class="console"><span class="koboSpan" id="kobo.514.1">
  path: /approval-form</span></pre><pre class="console"><span class="koboSpan" id="kobo.515.1">
  defaults:</span></pre><pre class="console"><span class="koboSpan" id="kobo.516.1">
    _form: Drupal\mymodule\Form\ApprovalRequiredForm</span></pre><pre class="console"><span class="koboSpan" id="kobo.517.1">
    _title: Approval form</span></pre><pre class="console"><span class="koboSpan" id="kobo.518.1">
  requirements:</span></pre><pre class="console"><span class="koboSpan" id="kobo.519.1">
    _access: 'TRUE'</span></pre></li>
<li><span class="koboSpan" id="kobo.520.1">Rebuild your Drupal site’s cache to make it aware of the </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1">new route:</span></span><pre class="console"><span class="koboSpan" id="kobo.522.1">
php vendor/bin/drush cr</span></pre></li>
<li><span class="koboSpan" id="kobo.523.1">Now, you may visit </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">/approval-form</span></strong><span class="koboSpan" id="kobo.525.1"> and use the form. </span><span class="koboSpan" id="kobo.525.2">The submit button will be </span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.526.1">disabled until the checkbox </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">is checked:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.528.1"><img alt="Figure 7.3 – Approval form with its submit button disabled until the checkbox is checked" src="image/Figure_7.03_B18548.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.529.1">Figure 7.3 – Approval form with its submit button disabled until the checkbox is checked</span></p>
<h2 id="_idParaDest-226"><a id="_idTextAnchor255"/><span class="koboSpan" id="kobo.530.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.531.1">The Form API bridges PHP code to JavaScript code with its element states capabilities. </span><span class="koboSpan" id="kobo.531.2">When the form is processed, the values from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">#states</span></strong><span class="koboSpan" id="kobo.533.1"> property are JSON encoded and added to the rendered element as the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">data-drupal-states</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.535.1"> attribute.</span></span></p>
<p><span class="koboSpan" id="kobo.536.1">Here is the result of </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">data-drupal-states</span></strong><span class="koboSpan" id="kobo.538.1"> on the form’s </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">submit button:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.540.1">
data-drupal-states="{&amp;quot;disabled&amp;quot;:{&amp;quot;:input
  [name=\u0022approval\u0022]&amp;quot;:{&amp;quot;checked&amp;quot;
    :false}}}"</span></pre>
<p><span class="koboSpan" id="kobo.541.1">When a form has states, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">core/misc/states.js</span></strong><span class="koboSpan" id="kobo.543.1"> JavaScript file is added to the page. </span><span class="koboSpan" id="kobo.543.2">This file uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">[data-drupal-states]</span></strong><span class="koboSpan" id="kobo.545.1"> CSS selector to find all elements with state data. </span><span class="koboSpan" id="kobo.545.2">This data is then parsed as JSON and evaluated. </span><span class="koboSpan" id="kobo.545.3">The states provided to an element </span><a id="_idIndexMarker411"/><span class="koboSpan" id="kobo.546.1">will not work if they do not provide correct CSS selectors to the element that controls </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">their state.</span></span></p>
<p><span class="koboSpan" id="kobo.548.1">The documentation for the states provides information on the available states and </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">conditions: </span></span><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormHelper.php/function/FormHelper%3A%3AprocessStates/10.0.x"><span class="No-Break"><span class="koboSpan" id="kobo.550.1">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Form%21FormHelper.php/function/FormHelper%3A%3AprocessStates/10.0.x</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.551.1">.</span></span></p>
<h1 id="_idParaDest-227"><a id="_idTextAnchor256"/><span class="koboSpan" id="kobo.552.1">Using AJAX in a Drupal form</span></h1>
<p><span class="koboSpan" id="kobo.553.1">The Form </span><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.554.1">API has a mechanism to perform AJAX requests without writing any JavaScript. </span><span class="koboSpan" id="kobo.554.2">In this example, we will create a counter with an increment and </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">decrement button.</span></span></p>
<h2 id="_idParaDest-228"><a id="_idTextAnchor257"/><span class="koboSpan" id="kobo.556.1">How to do it…</span></h2>
<ol>
<li value="1"><span class="koboSpan" id="kobo.557.1">Create a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">CounterForm.php</span></strong><span class="koboSpan" id="kobo.559.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">src/Form</span></strong><span class="koboSpan" id="kobo.561.1"> directory for your module to hold the </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">CounterForm</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.563.1">form class.</span></span></li>
<li><span class="koboSpan" id="kobo.564.1">We will define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">CounterForm</span></strong><span class="koboSpan" id="kobo.566.1"> class with a form ID </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">mymodule_counter_form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">:</span></span><pre class="console"><span class="koboSpan" id="kobo.570.1">
&lt;?php</span></pre><pre class="console"><span class="koboSpan" id="kobo.571.1">
namespace Drupal\mymodule\Form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.572.1">
use Drupal\Core\Form\FormBase;</span></pre><pre class="console"><span class="koboSpan" id="kobo.573.1">
use Drupal\Core\Form\FormStateInterface;</span></pre><pre class="console"><span class="koboSpan" id="kobo.574.1">
class CounterForm extends FormBase {</span></pre><pre class="console"><span class="koboSpan" id="kobo.575.1">
  public function getFormId() {</span></pre><pre class="console"><span class="koboSpan" id="kobo.576.1">
    return 'mymodule_counter_form';</span></pre><pre class="console"><span class="koboSpan" id="kobo.577.1">
  }</span></pre><pre class="console"><span class="koboSpan" id="kobo.578.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.579.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.580.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.581.1">
  }</span></pre><pre class="console"><span class="koboSpan" id="kobo.582.1">
  public function submitForm(array &amp;$form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.583.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.584.1">
  }</span></pre><pre class="console"><span class="koboSpan" id="kobo.585.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.586.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">buildForm</span></strong><span class="koboSpan" id="kobo.588.1"> method, we will start by creating an element to display our counter value. </span><span class="koboSpan" id="kobo.588.2">This </span><a id="_idIndexMarker413"/><span class="koboSpan" id="kobo.589.1">element will be replaced and updated after each AJAX request with the </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">current count:</span></span><pre class="console"><span class="koboSpan" id="kobo.591.1">
  public function buildForm(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.592.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.593.1">
    $count = $form_state-&gt;get('count') ?: 0;</span></pre><pre class="console"><span class="koboSpan" id="kobo.594.1">
    $form['count'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.595.1">
      '#markup' =&gt; "&lt;p&gt;Total count: $count",</span></pre><pre class="console"><span class="koboSpan" id="kobo.596.1">
    ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.597.1">
    return $form;</span></pre><pre class="console"><span class="koboSpan" id="kobo.598.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.599.1">We will use the form state storage to maintain the </span><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">count</span></strong><span class="koboSpan" id="kobo.601.1"> value. </span><span class="koboSpan" id="kobo.601.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">get</span></strong><span class="koboSpan" id="kobo.603.1"> method allows retrieving values from the form state storage. </span><span class="koboSpan" id="kobo.603.2">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">?:</span></strong><span class="koboSpan" id="kobo.605.1"> operator to make sure the default value is zero when the form is first loaded. </span><span class="koboSpan" id="kobo.605.2">Otherwise, the value would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.606.1">null</span></strong><span class="koboSpan" id="kobo.607.1">, which is not an integer. </span><span class="koboSpan" id="kobo.607.2">The form state value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.608.1">count</span></strong><span class="koboSpan" id="kobo.609.1"> will be updated in our </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">AJAX callback.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.611.1">In order for </span><a id="_idIndexMarker414"/><span class="koboSpan" id="kobo.612.1">Drupal to properly update our element after each AJAX request, we need to wrap it with an element that has an HTML ID that we </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">can target:</span></span><pre class="console"><span class="koboSpan" id="kobo.614.1">
    $form['count'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.615.1">
      '#markup' =&gt; "&lt;p&gt;Total count: $count",</span></pre><pre class="console"><span class="koboSpan" id="kobo.616.1">
      '#prefix' =&gt; '&lt;div id="counter"&gt;',</span></pre><pre class="console"><span class="koboSpan" id="kobo.617.1">
      '#suffix' =&gt; '&lt;/div&gt;',</span></pre><pre class="console"><span class="koboSpan" id="kobo.618.1">
    ];</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.619.1">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">#prefix</span></strong><span class="koboSpan" id="kobo.621.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">#suffix</span></strong><span class="koboSpan" id="kobo.623.1"> keys to wrap our form element with HTML markup. </span><span class="koboSpan" id="kobo.623.2">This gives us a wrapper element to target for the </span><span class="No-Break"><span class="koboSpan" id="kobo.624.1">AJAX update.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.625.1">Next, we will add the button that will trigger the AJAX call to increment </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">our counter:</span></span><pre class="console"><span class="koboSpan" id="kobo.627.1">
    $form['increment'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.628.1">
      '#type' =&gt; 'submit',</span></pre><pre class="console"><span class="koboSpan" id="kobo.629.1">
      '#value' =&gt; 'Increment',</span></pre><pre class="console"><span class="koboSpan" id="kobo.630.1">
      '#ajax' =&gt; [</span></pre><pre class="console"><span class="koboSpan" id="kobo.631.1">
        'callback' =&gt; [$this, 'ajaxRefresh'],</span></pre><pre class="console"><span class="koboSpan" id="kobo.632.1">
        'wrapper' =&gt; 'counter',</span></pre><pre class="console"><span class="koboSpan" id="kobo.633.1">
      ],</span></pre><pre class="console"><span class="koboSpan" id="kobo.634.1">
    ];</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.635.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">#ajax</span></strong><span class="koboSpan" id="kobo.637.1"> property allows an element to execute an AJAX request to interact with the form. </span><span class="koboSpan" id="kobo.637.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">#ajax</span></strong><span class="koboSpan" id="kobo.639.1"> property requires specifying a callback that contains a method to invoke for specifying what parts of the form to return, which we will implement next. </span><span class="koboSpan" id="kobo.639.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">wrapper</span></strong><span class="koboSpan" id="kobo.641.1"> property contains the target HTML ID for an element that should </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">be updated.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.643.1">Now, we will </span><a id="_idIndexMarker415"/><span class="koboSpan" id="kobo.644.1">implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.645.1">ajaxRefresh</span></strong><span class="koboSpan" id="kobo.646.1"> method in our class that we specified for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">#</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.648.1">ajax</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.649.1"> callback:</span></span><pre class="console"><span class="koboSpan" id="kobo.650.1">
  public function ajaxRefresh(array $form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.651.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.652.1">
    return $form['count'];</span></pre><pre class="console"><span class="koboSpan" id="kobo.653.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.654.1">The callback to an </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">#ajax</span></strong><span class="koboSpan" id="kobo.656.1"> property is responsible for returning the subset of the form that should </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">be replaced.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.658.1">Then, we must update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">submitForm</span></strong><span class="koboSpan" id="kobo.660.1"> method to increment our counter whenever the increment button </span><span class="No-Break"><span class="koboSpan" id="kobo.661.1">is pressed:</span></span><pre class="console"><span class="koboSpan" id="kobo.662.1">
  public function submitForm(array &amp;$form,</span></pre><pre class="console"><span class="koboSpan" id="kobo.663.1">
    FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.664.1">
    $count = $form_state-&gt;get('count') ?: 0;</span></pre><pre class="console"><span class="koboSpan" id="kobo.665.1">
    $count++;</span></pre><pre class="console"><span class="koboSpan" id="kobo.666.1">
    $form_state-&gt;set('count', $count);</span></pre><pre class="console"><span class="koboSpan" id="kobo.667.1">
    $form_state-&gt;setRebuild();</span></pre><pre class="console"><span class="koboSpan" id="kobo.668.1">
  }</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.669.1">We retrieve the </span><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">count</span></strong><span class="koboSpan" id="kobo.671.1"> value from the form state storage and then set it again after incrementing the value. </span><span class="koboSpan" id="kobo.671.2">We then call </span><strong class="source-inline"><span class="koboSpan" id="kobo.672.1">setRebuild</span></strong><span class="koboSpan" id="kobo.673.1"> on the form state. </span><span class="koboSpan" id="kobo.673.2">This instructs Drupal to rebuild the form, so the updated </span><strong class="source-inline"><span class="koboSpan" id="kobo.674.1">count</span></strong><span class="koboSpan" id="kobo.675.1"> value </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">is shown.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.677.1">Add a new </span><a id="_idIndexMarker416"/><span class="koboSpan" id="kobo.678.1">route to make the form accessible at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.679.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">counter-form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.681.1"> path:</span></span><pre class="console"><span class="koboSpan" id="kobo.682.1">
mymodule.counter_form:</span></pre><pre class="console"><span class="koboSpan" id="kobo.683.1">
  path: /counter-form</span></pre><pre class="console"><span class="koboSpan" id="kobo.684.1">
  defaults:</span></pre><pre class="console"><span class="koboSpan" id="kobo.685.1">
    _form: Drupal\mymodule\Form\CounterForm</span></pre><pre class="console"><span class="koboSpan" id="kobo.686.1">
    _title: Counter form</span></pre><pre class="console"><span class="koboSpan" id="kobo.687.1">
  requirements:</span></pre><pre class="console"><span class="koboSpan" id="kobo.688.1">
    _access: 'TRUE'</span></pre></li>
<li><span class="koboSpan" id="kobo.689.1">Rebuild your Drupal site’s cache to make it aware of the </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">new route:</span></span><pre class="console"><span class="koboSpan" id="kobo.691.1">
php vendor/bin/drush cr</span></pre></li>
<li><span class="koboSpan" id="kobo.692.1">Now you may visit </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1">/counter-form</span></strong><span class="koboSpan" id="kobo.694.1"> and use </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">the form:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.696.1"><img alt="Figure 7.4 – The counter form" src="image/Figure_7.04_B18548.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.697.1">Figure 7.4 – The counter form</span></p>
<h2 id="_idParaDest-229"><a id="_idTextAnchor258"/><span class="koboSpan" id="kobo.698.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.699.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">#ajax</span></strong><span class="koboSpan" id="kobo.701.1"> property on a form element is processed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.702.1">\Drupal\Core\Render\Element\RenderElement::preRenderAjaxForm</span></strong><span class="koboSpan" id="kobo.703.1">. </span><span class="koboSpan" id="kobo.703.2">This is </span><a id="_idIndexMarker417"/><span class="koboSpan" id="kobo.704.1">invoked on each element as part of building the form. </span><span class="koboSpan" id="kobo.704.2">It attaches the default events that will trigger the AJAX call. </span><span class="koboSpan" id="kobo.704.3">For buttons, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">mousedown</span></strong><span class="koboSpan" id="kobo.706.1"> JavaScript event is used. </span><span class="koboSpan" id="kobo.706.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">mousedown</span></strong><span class="koboSpan" id="kobo.708.1"> event was used for buttons for accessibility, as pressing </span><em class="italic"><span class="koboSpan" id="kobo.709.1">Enter</span></em><span class="koboSpan" id="kobo.710.1"> in other elements can trigger a click on a form button. </span><span class="koboSpan" id="kobo.710.2">Input text fields are on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">blur</span></strong><span class="koboSpan" id="kobo.712.1"> event. </span><span class="koboSpan" id="kobo.712.2">Radios, checkboxes, select lists, and date fields are on the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">click</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.714.1"> event.</span></span></p>
<p><span class="koboSpan" id="kobo.715.1">When an AJAX button is triggered on a form, it is submitted. </span><span class="koboSpan" id="kobo.715.2">The form’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">submitForm</span></strong><span class="koboSpan" id="kobo.717.1"> method is invoked. </span><span class="koboSpan" id="kobo.717.2">Then, the element’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">#ajax</span></strong><span class="koboSpan" id="kobo.719.1"> callback is invoked to return the form. </span><span class="koboSpan" id="kobo.719.2">However, if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">submitForm</span></strong><span class="koboSpan" id="kobo.721.1"> method calls for the form to be rebuilt, as we did with </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">setRebuild</span></strong><span class="koboSpan" id="kobo.723.1"> on the form state, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">buildForm</span></strong><span class="koboSpan" id="kobo.725.1"> method is called before the </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">#ajax</span></strong><span class="koboSpan" id="kobo.727.1"> callback. </span><span class="koboSpan" id="kobo.727.2">This allows the returned form elements to match the current form state’s values </span><span class="No-Break"><span class="koboSpan" id="kobo.728.1">and storage.</span></span></p>
<h2 id="_idParaDest-230"><a id="_idTextAnchor259"/><span class="koboSpan" id="kobo.729.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.730.1">In the following sections, we will explore how the Form APIs AJAX capabilities can also </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">be used.</span></span></p>
<h3><span class="koboSpan" id="kobo.732.1">Specifying the event to trigger when AJAX is fired</span></h3>
<p><span class="koboSpan" id="kobo.733.1">It is </span><a id="_idIndexMarker418"/><span class="koboSpan" id="kobo.734.1">possible to change the JavaScript event that triggers when the AJAX is triggered for an element. </span><span class="koboSpan" id="kobo.734.2">This is accomplished by specifying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">type</span></strong><span class="koboSpan" id="kobo.736.1"> property in </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1">#ajax</span></strong><span class="koboSpan" id="kobo.738.1">. </span><span class="koboSpan" id="kobo.738.2">For instance, the following would cause AJAX to fire on a text element with each keystroke instead of when the text element </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">loses focus:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.740.1">
$element['#ajax']['type'] = 'keyup';</span></pre>
<p class="callout-heading"><span class="koboSpan" id="kobo.741.1">Using AJAX in a custom template</span></p>
<p class="callout"><span class="koboSpan" id="kobo.742.1">If you are using AJAX on a page that is output with a template, note that you must render your form in the template as </span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">{{ form|without(IDs of named form elements using </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">AJAX) }}</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">.</span></span></p>
<h2 id="_idParaDest-231"><a id="_idTextAnchor260"/><span class="koboSpan" id="kobo.746.1">See also</span></h2>
<ul>
<li><span class="koboSpan" id="kobo.747.1">AJAX forms </span><a id="_idIndexMarker419"/><span class="No-Break"><span class="koboSpan" id="kobo.748.1">documentation: </span></span><a href="https://www.drupal.org/docs/drupal-apis/javascript-api/ajax-forms"><span class="No-Break"><span class="koboSpan" id="kobo.749.1">https://www.drupal.org/docs/drupal-apis/javascript-api/ajax-forms</span></span></a></li>
</ul>
<h1 id="_idParaDest-232"><a id="_idTextAnchor261"/><span class="koboSpan" id="kobo.750.1">Customizing existing forms in Drupal</span></h1>
<p><span class="koboSpan" id="kobo.751.1">The Form API does not just provide a way to create forms. </span><span class="koboSpan" id="kobo.751.2">There are ways to alter existing </span><a id="_idIndexMarker420"/><span class="koboSpan" id="kobo.752.1">forms through hooks in a custom module. </span><span class="koboSpan" id="kobo.752.2">By </span><a id="_idIndexMarker421"/><span class="koboSpan" id="kobo.753.1">using this technique, new elements can be added, default values can be changed, and elements can even be hidden from view to simplify the </span><span class="No-Break"><span class="koboSpan" id="kobo.754.1">user experience.</span></span></p>
<p><span class="koboSpan" id="kobo.755.1">The altering of a form does not happen in a custom class; this is a hook defined in the module file. </span><span class="koboSpan" id="kobo.755.2">In this recipe, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">hook_form_FORM_ID_alter()</span></strong><span class="koboSpan" id="kobo.757.1"> hook to add a telephone field to the site’s </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">configuration form.</span></span></p>
<h2 id="_idParaDest-233"><a id="_idTextAnchor262"/><span class="koboSpan" id="kobo.759.1">How to do it…</span></h2>
<ol>
<li value="1"><span class="koboSpan" id="kobo.760.1">Ensure </span><a id="_idIndexMarker422"/><span class="koboSpan" id="kobo.761.1">that your module has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.762.1">.module</span></strong><span class="koboSpan" id="kobo.763.1"> file to </span><a id="_idIndexMarker423"/><span class="koboSpan" id="kobo.764.1">contain hooks, such </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.766.1">mymodule.module</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.767.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.768.1">We will implement </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">hook_form_FORM_ID_alter</span></strong><span class="koboSpan" id="kobo.770.1"> for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">system_site_information_settings</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.772.1"> form:</span></span><pre class="console"><span class="koboSpan" id="kobo.773.1">
&lt;?php</span></pre><pre class="console"><span class="koboSpan" id="kobo.774.1">
use Drupal\Core\Form\FormStateInterface;</span></pre><pre class="console"><span class="koboSpan" id="kobo.775.1">
function mymodule_form_system_site_information</span></pre><pre class="console"><span class="koboSpan" id="kobo.776.1">
  _settings_alter(array &amp;$form, FormStateInterface</span></pre><pre class="console"><span class="koboSpan" id="kobo.777.1">
    $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.778.1">
  // Code to alter form or form state here</span></pre><pre class="console"><span class="koboSpan" id="kobo.779.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.780.1">Drupal will call this hook and pass the current form array and its form state object. </span><span class="koboSpan" id="kobo.780.2">The form array is passed by reference, allowing our hook to modify the array without returning any values. </span><span class="koboSpan" id="kobo.780.3">This is why the </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">$form</span></strong><span class="koboSpan" id="kobo.782.1"> parameter has the ampersand (</span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1">&amp;</span></strong><span class="koboSpan" id="kobo.784.1">) before it. </span><span class="koboSpan" id="kobo.784.2">In PHP, all objects are passed by reference, which is why we have no ampersand </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">before </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.786.1">$form_state</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.788.1">Form IDs can be found by inspecting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">getFormId</span></strong><span class="koboSpan" id="kobo.790.1"> method of the </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">form class.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.792.1">Next, we add our telephone field to the form so that it can be displayed </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">and saved:</span></span><pre class="console"><span class="koboSpan" id="kobo.794.1">
&lt;?php</span></pre><pre class="console"><span class="koboSpan" id="kobo.795.1">
use Drupal\Core\Form\FormStateInterface;</span></pre><pre class="console"><span class="koboSpan" id="kobo.796.1">
function mymodule_form_system_site_information_</span></pre><pre class="console"><span class="koboSpan" id="kobo.797.1">
  settings_alter(array &amp;$form, FormStateInterface</span></pre><pre class="console"><span class="koboSpan" id="kobo.798.1">
    $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.799.1">
  $form['site_information']['site_phone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.800.1">
    '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.801.1">
    '#title' =&gt; 'Site phone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.802.1">
    '#default_value' =&gt; \Drupal::config('system.site')</span></pre><pre class="console"><span class="koboSpan" id="kobo.803.1">
        -&gt;get('phone'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.804.1">
  ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.805.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.806.1">We retrieve </span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.807.1">the current phone value from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">system.site</span></strong><span class="koboSpan" id="kobo.809.1"> configuration object so that it can be modified if </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">already set.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.811.1">We then </span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.812.1">need to add a submit handler to the form in order to save the configuration for our </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">new field:</span></span><pre class="console"><span class="koboSpan" id="kobo.814.1">
&lt;?php</span></pre><pre class="console"><span class="koboSpan" id="kobo.815.1">
use Drupal\Core\Form\FormStateInterface;</span></pre><pre class="console"><span class="koboSpan" id="kobo.816.1">
function mymodule_form_system_site_information</span></pre><pre class="console"><span class="koboSpan" id="kobo.817.1">
  _settings_alter(array &amp;$form, FormStateInterface</span></pre><pre class="console"><span class="koboSpan" id="kobo.818.1">
    $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.819.1">
  $form['site_information']['site_phone'] = [</span></pre><pre class="console"><span class="koboSpan" id="kobo.820.1">
    '#type' =&gt; 'tel',</span></pre><pre class="console"><span class="koboSpan" id="kobo.821.1">
    '#title' =&gt; 'Site phone',</span></pre><pre class="console"><span class="koboSpan" id="kobo.822.1">
    '#default_value' =&gt; \Drupal::config('system.site')</span></pre><pre class="console"><span class="koboSpan" id="kobo.823.1">
        -&gt;get('phone'),</span></pre><pre class="console"><span class="koboSpan" id="kobo.824.1">
  ];</span></pre><pre class="console"><span class="koboSpan" id="kobo.825.1">
  $form['#submit'][] = 'mymodule_system_site_</span></pre><pre class="console"><span class="koboSpan" id="kobo.826.1">
    information_phone_submit';</span></pre><pre class="console"><span class="koboSpan" id="kobo.827.1">
}</span></pre><pre class="console"><span class="koboSpan" id="kobo.828.1">
function mymodule_system_site_information_phone_submit</span></pre><pre class="console"><span class="koboSpan" id="kobo.829.1">
  (array &amp;$form, FormStateInterface $form_state) {</span></pre><pre class="console"><span class="koboSpan" id="kobo.830.1">
  $config = Drupal::configFactory()-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.831.1">
    getEditable('system.site');</span></pre><pre class="console"><span class="koboSpan" id="kobo.832.1">
  $config -&gt;set('phone', $form_state-&gt;</span></pre><pre class="console"><span class="koboSpan" id="kobo.833.1">
    getValue('site_phone'));</span></pre><pre class="console"><span class="koboSpan" id="kobo.834.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.835.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">$form['#submit']</span></strong><span class="koboSpan" id="kobo.837.1"> modification adds our callback to the form’s submit handlers. </span><span class="koboSpan" id="kobo.837.2">This </span><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.838.1">allows our module to interact with the </span><a id="_idIndexMarker427"/><span class="koboSpan" id="kobo.839.1">form once it has </span><span class="No-Break"><span class="koboSpan" id="kobo.840.1">been submitted.</span></span></p>
<p><span class="koboSpan" id="kobo.841.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">mymodule_system_site_information_phone_submit</span></strong><span class="koboSpan" id="kobo.843.1"> callback is passed the form array and form state. </span><span class="koboSpan" id="kobo.843.2">We load the current configuration factory to receive the configuration that can be edited. </span><span class="koboSpan" id="kobo.843.3">We then load the </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1">system.site</span></strong><span class="koboSpan" id="kobo.845.1"> configuration object and save </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">phone</span></strong><span class="koboSpan" id="kobo.847.1"> based on the value from the </span><span class="No-Break"><span class="koboSpan" id="kobo.848.1">form state.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.849.1">Rebuild your Drupal site’s cache to make it aware of the new hook, so that it will be invoked </span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.850.1">when viewing the site </span><span class="No-Break"><span class="koboSpan" id="kobo.851.1">settings form:</span></span><pre class="console"><span class="koboSpan" id="kobo.852.1">
php vendor/bin/drush cr</span></pre></li>
<li><span class="koboSpan" id="kobo.853.1">Visit the </span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.854.1">site settings configuration form </span><span class="No-Break"><span class="koboSpan" id="kobo.855.1">at </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">/admin/config/system/site-information</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.857.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.858.1"><img alt="Figure 7.5 – The altered site settings form" src="image/Figure_7.05_B18548.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.859.1">Figure 7.5 – The altered site settings form</span></p>
<h2 id="_idParaDest-234"><a id="_idTextAnchor263"/><span class="koboSpan" id="kobo.860.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.861.1">In this recipe, we targeted the specific </span><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">hook_form_FORM_ID_alter()</span></strong><span class="koboSpan" id="kobo.863.1"> alter hook. </span><span class="koboSpan" id="kobo.863.2">There is also the generic </span><strong class="source-inline"><span class="koboSpan" id="kobo.864.1">hook_form_alter()</span></strong><span class="koboSpan" id="kobo.865.1"> hook that is invoked for all forms and allows modifying every form when it is rendered. </span><span class="koboSpan" id="kobo.865.2">This allows for modules to generically modify all forms, if needed, or several different form IDs in one hook. </span><span class="koboSpan" id="kobo.865.3">It also allows for more explicit </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">hook targets.</span></span></p>
<p><span class="koboSpan" id="kobo.867.1">The form array is passed by reference, allowing modifications to be made in this hook and altering the original data. </span><span class="koboSpan" id="kobo.867.2">This allows us to add an element or modify existing items, such as titles </span><span class="No-Break"><span class="koboSpan" id="kobo.868.1">and descriptions.</span></span></p>
</div>
</body></html>