<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;PhpStorm and Phing"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. PhpStorm and Phing</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Connecting Phing and PhpStorm</li><li class="listitem" style="list-style-type: disc">Catching Phing build file syntax problems</li><li class="listitem" style="list-style-type: disc">Building a PhpStorm application using Phing</li><li class="listitem" style="list-style-type: disc">Using a different build file</li><li class="listitem" style="list-style-type: disc">Doing wonders with Phing</li><li class="listitem" style="list-style-type: disc">Using the Phing build view</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec86"/>Introduction</h1></div></div></div><p>Grandma used to say, "Don't copy, be original". Software engineering says, "Don't reinvent the wheel".</p><p>Whom do you trust? Trust software engineering if Grandma was not a software engineer!</p><p>They have copied and they have built great things that way. Saying "copying" could be controversial, so based on what is a more politically correct term to describe copying, let's go with <span class="emphasis"><em>inspiration</em></span>. Thus, to state in diplomatic terms, they have got inspired from an existing software and created a new software altogether.</p><p>But, is this evil? What if that software did not exist? What if that software is quite useful?</p><p>Putting colors in this black-and-white picture, there was software: a build tool available for another language, Java, with the name Ant. People (the programmers) who were PHP enthusiasts thought of having a similar build tool, so some good people toiled hard and created <span class="strong"><strong>Phing</strong></span>
<a id="id457" class="indexterm"/> for the task. Thus, Phing has become a build tool for PHP, and it is said that Phing is Ant-based.</p><p>Some PHP programmers will say that when PHP gets interpreted, what is the need to have a separate tool for it? What is the use of creating a bundle when the PHP source code has to be given to the client? A simple directory containing the PHP scripts could suffice. The simplest and the most apt answer to this is that when you are a software engineer; you should always have everything automated—even the simplest of tasks as this one. Phing automates a number of processes: anything that you can imagine (in the PHP context). You can create an archive, check out code, deploy code, clean up logs, back up code—just think and there will be Phing (intentional rhyme).</p><p>When you work with Phing, you also need to understand what goes on under the hood. So, you write down instructions in the XML format based on some rules. These XML-based instructions are known as tasks for Phing. These tasks can be many, and the files that contain these tasks, again, can be many. It is worth noting here that you need to use proper (and documented) wisdom while separating tasks (or grouping tasks) because the more you stick to the principles of software engineering, the easier you will handle the compartmentalization better. Phing, in itself, is a code written in PHP (as already stated). This code, when executed, reads from the XML file you have written and obediently follows what has been written (provided the XML document itself is well formatted and adheres to the Phing XML rule). You can call this XML file the build file because that is its common name. </p><p>Did you notice that Phing has a strange name? It sounds more like an indicative sound of a commercial advertisement in between radio relay. Jokes apart, Phing is a recursive acronym—do you remember the first time you heard this word? Just remember that when you cannot remember anything, better start from the beginning (pun intended). Phing stands for <span class="strong"><strong>PH</strong></span>ing <span class="strong"><strong>I</strong></span>s <span class="strong"><strong>N</strong></span>ot <span class="strong"><strong>G</strong></span>nu's make. God bless those who run so short on names.</p></div></div>
<div class="section" title="Connecting Phing and PhpStorm"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec87"/>Connecting Phing and PhpStorm</h1></div></div></div><p>Having obtained some very <a id="id458" class="indexterm"/>basic information about Phing, now is the time for<a id="id459" class="indexterm"/> you to have some real-world action! Without PhpStorm, the action would have been centered on Phing, but since you are cooking with PhpStorm, you need to have a view from added angles. Thus, a probable roadmap for you would be to get Phing, install it locally on your development machine, and tell PhpStorm that Phing has been installed and that it needs to work in synchronization with Phing. Actually, PhpStorm makes use of the functionality that Phing provides.</p><p>Before we delve into the depths of building a build file, it is worth noting a few of the major features of Phing, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Simple XML build files</li><li class="listitem" style="list-style-type: disc">Rich set of provided tasks</li><li class="listitem" style="list-style-type: disc">Easily extendable via PHP classes</li><li class="listitem" style="list-style-type: disc">Platform-independent</li><li class="listitem" style="list-style-type: disc">No required external dependencies<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip31"/>Tip</h3><p>If you want to read more about Phing tasks, I recommend that you visit the official website of <a id="id460" class="indexterm"/>Phing (<a class="ulink" href="http://www.phing.info/">http://www.phing.info/</a>).</p></div></div></li></ul></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec201"/>How to do it...</h2></div></div></div><p>To get Phing is <a id="id461" class="indexterm"/>everyone's cup of tea indeed. It can be downloaded<a id="id462" class="indexterm"/> as a phar using the command <code class="literal">wget -c http://www.phing.info/get/phing-latest.phar</code>. You can run this command in the terminal (which is accessible through <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>F12</em></span>). Once you do that, with a working Internet connection, you can have this phar downloaded. You need to note the path where the file has been loaded. It is recommended that you move the executables under a common folder that is not modified (doesn't have write permissions associated with it). It is not that there would be errors in it—doing that is good practice and keeps the operating system files and directories organized.</p><p>Having obtained the phar, it is time to tell PhpStorm about Phing. You need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the <span class="strong"><strong>Project</strong></span> view. Locate <span class="strong"><strong>External Libraries</strong></span>.</li><li class="listitem">Access the right-click context menu, and select the <span class="strong"><strong>Configure PHP include paths</strong></span> option.</li><li class="listitem">Provide the full path to the location where you downloaded (or moved) the package.</li></ol></div><p>Bingo! You successfully told PhpStorm that you added a new library for the open project.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip32"/>Tip</h3><p>To make Phing available for all applications running PHP, you can add it to the PHP master include path—something like <code class="literal">/usr/share/php5</code>.</p></div></div><p>At this time, if you wish to check what changes were applied when you installed Phing, you won't be successful. You won't be able to see any Phing-related menu item anywhere in PhpStorm. You won't be able to see any extra icons, nor any extra views related to Phing. It  would be natural for you to start considering that something was left out during the installation of Phing. Not to worry mate, stay tuned!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec202"/>How it works…</h2></div></div></div><p>To unleash the power of Phing, you need to execute it. To execute it, you need to have it installed. But you have already installed Phing, and you are not sure whether it got installed properly or not. This seems like a vicious circle. Phing needs an input file to understand what it has to do. This is known as the <a id="id463" class="indexterm"/>
<span class="strong"><strong>build file</strong></span>. So, you need to create a new build file inside your project. A build file is an XML document and is based on some rules. The default name is <code class="literal">build.xml</code>. So, a very basic build file looks somewhat like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="firstTask" default="firstTask"&gt;
&lt;target name="firstTask"&gt;
&lt;echo message="Testing Message 12...4"&gt;&lt;/echo&gt;
&lt;/target&gt;
&lt;/project&gt;</pre></div><p>Having done this, you need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Project view and select the build file.</li><li class="listitem">Access the right-click context menu.</li><li class="listitem">There will be a new option (magic!) available with the name <span class="strong"><strong>Add as Phing build file</strong></span>. Select that option.</li></ol></div><p>In order to check<a id="id464" class="indexterm"/> for successful integration, you can select <span class="strong"><strong>View</strong></span> | <span class="strong"><strong>Tool windows</strong></span>, and you will <a id="id465" class="indexterm"/>be able to see a new option available, <span class="strong"><strong>Phing Build</strong></span>. If you can see this new option, congratulations, you have successfully connected Phing to PhpStorm.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note31"/>Note</h3><p>While creating a build file, PhpStorm needs to have at least one target specified. If you leave a build file empty, PhpStorm will be your friend in need.</p></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec203"/>There's more…</h2></div></div></div><p>Since Phing is a software written in PHP, PhpStorm wants to have this software well within its reach. So, you add the include path to the project to achieve this target. When PhpStorm has Phing within reach, it attempts to create some options for Phing. For this purpose, it looks up to find out the build file and hence the targets. Once it finds the targets, it understands the targets and then creates the necessary options.</p></div></div>
<div class="section" title="Catching Phing build file syntax problems"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec88"/>Catching Phing build file syntax problems</h1></div></div></div><p>Now that you have worked <a id="id466" class="indexterm"/>hard to connect PhpStorm and Phing, you <a id="id467" class="indexterm"/>must know what drives Phing. What is it that allows you to do wonders with Phing? What is it that makes your life easier and makes adherence to the principles of software engineering easier? The name you had to think of was build file. Yes, it is the build file that controls the behavior of Phing. Yes, using build file, you can do wonders with Phing. Yes, using build file, you can perform tasks in a clean way—thus adhering to the principles of software engineering.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec204"/>Getting ready</h2></div></div></div><p>It's perfectly okay that you can write a new build file to perform tasks with Phing. But this question looms large—How do you check whether the build file you wrote is syntactically OK. Come on, if you say that you do not create mistakes while writing, you must be JARVIS and no human being. To err is human, to check and remove that error is <span class="emphasis"><em>PhpStorm-ine</em></span>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec205"/>How to do it…</h2></div></div></div><p>Before starting off <a id="id468" class="indexterm"/>writing build files, you need to know some<a id="id469" class="indexterm"/> very basic rules so that you can at least test a demonstration or Hello World actions in Phing. (Yes, you heard it right: it is possible to create a <code class="literal">Hello World</code> message using Phing.) A build file is valid to be used by Phing only when:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The file contains an opening and closing project tag. There should be only one, and it should be the root node of the XML tree. Inside the project tag, the file should contain at least one target tag: tags such as <code class="literal">property</code>, <code class="literal">tstamp</code>, and <code class="literal">propertyprompt</code>.</li><li class="listitem">Now, revisiting the same build file, you will be able to understand the build file better—a second attempt makes you more mature as compared to the first attempt. Here, take a look at the following code:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="hello-world" default="firstTask"&gt;
&lt;target name="firstTask"&gt;
&lt;echo message="Testing Message 12...4"&gt;&lt;/echo&gt;
&lt;/target&gt;
&lt;/project&gt;</pre></div></li><li class="listitem">In order to check the syntax, the inspection has to be taken care of. There is an icon provided in the bottom status bar. You need to click on it and set the<span class="strong"><strong> Power Save Mode</strong></span> to off and the highlighting level to <span class="strong"><strong>Inspections</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3878OT_07_01.jpg" alt="How to do it…"/></div></li><li class="listitem">It is time for you<a id="id470" class="indexterm"/> to play around with the <a id="id471" class="indexterm"/>build file. Not to worry, there is the local history to save you—you can revert to some changes at will. So, whenever you make mistakes in the syntax, PhpStorm shows you errors:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you specify an incorrect start tag, a red underline will be shown in the nearest matching tags and the status bar shows a message <span class="strong"><strong>Start tag has wrong closing tag</strong></span>.</li><li class="listitem" style="list-style-type: disc">The wrong closing tag name will show a red underline in the incorrect tag and the nearest matching tag and the status bar at the bottom shows a message <span class="strong"><strong>Wrong closing tag name</strong></span>.</li><li class="listitem" style="list-style-type: disc">If you specify a tag that is not defined in the rule list of Phing, there are a number of ways in which the problem will be shown, such as the following screenshot:<div class="mediaobject"><img src="graphics/3878OT_07_02.jpg" alt="How to do it…"/></div></li><li class="listitem" style="list-style-type: disc">If you <a id="id472" class="indexterm"/>specify<a id="id473" class="indexterm"/> an attribute that is not defined or allowed for a tag, the incorrect attribute changes color to red, and the status bar shows the message <span class="strong"><strong>Attribute &lt;incorrect-attribute&gt; is not allowed here</strong></span>.</li><li class="listitem" style="list-style-type: disc">If you forget to specify the end tag for a tag, the status bar will show the message <span class="strong"><strong>Element &lt;element-without-closing-tag&gt; is not closed</strong></span>.</li></ul></div><p>
<span class="emphasis"><em>PhpStorm </em></span>at your disposal again, proves PhpStorm.</p></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip33"/>Tip</h3><p>Since you will often write tasks for Phing, you can also create a new template for the build file. To do that, you need to select the <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> option and select the <span class="strong"><strong>Edit file templates</strong></span> option. In the window that appears, you need to add the name of this template (which will appear whenever you select <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span>) and the extension of this template (you need to specify <code class="literal">.xml</code>) and put in the content of the most basic build file that you will always require. Clicking on <span class="strong"><strong>OK</strong></span> will save this template.</p></div></div><p>The following screenshot shows a Phing file:</p><div class="mediaobject"><img src="graphics/3878OT_07_03.jpg" alt="How to do it…"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec206"/>How it works…</h2></div></div></div><p>PhpStorm<a id="id474" class="indexterm"/> inspects code on the fly. Thus, the general<a id="id475" class="indexterm"/> rules of inspection are applicable on the build file as well. This setting can be turned on or off by selecting <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Inspection</strong></span> | <span class="strong"><strong>Phing</strong></span> | <span class="strong"><strong>Phing inspections</strong></span>. So, as you keep on typing, the inspector keeps on checking what you write and continues showing you warnings visually.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec207"/>There's more…</h2></div></div></div><p>If you want to disable the inspections, you can do it in such a way that all inspections are turned off. Though not recommended, it can be handy in the case of large files.</p></div></div>
<div class="section" title="Building a PhpStorm application using Phing"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec89"/>Building a PhpStorm application using Phing</h1></div></div></div><p>So, it is time for you to <a id="id476" class="indexterm"/>have<a id="id477" class="indexterm"/> some real-world action using Phing. It is time to give the problem of using Phing a shot (and get hurt by its shots as well). It is time for you to do something useful for the business of which you are the backbone. Fasten your helmet and set out to work in the sun.</p><p>The general meaning of build in other languages that require compilation is to compile the code, link the objects together, and create an executable. In PHP, though, you cannot compile the code; it is interpreted, dear: you can emulate the build process. How? Stay tuned.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec208"/>Getting ready</h2></div></div></div><p>To start with, you <a id="id478" class="indexterm"/>need to recall that you were hungry<a id="id479" class="indexterm"/> once! You must not forget certain things in life—one of them being your hunger. It makes you aware that you still need to work hard to earn bread to appease this hunger. So, when you were hungry, you just entered your kitchen and attempted to cook some pizza for yourself. Right? If you wish to pass on this same system that cooked pizza for you, what will your action be? You need to create a build file for Phing and write some targets and actions in it so that you are able to group together the necessary components and pass it on in one single unit.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec209"/>How to do it…</h2></div></div></div><p>To create a new build file, you need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the <span class="strong"><strong>Project</strong></span> view.</li><li class="listitem">Select the appropriate directory, and select the build file type from the right-click context menu.</li><li class="listitem">You will create a build file that will look something like the following code; don't worry about this code—you will get to know it in detail:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="pizzaCookingSystem" default="compressComponents"&gt;
&lt;target name="bundleComponents"&gt;
&lt;echo message="Creating a package directory." /&gt;
&lt;mkdir dir="./package" /&gt;
&lt;echo message="Making a list of components to bind together." /&gt;
&lt;copy file="../Controllers/Dish.php" tofile="package/Dish.php" /&gt;
&lt;copy file="../Controllers/PizzaDish.php" tofile="package/PizzaDish.php" /&gt;
&lt;copy file="../Controllers/PizzaDishTest.php" tofile="package/PizzaDishTest.php" /&gt;
&lt;echo message="Bundling process complete."&gt;&lt;/echo&gt;
&lt;/target&gt;

&lt;target name="compressComponents" depends="bundleComponents"&gt;
&lt;echo message="Compressing Contents of the bundled components." /&gt;
&lt;zip destfile="package.zip"&gt;
&lt;fileset dir="package" &gt;
&lt;include name="*" /&gt;
&lt;/fileset&gt;
&lt;/zip&gt;
&lt;/target&gt;
&lt;/project&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec210"/>How it works…</h2></div></div></div><p>Finally, the time is <a id="id480" class="indexterm"/>ripe for you to understand the nuts <a id="id481" class="indexterm"/>and bolts that drive Phing. Thus, <code class="literal">&lt;project name="pizzaCookingSystem" default="compressComponents"&gt;</code> creates a project element and binds it to a namespace with the <code class="literal">name</code> attribute. The <code class="literal">default</code> attribute defines the default target that Phing will select to execute. If you visualize the Phing build file in the form of a tree, a project is the root node of the tree. <code class="literal">&lt;target name="bundleComponents"&gt;</code> creates a new target element that is a container for the actions that you want to perform. Thus, all the tasks that you wish to execute are written inside the target component. The target is selected by the <code class="literal">name</code> attribute. If you visualize the Phing build file in the form of a tree containing nodes and leaves, the target element is a node of the tree.</p><p>
<code class="literal">&lt;target name="compressComponents" depends="bundleComponents"&gt;</code> is another way of writing the target element with an added attribute <code class="literal">depends</code>. So when you specify the <code class="literal">depends</code> attribute, you specify to the Phing engine that this target element depends on some other target element. It is important here for you to be informed that when you specify the <code class="literal">depends</code> attribute, that target element is executed first as compared to the current element.</p><p>
<code class="literal">&lt;echo message="Creating a package directory." /&gt;</code> creates an element to echo a message to the console. What message will be displayed that depends on the contents of the message attribute. (Remember displaying <code class="literal">Hello World</code>? Your big smile is lovely!)</p><p>
<code class="literal">&lt;mkdir dir="./package" /&gt;</code> creates an element that creates a new directory in the current directory. This is synonymous to the <code class="literal">mkdir</code> command under <code class="literal">*nix</code> systems, which accepts the relative path as well as the absolute path as the target location.</p><p>
<code class="literal">&lt;copy file="../Controllers/Dish.php" tofile="package/Dish.php" /&gt;</code> performs the file copy operation from the file location specified in the file attribute to the file location specified in the <code class="literal">tofile</code> attribute. This is synonymous to the <code class="literal">cp</code> command under <code class="literal">*nix</code> systems and accepts relative or absolute file pathnames.</p><p>
<code class="literal">&lt;zip destfile="package.zip"&gt;</code> creates an element to handle the compressing of files in the ZIP format. The <code class="literal">destfile</code> attribute specifies the name of the compressed file that will be the output. The output path can again be relative or absolute.</p><p>
<code class="literal">&lt;fileset dir="package" &gt;</code> creates an element to set the files to be selected in the compressed output file. In other words, this picks up files from a directory specified by the <code class="literal">dir</code> attribute.</p><p>If you want to include <a id="id482" class="indexterm"/>selected files in the package, you<a id="id483" class="indexterm"/> can create an <code class="literal">include</code> element and specify the names of files you want to add to the output compressed file (<code class="literal">&lt;include name="*" /&gt;</code>). Wildcard characters are acceptable here. Thus, a star (<code class="literal">*</code>) means that all the files specified inside the fileset element's <code class="literal">dir</code> attribute will be selected.</p><p>Now you can proudly say that you have the power to exploit Phing. Another feather in your cap, right? Excellent performance, keep it up!</p></div></div>
<div class="section" title="Using a different build file"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec90"/>Using a different build file</h1></div></div></div><p>It happens frequently that you<a id="id484" class="indexterm"/> have mutually independent and exclusive tasks at hand. The principle of software engineering always advocates against grouping tasks together—modularity is the correct name of the phenomenon advocated. So is the case with you and Phing. What if you have a number of tasks to be undertaken? There are two routes to choose from: shorter and longer. The shorter way leads you to quick results but your friend, software engineering, will be offended. The longer way can irritate you at first, but dear friend, it would let you get more close to software engineering.</p><p>A wise decision is to befriend software engineering and take the longer route. Thus, you will create individual build files for individual tasks. Beware, though. Deciding the grouping of tasks in itself is a double-edged sword—it cuts both ways.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec211"/>How to do it…</h2></div></div></div><p>Having grouped the tasks according to their nature, you now need to concentrate on how Phing can come to your rescue in your <a id="id485" class="indexterm"/>overloaded daily life. You just need to follow the rules in order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Group</strong></span>: Grouping the tasks is an important step to begin with. You need to create a directory expected to contain the tasks (build files). It is not that there would be errors: this is good practice to follow. A person looking at your code hierarchy will be able to grasp your intent with ease in that case.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Create</strong></span>: Creating the actual build file is the next step you not only need to do but also take extreme care of. Since this is the workhorse, you need to ensure that the program structure is minimal—redundant lines will confuse you. You need to write tasks according to the individual activities that you have grouped. Ensure that you don't leave the business team behind! So, to create the build file, select <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Phing build file</strong></span> option and write the tasks inside it. If you have not set any template for your build file, you need to select <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>File</strong></span> and specify the name of the file with the extension <code class="literal">.xml</code>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Setup</strong></span>: Like always, your friend PhpStorm needs to be taken into account for your engineering needs. It is PhpStorm that makes your life easier—always remember. You therefore need to add the individual build files by selecting the <span class="strong"><strong>Add as Phing build file</strong></span> option. This can be done by accessing the right-click context menu on the appropriate build file from the Project view.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Execute</strong></span>: All is set now. When the<a id="id486" class="indexterm"/> need is felt, select the appropriate file and right-click to select <span class="strong"><strong>Run build file</strong></span> option.</li></ul></div><p>The following screenshot<a id="id487" class="indexterm"/> shows the build file:</p><div class="mediaobject"><img src="graphics/3878OT_07_04.jpg" alt="How to do it…"/></div><p>Thus, PhpStorm did not let anything come between two friends—you and software engineering.</p><p>A sample build looks like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;project name="pizzaCookingSystem" default="compressComponents"&gt;

  &lt;target name="bundleComponents"&gt;
  &lt;echo message="Creating a package directory."/&gt;
  &lt;mkdir dir="./package"/&gt;
  &lt;echo message="Making a list of components to bind together."/&gt;
  &lt;copy file="../Controllers/Dish.php" tofile="package/Dish.php"/&gt;
  &lt;copy file="../Controllers/PizzaDish.php" tofile="package/PizzaDish.php"/&gt;
  &lt;copy file="../Controllers/PizzaDishTest.php" tofile="package/PizzaDishTest.php"/&gt;
  &lt;echo message="Bundling process complete."/&gt;
  &lt;/target&gt;

    &lt;target name="compressComponents" depends="bundleComponents"&gt;
    &lt;echo message="Compressing Contents of the bundled components."/&gt;
    &lt;zip destfile="package.zip"&gt;
      &lt;fileset dir="package" /&gt;
    &lt;/zip&gt;
  &lt;/target&gt;

&lt;/project&gt;</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec212"/>How it works…</h2></div></div></div><p>A build file is the<a id="id488" class="indexterm"/> only source to provide guidance to Phing. In other words, Phing only considers a build file fit enough to accept the execution requests. So, the different tasks are just a plural form of single tasks (no pun intended). So, the different tasks are written down in different build files, to ensure that the structural modularity is maintained. The individual tasks are executed depending on which task is required at any given time.</p></div></div>
<div class="section" title="Doing wonders with Phing"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec91"/>Doing wonders with Phing</h1></div></div></div><p>What is art without practical usage? Practical usage <a id="id489" class="indexterm"/>means the utility of the art. The utility of the art clearly <a id="id490" class="indexterm"/>denotes the ability to solve a problem. So considering Phing as an art, it has got practical usage. Since it has practical usage, it has got utility. Since it has utility, it clearly denotes that it can solve problems for you.</p><p>What are you waiting for?</p><p>Think build problems, common or uncommon, think Phing. The most common problems are the most commonly known headache-causing agents—some of the developers in your team might not know the database specific language, some might not know the commands specific to the operating system, and some might not be trustworthy to be allowed to handle the system permissions; hence, the logfiles or temporary file cleaning tasks.</p><p>You can write Phing tasks to tackle them all.</p><p>Can you write a Phing task to check out files from the SVN server and deploy them on a target server? Yes, you can.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec213"/>Getting ready</h2></div></div></div><p>You need to have the <span class="strong"><strong>PHP SSH2</strong></span> extension<a id="id491" class="indexterm"/> loaded. In <code class="literal">*nix</code> (Debian-based) environments, the PHP SSH2 extension is available with the name <code class="literal">libssh2-php</code>. It can be very easily downloaded with the command <code class="literal">apt-get install libssh2-php</code>.</p><p>You also need to have <a id="id492" class="indexterm"/>your SSH public key (most commonly a file with a <code class="literal">.pub</code> extension) added<a id="id493" class="indexterm"/> on the server on which you wish to deploy your code.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec214"/>How to do it…</h2></div></div></div><p>When you think Phing, you must be mentally prepared to handle the strict syntax of XML. So, you need to write some XML code based on the rules of Phing to:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a list of changes based on the Subversion revision number and save it in a file.</li><li class="listitem">Export the changed files to your local server by reading from the file created in step 1.</li><li class="listitem">Deploy the exported files to the server.</li></ol></div><p>This is as simple as it seems. So, you would probably do something like the following:</p><div class="informalexample"><pre class="programlisting">&lt;project name="SvnDeploy" default="prepareFilesForUpload"&gt;
&lt;target name="svnLogin"&gt;
&lt;property name="svnUrl" value="http://www.somerepositoryurl/somerepopath"/&gt;
&lt;property name="svnUsername" value="you"/&gt;
&lt;property name="svnPassword" value="you@the-rep0s"/&gt;
&lt;property name="svnCodebaseName" value="name-of-code-base"/&gt;
&lt;/target&gt;

&lt;target name="takeDiff" depends="svnLogin"&gt;
&lt;propertyprompt promptText="Enter the starting revision number" propertyName="startRev" defaultValue="1"/&gt;
&lt;propertyprompt promptText="Enter the ending revision number (optional)" defaultValue="HEAD" propertyName="endRev" /&gt;
&lt;exec command="svn diff ${svnUrl}@${startRev} ${svnUrl}@${endRev} --summarize --xml" output="filelist.${startRev}.${endRev}" /&gt;
&lt;/target&gt;
&lt;target name="prepareFilesForUpload" depends="takeDiff"&gt;
&lt;loadfile property="listOfFiles" file="filelist.${startRev}.${endRev}" /&gt;
&lt;property name="directoryName" value="uploads-${startRev}-${endRev}" /&gt;
&lt;mkdir dir="${directoryName}" /&gt;
&lt;xmlproperty file="filelist.${startRev}.${endRev}" collapseAttributes="true"/&gt;
&lt;foreach delimiter="," list="${diff.paths.path}" param="file" target="exportFilesToLocal" /&gt;
&lt;/target&gt;
&lt;target name="exportFilesToLocal"&gt;
&lt;php expression="str_replace('${svnUrl}/${svnCodebaseName}', '', '${file}');" returnProperty="filePath" /&gt;
&lt;if&gt;
&lt;not&gt;
&lt;equals arg1="${filePath}" arg2=""/&gt;
&lt;/not&gt;
&lt;then&gt;
&lt;echo message="Exporting file: ${filePath} " /&gt;
&lt;php expression="preg_replace('/([a-z0-9-_\.])+\.([a-z])+/i', '', '${filePath}')" returnProperty="fileWithDir"/&gt;
&lt;echo message="Creating dir: ${fileWithDir} " /&gt;
&lt;exec command="mkdir -p ${directoryName}/${fileWithDir}" /&gt;
&lt;exec command="svn export ${file} ${directoryName}/${filePath} -- force" /&gt;
&lt;phingcall target="deployFiles" /&gt;
&lt;/then&gt;
&lt;/if&gt;
&lt;/target&gt;

&lt;target name="deployFiles" depends="serverLogin"&gt;
&lt;exec command="scp -r ${directoryName}/* ${serverUsername}@${serverUrl}:${serverDeploymentPath}/" checkreturn="true"/&gt;
&lt;/target&gt;

&lt;target name="serverLogin"&gt;
&lt;property name="serverUrl" value="localhost" /&gt;
&lt;property name="serverUsername" value="ankur" /&gt;
&lt;property name="serverDeploymentPath" value="/home/techie/Desktop/deployment/" /&gt;
&lt;/target&gt;

&lt;/project&gt;</pre></div><p>Heavy-duty XML code! You are encouraged to be brave enough to open the hood and see what goes on inside.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec215"/>How it works…</h2></div></div></div><p>
<span class="strong"><strong>Property Prompt</strong></span>
<a id="id494" class="indexterm"/> is the Phing way to ask for user input during execution. The message that you<a id="id495" class="indexterm"/> want to show is to be written in the <code class="literal">promptText</code> attribute. The<a id="id496" class="indexterm"/> input value can later be accessed with the name specified in the <code class="literal">propertyName</code> attribute. If you want to set a default value to act as a fallback value just in case the user does not enter a value, you need to set the value of the default value attribute.</p><p>
<span class="strong"><strong>Exec</strong></span>
<a id="id497" class="indexterm"/> is the Phing way to execute a command. If the command generates output that you want to use in another place in your code, you need to specify a name that will be the reference point to this output.</p><p>Phing enables you to load the contents of a file using this <code class="literal">loadfile</code> tag. You need to specify the path of the file (absolute or relative) in the file attribute. The reference name for this file is written inside the <code class="literal">property</code> attribute:</p><div class="informalexample"><pre class="programlisting">&lt;foreach delimiter="A"list="${listOfFiles}"
param="file" target="exportFilesToLocal" /&gt;</pre></div><p>You can iterate a certain condition using the <code class="literal">foreach</code> tag. The <code class="literal">delimiter</code> attribute separates the values of the input specified using the <code class="literal">list</code> attribute. The individual element in the loop is accessible using the value specified in the <code class="literal">param</code> attribute. The <code class="literal">target</code> attribute denotes which target is to be repeatedly performed inside the loop. Take a look at the following code:</p><div class="informalexample"><pre class="programlisting">&lt;mkdir dir="${directoryName}" /&gt;</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec216"/>There's more…</h2></div></div></div><p>Phing can create a new directory if you write the <code class="literal">mkdir</code> tag and specify the name of the directory to be created in the <code class="literal">dir</code> attribute. If the directory already exists, Phing remains silent and produces no message about the directory—you need to be careful yourself. You can call an arbitrary target in your build file using the <code class="literal">phingcall</code> tag and specifying the name of the target in the <code class="literal">target</code> attribute.</p><p>So, again Grandma was right. You created a larger and complicated object using small and simple objects. Always remember her values.</p></div></div>
<div class="section" title="Using the Phing build view"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec92"/>Using the Phing build view</h1></div></div></div><p>PhpStorm is just. PhpStorm is good. PhpStorm does not discriminate. There are tool windows provided for every important tool provided to you. The same is true for Phing as well. So, you can have an overview of what Phing can do.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec217"/>How to do it…</h2></div></div></div><p>The Phing build view is<a id="id498" class="indexterm"/> accessible at <span class="strong"><strong>View</strong></span> | <span class="strong"><strong>Tool windows</strong></span> | <span class="strong"><strong>Phing build window</strong></span>. The Phing view provides functions that are useful for Phing-related actions. So, you can:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Add a new build file to execute</strong></span>: There <a id="id499" class="indexterm"/>might be Phing build files you have<a id="id500" class="indexterm"/> written in some other editor or obtained from another person. You can add those files as build files in PhpStorm. To add files, click on the <span class="strong"><strong>+</strong></span> button.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Remove an existing build file</strong></span>: If you feel that you have added an incorrect version of the build file, you can always recover from your mistake. You can remove a build file from the project by clicking on the <span class="strong"><strong>–</strong></span> button. You can also use the <span class="emphasis"><em>Delete</em></span> key on your keyboard.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Run a build file</strong></span>: If you feel that all the targets have been written correctly, you can perform that action by executing a build file. To do that, you need to select a build file and click on the green <span class="strong"><strong>Run</strong></span> button.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apply target-hiding settings</strong></span>: In the Phing view, you get a consolidated view of the individual build files and the targets you have written inside it. So, you can hide a target by selecting it, accessing the right-click context menu and clicking on <span class="strong"><strong>Mark to hide</strong></span>. The hide settings are applied when you select this option available next to the <span class="strong"><strong>Run</strong></span> button.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Expand all</strong></span>: You can expand all the build files to show all the (unhidden) targets for individual build files. The keyboard shortcut to be used is <span class="emphasis"><em>Ctrl</em></span> + (Numpad) <span class="emphasis"><em>+</em></span>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Collapse all</strong></span>: You can collapse the build files to show only the build files and not the targets. The keyboard shortcut for the same is <span class="emphasis"><em>Ctrl</em></span> + (Numpad) <span class="emphasis"><em>-</em></span>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Settings</strong></span>: You can make settings for the execution of tasks by Phing. The settings window is accessible from inside the Phing view by the keyboard shortcut <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Enter</em></span>. Inside the <span class="strong"><strong>Settings</strong></span> window, you have the power to make a difference. Here's how you can do that:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You get a path to the Phing executable option wherein you can set the read or update the path to the Phing executable for the project.</li><li class="listitem" style="list-style-type: disc">Then, there are command-line options that allow you to pass on certain options, such as <code class="literal">-l</code> (listing the targets) and <code class="literal">-debug</code> (setting the debug mode on).</li><li class="listitem" style="list-style-type: disc">You can set <span class="strong"><strong>Properties</strong></span> in the form of key-value pairs. PhpStorm gives you the option to select from a list of available macros or precooked placeholders. You can select which target(s) to hide or unhide by selecting or deselecting the <span class="strong"><strong>Hiding targets</strong></span> checkbox.</li></ul></div></li></ul></div><p>Besides this, all other <a id="id501" class="indexterm"/>settings that are available to a view in PhpStorm are provided here. The options are: you can set the display mode for the view in one of the pinned, docked, floating, and split ways. You can move the window to one of the four regions (top, left, bottom, and right) on the screen; resize the window to a required size, hide the view altogether, and so on.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note32"/>Note</h3><p>The Phing application-specific settings that you create have to be created individually for each of the build files that have been added to PhpStorm.</p></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec218"/>How it works…</h2></div></div></div><p>Here, it is important to understand how the Phing settings work. PhpStorm acts as a proxy for whatever tool it executes—it always creates wrapper (class) for the target tool. Thus, when you attempt to set the command-line options or add properties, you are telling this proxy application to remember that whenever the Phing command is issued, the arguments from the command-line options textbox are to be executed. In other words, you pass on the arguments to the PhpStorm proxy application, which in turn, executes the same old Phing command. The properties you set are used in the build file as is. So, when you set the properties, you are indeed making the properties persist till you yourself do not delete it.</p></div></div></body></html>