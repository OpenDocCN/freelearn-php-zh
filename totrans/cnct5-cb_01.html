<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Pages and Page Types"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Pages and Page Types</h1></div></div></div><p>In this chapter we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Getting the current Page object</li><li class="listitem" style="list-style-type: disc">Getting a Page object by its ID</li><li class="listitem" style="list-style-type: disc">Getting a Page object by its path</li><li class="listitem" style="list-style-type: disc">Getting a Page type by its ID</li><li class="listitem" style="list-style-type: disc">Getting a Page type by its handle</li><li class="listitem" style="list-style-type: disc">Getting a page type's ID</li><li class="listitem" style="list-style-type: disc">Getting a page type's name</li><li class="listitem" style="list-style-type: disc">Getting a page type's handle</li><li class="listitem" style="list-style-type: disc">Getting the icon for a page type</li><li class="listitem" style="list-style-type: disc">Getting a list of pages that belong to a page type</li><li class="listitem" style="list-style-type: disc">Creating a page type</li><li class="listitem" style="list-style-type: disc">Updating a page type</li><li class="listitem" style="list-style-type: disc">Deleting a page type</li><li class="listitem" style="list-style-type: disc">Creating a page type</li><li class="listitem" style="list-style-type: disc">Updating an existing page</li><li class="listitem" style="list-style-type: disc">Setting page attributes</li><li class="listitem" style="list-style-type: disc">Getting a page attribute</li><li class="listitem" style="list-style-type: disc">Getting a page's ID</li><li class="listitem" style="list-style-type: disc">Getting a page's path</li><li class="listitem" style="list-style-type: disc">Getting a page's handle</li><li class="listitem" style="list-style-type: disc">Getting a page's name</li><li class="listitem" style="list-style-type: disc">Getting a page's description</li><li class="listitem" style="list-style-type: disc">Getting a page's page type ID</li><li class="listitem" style="list-style-type: disc">Getting a page's page type handle</li><li class="listitem" style="list-style-type: disc">Getting a page's theme object</li><li class="listitem" style="list-style-type: disc">Getting the children below a page</li><li class="listitem" style="list-style-type: disc">Moving a page</li><li class="listitem" style="list-style-type: disc">Deleting a page (and its children)</li><li class="listitem" style="list-style-type: disc">Getting a list of pages</li><li class="listitem" style="list-style-type: disc">Adding a page selector field to a form</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Introduction</h1></div></div></div><p>At the center of almost any content management system is the concept of pages. <span class="strong"><strong>concrete5</strong></span> pages contain reusable portions of content called <a id="id0" class="indexterm"/>
<span class="strong"><strong>blocks</strong></span>. Blocks can contain anything from formatted text content that you enter yourself, to photo slideshows, to videos, to custom forms that you have developed that contain special functionality. <a id="id1" class="indexterm"/>concrete5 pages are extensions of the internal <code class="literal">Collection</code> object, which gets its name from the fact that it contains a collection of blocks that make up the page.</p><p>Since pages on a website usually contain repeating areas of information (perhaps a sidebar with some persistent widgets), concrete5 includes the concept of page types. Page types allow you to define different templates for creating new pages in concrete5. They are used to specify a default set of blocks, content, and special attributes that are added to new pages of that type, as well as to create different visual layouts through the concrete5 website.</p><p>A common page type would be <a id="id2" class="indexterm"/>
<span class="strong"><strong>Left Sidebar</strong></span>, which contains a list of links in the sidebar with an area to add blocks of content on the right. A normal concrete5 installation comes with a few default page types out of the box, including Left Sidebar and Full Width. In code, page types are referred to either by their unique numerical ID in the database, or more commonly, a human readable identifier called a <span class="strong"><strong>handle</strong></span>. The <a id="id3" class="indexterm"/>Left Sidebar page type, for example, would have a handle of <code class="literal">left_sidebar</code>.</p><div class="mediaobject"><img src="graphics/4548OS_01_01.jpg" alt="Introduction"/></div><p>When adding pages to a concrete5 website through the user interface, you will likely notice that the first step is choosing a page type. Page types are also used by the Composer feature of concrete5, which can assist in creating several pages of the same type (such as blog posts).</p><p>There are two types of pages in concrete5, the first being a standard page that gets added to the sitemap and gets assigned a page type, and the second a <a id="id4" class="indexterm"/>
<span class="strong"><strong>single page</strong></span>, which is handled a bit differently and does not get assigned a page type. This chapter will deal with pages of the first type.</p><div class="section" title="A note about the code in this chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>A note about the code in this chapter</h2></div></div></div><p>Typically, you will write code that <a id="id5" class="indexterm"/>interacts with pages and page types in a block, a controller, or a model in your concrete5 application. For the purpose of these demonstrations, you can place the code anywhere where concrete5 lets you execute arbitrary PHP code.</p><p>A great place for this is to add a <code class="literal">site_process.php</code> or <code class="literal">site_post.php</code> file to your site's root <code class="literal">/config</code> directory. concrete5 will execute all of the code in that file once all of the core classes and libraries have been loaded (<code class="literal">site_post</code> gets executed before the current page has been loaded, <code class="literal">site_process</code> gets executed after the current page has been set). We will use classic PHP debugging techniques to verify that our code is working. Typically, we will dump the contents of a <a id="id6" class="indexterm"/>variable using PHP's <code class="literal">var_dump</code> or <code class="literal">print_r</code> functions <a id="id7" class="indexterm"/>followed by an <code class="literal">exit</code> command.</p><p>Because the debugging techniques used in this book can interrupt the regular functionality of a concrete5 website, it is recommended that you perform these exercises on a development copy of concrete5.</p><p>Be sure to comment out or remove the <a id="id8" class="indexterm"/>debugging code once you are finished, to resume the normal functionality of your concrete5 website.</p></div></div></div>
<div class="section" title="Create a custom debugging function"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Create a custom debugging function</h1></div></div></div><p>To aid in the dumping of <a id="id9" class="indexterm"/>variables, we can create a simple debugging function that will wrap our output in <code class="literal">&lt;pre&gt;</code> tags and automatically <code class="literal">exit</code> for us.</p><p>Place the following code at the top of <code class="literal">/config/site_post.php</code> (create the file if it does not exist):</p><div class="informalexample"><pre class="programlisting">function my_debug($var) {
  echo '&lt;pre&gt;';
  print_r($var);
  echo '&lt;/pre&gt;';
  exit;
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p><span class="strong"><strong>Downloading the example code</strong></span></p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><p>Now, when we wish to inspect the contents of a variable or other object, we can simply call <code class="literal">my_debug($variable)</code>, and get a nicely formatted, easy to read response.</p><p>Of course, you are more than welcome <a id="id10" class="indexterm"/>to use your own techniques for debugging variables.</p></div>
<div class="section" title="Getting the current Page object"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Getting the current Page object</h1></div></div></div><p>A very common task for <a id="id11" class="indexterm"/>concrete5 developers is to retrieve information from the page that is currently displayed. You will encounter this situation quite often, whether you need to update some information about the current page (such as a page title), check the current user's permissions on this page, or just display the page title. Fortunately, this is quite simple.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How to do it...</h2></div></div></div><p>The steps for getting the current <code class="literal">Page</code> objects are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create <code class="literal">/config/site_process.php</code> if it does not exist.</li><li class="listitem">Open <code class="literal">/config/site_process.php</code> in your preferred text editor.</li><li class="listitem">We can get the current <code class="literal">Page</code> object by calling the getCurrentPage static function of the Page class.<div class="informalexample"><pre class="programlisting">$currentPage = Page::getCurrentPage();</pre></div></li><li class="listitem">If we inspect the contents of the <code class="literal">$currentPage</code> variable, we can see that it is a <code class="literal">Page</code> object, and now we are ready to perform further operations on it. In this example we are using our custom debugging function that was created in the chapter introduction.<div class="informalexample"><pre class="programlisting">my_debug($currentPage);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How it works...</h2></div></div></div><p>Calling the static <a id="id12" class="indexterm"/>
<code class="literal">getCurrentPage</code> function on the <code class="literal">Page</code> class will look in the concrete5 <code class="literal">Request</code> object to get the current page. If that is not set, concrete5 will use the global <code class="literal">$c</code> variable. Note the use of <code class="literal">site_process.php</code> to dump the current page variable. We used this file because it is read after concrete5 has set the current <code class="literal">Page</code> object. Using <code class="literal">site_post.php</code> would have resulted in a null object.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>There's more...</h2></div></div></div><p>You may have already noticed that sometimes developers will use the global variable, <code class="literal">$c</code>, within their code to get the current <code class="literal">Collection</code> or <code class="literal">Page</code> object. This typically works fine, but best practices would be to use the <a id="id13" class="indexterm"/>
<code class="literal">getCurrentPage</code> function to handle this for you.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a Page object by its ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Getting a Page object by its ID</h1></div></div></div><p>In many situations, you will need to <a id="id14" class="indexterm"/>load a <code class="literal">Page</code> object using its unique numerical ID from the database. As mentioned earlier, pages are actually extensions of the <code class="literal">Collection</code> object, so you will actually be loading the page by its collection ID.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Getting ready</h2></div></div></div><p>We will need to know the numerical ID <a id="id15" class="indexterm"/>of the page that you are attempting to load. Often this will be stored in other objects, perhaps even a custom entity that you have stored in the database. For example, say you have a recipes table in the database, and each recipe has its own page in the concrete5 website. You store the page ID for each recipe, so you can load the relevant <code class="literal">Page</code> object whenever necessary.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How to do it...</h2></div></div></div><p>First you will have to get the page ID for the <code class="literal">Page</code> object that you are trying to load. For this example, we will just hard-code the ID of the page that we are loading. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your favorite code editor.</li><li class="listitem">First, let's store the ID of the page we are loading into a variable. In real-world use, you will likely have this ID stored in a database table, or available from some other code that you have run. The ID of the home page in concrete5 defaults to <code class="literal">1</code>, so we will use that for our page's ID:<div class="informalexample"><pre class="programlisting">$pageId = 1; // load the home page</pre></div></li><li class="listitem">Now that we have the ID of the page that we need to load, use the <code class="literal">getByID</code> function to get the <code class="literal">Page</code> object that we need:<div class="informalexample"><pre class="programlisting">$page = Page::getByID($pageId);</pre></div></li><li class="listitem">We can inspect the <code class="literal">$page</code> variable and verify that it contains a <code class="literal">Page</code> object.<div class="informalexample"><pre class="programlisting">my_debug($page);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How it works...</h2></div></div></div><p>The page ID (also known as collection ID) is unique in the database, so calling the <code class="literal">getByID</code> function will load the correct <a id="id16" class="indexterm"/>page data and return a <code class="literal">Page</code> object that you can <a id="id17" class="indexterm"/>interact with.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the current Page object</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a Page object by its path"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Getting a Page object by its path</h1></div></div></div><p>concrete5 also supports the <a id="id18" class="indexterm"/>loading of <code class="literal">Page</code> objects by the path that is displayed in the web browser. This is a convenient way to load pages without knowing their numerical ID. <a id="id19" class="indexterm"/>In this exercise, we will load an About Us page by its path.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Getting ready</h2></div></div></div><p>We will be loading a page with the path of <code class="literal">/about-us</code>. If this page does not exist in your concrete5 site, please add it to the sitemap before attempting this exercise.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How to do it...</h2></div></div></div><p>Using a static function called <code class="literal">getByPath</code>, we can easily get a <code class="literal">Page</code> object without knowing the ID. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">/config/site-post.php</code> file in your code editor.</li><li class="listitem">Declare the path of the page that you wish to load.<div class="informalexample"><pre class="programlisting">$path = '/about-us';</pre></div></li><li class="listitem">We can load the page located at <code class="literal">http://example.com/about-us</code> by passing the path string to the <code class="literal">getByPath</code> function.<div class="informalexample"><pre class="programlisting">$aboutPage = Page::getByPath($path);</pre></div></li><li class="listitem">To make sure we grabbed the correct page, dump the <code class="literal">$aboutPage</code> variable to verify that we have a fully loaded <code class="literal">Page</code> object. We will use the custom debug function that we created in the chapter introduction.<div class="informalexample"><pre class="programlisting">my_debug($aboutPage);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>How it works...</h2></div></div></div><p>concrete5 will query the database for the page that has the specified path assigned to it. You will want to use good judgment when loading pages by their paths, as that data can change easily through the concrete5 interface. Imagine that you are working on a site with 15 editors, and any one of them <a id="id20" class="indexterm"/>has the ability to edit the path of a page. concrete5 by default will save old page paths whenever a new one is changed, but it is not required. Hard coding page paths in your custom applications should be used only when appropriate. It is a much better idea to <a id="id21" class="indexterm"/>load pages by their ID whenever possible, as that ID does not change.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>There's more...</h2></div></div></div><p>You can load any page on the site using this technique. To load a <code class="literal">Careers</code> page that exists below the <code class="literal">About</code> page that we just loaded, you would write the following:</p><div class="informalexample"><pre class="programlisting">$careersPage = Page::getByPath('/about-us/careers');</pre></div><p>You should know that concrete5 will cache the page IDs related to each path, so if you are experiencing unexpected results while using this function, make sure to clear your site cache by visiting <code class="literal">/dashboard/system/optimization/clear_cache/</code> on your concrete5 website.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting the current Page object</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page type by its ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Getting a page type by its ID</h1></div></div></div><p>When creating and editing <a id="id22" class="indexterm"/>pages in concrete5 development, you will inevitably <a id="id23" class="indexterm"/>need to load the desired page type object that will be assigned to a page. Note that page types are actually instances of the <code class="literal">CollectionType</code> object in code. For consistency, we will continue to refer to them as page types outside of code.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Getting ready</h2></div></div></div><p>We will continue performing these examples in the <code class="literal">/config/site-post.php</code> file, as that is a quick and easy place to run the arbitrary code. We will also continue making use of our custom <code class="literal">my_debug</code> <a id="id24" class="indexterm"/>function that was defined in the chapter introduction.</p><p>In this recipe, we will be loading a page type with the ID of <code class="literal">4</code>. Please make sure that this page type exists in your instance of concrete5, otherwise change the ID to something appropriate to your environment.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How to do it...</h2></div></div></div><p>Much like loading pages, you will need to <a id="id25" class="indexterm"/>call a static function on the <code class="literal">CollectionType</code> class. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your text editor.</li><li class="listitem">First, we will need to know the numerical ID of the page type. In this case, we are going to assume that a page type called "Left Sidebar" exists, and that it has the numerical ID of <code class="literal">4</code>.<div class="informalexample"><pre class="programlisting">$leftSidebarId = 4;</pre></div></li><li class="listitem">Now that we have the ID of the page type that we wish to load, we can call the <code class="literal">getByID</code> function of the <code class="literal">CollectionType</code> class.<div class="informalexample"><pre class="programlisting">$leftSidebarPageType = CollectionType::getByID($leftSidebarId);</pre></div></li><li class="listitem">We can verify that we loaded the correct page type by inspecting the <code class="literal">$leftSidebarPageType</code> <a id="id26" class="indexterm"/>variable and verifying that it is an instance of the <code class="literal">CollectionType</code> class.<div class="informalexample"><pre class="programlisting">my_debug($leftSidebarPageType);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>How it works...</h2></div></div></div><p>The <code class="literal">getByID</code> function performs a simple <a id="id27" class="indexterm"/>database query to find the page type that belongs to that ID. A <code class="literal">CollectionType</code> object is returned when a successful lookup is made.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its handle</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page type by its handle"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Getting a page type by its handle</h1></div></div></div><p>As mentioned in the chapter introduction, page types also have human readable handles, which offer a convenient way of loading page types without knowing their numerical IDs. Handles are always <a id="id28" class="indexterm"/>alphanumerical strings with underscores between words, and <a id="id29" class="indexterm"/>do not contain any file extensions such as <code class="literal">.php</code>. For example, the handle for a page type called "Left Sidebar" would most likely be <code class="literal">left_sidebar</code>, but concrete5 lets users specify any alphanumeric string for a handle, so it's possible that the handle for Left Sidebar would also just be <code class="literal">left</code>.</p><div class="mediaobject"><img src="graphics/4548OS_01_02.jpg" alt="Getting a page type by its handle"/></div><p>You can find the handles of page <a id="id30" class="indexterm"/>types by visiting the <span class="strong"><strong>Page Types</strong></span> area of the concrete5 <a id="id31" class="indexterm"/>dashboard, located at <code class="literal">/dashboard/pages/types/</code> on your concrete5 website.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>Getting ready</h2></div></div></div><p>In this recipe, we will be loading a page type with the handle of <code class="literal">left_sidebar</code>. Please make sure that page type exists in your concrete5 installation, otherwise you can add a new page type with that handle, or adapt the recipe to work for your situation.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>How to do it...</h2></div></div></div><p>Here's how we would load the page type with a handle of <code class="literal">left_sidebar</code>. This is similar to loading a page by its path. The steps <a id="id32" class="indexterm"/>are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Declare the handle of the page type that you wish to load.<div class="informalexample"><pre class="programlisting">$handle = 'left_sidebar';</pre></div></li><li class="listitem">Load the page type using the handle that we just defined.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle($handle);</pre></div></li><li class="listitem">You can verify that you have loaded the page type by dumping the <code class="literal">$pageType</code> variable.<div class="informalexample"><pre class="programlisting">my_debug($pageType);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>How it works...</h2></div></div></div><p>A simple database query is performed, <a id="id33" class="indexterm"/>which will return a <code class="literal">CollectionType</code> object if it is successful.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>There's more...</h2></div></div></div><p>Just like the warning for loading pages by their paths, you will want to exercise the same good judgment when loading page types by their handles. Since these handles are just strings that can be edited through the concrete5 interface, you will need to make sure that you aren't writing code that could break if one of the site editors changes the handle of a page type.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page type's ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Getting a page type's ID</h1></div></div></div><p>Once a page type has been <a id="id34" class="indexterm"/>loaded, we can get different information from it. Sometimes, if a page type is loaded by its handle, or if it was provided from another function call, <a id="id35" class="indexterm"/>developers will need to get the page type's ID from an existing page type object. In this exercise, we will load a page type by its handle, and then find out the ID of the page type.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>Getting ready</h2></div></div></div><p>We will be loading a page type with a handle of <code class="literal">right_sidebar</code> in this example. If that page type does not exist in your concrete5 system, feel free to adapt this recipe to suit your specific situation.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>How to do it...</h2></div></div></div><p>The steps for getting a page <a id="id36" class="indexterm"/>type's ID are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Load the page type by its path:<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle('right_sidebar');</pre></div></li><li class="listitem">Get the ID from the page type.<div class="informalexample"><pre class="programlisting">$id = $pageType-&gt;getCollectionTypeId();</pre></div></li><li class="listitem">Dump the page type ID (we are using the custom debugger explained in this chapter's introduction).<div class="informalexample"><pre class="programlisting">my_debug($id);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>How it works...</h2></div></div></div><p>Once the page type object is loaded, <a id="id37" class="indexterm"/>developers can call a number of functions to retrieve data from it, including the numeric ID.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its handle</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page type's name"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Getting a page type's name</h1></div></div></div><p>Page type objects also contain <a id="id38" class="indexterm"/>methods to retrieve the name of the page type. In this exercise, <a id="id39" class="indexterm"/>we will load a page type by its handle, and then retrieve the name of the page type.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>Getting ready</h2></div></div></div><p>We will be loading a page type with the handle of <code class="literal">right_sidebar</code>, so if that page type does not exist in your instance of concrete5, please adapt this recipe to suit your needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>How to do it...</h2></div></div></div><p>The steps for getting a page type's name are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the page type by its handle:<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle('right_sidebar');</pre></div></li><li class="listitem">Get the name of the page type.<div class="informalexample"><pre class="programlisting">$name = $pageType-&gt;getCollectionTypeName();</pre></div></li><li class="listitem">Dump the name using our custom debugger.<div class="informalexample"><pre class="programlisting">my_debug($name);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec36"/>How it works...</h2></div></div></div><p>The <code class="literal">getCollectionTypeName</code> <a id="id40" class="indexterm"/>function <a id="id41" class="indexterm"/>simply returns the string value of the page type's <a id="id42" class="indexterm"/>name.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec37"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its handle</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page type's handle"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Getting a page type's handle</h1></div></div></div><p>If a page type has been loaded by its <a id="id43" class="indexterm"/>ID or has been provided in a different manner, developers may want to retrieve the handle of the page type. In this example, we will load a page <a id="id44" class="indexterm"/>type with an ID of <code class="literal">4</code> and use the concrete5 API to get its handle.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec38"/>Getting ready</h2></div></div></div><p>We will be loading a page type with an ID of 4, so please ensure that this exists in your concrete5 website. Feel free to change the ID in this recipe to something appropriate for your instance of concrete5.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec39"/>How to do it...</h2></div></div></div><p>The steps for getting a page type's handle are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the page type by its ID.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByID(4);</pre></div></li><li class="listitem">Get the handle of the page type.<div class="informalexample"><pre class="programlisting">$handle = $pageType-&gt;getCollectionTypeHandle();</pre></div></li><li class="listitem">Dump the handle using our custom debugger function.<div class="informalexample"><pre class="programlisting">my_debug($handle);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec40"/>How it works...</h2></div></div></div><p>The function <code class="literal">getCollectionTypeHandle</code> of <a id="id45" class="indexterm"/>the page type object returns the handle string <a id="id46" class="indexterm"/>of the page type.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec41"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting the icon for a page type"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Getting the icon for a page type</h1></div></div></div><p>In the concrete5 dashboard interface, <a id="id47" class="indexterm"/>page types have icons associated with them. In some <a id="id48" class="indexterm"/>advanced applications, you may want to retrieve the icon for the page type. In this recipe, we will load a page type by its handle and get its icon.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec42"/>Getting ready</h2></div></div></div><p>We will be loading a page type with a handle of <code class="literal">right_sidebar</code>. Feel free to change this handle to something appropriate for your concrete5 instance if <code class="literal">right_sidebar</code> does not exist.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec43"/>How to do it...</h2></div></div></div><p>The steps for getting the icon for a page are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your favorite code editor, as this is a good place to try out random code.</li><li class="listitem">Load the page type by its path.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle('right_sidebar');</pre></div></li><li class="listitem">Get the icon image.<div class="informalexample"><pre class="programlisting">$icon = $pageType-&gt;getCollectionTypeIconImage();</pre></div></li><li class="listitem">Output the image. You should see the icon's image appear.<div class="informalexample"><pre class="programlisting">echo $icon;
exit;</pre></div><div class="mediaobject"><img src="graphics/4548OS_01_03.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec44"/>How it works...</h2></div></div></div><p>concrete5 returns a string containing <a id="id49" class="indexterm"/>the actual HTML image tag with the collection type's icon.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec45"/>There's more...</h2></div></div></div><p>If you would like to get the numeric <a id="id50" class="indexterm"/>ID of the file containing the page type icon, you can simply call this function:</p><div class="informalexample"><pre class="programlisting">$iconId = $pageType-&gt;getCollectionTypeIcon();</pre></div><p>The numeric ID is useful when working with the file manager in concrete5, which is discussed in detail in <a class="link" href="ch03.html" title="Chapter 3. Files and File Sets">Chapter 3</a>, <span class="emphasis"><em>Files and File Sets</em></span> of this book.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec46"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a list of pages that belong to a page type"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Getting a list of pages that belong to a page type</h1></div></div></div><p>In many advanced concrete5 <a id="id51" class="indexterm"/>applications, developers may need to find a list of all of the pages that belong to a given page type. In this example, we will get an array of pages that have a page type with the handle of <code class="literal">right_sidebar</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec47"/>Getting ready</h2></div></div></div><p>If your instance of concrete5 does not have a page type with the handle of <code class="literal">right_sidebar</code>, feel free to adapt the recipe to suit your needs. We will continue using <code class="literal">/config/site_post.php</code> as our sandbox to run random code snippets, as well as our custom debugging function that we created in this chapter's introduction.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec48"/>How to do it...</h2></div></div></div><p>The steps for getting a list of pages belonging to a page type are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor to try out the following code.</li><li class="listitem">Load the page type by its handle.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle('right_sidebar');</pre></div></li><li class="listitem">Get the array of <code class="literal">Page</code> objects.<div class="informalexample"><pre class="programlisting">$pages = $pageType-&gt;getPages();</pre></div></li><li class="listitem">Dump the array to see its contents.<div class="informalexample"><pre class="programlisting">foreach ($pages as $page) {
  echo $page-&gt;getCollectionTitle().'&lt;br /&gt;';
}
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec49"/>How it works...</h2></div></div></div><p>concrete5 simply uses the relational MySQL database to find all of the pages that are related to the page type. Be aware that concrete5 ignores permissions settings when this function is called, so this should really only be used for internal purposes.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec50"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its handle</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating a page type"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec20"/>Creating a page type</h1></div></div></div><p>You can easily add new page types through the concrete5 user interface, but there are some situations that can require you to create page types dynamically using PHP code.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec51"/>Getting ready</h2></div></div></div><p>First, you will need to create an <a id="id52" class="indexterm"/>associative array that contains the data of the page type that you are creating.</p><p>The array can contain the following fields:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Attribute</p>
</th><th style="text-align: left" valign="bottom">
<p>Required?</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">ctHandle</code></p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>The collection <a id="id53" class="indexterm"/>type handle: an alphanumeric string with underscores between words.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">ctName</code></p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>The collection <a id="id54" class="indexterm"/>type name: a string that will appear in the concrete5 interface.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">ctIcon</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>If you'd like <a id="id55" class="indexterm"/>to specify an icon for this page type, pass in the numerical ID of the icon from the File Manager.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">ctIsInternal</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>A Boolean <a id="id56" class="indexterm"/>indicating if this page type is an internal page type. Internal page types do not appear in the page creation dialog in the concrete5 interface.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">akID</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>An array of <a id="id57" class="indexterm"/>attribute key IDs to be added to the new page type.</p>
</td></tr></tbody></table></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec52"/>How to do it...</h2></div></div></div><p>We will create a page type using only the required fields: <code class="literal">ctHandle</code> and <code class="literal">ctName</code>. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Declare the handle of the new page type to be created.<div class="informalexample"><pre class="programlisting">$handle = 'page_type_handle';</pre></div></li><li class="listitem">Declare the array that contains the data for the <code class="literal">ctHandle</code> and <code class="literal">ctName</code> fields.<div class="informalexample"><pre class="programlisting">$data = array(
  'ctHandle' =&gt; $handle,
  'ctName' =&gt; 'Page Type Name'
);</pre></div></li><li class="listitem">Check to see if the page type already exists by loading it by the new handle.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle($handle);</pre></div></li><li class="listitem">If the page type does not exist, create it.<div class="informalexample"><pre class="programlisting">if (!$pageType) {
  $newPageType = CollectionType::add($data);
}</pre></div></li><li class="listitem">If it does exist, assign the existing page type to the new page type variable.<div class="informalexample"><pre class="programlisting">else {
  $newPageType = $pageType;
}</pre></div></li><li class="listitem">Dump the new page type variable to ensure that it worked.<div class="informalexample"><pre class="programlisting">my_debug($newPageType);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec53"/>How it works...</h2></div></div></div><p>concrete5 will take the data array that you <a id="id58" class="indexterm"/>pass in and use it to create a new <code class="literal">CollectionType</code> record in the database. concrete5 will also automatically generate a Master Collection <a id="id59" class="indexterm"/>page in the database. The Master Collection is a template page that concrete5 will use as base for all pages of that type. Any blocks, attributes, or other data assigned to the Master Collection will automatically be added to any new pages created with that page type.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec54"/>There's more...</h2></div></div></div><p>If you are creating this page type in a custom package, you will need to pass in your package object to the <code class="literal">add()</code> function, <a id="id60" class="indexterm"/>so concrete5 knows that this page type belongs to your package. That way, when users uninstall your package, they will have the option of removing all of the page types that it created.</p><p>Assuming that you know the handle of your package, use the following code to create a page type with it:</p><div class="informalexample"><pre class="programlisting">$data = array(
  'ctHandle' =&gt; $handle,
  'ctName' =&gt; 'Page Type Name'
);
$pkg = Package::getByHandle('my_package');
$newPageType = CollectionType::add($data, $pkg);</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec55"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating custom add-on package</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Updating a page type</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Updating a page type"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec21"/>Updating a page type</h1></div></div></div><p>Updating page types is very similar to creating a page type as discussed in the previous recipe.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec56"/>How to do it...</h2></div></div></div><p>First you will need to load an existing <a id="id61" class="indexterm"/>page type. You will need to pass in the same data array when updating page types as you would when creating them. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Declare the old handle and the new handle variables.<div class="informalexample"><pre class="programlisting">$handle = 'page_type_handle';
$newHandle = 'new_handle';</pre></div></li><li class="listitem">Define the new <code class="literal">$data</code> array with the new handle and new name.<div class="informalexample"><pre class="programlisting">$data = array(
  'ctHandle' =&gt; $newHandle,
  'ctName' =&gt; 'New Name'
);</pre></div></li><li class="listitem">If the page type exists, update it.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle($handle);
if ($pageType) {
  $pageType-&gt;update($data);
}</pre></div></li><li class="listitem">Verify that the page type was updated by visiting <code class="literal">/dashboard/pages/types</code> in your concrete5 website.<div class="mediaobject"><img src="graphics/4548OS_01_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec57"/>How it works...</h2></div></div></div><p>concrete5 will update the record in the database for the loaded page type. The Master Collection page is not updated when <a id="id62" class="indexterm"/>this function is called. You also cannot pass a packaged object to the update function, as that is only necessary when first creating a page type.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec58"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a page type</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Deleting a page type</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Deleting a page type"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec22"/>Deleting a page type</h1></div></div></div><p>In addition to adding and <a id="id63" class="indexterm"/>editing page types, you can also delete them.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec59"/>Getting ready</h2></div></div></div><p>Since deleting page types is a destructive action that is irreversible, it's a good idea to create a dummy page type with the handle of <code class="literal">delete_me</code> for this exercise. We will also continue using <code class="literal">site_post.php</code> to execute arbitrary code.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec60"/>How to do it...</h2></div></div></div><p>The steps for deleting a page <a id="id64" class="indexterm"/>type are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Define the handle of the page to be deleted.<div class="informalexample"><pre class="programlisting">$handle = 'delete_me';</pre></div></li><li class="listitem">Load the page type by its handle.<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle($handle);</pre></div></li><li class="listitem">Now, delete the page type.<div class="informalexample"><pre class="programlisting">$pageType-&gt;delete();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec61"/>How it works...</h2></div></div></div><p>The <code class="literal">delete()</code> function deletes the page type, the Master Collection, and all of the pages that use it. Use this function very cautiously, as once the data has been deleted, it cannot be recovered (unless you have a backup copy of the site's database).</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec62"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Creating a page type"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec23"/>Creating a page type</h1></div></div></div><p>Creating pages dynamically is a central concept of concrete5 development and can unlock a lot of powerful features in <a id="id65" class="indexterm"/>custom applications. Imagine a concrete5 website that has a recipes database. You could make it so, that every time a recipe is added to the database, a new page for that recipe is added to the sitemap, immediately improving the depth of content on your website, its usability, and even search engine performance.</p><p>In this example, we will create an "About Us" page and add it to the sitemap.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec63"/>Getting ready</h2></div></div></div><p>We are continuing the practice of putting our code in <code class="literal">/config/site_post.php</code> for the purposes of demonstration and testing. In real-world use, your dynamic page creation would happen in controller files or in add-on packages.</p><p>We will be assigning the new page a page type with the handle of <code class="literal">right_sidebar</code>. If this doesn't exist in your own concrete5 installation, please adapt the recipe to suit your needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec64"/>How to do it...</h2></div></div></div><p>The steps for creating a page are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Load the page type that the new page will use. We will load the page type using its handle (<code class="literal">right_sidebar</code>, in this case).<div class="informalexample"><pre class="programlisting">$pageType = CollectionType::getByHandle('right_sidebar');</pre></div></li><li class="listitem">Create an associative array that contains the fields that you wish to specify for the new page. In this example, <a id="id66" class="indexterm"/>we will only specify the page's name and handle.<div class="informalexample"><pre class="programlisting">$data = array(
  'cName' =&gt; 'About Us',
  'cHandle' =&gt; 'about'
);</pre></div></li><li class="listitem">Load the parent page that the new page will be placed under. In this case, we are loading the home page, since the new page will be available at the top level.<div class="informalexample"><pre class="programlisting">$parent = Page::getByID(1);</pre></div></li><li class="listitem">Add the page by passing the <code class="literal">$pageType</code> object and <code class="literal">$data</code> array to the add function of the parent <code class="literal">Page</code> class.<div class="informalexample"><pre class="programlisting">$newPage = $parent-&gt;add($pageType, $data);</pre></div></li><li class="listitem">Output a message and exit the process.<div class="informalexample"><pre class="programlisting">echo 'done!';
exit;</pre></div></li><li class="listitem">Visit your site's homepage to execute the code in <code class="literal">site_post.php</code>.</li><li class="listitem">If you see the success message, comment out the code in <code class="literal">site_post.php</code> so you can visit the newly created page. Otherwise, concrete5 will create a new page every time the site is loaded into a browser.</li><li class="listitem">Visit the newly created page at <code class="literal">http://example.com/about</code>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec65"/>How it works...</h2></div></div></div><p>The <code class="literal">add()</code> function is a wrapper <a id="id67" class="indexterm"/>for the <code class="literal">Collection</code> class's <code class="literal">add()</code> function. Calling it will create a new <code class="literal">Collection</code> record in the database, and a new pending <code class="literal">CollectionVersion</code> record (which will be approved if the <code class="literal">cvIsApproved</code> variable is set to <code class="literal">true</code> or left blank). Then the new page will inherit the necessary permissions and get all of the blocks and other attributes from the <a id="id68" class="indexterm"/>Master Collection of the related page type.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec66"/>There's more...</h2></div></div></div><p>You will need to provide two parameters to the <code class="literal">add()</code> function, a <code class="literal">CollectionType</code> object (which we worked with earlier in this chapter), and an associative array containing all of the data needed to create the page. The associative array can contain the following fields.</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Attribute</p>
</th><th style="text-align: left" valign="bottom">
<p>Required?</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">cName</code></p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>This is the name <a id="id69" class="indexterm"/>of the page. This will be how the page is referred to throughout the site, and will be automatically used in the page's <code class="literal">&lt;title&gt;</code> tag (unless overridden by a meta title attribute, which you can specify after the page has been created.)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cHandle</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id70" class="indexterm"/>handle of the page, that is, how the page title will appear in the page URL. If you omit this field, concrete5 will generate a handle based off of the <code class="literal">cName</code> field. This is a little confusing, because concrete5 allows dash characters ("-") in page handles, but does not seem to support them anywhere else. This is good, though, because the typical convention for page paths on the web is to use dashes rather than underscores.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cDescription</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id71" class="indexterm"/>internal description of the page. It is just a string that describes the purpose of a page. Some themes might use this data somewhere in the theme, but it is not required. Older versions of concrete5 displayed the description of the page in the dashboard, but that has gone away since the update to version 5.5.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">uID</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>This is an integer <a id="id72" class="indexterm"/>ID to indicate the page's author. Pass in the ID of any user in the concrete5 <code class="literal">Users</code> table to set that user as the page author. If omitted, the currently logged in user will be registered as the page author.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">pkgID</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>This is an integer <a id="id73" class="indexterm"/>ID of the package that created this page. Make sure to include this field if you are creating pages from a package. If you omit this field, but the attached page type belongs to a package, the page type's package ID will be attached to this page. This will help users optionally remove any pages that were created by your package if they choose to uninstall your package.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cDatePublic</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>This is a MySQL-formatted <a id="id74" class="indexterm"/>date string (<code class="literal">YYYY-MM-DD</code>) of when this page should be publicly visible on the website. If omitted, the current date and time from the web server is used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cvIsApproved</code></p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top">
<p>This is a Boolean <a id="id75" class="indexterm"/>that indicates if the initial page version should be approved. Defaults to true if nothing is specified. When pages are approved, they are made immediately visible to all users that have permission to access that page on the website. Any subsequent edits to a page will require the new versions of the page to be approved before users can see the changes.</p>
</td></tr></tbody></table></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec67"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Updating an existing page</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its ID</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page type by its handle</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Updating an existing page"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec24"/>Updating an existing page</h1></div></div></div><p>Updating pages is similar to <a id="id76" class="indexterm"/>creating them in that you must first pass in an associative array containing all of the data that you wish to update on the page.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec68"/>Getting ready</h2></div></div></div><p>In this recipe, we will be modifying a page with the path of <code class="literal">/about</code>. We created that page in the previous recipe, but if it does not exist on your system, please adapt the code to your needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec69"/>How to do it...</h2></div></div></div><p>In this example, we will update the name of the <code class="literal">About</code> page. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we need to load the <code class="literal">Page</code> object by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Create an associative array with the data that you wish to update.<div class="informalexample"><pre class="programlisting">$data = array(
  'cName' =&gt; 'About Our Company'
);</pre></div></li><li class="listitem">Pass the data array into the <code class="literal">$page</code> object's update function.<div class="informalexample"><pre class="programlisting">$page-&gt;update($data);</pre></div></li><li class="listitem">Output a success message and exit the process.<div class="informalexample"><pre class="programlisting">echo 'done!';
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec70"/>How it works...</h2></div></div></div><p>The <code class="literal">update</code> function updates <a id="id77" class="indexterm"/>the necessary tables in the database with the newly specified information. concrete5 will also rescan all permissions for this page and all of the related page paths. When the function is complete, the <code class="literal">on_page_update</code> event is <a id="id78" class="indexterm"/>fired, which you can write custom code to listen to and perform custom actions when a page is updated. Listening to system events is covered in a later chapter.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec71"/>There's more...</h2></div></div></div><p>Just like creating a page, you will need to pass an associative array to the <code class="literal">update()</code> function in order to update an existing page. You can use all of the fields specified in the previous recipe for adding a page, in addition to these other optional fields.</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Attribute</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p><code class="literal">ctID</code></p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id79" class="indexterm"/>numerical ID of a page type to change the page to. Supply this field to change the page type of a given page.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cCacheFullPageContent</code></p>
</td><td style="text-align: left" valign="top">
<p>A Boolean <a id="id80" class="indexterm"/>that specifies if the page should support full page caching (some block types do not support full page caching, so only use this when the blocks on that page offer full caching support).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cCacheFullPageContentOverrideLifetime</code></p>
</td><td style="text-align: left" valign="top">
<p>A <a id="id81" class="indexterm"/>string to tell concrete5 how the cache lifetime should perform. Possible values are <code class="literal">default</code>, <code class="literal">custom</code>, or <code class="literal">forever</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><code class="literal">cCacheFullPageContentLifetimeCustom</code></p>
</td><td style="text-align: left" valign="top">
<p>A <a id="id82" class="indexterm"/>setting in <a id="id83" class="indexterm"/>minutes as to how long the cache should last when the override mode is set to <code class="literal">custom</code>.</p>
</td></tr></tbody></table></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec72"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a page type</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Setting page attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec25"/>Setting page attributes</h1></div></div></div><p>Pages, like most objects in concrete5, <a id="id84" class="indexterm"/>can have any type of custom attribute attached to them. This allows for immense flexibility, but it can be difficult to read and write these attributes using raw SQL. The concrete5 API makes setting and reading page attributes easy.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec73"/>Getting ready</h2></div></div></div><p>You will need to know at least the handle of the attribute key that you wish to assign to the page. A common attribute to set is the <code class="literal">Meta Title</code> attribute, which updates the text that appears in the HTML <code class="literal">&lt;title&gt;</code> tag.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec74"/>How to do it...</h2></div></div></div><p>We will set the <code class="literal">Meta Title</code> attribute to the About Us page in this example. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the <code class="literal">Page</code> object that you wish to set the attribute on.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Call the <code class="literal">setAttribute</code> function on the <code class="literal">$page</code> object, passing in two parameters: the attribute handle (key), and the value.<div class="informalexample"><pre class="programlisting">$page-&gt;setAttribute('meta_title', 'New Page Meta Title');</pre></div></li><li class="listitem">Output a success message and exit the process.<div class="informalexample"><pre class="programlisting">echo 'done!';
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec75"/>How it works...</h2></div></div></div><p>The <code class="literal">setAttribute</code> <a id="id85" class="indexterm"/>function is a member of the <code class="literal">Collection</code> class, which the <code class="literal">Page</code> class extends. It requires that you provide two <a id="id86" class="indexterm"/>parameters, an attribute key (which can either be a string representing the attribute key handle (which we provided here), or an actual <code class="literal">AttributeKey</code> object), and the value.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec76"/>There's more...</h2></div></div></div><p>The <code class="literal">setAttribute</code> function is very handy for setting the data of any kind of page attribute. One can update a page's meta information (such as description, keywords, and title) and also give the page various options, such as, excluding it from the navigation (as seen previously) or from the <code class="literal">sitemap.xml</code> file that search engines look for.</p><p>You can update any attribute that has been installed in the concrete5 system. To see all available page attributes, or to create new ones, visit the <span class="strong"><strong>Page Attributes</strong></span> area of your site's dashboard (located at <code class="literal">/dashboard/pages/attributes/</code>).</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec77"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page attribute</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page attribute"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec26"/>Getting a page attribute</h1></div></div></div><p>In addition to being able to set page <a id="id87" class="indexterm"/>attributes, developers can also retrieve attributes just as easily. In this exercise, we will get the <code class="literal">Meta Title</code> attribute for the About page.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec78"/>Getting ready</h2></div></div></div><p>We are assuming the presence of a page with the path of <code class="literal">/about</code> in this recipe. If that page does not exist, you can create it, or adapt the code in this recipe to fit your circumstances.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec79"/>How to do it...</h2></div></div></div><p>The steps for getting a page attribute are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred editor. This is a good place to run some arbitrary code.</li><li class="listitem">Load the <code class="literal">Page</code> object.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the <code class="literal">meta_title</code> attribute.<div class="informalexample"><pre class="programlisting">$title = $page-&gt;getAttribute('meta_title');</pre></div></li><li class="listitem">Dump the variable using the custom debugging function that we created in the chapter's introduction.<div class="informalexample"><pre class="programlisting">my_debug($title);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec80"/>How it works...</h2></div></div></div><p>concrete5 uses the attribute handle string to find the appropriate record in the database and return its value. concrete5 stores attributes in the <a id="id88" class="indexterm"/>EAV format (<span class="strong"><strong>entity</strong></span>, <span class="strong"><strong>attribute</strong></span>, <span class="strong"><strong>value</strong></span>), and this makes it difficult to read these values directly with SQL queries. The concrete5 API simplifies this for developers.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec81"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Setting a page attribute</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec27"/>Getting a page's ID</h1></div></div></div><p>Developers will often need to know a page's ID, especially when relating pages to other database objects (such as a blog <a id="id89" class="indexterm"/>post or calendar event). In this example, we will load the <code class="literal">/about</code> page that we've been working with and get its ID.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec82"/>Getting ready</h2></div></div></div><p>Please make sure the <code class="literal">/about</code> page exists in your instance of concrete5. Feel free to modify the code in this recipe if that page does not exist.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec83"/>How to do it...</h2></div></div></div><p>The steps for getting a page's ID are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Load the <code class="literal">Page</code> object by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the page's ID.<div class="informalexample"><pre class="programlisting">$id = $page-&gt;getCollectionId();</pre></div></li><li class="listitem">Dump the contents of the <code class="literal">$id</code> variable to see what the ID is.<div class="informalexample"><pre class="programlisting">my_debug($id);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec84"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's path"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec28"/>Getting a page's path</h1></div></div></div><p>In addition to being able to get a page's <a id="id90" class="indexterm"/>ID, developers can also retrieve the path for a page. In this recipe, we will load a page by its ID and then retrieve its path.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec85"/>How to do it...</h2></div></div></div><p>The steps for getting a page's path are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the page by its ID. We will use the ID of <code class="literal">4</code> here, which should belong to a page on the dashboard.<div class="informalexample"><pre class="programlisting">$page = Page::getByID(4);</pre></div></li><li class="listitem">Get the page's path.<div class="informalexample"><pre class="programlisting">$path = $page-&gt;getCollectionPath();</pre></div></li><li class="listitem">Use the custom debugging function to output the path.<div class="informalexample"><pre class="programlisting">my_debug($path);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec86"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <a id="id91" class="indexterm"/><span class="emphasis"><em>Getting a page by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's handle"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec29"/>Getting a page's handle</h1></div></div></div><p>Pages, like page types and other <a id="id92" class="indexterm"/>objects in concrete5, have handles in addition to paths. The handle is similar to a <a id="id93" class="indexterm"/>slug in other content management systems. In this exercise, we will load a page by its ID and then retrieve its handle.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec87"/>How to do it...</h2></div></div></div><p>The steps for getting a page's handle are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor.</li><li class="listitem">Load the page by its ID.<div class="informalexample"><pre class="programlisting">$page = Page::getByID(4);</pre></div></li><li class="listitem">Get the page's handle.<div class="informalexample"><pre class="programlisting">$handle = $page-&gt;getCollectionHandle();</pre></div></li><li class="listitem">Dump the handle variable to see its contents.<div class="informalexample"><pre class="programlisting">my_debug($handle);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec88"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its ID</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's name"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec30"/>Getting a page's name</h1></div></div></div><p>Page names are often used as the de <a id="id94" class="indexterm"/>facto titles in concrete5. In this exercise, we will load a page by its path, and then get its name.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec89"/>How to do it...</h2></div></div></div><p>The steps for getting a page's name are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your editor.</li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the page's title.<div class="informalexample"><pre class="programlisting">$name = $page-&gt;getCollectionName();</pre></div></li><li class="listitem">Dump the contents of the title variable.<div class="informalexample"><pre class="programlisting">my_debug($name);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec90"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> <a id="id95" class="indexterm"/>recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's description"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec31"/>Getting a page's description</h1></div></div></div><p>Page descriptions are not used very widely used in concrete5. Some themes will treat them as content excerpts, while other <a id="id96" class="indexterm"/>add-ons will use descriptions as a generic attribute storage area. Regardless, they are still built into concrete5, and in this recipe we will load a page by its path and retrieve its description.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec91"/>Getting ready</h2></div></div></div><p>Many pages in concrete5 do not have descriptions. If you wish, you can edit a page to add a description as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/4548OS_01_05.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec92"/>How to do it...</h2></div></div></div><p>The steps for getting a page's description are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">/config/site_post.php</code> file in your code editor.</li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the page's description.<div class="informalexample"><pre class="programlisting">$description = $page-&gt;getCollectionDescription();</pre></div></li><li class="listitem">Dump the contents of the description variable.<div class="informalexample"><pre class="programlisting">my_debug($description);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec93"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's page type ID"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec32"/>Getting a page's page type ID</h1></div></div></div><p>As we discussed earlier in the chapter, pages are assigned a page type. In this recipe, we will get the page type ID from a <code class="literal">Page</code> object.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec94"/>How to do it...</h2></div></div></div><p>The steps for getting a page's page type ID are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor, so we can run some arbitrary code.</li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the page type ID for this page.<div class="informalexample"><pre class="programlisting">$pageTypeId = $page-&gt;getCollectionTypeID();</pre></div></li><li class="listitem">Dump the page type ID using our custom debugging function.<div class="informalexample"><pre class="programlisting">my_debug($pageTypeId);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec95"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's page type handle"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec33"/>Getting a page's page type handle</h1></div></div></div><p>In addition to being able to retrieve the <a id="id97" class="indexterm"/>ID of a page's page type, developers can also get the handle.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec96"/>How to do it...</h2></div></div></div><p>The steps for getting a page's page type handle are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your code editor, since we will just be running some arbitrary code.</li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the page type handle.<div class="informalexample"><pre class="programlisting">$handle = $page-&gt;getCollectionTypeHandle();</pre></div></li><li class="listitem">Dump the handle variable to see its contents.<div class="informalexample"><pre class="programlisting">my_debug($handle);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec97"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> <a id="id98" class="indexterm"/>recipe</li></ul></div></div></div>
<div class="section" title="Getting a page's theme object"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec34"/>Getting a page's theme object</h1></div></div></div><p>Every page can have its own individual <a id="id99" class="indexterm"/>theme in concrete5. While it's typical for most sites to only use one global theme, concrete5 does allow developers to set individual themes for each page. In this recipe, we will get the page's theme object, which can be used to see what theme is active on a given page.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec98"/>How to do it...</h2></div></div></div><p>The steps for getting a page's theme object are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the page by its path.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/about');</pre></div></li><li class="listitem">Get the theme object.<div class="informalexample"><pre class="programlisting">$theme = $page-&gt;getCollectionThemeObject();</pre></div></li><li class="listitem">Dump the theme object to inspect the class.<div class="informalexample"><pre class="programlisting">my_debug($theme);</pre></div></li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec99"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting the children below a page"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec35"/>Getting the children below a page</h1></div></div></div><p>If you need to access the children of a <a id="id100" class="indexterm"/>page, you can have concrete5 return an array of numerical IDs. These IDs can then be used to load each of the <code class="literal">Page</code> objects individually.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec100"/>How to do it...</h2></div></div></div><p>The steps for getting the <a id="id101" class="indexterm"/>children below a page are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code> in your preferred code editor.</li><li class="listitem">Load the parent page by its ID.<div class="informalexample"><pre class="programlisting">$page = Page::getByID(1);</pre></div></li><li class="listitem">Get the array of child IDs.<div class="informalexample"><pre class="programlisting">$children = $page-&gt;getCollectionChildrenArray();</pre></div></li><li class="listitem">Loop through the child ID array and output the name of each page.<div class="informalexample"><pre class="programlisting">foreach ($children as $childId) {
  $child = Page::getByID($childId);
  echo $child-&gt;getCollectionName().'&lt;br /&gt;';
}</pre></div></li><li class="listitem">Exit the process.<div class="informalexample"><pre class="programlisting">exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec101"/>How it works...</h2></div></div></div><p>concrete5 will return an array of <a id="id102" class="indexterm"/>numeric IDs for each of the pages beneath the parent page. In this example, we loaded the home page, so the result should be a list of every page on the website. This function ignores permissions, and can be taxing on the database if there are a lot of pages to load. It is a better idea to use the <code class="literal">PageList</code> class <a id="id103" class="indexterm"/>to loop through pages, and that class is described later on in this chapter.</p></div></div>
<div class="section" title="Moving a page"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec36"/>Moving a page</h1></div></div></div><p>The concrete5 sitemap is a great tool for managing the page hierarchy of your website. It lets you arrange the order of pages, and even drag-and-drop pages to different areas of the site. Thankfully, you aren't <a id="id104" class="indexterm"/>limited to using the graphical interface to move pages around the site. You can also rearrange pages dynamically in your custom concrete5 applications.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec102"/>Getting ready</h2></div></div></div><p>In this example, we are going to move a Careers page underneath the About Us page. Before we can move a page, we need to have the <code class="literal">Page</code> object of the new parent page that we are moving the current page to.</p><p>This exercise assumes that pages exist at both <code class="literal">/about</code> and <code class="literal">/careers</code> in your concrete5 site. You can create those pages through the concrete5 interface, or adapt the code in this recipe to work with pages that exist on your own site.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec103"/>How to do it...</h2></div></div></div><p>The steps for moving a page are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">/config/site_post.php</code>, as that is a safe place to play with some random code.</li><li class="listitem">First, load the About Us page, which is where the Careers page will be moved to.<div class="informalexample"><pre class="programlisting">$newParent = Page::getByPath('/about');</pre></div></li><li class="listitem">Now, we need to load the careers page that we are moving.<div class="informalexample"><pre class="programlisting">$careersPage = Page::getByPath('/careers');</pre></div></li><li class="listitem">Finally, call the <code class="literal">move</code> function on the careers page, passing it the new parent page and an optional Boolean which tells concrete5 if we want to save the old page path as well as the new one.<div class="informalexample"><pre class="programlisting">$careersPage-&gt;move($newParent, true);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec104"/>How it works...</h2></div></div></div><p>The move function is very easy to use. You only need to provide one parameter, which is a <code class="literal">Page</code> object of the new parent that you are moving the page under. There is an optional second parameter to indicate if you wish to <a id="id105" class="indexterm"/>retain the old page path in addition to the current one. That parameter defaults to false.</p><p>Once the page is moved, it will inherit the permissions of the new parent page (if the page does not have its own permissions set explicitly).</p><p>Once the page is moved, the event <code class="literal">on_page_move</code> is fired.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec105"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Listening to system events</em></span> in <a class="link" href="ch09.html" title="Chapter 9. System Events and Advanced Configuration">Chapter 9</a>, <span class="emphasis"><em>System Events and Advanced Configuration</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a Page object by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Deleting a page (and its children)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec37"/>Deleting a page (and its children)</h1></div></div></div><p>concrete5 also makes it <a id="id106" class="indexterm"/>easy to delete pages from the sitemap.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec106"/>Getting ready</h2></div></div></div><p>Deleting pages is a permanent destructive action. When experimenting with this code, it would be a good idea to create a dummy page with a path of <code class="literal">/delete-me</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec107"/>How to do it...</h2></div></div></div><p>We will permanently delete the about us page and all of its child pages. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, load the page that you wish to delete. We will delete a dummy page.<div class="informalexample"><pre class="programlisting">$page = Page::getByPath('/delete-me');</pre></div></li><li class="listitem">Call the <code class="literal">delete()</code> function on the <code class="literal">Page</code> object.<div class="informalexample"><pre class="programlisting">$page-&gt;delete();</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec108"/>How it works...</h2></div></div></div><p>concrete5 will fire the <code class="literal">on_page_delete</code> event before any actual deleting occurs. After the event fires, the page (and all of its <a id="id107" class="indexterm"/>children) are deleted from the database. This operation is permanent, so it is important to make sure that you only delete pages when you are certain that they are no longer needed.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec109"/>There's more...</h2></div></div></div><p>If you don't want to permanently delete a page, you can move it to the Trash. As of concrete5 version 5.5, pages can be "temporarily" deleted and moved under a special internal page called the Trash.</p><div class="informalexample"><pre class="programlisting">$page-&gt;moveToTrash();</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec110"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Getting a page by its path</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Getting a list of pages"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec38"/>Getting a list of pages</h1></div></div></div><p>Many applications will have a need to get a list of pages and perform various filter and sorting functions on the list. For this, there is the <code class="literal">PageList</code> class, which exposes many convenient helper functions to assist in working with large lists of pages.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec111"/>Getting ready</h2></div></div></div><p>In this example, we are going to find all <a id="id108" class="indexterm"/>of the pages under the <code class="literal">/blog</code> page. This is a common use of the page list model. The <code class="literal">PageList</code> class is not automatically loaded by concrete5, so we will need to use the <code class="literal">Loader</code> class to have it available to us.</p><p>If your site does not have a page located at <code class="literal">/blog</code>, it would be helpful to create that page, as well as a few child pages below it. Otherwise, feel free to adapt the code in this recipe to suit your needs.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec112"/>How to do it...</h2></div></div></div><p>In this recipe, we will get a list of 20 pages <a id="id109" class="indexterm"/>that exist under <code class="literal">/blog</code> in the sitemap. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we must make the <code class="literal">PageList</code> class available for us to use.<div class="informalexample"><pre class="programlisting">Loader::model('page_list');</pre></div></li><li class="listitem">Create a new instance of the <code class="literal">PageList</code> class. We will assign it to a variable called <code class="literal">$list</code>.<div class="informalexample"><pre class="programlisting">$list = new PageList();</pre></div></li><li class="listitem">Filter the list to only include pages underneath the <code class="literal">/blog</code> page.<div class="informalexample"><pre class="programlisting">$list-&gt;filterByPath('/blog');</pre></div></li><li class="listitem">Limit the list of pages to only include the first 20 results.<div class="informalexample"><pre class="programlisting">$list-&gt;setItemsPerPage(20);</pre></div></li><li class="listitem">Run the database query and get the first "page" of results, which will return an array of 20 <code class="literal">Page</code> objects.<div class="informalexample"><pre class="programlisting">$pages = $list-&gt;getPage();</pre></div></li><li class="listitem">Dump the contents of the pages variable to see the array.<div class="informalexample"><pre class="programlisting">foreach ($pages as $page) {
  echo $page-&gt;getCollectionTitle().'&lt;br /&gt;';
}
exit;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec113"/>How it works...</h2></div></div></div><p>The <code class="literal">PageList</code> class extends the <a id="id110" class="indexterm"/>core <code class="literal">DatabaseItemList</code> class, which has a number of useful functions itself. The <a id="id111" class="indexterm"/>
<code class="literal">get()</code> function accepts two parameters, the number of records to retrieve, and the offset.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec114"/>There's more...</h2></div></div></div><p>The page list class implements "magic methods," which allow allow us to filter the list by any page attribute. We simply need to create a function name based off of the camel cased version of the attribute handle, preceded by "filterBy". So to filter all pages that have the <code class="literal">exclude_nav</code> attribute, we <a id="id112" class="indexterm"/>would write the following function:</p><div class="informalexample"><pre class="programlisting">$list-&gt;filterByExcludeNav(true);</pre></div><p>Alternatively, if you want to just get an array of the first 99 <code class="literal">Page</code> objects and ignore pagination, use the <a id="id113" class="indexterm"/>
<code class="literal">get()</code> function.</p><div class="informalexample"><pre class="programlisting">$pages = $list-&gt;get(99);</pre></div><p>Since version 5.5, concrete5 uses Twitter's open source Bootstrap CSS framework for many of their internal styles. You can get the pagination controls in nicely formatted HTML (with relevant Bootstrap CSS classes) by printing/echoing the results of the following function (preferably you'd use this function in a view or template file of a block or single page):</p><div class="informalexample"><pre class="programlisting">echo $list-&gt;displayPagingV2();</pre></div><p>The <code class="literal">DatabaseItemList</code> class and <a id="id114" class="indexterm"/>
<code class="literal">PageList</code> class have several functions that make working with a collection of pages easier. <a id="id115" class="indexterm"/>You can filter by keywords, by collection type, parent page, and by any attribute using magic methods. We will cover the <code class="literal">DatabaseItemList</code> class further in <a class="link" href="ch05.html" title="Chapter 5. Working with Databases and Models">Chapter 5</a>, <span class="emphasis"><em>Working with Databases and Models</em></span>.</p></div></div>
<div class="section" title="Adding a page selector field to a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec39"/>Adding a page selector field to a form</h1></div></div></div><p>It is easy to add a page selector <a id="id116" class="indexterm"/>field to a form. When clicked on, the sitemap will appear in a modal window, allowing for easy browsing and selecting of a page. <a id="id117" class="indexterm"/>This allows for user friendly custom applications that can allow users to attach pages to any type of custom object, like a blog post or cooking recipe, for example.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec115"/>Getting ready</h2></div></div></div><p>We will need to use the <code class="literal">FormPageSelectorHelper</code> class, which we will need to load using the <code class="literal">Loader</code> library.</p><p>This recipe will need to be written inside of an HTML form somewhere in your site. We have created a basic single page for this purpose, which can be downloaded with the code from the website for this book. To install the single page, copy the code for this recipe to your concrete5 site directory and visit <code class="literal">/dashboard/pages/single</code>. Add a new single page with a path of <code class="literal">/example</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec116"/>How to do it...</h2></div></div></div><p>concrete5 includes a helper to generate the necessary JavaScript and HTML text needed to show the sitemap selector widget. We will use the <code class="literal">Loader</code> class to include and return the <code class="literal">PageSelectorHelper</code> class, <a id="id118" class="indexterm"/>which will then return the entire HTML that we need. The steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make the <code class="literal">pageSelector</code> helper class available for us to use. The <code class="literal">Loader</code> class will automatically instantiate and return the instantiated helper object when the helper gets loaded.<div class="informalexample"><pre class="programlisting">$pageSelector = Loader::helper('form/page_selector');</pre></div></li><li class="listitem">Output the HTML and JavaScript required allowing users to select a page.<div class="informalexample"><pre class="programlisting">echo $pageSelector-&gt;selectPage('page_id');</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec117"/>How it works...</h2></div></div></div><p>The <code class="literal">selectPage</code> function <a id="id119" class="indexterm"/>returns the HTML and JavaScript necessary to produce a page selector field. There is only one parameter required, and that is a string indicating the name of the field. concrete5 will <a id="id120" class="indexterm"/>add a hidden <code class="literal">&lt;input&gt;</code> element to the form, which <a id="id121" class="indexterm"/>will allow the selected page ID to be read from a POST request.</p><p>In this example, once the form is submitted, you could retrieve the selected page ID by looking in the <code class="literal">$_POST</code> super variable.</p><div class="informalexample"><pre class="programlisting">$pageId = $_POST['page_id'];</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec118"/>There's more...</h2></div></div></div><p>You can specify a page ID in the optional second parameter, which will populate the page selector with an existing page.</p><div class="informalexample"><pre class="programlisting">$page = Page::getByCollectionPath('/about-us');
echo $pageSelector-&gt;selectPage('page_id', $page-&gt;getCollectionID());</pre></div><p>The <code class="literal">pageSelector</code> helper also has a function to display a sitemap in a modal window.</p><div class="informalexample"><pre class="programlisting">$args = array(
'display_mode' =&gt; 'full'
);
$pageSelector-&gt;sitemap($args);</pre></div><p>Note that the <code class="literal">sitemap()</code> <a id="id122" class="indexterm"/>function loads an element, which is automatically printed to the screen, so there is no need to echo or print the result.</p></div></div></body></html>