<html><head></head><body><div class="appendix" title="Appendix&#xA0;A.&#xA0;Setting up the Essentials"><div class="titlepage"><div><div><h1 class="title"><a id="appA"/>Appendix A. Setting up the Essentials</h1></div></div></div><p>In the appendix we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Making sure you have all that you need</li><li class="listitem" style="list-style-type: disc">Downloading Zend Framework 2 and finding its documentation</li><li class="listitem" style="list-style-type: disc">Composer and its uses within Zend Framework 2</li><li class="listitem" style="list-style-type: disc">Basic Zend Framework 2 structures</li><li class="listitem" style="list-style-type: disc">About storage adapters and patterns</li></ul></div><div class="section" title="Making sure you have all that you need"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec54"/>Making sure you have all that you need</h1></div></div></div><p>The Zend Server<a id="id696" class="indexterm"/> is a nice piece of software that takes out a lot of work from our hands by installing everything we need (or at least provide a good platform) to code Zend Framework 2 (and Zend Framework 1!) applications. Although the paid version of Zend Server might not be necessary for production applications, developing in the developer version of the Zend Server is a pure delight as it will give a proper overview of the system, logs, configuration, and everything else we need to know.</p><p>We are going the cheap way by installing the Zend Server Community Edition, which installs everything we need to use Zend Framework and Zend Framework 2. The handy thing about the Zend Server is not only the ease of installation, but the immense toolset you get with the server itself. It is a great product to get a good overview of any PHP related configuration and is also able to monitor performance and track events in your system.</p><p>To install the<a id="id697" class="indexterm"/> Zend Server we need to download it first from the Zend <a id="id698" class="indexterm"/>website (<a class="ulink" href="http://www.zend.com">http://www.zend.com</a>), at the moment Zend Server 6.2.0 is the latest version of the application, and although we use it, the installation process should be the same for any later versions.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>Zend Server is not needed to run Zend Framework 2, but does, however, provide an excellent platform that needs only minimal configuration to get started.</p></div></div><div class="section" title="Installing Zend Server Community Edition on a Linux environment"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec130"/>Installing Zend Server Community Edition on a Linux environment</h2></div></div></div><p>When we have <a id="id699" class="indexterm"/>downloaded Zend Server <a id="id700" class="indexterm"/>for Linux (you need a free Zend account to download any of their software), we will have a file called <code class="literal">ZendServer-6.2.0-RepositoryInstaller-linux.tar.gz</code>.</p><p>Next, to install the Zend Server we need to execute the following command sequence:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ tar -xf ZendServer-6.2.0-RepositoryInstaller-linux.tar.gz</strong></span>
</pre></div><p>This will unpack the Gzipped Tarball (this is a compression method) package and extract it in the <code class="literal">ZendServer-RepositoryInstaller-linux</code> directory. Now let's install the Zend Server:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ZendServer-RepositoryInstaller-linux/</strong></span>
<span class="strong"><strong>$ sudo ./install_zs.sh 5.4</strong></span>
</pre></div><p>We have chosen to install PHP 5.4, and if there is no reasonable explanation why we need PHP 5.3, we recommend keeping it in this version. If we need PHP 5.3, however, we can easily change the 5.4 to 5.3 and it will install the lower PHP version. Once we execute the <code class="literal">install_zs.sh</code> command as the root user (hence, the <code class="literal">sudo</code>, which tells the system we want to execute a command as a super user) we will get a short confirmation window asking us if we really want to install the Zend Server. Simply press <span class="emphasis"><em>Enter</em></span> to continue the installation.</p><p>At some point during the installation, the script will ask if you want to install X amount of new packages. You want to answer <code class="literal">Y</code> or <code class="literal">yes</code> for that, otherwise the installation will end there.</p><p>The installation itself takes a couple of minutes and upon successful installation, the script will display the following message:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>********************************************************</strong></span>
<span class="strong"><strong>* Zend Server was successfully installed.              *</strong></span>
<span class="strong"><strong>*                                                      *</strong></span>
<span class="strong"><strong>* To access the Zend Server UI open your browser at:   *</strong></span>
<span class="strong"><strong>* https://&lt;hostname&gt;:10082/ZendServer (secure)         *</strong></span>
<span class="strong"><strong>* or                                                   *</strong></span>
<span class="strong"><strong>* http://&lt;hostname&gt;:10081/ZendServer                   *</strong></span>
<span class="strong"><strong>********************************************************</strong></span>
</pre></div></div></div><p>Security wise it is best to always use the secure version of Zend Server, as you want to make sure <a id="id701" class="indexterm"/>that <a id="id702" class="indexterm"/>passwords are put in securely. However, while working locally it doesn't really matter that much.</p></div><div class="section" title="Installing Zend Server Community Edition on a Windows environment"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec131"/>Installing Zend Server Community Edition on a Windows environment</h2></div></div></div><p>When <a id="id703" class="indexterm"/>we have<a id="id704" class="indexterm"/> downloaded the Zend Server for Microsoft Windows (you need a free Zend account to download any of their software) and we started up the <code class="literal">ZendServer-6.2.0-php-5.4.21-Windows_x86.exe</code> file, we find ourselves again with a very simple installation. If we choose the custom installation, we have a few options that we can change, but normally the default options are fine enough for us.</p><p>Another great thing about the Windows installation of Zend Server is that the installation program asks us if we want to use an existing IIS web server or install an Apache server instead.</p><p>What option you choose is all down to the configuration requirements for the rest of the project, assuming that we have more requirements; otherwise, we would really need to reconsider using Windows for our PHP environment.</p><p>After a summary screen of the installation we are about to commence, the installation will continue and configure the system. If the installation has been completed successfully, we get the option to start working with the Zend Server and to add the Zend Server as a desktop icon.</p></div><div class="section" title="First-time run of Zend Server"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec132"/>First-time run of Zend Server</h2></div></div></div><p>If we go to the <a id="id705" class="indexterm"/>Zend Server interface in the browser for the first time (please note that the Zend Server in Windows does not have the secure connection built-in like the Linux version has), we will see the license agreement, which we need to accept before we can go on.</p><p>In the next screen, depending on the purpose of the Zend Server, we need to choose between the Development, Single Server, or Cluster license. The Single Server and Cluster license come standard with a 30-day trial version, and if we are new to the Zend Server then this is the best option to see the full server capabilities in action.</p><p>Next up is setting the administrator and developer password. If we are not the only one working on the server environment, it is best to use separate accounts as that creates a better maintenance structure in the organization; if only one person (or account) is capable of changing the system settings, then we can just skip filling in the developer details as they will not really have any use.</p><p>Once we have<a id="id706" class="indexterm"/> done all that, we are ready to login for the first time in our brand new system.</p><p>By default the login URL to the administration panel is <code class="literal">http://localhost:10081/ZendServer</code> for the non secure panel and <code class="literal">https://localhost:10082/ZendServer</code> for the secure administration panel.</p><p>The first thing we will see is the overview of the server's health, which also displays the current events that have taken place such as high memory uses, exceptions, and slow execution times.</p><p>The main bit we want to view now is the PHP configuration, which can be found in the <span class="strong"><strong>Configuration</strong></span> screen, under <span class="strong"><strong>PHP</strong></span>. It is very important to set the time zone for PHP as otherwise PHP will annoy us(for a reason: as some application developers erroneously believe that the machine is running on their local time zone, and base many of their date and time code on this) with warnings telling us that this should be set. If we search for the <code class="literal">date.timezone</code> in the search bar in the top right corner of the screen, it will take us (and highlight) immediately to the setting that we need to change. We can easily search on the Internet what the relevant value is for our specific time zone; this can be, for example, <code class="literal">Europe/London</code> or <code class="literal">America/New_York</code>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec133"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">PHP manual: This is a list of supported time zones <a class="ulink" href="http://php.net/manual/en/timezones.php">http://php.net/manual/en/timezones.php</a></li></ul></div></div></div></div>
<div class="section" title="Downloading Zend Framework 2 and finding its documentation"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec55"/>Downloading Zend Framework 2 and finding its documentation</h1></div></div></div><p>Let's find out where to get all the essential literature on the Zend Framework.</p><div class="section" title="Finding Zend Framework 2"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec134"/>Finding Zend Framework 2</h2></div></div></div><p>The main <a id="id707" class="indexterm"/>website of Zend Framework 2 is <a class="ulink" href="http://framework.zend.com">http://framework.zend.com</a> and always holds the most updated information on Zend Framework 2. We can easily download the framework from there, as well as some packages, for example the framework including the Zend Server, or the minimal package of Zend Framework.</p><p>Downloading <a id="id708" class="indexterm"/>only the framework itself, without any context like the skeleton application is a great way of starting an application from scratch without any of the clutter that comes with the default skeleton.</p></div><div class="section" title="Coding in the phpcloud"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec135"/>Coding in the phpcloud</h2></div></div></div><p>A new toy made<a id="id709" class="indexterm"/> by Zend that is currently still in beta level is the phpcloud, which allows developers to create a fast reliable development environment for developers to develop on. One of the features of using the phpcloud is that it not only comes with Zend Framework 2, but also runs on the Zend Server which allows spectacular debugging capabilities and application deployment. At the moment sign up for the phpcloud is free, but we can assume that this will change in the future. How this will turn out, however, is not known to us yet.</p></div><div class="section" title="The documentation and getting started guide"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec136"/>The documentation and getting started guide</h2></div></div></div><p>The Zend Framework 2 documentation<a id="id710" class="indexterm"/> is luckily much more reliable than the original Zend Framework documentation (which is a good thing, trust me). Zend really committed to creating a framework that is well documented and has an open contribution that is powered by a strong community and tools like Github (instead of Subversion as in the original framework). The documentation and getting started guide can both be found under the <span class="strong"><strong>Learn</strong></span> menu option on the main Zend Framework 2 website.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec137"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The main Zend Framework 2 website found at <a class="ulink" href="http://framework.zend.com">http://framework.zend.com</a></li><li class="listitem" style="list-style-type: disc">The Zend Framework 2 Coding Standards found at <a class="ulink" href="http://framework.zend.com/wiki/x/yQCvAg">http://framework.zend.com/wiki/x/yQCvAg</a></li><li class="listitem" style="list-style-type: disc">The latest Zend Framework 2 Documentation PDF found at <a class="ulink" href="https://media.readthedocs.org/pdf/zf2/latest/zf2.pdf">https://media.readthedocs.org/pdf/zf2/latest/zf2.pdf</a></li><li class="listitem" style="list-style-type: disc">The Zend Framework 2 Security RSS Feed found at <a class="ulink" href="http://framework.zend.com/security/feed/">http://framework.zend.com/security/feed/</a></li><li class="listitem" style="list-style-type: disc">The Zend Framework 2 Blog RSS Feed found at <a class="ulink" href="http://framework.zend.com/blog/feed-rss.xml">http://framework.zend.com/blog/feed-rss.xml</a></li></ul></div></div></div>
<div class="section" title="Composer and its uses within Zend Framework 2"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec56"/>Composer and its uses within Zend Framework 2</h1></div></div></div><p>Composer<a id="id711" class="indexterm"/> is a dependency manager tool for PHP, which has<a id="id712" class="indexterm"/> been live since the spring of 2011, and is incredibly handy when it comes to getting projects set up with ease.</p><p>Composer reads its configuration from a file called <code class="literal">composer.json</code>, which is a JSON file that is being read by <code class="literal">composer.phar</code> (PHP archive).</p><a id="id713" class="indexterm"/><p>We can use Composer to initialize the Zend Framework 2 library when we are using the Zend Framework 2 skeleton application. Other functionalities within Zend Framework 2 include installing new modules or libraries, which we can use to extend our application.</p><div class="section" title="The composer.json file"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec138"/>The composer.json file</h2></div></div></div><p>If <a id="id714" class="indexterm"/>we <a id="id715" class="indexterm"/>open up the <code class="literal">composer.json</code> file we can see that the file has a couple of keys defined, which tells the Composer what it needs to load, and what versions we need. By default, the Zend Framework 2 skeleton application's <code class="literal">composer.json</code> will look similar to the following:</p><div class="informalexample"><pre class="programlisting">{
    "name": "zendframework/skeleton-application",
    "description": "Skeleton Application for ZF2",
    "license": "BSD-3-Clause",
    "keywords": [
        "framework",
        "zf2"
    ],
    "homepage": "http://framework.zend.com/",
    "require": {
        "php": "&gt;=5.3.3",
        "zendframework/zendframework": "&gt;2.2.0rc1",
    }
}</pre></div><p>As we can see the file is pretty easy to understand, and the keys are pretty self explanatory, but to be sure we will go through them quickly to make sure we understand what is going on.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: This is the name of the package with the vendor name as the prefix, in this case the vendor is <code class="literal">zendframework</code> and the <code class="literal">skeleton-application</code> is the package.</li><li class="listitem" style="list-style-type: disc"><code class="literal">description</code>: This short description tells us what the package does.</li><li class="listitem" style="list-style-type: disc"><code class="literal">license</code>: This is the license the software is licensed under, normally this is one of the numerous open source/software licenses such as the BSD, GPL and MIT licenses. However, a closed-source software license is also available under the key 'proprietary'.</li><li class="listitem" style="list-style-type: disc"><code class="literal">keywords</code>: This is an array of keywords that is used when searching for this package on the getcomposer.org website.</li><li class="listitem" style="list-style-type: disc"><code class="literal">homepage</code>: Well this is pretty clear, is it not?</li><li class="listitem" style="list-style-type: disc"><code class="literal">require:</code> Now this is getting interesting, as this will tell Composer exactly what we need to run our package. In this case it is an array with PHP, where we need Version 5.3.3 or higher and Zend Framework 2 version 2.2.0rc1 or higher. Please note however, that in production we should always avoid a dev Version or a package with a greater than symbol, as it could potentially break our application. Always (please remember!) to get the exact version required when putting the application live.</li></ul></div><p>Although it <a id="id716" class="indexterm"/>doesn't say it here, Composer will always install Zend Framework 2 to the vendor directory, as the required section in the <code class="literal">composer.json</code> says we need <code class="literal">zendframework/zendframework</code> to run our application. Composer knows that it needs to be installed to the vendor directory because the <code class="literal">zendframework/zendframework</code> package is of the type library, and that type is always being copied by Composer to the vendor directory.</p></div><div class="section" title="Upgrading packages"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec139"/>Upgrading packages</h2></div></div></div><p>Sometimes <a id="id717" class="indexterm"/>we just want to update our libraries, for example, when we know that a bug has been solved in Zend Framework 2's library, and we really want to have it. Fortunately, Composer comes with a great self-update and update command that we have for our disposal.</p><p>To update our libraries automatically through Composer, we should execute the following commands in the terminal (this cannot be done properly through the web browser):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar self-update</strong></span>
</pre></div><p>First we want to make sure that we are using the latest Composer, as using an outdated Composer might give unnecessary errors.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar update</strong></span>
</pre></div><p>This will update all our packages that we have put in the <code class="literal">require</code> section of the <code class="literal">composer.json</code> to update to the latest (compatible) version. We should be wary, however, that when we want a new package installed, but without the updation rest of the packages, we should use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php composer.phar update vendor-name/package-name</strong></span>
</pre></div><p>Here <code class="literal">vendor-name</code> and <code class="literal">package-name</code> are the names of the packages we want to install.</p><p>Composer works because all the packages are registered on their website <a class="ulink" href="http://getcomposer.org">getcomposer.org</a>. In the website they keep all the packages together, and whenever we try to update or install, the <code class="literal">composer.phar</code> will connect to the website and retrieve the newest packages.</p><p>When we <a id="id718" class="indexterm"/>create our own modules or libraries, we can also submit that to the composer website. Submitting to composer's website will create a better community and a better understanding of the dependencies needed when we begin developing certain applications.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec140"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The composer's main website <a class="ulink" href="http://getcomposer.org">http://getcomposer.org</a></li></ul></div></div></div>
<div class="section" title="Basic Zend Framework 2 structures"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec57"/>Basic Zend Framework 2 structures</h1></div></div></div><p>When we <a id="id719" class="indexterm"/>consider the Zend Framework 2 structure, we must be aware that Zend Framework 2 doesn't actually care how our directory <a id="id720" class="indexterm"/>structure looks like, as long as we tell Zend Framework 2 in our configuration where all the paths can be found.</p><p>In the skeleton application we see that our configuration can be found in the <code class="literal">config/application.config.php</code> file. But that file solely exists there because in the <code class="literal">public/index.php</code> it is being loaded. If we, for example, want to change the location of that configuration file to somewhere else, we (in this case) only need to change it in the <code class="literal">public/index.php</code> file. The same goes for the module and vendor directory, as these can be anywhere we like, as long as we tell the <code class="literal">application.config.php</code> file where exactly that location is.</p><p>If we want to change the public directory, we can safely change it to any name we want, as long as we tell our web server where the new <code class="literal">DocumentRoot</code> is. Obviously making a good structure is of course, the key to a successful application, and therefore the skeleton application was created. That doesn't mean that different structure requirements have to make us stop using Zend Framework 2, as the framework can be fully configured to such requirements.</p><p>However, we can assume that because we are using the skeleton made available by Zend, it displays a very optimal structure for us to develop in.</p><p>When we list the initial folder of our skeleton application, we note some of the following objects of importance:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">config</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">module</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">public</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">vendor</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">init_autoloader.php</code></li></ul></div><p>As we can see there are many objects in our folder, but these have no significant importance to our basic application.</p><div class="section" title="Folder – config"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec141"/>Folder – config</h2></div></div></div><p>The <a id="id721" class="indexterm"/>
<code class="literal">config</code> folder<a id="id722" class="indexterm"/> consists of the following objects by default:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">autoload/</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">global.php</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">local.php.dist</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">application.config.php</code></li></ul></div><p>Probably the most important file in this folder would be the <code class="literal">application.config.php</code> as it contains all of our main configuration options. If we open this file we can see that it has a couple of options set to make our application work.</p><p>The file contains, for example, the <code class="literal">modules</code> key, which tells the framework which modules we need to load in for our application. It also contains the <code class="literal">module_listener_options - module_paths</code>, which tells our framework where to find our modules and libraries, which modules and vendor are by default.</p><p>The <code class="literal">config</code> folder also contains an <code class="literal">autoload</code> folder, which in itself contains two files which are the global configuration override and the local configuration override files. Both files are empty by default.</p></div><div class="section" title="Folder – module"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec142"/>Folder – module</h2></div></div></div><p>The default <a id="id723" class="indexterm"/>
<code class="literal">module</code> folder<a id="id724" class="indexterm"/> consists of the following important objects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Application/config/</code><span class="strong"><strong>module.config.php</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/language/src/Application/Controller/</code><span class="strong"><strong>IndexController.php</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/src/Application/Controller/</code><span class="strong"><strong>IndexController.php</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/view/Application/index/</code><span class="strong"><strong>index.phtml</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/view/Application/error/</code><span class="strong"><strong>404.phtml</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/view/Application/error/</code><span class="strong"><strong>index.phtml</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/view/Application/layout/</code><span class="strong"><strong>layout.phtml</strong></span></li><li class="listitem" style="list-style-type: disc"><code class="literal">Application/</code><span class="strong"><strong>Module.php</strong></span></li></ul></div><p>The application module gives away the basic structure that we would like to see when creating a new module. The most important file that we see here is the <code class="literal">Module.php</code>, which tells the framework how our module is built up, where it can find our controllers, and many more.</p><p>Depending on how our application is built up, we would also want to have a configuration file for each module as we would like to keep the application as dynamic as possible. In the skeleton application we can see that our <code class="literal">Module.php</code> contains a method called <code class="literal">Module::getConfig()</code>; all it does is a simple include to the <code class="literal">config/module.config.php</code> file. Although we theoretically could just define the configuration in the <code class="literal">Module.php</code>,it is nicer if we separate the actual configuration file from our code, as that <a id="id725" class="indexterm"/>also brings a lot more maintainability with itself if we don't need to change the code for a simple change in configuration.</p><p>We can also see a <code class="literal">language</code> folder in this folder, which contains all the i18n (short for internationalization as it contains 18 characters between I and N) files needed for translating our application. Although probably used by a lot of developers, not all of our application will require translation, so we might not need this folder at all in our project.</p><p>But if we do require <code class="literal">i18n</code> and <code class="literal">l10n</code> (localization) then it would be beneficial to do this module wise instead of application wise, again for maintainability as we don't want the application (which is the whole application) to define <code class="literal">i18n/l10n</code> for all the modules, as theoretically not all of the modules have to be there. That is why working module oriented makes the code a lot more dynamic, but also maintainable as we can safely assume that if an error occurs in one of our modules, the problem also lies in that module.</p><p>The next folder <code class="literal">src</code> might very well be one of the most interesting folders in our module, as it contains—as we might have guessed—the source of our module. The folder <code class="literal">src</code> only contains another folder called <code class="literal">Application</code>, which is the defined namespace of the classes inside.</p><p>Make sure that you name your subdirectories in <code class="literal">src</code> to the namespace they are using. Otherwise it might not only lead to conflicts, but also confusion and inconsistencies. For example, if your module is called <code class="literal">Winter</code>, then our directory should be called <code class="literal">src/Winter</code>, to make sure that all our <code class="literal">Winter</code> namespaces are in that directory. That way we can safely assume that all our code for that namespace has been neatly put in that directory and its sub directories.</p><p>The subfolder in <code class="literal">Application</code> is in our skeleton application <code class="literal">Controller</code>, which contains only the <code class="literal">IndexController.php</code>. The <code class="literal">IndexController.php</code> is an extension of the <code class="literal">Zend\Mvc\Controller\AbstractActionController</code>, which is generally used for our day-to-day controllers; however, there is also the <code class="literal">AbstractRestfulController</code> in the same namespace, which we can use if we want to create a restful service.</p><p>Next up is<a id="id726" class="indexterm"/> the <code class="literal">view</code> folder, which contains all our view scripts. View scripts are basically template files we use to do the actual displaying to the user requesting the page. As we can see in the default <code class="literal">module.config.php</code> of our <code class="literal">Application</code> module, we have the view scripts configured to point to the <code class="literal">view</code> directory, which tells the framework that when it needs to find any view scripts, it should look in that folder.</p><div class="mediaobject"><img src="graphics/4841OS_app_01.jpg" alt="Folder – module"/></div><p>As we can see the <code class="literal">view</code> folder is built up with the same structure as in the configuration file. The <code class="literal">Application</code> folder refers to the namespace which is using this view script that is, <code class="literal">Application</code>, then we see that there is also a layout defined, which is used as a global layout for our module—and the rest of the project if none is defined elsewhere—and an <code class="literal">error</code> folder, that is only used whenever an error occurs in the application. If we want to read up more about how the layouts work in Zend Framework 2, you should take a look at <a class="link" href="ch04.html" title="Chapter 4. Using View">Chapter 4</a>, <span class="emphasis"><em>Using View</em></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip14"/>Tip</h3><p>The <code class="literal">layout</code> folder and the <code class="literal">error</code> folder are usually considered to be the main template files for the project. This does not mean, however, that we can only have one layout defined; all we need to do is just define another layout configuration in our module file, which makes a specific module different to the others.</p></div></div><p>That concludes the buildup of our <code class="literal">module</code> folder, and when creating other modules—when using the skeleton application—it requires us to use the same folder structure.</p><div class="section" title="Folder – public"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec249"/>Folder – public</h3></div></div></div><p>The<a id="id727" class="indexterm"/> <code class="literal">public</code> folder<a id="id728" class="indexterm"/> contains all of the files that the public may see. We need to make sure our application is secure, so we will only put images, style sheets, and JavaScript files in here. The only file related to the framework here, will be the <code class="literal">index.php</code> file, as that is the file that initializes our application, and is used only when an HTTP request is made. Although we can put PHP files here, we would strongly recommend against it, as it can potentially make your project open for vulnerabilities.</p></div><div class="section" title="Folder – vendor"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec250"/>Folder – vendor</h3></div></div></div><p>The <a id="id729" class="indexterm"/>
<code class="literal">vendor</code> folder<a id="id730" class="indexterm"/> contains—as the name suggests—libraries that are made by a third party. In our default project this will only contain the Zend Framework 2 libraries, which are needed to run the project (located in the <code class="literal">zendframework/library</code> folder). Whenever we are going to use third party libraries like <code class="literal">Smarty</code> or <code class="literal">Doctrine</code>, these will be placed here.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip15"/>Tip</h3><p>If we have a homemade library that is (or can be) non application specific we would recommend putting it in here as well, especially if the library is maintained somewhere else. Once we begin scattering our libraries around in other folders, it is almost impossible to maintain consistency and maintainability.</p></div></div></div><div class="section" title="File – init_autoloader.php"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec251"/>File – init_autoloader.php</h3></div></div></div><p>The <code class="literal">init_autoloader.php</code> file<a id="id731" class="indexterm"/> makes sure our project can find the classes and namespaces we are trying to use. It <a id="id732" class="indexterm"/>is called by the<a id="id733" class="indexterm"/> <code class="literal">public/index.php</code> file.</p><p>For the Zend Framework 2 to start up and configure itself, a couple of actions happen. If we use the skeleton application, the following flow of information can be assumed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/public/index.php</code>: This is the first file that is going to be ran as that is the only public script file related to the application. When run, the script is including the <code class="literal">init_autoloader.php</code> in the root folder to the script and after that it initializes the Zend Framework 2.</li><li class="listitem" style="list-style-type: disc"><code class="literal">/init_autoloader.php</code>: This file<a id="id734" class="indexterm"/> does exactly what it says it does, it initializes the autoloader. One of the best features of Zend Framework 2 is the extensity of the autoloader. All this file does is make sure the autoloader has most<a id="id735" class="indexterm"/> of the namespaces and classes that we use known (but not loaded up yet) before we go on and initialize the application, that way the autoloader can simply load up the class whenever it is requested. Although the skeleton application has a very lazy autoloader, which we shouldn't use in this form, in a production environment it can be a very powerful tool to create the best performance for your application.</li></ul></div></div><div class="section" title="What's next?"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec252"/>What's next?</h3></div></div></div><p>After the <code class="literal">public/index.php</code> has loaded up the locations of known classes and namespaces, it is ready to start up the Zend Framework 2 MVC application.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Get the <code class="literal">config/application.config.php</code> file. It actually doesn't do anything with this file at the moment.</li><li class="listitem">Run the <code class="literal">Zend\Mvc\Application::init($configurationArray)</code>, where <code class="literal">$configurationArray</code> is the variable that contains the read configuration from step 1.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Initialization of the <code class="literal">ServiceManager</code>, which handles all the services in the application.<p>Invoke <code class="literal">Zend\EventManager\SharedEventManager</code>.</p><p>Factory <code class="literal">Zend\ModuleManager\ModuleManager</code>.</p></li><li class="listitem" style="list-style-type: disc">Request the <code class="literal">ModuleManager</code> from the <code class="literal">ServiceManager</code> and run its <code class="literal">loadModules()</code> method.</li><li class="listitem" style="list-style-type: disc">This will then resolve all the modules and load in the module-specific configurations.</li><li class="listitem" style="list-style-type: disc">Request the <code class="literal">Zend\Mvc\Application</code> from the <code class="literal">ServiceManager</code>.</li><li class="listitem" style="list-style-type: disc">It will run the <code class="literal">bootstrap()</code> method.</li></ul></div></li><li class="listitem">The <code class="literal">public/index.php</code> will now execute the <code class="literal">run()</code> method on the fully initialized <code class="literal">Zend\Mvc\Application</code>, which will make the sure the routing, which will trigger the bootstrap, route, dispatch, render and finish events, making sure the application has done what was requested of it.</li><li class="listitem">After the <code class="literal">Zend\Mvc\Application</code> has completed its <code class="literal">run()</code> method, it will execute the <code class="literal">send()</code> method, which will send the output made by the <code class="literal">run()</code> method back to the client.</li></ol></div><p>Here is a flow chart diagram<a id="id736" class="indexterm"/> to show how the process goes a bit more graphically:</p><div class="mediaobject"><img src="graphics/4841OS_app_02.jpg" alt="What's next?"/></div></div></div></div>
<div class="section" title="About storage adapters and patterns"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec58"/>About storage adapters and patterns</h1></div></div></div><p>The different <a id="id737" class="indexterm"/>storage adapters <a id="id738" class="indexterm"/>and patterns are a great way of implementing different functionality throughout our cache adapters, and storing them on different platforms, for example, the file system or just in memory. This recipe will tell us all about the default tools available in Zend Framework 2.</p><div class="section" title="Storage adapter's implementations"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec143"/>Storage adapter's implementations</h2></div></div></div><p>Storage adapters<a id="id739" class="indexterm"/> in ZF2 are adapters used to do the actual caching of our data, meaning they also control how the data is stored. The storage adapters always implement the <code class="literal">Zend\Cache\Storage\StorageInterface</code>, which contains the basic functionality that the storage adapter needs to comply with. Most of the storage adapters also extend from the <code class="literal">Zend\Cache\Storage\Adapter\AbstractAdapter</code>, but no guarantee can be given for that. Aside from the <code class="literal">StorageInterface</code>, storage adapters often implement additional interfaces representing enhanced functionality. These implementations obviously play a crucial role of the functionality of the adapter, so we think it is best to give a short list of implementations that the adapter can use that are defined by the framework.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code>: This<a id="id740" class="indexterm"/> interface provides a method to check the available space for the caching.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Capabilities</code>: This<a id="id741" class="indexterm"/> interface provides methods to check the capabilities of the Storage adapter, such as the minimum and maximum ttl (time-to-live) of the cache, or the supported data types (boolean, string, object, and so on).</li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code>: This<a id="id742" class="indexterm"/> interface has a method defined that can clear cache by the given namespace.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code>: This <a id="id743" class="indexterm"/>interface defines a method that can clear cache by the given prefix.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearExpiredInterface</code>: This<a id="id744" class="indexterm"/> interface provides a method to clear expired cache items.</li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code>: This<a id="id745" class="indexterm"/> interface is able to flush the whole cache.</li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code>: This<a id="id746" class="indexterm"/> interface provides functionality to iterate over the cache items. Super handy to <code class="literal">foreach</code> over them!</li><li class="listitem" style="list-style-type: disc"><code class="literal">OptimizableInterface</code>: This<a id="id747" class="indexterm"/> interface gives the ability to optimize the caching.</li><li class="listitem" style="list-style-type: disc"><code class="literal">TaggableInterface</code>: This<a id="id748" class="indexterm"/> interface provides methods to get and set tags for a specific cache item, and the ability to remove all the cache items through a certain tag.</li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code>: This<a id="id749" class="indexterm"/> interface has a method that returns the total space of the cache.</li></ul></div></div><div class="section" title="Storage adapters"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec144"/>Storage adapters</h2></div></div></div><p>Now that we know the interfaces an adapter may implement, it is time to give a comprehensive list of the storage adapters available in the <code class="literal">Zend\Cache\Storage\Adapter</code> namespace.</p><div class="section" title="Apc caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec253"/>Apc caching</h3></div></div></div><p>Apc or <a id="id750" class="indexterm"/>Alternative PHP Cache is a well known framework that heavily optimizes the PHP output and stores the compiled PHP code in the shared-memory. This way some of the opcode (operation code) doesn't have to be recompiled again as it is ready for immediate use. The Apc adapter<a id="id751" class="indexterm"/> also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following <a id="id752" class="indexterm"/>interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip16"/>Tip</h3><p>This adapter can only work if the APC extension in PHP has been enabled, please make sure that it is before trying.</p></div></div></div><div class="section" title="Dba caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec254"/>Dba caching</h3></div></div></div><p>You want <a id="id753" class="indexterm"/>to store the cache in a pre-relation dbm database, then this is your chance! This adapter can store it all neatly away in a nice database. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the <a id="id754" class="indexterm"/>following interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">OptimizableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>This adapter needs the dba extension enabled in PHP before it can work, please make sure it is enabled.</p></div></div></div><div class="section" title="File system caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec255"/>File system caching</h3></div></div></div><p>File system <a id="id755" class="indexterm"/>caching is a personal favorite, to store the cache on<a id="id756" class="indexterm"/> the good old file system, a fast and usually reliable place to place it. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following<a id="id757" class="indexterm"/> interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearExpiredInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">OptimizableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TaggableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip18"/>Tip</h3><p>It sounds as something really obvious, but make sure we have write permissions on the directory where we want to store the cache.</p></div></div></div><div class="section" title="Memcached caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec256"/>Memcached caching</h3></div></div></div><p>The <a id="id758" class="indexterm"/>Memcached adapter<a id="id759" class="indexterm"/> stores the cache in the memory, which is a great way to store static file that don't change often and can be considered semi-static. This adapter also extends from the <code class="literal">AbstractAdapter</code>. Please note that Memcached is not restricted by PHP's memory limit settings, as Memcached stores the memory outside of the PHP process in its own Memcached process.</p><p>This adapter implements the<a id="id760" class="indexterm"/> following interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip19"/>Tip</h3><p>We need the <code class="literal">memcached</code> PHP extension to cache through this adapter. Please make sure it is enabled on your system.</p></div></div></div><div class="section" title="Memory caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec257"/>Memory caching</h3></div></div></div><p>The <a id="id761" class="indexterm"/>Memory adapter<a id="id762" class="indexterm"/> stores all the cache in the PHP process, in comparison to the Memcached adapter, as that stores all the cache in an external Memcached process. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following <a id="id763" class="indexterm"/>interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearExpiredInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TaggableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div></div><div class="section" title="Redis caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec258"/>Redis caching</h3></div></div></div><p>The<a id="id764" class="indexterm"/> Redis<a id="id765" class="indexterm"/> is a key-value data store that stores the data in-memory, which is extremely well done and certainly is a caching method worth using. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following <a id="id766" class="indexterm"/>interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip20"/>Tip</h3><p>If we want to use this caching adapter, we need to make sure the <code class="literal">redis</code> extension is loaded, otherwise this storage adapter cannot be used. Please make sure the extension is installed and enabled.</p></div></div></div><div class="section" title="Session caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec259"/>Session caching</h3></div></div></div><p>The <a id="id767" class="indexterm"/>Session storage adapter<a id="id768" class="indexterm"/> uses the session to store our cache in. Although handy for one user at a time, this method isn't really effective for users who view the same pages as it builds up the cache every time a user initiates a session. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the<a id="id769" class="indexterm"/> following interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code></li></ul></div></div><div class="section" title="WinCache caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec260"/>WinCache caching</h3></div></div></div><p>The<a id="id770" class="indexterm"/> WinCache<a id="id771" class="indexterm"/> is an excellent adapter that is useful when running PHP on a Microsoft Windows server. WinCache supports opcode caching, file system caching, and relative path caching. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the <a id="id772" class="indexterm"/>following interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip21"/>Tip</h3><p>For this method the <code class="literal">wincache</code> extension needs to be loaded, and if that wasn't all you also need to be on Microsoft Windows to, to use this.</p></div></div></div><div class="section" title="XCache caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec261"/>XCache caching</h3></div></div></div><p>The <a id="id773" class="indexterm"/>XCache<a id="id774" class="indexterm"/> is an adapter that utilizes the XCache module in PHP, which is another cache adapter like APC and is a fast opcode cacher, which is very useful. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following <a id="id775" class="indexterm"/>interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByPrefixInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">IterableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip22"/>Tip</h3><p>This adapter requires the XCache extension to be loaded and enabled in PHP. Please make sure this is the case before trying to use the adapter.</p></div></div></div><div class="section" title="ZendServerDisk caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec262"/>ZendServerDisk caching</h3></div></div></div><p>The <a id="id776" class="indexterm"/>ZendServerDisk<a id="id777" class="indexterm"/> adapter is a great file system cache adapter provided by the Zend Server application. If we have the Zend Server installed, this adapter is a great way of storing the cache on the file system as it integrates ridiculously good with the Zend Server. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following <a id="id778" class="indexterm"/>interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AvailableSpaceCapableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip23"/>Tip</h3><p>To make this adapter work you'll need to have the Zend Server installed, otherwise it will just throw an exception.</p></div></div></div><div class="section" title="ZendServerShm caching"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec263"/>ZendServerShm caching</h3></div></div></div><p>The <a id="id779" class="indexterm"/>ZendServerShm<a id="id780" class="indexterm"/> adapter also requires us to have the Zend Server installed, but if we have and we want to cache items in the shared memory (shm) then this is an amazing way of doing it, as this adapter integrates very nicely with the Zend Server. This adapter also extends from the <code class="literal">AbstractAdapter</code>.</p><p>This adapter implements the following <a id="id781" class="indexterm"/>interfaces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ClearByNamespaceInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">FlushableInterface</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TotalSpaceCapableInterface</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip24"/>Tip</h3><p>To make this adapter work you'll need to have the Zend Server installed to make this adapter work, otherwise it will just throw an exception.</p></div></div></div></div><div class="section" title="Cache patterns"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec145"/>Cache patterns</h2></div></div></div><p>When<a id="id782" class="indexterm"/> we start caching, we will quickly find ourselves in <a id="id783" class="indexterm"/>situations that are counteractive to the performance while we just wanted everything to go faster. That is why there are classes in ZF2 that are called Cache patterns, which are there for us to use when we want to overcome some common problems.</p><p>Like the adapters, patterns are also always implementations of an interface; in this case the <code class="literal">PatternInterface</code>. And because we usually also want some basic functionality, most of the patterns also extend from the <code class="literal">AbstractPattern</code> class.</p><p>Options for the patterns are defined through the <code class="literal">PatternOptions</code> class, which is explained a bit further on as well.</p><div class="section" title="The CallbackCache pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec264"/>The CallbackCache pattern</h3></div></div></div><p>What do <a id="id784" class="indexterm"/>we <a id="id785" class="indexterm"/>want, a callback or the cache? Sometimes we just don't know for sure, so we'll let the pattern to figure it out itself! The <code class="literal">CallbackCache</code> pattern first makes sure if there is a result for our callback already defined in the cache, and if so, returns that. If the result is not in the cache yet, it will call our callback function, put our output in the result and then return that. Either way, the second time that callback is being handled, we will get our cache back. So if this is a long running method, it will be considerably faster when we don't have to execute the code again.</p><p>This pattern also takes the arguments for that callback in consideration, which means you don't really have to worry much about the callback providing you with the wrong results!</p><p>This Pattern uses the <code class="literal">AbstractPattern</code> class.</p></div><div class="section" title="The CaptureCache pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec265"/>The CaptureCache pattern</h3></div></div></div><p>The<a id="id786" class="indexterm"/> <code class="literal">CaptureCache</code> pattern captures the output we are sending <a id="id787" class="indexterm"/>to the browser by initiating an <code class="literal">ob_start()</code> and <code class="literal">ob_implicit_flush()</code>. We can then do a check if the cache exists every time we sent the output out, so that instead of generating it we just display the output.</p><p>This pattern uses the <code class="literal">AbstractPattern</code> class.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip25"/>Tip</h3><p>This pattern does not automatically output cache once defined, the developer needs to get the cache themselves first before using the start method. If we want to output cache when it exists before generating new content we should use the <code class="literal">OutputCache</code> pattern.</p></div></div></div><div class="section" title="The ClassCache pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec266"/>The ClassCache pattern</h3></div></div></div><p>The <a id="id788" class="indexterm"/>
<code class="literal">ClassCache</code> pattern<a id="id789" class="indexterm"/> caches the output of a class method call and returns that instead of the actual call. But of course, this only happens when the cache is actually available, otherwise it will just do the method call and cache the results. The class name (not the object) needs to be set in the <code class="literal">PatternOptions::setClass</code> to make it work.</p><p>This pattern uses the <code class="literal">AbstractPattern</code> class.</p></div><div class="section" title="The ObjectCache pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec267"/>The ObjectCache pattern</h3></div></div></div><p>The <a id="id790" class="indexterm"/>
<code class="literal">ObjectCache</code> pattern <a id="id791" class="indexterm"/>caches the object and can be used to call methods upon its retrieval, very handy if we have objects that need to persistent for a very long time. The object needs to be set in the <code class="literal">PatternOptions::setObject</code> to make it work.</p><p>This pattern uses the <code class="literal">AbstractPattern</code> class.</p></div><div class="section" title="The OutputCache pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec268"/>The OutputCache pattern</h3></div></div></div><p>The<a id="id792" class="indexterm"/> <code class="literal">OutputCache</code> pattern<a id="id793" class="indexterm"/> outputs the cache if it is defined. If not, then OutputCache caches the output and sets the cache upon script end (or call to the end method, whichever comes first).</p><p>This pattern uses the <code class="literal">AbstractPattern</code> class.</p></div><div class="section" title="The PatternOptions pattern"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec269"/>The PatternOptions pattern</h3></div></div></div><p>The <a id="id794" class="indexterm"/>
<code class="literal">PatternOptions</code>
<a id="id795" class="indexterm"/> pattern can be used to set options or get options from and to the patterns (<code class="literal">setOptions</code> and <code class="literal">getOptions</code> respectively). For most patterns some form of options need to be set before the pattern can be used. Think here about the <code class="literal">setStorage</code> method for example, because the pattern needs to know the storage adapter before it can actually store things.</p></div></div><div class="section" title="Explaining the difference"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec146"/>Explaining the difference</h2></div></div></div><p>Storage adapters <a id="id796" class="indexterm"/>store and retrieve the cache data. We can set options to determine the length of the validity or perhaps check if the cache is full or not, but we can't determine how it is stored, as that is part of the adapter's job description.</p><p>Patterns however don't store anything themselves. They determine if they need to store anything by checking if the cache already exists, or if the cache is what we expect it to be (for example, when we use a different method call or different arguments to that call). They do tell the adapters what they want to retrieve and store, so that the adapter then can find out how to retrieve it from the actual storage again.</p><p>In a developer's <a id="id797" class="indexterm"/>eye we would rather be using patterns before we would want to use the adapters, as we'd not want to interfere with the adapters too much if there are already patterns doing most of the work for us.</p></div></div></body></html>