<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;A Task-management Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. A Task-management Application</h1></div></div></div><p>One of the best ways to get started with the Yii framework is by making useful applications. The first application that will be covered in this book is a simple task management application. In this chapter, we will cover the planning of the development of this project, developing the application, and creating useful components that we will reuse in later chapters.</p><div class="section" title="Describing the project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Describing the project</h1></div></div></div><p>One of the <a id="id0" class="indexterm"/>most important steps in starting a new project is<a id="id1" class="indexterm"/> planning it. By planning the project before we begin programming, we can easily identify most (if not all) models that our application will use, key features that we'll need to implement, as well as any areas that may cause us problems while developing our applications. Breaking down the project beforehand also helps us estimate how long it will take to develop each part of <a id="id2" class="indexterm"/>our applications as well as the <a id="id3" class="indexterm"/>application as a whole. While<a id="id4" class="indexterm"/> requirements and expectations for our application will most likely change during its development, identifying the core components of your application will help ensure that the core functionality of our application works as we intend.</p><p>For our task management application, there are two main components: tasks and projects. Let's break each of these components down.</p><div class="section" title="Tasks"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Tasks</h2></div></div></div><p>The first <a id="id5" class="indexterm"/>component of our application is tasks. A task is an item that needs to be done by our user and usually consists of a brief, concise title, and a description of what needs to be done to complete that task. Sometimes, a task has a due date or time associated with it that lets us know when the task needs to be completed. Tasks<a id="id6" class="indexterm"/> also need to indicate whether<a id="id7" class="indexterm"/> they have been completed or not. Finally, a task is usually associated with a group or project that contains similar or related tasks.</p></div><div class="section" title="Projects"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Projects</h2></div></div></div><p>The<a id="id8" class="indexterm"/> second component of our <a id="id9" class="indexterm"/>application is projects. Projects group related tasks together and usually have a descriptive name associated with them. Projects may also have a due date or time associated with them, which indicates when all tasks in a project need to be completed. We also need to be able to indicate whether or not a project is completed.</p></div><div class="section" title="Users"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Users</h2></div></div></div><p>By <a id="id10" class="indexterm"/>breaking down our project, we've also<a id="id11" class="indexterm"/> identified a third component of our application: users. Users in our application will have the ability to create and manage both projects and tasks as well as view the statuses and due dates of any given task. While this component of our application may seem obvious, identifying it early on allows us to better understand the interaction that our users will have with the various components of our application.</p></div></div></div>
<div class="section" title="The database"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>The database</h1></div></div></div><p>With the<a id="id12" class="indexterm"/> core components of our application identified, we can now begin to think about what our database is going to look like. Let's start with the two database tables.</p><div class="section" title="The tasks table"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>The tasks table</h2></div></div></div><p>By looking <a id="id13" class="indexterm"/>at our requirements, we<a id="id14" class="indexterm"/> can identify several columns and data types for our <code class="literal">tasks</code> table. As a rule, each task that we create will have a unique, incrementing ID associated with it. Other columns that we can quickly identify are the task name, the task description,  the due date, and whether or not the task has been completed. We also know that each task is going to be associated with a project, which means we need to reference that project in our table.</p><p>There are also some columns we can identify that are not so obvious. The two most useful columns that aren't explicitly identified are timestamps for the creation date of the task and the date it was last updated on. By adding these two columns, we can gain useful insights <a id="id15" class="indexterm"/>into the use of our application. It's <a id="id16" class="indexterm"/>possible that in the future, our imaginary client may want to know how long an unresolved task has been open for and whether or not it needs additional attention if it has not been updated in several days.</p><p>With all the columns and data types for our table identified, our <code class="literal">tasks</code> table written with generic SQL data types will look as follows:</p><div class="informalexample"><pre class="programlisting">ID INTEGER PRIMARY KEY
name TEXT
description TEXT
completed BOOLEAN
project_id INTEGER
due_date TIMESTAMP
created TIMESTAMP
updated TIMESTAMP</pre></div></div><div class="section" title="The projects table"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>The projects table</h2></div></div></div><p>By looking <a id="id17" class="indexterm"/>at our requirements <a id="id18" class="indexterm"/>for projects, we can easily pick out the major columns for our <code class="literal">projects</code> table: a descriptive name, whether or not the project has been completed, and when the project is due. We also know from our <code class="literal">tasks</code> table that each project will need to have its own unique ID for the task to reference. When the time comes to create our models in our application, we'll clearly define the one-to-many relationship between any given project and the many tasks belonging to it. If we keep a created and updated column, our <code class="literal">projects</code> table written in generic SQL will look as follows:</p><div class="informalexample"><pre class="programlisting">ID INTEGER PRIMARY KEY
name TEXT
completed BOOLEAN
due_date TIMESTAMP
created TIMESTAMP
updated TIMESTAMP</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div><div class="section" title="Users"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Users</h2></div></div></div><p>Our <a id="id19" class="indexterm"/>application requirements also show us that we need to store users somewhere. For this application, we're going to store our users in a flat file database. In <a class="link" href="ch03.html" title="Chapter 3. Scheduled Reminders">Chapter 3</a>, <span class="emphasis"><em>Scheduled Reminders</em></span>, we will expand upon this and store users in their own database table.</p></div><div class="section" title="Choosing a database technology"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Choosing a database technology</h2></div></div></div><p>Now that we have decided what our database is going to look like, it's time to start thinking <a id="id20" class="indexterm"/>about where<a id="id21" class="indexterm"/> we're going to store this information. To help familiarize yourself with the different database adapters Yii natively supports, for this project, we will be using SQLite. Since we now know where we're going to store our data, we can identify all the correct data types for database tables.</p><div class="section" title="The tasks table"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>The tasks table</h3></div></div></div><p>Since SQLite only supports five basic data types (<code class="literal">NULL</code>, <code class="literal">INTEGER</code>, <code class="literal">REAL</code>, <code class="literal">TEXT</code>, and <code class="literal">BLOB</code>), we<a id="id22" class="indexterm"/> need to convert a few of the data types we<a id="id23" class="indexterm"/> initially identified for this table into ones that SQLite supports. Since SQLite does not support Boolean or timestamps natively, we need to find another way of representing this data using a data type that SQLite supports. We can represent a Boolean value as an integer either as 0 (false) or 1 (true). We can also represent all of our timestamp columns as integers by converting the current date to a Unix timestamp.</p><p>With our final data types figured out, our <code class="literal">tasks</code> table now will look like this:</p><div class="informalexample"><pre class="programlisting">ID INTEGER PRIMARY KEY
name TEXT
description TEXT
completed INTEGER
project_id INTEGER
due_date INTEGER
created INTEGER
updated INTEGER</pre></div></div><div class="section" title="The projects table"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>The projects table</h3></div></div></div><p>By <a id="id24" class="indexterm"/>applying the same logic to our <code class="literal">projects</code> table, we <a id="id25" class="indexterm"/>can derive the following structure for this table:</p><div class="informalexample"><pre class="programlisting">ID INTEGER PRIMARY KEY
name TEXT
completed INTEGER
due_date INTEGER
created INTEGER
updated INTEGER</pre></div></div></div><div class="section" title="The database overview"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>The database overview</h2></div></div></div><p>By <a id="id26" class="indexterm"/>spending a few minutes thinking about our application beforehand, we've successfully identified all the tables for our application, how they interact with one another, and all the column names and data types that our application will be using. We've done a lot of work on our application already without even writing a single line of code. By doing this work upfront, we have also reduced some of the work we'll need to do later on when creating our models.</p></div></div>
<div class="section" title="Initializing the project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Initializing the project</h1></div></div></div><p>With our final database structure figured out, we can now start writing code. Using the<a id="id27" class="indexterm"/> instructions in the official guide (<a class="ulink" href="http://www.yiiframework.com/doc/guide/">http://www.yiiframework.com/doc/guide/</a>), download and install the Yii framework. Once<a id="id28" class="indexterm"/> Yii is installed, navigate to your <code class="literal">webroot</code> directory, and create a new folder called <code class="literal">tasks</code>. Next, navigate inside the <code class="literal">tasks</code> folder, and create the following folder structure to serve as our application's skeleton:</p><div class="informalexample"><pre class="programlisting">tasks/
    assets/
    protected/
              commands/
              components/
              config/
              controllers/
              data/
              migrations/
              models/
              runtime/
              views/
                    layouts/
                    projects/
                    tasks/
                    site/</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Yii has a<a id="id29" class="indexterm"/> built-in tool called <code class="literal">yiic</code>, which can automatically<a id="id30" class="indexterm"/> generate a skeleton project. Refer to the quick start guide (<a class="ulink" href="http://www.yiiframework.com/doc/guide/1.1/en/quickstart.first-app">http://www.yiiframework.com/doc/guide/1.1/en/quickstart.first-app</a>) for more details.</p></div></div><p>Depending <a id="id31" class="indexterm"/>upon the web server you are using, you may also need to create a <code class="literal">.htaccess</code> file in the root directory of your <code class="literal">tasks</code> folder. Information about how to set up your application for the web server you are using can be found in the quick start guide (<a class="ulink" href="http://www.yiiframework.com/doc/guide/1.1/en/quickstart.apache-nginx-config">http://www.yiiframework.com/doc/guide/1.1/en/quickstart.apache-nginx-config</a>).</p><p>After setting up our skeleton structure, we can first create our configuration file located at <code class="literal">protected/config/main.php</code>. Our configuration file is one of the most important files of our application as it provides Yii with all the critical information necessary to load and configure our application. The configuration file informs Yii about the files to be preloaded by Yii's built-in autoloader, the modules to be loaded, the component to be registered, and any other configuration options we want to pass to our application.</p><p>For this application, we will be enabling the Gii module, which will allow us to create models based upon our database structure. We will also enable two components, <code class="literal">urlManager</code> and <code class="literal">db</code>, which will allow us to set up custom routes and access our SQLite database. Have a look at the following code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;?php
return array(
   'basePath'=&gt;dirname(__FILE__).DIRECTORY_SEPARATOR.'..',
   'name'=&gt;'Task Application',
   'import'=&gt;array(
        'application.models.*',
        'application.components.*',
    ),
    'modules'=&gt;array(
        // Include the Gii Module so that we can
//generate models and controllers for our application
        'gii'=&gt;array(
            'class'=&gt;'system.gii.GiiModule',
            'password'=&gt;false,
            'ipFilters'=&gt;false
        ),
    ),
    'components'=&gt;array(
        'urlManager'=&gt;array(
            'urlFormat'=&gt;'path',
            'showScriptName'=&gt;false,
            'rules'=&gt;array(
                '&lt;controller:\w+&gt;/&lt;id:\d+&gt;'=&gt;'&lt;controller&gt;/view',
                '&lt;controller:\w+&gt;/&lt;action:\w+&gt;/&lt;id:\d+&gt;'=&gt;'&lt;controller&gt;/&lt;action&gt;',
                '&lt;controller:\w+&gt;/&lt;action:\w+&gt;'=&gt;'&lt;controller&gt;/&lt;action&gt;',
            ),
        ),
        // Define where our SQLite database is going to be
        // stored, relative to our config file
        'db'=&gt;array(
            'connectionString' =&gt; 'sqlite:'.dirname(__FILE__).'/../data/tasks.db',
        )
    )
);</pre></div><p>Next, we <a id="id32" class="indexterm"/>can create our <code class="literal">index.php</code> file as follows, which will serve as our bootstrap endpoint for our web application:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// change the following paths if necessary
$yii='/opt/frameworks/php/yii/framework/yii.php';
$config=dirname(__FILE__).'/protected/config/main.php';

// remove the following lines when in production mode
defined('YII_DEBUG') or define('YII_DEBUG',true);
// specify how many levels of call stack should be shown in each log message
defined('YII_TRACE_LEVEL') or define('YII_TRACE_LEVEL',3);

require_once($yii);
Yii::createWebApplication($config)-&gt;run();</pre></div><p>Finally, we can create our <a id="id33" class="indexterm"/>applications <code class="literal">yiic</code> file in <code class="literal">protected/yiic.php</code> as follows, which will allow us to run console commands native to Yii from our application:</p><div class="informalexample"><pre class="programlisting">&lt;?php
// change the following paths if necessary
$config=dirname(__FILE__).'/config/main.php';
$config = require($config);
require_once('/opt/frameworks/php/yii/framework/yiic.php');</pre></div></div>
<div class="section" title="Creating the database with migrations"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Creating the database with migrations</h1></div></div></div><p>Now that our application can be bootstrapped, we can create our database. To do this, we are <a id="id34" class="indexterm"/>going to create<a id="id35" class="indexterm"/> a migration. Migrations are a feature of Yii that allow the creation and modification of your database<a id="id36" class="indexterm"/> to be a part of your application. Rather than creating schema modifications in pure SQL, we can use migrations to grow our database as a part of our application. In addition to acting as a revision system for our database schema, migrations also have the added benefit of allowing us to transmit our database with our application without having to worry about sharing data that would be stored in our database.</p><p>To create our database, open up your command-line interface of choice, navigate to your tasks directory, and run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php protected/yiic.php migrate create tasks</strong></span>
</pre></div><p>The <code class="literal">yiic</code> command will then prompt you to confirm the creation of the new migration:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Yii Migration Tool v1.0 (based on Yii v1.1.14)</strong></span>

<span class="strong"><strong>Create new migration '/var/www/tasks/protected/migrations/m131213_013354_tasks.php'? (yes|no) [no]:yes</strong></span>
<span class="strong"><strong>New migration created successfully.</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>To prevent naming conflicts with migrations, <code class="literal">yiic</code> will create the migration with the following naming structure: <code class="literal">m&lt;timestamp&gt;_&lt;name&gt;</code>. This has the added benefit of allowing us to sequentially apply or remove specific migrations based upon the order in which they were added. The exact name of your migration will be slightly different than the one listed in the preceding command.</p></div></div><p>After confirming the creation of the migration, a new file will be created in the <code class="literal">protected/migrations</code> folder of our application. Open up the file, and add the following to the <code class="literal">up</code> method:</p><div class="informalexample"><pre class="programlisting">$this-&gt;createTable('tasks', array(
   'id' =&gt; 'INTEGER PRIMARY KEY',
   'title' =&gt; 'TEXT',
   'data' =&gt; 'TEXT',
   'project_id' =&gt; 'INTEGER',
   'completed' =&gt; 'INTEGER',
   'due_date' =&gt; 'INTEGER',
   'created' =&gt; 'INTEGER',
   'updated' =&gt; 'INTEGER'
));

$this-&gt;createTable('projects', array(
   'id' =&gt; 'INTEGER PRIMARY KEY',
   'name' =&gt; 'TEXT',
   'completed' =&gt; 'INTEGER',
   'due_date' =&gt; 'INTEGER',
   'created' =&gt; 'INTEGER',
   'updated' =&gt; 'INTEGER'
));</pre></div><p>Notice<a id="id37" class="indexterm"/> that our database <a id="id38" class="indexterm"/>structure matches the schema that we identified earlier in the chapter.</p><p>Next, replace the contents of the <code class="literal">down</code> method with instructions to drop the database table if we call <code class="literal">migrate down</code> from the <code class="literal">yiic</code> command. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">$this-&gt;dropTable('projects');
$this-&gt;dropTable('tasks');</pre></div><p>Now that the migration has been created, run <code class="literal">migrate up</code> from the command line to create the database and apply our migration. Run the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ php protected/yiic.php migrate up</strong></span>
<span class="strong"><strong>Yii Migration Tool v1.0 (based on Yii v1.1.14)</strong></span>
<span class="strong"><strong>Total 1 new migration to be applied:</strong></span>
<span class="strong"><strong>    m131213_013354_tasks</strong></span>

<span class="strong"><strong>Apply the above migration? (yes|no) [no]:yes</strong></span>
<span class="strong"><strong>*** applying m131213_013354_tasks</strong></span>
<span class="strong"><strong>*** applied m131213_013354_tasks (time: 0.009s)</strong></span>
<span class="strong"><strong>Migrated up successfully.</strong></span>
</pre></div><p>Now, if you navigate to <code class="literal">protected/data/</code>, you will see a new file called <code class="literal">tasks.db</code>, the SQLite database that was created by our migrations.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>Migration <a id="id39" class="indexterm"/>commands can be run non-interactively by appending <code class="literal">--interactive=0</code> to the <code class="literal">migrate</code> command. This can be useful if you want to automate <a id="id40" class="indexterm"/>deployments of your code to remote systems or if you run your code through an automated testing service.</p></div></div></div>
<div class="section" title="Creating models with Gii"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Creating models with Gii</h1></div></div></div><p>Now that <a id="id41" class="indexterm"/>our database has been created, we can create models for<a id="id42" class="indexterm"/> our database table. To create our models, we are going to <a id="id43" class="indexterm"/>use Gii, Yii's built-in code generator.</p><p>Open up your web browser and navigate to <code class="literal">http://localhost/gii</code> (in this book, we will always use <code class="literal">localhost</code> as our working hostname for our working project. If you are using a different hostname, replace <code class="literal">localhost</code> with your own). Once loaded, you should see the <span class="strong"><strong>Yii Code Generator</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7734OS_01_01.jpg" alt="Creating models with Gii"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>If you aren't able to access Gii, verify that your web server has rewriting enabled. Information about how to properly configure your web server for Yii can be found at (<a class="ulink" href="http://www.yiiframework.com/doc/guide/1.1/en/quickstart.apache-nginx-config">http://www.yiiframework.com/doc/guide/1.1/en/quickstart.apache-nginx-config</a>).</p></div></div><p>Click on the link titled <span class="strong"><strong>Model Generator</strong></span>, and then fill in the form on the page that appears. The <a id="id44" class="indexterm"/>table name should be set to <code class="literal">tasks</code>. The model name <a id="id45" class="indexterm"/>should prepopulate. If it doesn't, set the model name to <code class="literal">Tasks</code>, and then click on preview. Once the page has reloaded, you can preview what the model will look like before clicking on the <span class="strong"><strong>Generate</strong></span> button to write your new model to your <code class="literal">protected/models/</code> directory. Once you have generated your model for <code class="literal">tasks</code>, repeat the process for <code class="literal">projects</code>.</p><div class="section" title="Enhancing the models"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Enhancing the models</h2></div></div></div><p>Now that <a id="id46" class="indexterm"/>our models have been created, there are several sections that should be modified.</p><div class="section" title="Updating the default validation rules"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Updating the default validation rules</h3></div></div></div><p>The first<a id="id47" class="indexterm"/> part of our model that needs to be modified is the validation rules. Validation rules in Yii are stored in the model's <code class="literal">rules()</code> method<a id="id48" class="indexterm"/> and are executed when the model's <code class="literal">validate()</code> method<a id="id49" class="indexterm"/> is called. Starting with our <code class="literal">tasks</code> model, we can see that Gii has already prepopulated our validation rules for us based upon our database.</p><p>There are several fields of this model that we would like to always have set, namely, <code class="literal">project_id</code>, <code class="literal">title</code>, the task itself, and whether or not it has been completed. We can make these fields required in our model by adding a new array to our rules section, as follows:</p><div class="informalexample"><pre class="programlisting">array('project_id, title, data, completed', 'required')</pre></div><p>By making these fields required in our model, we can make client- and server-side validation easier when we start making forms. Our final method for this model will look as follows:</p><div class="informalexample"><pre class="programlisting">public function rules()
{
        return array(
            array('project_id, completed, due_date, created, updated', 'numerical', 'integerOnly'=&gt;true),
		   array('project_id, title, data, completed', 'required'),
            array('title, data', 'safe'),
            array('id, title, data, project_id, completed, due_date, created, updated', 'safe', 'on'=&gt;'search'),
        );
}</pre></div><p>Our project's models should also be changed so that the project name and its completed status are<a id="id50" class="indexterm"/> required. We can accomplish this by adding the following to our validation rules array:</p><div class="informalexample"><pre class="programlisting">array('name, completed', 'required')</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Additional <a id="id51" class="indexterm"/>validation rules can be found in the Yii wiki at <a class="ulink" href="http://www.yiiframework.com/wiki/56/">http://www.yiiframework.com/wiki/56/</a>
</p></div></div></div><div class="section" title="Defined relations"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Defined relations</h3></div></div></div><p>Another <a id="id52" class="indexterm"/>component of our model that we should change is the <code class="literal">relations()</code> method. By declaring model relations in Yii, we can take advantage <a id="id53" class="indexterm"/>of the ability of ActiveRecords to automatically join several related models together and retrieve data from them without having to explicitly call that model for its data.</p><p>For example, once our model relations are set up, we will be able to retrieve the project name from the Tasks model, as follows:</p><div class="informalexample"><pre class="programlisting">Tasks::model()-&gt;findByPk($id)-&gt;project-&gt;name;</pre></div><p>Before we can declare our relations though, we need to determine what the relations actually are. Since SQLite does not support foreign key relations, Gii was unable to automatically determine the relations for us.</p><p>In Yii, there are four types of relations: <code class="literal">BELONGS_TO</code>, <code class="literal">HAS_MANY</code>, <code class="literal">HAS_ONE</code>, and <code class="literal">MANY_MANY</code>. Determining the relation type can be done by looking at the foreign key for a table and asking which relational type fits best based upon the data that the table will store. For this application, this question can be answered as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Tasks belong to a single project</li><li class="listitem" style="list-style-type: disc">A project has one or many tasks</li></ul></div><p>Now that we have determined our relationship types between our two tables, we can write the relations. Starting with the <code class="literal">tasks</code> table, replace the <code class="literal">relations()</code> method with the following:</p><div class="informalexample"><pre class="programlisting">public function relations()
{
return array(
        'tasks' =&gt; array(self::HAS_MANY, 'Task', 'project_id')
    );
}</pre></div><p>The <a id="id54" class="indexterm"/>syntax for the relations array is as follows:</p><div class="informalexample"><pre class="programlisting">'var_name'=&gt;array('relationship_type', 'foreign_model', 'foreign_key', [... other options ..])</pre></div><p>For our projects model, our <code class="literal">relations()</code> method looks like this:</p><div class="informalexample"><pre class="programlisting">public function relations()
{
    return array(
        'tasks' =&gt; array(self::HAS_MANY, 'Tasks', 'project_id')
    );
}</pre></div></div><div class="section" title="Removing tasks when a project is deleted"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Removing tasks when a project is deleted</h3></div></div></div><p>In our <a id="id55" class="indexterm"/>model's current state, whenever a project is deleted, all the tasks associated with it become orphaned. One way of dealing with this edge case is to simply delete any tasks associated with the project. Rather than writing code to handle this in the controller, we can have the model take care of it for us by referencing the project's model's <code class="literal">beforeDelete()</code> method as follows:</p><div class="informalexample"><pre class="programlisting">public function beforeDelete()
{
    Tasks::model()-&gt;deleteAllByAttributes(array('project_id' =&gt; $this-&gt;id));
    return parent::beforeDelete();
}</pre></div></div><div class="section" title="Retrieving the project metadata"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec06"/>Retrieving the project metadata</h3></div></div></div><p>There is <a id="id56" class="indexterm"/>also metadata about a project that we cannot obtain directly from the <code class="literal">projects</code> database table. This data includes the number of tasks a project has, as well as the number of completed tasks a project has. We can obtain this from our model by creating two new methods in the project's model, as follows:</p><div class="informalexample"><pre class="programlisting">public function getNumberOfTasks()
{
    return Tasks::model()-&gt;countByAttributes(array('project_id' =&gt; $this-&gt;id));
}

public function getNumberOfCompletedTasks()
{
     return Tasks::model()-&gt;countByAttributes(array('project_id' =&gt; $this-&gt;id, 'completed' =&gt; 1));
}</pre></div><p>Additionally, we <a id="id57" class="indexterm"/>can determine the progress of a project by getting a percentage of completed tasks versus the total number of tasks, as follows:</p><div class="informalexample"><pre class="programlisting">public function getPercentComplete()
{
    $numberOfTasks = $this-&gt;getNumberOfTasks();
    $numberOfCompletedTasks = $this-&gt;getNumberOfCompletedTasks();

    if ($numberOfTasks == 0)
        return 100;
    return ($numberOfCompletedTasks / $numberOfTasks) * 100;
}</pre></div></div><div class="section" title="Automatically setting the created and updated time"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Automatically setting the created and updated time</h3></div></div></div><p>The last <a id="id58" class="indexterm"/>change needed to be made to the models is to enable <a id="id59" class="indexterm"/>them to automatically set the created and updated timestamp in the database every time the model is saved. By moving this logic into the models, we can avoid having to manage it either in the forms that submit the data or in the controllers that will process this data. This change can be made by adding the following to both models:</p><div class="informalexample"><pre class="programlisting">public function beforeSave()
{
    if ($this-&gt;isNewRecord)
         $this-&gt;created = time();

    $this-&gt;updated = time();

    return parent::beforeSave();
}</pre></div><p>In<a id="id60" class="indexterm"/> the <code class="literal">beforeSave()</code> method, the updated property is always set every time the model is saved, and the created property is only set if ActiveRecord considers this to be a new record. This is accomplished by checking the <code class="literal">isNewRecord</code> property of the model. Additionally, both properties are set to <code class="literal">time()</code>, the PHP function used to get the current Unix timestamp.</p><p>The last piece of code that is important in this method is <code class="literal">return parent::beforeSave();</code>. When Yii's <code class="literal">save()</code> method is called, it checks that <code class="literal">beforeSave()</code> returns true before saving the data to the database. While we could have this method<a id="id61" class="indexterm"/> return true, it's easier to have it return whatever <a id="id62" class="indexterm"/>the parent model (in this case <code class="literal">CActiveRecord</code>) returns. It also ensures that any changes made to the parent model will get carried to the model.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>Since the <code class="literal">beforeSave()</code> method is identical for both models, we could also create a new model that only extended <code class="literal">CActiveRecord</code> and only implemented this method. The tasks and projects model will then extend that model rather than <code class="literal">CActiveRecord</code> and will inherit this functionality. Moving shared functionality to a shared location reduces the number of places where code needs to be written and, consequently, the number of places a bug can show up in.</p></div></div></div></div></div>
<div class="section" title="Creating the presentation layer"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Creating the presentation layer</h1></div></div></div><p>Up until this point, all the code that has been written is backend code that the end user won't be<a id="id63" class="indexterm"/> able to see. In this <a id="id64" class="indexterm"/>section, we will be creating the presentation layer of our application. The presentation layer of our application is composed of three components: controllers, layouts, and views. For this next section, we'll be creating all the three components.</p><p>As a developer, we have several options to create the presentation layer. One way we can create the presentation layer is using Gii. Gii has several built-in tools that can assist you in creating new controllers, forms for our views, and even full create, read, update, and delete (CRUD) skeletons for our application. Alternatively, we can write everything by hand.</p><div class="section" title="Managing projects"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Managing projects</h2></div></div></div><p>The first <a id="id65" class="indexterm"/>part of the presentation layer we are going to work on is the projects section. To begin with, create a new file in <code class="literal">protected/controllers/</code> called <code class="literal">ProjectControllerProjectController.php</code> that has the following class signature:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class ProjectControllerProjectController extends CController {}</pre></div><p>For our controllers, we will be extending Yii's base class called <code class="literal">CController</code>. In future chapters, we will create our own controllers and extend the controllers from them.</p><p>Before <a id="id66" class="indexterm"/>we can start displaying content from our new action, we'll need to create a layout for our content to be rendered in. To specify our layout, create a public property called <code class="literal">$layout</code>, and set the value to <code class="literal">'main'</code>:</p><div class="informalexample"><pre class="programlisting">public $layout = 'main';</pre></div><p>Next, let's create our first action to make sure everything is working:</p><div class="informalexample"><pre class="programlisting">public function actionIndex()
{
    echo "Hello!";
}</pre></div><p>Now, we should be able to visit <code class="literal">http://localhost/projects/index</code> from our web browser and see the text <code class="literal">Hello</code> printed on the screen. Before we continue defining our actions, let's create a layout that will help our application look a little better.</p><div class="section" title="Creating the layout"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Creating the layout</h3></div></div></div><p>The<a id="id67" class="indexterm"/> layout that we specified references the file located in <code class="literal">protected/views/layouts/main.php</code>. Create this file and open it for editing. Then, add the following basic HTML5 markup:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
   &lt;head&gt;
   	&lt;/head&gt;
   &lt;body&gt;
   &lt;/body&gt;
&lt;/html&gt;</pre></div><p>Then add a title within the <code class="literal">&lt;head&gt;</code> tag that will display the application name we defined in <code class="literal">protected/config/main.php</code>:</p><div class="informalexample"><pre class="programlisting">&lt;title&gt;&lt;?php echo Yii::app()-&gt;name; ?&gt;&lt;/title&gt;</pre></div><p>Next, let's add a few meta tags, CSS, and scripts. To reduce the number of files we need to download, we'll be including styles and scripts from a publicly available <span class="strong"><strong>Content Distribution Network</strong></span> (<span class="strong"><strong>CDN</strong></span>). Rather than writing markup for these elements, we're going to <a id="id68" class="indexterm"/>use <code class="literal">CClientScript</code>, a class made to manage JavaScript, CSS, and meta tags for views.</p><p>For this application, we'll be using a frontend framework called <span class="strong"><strong>Twitter Bootstrap</strong></span>. This framework <a id="id69" class="indexterm"/>will <a id="id70" class="indexterm"/>style many of the common HTML tags that our application will use, providing it with a cleaner overall look.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>When you're ready to go live with your application, you should consider moving the static assets you are using to a CDN, referencing popular libraries such as Twitter Bootstrap and jQuery from a publicly available CDN. CDNs can help to reduce hosting costs by reducing the amount of bandwidth your server needs to use to send files. Using a CDN can also speed up your site since they usually have servers geographically closer to your users than your main server.</p></div></div><p>First, we're going to call <code class="literal">CClientScript</code>, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php $cs = Yii::app()-&gt;clientScript; ?&gt;</pre></div><p>Secondly, we're going to set the <code class="literal">Content-Type</code> to <code class="literal">text/html</code> with a <code class="literal">UTF-8</code> character set, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php $cs-&gt;registerMetaTag('text/html; charset=UTF-8', 'Content-Type'); ?&gt;</pre></div><p>Next, we're going to register the CSS from Twitter Bootstrap 3 from a popular CDN, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php $cs-&gt;registerCssFile( '//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css' ); ?&gt;</pre></div><p>Then we'll register the JavaScript library for Twitter Bootstrap:</p><div class="informalexample"><pre class="programlisting">&lt;?php $cs-&gt;registerScriptFile( '//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js' ); ?&gt;</pre></div><p>Finally, we're going to register jQuery 2.0 and have Yii placed at the end of the <code class="literal">&lt;body&gt;</code> tag, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php $cs-&gt;registerScriptFile( '//code.jquery.com/jquery.js', CClientScript::POS_END ); ?&gt;</pre></div><p>
<code class="literal">CClientScript</code> also supports method chaining, so you could also change the preceding code to the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php Yii::app()-&gt;clientScript
        	-&gt;registerMetaTag('text/html; charset=UTF-8', 'Content-Type')
        	-&gt;registerCssFile( '//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css'
        	-&gt;registerScriptFile( '//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js' )
        	-&gt;registerScriptFile( 'https://code.jquery.com/jquery.js' , CClientScript::POS_END); ?&gt;</pre></div><p>For the<a id="id71" class="indexterm"/> last part of our layout, let's add a basic header within our <code class="literal">&lt;body&gt;</code> tag that will help with navigation, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;div class="row"&gt;
    &lt;div class="container"&gt;
        &lt;nav class="navbar navbar-default navbar-fixed-top" role="navigation"&gt;
            &lt;div class="navbar-header"&gt;
                &lt;a class="navbar-brand" href="/"&gt;&lt;?php echo CHtml::encode(Yii::app()-&gt;name); ?&gt;&lt;/a&gt;
             &lt;/div&gt;
        &lt;/nav&gt;
    &lt;/div&gt;
   &lt;/div&gt;</pre></div><p>After the closing <code class="literal">&lt;/div&gt;</code> tag, add the following:</p><div class="informalexample"><pre class="programlisting">&lt;div class="row" style="margin-top: 100px;"&gt;
    &lt;div class="container"&gt;
        &lt;?php echo $content; ?&gt;
    &lt;/div&gt;
&lt;/div&gt;</pre></div><p>The <code class="literal">$content</code> variable that we've added to our layout is a special variable that contains all the rendered HTML markup from our view files and is defined by the <code class="literal">CController</code> class in the <a id="id72" class="indexterm"/>
<code class="literal">render()</code> method. Yii will automatically populate this variable for us whenever we call the <code class="literal">render()</code> method from within our controllers.</p></div><div class="section" title="Creating the project index action"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec09"/>Creating the project index action</h3></div></div></div><p>With <a id="id73" class="indexterm"/>our layout defined, we can get back to creating actions. Let's start by modifying our <code class="literal">actionIndex()</code> method so that it renders a view.</p><p>First, create a variable to store a searchable copy of our model. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">$model = new Projects('search');</pre></div><p>Next, render a view called <code class="literal">index</code>, which references <code class="literal">protected/views/projects/index.php</code>, and pass the model we created to this view, as follows:</p><div class="informalexample"><pre class="programlisting">$this-&gt;render('index', array('model' =&gt; $model));</pre></div><p>Now, create the view file in <code class="literal">protected/views/projects/index.php</code> and open it for editing. Begin by adding a button in the view as follows, which will reference the <code class="literal">save</code> action<a id="id74" class="indexterm"/> that we will create later on:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo CHtml::link('Create New Project', $this-&gt;createUrl('/projects/save'), array('class' =&gt; 'btn btn-primary pull-right')); ?&gt;
&lt;div class="clearfix"&gt;&lt;/div&gt;</pre></div><p>Then add a descriptive title so that we know what page we are on. Have a look at the following line of code:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;Projects&lt;/h1&gt;</pre></div><p>Finally, create a new widget that uses <code class="literal">CListView</code>, a built-in Yii widget designed for displaying data from <code class="literal">CActiveDataProvider</code>. In Yii, widgets are frontend components that help us to quickly generate commonly used code, typically for presentation purposes. This widget will automatically generate pagination for us as necessary and will allow each of our items to look the same. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">&lt;?php $this-&gt;widget('zii.widgets.CListView', array(
    'dataProvider'=&gt;$model-&gt;search(),
    'itemView'=&gt;'_project',
)); ?&gt;</pre></div><p>The new widget that we created consists of two parts. The first is the <code class="literal">dataProvider</code>, which provides data to the widget. This data comes from our project's model's <code class="literal">search()</code> method, a piece of code automatically generated by Gii.</p><p>The second part of the widget is the <code class="literal">itemView</code>, which references the specific view file that our items will be rendered out of. In this case, the view references a file in the same directory of <code class="literal">protected/views/projects</code> called <code class="literal">_project.php</code>. Create this file and then add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;div&gt;
    &lt;div class="pull-left"&gt;
        &lt;p&gt;&lt;strong&gt;&lt;?php echo CHtml::link(CHtml::encode($data-&gt;name), $this-&gt;createUrl('/projects/tasks', array('id' =&gt; $data-&gt;id))); ?&gt;&lt;/strong&gt;&lt;/p&gt;
        &lt;p&gt;Due on &lt;?php echo date('m/d/Y', $data-&gt;due_date); ?&gt;&lt;/p&gt;
&lt;?php if ($data-&gt;completed): ?&gt;
            Completed
        &lt;?php else: ?&gt;
            &lt;?php if ($data-&gt;numberOfTasks == 0): ?&gt;
                &lt;p&gt;No Tasks&lt;/p&gt;
            &lt;?php else: ?&gt;
                &lt;p&gt;&lt;?php echo $data-&gt;getPercentComplete(); ?&gt;% Completed&lt;/p&gt;
            &lt;?php endif; ?&gt;
        &lt;?php endif; ?&gt;
    &lt;/div&gt;
    &lt;div class="pull-right"&gt;
        &lt;?php echo CHtml::link(NULL, $this-&gt;createUrl('/projects/save', array('id' =&gt; $data-&gt;id)), array('title' =&gt; 'edit', 'class' =&gt; 'glyphicon glyphicon-pencil')); ?&gt;
        &lt;?php echo CHtml::link(NULL, $this-&gt;createUrl('/projects/complete', array('id' =&gt; $data-&gt;id)), array('title' =&gt; $data-&gt;completed == 1 ? 'uncomplete' : 'complete', 'class' =&gt; 'glyphicon glyphicon-check')); ?&gt;
        &lt;?php echo CHtml::link(NULL, $this-&gt;createUrl('/projects/delete', array('id' =&gt; $data-&gt;id)), array('title' =&gt; 'delete', 'class' =&gt; 'glyphicon glyphicon-remove')); ?&gt;
    &lt;/div&gt;
    &lt;div class="clearfix"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;hr/&gt;</pre></div><p>If we<a id="id75" class="indexterm"/> refresh our browser page now, our view will show us that no results were found. Before we can see data, we need to create an action and view to create and update it. Before we start creating new records, let's create two other actions that we outlined in our item's view: complete and delete.</p></div><div class="section" title="Changing a project's completion state"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Changing a project's completion state</h3></div></div></div><p>First, let's<a id="id76" class="indexterm"/> create an action to mark a project as completed or uncompleted. This action will only be responsible for changing the completed field of the projects table to 0 or 1, depending on its current state. For simplicity, we can just XOR the field by 1 and save the model. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">public function actionComplete($id)
{
    $model = $this-&gt;loadModel($id);
    $model-&gt;completed ^= 1;
    $model-&gt;save();
    $this-&gt;redirect($this-&gt;createUrl('/projects'));
}</pre></div><p>Additionally, we'll create another private method called <code class="literal">loadModel()</code>, which will load our <a id="id77" class="indexterm"/>appropriate model for us and throw an error if it cannot be found. For<a id="id78" class="indexterm"/> this method, we'll use <code class="literal">CHttpException</code>, which will create an HTTP exception with the error message we provide if a model with the specified ID cannot be found. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">private function loadModel($id)
{
    $model = Projects::model()-&gt;findByPk($id);
    if ($model == NULL)
        throw new CHttpException('404', 'No model with that ID could be found.');
    return $model;
}</pre></div></div><div class="section" title="Deleting projects"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Deleting projects</h3></div></div></div><p>Next, we'll <a id="id79" class="indexterm"/>create a method to delete the project. This method will use the <code class="literal">loadModel()</code> method we defined earlier. Additionally, if we encounter an error deleting the model, we'll throw an HTTP exception so that the user knows something went wrong. Here's how we go about it:</p><div class="informalexample"><pre class="programlisting">public function actionDelete($id)
{
    $model = $this-&gt;loadModel($id);

    if ($model-&gt;delete())
        $this-&gt;redirect($this-&gt;createUrl('/projects'));

    throw new CHttpException('500', 'There was an error deleting the model.');
}</pre></div></div><div class="section" title="Creating and updating projects"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Creating and updating projects</h3></div></div></div><p>With the<a id="id80" class="indexterm"/> two other methods defined, we can now work on creating and <a id="id81" class="indexterm"/>updating a project. Rather than creating two actions to handle both these tasks, we're going to create one action that knows how to handle both by checking the ID that we'll pass as a <code class="literal">GET</code> parameter. We can do that by defining a new action that looks as follows:</p><div class="informalexample"><pre class="programlisting">public function actionSave($id=NULL) {</pre></div><p>We can then either create a new project or update a project based upon whether or not we were provided with an ID by the user. By taking advantage of <code class="literal">loadModel()</code>, we also take care of any errors that would occur if an ID was provided but a project with that ID didn't exist. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">if ($id == NULL)
    $model = new Projects;
else
    $model = $this-&gt;loadModel($id);</pre></div><p>Next, we can detect whether the user submitted data by checking the <code class="literal">$_POST</code> variable for an array called <code class="literal">Projects</code>. If that array is defined, we'll assign it to our <code class="literal">$model-&gt;attributes</code> object. Before saving the model, however, we'll want to convert whatever the user entered into a Unix timestamp. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">if (isset($_POST['Projects']))
{
    $model-&gt;attributes = $_POST['Projects'];
    $model-&gt;due_date = strtotime($_POST['Projects']['due_date']);
    $model-&gt;save();
}</pre></div><p>Finally, we'll render the view and pass the model down to it, as follows:</p><div class="informalexample"><pre class="programlisting">$this-&gt;render('save', array('model' =&gt; $model));</pre></div><p>Create a new file in <code class="literal">protected/views/projects/</code> called <code class="literal">save.php</code> and open it to edit. Begin by adding a header that will let us know whether we are editing a project or creating a new one, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;h1&gt;&lt;?php echo $model-&gt;isNewRecord ? 'Create New' : 'Update'; ?&gt; Project&lt;/h1&gt;</pre></div><p>Next, we'll create a new widget with <code class="literal">CActiveForm</code>, which will take care of the hard tasks of creating and inserting form fields into our view file (such as what the names and IDs of form fields should be):</p><div class="informalexample"><pre class="programlisting">&lt;?php $form=$this-&gt;beginWidget('CActiveForm', array(
    'id'=&gt;'project-form',
    'htmlOptions' =&gt; array(
        'class' =&gt; 'form-horizontal',
        'role' =&gt; 'form'
    )
)); ?&gt;
&lt;?php $this-&gt;endWidget(); ?&gt;</pre></div><p>Between<a id="id82" class="indexterm"/> the <code class="literal">beginWidget</code> and <code class="literal">endWidget</code> call, add an error summary <a id="id83" class="indexterm"/>if the user encounters an error:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo $form-&gt;errorSummary($model); ?&gt;</pre></div><p>Then, after the error summary, add the form fields and their associated styles, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;div class="form-group"&gt;
    &lt;?php echo $form-&gt;labelEx($model,'name', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
    &lt;div class="col-sm-10"&gt;
        &lt;?php echo $form-&gt;textField($model,'name', array('class' =&gt; 'form-control')); ?&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class="form-group"&gt;
    &lt;?php echo $form-&gt;labelEx($model,'completed', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
    &lt;div class="col-sm-10"&gt;
        &lt;?php echo $form-&gt;dropDownList($model,'completed', array('0' =&gt; 'No','1' =&gt; 'Yes'), array('class' =&gt; 'form-control')); ?&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class="form-group"&gt;
    &lt;?php echo $form-&gt;labelEx($model,'due_date', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
    &lt;div class="col-sm-10"&gt;
        &lt;div class="input-append date"&gt;
MM/DD/YYYY
            &lt;?php $this-&gt;widget('zii.widgets.jui.CJuiDatePicker', array(
                    'model' =&gt; $model,
                    'attribute' =&gt; 'due_date',
                    'htmlOptions' =&gt; array(
                        'size' =&gt; '10',
                        'maxlength' =&gt; '10',
                        'class' =&gt; 'form-control',
                        'value' =&gt; $model-&gt;due_date == "" ? "" : date("m/d/Y", $model-&gt;due_date)
                    ),
                )); ?&gt;		
&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class="row buttons"&gt;
    &lt;?php echo CHtml::submitButton($model-&gt;isNewRecord ? 'Create' : 'Save', array('class' =&gt; 'btn btn-primary pull-right')); ?&gt;
&lt;/div&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>Did <a id="id84" class="indexterm"/>you notice how we're taking advantage of the Yii widget<a id="id85" class="indexterm"/> called <code class="literal">CJuiDatePicker</code>? This widget will provide us with a clean interface for selecting dates from a calendar view, rather than requiring our end user to type in the date manually and in the specified format we've requested.</p></div></div><p>Now we can create, update, view, and delete projects. Additionally, we've created an easy action to mark them as completed. Before we're done with this controller, we need to add an action that allows us to view tasks in our project.</p></div><div class="section" title="Viewing tasks"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Viewing tasks</h3></div></div></div><p>Our <code class="literal">tasks</code> action<a id="id86" class="indexterm"/> for this controller will function in the <a id="id87" class="indexterm"/>same manner as our <code class="literal">index</code> action but will instead use a view called <code class="literal">tasks</code>:</p><div class="informalexample"><pre class="programlisting">public function actionTasks($id=NULL)
{
    if ($id == NULL)
        throw new CHttpException(400, 'Missing ID');

    $project = $this-&gt;loadModel($id);
    if ($project === NULL)
        throw new CHttpException(400, 'No project with that ID exists');

    $model = new Tasks('search');
    $model-&gt;attributes = array('project_id' =&gt; $id);

    $this-&gt;render('tasks', array('model' =&gt; $model, 'project' =&gt; $project));
}</pre></div><p>The <code class="literal">tasks.php</code> view in <code class="literal">protected/views/projects/tasks.php</code> will look as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php echo CHtml::link('Create New Task', $this-&gt;createUrl('/tasks/save?Tasks[project_id]=' . $project-&gt;id), array('class' =&gt; 'btn btn-primary pull-right')); ?&gt;
&lt;div class="clearfix"&gt;&lt;/div&gt;
&lt;h1&gt;View Tasks for Project: &lt;?php echo $project-&gt;name; ?&gt;&lt;/h1&gt;
&lt;?php $this-&gt;widget('zii.widgets.CListView', array(
    'dataProvider'=&gt;$model-&gt;search(),
    'itemView'=&gt;'_tasks',
));
?&gt;</pre></div><p>The <code class="literal">_tasks.php</code> item view in <code class="literal">protected/views/projects/tasks.php</code> will look as follows:</p><div class="informalexample"><pre class="programlisting">&lt;div&gt;
    &lt;div class="pull-left"&gt;
        &lt;p&gt;&lt;strong&gt;&lt;?php echo CHtml::link(CHtml::encode($data-&gt;title), $this-&gt;createUrl('/tasks/save', array('id' =&gt; $data-&gt;id))); ?&gt;&lt;/strong&gt;&lt;/p&gt;
        &lt;p&gt;Due on &lt;?php echo date('m/d/Y', $data-&gt;due_date); ?&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class="pull-right"&gt;
        &lt;?php echo CHtml::link(NULL, $this-&gt;createUrl('/tasks/save', array('id' =&gt; $data-&gt;id)), array('class' =&gt; 'glyphicon glyphicon-pencil')); ?&gt;
        &lt;?php echo CHtml::link(NULL, $this-&gt;createUrl('/tasks/complete', array('id' =&gt; $data-&gt;id)), array('title' =&gt; $data-&gt;completed == 1 ? 'uncomplete' : 'complete', 'class' =&gt; 'glyphicon glyphicon-check')); ?&gt;
        &lt;?php echo CHtml::link(NULL, $this-&gt;createUrl('/tasks/delete', array('id' =&gt; $data-&gt;id)), array('class' =&gt; 'glyphicon glyphicon-remove')); ?&gt;
    &lt;/div&gt;
    &lt;div class="clearfix"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;hr/&gt;</pre></div></div></div><div class="section" title="Managing tasks"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Managing tasks</h2></div></div></div><p>Now that <a id="id88" class="indexterm"/>we can manage projects, let's work on managing tasks. Our <code class="literal">TasksController</code> is going to be nearly identical to our project's controller with only a few differences. Start by creating a new file in <code class="literal">protected/controllers</code> called <code class="literal">TasksController.php</code> that has the following signature:</p><div class="informalexample"><pre class="programlisting">&lt;?php class TasksController extends CController {}</pre></div><p>By only making a small change to our <code class="literal">loadModel()</code> method, we can reuse the delete and complete action from our projects controller, as follows:</p><div class="informalexample"><pre class="programlisting">private function loadModel($id)
{
    $model = Tasks::model()-&gt;findByPk($id);
    if ($model == NULL)
        throw new CHttpException('404', 'No model with that ID could be found.');
    return $model;
}</pre></div><p>Our <code class="literal">save</code> action is almost identical to our project's <code class="literal">save</code> action. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">public function actionSave($id=NULL)
{
    if ($id == NULL)
        $model = new Tasks;
    else
        $model = $this-&gt;loadModel($id);

    if (isset($_GET['Tasks']))
        $model-&gt;attributes = $_GET['Tasks'];

    if (isset($_POST['Tasks']))
    {
        $model-&gt;attributes = $_POST['Tasks'];
        $model-&gt;due_date = strtotime($_POST['Tasks']['due_date']);
        $model-&gt;save();
    }

    $this-&gt;render('save', array('model' =&gt; $model));
}</pre></div><p>The <a id="id89" class="indexterm"/>view file for this action is almost the same as well. If you haven't already, create a file called <code class="literal">save.php</code> in <code class="literal">protected/views/tasks/</code>, and then add the following lines of code to finish the view:</p><div class="informalexample"><pre class="programlisting">&lt;ol class="breadcrumb"&gt;
  &lt;li&gt;&lt;?php echo CHtml::link('Project', $this-&gt;createUrl('/projects')); ?&gt;&lt;/li&gt;
  &lt;li class="active"&gt;&lt;?php echo $model-&gt;isNewRecord ? 'Create New' : 'Update'; ?&gt; Task&lt;/li&gt;
&lt;/ol&gt;
&lt;hr /&gt;
&lt;h1&gt;&lt;?php echo $model-&gt;isNewRecord ? 'Create New' : 'Update'; ?&gt; Task&lt;/h1&gt;
&lt;?php $form=$this-&gt;beginWidget('CActiveForm', array(
    'id'=&gt;'project-form',
    'htmlOptions' =&gt; array(
        'class' =&gt; 'form-horizontal',
        'role' =&gt; 'form'
    )
)); ?&gt;
    &lt;?php echo $form-&gt;errorSummary($model); ?&gt;

    &lt;div class="form-group"&gt;
        &lt;?php echo $form-&gt;labelEx($model,'title', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
        &lt;div class="col-sm-10"&gt;
            &lt;?php echo $form-&gt;textField($model,'title', array('class' =&gt; 'form-control')); ?&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        &lt;?php echo $form-&gt;labelEx($model,'data', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
        &lt;div class="col-sm-10"&gt;
            &lt;?php echo $form-&gt;textArea($model,'data', array('class' =&gt; 'form-control')); ?&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        &lt;?php echo $form-&gt;labelEx($model,'project_id', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
        &lt;div class="col-sm-10"&gt;
            &lt;?php echo $form-&gt;dropDownList($model,'project_id', CHtml::listData(Projects::model()-&gt;findAll(), 'id', 'name'), array('empty'=&gt;'Select Project', 'class' =&gt; 'form-control')); ?&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        &lt;?php echo $form-&gt;labelEx($model,'completed', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
        &lt;div class="col-sm-10"&gt;
            &lt;?php echo $form-&gt;dropDownList($model,'completed', array('0' =&gt; 'No','1' =&gt; 'Yes'), array('class' =&gt; 'form-control')); ?&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
        &lt;?php echo $form-&gt;labelEx($model,'due_date', array('class' =&gt; 'col-sm-2 control-label')); ?&gt;
        &lt;div class="col-sm-10"&gt;
            &lt;div class="input-append date"&gt;
                &lt;?php $this-&gt;widget('zii.widgets.jui.CJuiDatePicker', array(
                    'model' =&gt; $model,
                    'attribute' =&gt; 'due_date',
                    'htmlOptions' =&gt; array(
                       'size' =&gt; '10',
                       'maxlength' =&gt; '10',
                        'class' =&gt; 'form-control',
                       'value' =&gt; $model-&gt;due_date == "" ? "" : date("m/d/Y", $model-&gt;due_date)
                    ),
                )); ?&gt;			&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;div class="row buttons"&gt;
        &lt;?php echo CHtml::submitButton($model-&gt;isNewRecord ? 'Create' : 'Save', array('class' =&gt; 'btn btn-primary pull-right')); ?&gt;
    &lt;/div&gt;

&lt;?php $this-&gt;endWidget(); ?&gt;</pre></div></div><div class="section" title="Preventing unauthorized access to our application"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Preventing unauthorized access to our application</h2></div></div></div><p>Our tasks application can now do everything we defined in our requirements. However, it is <a id="id90" class="indexterm"/>open to the world. Anyone who wants to edit our tasks could simply visit our website and change anything without our knowledge. Before finishing up, let's create a simple authentication system to protect our data.</p><div class="section" title="Requiring authentication with filters and access rules"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec14"/>Requiring authentication with filters and access rules</h3></div></div></div><p>The<a id="id91" class="indexterm"/> first part in protecting <a id="id92" class="indexterm"/>our application is making sure that only authorized people can visit our application. We can do this<a id="id93" class="indexterm"/> by adding a <a id="id94" class="indexterm"/>filter to our controller called <code class="literal">accessControl</code> and defining access rules to access <a id="id95" class="indexterm"/>our content.</p><p>A filter <a id="id96" class="indexterm"/>is a piece of code that gets executed before (and/or after) a controller action runs, which means that the user will be required to<a id="id97" class="indexterm"/> be authenticated before accessing our content. To add the <code class="literal">accessControl</code> filter, add the following to both <code class="literal">TasksController</code> and <code class="literal">ProjectsController</code>:</p><div class="informalexample"><pre class="programlisting">public function filters()
{
    return array(
        'accessControl',
    );
}</pre></div><p>Next, create a new method called <code class="literal">accessRules()</code>, which will define what users can access our application. For our application, we want to deny access to anyone who isn't authenticated. Have a look at the following code snippet:</p><div class="informalexample"><pre class="programlisting">public function accessRules()
{
    return array(
        array('allow',
            'users'=&gt;array('@'),
        ),
        array('deny',  // deny all users
            'users'=&gt;array('*'),
         ),
    );
}</pre></div><p>In the <a id="id98" class="indexterm"/>preceding <a id="id99" class="indexterm"/>array, <code class="literal">@</code> is <a id="id100" class="indexterm"/>a shorthand<a id="id101" class="indexterm"/> reference to an authenticated user. Now if we try to visit our web page, we'll be redirected to <code class="literal">/site/login</code>, the default <code class="literal">login</code> action in Yii.</p></div><div class="section" title="Creating a controller for the authentication"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec15"/>Creating a controller for the authentication</h3></div></div></div><p>Create<a id="id102" class="indexterm"/> a file called <code class="literal">SiteController.php</code> in <code class="literal">protected/controllers</code>, and then create <code class="literal">login</code> and <code class="literal">logout</code> actions as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class SiteController extends CController
{
    public $layout = 'signin';
    
    public function actionLogin()
    {
        $model = new LoginForm;

        if (isset($_POST['LoginForm']))
        {
            $model-&gt;attributes = $_POST['LoginForm'];
            if ($model-&gt;login())
                $this-&gt;redirect($this-&gt;createUrl('/projects'));
        }
        $this-&gt;render('login', array('model' =&gt; $model));
    }

    public function actionLogout()
    {
        Yii::app()-&gt;user-&gt;logout();
        $this-&gt;redirect($this-&gt;createUrl('/site/login'));
    }
}</pre></div></div><div class="section" title="Creating a login layout"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec16"/>Creating a login layout</h3></div></div></div><p>For<a id="id103" class="indexterm"/> this controller, we're going to create a new layout called <code class="literal">login.php</code> in <code class="literal">protected/views/layouts</code>. Copy the markup from <code class="literal">protected/views/layouts/main.php</code> to our new layout, and replace the contents of the <code class="literal">&lt;body&gt;</code> tag with the following:</p><div class="informalexample"><pre class="programlisting">&lt;div class="row"&gt;
    &lt;div class="container"&gt;
        &lt;?php echo $content; ?&gt;
    &lt;/div&gt;
&lt;/div&gt;</pre></div><p>To make our login page look more like a login page, add the following CSS to the layout either as an inline style or as a separate file in <code class="literal">/css/signup.css</code>:</p><div class="informalexample"><pre class="programlisting">body {
  padding-top: 40px;
  padding-bottom: 40px;
  background-color: #eee;
}

.form-signin {
  max-width: 330px;
  padding: 15px;
  margin: 0 auto;
}
.form-signin .form-signin-heading,
.form-signin .checkbox {
  margin-bottom: 10px;
}
.form-signin .checkbox {
  font-weight: normal;
}
.form-signin .form-control {
  position: relative;
  font-size: 16px;
  height: auto;
  padding: 10px;
  -webkit-box-sizing: border-box;
     -moz-box-sizing: border-box;
          box-sizing: border-box;
}
.form-signin .form-control:focus {
  z-index: 2;
}
.form-signin input[type="text"] {
  margin-bottom: -1px;
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}
.form-signin input[type="password"] {
  margin-bottom: 10px;
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}</pre></div></div><div class="section" title="Creating a login view"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec17"/>Creating a login view</h3></div></div></div><p>Create a <a id="id104" class="indexterm"/>new form in <code class="literal">protected/views/site/login.php</code> that will hold our login model, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php $form=$this-&gt;beginWidget('CActiveForm', array(
    'id'=&gt;'login-form',
    'enableClientValidation'=&gt;true,
    'htmlOptions' =&gt; array(
            'class' =&gt; 'form-signin',
            'role' =&gt; 'form'
    ),
    'clientOptions'=&gt;array(
        'validateOnSubmit'=&gt;true,
    ),
)); ?&gt;

    &lt;?php if (!Yii::app()-&gt;user-&gt;isGuest): ?&gt;
        &lt;h2 class="form-signin-heading"&gt;You are already signed in! Please &lt;?php echo CHtml::link('logout', $this-&gt;createUrl('/site/logout')); ?&gt; first.&lt;/h2&gt;
    &lt;?php else: ?&gt;
        &lt;h2 class="form-signin-heading"&gt;Please sign in&lt;/h2&gt;
        &lt;?php echo $form-&gt;errorSummary($model); ?&gt;
        &lt;?php echo $form-&gt;textField($model,'username', array('class' =&gt; 'form-control', 'placeholder' =&gt; 'Username')); ?&gt;
        &lt;?php echo $form-&gt;passwordField($model,'password', array('class' =&gt; 'form-control', 'placeholder' =&gt; 'Password')); ?&gt;
        &lt;?php echo CHtml::tag('button', array('class' =&gt; 'btn btn-lg btn-primary btn-block'), 'Submit'); ?&gt;
    &lt;?php endif; ?&gt;
&lt;?php $this-&gt;endWidget(); ?&gt;</pre></div></div><div class="section" title="Identifying our users with the UserIdentity CUserIdentity class"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec18"/>Identifying our users with the UserIdentity CUserIdentity class</h3></div></div></div><p>Before <a id="id105" class="indexterm"/>we create our login model, we need to create a way to identify our users. Fortunately, Yii has a built-in class to handle this called <code class="literal">CUserIdentity</code>. By easily extending <code class="literal">CUserIdentity</code>, we can create a key-value login pair that will ensure that only authenticated users can log in to our application.</p><p>Create a new file called <code class="literal">UserIdentity.php</code> in <code class="literal">/components</code>, and add the following:</p><div class="informalexample"><pre class="programlisting">&lt;?php
class UserIdentity extends CUserIdentity
{
    public function authenticate()
    {
        $users=array(
            'demo'=&gt;'demo',
            'admin'=&gt;'admin',
        );
        if(!isset($users[$this-&gt;username]))
            $this-&gt;errorCode=self::ERROR_USERNAME_INVALID;
        elseif($users[$this-&gt;username]!==$this-&gt;password)
            $this-&gt;errorCode=self::ERROR_PASSWORD_INVALID;
        else
            $this-&gt;errorCode=self::ERROR_NONE;
        return !$this-&gt;errorCode;
    }
}</pre></div><p>The <code class="literal">authenticate()</code> method of <code class="literal">UserIdentity</code> is what we'll use in our login model to ensure<a id="id106" class="indexterm"/> that <a id="id107" class="indexterm"/>we have valid credentials. In this class, we are simply checking whether the <code class="literal">username</code> that will be sent to this class by our login model matches the key associated with it. If a user's password does not match the key in our <code class="literal">$users</code> array, or if the user is not defined in our <code class="literal">$users</code> array, we return an error code.</p></div><div class="section" title="Creating the login model"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec19"/>Creating the login model</h3></div></div></div><p>The<a id="id108" class="indexterm"/> last component we need to authenticate our users is to create a generic model to authenticate the user against. Begin by creating a new file called <code class="literal">LoginForm.php</code> in <code class="literal">protected/models</code>. This class will extend <code class="literal">CFormModel</code>, a generic model in Yii for forms, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?php class LoginForm extends CFormModel {</pre></div><p>Since <code class="literal">CFormModel</code> doesn't connect to a database, we defined attributes as public properties, as follows:</p><div class="informalexample"><pre class="programlisting">public $username;
public $password;
private $_identity;</pre></div><p>Our model also needs validation rules to verify that we have a valid user. In addition to making sure <code class="literal">username</code> and <code class="literal">password</code> are provided, we're going to provide an additional validation rule called <code class="literal">authenticate</code>, which will validate that we have a valid username and password. Have a look at the following lines of code:</p><div class="informalexample"><pre class="programlisting">public function rules()
{
    return array(
        array('username, password', 'required'),
        array('password', 'authenticate'),
    );
}</pre></div><p>Because our <code class="literal">authenticate()</code> method is a custom validator, its method signature has two parameters, <code class="literal">$attribute</code> and <code class="literal">$params</code>, which have information about the attribute and parameters that may have been passed from the validator. This method will determine whether our credentials are valid. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">public function authenticate($attribute,$params)
{
    if(!$this-&gt;hasErrors())
    {
        $this-&gt;_identity=new UserIdentity($this-&gt;username,$this-&gt;password);
        if(!$this-&gt;_identity-&gt;authenticate())
            $this-&gt;addError('password','Incorrect username or password.');
    }
}</pre></div><p>Finally, we'll create the <code class="literal">login()</code> method that our <code class="literal">SiteController</code> calls. In addition to validating our credentials, it will do the heavy lifting of creating a session for the user. Have <a id="id109" class="indexterm"/>a look at the following code:</p><div class="informalexample"><pre class="programlisting">public function login()
{
    if (!$this-&gt;validate())
        return false;

    if ($this-&gt;_identity===null)
    {
        $this-&gt;_identity=new UserIdentity($this-&gt;username,$this-&gt;password);
        $this-&gt;_identity-&gt;authenticate();
    }

    if ($this-&gt;_identity-&gt;errorCode===UserIdentity::ERROR_NONE)
    {
        $duration = 3600*24*30;
        Yii::app()-&gt;user-&gt;login($this-&gt;_identity,$duration);
        return true;
    }
    else
        return false;
}</pre></div><p>Now you can visit our site and log in with the credentials provided in our <code class="literal">UserIdentity.php</code> file.</p></div></div></div>
<div class="section" title="Finishing touches"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Finishing touches</h1></div></div></div><p>Before <a id="id110" class="indexterm"/>completing our project, there are a few things we need to take care of in our <code class="literal">protected/config/main.php</code> file to enhance the security of our application and to make our application easier to use.</p><p>It would be nice to also add some pictures of the final application.</p><div class="section" title="Disabling Gii"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Disabling Gii</h2></div></div></div><p>At the<a id="id111" class="indexterm"/> beginning of our project, we enabled the <a id="id112" class="indexterm"/>Gii module to assist us in creating models for our application. Since Gii has the ability to write new files to our project, we should remove the following section from our <code class="literal">config</code> file:</p><div class="informalexample"><pre class="programlisting">'gii'=&gt;array(
    'class'=&gt;'system.gii.GiiModule',
    'password'=&gt;false,
    'ipFilters' =&gt; false
),</pre></div></div><div class="section" title="Defining a default route"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Defining a default route</h2></div></div></div><p>Presently, if we try to visit the root URL of our application, we are presented with an error. To<a id="id113" class="indexterm"/> avoid this, we can add a <a id="id114" class="indexterm"/>route in to the routes array of our URL Manager component. With this addition, whenever we visit the root URL of our application, we will be presented with the <code class="literal">index</code> action of the project's controller. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">'components'=&gt;array(
    [...]
    'urlManager'=&gt;array(
        [...]
        'rules'=&gt;array(
            [...]
            '/' =&gt; 'projects/index'
        ),
    )
)</pre></div></div><div class="section" title="Adding extra routes"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>Adding extra routes</h2></div></div></div><p>Finally, add <a id="id115" class="indexterm"/>two more routes to our URL Manager routes array. These routes will help us more easily access the <code class="literal">login</code> and <code class="literal">logout</code> actions for our site. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">'login' =&gt; 'site/login',
'logout' =&gt; 'site/logout'</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Summary</h1></div></div></div><p>In this chapter, we covered quite a lot of information. We created an automated way of creating and distributing our database, models to represent the tables in the database, and a few controllers to manage and interact with our data. We also created a simple key-value authentication system to protect our data. Many of the methods we used in this chapter, and the code we wrote, can be reused and expanded upon in later chapters. Before continuing, be sure to take a look at all the classes we referenced in the chapter, in the official Yii documentation, so that you can better understand them.</p></div></body></html>