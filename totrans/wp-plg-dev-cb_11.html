<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Enabling Plugin Internationalization</h1>
                </header>
            
            <article>
                
<p>In this chapter, you will learn about plugin localization through the following topics:</p>
<ul>
<li>Changing the WordPress language configuration</li>
<li>Adapting default user settings for translation</li>
<li>Making admin page code ready for translation</li>
<li>Modifying shortcode output for translation</li>
<li>Translating text strings using Poedit</li>
<li>Loading a language file in the plugin initialization</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>WordPress is a worldwide phenomenon, with users embracing the platform all around the globe. To create a more specific experience for users in different locales, WordPress offers the ability to translate all of its user- and visitor-facing content, resulting in numerous localizations becoming available for download online. Like most other functionalities in the platform, internationalization is also available to plugin developers through a set of easy-to-use functions--the main difference being that plugin translations are typically included with the extension, instead of being downloaded separately as is the case with WordPress.</p>
<p>To prepare their plugin to be localized, developers must use special internationalization functions when dealing with text elements. Once this structure is in place, any users can create localizations by themselves for languages that they know and submit them back to the plugin author for inclusion in a future update to the extension. WordPress.org also offers an online interface for users to be able to contribute translations without requiring to use offline tools.</p>
<p>This chapter explains how to prepare a plugin to be translated and shows how to use the Poedit tool to create a new language file for a simple plugin.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Changing the WordPress language configuration</h1>
                </header>
            
            <article>
                
<p>The first step to translate a plugin is to configure WordPress to a different language setting other than English. This will automatically trigger mechanisms in the platform to look for alternate language content for any internationalized string.</p>
<p>In this recipe, we will set the site to <span class="packt_screen">French</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have access to a WordPress development environment.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Open your site <span class="packt_screen">Dashboard</span> and navigate to the <span class="packt_screen">General</span> section of the <span class="packt_screen">Settings</span> menu.</li>
<li>Set the <span class="packt_screen">Site Language</span> to <span class="packt_screen">Franais du Canada</span> and click on <span class="packt_screen">Save Changes</span>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <span class="packt_screen">Site Language</span> configuration option of WordPress allows you to select the language that will be seen by visitors when they go to your website. As can be seen in the drop-down list of languages, WordPress has a single language installed by default, shown at the top of the list. The remainder of the list indicates languages that can be added to your website. When you set a new language, translation files are automatically downloaded for the selected language and the new selection becomes the default for visitors. If you look inside the <kbd>wp-content/languages</kbd> directory of your WordPress installation, you will see that a number of files with <kbd>.po</kbd> and <kbd>.mo</kbd> extensions were downloaded for the selected language. Portable object (<kbd>.po</kbd>) files are ASCII text files that contain a list of all the original English text from the WordPress source code, while machine object (<kbd>.mo</kbd>) files are binary versions of the translation table that have been compiled to be efficiently loaded by PHP as a website is rendered.</p>
<div class="packt_infobox">If you are not presented with a list of languages to install automatically in the <span class="packt_screen">General</span> section of the <span class="packt_screen">Dashboard</span>, visit <a href="https://codex.wordpress.org/Installing_WordPress_in_Your_Language">https://codex.wordpress.org/Installing_WordPress_in_Your_Language</a> to learn how to manually download and install translation files for WordPress.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adapting default user settings for translation</h1>
                </header>
            
            <article>
                
<p>Before we can create translation files for our own plugins, their code needs to be specifically written to allow text items to be translated. This work starts in the plugin's activation routine, where default plugin option values are set, to find alternate values when a language other than English is specified in the website's configuration file.</p>
<p>This recipe shows how to assign a translated string to a plugin's default options array on initialization.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Changing the WordPress language configuration</em> recipe to have a specified translation language for the website.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the WordPress plugin directory of your development installation.</li>
<li>Create a new directory called <kbd>ch11-hello-world</kbd>.</li>
<li>Navigate to the directory and create a text file called <kbd>ch11-hello-world.php</kbd>.</li>
<li>Open the new file in a code editor and add an appropriate header at the top of the plugin file, naming the plugin <kbd>Chapter 11 - Hello World</kbd>.</li>
<li>Add the following line of code to register a function to be called when the plugin is activated:</li>
</ol>
<pre style="padding-left: 60px">register_activation_hook( __FILE__, <br/>                         'ch11hw_set_default_options_array' ); </pre>
<ol start="6">
<li>Insert the following block of code to provide an implementation for the <kbd>ch11hw_set_default_options_array</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch11hw_set_default_options_array() { <br/>    if ( false === get_option( 'ch11hw_options' ) ) { <br/>        $new_options = array(); <br/>        $new_options['default_text'] = __( 'Hello World',<br/>                                           'ch11hw_hello_world' ); <br/>        add_option( 'ch11hw_options', $new_options ); <br/>    }  <br/>} </pre>
<ol start="7">
<li>Save and close the plugin file.</li>
<li>Navigate to the <span class="packt_screen">Extensions</span> (Plugins in French) management page and click on the <span class="packt_screen">Activer</span> (Activate in French) link for the <kbd>Chapter 11 - Hello World</kbd> plugin.</li>
<li>Using phpMyAdmin, find the <kbd>options</kbd> table entry where the <kbd>option_name</kbd> field has a value of <kbd>ch11hw_options</kbd> to see the newly created option:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="62" width="840" class="image-border" src="assets/5c361311-43b5-4dbf-b0a0-5ee77711781c.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>__</kbd> function (that's two underscores) is a WordPress utility function that tries to find a translation for the text that it receives in its first argument within the text domain specified in the second argument. A text domain is essentially a subsection of the global translation table that is managed by WordPress. In this example, the text to be translated is the string <kbd>Hello World</kbd>, for which the system tries to find a translation in the <kbd>ch11hw_hello_world</kbd> domain. Since this domain is not available at this time, the function returns the original string that it received as its first parameter. The plugin code assigns the value it receives to the default configuration array.</p>
<p>It should be noted that the <kbd>__</kbd> function is actually an alias for the <kbd>translate</kbd> function. While both functions have the same functionality, using <kbd>__</kbd> makes the code shorter when it contains a lot of text elements to be translated.</p>
<div class="packt_infobox">While it may be tempting for developers to use a variable or constant in the first parameter of the <kbd>__</kbd> function if they need to display the same text multiple times, this should not be done, as it will cause problems with the translation lookup mechanism.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Changing the WordPress language configuration</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making admin page code ready for translation</h1>
                </header>
            
            <article>
                
<p>While the previous recipe showed how to look up the translation of a text item and return its value for further processing in the plugin code, there are many instances where it is more practical to display the translated content immediately.</p>
<p>This recipe shows how to translate the contents of a simple administration page for immediate display.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Adapting default user settings for translation</em> recipe to have a starting point for this recipe. Alternatively, you can get the resulting code (<kbd>Chapter 11/ch11-hello-world/ch11-hello-world-v1.php</kbd>) for that recipe from the code bundle. You should rename the file to <kbd>ch11-hello-world.php</kbd> before starting.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch11-hello-world</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch11-hello-world.php</kbd> file in a text editor.</li>
<li>Add the following line of code at the end of the file to register a function to be called when WordPress is building the administration page's menu:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'admin_menu', 'ch11hw_settings_menu' ); </pre>
<ol start="4">
<li>Add the following code section to provide an implementation for the <kbd>ch11hw_settings_menu</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch11hw_settings_menu() { <br/>    add_options_page( <br/>        __( 'Hello World Configuration', 'ch11hw_hello_world' ), <br/>        __( 'Hello World', 'ch11hw_hello_world' ), <br/>       'manage_options', <br/>       'ch11hw-hello-world', 'ch11hw_config_page' ); <br/>} </pre>
<ol start="5">
<li>Insert the following block of code to create the <kbd>ch11hw_config_page</kbd> function declared in the call to <kbd>add_options_page</kbd>:</li>
</ol>
<pre style="padding-left: 60px">function ch11hw_config_page() { <br/>    $options = get_option( 'ch11hw_options' ); <br/>    ?&gt; <br/> <br/>    &lt;div id="ch11hw-general" class="wrap"&gt; <br/>    &lt;!-- Echo translation for "Hello World" to the browser --&gt; <br/>    &lt;h2&gt;&lt;?php _e( 'Hello World', 'ch11hw_hello_world' ); ?&gt;&lt;/h2&gt; <br/>  <br/>    &lt;form method="post" action="admin-post.php"&gt; <br/>    &lt;input type="hidden" name="action" <br/>           value="save_ch11hw_options" /&gt; <br/>    &lt;?php wp_nonce_field( 'ch11hw' ); ?&gt; <br/> <br/>    &lt;!-- Echo translation for "Hello World" to the browser --&gt; <br/>    &lt;?php _e( 'Default Text', 'ch11hw_hello_world' ); ?&gt;: <br/>    &lt;input type="text" name="default_text" <br/>           value="&lt;?php echo <br/>                   esc_html( $options['default_text'] ); ?&gt;"/&gt; <br/>    &lt;br /&gt; <br/>    &lt;input type="submit" value="&lt;?php _e( 'Submit', <br/>        'ch11hw_hello_world' ); ?&gt;" class="button-primary"/&gt; <br/>    &lt;/form&gt; <br/>    &lt;/div&gt; <br/>&lt;?php } </pre>
<ol start="6">
<li>Add the following line of code to register a function to be executed when the administration panel is being prepared to be displayed:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'admin_init', 'ch11hw_admin_init' ); </pre>
<ol start="7">
<li>Append the following code segment to provide an implementation for the <kbd>ch11hw_admin_init</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch11hw_admin_init() { <br/>     add_action( 'admin_post_save_ch11hw_options',<br/>                 'process_ch11hw_options' ); <br/>} </pre>
<ol start="8">
<li>Provide code for the <kbd>process_ch11hw_options</kbd> function, declared in the previous step, by inserting the following code:</li>
</ol>
<pre style="padding-left: 60px">function process_ch11hw_options() { <br/>    if ( !current_user_can( 'manage_options' ) ) {<br/>          wp_die( 'Not allowed' );<br/>    }<br/><br/>    check_admin_referer( 'ch11hw' );<br/> <br/>    $options = get_option( 'ch11hw_options' );     <br/>    $options['default_text'] = $_POST['default_text']; <br/> <br/>    update_option( 'ch11hw_options', $options ); <br/>    wp_redirect( add_query_arg( 'page', 'ch11hw-hello-world', <br/>                     admin_url( 'options-general.php' ) ) );<br/>    exit; <br/>} </pre>
<ol start="9">
<li>Save and close the plugin file.</li>
<li>Navigate to the administration page of your development WordPress installation.</li>
</ol>
<p>Â </p>
<ol start="11">
<li>Click on the <span class="packt_screen">Reglages</span> (Settings in French) section on the left-hand navigation menu to expand it. You will see a new menu item called <span class="packt_screen">Hello</span> <span class="packt_screen">World</span> in the tree. Selecting the new entry displays the plugin's simple configuration form, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="104" width="268" class="image-border" src="assets/3a74c5cc-7298-4dd5-b121-d80f65d2a894.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>This recipe makes use of the <kbd>__</kbd> function, covered in the previous recipe, along with the <kbd>_e</kbd> function. This second function's purpose is similar to <kbd>__</kbd>, except that it immediately echoes the outcome of the translation lookup to the browser. It should be used for all text elements that would previously have just been simple text in HTML code. Of course, making a call to this function requires the presence of standard opening and closing PHP tags (<kbd>&lt;?</kbd> and <kbd>?&gt;</kbd>) to be executed among the surrounding HTML.</p>
<p>The rest of this plugin's code takes care of storing user updates in the website database, as covered previously in <a href="0346c3c6-27ee-45fb-bfd6-df398e04b2b4.xhtml"><span class="ChapterrefPACKT">Chapter</span> <span class="ChapterrefPACKT">3</span></a>, <em>User Settings and Administration Pages</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Adapting default user settings for translation</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Modifying shortcode output for translation</h1>
                </header>
            
            <article>
                
<p>As we have seen in numerous recipes, shortcodes are powerful tools that provide an easy way for users to add content to their website posts and pages. Since this content is presented to users, it can benefit from a translation just as much as the website's administration pages.</p>
<p>This recipe shows how to translate shortcode output before it is displayed. It also explains how to deal with variable data elements that can be positioned differently between languages.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Making admin page code ready for translation</em> recipe to have a starting point for this recipe. Alternatively, you can get the resulting code (<kbd>Chapter 11/ch11-hello-world/ch11-hello-world-v2.php</kbd>) for that recipe from the code bundle. You should rename the file to <kbd>ch11-hello-world.php</kbd> before starting.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch11-hello-world</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch11-hello-world.php</kbd> file in a text editor.</li>
<li>Add the following line of code at the end of the file to declare a new shortcode that will be available to content authors:</li>
</ol>
<pre style="padding-left: 60px">add_shortcode( 'hello-world', 'ch11hw_hello_world_shortcode' ); </pre>
<ol start="4">
<li>Add the following code section to provide an implementation for the <kbd>ch11hw_hello_world_shortcode</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch11hw_hello_world_shortcode() { <br/>    $options = get_option( 'ch11hw_options' ); <br/>     <br/>    $output = sprintf( __( 'The current text string is: %s.', <br/>                           'ch11hw_hello_world' ),<br/>                           $options['default_text'] ); <br/>    return $output; <br/>} </pre>
<ol start="5">
<li>Save and close the plugin file.</li>
<li>Create a new page (using the <span class="packt_screen">Ajouter</span> item of the <span class="packt_screen">Pages</span> menu) and insert the new shortcode <kbd>[hello-world]</kbd> in the content, then publish the page (<span class="packt_screen">Publier</span>).</li>
</ol>
<ol start="7">
<li>View the page (<span class="packt_screen">Voir la page</span>) to see the output of the shortcode:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/192337e6-0088-4f89-bd70-f769b221bc2f.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>This recipe shows something that's a bit more complex than the previous two, as we want the shortcode output to be a combination of static text with a dynamic element, and we want that element to appear in different places based on the grammatical structure of the target language. The way to achieve this functionality is to combine the <kbd>__</kbd> internationalization function with the <kbd>sprintf</kbd> standard PHP function.</p>
<p>The purpose of the <kbd>sprintf</kbd> function is to insert a variable in a string. It performs this task by looking for a placeholder in the target string sent in the first argument, and replaces it with the variable that it receives as its second argument. Some examples of placeholders are <kbd>%s</kbd> for a string and <kbd>%d</kbd> for an integer. With this functionality in mind, we use a placeholder as part of the string to be translated so that users who create localization files can choose where the value will be placed as part of the sentence structure. Once the translation has been obtained by the <kbd>__</kbd> function, we can immediately send the alternate language string to <kbd>sprintf</kbd> to create the final text.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Adapting default user settings for translation</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Translating text strings using Poedit</h1>
                </header>
            
            <article>
                
<p>After inserting all the necessary code to look up translations for text elements, we need to create the actual translation files. While there are multiple tools available to perform this task, we will focus our efforts around the most popular one, the free multiplatform Poedit.</p>
<p>This recipe shows how to extract all the strings to be translated from the plugin's code using Poedit, translate them, and save the resulting language file under the plugin directory.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Modifying shortcode output for translation</em> recipe to have a starting point for this recipe. Alternatively, you can get the resulting code (<kbd>Chapter 11/ch11-hello-world/ch11-hello-world-v3.php</kbd>) for that recipe from the code bundle. You should rename the file to <kbd>ch11-hello-world.php</kbd> before starting.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch11-hello-world</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Create a new subdirectory named <kbd>languages</kbd>.</li>
<li>Navigate to the Poedit download page and download the appropriate version of the tool for your computer (<a href="https://www.poedit.net/download"><span class="URLPACKT">https://www.poedit.net/download</span></a>).</li>
<li>Install and start the Poedit application.</li>
<li>Select the <span class="packt_screen">New</span> menu item under the application's <span class="packt_screen">File</span> menu.</li>
</ol>
<div class="packt_infobox">While Poedit offers an automated way to create translations for WordPress themes or plugins, we will focus on the free version of Poedit and highlight all steps required to create a translation in this mode.</div>
<ol start="6">
<li>Select <span class="packt_screen">French (Canada)</span> as <span class="packt_screen">Language of the translation</span>.</li>
<li>Click on the <span class="packt_screen">Save</span> button from the toolbar, navigate to the <kbd>languages</kbd> folder created earlier in this recipe, and set the filename to <span><kbd>ch11hw_hello_world-fr_CA.po</kbd>.</span></li>
<li>Click on the <span class="packt_screen">Extract from sources</span> button in the main interface window to open the <span class="packt_screen">Catalog Properties</span> window, which will default to the <span class="packt_screen">Sources paths</span> tab.</li>
</ol>
<div class="packt_tip">If the Poedit window is too small, it will not display the main interface section. Simply make the window larger to see the <span class="packt_screen">Extract from sources</span> button.</div>
<ol start="9">
<li>Create a new entry in the <span class="packt_screen">Paths</span> list by pressing the <span class="packt_screen">New item</span> button.</li>
<li>Set the value of the new path entry to <kbd>..</kbd> (two period characters).</li>
<li>Switch to the <span class="packt_screen">Sources k<span class="packt_screen">eywords</span></span> tab and add two new items to the list of <span class="packt_screen">Additional keywords</span> and set their values to <kbd>__</kbd> and <kbd>_e</kbd>.</li>
<li>Switch to the <span class="packt_screen">Translation</span> properties tab and set the <span class="packt_screen">Project name and version</span> field to <kbd>Hello World</kbd>.</li>
<li>Click on the <span class="packt_screen">OK</span> button to close the <span class="packt_screen">Catalog properties</span> dialog, then click on <span class="packt_screen">Save</span> from the toolbar to be able to start editing entries in the file.</li>
<li>Select the items one by one in order to display them in the lower section of the window.</li>
<li>Enter a translation for each text element in the lower dialog box. The following screenshot shows the translations of each item to French:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="212" width="540" class="image-border" src="assets/e620d692-c7cc-4af5-9f0b-1840c4caacfd.png"/></div>
<ol start="16">
<li>Save the translation file once completed.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The Poedit tool searches through PHP files, looking for functions that have specific names, as specified in the <span class="packt_screen">Keywords</span> configuration section. It looks through all the files located in the same directory as the catalog itself and in any additional folders specified under the <span class="packt_screen">Paths</span> section of the catalog settings. By specifying <kbd>..</kbd> as an additional path, we tell Poedit to look one directory up from the <kbd>languages</kbd> folder, where the plugin files are located.</p>
<p>Based on the configuration that we specified, Poedit is able to find all the instances of the <kbd>__</kbd> and <kbd>_e</kbd> functions in the plugin code and retrieve the text strings that are set as the first argument to these functions. Once all the strings have been found, Poedit provides a simple interface to provide translations for each string and saves the resulting translation file. Upon saving, Poedit actually creates two files, the portable object file and the machine object file.</p>
<p>The name of the language files is made from two parts: the name of the text domain, <kbd>ch11hw_hello_world</kbd>, which was used in all of our calls to the <kbd>__</kbd> and <kbd>_e</kbd> functions in the previous recipes, and the target language code, <kbd>fr_CA</kbd>, to match the language configuration that we set earlier in this chapter. To support all the variants of the French language that WordPress supports, you can copy the translation files, changing the language code each time in the Poedit catalog configuration, as well as in the file names (<kbd><span>ch11hw_hello_world-</span><span>fr_CA.po</span></kbd> <span>and <kbd>ch11hw_hello_world-fr_BE.po</kbd>).</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>If you are only comfortable with English, create a template file that users will be able to import to start their translation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Translation template file</h1>
                </header>
            
            <article>
                
<p>When you are only familiar with English, you can create a translation template that only contains the text to be translated by saving the catalog as a <kbd>.pot</kbd> file instead of a <kbd>.po</kbd>/<kbd>.mo</kbd> combination. In addition to the special extension, the filename should not contain a language tag (for example, <kbd>ch11hw_hello_world.pot</kbd>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Adapting default user settings for translation</em> recipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Loading a language file in the plugin initialization</h1>
                </header>
            
            <article>
                
<p>The final step to plugin translation is to put the code in place to load a translation file. This is done by registering an action hook callback and calling a single function when it gets executed.</p>
<p>This recipe shows how to load the translation file created in the previous recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>You should have already followed the <em>Making admin page code ready for translation</em> and <em>Translating text strings using Poedit</em> recipes to have the proper files required for this recipe. Alternatively, you can get the resulting code (<kbd>Chapter 11/ch11-hello-world/ch11-hello-world-v3.php</kbd> and <kbd>Chapter 11/ch11-hello-world/languages</kbd> folder) for these recipes from the code bundle. You should rename the file <kbd>ch11-hello-world-v3.php</kbd> to <kbd>ch11-hello-world.php</kbd> and copy the <kbd>languages</kbd> folder next to the renamed file before starting the recipe.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Navigate to the <kbd>ch11-hello-world</kbd> folder of the WordPress plugin directory of your development installation.</li>
<li>Open the <kbd>ch11-hello-world.php</kbd> file in a text editor.</li>
<li>Add the following line of code at the end of the file to register a function to be called when the plugin is initialized:</li>
</ol>
<pre style="padding-left: 60px">add_action( 'init', 'ch11hw_plugin_init' ); </pre>
<ol start="4">
<li>Add the following code section to provide an implementation for the <kbd>ch11hw_plugin_init</kbd> function:</li>
</ol>
<pre style="padding-left: 60px">function ch11hw_plugin_init() { <br/>    load_plugin_textdomain( 'ch11hw_hello_world', false, <br/>                            dirname( plugin_basename( __FILE__ ) ) <br/>                            . '/languages' );  <br/>} </pre>
<ol start="5">
<li>Locate the <kbd>ch11hw_set_default_options_array</kbd> function and add the same call to <kbd>load_plugin_textdomain</kbd> at the top of the function before the <kbd>if</kbd> statement:</li>
</ol>
<pre style="padding-left: 60px">load_plugin_textdomain( 'ch11hw_hello_world', false, <br/>                        dirname( plugin_basename( __FILE__ ) ) <br/>                        . '/languages' ); </pre>
<ol start="6">
<li>Save and close the plugin file.</li>
<li>Navigate to the <span class="packt_screen">Reglages</span> menu to see if the plugin's menu item has changed.</li>
<li>Select the <span class="packt_screen">Bonjour</span> <span class="packt_screen">Monde</span> item to see the translated configuration page:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="87" width="247" class="image-border" src="assets/e42fd6c1-bb03-4d2f-96e6-63d9f7540968.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The <kbd>load_plugin_textdomain</kbd> function has three arguments. When called, it looks in the folder specified in the last parameter for a <kbd>.mo</kbd> file with a name starting with the text domain specified in the first parameter, followed by the current language set in the WordPress configuration file. If found, the translation file is loaded in memory and is used to search for translations every time the <kbd>__</kbd> or <kbd>_e</kbd> functions are encountered during execution. The middle argument, set to a <kbd>false</kbd> value, is obsolete but is still needed for backward compatibility.</p>
<p>Once all the hooks are in place in the plugin code, and a first translation file (or template) is made available with the plugin, users can easily modify text elements to other languages, which they can use immediately. They can also provide these new translations back to the plugin author for inclusion in future updates. We added a second call to <kbd>load_plugin_textdomain</kbd> in the activation hook, since the <kbd>init</kbd> action hook is not executed when activation hooks execute.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>As a plugin evolves over time, new text items may need to be translated. There may also be a need to use more advanced translation functions and translate JavaScript code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating a translation file</h1>
                </header>
            
            <article>
                
<p>When new calls to the <kbd>__</kbd> or <kbd>_e</kbd> functions are made in a plugin, the translation file needs to be updated to take new text elements into account. To do this, start the Poedit tool and open the existing catalog. Then, select <span class="packt_screen">Update</span> from the toolbar. This will extract all the text items and identify new entries. Once this is done, new items can be translated and saved back to the catalog file.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Advanced translation functions</h1>
                </header>
            
            <article>
                
<p>While we used the most common internationalization functions in this chapter, there are a few more advanced functions that may be useful in your efforts:</p>
<ul>
<li><kbd>_n( $singular, $plural, $number, $domain )</kbd>: This function will look up one of the first two strings received, depending on whether the number is one or more.</li>
<li><kbd>_x( $text, $context, $domain )</kbd>: Adds a parameter to the localization lookup to add a context parameter. This is useful when dealing with words that have the same spelling but different meanings.</li>
<li><kbd>_ex( $text, $context, $domain )</kbd>: Same as <kbd>_x</kbd> but echoes the result of the lookup.</li>
<li><kbd>_nx( $singular, $plural, $number, $context, $domain)</kbd>: Same as <kbd>_n</kbd> with the additional context parameter from <kbd>_x</kbd>.</li>
</ul>
<p>There are also a number of functions that will perform a localization lookup immediately, followed by the escape of the resulting string. These functions include <kbd>esc_attr__()</kbd>, <kbd>esc_attr_e()</kbd>, <kbd>esc_html__()</kbd>, <kbd>esc_html_x()</kbd>, and many more. For a full list of internationalization functions, visit <a href="https://codex.wordpress.org/L10n"><span class="URLPACKT">https://codex.wordpress.org/L10n</span></a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Localizing JavaScript files</h1>
                </header>
            
            <article>
                
<p>JavaScript files are a bit more tricky to translate, as they are often read from an external file that cannot contain any PHP code. The solution to this is the <kbd>wp_localize_script</kbd> function. When called, this function declares new variables in scripts that have already been queued up to be loaded, and populates these variables with localized strings. Upon execution, the code will be able to access and display the proper text on screen. The following code snippet is an example showing how to use the function:</p>
<pre>wp_enqueue_script( 'script_handle' );<br/>$translation_vars = array( 'string_val' =&gt; <br/>                           __( 'Text to be translated' ) );<br/>wp_localize_script( 'script_handle', 'javascript_object',   <br/>                    $translation_vars );  </pre>
<p>In the previous code example, a new object called <kbd>javascript_object</kbd> will be created inside the <kbd>script_handle</kbd> script, with a data member called <kbd>string_val</kbd> that contains a translation of the target text in the current WordPress language, if available.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>The <em>Translating text strings using Poedit</em> recipe</li>
</ul>


            </article>

            
        </section>
    </body></html>