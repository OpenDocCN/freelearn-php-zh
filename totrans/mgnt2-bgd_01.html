<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;1.&#xA0;Understanding the Platform Architecture" id="DB7S1-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01" class="calibre1"/>Chapter 1. Understanding the Platform Architecture</h1></div></div></div><p class="calibre7"><span class="strong"><strong class="calibre8">Magento</strong></span> is <a id="id0" class="calibre1"/>a powerful, highly scalable, and highly customizable e-commerce platform that can be used to build web shops and, if needed, some non-e-commerce sites. It provides a large number of e-commerce features out of the box.</p><p class="calibre7">Features such as product inventory, shopping cart, support for numerous payment and shipment methods, promotion rules, content management, multiple currencies, multiple languages, multiple websites, and so on make it a great choice for merchants. On the other hand, developers enjoy the full set of merchant-relevant features plus all the things related to actual development. This chapter will touch upon the topic of robust Web API support, extensible administration interface, modules, theming, embedded testing frameworks, and much more.</p><p class="calibre7">In this chapter, a high-level overview of Magento is provided in the following sections:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The technology stack</li><li class="listitem">The architectural layers</li><li class="listitem">The top-level filesystem structure</li><li class="listitem">The module filesystem structure</li></ul></div></div>

<div class="book" title="Chapter&#xA0;1.&#xA0;Understanding the Platform Architecture" id="DB7S1-818f5224668745eb9070ddf1d85e6bfa">
<div class="book" title="The technology stack"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch01lvl1sec08" class="calibre1"/>The technology stack</h1></div></div></div><p class="calibre7">Magento's highly modular structure is a result of several open source technologies embedded into a stack. These open source technologies are composed of the following components:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre8">PHP</strong></span>: PHP<a id="id1" class="calibre1"/> is a server-side scripting language. This book assumes that you have advanced knowledge <a id="id2" class="calibre1"/>of the object-oriented aspects of PHP, which is often referred to as <span class="strong"><strong class="calibre8">PHP OOP</strong></span>.</li><li class="listitem"><span class="strong"><strong class="calibre8">Coding standards</strong></span>: Magento <a id="id3" class="calibre1"/>puts a lot of emphasis on coding standards. These include <span class="strong"><strong class="calibre8">PSR-0</strong></span> (the autoloading standard), <span class="strong"><strong class="calibre8">PSR-1</strong></span> (the basic coding standards), <span class="strong"><strong class="calibre8">PSR-2</strong></span> (the coding style guide), <span class="strong"><strong class="calibre8">PSR-3</strong></span>, and <span class="strong"><strong class="calibre8">PSR-4</strong></span>.</li><li class="listitem"><span class="strong"><strong class="calibre8">Composer</strong></span>: Composer<a id="id4" class="calibre1"/> is a dependency management package for PHP. It is used to pull in all the vendor library requirements.</li><li class="listitem"><span class="strong"><strong class="calibre8">HTML</strong></span>: HTML5<a id="id5" class="calibre1"/> is supported out of the box.</li><li class="listitem"><span class="strong"><strong class="calibre8">CSS</strong></span>: Magento <a id="id6" class="calibre1"/>supports CSS3 via its in-built <span class="strong"><strong class="calibre8">LESS CSS</strong></span> preprocessor.</li><li class="listitem"><span class="strong"><strong class="calibre8">jQuery</strong></span>: jQuery<a id="id7" class="calibre1"/> is a mature cross-platform JavaScript library that was designed to simplify the DOM manipulation. It is one of the most popular JavaScript frameworks today.</li><li class="listitem"><span class="strong"><strong class="calibre8">RequireJS</strong></span>: RequireJS is a JavaScript file and module loader. Using a modular <a id="id8" class="calibre1"/>script loader such as RequireJS helps improve the speed and quality of code.</li><li class="listitem"><span class="strong"><strong class="calibre8">Third-party libraries</strong></span>: Magento comes<a id="id9" class="calibre1"/> packed with lot of third-party libraries, with<a id="id10" class="calibre1"/> the most notable ones being <span class="strong"><strong class="calibre8">Zend Framework</strong></span> and <span class="strong"><strong class="calibre8">Symfony</strong></span>. It is worth noting that Zend Framework comes in two<a id="id11" class="calibre1"/> different major versions, namely version 1.x and version 2.x. Magento uses both of these versions internally.</li><li class="listitem"><span class="strong"><strong class="calibre8">Apache or Nginx</strong></span>: Both Apache <a id="id12" class="calibre1"/>and Nginx are HTTP servers. Each has its distinct advantages and disadvantages. It would be unfair to say one is better than another, as their performance widely depends on the entire system's setup and usage. Magento works with Apache 2.2 and 2.4 and Nginx 1.7.</li><li class="listitem"><span class="strong"><strong class="calibre8">MySQL</strong></span>: MySQL is a mature and widely used <span class="strong"><strong class="calibre8">relational database management system</strong></span> (<span class="strong"><strong class="calibre8">RDBMS</strong></span>) that uses <span class="strong"><strong class="calibre8">structured query language</strong></span> (<span class="strong"><strong class="calibre8">SQL</strong></span>). There<a id="id13" class="calibre1"/> are both<a id="id14" class="calibre1"/> free community versions and commercial versions of MySQL. Magento requires at least the of <span class="strong"><strong class="calibre8">MySQL Community Edition</strong></span> version 5.6.</li><li class="listitem"><span class="strong"><strong class="calibre8">MTF</strong></span>: <span class="strong"><strong class="calibre8">Magento Testing Framework</strong></span> (<span class="strong"><strong class="calibre8">MTF</strong></span>) delivers<a id="id15" class="calibre1"/> an <a id="id16" class="calibre1"/>automated testing suite. It covers various types of tests, such as performance, functional, and unit testing. The entire MTF is available on GitHub, which can be viewed by visiting <a class="calibre1" href="https://github.com/magento/mtf">https://github.com/magento/mtf</a> as an isolated project.</li></ul></div><p class="calibre7">Different <a id="id17" class="calibre1"/>pieces of technology can be glued into various architectures. There are different ways to look at the Magento architecture—from the perspective of a module developer, system integrator, or a merchant, or from some other angle.</p></div></div>
<div class="book" title="The architectural layers" id="E9OE1-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec09" class="calibre1"/>The architectural layers</h1></div></div></div><p class="calibre7">From top to bottom, Magento can be divided into four architectural layers, namely <span class="strong"><em class="calibre9">presentation</em></span>, <span class="strong"><em class="calibre9">service</em></span>, <span class="strong"><em class="calibre9">domain</em></span>, and <span class="strong"><em class="calibre9">persistence</em></span>.</p><p class="calibre7">The <span class="strong"><em class="calibre9">presentation</em></span> layer is the one that we directly interact with through the browser. It contains <a id="id18" class="calibre1"/>layouts, blocks, templates, and even controllers, which<a id="id19" class="calibre1"/> process commands to and from the user interface. Client-side technologies such as jQuery, RequireJS, CSS, and LESS are also a part of this layer. Usually, three types of users interact with this layer, namely web users, system administrators, and those making the Web API calls. Since the Web API calls can be made via HTTP in a manner that is the same as how a user uses a browser, there's a thin line between the two. While web users and Web API calls consume the presentation layer as it is, the system administrators have the power to change it. This change manifests in the form of setting the active theme and changing the content of the <span class="strong"><strong class="calibre8">CMS</strong></span> (short for <span class="strong"><strong class="calibre8">content management system</strong></span>) pages, blocks, and the products<a id="id20" class="calibre1"/> themselves.</p><p class="calibre7">When the components of a presentation layer are being interacted with, they usually make calls to the underlying service layer.</p><p class="calibre7">The <span class="strong"><em class="calibre9">service</em></span> layer is the bridge between the presentation and domain layer. It contains the service<a id="id21" class="calibre1"/> contracts, which define the implementation behavior. A <span class="strong"><strong class="calibre8">service contract</strong></span> is basically a fancy name for a PHP interface. This layer is where we<a id="id22" class="calibre1"/> can find the REST/SOAP APIs. Most user interaction on the storefront is routed through the service layer. Similarly, the external applications that make the REST/SOAP API calls also interact with this layer.</p><p class="calibre7">When the components of a service layer are being interacted with, they usually make calls to the underlying domain layer.</p><p class="calibre7">The <span class="strong"><em class="calibre9">domain</em></span> layer is really the business logic of Magento. This layer is all about generic data <a id="id23" class="calibre1"/>objects and models that compose the business logic. The domain layer models themselves do not contribute to data persistence, but they do contain a reference to a resource model that is used to retrieve and persist the data to a MySQL database. A domain layer code from one module can interact with a domain module code from another module via the use of <span class="strong"><em class="calibre9">event observers</em></span>, <span class="strong"><em class="calibre9">plugins</em></span>, and the <span class="strong"><em class="calibre9">di.xml</em></span> definitions. We will look into the details of these later on in other chapters. Given the power of plugins and di.xml, its important to note that this interaction is best established using service contracts (the PHP interface).</p><p class="calibre7">When the components of the domain layer are being interacted with, they usually make calls to the underlying persistence layer.</p><p class="calibre7">The <span class="strong"><em class="calibre9">persistence</em></span> layer is where the data gets persisted. This layer is in charge of all the <span class="strong"><strong class="calibre8">CRUD</strong></span> (short for <span class="strong"><strong class="calibre8">create, read, update, and delete</strong></span>) requests. Magento uses an active record <a id="id24" class="calibre1"/>pattern strategy for the persistence layer. The<a id="id25" class="calibre1"/> model object contains a resource model that maps an <a id="id26" class="calibre1"/>object to one or more database rows. Here, it<a id="id27" class="calibre1"/> is important to differentiate the cases of simple resource model and the <span class="strong"><strong class="calibre8">Entity-Attribute-Value</strong></span> (<span class="strong"><strong class="calibre8">EAV</strong></span>) resource models. A simple resource model maps to a single table, while the EAV resource models have their attributes spread out over a number of MySQL tables. As an example, the <code class="email">Customer</code> and <code class="email">Catalog</code> resource models use EAV resource models, while the newsletter's <code class="email">Subscriber</code> resource model uses a simple resource model.</p></div>
<div class="book" title="The top-level filesystem structure"><div class="book" id="F8902-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec10" class="calibre1"/>The top-level filesystem structure</h1></div></div></div><p class="calibre7">The <a id="id28" class="calibre1"/>following list depicts the root Magento filesystem structure:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">.htaccess</code></li><li class="listitem"><code class="email">.htaccess.sample</code></li><li class="listitem"><code class="email">.php_cs</code></li><li class="listitem"><code class="email">.travis.yml</code></li><li class="listitem"><code class="email">CHANGELOG.md</code></li><li class="listitem"><code class="email">CONTRIBUTING.md</code></li><li class="listitem"><code class="email">CONTRIBUTOR_LICENSE_AGREEMENT.html</code></li><li class="listitem"><code class="email">COPYING.txt</code></li><li class="listitem"><code class="email">Gruntfile.js</code></li><li class="listitem"><code class="email">LICENSE.txt</code></li><li class="listitem"><code class="email">LICENSE_AFL.txt</code></li><li class="listitem"><code class="email">app</code></li><li class="listitem"><code class="email">bin</code></li><li class="listitem"><code class="email">composer.json</code></li><li class="listitem"><code class="email">composer.lock</code></li><li class="listitem"><code class="email">dev</code></li><li class="listitem"><code class="email">index.php</code></li><li class="listitem"><code class="email">lib</code></li><li class="listitem"><code class="email">nginx.conf.sample</code></li><li class="listitem"><code class="email">package.json</code></li><li class="listitem"><code class="email">php.ini.sample</code></li><li class="listitem"><code class="email">phpserver</code></li><li class="listitem"><code class="email">pub</code></li><li class="listitem"><code class="email">setup</code></li><li class="listitem"><code class="email">update</code></li><li class="listitem"><code class="email">var</code></li><li class="listitem"><code class="email">vendor</code></li></ul></div><p class="calibre7">The <code class="email">app/etc/di.xml</code> file is one of the most important files that we might often look into<a id="id29" class="calibre1"/> during development. It contains various class mappings or preferences for individual interfaces.</p><p class="calibre7">The <code class="email">var/magento/language-*</code> directories is where the registered languages reside. Though each module can declare its own translations under <code class="email">app/code/{VendorName}/{ModuleName}/i18n/</code>, Magento will eventually fall back to its own individual module named <code class="email">i18n</code> in case translations are not found in the custom module or within the theme directory.</p><p class="calibre7">The <code class="email">bin</code> directory is where we can find the <code class="email">magento</code> file. The <code class="email">magento</code> file is a script that is intended to be run from a console. Once triggered via the <code class="email">php bin/magento</code> command, it runs an instance of the <code class="email">Magento\Framework\Console\Cli</code> application, presenting us with quite a number of console options. We can use the <code class="email">magento</code> script to enable/disable cache, enable/disable modules, run an indexer, and do many other things.</p><p class="calibre7">The <code class="email">dev</code> directory is where we can find the Magento test scripts. We will have a look at more of those in later chapters.</p><p class="calibre7">The <code class="email">lib</code> directory comprises two major subdirectories, namely the server-side PHP library code and fonts found under <code class="email">lib/internal</code> and the client-side JavaScript libraries found in <code class="email">lib/web</code>.</p><p class="calibre7">The <code class="email">pub</code> directory is where the publicly exposed files are located. This is the directory that we should set as root when setting up Apache or Nginx. The <code class="email">pub/index.php</code> file is what gets triggered when the storefront is opened in a browser.</p><p class="calibre7">The <code class="email">var</code> directory is where the dynamically generated group type of files such as cache, log, and a few others get created in. We should be able to delete the content of this folder at any time and have Magento automatically recreate it.</p><p class="calibre7">The <code class="email">vendor</code> directory is where most of the code is located. This is where we can find various <a id="id30" class="calibre1"/>third-party vendor code, Magento modules, themes, and language packs. Looking further into the <code class="email">vendor</code> directory, you will see the following structure:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">.htaccess</code></li><li class="listitem"><code class="email">autoload.php</code></li><li class="listitem"><code class="email">bin</code></li><li class="listitem"><code class="email">braintree</code></li><li class="listitem"><code class="email">composer</code></li><li class="listitem"><code class="email">doctrine</code></li><li class="listitem"><code class="email">fabpot</code></li><li class="listitem"><code class="email">justinrainbow</code></li><li class="listitem"><code class="email">league</code></li><li class="listitem"><code class="email">lusitanian</code></li><li class="listitem"><code class="email">magento</code></li><li class="listitem"><code class="email">monolog</code></li><li class="listitem"><code class="email">oyejorge</code></li><li class="listitem"><code class="email">pdepend</code></li><li class="listitem"><code class="email">pelago</code></li><li class="listitem"><code class="email">phpmd</code></li><li class="listitem"><code class="email">phpseclib</code></li><li class="listitem"><code class="email">phpunit</code></li><li class="listitem"><code class="email">psr</code></li><li class="listitem"><code class="email">sebastian</code></li><li class="listitem"><code class="email">seld</code></li><li class="listitem"><code class="email">sjparkinson</code></li><li class="listitem"><code class="email">squizlabs</code></li><li class="listitem"><code class="email">symfony</code></li><li class="listitem"><code class="email">tedivm</code></li><li class="listitem"><code class="email">tubalmartin</code></li><li class="listitem"><code class="email">zendframework</code></li></ul></div><p class="calibre7">Within <a id="id31" class="calibre1"/>the vendor directory, we can find code from various vendors, such as <code class="email">phpunit</code>, <code class="email">phpseclib</code>, <code class="email">monolog</code>, <code class="email">symfony</code>, and so on. Magento itself can be found here. The Magento code is located under <code class="email">vendor/magento</code> directory, listed (partially) as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">composer</code></li><li class="listitem"><code class="email">framework</code></li><li class="listitem"><code class="email">language-en_us</code></li><li class="listitem"><code class="email">magento-composer-installer</code></li><li class="listitem"><code class="email">magento2-base</code></li><li class="listitem"><code class="email">module-authorization</code></li><li class="listitem"><code class="email">module-backend</code></li><li class="listitem"><code class="email">module-catalog</code></li><li class="listitem"><code class="email">module-customer</code></li><li class="listitem"><code class="email">module-theme</code></li><li class="listitem"><code class="email">module-translation</code></li><li class="listitem"><code class="email">module-ui</code></li><li class="listitem"><code class="email">module-url-rewrite</code></li><li class="listitem"><code class="email">module-user</code></li><li class="listitem"><code class="email">module-version</code></li><li class="listitem"><code class="email">module-webapi</code></li><li class="listitem"><code class="email">module-widget</code></li><li class="listitem"><code class="email">theme-adminhtml-backend</code></li><li class="listitem"><code class="email">theme-frontend-blank</code></li><li class="listitem"><code class="email">theme-frontend-luma</code></li></ul></div><p class="calibre7">You will see that the further structuring of directories follows a certain naming schema, whereas the <code class="email">theme-*</code> directory stores themes, the <code class="email">module-*</code> directory stores modules, and the <code class="email">language-*</code> directory stores registered languages.</p></div>
<div class="book" title="The module filesystem structure" id="G6PI1-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec11" class="calibre1"/>The module filesystem structure</h1></div></div></div><p class="calibre7">Magento <a id="id32" class="calibre1"/>identifies itself as a highly modular platform. What this means is that there is literally a directory location where modules are placed. Let's take a peak at the individual module structure now. The following structure belongs to one of the simpler core Magento modules—the <code class="email">Contact</code> module that can be found in <code class="email">vendor/magento/module-contact</code>:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">Block</code></li><li class="listitem"><code class="email">composer.json</code></li><li class="listitem"><code class="email">Controller</code></li><li class="listitem"><code class="email">etc</code><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="email">acl.xml</code></li><li class="listitem"><code class="email">adminhtml</code><div class="book"><ul class="itemizedlist2"><li class="listitem"><code class="email">system.xml</code></li></ul></div></li><li class="listitem"><code class="email">config.xml</code></li><li class="listitem"><code class="email">email_templates.xml</code></li><li class="listitem"><code class="email">frontend</code><div class="book"><ul class="itemizedlist2"><li class="listitem"><code class="email">di.xml</code></li><li class="listitem"><code class="email">page_types.xml</code></li><li class="listitem"><code class="email">routes.xml</code></li></ul></div></li><li class="listitem"><code class="email">module.xml</code></li></ul></div></li><li class="listitem"><code class="email">Helper</code></li><li class="listitem"><code class="email">i18n</code></li><li class="listitem"><code class="email">LICENSE_AFL.txt</code></li><li class="listitem"><code class="email">LICENSE.txt</code></li><li class="listitem"><code class="email">Model</code></li><li class="listitem"><code class="email">README.md</code></li><li class="listitem"><code class="email">registration.php</code></li><li class="listitem"><code class="email">Test</code><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="email">Unit</code><div class="book"><ul class="itemizedlist2"><li class="listitem"><code class="email">Block</code></li><li class="listitem"><code class="email">Controller</code></li><li class="listitem"><code class="email">Helper</code></li><li class="listitem"><code class="email">Model</code></li></ul></div></li></ul></div></li><li class="listitem"><code class="email">view</code><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="email">adminhtml</code></li><li class="listitem"><code class="email">frontend</code><div class="book"><ul class="itemizedlist2"><li class="listitem"><code class="email">layout</code></li><li class="listitem"><code class="email">contact_index_index.xml</code></li><li class="listitem"><code class="email">default.xml</code></li></ul></div></li><li class="listitem"><code class="email">templates</code><div class="book"><ul class="itemizedlist2"><li class="listitem"><code class="email">form.phtml</code></li></ul></div></li></ul></div></li></ul></div><p class="calibre7">Even<a id="id33" class="calibre1"/> though the preceding structure is for one of the simpler modules, you can see that it is still quite extensive.</p><p class="calibre7">The <code class="email">Block</code> directory is where the view-related block PHP classes are located.</p><p class="calibre7">The <code class="email">Controller</code> directory is where the controller-related PHP classes are stored. This is the code that responds to the storefront <code class="email">POST</code> and <code class="email">GET HTTP</code> actions.</p><p class="calibre7">The <code class="email">etc</code> directory is where the module configuration files are present. Here, we can see files such as <code class="email">module.xml</code>, <code class="email">di.xml</code>, <code class="email">acl.xml</code>, <code class="email">system.xml</code>, <code class="email">config.xml</code>, <code class="email">email_templates.xml</code>, <code class="email">page_types.xml</code>, <code class="email">routes.xml</code>, and so on. The <code class="email">module.xml</code> file is an actual module declaration file. We will look into the contents of some of these files in the later chapters.</p><p class="calibre7">The <code class="email">Helper</code> directory is where various helper classes are located. These classes are usually used to abstract various store configuration values into the getter methods.</p><p class="calibre7">The <code class="email">i18n</code> directory is where the module translation package CSV files are stored.</p><p class="calibre7">The <code class="email">Module</code> directory is where the entities, resource entities, collections, and various other business classes can be found.</p><p class="calibre7">The <code class="email">Test</code> directory stores the module unit tests.</p><p class="calibre7">The <code class="email">view</code> directory contains all the module administrator and storefront template files (<code class="email">.phtml</code> and <code class="email">.html</code>) and static files (<code class="email">.js</code> and <code class="email">.css</code>).</p><p class="calibre7">Finally, the <code class="email">registration.php</code> is a module registration file.</p></div>
<div class="book" title="Summary" id="H5A41-818f5224668745eb9070ddf1d85e6bfa"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec12" class="calibre1"/>Summary</h1></div></div></div><p class="calibre7">In this chapter, we took a quick look at the technology stack used in Magento. We discussed how Magento, being an open source product, takes extensive use of other open source projects and libraries such as MySQL, Apache, Nginx, Zend Framework, Symfony, jQuery, and so on. We then learned how these libraries are arranged into directories. Finally, we explored one of the existing core modules and briefly took a look at an example of a module's structure.</p><p class="calibre7">In the next chapter, we are going to tackle the environment setup so that we can get Magento installed and ready for development.</p></div></body></html>