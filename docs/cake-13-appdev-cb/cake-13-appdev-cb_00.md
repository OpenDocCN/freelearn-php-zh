# 前言

CakePHP 是一个用于 PHP 的快速开发框架，它为开发、维护和部署 Web 应用程序提供了一个可扩展的架构。虽然该框架为初学者提供了大量的文档和参考指南，但开发更复杂和可扩展的应用程序需要深入了解 CakePHP 的功能，这对即使是经验丰富的开发者来说也是一个挑战。

本食谱集中的食谱将为您提供即时结果，并帮助您开发 Web 应用程序，利用 CakePHP 的功能，让您能够快速理解和使用这些功能。遵循本书中的食谱（展示了如何使用 AJAX、数据源、GEO 定位、路由、性能优化等），您将能够迅速理解和使用这些功能。

# 本书涵盖的内容

*第一章*，*认证*：本章解释了如何在 CakePHP 应用程序上设置认证，从最基本的设置开始，到使用框架核心中内置的工具实现高级授权机制结束。这是通过使用工具来实现的，这些工具允许我们快速设置安全区域，同时不会失去构建更复杂解决方案的灵活性。

前两个食谱展示了如何设置一个基本但完全工作的认证系统。接下来的三个食谱允许我们的用户使用不同的信息登录，在成功登录后将用户详细信息保存下来，并展示如何获取这些用户信息。第六个食谱展示了一种更复杂的基于路由前缀的授权技术。第七个食谱通过使用 CakePHP 的访问控制层设置了一个复杂的认证系统。最后，最后一个食谱展示了如何将我们的应用程序与 OpenID 集成。

*第二章*，*模型绑定*：本章讨论了 CakePHP 应用程序最重要的方面之一：模型之间的关系，也称为模型绑定或关联。作为任何应用程序逻辑的组成部分，掌握如何操纵模型绑定以获取所需数据，在需要时获取数据，这一点至关重要。

为了做到这一点，我们将通过一系列食谱展示如何更改获取绑定的方式，哪些绑定以及从绑定中返回哪些信息，如何创建新的绑定，以及如何构建层次化数据结构。

*第三章*，推动搜索：使用模型获取数据是任何 CakePHP 应用程序最重要的方面之一。因此，合理使用框架提供的查找函数可以确保我们应用程序的成功，并且同样重要的是确保我们的代码可读且易于维护。

在本章中，我们提供了一些食谱，当需要时可以手动执行基于 SQL 的查询。

CakePHP 还允许我们定义自己的自定义查找类型，这将扩展基本类型，使我们的代码更具可读性。本章的最后几个食谱展示了如何为我们的查找类型添加分页支持。

*第四章*，*验证和行为*：本章讨论了 CakePHP 模型中的两个基本方面，这对于大多数应用程序都是至关重要的：验证和行为。

当我们将信息保存到数据源（例如数据库）时，CakePHP 会自动确保数据被引号包围，以防止攻击，其中 SQL 注入是最常见的一种。如果我们还需要确保数据遵循某种格式（例如，电话号码有效），我们则使用验证规则。

有时候，我们需要的不仅仅是验证我们正在处理的数据。在某些情况下，我们需要为最终用户无法指定的字段设置值，但这些字段却是我们应用程序逻辑的一部分。CakePHP 的行为允许我们通过回调在数据保存之前或之后对其进行操作，从而扩展模型提供的功能。

第三个食谱展示了如何在行为中使用模型回调（如`beforeFind`和`afterFind`），而第四个食谱展示了如何在使用`save`操作时，通过行为添加额外的字段值。

本章的最后两个食谱给出了如何使用`Sluggable`行为（用于创建 SEO 友好的 URL）和`Geocodable`行为（为`Address`模型添加地理编码支持）的示例。

*第五章*，*数据源*：数据源几乎是所有模型操作的基础。它们在模型逻辑和底层数据层之间提供了一个抽象层，允许更灵活的数据操作方法。通过这种抽象，CakePHP 应用程序能够在不知道数据存储或检索的具体细节的情况下操作数据。

本章展示了如何从现有数据源获取信息，使用预构建的数据源处理非关系型数据，并教我们如何创建一个功能齐全的 Twitter 数据源。

*第六章*，*路由魔法*：几乎每个基于 Web 的应用程序最终都必须开发一种成功的策略，通过一种称为**搜索引擎优化**的技术来获得更好的搜索引擎排名。

本章首先通过使用路由参数介绍了一些基本的路由概念，然后继续构建优化路由以利用我们的搜索引擎排名。

本章的最后部分展示了如何为我们的用户资料创建高度优化的 URL，以及如何构建自定义的`Route`类以获得更大的灵活性。

*第七章*, *创建和消费 Web 服务*：当展望将应用程序功能暴露给第三方应用程序或展望将外部服务集成到我们自己的应用程序中时，Web 服务是必不可少的。它们提供了一套广泛的技术和定义，使得用不同编程语言编写的系统可以相互通信。

本章介绍了一系列食谱，用于消费 Web 服务并将我们应用程序的部分暴露为 Web 服务。

*第八章*, *使用 Shell*：CakePHP 最强大且最不为人知的特性之一是其壳框架。它为应用程序提供了构建命令行工具所需的一切，这些工具可以用于执行密集型任务和其他任何类型的非交互式处理。

本章通过介绍构建基本壳的过程开始，引导读者了解 CakePHP 壳，然后继续介绍更高级的功能，例如发送电子邮件和从壳中运行控制器操作。最后，本章介绍了机器人插件，它提供了一个功能齐全的解决方案，用于调度和运行任务。

*第九章*, *国际化应用程序*：本章包含一系列食谱，允许读者国际化他们 CakePHP 应用程序的所有方面，包括静态内容（如视图中的内容）和动态内容（如数据库记录）。

前两个食谱展示了如何使任何 CakePHP 视图或模型验证消息中的文本准备好翻译。第三个食谱展示了如何翻译更复杂的表达式。第四个食谱展示了如何运行 CakePHP 内置工具以提取所有需要翻译的静态内容，然后将该内容翻译成不同的语言。第五个食谱展示了如何翻译数据库记录。最后，最后一个食谱展示了如何允许用户更改当前应用程序的语言。

*第十章*, *测试*：本章涵盖了应用程序编程中最有趣的一个领域：通过 CakePHP 内置工具进行单元测试，它提供了一个完整且强大的单元测试框架。

第一个食谱展示了如何设置测试框架，以便我们可以创建自己的测试用例。第二个食谱展示了如何创建测试数据（固定数据）并使用该数据来测试模型方法。第三和第四个食谱展示了如何测试控制器操作，以及如何测试我们的视图是否显示了我们期望的内容。最后一个食谱展示了如何以非普通方式运行测试。

*第十一章*, *工具类和工具*：本章介绍了一系列工具类和有用的技术，这些技术可以提高 CakePHP 应用的架构。

第一道食谱展示了如何使用优化数组操作的 CakePHP 类。第二道食谱展示了如何使用`Email`组件发送电子邮件。第三道食谱展示了如何使用`MagicDb`类检测文件类型，最后一道食谱展示了如何创建应用程序异常，并在抛出时正确处理它们。

# 你需要这本书的什么

我们需要以下软件来完成这本书：

+   支持 CakePHP 的 Web 服务器（例如 Apache）

+   支持 CakePHP 的数据库引擎（例如 MySQL）

+   CakePHP 已安装、配置并正常运行

# 这本书面向谁

如果你是一名希望发现快速简便的方法来改进 Web 应用程序、利用框架所有方面的 CakePHP 开发者，这本书就是为你准备的。本书假设你已经具备 CakePHP 和一般的 PHP 开发技能。

# 惯例

在这本书中，你会发现许多不同风格的文本，用于区分不同类型的信息。以下是一些这些风格的示例及其含义的解释。

文本中的代码词汇如下所示：“创建一个名为`query_log.php`的文件，并将其放置在你的`app/controllers/components`文件夹中，内容如下：”

代码块设置如下：

```php
CREATE TABLE `accounts`(
`id` INT UNSIGNED AUTO_INCREMENT NOT NULL,
`email` VARCHAR(255) NOT NULL,
PRIMARY KEY(`id`)
);

```

**新术语**和**重要词汇**以粗体显示。你在屏幕上看到的，例如在菜单或对话框中的文字，在文本中会这样显示：“在那个屏幕上，确保抓取显示为**消费者密钥**和**消费者密钥**的内容，因为我们在执行这个食谱时会用到它。”

### 注意

警告或重要注意事项以如下框中的方式显示。

### 小贴士

小贴士和技巧看起来是这样的。

# 读者反馈

我们读者的反馈总是受欢迎的。告诉我们你对这本书的看法——你喜欢什么或可能不喜欢什么。读者反馈对我们开发你真正能从中获得最大价值的标题非常重要。

要发送给我们一般性的反馈，只需发送电子邮件至`<feedback@packtpub.com>`，并在邮件主题中提及书名。

如果你需要一本书，并希望我们出版，请通过[www.packtpub.com](http://www.packtpub.com)上的**建议书名**表单或发送电子邮件至`<suggest@packtpub.com>`给我们留言。

如果你在一个领域有专业知识，并且你对撰写或为书籍做出贡献感兴趣，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在你已经是 Packt 书籍的骄傲拥有者，我们有一些事情可以帮助你从购买中获得最大价值。

### 小贴士

**下载本书的示例代码**

您可以从[`www.PacktPub.com`](http://www.PacktPub.com)您购买的所有 Packt 书籍的账户中下载示例代码文件。如果您在其他地方购买了这本书，您可以访问[`www.PacktPub.com/support`](http://www.PacktPub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

## 勘误

尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在我们的某本书中发现错误——可能是文本或代码中的错误——如果您能向我们报告这一点，我们将不胜感激。通过这样做，您可以避免其他读者感到沮丧，并帮助我们改进本书的后续版本。如果您发现任何勘误，请通过访问[`www.packtpub.com/support`](http://www.packtpub.com/support)，选择您的书籍，点击**勘误提交表单**链接，并输入您的勘误详情来报告它们。一旦您的勘误得到验证，您的提交将被接受，勘误将被上传到我们的网站，或添加到该标题的勘误部分下的现有勘误列表中。您可以通过从[`www.packtpub.com/support`](http://www.packtpub.com/support)选择您的标题来查看任何现有勘误。

## 盗版

互联网上版权材料的盗版是一个跨所有媒体的持续问题。在 Packt，我们非常重视我们版权和许可证的保护。如果您在网上发现我们作品的任何非法副本，无论形式如何，请立即向我们提供位置地址或网站名称，以便我们可以寻求补救措施。

如果您在本书的任何方面遇到问题，请通过发送电子邮件到`<copyright@packtpub.com>`并附上疑似盗版材料的链接与我们联系。

我们感谢您在保护我们的作者以及为我们提供有价值内容的能力方面的帮助。

## 问题

如果您在本书的任何方面遇到问题，请通过发送电子邮件到`<questions@packtpub.com>`与我们联系，我们将尽力解决。
