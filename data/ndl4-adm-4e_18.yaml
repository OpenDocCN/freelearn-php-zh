- en: '18'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '18'
- en: Integrating External Systems Using Moodle Web Services
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Moodle Web服务集成外部系统
- en: In most organizations, the LMS is rarely an isolated, standalone system; instead,
    it is almost always part of an institution-wide infrastructure containing several
    best-of-breed components. Web services facilitate exchange and communication among
    these systems and Moodle is no exception. At the time of writing, Moodle ships
    with almost 700 web service functions, a number that is growing with every release.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数组织中，LMS很少是一个孤立、独立的系统；相反，它几乎总是包含在机构范围内的基础设施的一部分，该基础设施包含多个最佳组件。Web服务促进了这些系统之间的交流和通信，Moodle也不例外。在撰写本文时，Moodle附带近700个Web服务功能，这个数字随着每个版本的发布而增长。
- en: After providing a brief overview of web services and giving some application
    examples, we will learn about the basic concepts of Moodle web services. Next,
    we will configure the generic Moodle web services functionality required for different
    setups. Then, we will learn how to set up the Moodle web service for another application
    to control Moodle. Lastly, we will learn how to set up the Moodle web service
    for a user as the client.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在简要概述Web服务并提供一些应用示例之后，我们将学习Moodle Web服务的基本概念。接下来，我们将配置不同设置所需的通用Moodle Web服务功能。然后，我们将学习如何为其他应用程序控制Moodle设置Moodle
    Web服务。最后，我们将学习如何为用户作为客户端设置Moodle Web服务。
- en: 'We will be covering the following topics in this chapter:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将涵盖以下主题：
- en: Understanding Moodle web services
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解Moodle Web服务
- en: Configuring Moodle web services
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置Moodle Web服务
- en: Enabling web services for external systems
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为外部系统启用Web服务
- en: Enabling web services for users
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为用户启用Web服务
- en: We will not cover any programming aspects of web services, as this is not an
    administrative task. You will find good documentation about the topic for users
    and developers at [docs.moodle.org/en/Web_Services](http://docs.moodle.org/en/Web_Services).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将不会涵盖Web服务的任何编程方面，因为这不是一个管理任务。您可以在[docs.moodle.org/en/Web_Services](http://docs.moodle.org/en/Web_Services)找到关于此主题针对用户和开发者的良好文档。
- en: By the end of this chapter, you will know what web services are and how they
    are configured for external systems and users.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，您将了解什么是Web服务以及它们如何为外部系统和用户进行配置。
- en: Understanding Moodle web services
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解Moodle Web服务
- en: This section will familiarize you with web services, how they work, and when
    to use them.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将使您熟悉Web服务、它们的工作原理以及何时使用它们。
- en: It has always been possible to extend Moodle via code (PHP and JavaScript).
    Due to Moodle’s open source code base, there is no limitation on what code a developer
    can modify or extend. As an administrator, this was not a satisfactory situation,
    as you have no control over what parts of Moodle are being changed as a result,
    and, equally importantly, what data is being accessed or altered.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 通过代码（PHP和JavaScript）扩展Moodle一直是可能的。由于Moodle的开源代码库，开发者可以修改或扩展的代码没有限制。作为一个管理员，这种情况并不令人满意，因为您无法控制Moodle的哪些部分正在被更改，以及，同样重要的是，哪些数据正在被访问或更改。
- en: Moodle has various APIs that provide abstract layers for certain functionalities.
    Examples are the Privacy API, Repository API, and File API. These are great for
    programmers, as they reduce the amount of code that has to be rewritten. In addition
    to these interfaces, Moodle provides us with an ever-growing number of web services.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle有各种API，为某些功能提供抽象层。例如，隐私API、存储库API和文件API。这些对于程序员来说非常好，因为它们减少了需要重写的代码量。除了这些接口之外，Moodle还为我们提供了不断增长数量的Web服务。
- en: Important note
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Web services enable other systems to perform operations inside Moodle, and vice
    versa.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Web服务使其他系统能够在Moodle内部执行操作，反之亦然。
- en: 'Why would we want this? Well, there are four scenarios we can think of:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为什么要这样做呢？好吧，我们可以想到四种场景：
- en: Other systems in your organization – for instance, the HR system – have to trigger
    specific actions in your LMS; for example, once new staff has been added to the
    system, an account must be created in Moodle, and enrolments in several courses
    should take place. Web services simplify this process greatly.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您组织中的其他系统——例如，人力资源系统——必须在您的LMS中触发特定的操作；例如，一旦新员工被添加到系统中，必须在Moodle中创建一个账户，并且应在多个课程中进行注册。Web服务极大地简化了这一过程。
- en: Certain information stored in Moodle might have to be transferred to external
    applications. Examples are course completions, grades, or issued certificates,
    which have to be recorded in a student information system. Again, web services
    are predestined for the transfer of such sensitive data.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储在Moodle中的某些信息可能需要传输到外部应用程序。例如，课程完成情况、成绩或颁发的证书，这些都需要记录在学生信息系统中。同样，Web服务对于传输此类敏感数据是事先安排好的。
- en: The Moodle app we covered in [*Chapter 11*](B18779_11.xhtml#_idTextAnchor216),
    *Enabling Mobile Learning*, uses web services internally; all communication and
    data exchange between a mobile device and the Moodle backend takes place via web
    services.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们在[*第11章*](B18779_11.xhtml#_idTextAnchor216)，“启用移动学习”中提到的Moodle应用程序内部使用Web服务；移动设备与Moodle后端之间的所有通信和数据交换都通过Web服务进行。
- en: The community hub feature requires web services, which we will cover in [*Chapter
    19*](B18779_19.xhtml#_idTextAnchor344), *Setting Up* *Moodle Networking*.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 社区中心功能需要Web服务，我们将在[*第19章*](B18779_19.xhtml#_idTextAnchor344)，“设置Moodle网络”中介绍。
- en: Why should you, as an administrator, care about web services when they have
    been designed for developers? Well, that’s the other advantage of web services.
    You can control which system can talk to your Moodle system and which features
    these systems are allowed to use. This way, you can manage who has access to your
    system and limit what they can do.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么作为管理员，你应该关心Web服务，尽管它们是为开发者设计的？好吧，这是Web服务的另一个优点。你可以控制哪些系统可以与你的Moodle系统通信，以及这些系统被允许使用哪些功能。这样，你可以管理谁可以访问你的系统，并限制他们能做什么。
- en: 'The following diagram illustrates a (very) simplistic overview of how Moodle
    interacts with external applications via web services:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表展示了Moodle通过Web服务与外部应用程序交互的（非常）简化的概述：
- en: '![Figure 18.1 – Moodle web services ](img/Figure_18.01_B18779.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![图18.1 – Moodle Web服务](img/Figure_18.01_B18779.jpg)'
- en: Figure 18.1 – Moodle web services
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图18.1 – Moodle Web服务
- en: 'Let’s go through this schema from left to right: many Moodle features are represented
    as **functions** – for example, creating a user account or enrolling a user into
    a course. A **service** is a set thereof plus the definition of which user(s)
    can access the selected functions. For instance, the Moodle app uses a built-in
    (that is, predefined) service granting all users access to Moodle. In contrast,
    a custom service might only allow access to a single dedicated account.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从左到右分析这个架构：许多Moodle功能都表示为**函数** – 例如，创建用户账户或让用户注册课程。**服务**是一组函数加上定义哪些用户可以访问所选功能。例如，Moodle应用程序使用一个内置（即预定义）的服务，授予所有用户访问Moodle的权限。相反，一个自定义服务可能只允许访问单个专用账户。
- en: Important note
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: A service is a set of functions. A service can be user-restricted, token-restricted,
    IP-restricted, or time-restricted.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 服务是一组功能。服务可以是用户受限、令牌受限、IP受限或时间受限。
- en: External applications must authenticate with Moodle through the web service
    **authentication** plugin for security. Communication from external apps can be
    unidirectional or bidirectional, which is implicitly determined by the functions
    of the service. The supported web service **protocols** are SOAP, REST, and XML-RPC.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 外部应用程序必须通过Web服务的**认证**插件与Moodle进行身份验证以确保安全。来自外部应用程序的通信可以是单向的或双向的，这隐含地由服务的功能决定。支持的Web服务**协议**包括SOAP、REST和XML-RPC。
- en: Web services return feedback on whether the calls or transactions have succeeded.
    For instance, if the creation of a user account has failed in Moodle for whatever
    reason, the HR system will be notified and can repeat the attempt after a predefined
    period. Most web services-based infrastructure requires some **middleware** to
    facilitate queueing and error handling.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Web服务返回有关调用或交易是否成功的反馈。例如，如果由于任何原因在Moodle中创建用户账户失败，人力资源系统将会收到通知，并在预定义的周期后重试。大多数基于Web服务的架构都需要一些**中间件**来促进排队和错误处理。
- en: Now that you have some basic understanding of Moodle web services, it is time
    to configure protocols, services, and functions.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你对Moodle Web服务有了基本的了解，是时候配置协议、服务和功能了。
- en: Configuring Moodle web services
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置Moodle Web服务
- en: First, you must activate web services via the **Enable web services** setting
    in **Site administration** | **General** | **Advanced features**. The setting
    is linked to the **Enable web services for mobile devices** parameter on the same
    page; the latter cannot be enabled without the former.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您必须通过**站点管理** | **常规** | **高级功能**中的**启用网络服务**设置来激活网络服务。此设置与同一页面上的**为移动设备启用网络服务**参数相关联；后者不能在没有前者的情况下启用。
- en: Important note
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Enabling web services is a potential security risk, as you grant Moodle access
    to outside users and systems. The mantra should always be “open up as few services
    and functions as possible.”
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 启用网络服务可能存在安全风险，因为您授予 Moodle 访问外部用户和系统的权限。应始终遵循“尽可能少地开放服务和功能”的原则。
- en: Second, you have to enable the **Web services authentication** plugin (**Site
    administration** | **Plugins** | **Authentication** | **Manage authentication**).
    No configuration is needed, as Moodle handles all handshake operations and communication
    internally.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，您必须启用**网络服务身份验证**插件（**站点管理** | **插件** | **身份验证** | **管理身份验证**）。不需要配置，因为 Moodle
    内部处理所有握手操作和通信。
- en: 'Moodle supports two types of external services that can connect via web services:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 支持两种可以通过网络服务连接的外部服务：
- en: '**Built-in services**: These are preconfigured services where the set of supported
    functions cannot be modified. The **Moodle mobile web service** is part of Moodle
    and lets users of the app interact with Moodle. We covered the app’s configuration
    in [*Chapter 11*](B18779_11.xhtml#_idTextAnchor216), *Enabling Mobile Learning*.
    Third-party plugins might add further entries to the list of built-in services.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内置服务**：这些是预先配置的服务，其中支持的函数集不能修改。**Moodle 移动网络服务**是 Moodle 的一部分，允许应用程序用户与 Moodle
    交互。我们在[*第 11 章*](B18779_11.xhtml#_idTextAnchor216)，“启用移动学习”中介绍了应用程序的配置。第三方插件可能会向内置服务列表中添加更多条目。'
- en: '**Custom services**: These are user-defined services where you configure which
    functions can be utilized. We will focus on custom services in this chapter, allowing
    two types of entities to access Moodle: external systems and users as clients
    with tokens.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自定义服务**：这些是由用户定义的服务，您可以在其中配置哪些功能可以被利用。在本章中，我们将重点关注自定义服务，允许两种类型的实体访问 Moodle：外部系统和作为客户端的带有令牌的用户。'
- en: 'When you navigate to `mod_attendance` plugin in our system, which installs
    a built-in service alongside the mentioned mobile web service. We have also created
    two custom services, one for testing purposes (which is disabled) and one to connect
    to our HR system, as shown in the following screenshot:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当您导航到我们系统中的 `mod_attendance` 插件时，该插件会在提到的移动网络服务旁边安装一个内置服务。我们还创建了两个自定义服务，一个用于测试目的（已禁用）和一个用于连接到我们的
    HR 系统，如下面的截图所示：
- en: '![Figure 18.2 – Built-in and custom web services ](img/Figure_18.02_B18779.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.2 – 内置和自定义网络服务](img/Figure_18.02_B18779.jpg)'
- en: Figure 18.2 – Built-in and custom web services
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18.2 – 内置和自定义网络服务
- en: 'To configure web services, it is best to go to **Site administration** | **Server**
    | **Web services** | **Overview**, which acts as a dashboard for setting up Moodle
    web services. Two checklists are shown, one to **Allow an external system to control
    Moodle** (dealt with first) and one for **Users as clients with token** (seen
    shortly):'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置网络服务，最好前往**站点管理** | **服务器** | **网络服务** | **概览**，它充当设置 Moodle 网络服务的仪表板。显示了两个清单，一个用于**允许外部系统控制
    Moodle**（已处理）和一个用于**作为客户端的带有令牌的用户**（稍后介绍）：
- en: '![Figure 18.3 – Allowing an external system to control Moodle ](img/Figure_18.03_B18779.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.3 – 允许外部系统控制 Moodle](img/Figure_18.03_B18779.jpg)'
- en: Figure 18.3 – Allowing an external system to control Moodle
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18.3 – 允许外部系统控制 Moodle
- en: 'We have already enabled web services (step 1). Moodle supports three web service
    protocols – **SOAP**, **REST**, and **XML-RPC**. We won’t provide details on those
    standards; for more information, check out [docs.moodle.org/dev/Creating_a_web_service_client](http://docs.moodle.org/dev/Creating_a_web_service_client).
    At least one protocol must be enabled, which depends entirely on the external
    application, the protocols supported, and the developer’s preference. Clicking
    on the **Enabled protocols** link in the overview table when you go to **Site
    administration** | **Server** | **Web services** | **Manage protocols** will guide
    you to this screen. Enable a protocol by toggling the show/hide icon in the **Enable**
    column. Here, **SOAP** has been enabled, which is common in, but not limited to,
    Microsoft-based environments, as shown in the following screenshot:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经启用了网络服务（步骤1）。Moodle支持三种网络服务协议 – **SOAP**、**REST**和**XML-RPC**。我们不会提供有关这些标准的详细信息；有关更多信息，请参阅[docs.moodle.org/dev/Creating_a_web_service_client](http://docs.moodle.org/dev/Creating_a_web_service_client)。至少必须启用一个协议，这完全取决于外部应用程序、支持的协议和开发者的偏好。当您访问**站点管理**
    | **服务器** | **网络服务** | **管理协议**时，点击**启用协议**链接将引导您到该屏幕。通过切换**启用**列中的显示/隐藏图标来启用协议。在此，**SOAP**已被启用，这在基于Microsoft的环境中很常见，但不仅限于这些环境，如下面的截图所示：
- en: '![Figure 18.4 – Protocols for web services ](img/Figure_18.04_B18779.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图18.4 – 网络服务协议](img/Figure_18.04_B18779.jpg)'
- en: Figure 18.4 – Protocols for web services
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图18.4 – 网络服务协议
- en: Technically, it is possible that more web service protocols will be added in
    the future, for example, a Java- and .Net-compatible WSDL, but to date, this has
    not happened.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 从技术上讲，将来可能还会添加更多的网络服务协议，例如，与Java和.Net兼容的WSDL，但到目前为止，这还没有发生。
- en: Important note
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Depending on the protocol chosen, you might have to install the respective PHP
    extension – for example, `php-soap`.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 根据选择的协议，您可能需要安装相应的PHP扩展 – 例如，`php-soap`。
- en: Now that we have enabled web services and at least one protocol, let’s cover
    the configuration of the two types of web service accesses.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经启用了网络服务并且至少启用了一个协议，让我们来介绍两种类型网络服务访问的配置。
- en: Enabling web services for external systems
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为外部系统启用网络服务
- en: 'An external system is an application that accesses Moodle and its data in one
    way or another. Eight steps have to be performed to complete the setup, which
    follows the workflow described on the web services overview screen:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 外部系统是指以某种方式访问Moodle及其数据的程序。要完成设置，需要进行八个步骤，这些步骤遵循网络服务概述屏幕上描述的工作流程：
- en: '**Create a** **specific user**'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建** **特定用户**'
- en: Each application should have a separate user account. This way, you can control
    the capabilities each external system will use. Our user is aptly called *webservice*.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 每个应用程序都应该有一个单独的用户账户。这样，您可以控制每个外部系统将使用的功能。我们的用户被称为*webservice*。
- en: '**Check** **user capability**'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**检查** **用户能力**'
- en: Depending on the protocol you’ve selected, you must allow specific permissions
    for the user. You achieve this by creating a new role with any of the three capabilities,
    `webservice/rest:use`, `webservice/soap:use`, or `webservice/xmlrpc:use`.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您选择的协议，您必须为用户允许特定的权限。您可以通过创建一个具有以下三种能力之一的新角色来实现这一点，即`webservice/rest:use`、`webservice/soap:use`或`webservice/xmlrpc:use`。
- en: This role has to be assigned to the web service user(s) in the **System** context.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 此角色必须在**系统**上下文中分配给网络服务用户。
- en: '**Select** **a service**'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**选择** **服务**'
- en: 'A service is a defined interface that an external application can connect to,
    represented by a set of functions (see step 4). Selecting a service takes place
    at **Site administration** | **Server** | **Web services** | **External service**.
    You have to add a custom service:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 服务是一个定义的接口，外部应用程序可以连接到它，由一系列功能表示（见步骤4）。选择服务发生在**站点管理** | **服务器** | **网络服务**
    | **外部服务**。您必须添加一个自定义服务：
- en: '![Figure 18.5 – Web services: adding a custom service ](img/Figure_18.05_B18779.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![图18.5 – 网络服务：添加自定义服务](img/Figure_18.05_B18779.jpg)'
- en: 'Figure 18.5 – Web services: adding a custom service'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 图18.5 – 网络服务：添加自定义服务
- en: Each external service must have a given **Name** and a unique **Short name**
    and should be **Enabled** once configured. A service has to be accessed via a
    token. The **Authorized users only** setting restricts this access to selected
    users. All users with the token permission can access the service if it remains
    unchecked.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 每个外部服务都必须有一个给定的**名称**和唯一的**短名称**，一旦配置后应**启用**。服务必须通过令牌访问。**仅授权用户**设置将此访问限制为选定的用户。如果未选中，则具有令牌权限的所有用户都可以访问该服务。
- en: You can also specify download and upload permission for the web service with
    **Can download files** or **Can upload files**. In our HR role, this would be
    useful if you also managed profile pictures via web services. You can further
    restrict access by specifying the required capabilities that users need to have.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用**可以下载文件**或**可以上传文件**来指定Web服务的下载和上传权限。在我们的HR角色中，如果您还通过Web服务管理个人资料图片，这将很有用。您可以通过指定用户需要的必要能力来进一步限制访问。
- en: Once you have saved the service, select the **Add functions** link shown.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 保存服务后，选择显示的**添加功能**链接。
- en: '**Add functions**'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**添加功能**'
- en: 'At the time of writing, Moodle provides almost 700(!) functions that can be
    accessed via web services, and even more in Moodle Workplace. The function(s)
    selected depend(s) on what tasks the external system has to perform and should
    be set up in liaison with the developer in charge. Since we are connecting to
    an HR system, we will allow the following user-related functions:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本文时，Moodle提供了几乎700个(!)可以通过Web服务访问的功能，在Moodle Workplace中则更多。选择的功能取决于外部系统必须执行的任务，并且应与负责的开发人员协商设置。由于我们正在连接到HR系统，我们将允许以下与用户相关的功能：
- en: '![Figure 18.6 – Web services – adding functions ](img/Figure_18.06_B18779.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![图18.6 – Web服务 – 添加功能](img/Figure_18.06_B18779.jpg)'
- en: Figure 18.6 – Web services – adding functions
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图18.6 – Web服务 – 添加功能
- en: Once you have added the selected functions, you will be shown the required capabilities
    that a user must have to access the service. Ensure these have been allowed in
    the role assigned to the web services user.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦添加了选定的功能，系统将显示用户必须具备的访问服务的必要能力。请确保这些能力已在分配给Web服务用户的角色中允许。
- en: '**Select a** **specific user**'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**选择特定用户**'
- en: 'If you selected **Authorized users only** when creating the preceding service,
    you must select this user(s), which takes place at **Site administration** | **Server**
    | **Web services** | **External services**, where you see a list of all the services
    that have been set up. Select the **Authorized users** link, which will guide
    you to the familiar user selection screen. Select the web services user you created
    in step 1:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在创建前面的服务时选择了**仅授权用户**，则必须选择此用户（们），这发生在**网站管理** | **服务器** | **Web服务** | **外部服务**，在那里您可以看到已设置的所有服务的列表。选择**授权用户**链接，它将引导您到熟悉的用户选择屏幕。选择在步骤1中创建的Web服务用户：
- en: '![Figure 18.7 – Web services – selecting users ](img/Figure_18.07_B18779.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![图18.7 – Web服务 – 选择用户](img/Figure_18.07_B18779.jpg)'
- en: Figure 18.7 – Web services – selecting users
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图18.7 – Web服务 – 选择用户
- en: Moodle will check whether the account has sufficient permissions to access the
    selected functions. If any capabilities are missing, they will be displayed under
    the user selection screen in the **Change settings for the authorized users**
    section. Ensure that you add the listed capabilities to your web service’s permissions.
    Clicking on a username will allow you to restrict access to an IP address and
    set an expiry date.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle将检查账户是否有足够的权限访问选定的功能。如果缺少任何能力，它们将在**更改授权用户设置**部分的用户选择屏幕下显示。请确保将列出的能力添加到您的Web服务的权限中。点击用户名将允许您限制对IP地址的访问并设置过期日期。
- en: '**Create a token for** **a user**'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**为用户创建令牌**'
- en: 'Web services use tokens for security. These are created for each user and can
    be added by going to **Site administration** | **Server** | **Web services** |
    **Manage tokens**. To add a token, select a user (or multiple users), select the
    service to be accessed, and optionally specify an IP address (or range) and an
    expiry date, as shown in the following screenshot:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: Web服务使用令牌进行安全保护。这些令牌为每个用户创建，可以通过访问**网站管理** | **服务器** | **Web服务** | **管理令牌**来添加。要添加令牌，选择一个用户（或多个用户），选择要访问的服务，并可选地指定IP地址（或范围）和过期日期，如以下截图所示：
- en: '![Figure 18.8 – Web services – creating a token ](img/Figure_18.08_B18779.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![图18.8 – Web服务 – 创建令牌](img/Figure_18.08_B18779.jpg)'
- en: Figure 18.8 – Web services – creating a token
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图18.8 – Web服务 – 创建令牌
- en: Users can access and reset their web services token by going to `moodle/webservice:createtoken`
    capability.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可以通过访问 `moodle/webservice:createtoken` 功能来访问和重置他们的网络服务令牌。
- en: '**Enable developer** **documentation (optional)**'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**启用开发者文档（可选）**'
- en: 'Moodle can be instructed to generate documentation for developers for the selected
    functions in the selected protocol format. When you set up the protocols (**Site
    administration** | **Server** | **Web services** | **Manage protocols**), you
    must tick the **Web services documentation** option. Developers can view the documentation
    as part of their security keys:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 可以被指示为所选协议格式中的所选功能生成开发者的文档。当您设置协议（**网站管理** | **服务器** | **网络服务** | **管理协议**）时，您必须勾选
    **网络服务文档** 选项。开发者可以将其作为其安全密钥的一部分查看文档：
- en: '![Figure 18.9 – Web services – security keys and API documentation ](img/Figure_18.09_B18779.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.9 – 网络服务 – 安全密钥和 API 文档](img/Figure_18.09_B18779.jpg)'
- en: Figure 18.9 – Web services – security keys and API documentation
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18.9 – 网络服务 – 安全密钥和 API 文档
- en: '**Test** **the service**'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**测试服务**'
- en: 'Once a web service is set up, functions have been selected, and users have
    been assigned, it is imperative that you test the service to ensure that it works
    and, more importantly, that the external system has only opened up the required
    functionality. Web services are tested by navigating to **Site administration**
    | **Development** | **Web service test client**. Unfortunately, the test client
    only supports some hardcoded functions, not those you have configured. I quote
    from the Moodle Docs at [docs.moodle.org/en/Web_services_test_client](http://docs.moodle.org/en/Web_services_test_client):
    “*The test client is not clever! It lets you choose disabled/unavailable functions
    (however it behaves well and produces an error in these case). This is normal
    because clients are going to be bad sometimes so we needed to simulate a* *bad
    client!*”'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦设置了网络服务，选择了功能，并分配了用户，您必须测试该服务以确保它正常工作，更重要的是，外部系统只开放了所需的功能。网络服务通过导航到 **网站管理**
    | **开发** | **网络服务测试客户端** 来测试。不幸的是，测试客户端仅支持一些硬编码的功能，而不是您配置的功能。我从 Moodle 文档中引用：“*测试客户端并不聪明！它允许您选择禁用/不可用的功能（尽管它在这些情况下表现良好并产生错误）。这是正常的，因为客户端有时可能会出错，因此我们需要模拟一个*
    *糟糕的客户端!*””
- en: Important note
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Be careful with executing functions via the test client, as they perform them
    as though they are executed for real!
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在通过测试客户端执行函数时要小心，因为它们会像执行真实操作一样执行它们！
- en: 'First, you have to select the `moodle/category:manage` permission to your web
    service role for this to work):'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您必须选择将 `moodle/category:manage` 权限分配给您的网络服务角色，以便此功能生效）：
- en: '![Figure 18.10 – Web services testing ](img/Figure_18.10_B18779.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.10 – 网络服务测试](img/Figure_18.10_B18779.jpg)'
- en: Figure 18.10 – Web services testing
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18.10 – 网络服务测试
- en: 'Once you have filled in the required values and executed the command, you will
    see a return value in the XML format. If you press the **Execute** button, your
    database will be modified, and changes cannot be reverted without manual intervention
    at the database level. It is also a good practice to try out some functions the
    web service should not be able to access:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您填写了所需的值并执行了命令，您将看到以 XML 格式返回的值。如果您按下 **执行** 按钮，您的数据库将被修改，并且没有手动干预数据库级别，则无法撤销更改。同时，尝试一些网络服务不应能够访问的功能也是一个好习惯：
- en: '![Figure 18.11 – Web services testing ](img/Figure_18.11_B18779.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.11 – 网络服务测试](img/Figure_18.11_B18779.jpg)'
- en: Figure 18.11 – Web services testing
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18.11 – 网络服务测试
- en: To receive a more meaningful message, change the **Debug messages** setting
    by going to **Site administration** | **Development** | **Debugging** and then
    to **DEVELOPER**. If the result shown contains a line containing a DEBUGINFO element,
    an error has occurred. Otherwise, you should check that the function performed
    what it was supposed to when executed. We executed the operation twice; the first
    run was successful – that is, the category was created. The second run wasn’t
    because the category already existed.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 要接收更有意义的信息，请通过访问 **网站管理** | **开发** | **调试** 然后转到 **开发者** 来更改 **调试消息** 设置。如果显示的结果包含包含
    DEBUGINFO 元素的行，则表示发生了错误。否则，您应该检查在执行时函数是否完成了它应该完成的操作。我们执行了两次操作；第一次运行成功——也就是说，创建了类别。第二次运行失败是因为该类别已经存在。
- en: Now that we have covered how to configure web services for external applications,
    let us briefly look at its little brother – enabling token-based access for users.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经介绍了如何为外部应用程序配置网络服务，让我们简要地看看它的“小兄弟”——为用户启用基于令牌的访问。
- en: Enabling web services for users
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用用户网络服务
- en: 'It is sometimes necessary for users to have to access web services directly
    instead of applications – for example, a developer who needs to execute test runs
    against the system. The process is a subset of steps already covered in the previous
    section and follows the **Users as clients with token** section on the web services
    overview screen:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 有时用户需要直接访问网络服务而不是应用程序，例如，需要针对系统执行测试运行的开发者。这个过程是前一部分已涵盖的步骤的子集，并遵循网络服务概述屏幕上的**以令牌为客户端的用户**部分：
- en: '![Figure 18.12 – Web services for users as clients with tokens ](img/Figure_18.12_B18779.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![图 18.12 – 以令牌为客户端的用户网络服务](img/Figure_18.12_B18779.jpg)'
- en: Figure 18.12 – Web services for users as clients with tokens
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18.12 – 以令牌为客户端的用户网络服务
- en: These steps should be familiar by now; there are only two minor deviations from
    the previous scenario when web services were allowed for external systems instead
    of users.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 这些步骤现在应该很熟悉了；当允许外部系统而不是用户使用网络服务时，与之前的场景相比，只有两个小的偏差。
- en: In step 3, the `moodle/webservice:createtoken` capability set to allowed (see
    step 5).
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在步骤 3 中，将 `moodle/webservice:createtoken` 功能设置为允许（见步骤 5）。
- en: To test the service (see step 6), log in as the user, obtain a security token
    for testing, and avoid using the simple authentication method in the web service
    test client.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 要测试服务（见步骤 6），以用户身份登录，获取测试用的安全令牌，并避免在 Web 服务测试客户端中使用简单的身份验证方法。
- en: Summary
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'In this chapter, you learned the basics about web services and how they are
    configured from within Moodle. We covered the two main administrative tasks: setting
    up web services for external applications and enabling token-based web services
    for users.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了关于网络服务及其如何在 Moodle 内部配置的基本知识。我们涵盖了两个主要的管理任务：为外部应用程序设置网络服务和为用户启用基于令牌的网络服务。
- en: All the processes covered in this chapter are identical in Moodle and Moodle
    Workplace; the only difference is that Moodle Workplace supports significantly
    more web service functions.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖的所有过程在 Moodle 和 Moodle Workplace 中都是相同的；唯一的区别是 Moodle Workplace 支持更多的网络服务功能。
- en: In the following chapter, we will cover another option for Moodle to communicate
    with other systems, namely via Moodle networking.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍 Moodle 与其他系统通信的另一种选项，即通过 Moodle 网络。
