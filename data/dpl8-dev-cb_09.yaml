- en: Configuration Management - Deploying in Drupal 8
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置管理 - 在Drupal 8中部署
- en: 'In this chapter, we will explore the configuration management system and deployment
    of the configuration changes. The following is a list of the recipes covered in
    this chapter:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨配置管理系统和配置更改的部署。以下是在本章中涵盖的食谱列表：
- en: Importing and exporting configurations
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入和导出配置
- en: Synchronizing site configurations
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同步站点配置
- en: Using command-line workflow processes
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用命令行工作流程过程
- en: Updating and installing new module configurations
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新和安装新的模块配置
- en: Introduction
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: Drupal 8 provides a new, unified system to manage configurations. In Drupal
    8, all configurations are saved in configuration entities that match a defined
    configuration schema. This system provides a standard way of deploying the configuration
    between Drupal site environments and updating the site configuration.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal 8提供了一个新的、统一的系统来管理配置。在Drupal 8中，所有配置都保存在与定义的配置模式相匹配的配置实体中。这个系统提供了一个在Drupal站点环境之间部署配置和更新站点配置的标准方式。
- en: Once the configuration is created, or imported, it goes into an immutable state.
    If a module tries to install the configuration that exists, it will throw an exception
    and be prevented. Outside the typical user interface, the configuration can only
    be modified through the configuration management system.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦配置被创建或导入，它就会进入一个不可变状态。如果一个模块尝试安装已存在的配置，它将抛出异常并被阻止。在典型用户界面之外，配置只能通过配置管理系统进行修改。
- en: The configuration management system can be manipulated through a user interface
    provided by the Configuration management module or through the command-line interface
    tools. These tools allow you to follow the development paradigm of utilizing a
    production site and a development site, where changes are made to the development
    site and then pushed to production.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 配置管理系统可以通过配置管理模块提供的用户界面或通过命令行界面工具进行操作。这些工具允许你遵循使用生产站点和开发站点的开发范例，其中更改是在开发站点上进行的，然后推送到生产环境。
- en: Instead of creating two different Drupal sites for the recipes in this chapter,
    you can utilize the Drupal multisite functionality. For more information on this
    functionality, refer to the *Installing Drupal* recipe of [*Chapter 1*](f6d2ba3b-f85a-45e4-ac1d-35b6fba84240.xhtml),
    *Up and Running with Drupal 8*. Note that if you use a multisite, you will need
    to clone your development site's database into the site acting as your production
    site to replicate a realistic development and production site workflow.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，对于食谱的示例，你不需要创建两个不同的Drupal站点，而是可以利用Drupal的多站点功能。有关此功能的更多信息，请参阅[*第1章*](f6d2ba3b-f85a-45e4-ac1d-35b6fba84240.xhtml)的“安装Drupal”食谱，“使用Drupal
    8启动”。请注意，如果你使用多站点，你需要将你的开发站点的数据库克隆到作为生产站点的站点中，以复制一个真实的发展和生产站点工作流程。
- en: Importing and exporting configurations
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导入和导出配置
- en: Configuration management in Drupal 8 provides a solution to common problems
    when working with a website across multiple environments. No matter what the workflow
    pattern is, at some point, the configuration needs to move from one place to another,
    such as from production to a local environment. When pushing the development work
    to production, you will need to have some way to put the configuration in place.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal 8中的配置管理为在多个环境中与网站工作时的常见问题提供了一个解决方案。无论工作流程模式是什么，配置最终都需要从一个地方移动到另一个地方，例如从生产环境到本地环境。当将开发工作推送到生产环境时，你需要有一种方法来放置配置。
- en: Drupal 8's user interface provides a way to import and export configuration
    entities via the YAML format. In this recipe, we will create a content type, export
    its configuration, and then import it into another Drupal site. The configuration
    YAML export will be imported into the production site to update its configuration.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal 8的用户界面提供了一种通过YAML格式导入和导出配置实体的方式。在本食谱中，我们将创建一个内容类型，导出其配置，然后将其导入到另一个Drupal站点。配置YAML导出将被导入到生产站点以更新其配置。
- en: Getting ready
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need a base Drupal site to act as the development site. Another Drupal
    site, which is a clone of the development site, must be available to act as a
    production Drupal site.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要一个作为开发站点的基Drupal站点。另一个Drupal站点，它是开发站点的克隆，必须可用，作为生产Drupal站点。
- en: How to do it...
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: To get started, create a new content type on the development site. Name the
    content type Staff Page and click on Save and manage fields to save the content
    type. We will not add any additional fields.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要开始，在开发站点上创建一个新的内容类型。将内容类型命名为Staff Page，然后点击保存和管理字段以保存内容类型。我们不会添加任何额外的字段。
- en: 'Once the content type has been saved, go to Extend and install the Configuration
    Manager module if it is not installed:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦内容类型已保存，前往扩展并安装配置管理模块（如果尚未安装）：
- en: '![](img/7d671b26-086e-4e28-a491-73b2a1df0286.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/7d671b26-086e-4e28-a491-73b2a1df0286.png)'
- en: 'From your Drupal site''s Configuration page, go to Configuration synchronization
    under the Development group. This section allows you to import and export configuration:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从您的Drupal站点的配置页面，前往开发组下的配置同步。此部分允许您导入和导出配置：
- en: '![](img/e1e449e4-ceee-4f67-a0ce-812e83233930.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/e1e449e4-ceee-4f67-a0ce-812e83233930.png)'
- en: 'Click on the Export tab at the top of the page. The default page will be for
    a Full archive export, that contains the configuration of your entire Drupal site.
    Click on the Single item subtab to export a single configuration entity instead:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在页面顶部点击导出标签页。默认页面将是一个完整存档导出，包含您整个Drupal站点的配置。点击单项子标签以导出单个配置实体：
- en: '![](img/2b7aa73c-96b9-4eaa-b41d-1003ecd8fa6d.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/2b7aa73c-96b9-4eaa-b41d-1003ecd8fa6d.png)'
- en: Select Content type from the Configuration type drop-down menu. Then, choose
    your content type from the Configuration name drop-down menu. Its configuration
    will populate the configuration textbox:![](img/42db8f86-f372-40f2-9407-a58e60716932.png)
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从配置类型下拉菜单中选择内容类型。然后，从配置名称下拉菜单中选择您的内容类型。其配置将填充到配置文本框中：![图片](img/42db8f86-f372-40f2-9407-a58e60716932.png)
- en: Copy the YAML content from the textbox so that you can import it into your other
    Drupal site.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从文本框中复制YAML内容，以便您可以将其导入到您的其他Drupal站点。
- en: On your production Drupal site, install the Configuration management module
    just as you did for the development site, if it is not yet installed.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的生产Drupal站点上，如果尚未安装，请像开发站点一样安装配置管理模块。
- en: Go to the Configuration synchronization page and click on the Import tab.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往配置同步页面，点击导入标签页。
- en: 'Click on Single item and select Content type from the Configuration type:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击单项，从配置类型中选择内容类型：
- en: '![](img/35efbe19-9f7c-4dbf-bd01-989403a63684.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/35efbe19-9f7c-4dbf-bd01-989403a63684.png)'
- en: Paste your exported configuration YAML into the textbox and click on Import:![](img/de177b4e-7b8a-4a3c-8a41-81ef161d3245.png)
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将导出的配置YAML粘贴到文本框中，然后点击导入：![图片](img/de177b4e-7b8a-4a3c-8a41-81ef161d3245.png)
- en: Click on Confirm on the confirmation form to finalize your import to the production
    Drupal site for your custom content type.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在确认表单上点击确认，以最终将您的自定义内容类型的导入到生产Drupal站点。
- en: Go to the Structure page and then to the Content Types page to verify that your
    content type has been imported.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往结构页面，然后是内容类型页面，以验证您的内容类型是否已导入。
- en: How it works...
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何工作...
- en: At the most basic level, configurations are just a mapping of keys and values,
    which can be represented as a PHP array and translated into the YAML format.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在最基本层面上，配置只是键和值的映射，这可以表示为一个PHP数组，并转换为YAML格式。
- en: Configuration management uses schema definitions for configuration entities.
    The schema definition provides a configuration namespace and the available keys
    and data types. The schema definition provides a typed data definition for each
    option that allows validation of the individual values and configuration.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 配置管理使用配置实体的模式定义。模式定义提供了一个配置命名空间和可用的键和数据类型。模式定义为每个选项提供了类型化的数据定义，允许验证单个值和配置。
- en: The export process reads the configuration data and translates it into the YAML
    format. The configuration manager then receives the configuration in the form
    of YAML and converts it back to a PHP array. The data is then updated in the database.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 导出过程读取配置数据并将其转换为YAML格式。配置管理器随后以YAML的形式接收配置并将其转换回PHP数组。然后，数据在数据库中更新。
- en: When importing the configuration, Drupal checks the value of the configuration
    YAML's `uuid` key, if present, against any current configuration with the same
    **Universally Unique Identifier** (**UUID**). A UUID is a pattern used in software
    to provide a method of identifying an object across different environments. This
    allows Drupal to correlate a piece of data from its UUID since the database identifier
    can differ across environments. If the configuration item has a matching machine
    name, but a mismatching UUID, an error will be thrown.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在导入配置时，Drupal会检查配置YAML的`uuid`键的值，如果存在，则与任何具有相同**通用唯一标识符**（**UUID**）的当前配置进行比较。UUID是在软件中用于在不同环境中识别对象的模式。这允许Drupal根据UUID关联数据，因为数据库标识符可能在不同环境中有所不同。如果配置项具有匹配的机器名称，但UUID不匹配，则会抛出错误。
- en: There's more...
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: We will discuss importing and exporting configuration within your Drupal site
    more in depth in a later section.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在稍后的章节中更深入地讨论在Drupal站点内导入和导出配置。
- en: Configuration dependencies
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置依赖项
- en: Configuration entities define dependencies when they are exported. The dependency
    definitions ensure that the configuration entity's schema and other module functionalities
    are available.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 配置实体在导出时定义依赖项。依赖定义确保配置实体的架构和其他模块功能可用。
- en: 'When you review the configuration export for `field.storage.node.body.yml`,
    it defines `node` and `text` as `dependencies`:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 当你审查`field.storage.node.body.yml`的配置导出时，它将`node`和`text`定义为`dependencies`：
- en: '[PRE0]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: If the `node` or `text` module is not enabled, the import will fail and throw
    an error.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`node`或`text`模块未启用，导入将失败并抛出错误。
- en: Saving to a YAML file for a module's configuration installation
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将模块配置安装保存到YAML文件
- en: The *Providing configuration on install or update* recipe of [*Chapter 6*](18026cd1-b8f0-48c0-9626-568ffd225eb5.xhtml),
    *Creating Forms with the Form API*, discusses how to use a module to provide configurations
    on the module's installation. Instead of manually writing configuration `YAML`
    files for installation, the `Configuration management` module can be used to export
    configurations and save them in your module's `config/install` directory.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第6章*](18026cd1-b8f0-48c0-9626-568ffd225eb5.xhtml)中的“在安装或更新时提供配置”配方，*使用表单API创建表单*，讨论了如何使用模块在模块安装时提供配置。而不是手动编写安装配置`YAML`文件，可以使用`配置管理`模块来导出配置并将其保存到模块的`config/install`目录中。'
- en: Any item exported through the user interface can be used. The only requirement
    is that you will need to remove the `uuid` key, as it denotes the site's UUID
    value and invalidates the configuration when it tries to install it.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 通过用户界面导出的任何项目都可以使用。唯一的要求是您需要删除`uuid`键，因为它表示站点的UUID值，并在尝试安装时使配置无效。
- en: Configuration schemas
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置架构
- en: The configuration management system in Drupal 8 utilizes the configuration schema
    to describe configurations that can exist. Why is this important? It allows Drupal
    to properly implement typed data on stored configuration values and validate them,
    providing a standardized way of handling configurations for translation and configuration
    items.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal 8中的配置管理系统利用配置架构来描述可以存在的配置。这为什么很重要？它允许Drupal在存储的配置值上正确实现类型数据并对其进行验证，为处理配置和配置项提供了一种标准化的方式。
- en: When a module uses the configuration system to store data, it needs to provide
    a schema for each configuration definition it wishes to store. The schema definition
    is used to validate and provide typed data definitions for its values.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个模块使用配置系统来存储数据时，它需要为它希望存储的每个配置定义提供一个架构。架构定义用于验证其值的类型数据定义。
- en: 'The following code defines the configuration schema for the `navbar_awesome`
    module, which holds two different Boolean configuration values:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码定义了`navbar_awesome`模块的配置架构，该模块包含两个不同的布尔配置值：
- en: '[PRE1]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This defines the `navbar_awesome.toolbar` configuration namespace; it belongs
    to the `navbar_awesome` module and has the `toolbar` configuration. We will then
    need two `cdn` and `roboto` subvalues that represent typed data values. A configuration
    YAML for this schema will be named `navbar_awesome.toolbar.yml` after the namespace,
    and it contains the following code:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了`navbar_awesome.toolbar`配置命名空间；它属于`navbar_awesome`模块，并具有`toolbar`配置。然后我们需要两个表示类型数据值的`cdn`和`roboto`子值。该架构的配置YAML文件将在命名空间之后命名为`navbar_awesome.toolbar.yml`，并包含以下代码：
- en: '[PRE2]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In turn, this is what the values will look like when represented as a PHP array:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 反过来，当这些值以PHP数组表示时，它们将看起来像这样：
- en: '[PRE3]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The configuration factory classes then provide an object-based wrapper around
    these configuration definitions and provide validation of their values against
    the schema. For instance, if you try to save the `cdn` value as a string, a validation
    exception will be thrown.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 配置工厂类随后提供基于对象的包装器，围绕这些配置定义，并提供对其值的模式验证。例如，如果您尝试将`cdn`值保存为字符串，将抛出一个验证异常。
- en: See also
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参见
- en: Refer to [*Chapter 4*](a634af62-2148-4382-9121-b8500df169ed.xhtml), *Extending
    Drupal*
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅[*第4章*](a634af62-2148-4382-9121-b8500df169ed.xhtml)，*扩展Drupal*
- en: Configuration schema/metadata in the Drupal.org community handbook at [https://www.drupal.org/node/1905070](https://www.drupal.org/node/1905070)
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Drupal.org社区手册中的配置架构/元数据，请参阅[https://www.drupal.org/node/1905070](https://www.drupal.org/node/1905070)
- en: Synchronizing site configurations
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 同步站点配置
- en: A key component for managing a Drupal website is configuration integrity. A
    key part of maintaining this integrity is ensuring that your configuration changes
    made in development are pushed upstream to your production environments. Maintaining
    configuration changes by manually exporting and importing through the user interface
    can be tedious and does not provide a way to track what has or has not been exported
    or imported. At the same time, manually writing module hooks to manipulate the
    configuration can be time-consuming. Luckily, the configuration management solution
    provides you with the ability to export and import the entire site's configuration.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 管理Drupal网站的一个关键组件是配置完整性。维护这种完整性的一个关键部分是确保您在开发中做出的配置更改被推送到生产环境。通过用户界面手动导出和导入配置更改可能很繁琐，并且无法跟踪已导出或导入的内容。同时，手动编写模块钩子来操作配置可能很耗时。幸运的是，配置管理解决方案为您提供了导出和导入整个站点配置的能力。
- en: A site export can only be imported into another copy of itself. Each site must
    have the same UUID, which is set during its installation. This allows you to export
    your local development environment's configuration and bring it to staging or
    production, without modifying the content or the database directly.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 站点导出只能导入到其自身的另一个副本。每个站点都必须有相同的UUID，这是在安装期间设置的。这允许您导出本地开发环境的配置，并将其带到预发布或生产环境，而无需直接修改内容或数据库。
- en: In this recipe, we will export the development site's complete configuration
    entities' definitions. We will then take the exported configuration and import
    it into the production site. This will simulate a typical deployment of a Drupal
    site with changes created in development that is ready to be released in production.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将导出开发站点完整配置实体定义。然后我们将导出的配置导入到生产站点。这将模拟一个典型的部署，其中在开发中创建的更改已准备好在生产中发布。
- en: Getting ready
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need a base Drupal site to act as the development site. Another Drupal
    site, which is a duplicate of the development site's database, must be available
    to act as the production Drupal site.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要一个基Drupal站点作为开发站点。另一个Drupal站点，它是开发站点数据库的副本，必须可用，作为生产Drupal站点。
- en: You will need to have the **Configuration management** module installed if it
    is not already.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如果尚未安装，您需要安装**配置管理**模块。
- en: How to do it...
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Go to the development site. Modify the site to simulate creating changes that
    need to be deployed to our other Drupal site.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往开发站点。修改站点以模拟创建需要部署到我们的其他Drupal站点的更改。
- en: For example, let's modify the site's name; go to the Configuration page and
    the Basic site settings form.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 例如，让我们修改站点的名称；转到配置页面和基本站点设置表单。
- en: From the Configuration page, go to Configuration synchronization.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从配置页面，转到配置同步。
- en: 'Navigate to the Export tab; we will land on the Full archive page. Click on
    the Export button to begin the export and download process:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到导出标签页；我们将到达完整存档页面。点击导出按钮开始导出和下载过程：
- en: '![](img/54f7e627-f89d-4c7c-9967-267b53b33ca1.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](img/54f7e627-f89d-4c7c-9967-267b53b33ca1.png)'
- en: Save the `gzipped` archive; this contains an archive of all the site's configuration
    as YAML.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存`gzip`存档；这包含所有站点配置的YAML存档。
- en: Navigate to your other Drupal site and then to its Configuration synchronization
    page.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到您的其他Drupal站点，然后转到其配置同步页面。
- en: Click on the Import tab and then on the Full archive tab. Use the Configuration
    archive file input, and click on Choose File to select the tarball you just downloaded.
    Click on Upload to begin the import process.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“导入”标签页，然后点击“完整存档”标签页。使用配置存档文件输入，点击“选择文件”以选择您刚刚下载的tarball。点击“上传”以开始导入过程。
- en: 'You will be taken to the Synchronize tab to review changes that need to be
    imported:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将被带到“同步”标签页以审查需要导入的更改：
- en: '![](img/956ebba6-11a0-435b-ae81-cac9ab09b7e2.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/956ebba6-11a0-435b-ae81-cac9ab09b7e2.png)'
- en: Click on Import all to update the current site's configuration to the items
    in the archive.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“导入全部”以更新当前站点的配置为存档中的项目。
- en: 'A batch operation will begin with the import process:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 批量操作将随导入过程开始：
- en: '![](img/a8216528-5e59-4476-abef-9ef5a7aefc9a.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a8216528-5e59-4476-abef-9ef5a7aefc9a.png)'
- en: How it works...
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The Configuration synchronization form provides a way to interface with the
    `config` database table for your Drupal site. When you go to the Export page and
    create the tarball, Drupal effectively dumps the contents of the `config` table.
    Each row represents a configuration entity and will become its own `YAML` file.
    The contents of the `YAML` file represent its database value.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 配置同步表单提供了一种与您的Drupal站点的`config`数据库表进行接口的方式。当您转到导出页面并创建tarball时，Drupal实际上会转储`config`表的内容。每一行代表一个配置实体，并将成为其自己的`YAML`文件。`YAML`文件的内容代表其数据库值。
- en: When you import the tarball, Drupal extracts its content. The files are placed
    in the available `CONFIG_SYNC_DIRECTORY` directory. The synchronization page parses
    the configuration entity YAML and provides a difference check against the current
    site's configuration. Each configuration item can be reviewed, and then all the
    items can be imported. You cannot choose to selectively import individual items.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 当您导入tarball时，Drupal会提取其内容。文件被放置在可用的`CONFIG_SYNC_DIRECTORY`目录中。同步页面解析配置实体YAML，并提供与当前站点配置的差异检查。每个配置项都可以进行审查，然后可以导入所有项。您不能选择选择性地导入单个项。
- en: There's more...
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更多...
- en: We will now discuss things that are required for site configuration synchronization.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将讨论站点配置同步所需的各项内容。
- en: Universally Unique Identifier
  id: totrans-87
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通用唯一标识符
- en: When a Drupal site is installed, the UUID is set. This UUID is added to the
    exported configuration entities and is represented by the `uuid` key. Drupal uses
    this key to identify the source of the configuration. Drupal will not synchronize
    configurations that do not have a matching UUID in their YAML definition.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 当Drupal站点安装时，UUID被设置。此UUID添加到导出的配置实体中，并由`uuid`键表示。Drupal使用此键来识别配置的来源。Drupal不会同步在其YAML定义中没有匹配UUID的配置。
- en: You can review the site's current UUID value by reviewing the `system.site`
    configuration object. This can also be done using the Drush or Drupal Console
    command-line tool.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过查看`system.site`配置对象来审查站点的当前UUID值。这也可以使用Drush或Drupal Console命令行工具完成。
- en: 'Using Drush, type the following command:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Drush，输入以下命令：
- en: '[PRE4]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Using Drupal Console, type the following command:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Drupal Console，输入以下命令：
- en: '[PRE5]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: A synchronization folder
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一个同步文件夹
- en: Drupal uses a synchronization folder to hold the configuration YAML files that
    are to be imported into the current site. This folder is represented by the `CONFIG_SYNC_DIRECTORY`
    constant. If you have not defined this in the global `$config_directories` variable
    in your site's `settings.php`, then it will be a randomly named directory in your
    site's file directory.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal使用一个同步文件夹来保存要导入到当前站点的配置YAML文件。此文件夹由`CONFIG_SYNC_DIRECTORY`常量表示。如果您在站点的`settings.php`全局`$config_directories`变量中未定义此变量，则它将是站点文件目录中的一个随机命名的目录。
- en: When Drupal 8 entered its beta release cycle, this folder was referenced as
    a staging folder and referenced by the `CONFIG_STAGING_DIRECTORY`. This is now
    deprecated; however, the internals of the configuration management system support
    reading `CONFIG_STAGING_DIRECTORY` as `CONFIG_SYNC_DIRECTORY`. This will be removed
    in Drupal 9.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 当Drupal 8进入其beta发布周期时，此文件夹被引用为预发布文件夹，并由`CONFIG_STAGING_DIRECTORY`引用。现在已弃用；然而，配置管理系统的内部支持将`CONFIG_STAGING_DIRECTORY`作为`CONFIG_SYNC_DIRECTORY`读取。这将在Drupal
    9中删除。
- en: The synchronization form will use the configuration management discovery service
    to look for configuration changes that need to be imported from this folder.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 同步表单将使用配置管理发现服务来查找需要从该文件夹导入的配置更改。
- en: Installing a configuration from a new site
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从新站点安装配置
- en: Drupal's configuration management system will not allow the import of configuration
    entities that originated at a different Drupal site. When a Drupal site is installed,
    the `system.site` configuration entity saves a UUID for the current site instance.
    Only cloned versions of this site's database can accept configuration imports
    from it.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal的配置管理系统不允许导入来自不同Drupal站点的配置实体。当安装Drupal站点时，`system.site`配置实体会保存当前站点实例的UUID。只有该站点数据库的克隆版本才能接受从其导入的配置。
- en: 'The configuration installer profile is a custom distribution, that will allow
    you to import the configuration despite the configuration''s site UUID. The profile
    doesn''t install itself. When you use the profile, it will provide an interface
    to upload a configuration export that will then be imported, as shown in the following
    screenshot:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 配置安装器配置文件是一个自定义发行版，它将允许您导入配置，即使配置的站点UUID不同。配置文件不会自行安装。当您使用配置文件时，它将提供一个界面来上传配置导出文件，然后将其导入，如下面的截图所示：
- en: '![](img/8936ae3c-8478-495a-910f-8f22f90b1dbd.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8936ae3c-8478-495a-910f-8f22f90b1dbd.png)'
- en: The distribution can be found at [https://www.drupal.org/project/config_installer](https://www.drupal.org/project/config_installer).
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 发行版可以在[https://www.drupal.org/project/config_installer](https://www.drupal.org/project/config_installer)找到。
- en: Using command-line workflow processes
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用命令行工作流程
- en: Drupal 8's configuration systems solve many problems encountered when exporting
    and deploying configurations in Drupal 7\. However, the task of synchronizing
    the configuration is still a user interface task and requires the manipulation
    of archive files that contain the configuration exports for a Drupal 8 site.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal 8的配置系统解决了在Drupal 7中导出和部署配置时遇到的问题。然而，同步配置的任务仍然是一个用户界面任务，需要操作包含Drupal 8站点配置导出的存档文件。
- en: Configuration management can be done on the command line through Drush, without
    requiring it to be installed. This mitigates any requirement to log in to the
    production website to import changes. It also opens the ability for more advanced
    workflows that place the configuration in version control.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 配置管理可以通过Drush在命令行上完成，无需安装。这减轻了登录到生产网站以导入更改的要求。它还打开了将配置放入版本控制的高级工作流程的能力。
- en: In this recipe, we will use Drush to export the development site's configuration
    to the filesystem. The exported configuration files will then be copied to the
    production site's configuration directory. Using Drush, the configuration will
    be imported into production to complete the deployment.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在本菜谱中，我们将使用Drush将开发站点的配置导出到文件系统。然后，将导出的配置文件复制到生产站点的配置目录。使用Drush，将配置导入生产环境以完成部署。
- en: Getting ready...
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备中...
- en: You will need a base Drupal site to act as the development site. Another Drupal
    site, which is a clone of the development site, must be available to act as the
    production Drupal site.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要一个作为开发站点的基Drupal站点。另一个Drupal站点，它是开发站点的克隆版本，必须可用以作为生产Drupal站点。
- en: This recipe uses Drush. If you have not installed Drush, instructions can be
    found at [http://docs.drush.org/en/master/install/](http://docs.drush.org/en/master/install/).
    Drush needs to be installed at the locations of both your Drupal sites.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 本菜谱使用Drush。如果您尚未安装Drush，可以在[http://docs.drush.org/en/master/install/](http://docs.drush.org/en/master/install/)找到说明。Drush需要在您的两个Drupal站点的位置安装。
- en: How to do it...
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: For the purpose of demonstration, change your development site's name to `Drush
    Config Sync Demo!`. This way, there is at least one configuration change to be
    imported to the production Drupal site.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了演示目的，将您的开发站点名称更改为`Drush Config Sync Demo!`。这样，至少有一个配置更改需要导入到生产Drupal站点。
- en: Open a command-line terminal and change your directory to the working directory
    of your development Drupal site.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开命令行终端，并将您的目录更改为开发Drupal站点的当前工作目录。
- en: Use the `drush config-export` command to export the configuration to a directory.
    The command will default to the `sync` configuration directory defined in your
    Drupal 8 site.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`drush config-export`命令将配置导出到一个目录。该命令将默认为在您的Drupal 8站点中定义的`sync`配置目录。
- en: If you have not explicitly defined a sync directory, Drupal automatically creates
    a protected folder in the current site's uploaded files' directory, with a unique
    hash suffix on the directory name.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有明确定义同步目录，Drupal会自动在当前站点的上传文件目录中创建一个受保护的文件夹，并在目录名称上添加一个唯一的哈希后缀。
- en: You will receive a message that the configuration has been exported to the directory.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将收到一条消息，表明配置已导出到目录中。
- en: Using a method of your choice, copy the contents of the configuration `sync`
    folder to your other Drupal sites that match the `configuration sync` folder.
    For example, a default folder generated by Drupal can be `sites/default/files/config_XYZ/sync`.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用你选择的方法，将配置`sync`文件夹的内容复制到其他匹配`配置同步`文件夹的Drupal站点。例如，Drupal生成的默认文件夹可以是`sites/default/files/config_XYZ/sync`。
- en: Open a command-line terminal and change your directory to your production Drupal
    site's working directory.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开命令行终端，并将你的目录更改为你的生产Drupal站点的工作目录。
- en: Use the `drush config-import` command to begin the process of importing your
    configuration.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`drush config-import`命令开始导入你的配置过程。
- en: 'Review the changes made to the configuration entity keys and enter `y` to confirm
    the changes:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查对配置实体键所做的更改，并输入`y`以确认更改：
- en: '![](img/01a99acb-4554-4cb6-be77-6443b5906d5a.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/01a99acb-4554-4cb6-be77-6443b5906d5a.png)'
- en: Check whether your configuration changes have been imported.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查你的配置更改是否已导入。
- en: How it works...
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The **Drush** command-line tool can utilize the code found in Drupal to interact
    with it. The `config-export` command replicates the functionality provided by
    the `Configuration management` module's full site export. However, you do not
    need the Configuration management module enabled for the command to work. The
    command will extract the available site configuration and write it to a directory,
    which is unarchived.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '**Drush**命令行工具可以利用Drupal中的代码与之交互。`config-export`命令复制了`配置管理`模块完整站点导出提供的功能。然而，你不需要启用配置管理模块，该命令才能工作。该命令将提取可用的站点配置并将其写入目录，该目录未存档。'
- en: The `config-import` command parses the files in a directory. It will make an
    attempt to run a difference check against the YAML files like the Configuration
    management module's synchronize overview form does. It will then import all the
    changes.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`config-import`命令会解析目录中的文件。它将尝试运行与配置管理模块的同步概览表类似的差异检查，然后导入所有更改。'
- en: There's more...
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: There are additional ways to work with the configuration management system in
    Drupal. We will explore those options in the next section.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在Drupal中，还有其他一些与配置管理系统协同工作的方法。我们将在下一节中探讨这些选项。
- en: Drush config-pull
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Drush config-pull
- en: Drush provides a way to simplify the transportation of configuration between
    sites. The `config-pull` command allows you to specify two Drupal sites and move
    the export configuration between them. You can either specify a name of a subdirectory
    under the `/sites` directory or a Drush alias.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: Drush提供了一种简化配置在不同站点之间传输的方法。`config-pull`命令允许你指定两个Drupal站点，并在它们之间移动导出配置。你可以指定`/sites`目录下的子目录名称或Drush别名。
- en: 'The following command will copy a development site''s configuration and import
    it into the staging server''s site:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令将复制开发站点的配置并将其导入到预发布服务器的站点：
- en: '[PRE6]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Additionally, you can specify the `--label` option. This represents a folder
    key in the `$config_directories` setting. The option defaults to `sync` automatically.
    Alternatively, you can use the `--destination` parameter to specify an arbitrary
    folder that is not specified in the setting of `$config_directories`.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你可以指定`--label`选项。这代表`$config_directories`设置中的一个文件夹键。该选项默认自动设置为`sync`。或者，你可以使用`--destination`参数指定一个未在`$config_directories`设置中指定的任意文件夹。
- en: Using the Drupal Console
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Drupal控制台
- en: Drush has been part of the Drupal community since Drupal 4.7 and is a custom-built
    command-line tool. The Drupal Console is a Symfony Console-based application used
    to interact with Drupal. The Drupal Console project provides a means for configuration
    management over the command line.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: Drush自Drupal 4.7以来一直是Drupal社区的一部分，是一个自定义构建的命令行工具。Drupal控制台是一个基于Symfony控制台的应用程序，用于与Drupal交互。Drupal控制台项目提供了一种通过命令行进行配置管理的方法。
- en: You can learn more about the Drupal Console in [*Chapter 13*](099b7376-2149-4af8-9649-45445745f068.xhtml),
    *Drupal CLI* or at [http://www.drupalconsole.com/](http://www.drupalconsole.com/).
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在[*第13章*](099b7376-2149-4af8-9649-45445745f068.xhtml)，*Drupal CLI*或[http://www.drupalconsole.com/](http://www.drupalconsole.com/)了解更多关于Drupal控制台的信息。
- en: The workflow is the same, except the naming of the command. The configuration
    export command is `config:export`, and it is automatically exported to your system's
    temporary folder until a directory is passed. You can then import the configuration
    using the `config:import` command.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 工作流程相同，只是命令的命名不同。配置导出命令是 `config:export`，并且它将自动导出到你的系统临时文件夹，直到传递一个目录。然后你可以使用
    `config:import` 命令导入配置。
- en: Editing the configuration from the command line
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从命令行编辑配置
- en: 'Both Drush and Drupal Console support the ability to edit the configuration
    through the command line in YAML format. Both the tools operate in the same fashion
    and have similar command names:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Drush 和 Drupal 控制台都支持通过命令行以 YAML 格式编辑配置的能力。这两个工具以相同的方式操作，并且具有相似的命令名称：
- en: '**Drush**: `config-edit [name]`'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Drush**: `config-edit [name]`'
- en: '**Console**: `config:edit [name]`'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**控制台**: `config:edit [name]`'
- en: The difference is that Drush will list all the available options to be edited
    if you do not pass a name, while Console allows you to search.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 差异在于，如果你没有传递一个名称，Drush 将列出所有可编辑的选项，而控制台允许你进行搜索。
- en: 'When you edit a configuration item, your default terminal-based text editor
    will open. You will be presented with a `YAML` file that can be edited. Once you
    save your changes, the configuration is then saved on your Drupal site:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 当你编辑一个配置项时，你的默认基于终端的文本编辑器将打开。你将看到一个可以编辑的 `YAML` 文件。一旦你保存了更改，配置就会被保存在你的 Drupal
    网站上：
- en: '![](img/14a93d6a-e1bc-4b83-b2c6-5315555c0478.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](img/14a93d6a-e1bc-4b83-b2c6-5315555c0478.png)'
- en: Exporting a single configuration item
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导出单个配置项
- en: 'Both Drush and Console provide their own mechanisms for exporting a single
    configuration entity:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: Drush 和控制台都提供了自己的机制来导出单个配置实体：
- en: '**Drush**: `config-get [name]`'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Drush**: `config-get [name]`'
- en: '**Console**: `config:debug [name]`'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**控制台**: `config:debug [name]`'
- en: 'Drush will print the configuration''s output to the terminal, whereas Console''s
    default behavior is to write the output to the file disk. For example, the following
    commands will output the values from `system.site` in the YAML format:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: Drush 将配置的输出打印到终端，而控制台默认的行为是将输出写入文件磁盘。例如，以下命令将以 YAML 格式输出 `system.site` 的值：
- en: '[PRE7]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](img/b90942f1-1639-4071-be6a-7c6831bcef3c.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b90942f1-1639-4071-be6a-7c6831bcef3c.png)'
- en: Using version control and command-line workflow
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用版本控制和命令行工作流程
- en: A benefit of having the configuration exportable to YAML files is the fact that
    the configuration can be kept in version control. The Drupal site's `CONFIG_SYNC_DIRECTORY`
    directory can be committed to version control to ensure that it is transported
    across environments and properly updated. Deployment tools can then use Drush
    or Console to automatically import changes.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 将配置导出为 YAML 文件的好处是配置可以保持在版本控制中。Drupal 网站的 `CONFIG_SYNC_DIRECTORY` 目录可以提交到版本控制，以确保它在不同环境中传输并正确更新。部署工具随后可以使用
    Drush 或控制台自动导入更改。
- en: 'The `config-export` command provided by Drush provides the Git integration:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: Drush 提供的 `config-export` 命令提供了 Git 集成：
- en: '[PRE8]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Appending the `--add` option will run `git add -p` for an interactive staging
    of the changed configuration files:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 添加 `--add` 选项将运行 `git add -p` 以进行交互式暂存更改的配置文件：
- en: '[PRE9]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The `--commit` and optional `--message` options will stage all configuration
    file changes and commit them with your message:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '`--commit` 和可选的 `--message` 选项将暂存所有配置文件更改，并使用你的消息提交：'
- en: '[PRE10]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Finally, you can also specify `--push` to make a commit and push it to the remote
    repository.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你也可以指定 `--push` 以提交更改并将其推送到远程仓库。
- en: See also
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考信息
- en: Refer to [*Chapter 13*](099b7376-2149-4af8-9649-45445745f068.xhtml), *The Drupal
    CLI*
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅[*第 13 章*](099b7376-2149-4af8-9649-45445745f068.xhtml)，*Drupal 命令行*
- en: Refer to Drush at [http://docs.drush.org/en/master/](http://docs.drush.org/en/master/)
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅 Drush 在 [http://docs.drush.org/en/master/](http://docs.drush.org/en/master/)
- en: Refer to Drupal Console at [http://www.drupalconsole.com/](http://www.drupalconsole.com/)
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅 Drupal 控制台在 [http://www.drupalconsole.com/](http://www.drupalconsole.com/)
- en: Updating and installing new module configurations
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新和安装新的模块配置
- en: Modules in Drupal 8 provide configuration YAML files inside their `config/install`
    directory. A consequence of the site controlling configuration is that a new configuration
    in a module's `config/install` directory is not automatically installed. Module
    developers must write update functions, which will import the new configuration
    as it is added. While this is a practice contributed modules should follow, this
    process can be cumbersome for private projects.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: Drupal 8中的模块在其`config/install`目录内提供配置YAML文件。由于站点控制配置，模块的`config/install`目录中的新配置不会自动安装。模块开发者必须编写更新函数，以便在添加时导入新的配置。虽然这是贡献模块应遵循的实践，但对于私人项目来说，这个过程可能有些繁琐。
- en: Luckily, the Drupal community has come up with a solution that provides a configuration
    management flow that allows updating of a module's provided default configuration.
    The module **Configuration Update Manager** allows you to import a new configuration
    from a module or revert it to the original configuration if modified. In fact,
    the module is a dependency for the Features module discussed in [*Chapter 4*](a634af62-2148-4382-9121-b8500df169ed.xhtml),
    *Extending Drupal*.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，Drupal社区已经提出了一种解决方案，该解决方案提供了一种配置管理流程，允许更新模块提供的默认配置。**配置更新管理器**模块允许您从模块导入新的配置，或者在修改后将其还原到原始配置。实际上，该模块是讨论在[*第4章*](a634af62-2148-4382-9121-b8500df169ed.xhtml)，“扩展Drupal”中提到的功能模块的依赖项。
- en: In this recipe, we will use Configuration Update Manager to review configuration
    differences to a module and revert the modified configuration.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将使用配置更新管理器来审查模块的配置差异，并还原已修改的配置。
- en: How to do it...
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Add the Configuration Update Manager project to your Drupal installation using
    the following Composer command:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下Composer命令将配置更新管理器项目添加到您的Drupal安装中：
- en: '[PRE11]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Go to the Extend page and install the Configuration Update Reports module,
    the user interface for Configuration Update Manager:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往“扩展”页面，安装配置更新报告模块，这是配置更新管理器的用户界面：
- en: '![](img/381187b7-b0a5-4c7c-ad35-1a7192ea4995.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![](img/381187b7-b0a5-4c7c-ad35-1a7192ea4995.png)'
- en: To visit the configuration reports, go to Configuration in the toolbar under
    the Development section and click on Configuration synchronization.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要访问配置报告，请转到开发部分下的工具栏中的“配置”，然后点击“配置同步”。
- en: 'Go to the Updates Report tab. This provides an overview of configuration reports
    to generate: by configuration type, module, theme, and profile.'
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往“更新报告”选项卡。这提供了生成配置报告的概述：按配置类型、模块、主题和配置文件。
- en: Review the System module's configuration. Select the System module from the
    module's drop-down button.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查系统模块的配置。从模块的下拉按钮中选择系统模块。
- en: 'For the `system.site` row, click on the Show differences button link. This
    will review a difference report between the default configuration and the current
    site configuration:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于`system.site`行，点击“显示差异”按钮链接。这将审查默认配置和当前站点配置之间的差异报告：
- en: '![](img/dfb7febe-10d4-49f1-b61f-d328ea3b3417.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dfb7febe-10d4-49f1-b61f-d328ea3b3417.png)'
- en: Click on the Back to 'Updates report' page to go back to the main report so
    that the configuration can be reverted.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“返回到‘更新报告’页面”以返回到主报告，以便可以还原配置。
- en: 'Expand the drop-down button so that you can click on Revert to source:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开下拉按钮，以便您可以点击“还原到源”：
- en: '![](img/2934becd-eeac-465a-b36d-2040a717433a.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2934becd-eeac-465a-b36d-2040a717433a.png)'
- en: Click on Revert on the confirmation form to finish the operation.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击确认表单上的“还原”以完成操作。
- en: The configuration is now reverted to its original installation.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置已还原到原始安装状态。
- en: How it works...
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The Configuration Update Manager provides two modules: **Configuration Update
    Base** and **Configuration Update Reports**. The base module provides an underlying
    API for listing a configuration, reverting a configuration, and running difference
    checks with results. It extends Drupal core''s configuration operations. The reports
    module provides a user interface on top of the base module. The Features module
    uses the base module to provide difference review and automatic reverting of a
    configuration.'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 配置更新管理器提供两个模块：**配置更新基础**和**配置更新报告**。基础模块提供了一个底层API，用于列出配置、还原配置以及运行带有结果的差异检查。它扩展了Drupal核心的配置操作。报告模块在基础模块之上提供了一个用户界面。功能模块使用基础模块来提供差异审查和配置的自动还原。
- en: When reverting a configuration, the raw values are collected and then used to
    overwrite what currently exists in the system. The reports also allow importing
    a new configuration added to a module.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在回滚配置时，会收集原始值，然后用来覆盖系统中当前存在的配置。报告还允许导入添加到模块中的新配置。
- en: There's more...
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更多内容...
- en: There are other contributed projects and methods for handling a configuration
    within modules.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他贡献项目和方法，用于在模块中处理配置。
- en: The Configuration Development module
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置开发模块
- en: For module developers, there is the Configuration Development module. The Configuration
    Development module provides a command-line method for importing and exporting
    a configuration. This is useful for contributed module developers. It eases the
    exporting and update of a configuration intended for the `config/install` directory.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 对于模块开发者，有配置开发模块。配置开发模块提供了一种命令行方法来导入和导出配置。这对于贡献模块的开发者来说很有用。它简化了将配置导出到`config/install`目录以及更新配置的过程。
- en: 'The module looks for a `config_devel` entry in the module''s `info.yml` file.
    An example is taken from the Commerce Store submodule from Drupal Commerce module:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块在模块的`info.yml`文件中查找`config_devel`条目。以下是一个从Drupal Commerce模块的Commerce Store子模块中取出的示例：
- en: '[PRE12]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Using Drush, commands provided by the Configuration Development can then be
    used to export and import the data. The following command will export the listed
    configuration to the `config/install` directory:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Drush，可以通过配置开发提供的命令来导出和导入数据。以下命令将导出列出的配置到`config/install`目录：
- en: '[PRE13]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: See also
  id: totrans-193
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参见
- en: Refer to Configuration Update Manager project page at [https://www.drupal.org/project/config_update](https://www.drupal.org/project/config_update)
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 参考配置更新管理器项目页面，[https://www.drupal.org/project/config_update](https://www.drupal.org/project/config_update)
- en: Refer to Configuration development, a command-line based alternative at [https://www.drupal.org/project/config_devel](https://www.drupal.org/project/config_devel)
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 参考基于命令行的配置开发项目，[https://www.drupal.org/project/config_devel](https://www.drupal.org/project/config_devel)
