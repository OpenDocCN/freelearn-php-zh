- en: '15'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '15'
- en: Optimizing Moodle Performance
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化 Moodle 性能
- en: The performance of web-based systems is a critical issue, and it is the key
    responsibility of an administrator to configure, monitor, and fine-tune the LMS
    for maximum speed. While Moodle has the potential to scale to tens of thousands
    of simultaneous users, good performance management is required to guarantee adequate
    scalability.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 基于网络的系统性能是一个关键问题，管理员配置、监控和微调 LMS 以实现最大速度是关键责任。虽然 Moodle 有潜力扩展到数以万计的并发用户，但良好的性能管理是保证足够可扩展性的必要条件。
- en: 'After providing an overview of the subject, we will cover the most relevant
    topics related to Moodle’s performance and optimization:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在概述了主题之后，我们将涵盖与 Moodle 性能和优化最相关的主题：
- en: '**Optimizing Moodle feature performance**: We will look at performance issues
    in Moodle functions and Moodle activities. Optimizing their performance is often
    a trade-off between improved speed and potentially reduced functionality, which
    is discussed.'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优化 Moodle 功能性能**：我们将探讨 Moodle 函数和 Moodle 活动中的性能问题。优化它们的性能通常是在提高速度和可能减少功能之间进行权衡，这一点将在讨论中涉及。'
- en: '**Moodle Universal Cache (MUC)**: We cover the different elements of the powerful
    MUC, namely cache types, cache stores, and cache definitions. We will then run
    you through some MUC performance testing and various caching options.'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle 通用缓存 (MUC)**：我们将介绍强大的 MUC 的不同元素，即缓存类型、缓存存储和缓存定义。然后我们将向您介绍一些 MUC 性能测试和不同的缓存选项。'
- en: '**Optimizing Moodle system performance**: A range of system-related performance
    settings are dealt with, namely session handling, cron management and scheduled
    tasks, configuring global search, and setting system paths.'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优化 Moodle 系统性能**：我们将处理一系列与系统相关的性能设置，包括会话处理、cron 管理和计划任务、配置全局搜索以及设置系统路径。'
- en: We will conclude the chapter with a short Moodle performance profiling and monitoring
    section.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章的末尾简要介绍 Moodle 性能分析和监控部分。
- en: Understanding Moodle performance
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解 Moodle 性能
- en: 'Web applications in general, and Moodle in particular, have very distinct application
    layers consisting of an operating system, web server, database server, and an
    application developed in a programming language. Each layer has its idiosyncrasies
    when it comes to optimization. We will exclusively focus on the *application layer*,
    which is the focus of this book, as shown in the following diagram:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 通用网络应用程序，尤其是 Moodle，具有非常明显的应用层，包括操作系统、Web 服务器、数据库服务器以及用编程语言开发的应用程序。每一层在优化方面都有其独特之处。我们将专门关注
    *应用层*，这是本书的重点，如下图所示：
- en: '![Figure 15.1 – Moodle performance ](img/Figure_15.01_B18779.jpg)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![图 15.1 – Moodle 性能](img/Figure_15.01_B18779.jpg)'
- en: Figure 15.1 – Moodle performance
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.1 – Moodle 性能
- en: 'The following areas are *NOT* dealt with in any detail, and it is necessary
    to refer to the respective documentation with regard to performance and optimization
    issues:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 以下方面没有详细讨论，有必要参考有关性能和优化问题的相应文档：
- en: '**Operating system performance**: The choice of operating system and configuration
    will significantly impact how Moodle performs. In principle, Linux or any other
    Unix derivative performs better than any other operating system. PHP applications,
    such as Moodle, run significantly slower in a Windows environment than on Linux.
    Some aspects of this were covered in [*Chapter 1*](B18779_01.xhtml#_idTextAnchor020),
    *Installing Moodle*, when we dealt with the installation of Moodle.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作系统性能**：操作系统的选择和配置将显著影响 Moodle 的性能。原则上，Linux 或任何其他 Unix 衍生系统比任何其他操作系统表现更好。PHP
    应用程序，如 Moodle，在 Windows 环境中的运行速度比在 Linux 环境中慢得多。这方面的某些内容在 [*第 1 章*](B18779_01.xhtml#_idTextAnchor020)，*安装
    Moodle* 中有所涉及，当时我们讨论了 Moodle 的安装。'
- en: '`$CFG->dbhost` entry in `config.php` from `localhost` to the IP address of
    your database. The latter is significantly more complex and requires strong database
    administration skills.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 `config.php` 中的 `$CFG->dbhost` 条目从 `localhost` 更改为数据库的 IP 地址。后者要复杂得多，需要强大的数据库管理技能。
- en: There is also much debate about which database is best suited for Moodle. While
    the open source camp is divided between MySQL, MariaDB, and PostgreSQL, corporates
    are split between MS SQL Server and Oracle. Whichever your choice of system, a
    well-set-up and tuned database will always perform better than one used with out-of-the-box
    settings—“The best database system is the one you know.”
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 关于哪种数据库最适合Moodle的讨论也有很多。虽然开源阵营在MySQL、MariaDB和PostgreSQL之间分裂，企业则在MS SQL Server和Oracle之间分裂。无论您选择哪种系统，一个设置良好并经过调优的数据库总是比使用默认设置的数据库性能更好——“最好的数据库系统是你所了解的系统”。
- en: '**Web server performance**: Each web server (Apache, **Internet Information
    Services** (**IIS**), nginx, and so on) offers an array of optimization settings
    that include memory handling, caching, process management, and other minor tweaks.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Web服务器性能**：每个Web服务器（Apache、**互联网信息服务**（**IIS**）、nginx等）都提供了一系列优化设置，包括内存处理、缓存、进程管理和其他小调整。'
- en: '**PHP performance**: There are several ways in which PHP can be forced to execute
    code significantly faster. The key to doing this is using a PHP accelerator in
    combination with good memory management and caching techniques. Moodle supports
    **Zend OPcache**, which is precompiled by default. Zend OPcache speeds up PHP
    execution by opcode caching and optimization. It stores precompiled script byte
    code in shared memory. You can check whether OPcache is working correctly by going
    to **Site administration** | **Server** | **Environment**, as illustrated in the
    following screenshot:'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PHP性能**：有几种方法可以强制PHP以显著更快的速度执行代码。做到这一点的关键是使用PHP加速器，结合良好的内存管理和缓存技术。Moodle支持**Zend
    OPcache**，默认情况下是预编译的。Zend OPcache通过代码缓存和优化加快PHP执行速度。它将预编译的脚本字节码存储在共享内存中。您可以通过访问**站点管理**
    | **服务器** | **环境**来检查OPcache是否正常工作，如下面的截图所示：'
- en: '![Figure 15.2 – Zend OPcache check ](img/Figure_15.02_B18779.jpg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图15.2 – Zend OPcache检查](img/Figure_15.02_B18779.jpg)'
- en: Figure 15.2 – Zend OPcache check
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.2 – Zend OPcache检查
- en: 'Your `php.ini` file is likely to contain the following entries (for details,
    refer to [docs.moodle.org/en/OPcache](http://docs.moodle.org/en/OPcache)):'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '您的 `php.ini` 文件可能包含以下条目（有关详细信息，请参阅[docs.moodle.org/en/OPcache](http://docs.moodle.org/en/OPcache)):'
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: There is a handy plugin available at [moodle.org/plugins/tool_opcache](http://moodle.org/plugins/tool_opcache),
    adding a PHP OPcache management GUI to Moodle, a CLI tool to reset PHP OPcache,
    and a Nagios check for PHP OPcache.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在[moodle.org/plugins/tool_opcache](http://moodle.org/plugins/tool_opcache)有一个方便的插件可用，它为Moodle添加了一个PHP
    OPcache管理GUI，一个用于重置PHP OPcache的CLI工具，以及一个用于PHP OPcache的Nagios检查。
- en: '**Hardware performance**: We already mentioned in [*Chapter 1*](B18779_01.xhtml#_idTextAnchor020),
    *Installing Moodle*, that there is no one-size-fits-all approach to the ideal
    hardware setup. For single-server systems, the key is RAM: the more, the better.
    It’s as simple as that. Once the level of concurrency increases above a certain
    level, it is inevitable to use multiple web servers in a load-balanced environment.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**硬件性能**：我们在[*第1章*](B18779_01.xhtml#_idTextAnchor020)，*安装Moodle*中提到，没有一种适合所有情况的理想硬件配置方法。对于单服务器系统，关键是RAM：越多越好。就这么简单。一旦并发级别超过一定水平，在负载均衡环境中使用多个Web服务器是不可避免的。'
- en: '**Network performance**: Networks are the backbone of most IT infrastructures
    and thus a potential performance bottleneck. Your topology, software, and hardware
    must be configured correctly to ensure a well-performing network without typical
    issues such as packet losses.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络性能**：网络是大多数IT基础设施的骨干，因此可能成为性能瓶颈。您的拓扑、软件和硬件必须正确配置，以确保网络性能良好，没有典型的如数据包丢失等问题。'
- en: '**Content performance**: The content that is created and uploaded by your course
    creators or home page designers will have an impact on the performance of your
    system. While you cannot dictate which learning sources are added to Moodle, you
    might want to recommend two main strategies to reduce the load content has on
    your system: First, the content volume in courses and the home page should be
    kept to a manageable size, avoiding the infamous *scroll of death*. Second, content
    should be optimized, especially office docs (for instance, PDFs instead of Word
    files), images (resolution and color depth), and audio/video (sample rate and
    resolution).'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内容性能**：由您的课程创建者或主页设计师创建和上传的内容将对您的系统性能产生影响。虽然您不能指定哪些学习资源被添加到 Moodle 中，但您可能希望推荐两种主要策略来减少内容对系统的影响：首先，课程和主页中的内容量应保持在一个可管理的范围内，避免著名的*死亡滚动*。其次，内容应进行优化，特别是办公文档（例如，PDF
    文件而不是 Word 文件）、图像（分辨率和颜色深度）以及音频/视频（采样率和分辨率）。'
- en: While all the preceding criteria apply, some elements can be changed on the
    fly. For example, during exam week, you might consider increasing the memory available
    for Moodle, while during the summer break, you can reduce the number of servers
    to carry out maintenance. More sophisticated setups let you specify load and usage
    thresholds, which dynamically trigger resource allocation.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然所有上述标准都适用，但某些元素可以即时更改。例如，在考试周，您可能考虑增加 Moodle 可用的内存，而在暑假期间，您可以减少服务器数量以进行维护。更复杂的设置允许您指定负载和使用阈值，这些阈值可以动态触发资源分配。
- en: For each area mentioned, profile tools, monitoring systems, benchmarks, and
    stress tests are available to help you gauge which performance bottlenecks are
    present and whether they have been reduced after optimization has been carried
    out.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个提到的区域，都有配置文件工具、监控系统、基准测试和压力测试可用，以帮助您判断哪些性能瓶颈存在，以及优化后是否已减少。
- en: An entire area has been dedicated to performance and optimization in the Moodle
    docs. You can find most of the relevant information and links to relevant sites
    at [docs.moodle.org/en/Performance](http://docs.moodle.org/en/Performance).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 文档中有一个专门针对性能和优化的区域。您可以在[docs.moodle.org/en/Performance](http://docs.moodle.org/en/Performance)找到大部分相关信息和相关网站的链接。
- en: 'You should remember that Moodle’s performance cannot be viewed independently.
    For example, improving security comes at a price in terms of performance reduction;
    running your entire site over HTTPS is highly recommended, but it slows down certain
    operations. Some typical trade-offs are shown in the seesaw depicted here:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该记住，Moodle 的性能不能独立看待。例如，提高安全性在性能降低方面是有代价的；在整个站点上运行 HTTPS 高度推荐，但它会减慢某些操作。这里展示的跷跷板显示了某些典型权衡：
- en: '![Figure 15.3 – Performance versus the rest of the world ](img/Figure_15.03_B18779.jpg)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图 15.3 – 与世界其他地区的性能比较](img/Figure_15.03_B18779.jpg)'
- en: Figure 15.3 – Performance versus the rest of the world
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.3 – 与世界其他地区的性能比较
- en: Another trade-off you will face regularly is performance versus functionality,
    where certain features harm how speedily your system performs. Moodle comes with
    an elementary performance report (**Site administration** | **Reports** | **Performance
    overview**), showing some of those trade-offs.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 您将经常面临的一个权衡是性能与功能，某些功能会损害系统运行的快速性。Moodle 随附一个基本的性能报告（**站点管理** | **报告** | **性能概述**），显示了这些权衡的一些例子。
- en: We will kick off the list of performance optimizations by looking at some of
    those Moodle features that can be optimized but will impact some or all of your
    users.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过查看一些可以优化但会影响一些或所有用户的一些 Moodle 功能来启动性能优化的列表。
- en: Optimizing Moodle feature performance
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化 Moodle 功能性能
- en: The title of this section is slightly misleading because optimizing Moodle features
    effectively means limiting its functionality. Suggestions in this section have
    a positive impact on performance but a potentially negative impact on user functionality.
    While some features might be dispensable (for instance, statistics), others should
    be non-negotiable, such as backups.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 本节标题略有误导性，因为优化 Moodle 功能实际上意味着限制其功能。本节中的建议对性能有积极影响，但可能对用户功能有负面影响。虽然某些功能可能是可废弃的（例如，统计数据），但其他功能应该是不可协商的，如备份。
- en: We have grouped Moodle features in the performance optimization context into
    Moodle functions and Moodle activities.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经将 Moodle 功能在性能优化背景下分为 Moodle 函数和 Moodle 活动。
- en: Optimizing Moodle functions
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 优化 Moodle 函数
- en: 'In this subsection, we have collected some Moodle tools that impact the performance
    of your LMS. Most of the following functions have been dealt with elsewhere in
    this book, and we provide links to the respective chapters:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在本小节中，我们收集了一些影响您LMS性能的Moodle工具。以下大多数功能已在本书的其他部分处理，我们提供了相应章节的链接：
- en: '**Course backups**: As you will learn in the next chapter, course backups hurt
    performance during execution, especially on larger systems. If possible, schedule
    the backup procedure when the load on the overall system is low. If you turn off
    site-wide course backups and use system-level backups instead, you reduce performance
    problems but lose the ability to recover individual items. A compromise is to
    include only essential data and leave out less relevant information, such as log
    files. All this will be dealt with in [*Chapter 16*](B18779_16.xhtml#_idTextAnchor308),
    *Avoiding Sleepless Nights – Moodle Backup* *and Restore*.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**课程备份**：正如您将在下一章中了解到的那样，课程备份在执行过程中会影响性能，尤其是在大型系统中。如果可能，请在整体系统负载较低时安排备份程序。如果您关闭了网站范围内的课程备份并改用系统级备份，可以减少性能问题，但会失去恢复单个项目的能力。一种折衷方案是仅包含必要数据，并省略不太相关的信息，例如日志文件。所有这些内容将在[*第16章*](B18779_16.xhtml#_idTextAnchor308)
    *避免失眠之夜 – Moodle备份和恢复*中处理。'
- en: '**Log files**: In [*Chapter 12*](B18779_12.xhtml#_idTextAnchor233), *Gaining
    Insights through Moodle Reporting and Analytics*, we looked at Moodle logging,
    reporting, and analytics. Keeping track of user behavior can potentially harm
    your server performance, as logs must be created and kept up to date. The recommended
    approach is only to log data that will be analyzed and reported on. Three parameters
    determine the volume of logs: the number of log stores, the number of fields stored,
    and the time logs are being kept.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日志文件**：在[*第12章*](B18779_12.xhtml#_idTextAnchor233) *通过Moodle报告和分析获得洞察力*中，我们探讨了Moodle的日志记录、报告和分析。跟踪用户行为可能会损害您的服务器性能，因为必须创建并保持日志的更新。建议的做法是仅记录将进行分析和报告的数据。三个参数决定了日志的量：日志存储的数量、存储的字段数量以及日志保留的时间。'
- en: '**Statistics**: If you have enabled the statistics functionality, be aware
    that it is likely to have a profound impact on the performance of your system
    whenever statistical information is updated. Go back to the *Gathering statistics*
    section in [*Chapter 12*](B18779_12.xhtml#_idTextAnchor233), *Gaining Insights
    through Moodle Reporting and Analytics*, and ensure that the configuration has
    minimum impact on your system.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**统计信息**：如果您已启用统计功能，请注意，每当更新统计信息时，它可能会对您系统的性能产生深远影响。请回到[*第12章*](B18779_12.xhtml#_idTextAnchor233)
    *通过Moodle报告和分析获得洞察力*中的*收集统计信息*部分，并确保配置对您系统的最小影响。'
- en: '**Home page courses**: The home page is likely to be accessed frequently by
    all users. On sites with many courses, displaying all of them every time the home
    page is called is unlikely to be a pleasant user experience. You can limit the
    **Maximum number of courses** and **Maximum category depth** parameters by going
    to **Site administration** | **General** | **Site home** | **Site** **home settings**.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主页课程**：主页可能会被所有用户频繁访问。在拥有众多课程的网站上，每次调用主页时都显示所有课程不太可能提供良好的用户体验。您可以通过访问**网站管理**
    | **常规** | **网站主页** | **网站主页设置**来限制**最大课程数**和**最大分类深度**参数。'
- en: '**Roles and users**: We dedicated an entire chapter to roles ([*Chapter 6*](B18779_06.xhtml#_idTextAnchor116),
    *Managing Permissions, Roles, and Capabilities*). The robust flexibility of Moodle’s
    roles system comes at a price, which is a minor drop in performance if a lot of
    lookups are required in the context hierarchy (avoid global roles) and the override
    mechanism is applied frequently.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**角色和用户**：我们专门用一章来介绍角色([*第6章*](B18779_06.xhtml#_idTextAnchor116) *管理权限、角色和能力*)。Moodle角色系统的强大灵活性是有代价的，那就是在上下文层次结构中需要大量查找时（避免全局角色）以及频繁应用覆盖机制时，性能会有轻微下降。'
- en: '**User selector**: The user selector is displayed in various places throughout
    Moodle. If you experience speed problems in courses with a large number of users,
    adjust the **Maximum number of users per page** settings by navigating to **Site
    administration** | **Users** | **Permissions** | **User policies**.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户选择器**：用户选择器在Moodle的各个地方都有显示。如果您在拥有大量用户的课程中遇到速度问题，可以通过导航到**网站管理** | **用户**
    | **权限** | **用户策略**来调整**每页最大用户数**设置。'
- en: Next up are Moodle activities, which offer some performance tweaking settings.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是Moodle活动，它提供了一些性能调整设置。
- en: Optimizing Moodle activities
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 优化Moodle活动
- en: 'While optimizing Moodle activities will positively impact performance, they
    should only be implemented if the loss of functionality is acceptable to your
    users. The following are some modules that can be tweaked:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在优化Moodle活动时，虽然会对性能产生积极影响，但只有在用户可以接受功能损失的情况下才应实施。以下是一些可以调整的模块：
- en: '**Gradebook optimization**'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**成绩册优化**'
- en: Due to the complexity of the gradebook, some settings in the **Grades** menu
    will impact performance. In general, when more aggregation and other calculations
    have to be carried out, the population of the gradebook data store becomes slow.
    For example, the **Aggregate including subcategories** parameter in **Site administration**
    | **Grades** | **Grade category settings** will add minor overhead to calculating
    grades.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 由于成绩册的复杂性，**成绩**菜单中的某些设置会影响性能。一般来说，当需要进行更多聚合和其他计算时，成绩册数据存储的填充会变慢。例如，**包含子类别的聚合**参数在**网站管理**
    | **成绩** | **成绩类别设置**中会增加计算成绩的轻微开销。
- en: 'A second gradebook-related area that impacts performance is the gradebook history,
    which forces Moodle to keep track of any changes in grades. Go to **Site administration**
    | **Server** | **Cleanup**, and you will see two gradebook history settings at
    the bottom:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 影响性能的第二个与成绩册相关的区域是成绩册历史记录，它迫使Moodle跟踪任何成绩的变化。转到**网站管理** | **服务器** | **清理**，您将在底部看到两个成绩册历史记录设置：
- en: '![Figure 15.4 – Gradebook history settings ](img/Figure_15.04_B18779.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图15.4 – 成绩册历史设置](img/Figure_15.04_B18779.jpg)'
- en: Figure 15.4 – Gradebook history settings
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.4 – 成绩册历史设置
- en: The gradebook history is turned on by default, and values are kept forever.
    You can either turn the facility off entirely or limit the time you wish to keep
    the grade entries.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 成绩册历史记录默认开启，并且值永久保留。您可以选择完全关闭该功能或限制您希望保留成绩条目的时间。
- en: You will find more details on the gradebook in the *Configuring grades and the
    gradebook* section of [*Chapter 9*](B18779_09.xhtml#_idTextAnchor181), *Configuring*
    *Educational Features*.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[*第9章*](B18779_09.xhtml#_idTextAnchor181)的*配置成绩和成绩册*部分找到有关成绩册的更多详细信息，*配置*
    *教育功能*。
- en: '**Chat optimization**'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**聊天优化**'
- en: By default, Moodle chat uses the **AJAX** method, which, like the **Normal**
    method, contacts all participating clients regularly. The upside of both approaches
    is that they require no configuration and work on any system; the downside is
    that they have a significant performance impact on the server, especially when
    the chat activity is used regularly. A solution is to use the **Chat server**
    daemon, which ensures a scalable chat environment. However, the daemon, a small
    system-level program that runs in the background, has to be installed on the operating
    system level and only works on Unix (check your administration guide for how to
    do this).
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Moodle聊天使用**AJAX**方法，与**正常**方法一样，会定期联系所有参与客户端。这两种方法的优势在于它们无需配置且可在任何系统上运行；劣势是它们对服务器性能有显著影响，尤其是在聊天活动经常使用时。一种解决方案是使用**聊天服务器**守护进程，它确保聊天环境可扩展。然而，该守护进程，一个在后台运行的小型系统级程序，必须在操作系统级别安装，并且仅在Unix系统上工作（请参阅您的管理指南了解如何进行此操作）。
- en: To change the chat method Moodle uses and to configure some performance parameters,
    go to **Site administration** | **Plugins** | **Activity modules** | **Chat**.
    We dealt with these in the *Synchronous communication* section of [*Chapter 10*](B18779_10.xhtml#_idTextAnchor204),
    *Configuring* *Technical Features*.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 要更改Moodle使用的聊天方法并配置一些性能参数，请转到**网站管理** | **插件** | **活动模块** | **聊天**。我们在[*第10章*](B18779_10.xhtml#_idTextAnchor204)的*同步通信*部分讨论了这些问题，*配置*
    *技术功能*。
- en: 'The following table lists the performance-related settings and the methods
    to which they apply:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格列出了与性能相关的设置及其应用方法：
- en: '![Figure 15.5 – Chat performance settings ](img/Figure_15.05_B18779.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![图15.5 – 聊天性能设置](img/Figure_15.05_B18779.jpg)'
- en: Figure 15.5 – Chat performance settings
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.5 – 聊天性能设置
- en: '**Forum optimization**'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**论坛优化**'
- en: On systems with large forums, tracking unread posts can slow down the activity.
    Though the impact is relatively minor, the tracking can be turned off by going
    to **Site administration** | **Plugins** | **Activity modules** | **Forum**, where
    you will find the **Track unread posts** and **Allow forced read** **tracking**
    parameters.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在拥有大型论坛的系统上，跟踪未读帖子可能会减慢活动速度。尽管影响相对较小，但可以通过转到**网站管理** | **插件** | **活动模块** | **论坛**来关闭跟踪，在那里您将找到**跟踪未读帖子**和**允许强制阅读**跟踪参数。
- en: '**Moodle’s** **filter settings**'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle** 的 **过滤器设置**'
- en: 'We focused on filter functionality when we looked at the feature in [*Chapter
    9*](B18779_09.xhtml#_idTextAnchor181), *Configuring Educational Features*. Now,
    let’s look at filters again, highlighting some performance issues. The following
    is a list ordered by priority when setting up filters by going to **Site administration**
    | **Plugins** | **Filters** |**Manage filters**:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们查看 *第 9 章* 中关于 *配置教育功能* 的功能时，我们关注了过滤器功能。现在，让我们再次查看过滤器，突出一些性能问题。以下是一个按优先级排序的列表，当通过访问
    **站点管理** | **插件** | **过滤器** | **管理过滤器** 来设置过滤器时：
- en: Activate all the filters that course creators need but not more than those.
    Too many active Moodle filters affect the server load, especially on lower-end
    systems. The number of active filters will increase the time it takes to scan
    each page since filters are applied sequentially, not in parallel.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 激活课程创建者所需的全部过滤器，但不能超过这些。过多的活动 Moodle 过滤器会影响服务器负载，尤其是在低端系统上。活动过滤器的数量会增加扫描每一页所需的时间，因为过滤器是按顺序应用的，而不是并行应用。
- en: Configure as many active filters as possible using the **Off, but available**
    setting. They can then be activated locally at any course or activity level.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 **关闭，但可用** 设置尽可能多地配置活动过滤器。然后它们可以在任何课程或活动级别本地激活。
- en: Place the filters used most often (usually multimedia plugins) at the top of
    the list, as filters are applied on a first-come-first-serve basis.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将最常用的过滤器（通常是多媒体插件）放在列表的顶部，因为过滤器是按先到先服务的原则应用的。
- en: 'Caching is applied to pages that use text filters, a topic discussed later
    in the *MUC* section. Additionally, you should optimize the generic filter settings
    in **Site administration** | **Plugins** | **Filters** | **Common filter settings**:
    only turn on **Filter uploaded files** if required. Also, change **Filter match
    once per page**, **Filter match once per text**, and **Filter navigation within
    system context** to **On** if the resulting behaviors are acceptable. We have
    discussed these parameters in the *Configuring filters* section of [*Chapter 9*](B18779_09.xhtml#_idTextAnchor181),
    *Configuring* *Educational Features*.'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 缓存应用于使用文本过滤器的页面，这一主题将在 *MUC* 部分后面讨论。此外，您应该优化 **站点管理** | **插件** | **过滤器** | **通用过滤器设置**
    中的通用过滤器设置：仅在需要时开启 **过滤器上传文件**。此外，如果结果行为可接受，将 **每页匹配一次**、**每文本匹配一次** 和 **系统上下文内的导航匹配**
    设置为 **开启**。我们已在 *第 9 章* 的 *配置过滤器* 部分讨论了这些参数，*配置* *教育功能*。
- en: There are other minor tweaks in Moodle activities and modules—for example, timeout
    values—and you’ll need to adjust those when and if you encounter any performance
    issues.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Moodle 活动和模块中还有其他一些小的调整——例如，超时值——您在遇到任何性能问题时需要调整这些设置。
- en: A bigger problem than feature performance is scalability, caused by concurrent
    users. We will spend the rest of the chapter dealing with this issue, starting
    with exploring the powerful MUC.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 比功能性能更大的问题是可扩展性，这是由并发用户引起的。我们将在本章的剩余部分处理这个问题，从探索强大的 MUC 开始。
- en: Moodle Universal Cache (MUC)
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Moodle 通用缓存 (MUC)
- en: Caching stores frequently accessed data in transient storage and expedites its
    access using a cached copy instead of prefetched (from disk) or recomputed (in
    memory) data.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 缓存将频繁访问的数据存储在临时存储中，并使用缓存副本而不是预先获取（从磁盘）或重新计算（在内存）的数据来加速其访问。
- en: Note
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Caching has proven to be one of the most efficient performance optimization
    techniques, and Moodle is no exception.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 缓存已被证明是最有效的性能优化技术之一，Moodle 也不例外。
- en: Moodle contains a powerful caching framework called MUC, which allows certain
    functions to take advantage of different configured caching services ([docs.moodle.org/en/Caching](http://docs.moodle.org/en/Caching)).
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 包含一个名为 MUC 的强大缓存框架，它允许某些功能利用不同的配置缓存服务 ([docs.moodle.org/en/Caching](http://docs.moodle.org/en/Caching))。
- en: Understanding MUC
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解 MUC
- en: 'Before we look at how MUC works, let’s explore some basic concepts: cache types
    (modes), cache stores, and cache definitions. The following diagram shows all
    three concepts and how they work together in MUC:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们查看 MUC 的工作原理之前，让我们探索一些基本概念：缓存类型（模式）、缓存存储和缓存定义。以下图表显示了这三个概念以及它们如何在 MUC 中协同工作：
- en: '![Figure 15.6 – Moodle Universal Cache ](img/Figure_15.06_B18779.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![图 15.6 – Moodle 通用缓存](img/Figure_15.06_B18779.jpg)'
- en: Figure 15.6 – Moodle Universal Cache
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.6 – Moodle 通用缓存
- en: Moodle has nearly 100 cache definitions—for example, fetching of language strings,
    config settings, or processed CSS. Cache definitions are mapped onto cache stores,
    which act as connectors to the cache backend for different cache types. This all
    will make more sense by the end of this section.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle有近100个缓存定义——例如，获取语言字符串、配置设置或处理过的CSS。缓存定义映射到缓存存储，这些存储作为不同缓存类型的缓存后端的连接器。到本节结束时，这一切都将更加清晰。
- en: Let’s go through each component, starting with cache types.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们逐一介绍每个组件，从缓存类型开始。
- en: Cache types
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 缓存类型
- en: 'There are three different **cache types** in Moodle, often referred to as cache
    modes:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle中有三种不同的**缓存类型**，通常被称为缓存模式：
- en: '**Application cache**: The application cache deals with Moodle-specific operations—for
    example, caching of language strings or configuration settings. This is the most
    commonly used cache as it has the highest impact on Moodle performance.'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序缓存**：应用程序缓存处理Moodle特定的操作——例如，语言字符串或配置设置的缓存。这是最常用的缓存，因为它对Moodle性能的影响最大。'
- en: '**Session cache**: This is basically the same as your PHP session cache. It
    is only used in very few scenarios; we do not need to cover this in further detail.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**会话缓存**：这基本上与您的PHP会话缓存相同。它只在极少数场景中使用；我们不需要进一步详细说明这一点。'
- en: '**Request cache**: As the name suggests, this type of caching is only stored
    for the lifetime of a request and allows developers to optimize code. Again, this
    is not a cache type we, as administrators, must worry about.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**请求缓存**：正如其名所示，这种类型的缓存仅存储在请求的生命周期内，允许开发者优化代码。再次强调，这不是我们作为管理员必须担心的缓存类型。'
- en: 'Here’s an overview of the different cache types:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是不同缓存类型的概述：
- en: '![Figure 15.7 – Cache types (modes) ](img/Figure_15.07_B18779.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![图15.7 – 缓存类型（模式）](img/Figure_15.07_B18779.jpg)'
- en: Figure 15.7 – Cache types (modes)
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.7 – 缓存类型（模式）
- en: The last entry in *Figure 15**.7* describes the default cache stores. What these
    are and why they are critical in Moodle are covered in the following subsection.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**图15**.7的最后一条条目描述了默认的缓存存储。这些是什么以及为什么它们在Moodle中至关重要将在以下小节中介绍。'
- en: Cache stores
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 缓存存储
- en: In Moodle, cache stores are plugins that talk to MUC’s backend.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在Moodle中，缓存存储是连接到MUC后端的插件。
- en: Important note
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: A **cache store** connects Moodle to physical storage, where the cached data
    gets stored.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '**缓存存储**连接Moodle到物理存储，其中缓存的 数据被存储。'
- en: As mentioned previously, the default cache stores are in the form of a filesystem
    (for application caches), a PHP session (session caches), and memory (request
    caches). For most setups, these are sufficient, but for larger sites, it is beneficial
    to consider a dedicated application cache store.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，默认的缓存存储形式为文件系统（应用程序缓存）、PHP会话（会话缓存）和内存（请求缓存）。对于大多数设置，这些是足够的，但对于大型网站，考虑一个专用应用程序缓存存储是有益的。
- en: 'Moodle ships with the following four application cache store plugins (the descriptions
    have mostly been taken from their respective websites, not some techie buzzword-bingo):'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle附带以下四个应用程序缓存存储插件（描述大多取自各自的网站，而不是一些技术术语的彩票游戏）：
- en: '**APC user cache (APCu)**: The alternative PHP cache is an in-memory key-value
    store for PHP'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**APC用户缓存（APCu）**：替代PHP缓存是PHP的内存键值存储'
- en: '**Memcached**: An in-memory key-value store for small chunks of data from results
    of database calls, API calls, or page rendering'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Memcached**：用于存储来自数据库调用、API调用或页面渲染结果的小块数据的内存键值存储'
- en: '**MongoDB**: A NoSQL database system that can be configured to run like an
    in-memory database'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**MongoDB**：一种可以配置为运行得像内存数据库的NoSQL数据库系统'
- en: '**Redis**: An in-memory data structure store, used as a distributed, in-memory,
    key-value database, cache, and message broker, with optional durability.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Redis**：一个内存数据结构存储，用作可选持久性的分布式、内存、键值数据库、缓存和消息代理'
- en: Plugins for other cache backends can be found in the **Cache Stores** section
    at [moodle.org/plugins/?q=type:cachestore](http://moodle.org/plugins/?q=type:cachestore).
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 其他缓存后端的插件可以在[moodle.org/plugins/?q=type:cachestore](http://moodle.org/plugins/?q=type:cachestore)的**缓存存储**部分找到。
- en: 'All the supported cache stores can be found at **Site administration** | **Plugins**
    | **Caching** | **Configuration**. On our system, all cache stores have been installed
    and configured at the system level except APCu, hence the ticks in the **Ready**
    column. The **Supports** column indicates which features are supported by the
    cache store; the options are **ttl** (time-to-live), **data guarantee**, **key
    awareness**, **multiple identifiers**, and **searching by key**, as illustrated
    in the following screenshot:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 所有支持的缓存存储都可以在**站点管理** | **插件** | **缓存** | **配置**中找到。在我们的系统中，除了APCu之外，所有缓存存储都已安装和配置在系统级别，因此在**就绪**列中有勾选标记。**支持**列指示缓存存储支持哪些功能；选项包括**ttl**（生存时间）、**数据保证**、**键感知**、**多个标识符**和**按键搜索**，如以下截图所示：
- en: '![Figure 15.8 – Cache stores ](img/Figure_15.08_B18779.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![图15.8 – 缓存存储](img/Figure_15.08_B18779.jpg)'
- en: Figure 15.8 – Cache stores
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.8 – 缓存存储
- en: 'For each configured cache type, you can add instances via the respective link
    in the **Actions** column. Each cache store has different settings, depending
    on the cache backend’s supported features. Here are the parameters of the popular
    **Memcached** store, which are documented at [docs.moodle.org/en/Caching#Memcached](http://docs.moodle.org/en/Caching#Memcached):'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个配置的缓存类型，您可以通过**操作**列中的相应链接添加实例。每个缓存存储有不同的设置，这取决于缓存后端支持的功能。以下是流行的**Memcached**存储的参数，这些参数在[docs.moodle.org/en/Caching#Memcached](http://docs.moodle.org/en/Caching#Memcached)中有文档说明：
- en: '![Figure 15.9 – Adding Memcached cache store ](img/Figure_15.09_B18779.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![图15.9 – 添加Memcached缓存存储](img/Figure_15.09_B18779.jpg)'
- en: Figure 15.9 – Adding Memcached cache store
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.9 – 添加Memcached缓存存储
- en: Once you have set up your cache store and cache instance(s), you must add **store
    mappings**, which are part of the cache definitions we will cover next.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您设置了您的缓存存储和缓存实例，您必须添加**存储映射**，这是我们将在下一部分讨论的缓存定义的一部分。
- en: Cache definitions
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 缓存定义
- en: 'Different features in Moodle support caching. Years ago, there was a single
    monolithic cache that was either harnessed by a feature or wasn’t. Now, via MUC,
    each feature is represented via **cache definitions**, which can be configured
    individually. At the time of writing, over 90 cache definitions are available,
    and it is expected that this number will increase with each version. For each
    definition, the following information is available:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle中的不同功能支持缓存。多年前，有一个单一的、统一的缓存，要么被某个功能利用，要么没有被利用。现在，通过MUC，每个功能都通过**缓存定义**来表示，这些定义可以单独配置。在撰写本文时，有超过90个缓存定义可用，预计这个数字会随着每个版本的发布而增加。对于每个定义，以下信息是可用的：
- en: '**Definition**: Name of the feature that is being cached.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**定义**：被缓存的特性的名称。'
- en: '**Mode**: Cache types (**Application**, **Session**, or **Request**).'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模式**：缓存类型（**应用**、**会话**或**请求**）。'
- en: '**Component**: The Moodle component that the definition belongs to (**core**
    or module).'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组件**：定义所属的Moodle组件（**核心**或模块）。'
- en: '**Area**: The section the feature belongs to—only relevant to developers.'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**区域**：功能所属的章节——仅对开发者相关。'
- en: '**Store mappings**: If no customization has taken place, this will be the default
    cache store of the cache mode; otherwise, the newly set value.'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**存储映射**：如果没有进行自定义，这将默认为缓存模式的默认缓存存储；否则，新设置的值。'
- en: '**Sharing**: By default, this will be **Site identifier**. When modified, the
    possible values are **Everyone**, **Version**, and **Custom key** (see next bullet
    list).'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**共享**：默认情况下，这将设置为**站点标识符**。当修改时，可能的值是**所有人**、**版本**和**自定义键**（见下一条项目符号列表）。'
- en: '**Can use local store**: Only relevant on multi-server systems.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可以使用本地存储**：仅在多服务器系统上相关。'
- en: In the **Actions** column, you have **Edit mappings** and **Edit sharing** options,
    as well as a **Purge** option to purge the cache for this specific definition.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在**操作**列中，您有**编辑映射**、**编辑共享**选项，以及一个**清除**选项来清除此特定定义的缓存。
- en: '**Edit** **mappings** lets you specify which cache store is being used as the
    primary store and, for some definitions, as the final store. This is where you
    specify which store is used for a particular feature (cache definition).'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '**编辑** **映射**允许您指定哪个缓存存储被用作主存储，对于某些定义，也用作最终存储。这是您指定特定功能（缓存定义）使用的存储的地方。'
- en: 'By default, each cache definition is shared across the instance of the site.
    However, there are scenarios where you might want to change this to any of the
    following sharing options:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，每个缓存定义都在站点的实例之间共享。然而，在某些情况下，您可能希望将其更改为以下任何共享选项：
- en: '**Everyone**: Every user in the system.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**所有人**：系统中的每个用户。'
- en: '**Site with the same ID**: If you run a single version of Moodle on a single
    server, this is identical to the preceding point. If you run Moodle on a multi-server
    setup, all systems will be included.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**具有相同ID的网站**：如果您在单个服务器上运行单个版本的Moodle，这与前面的点相同。如果您在多服务器设置上运行Moodle，所有系统都将包括在内。'
- en: '`wwwroot`, only sites with identical version numbers will be included.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`wwwroot`，只有具有相同版本号的网站将被包括。'
- en: '`wwwroot`, you can group them via a custom key. For example, you might want
    to cache all the instances of one country in one store.'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`wwwroot`，您可以通过自定义键将它们分组。例如，您可能希望将一个国家的所有实例缓存在一个存储中。'
- en: 'To clear the cache of a specific definition, simply select the **Purge** option.
    The following screenshot shows some cache definitions and the described values:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要清除特定定义的缓存，只需选择**清除**选项。以下截图显示了一些缓存定义和描述的值：
- en: '![Figure 15.10 – Cache definitions and mappings ](img/Figure_15.10_B18779.jpg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![图15.10 – 缓存定义和映射](img/Figure_15.10_B18779.jpg)'
- en: Figure 15.10 – Cache definitions and mappings
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.10 – 缓存定义和映射
- en: 'There are two more elements on the **Site administration** | **Plugins** |
    **Caching** | **Configuration** page we haven’t covered yet:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在**网站管理** | **插件** | **缓存** | **配置**页面上还有两个我们没有介绍过的元素：
- en: '**Summary of cache lock instances**: There are different locking mechanisms
    in shared environments, caches being no exception. By default, Moodle ships with
    a default file locking mechanism, and it would be possible to install additional
    lock instances. However, at the time of print, no such plugins are present for
    Moodle 4.x at [moodle.org/plugins](http://moodle.org/plugins).'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**缓存锁实例摘要**：在共享环境中存在不同的锁定机制，缓存也不例外。默认情况下，Moodle附带默认的文件锁定机制，并且可以安装额外的锁实例。然而，截至印刷时，在[moodle.org/plugins](http://moodle.org/plugins)上没有为Moodle
    4.x提供此类插件。'
- en: '**Stores used when no mapping is present**: You can specify which default mappings
    will be used for which cache type.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无映射时使用的存储**：您可以指定哪些默认映射将用于哪种缓存类型。'
- en: Now that we have covered all the relevant concepts of MUC, let’s look at the
    items to consider when optimizing your Moodle site.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经涵盖了MUC的所有相关概念，让我们看看在优化您的Moodle网站时需要考虑的项目。
- en: Configuring and testing MUC
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置和测试MUC
- en: 'We have already explored the complexity of MUC. While this provides enormous
    flexibility in terms of granular optimization, it makes it impossible to come
    up with a one-size-fits-all configuration. Somebody in the Moodle community once
    compared the MUC control panel with a big mixing desk at a concert: it gives you
    a lot of knobs to play with, but unless you know what each of them does and how
    they work together, you are unlikely to get good results.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经探讨了MUC的复杂性。虽然这在粒度优化方面提供了巨大的灵活性，但它使得制定一个通用的配置变得不可能。Moodle社区中有人将MUC控制面板比作音乐会上的大型调音台：它提供了许多可以操作的旋钮，但除非您知道每个旋钮的作用以及它们如何协同工作，否则您不太可能得到好的结果。
- en: 'Several factors impact the configuration of MUC:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 几个因素会影响MUC的配置：
- en: Usage of the system (volume, diversity, functions, and type)
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统的使用（数量、多样性、功能、类型）
- en: Underlying infrastructure (single server, multiple servers, virtualization,
    and so on)
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础设施（单个服务器、多个服务器、虚拟化等）
- en: Types of cache stores used
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用的缓存存储类型
- en: In particular, when talking about the usage of the system, it is almost impossible
    to quantify this since it’s constantly changing. During the summer break, there
    will be minimal usage; during exam time, the load on the system is likely to rise,
    and so on.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 尤其是在谈论系统使用时，几乎不可能量化这一点，因为它始终在变化。在暑假期间，使用量将最小；在考试时间，系统负载可能会上升，等等。
- en: 'Performance optimization is an ongoing exercise that is accompanied by regular
    performance testing. Moodle provides a basic performance test for different cache
    types (**Site administration** | **Plugins** | **Caches** | **Test performance**).
    Here is an example where you can see the results of 100,000 unique requests; the
    file cache is significantly slower than the session cache, a behavior that is
    not unexpected:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 性能优化是一项持续进行的练习，伴随着定期的性能测试。Moodle为不同的缓存类型提供了基本的性能测试（**网站管理** | **插件** | **缓存**
    | **测试性能**）。以下是一个示例，您可以查看10万个唯一请求的结果；文件缓存比会话缓存慢得多，这种表现并不令人意外：
- en: '![Figure 15.11 – Cache store performance testing ](img/Figure_15.11_B18779.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图15.11 – 缓存存储性能测试](img/Figure_15.11_B18779.jpg)'
- en: Figure 15.11 – Cache store performance testing
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.11 – 缓存存储性能测试
- en: 'While it is nice to have a built-in performance test tool in Moodle, it has
    two significant shortcomings: first, some plugins are classed as **Untestable**,
    for instance, **Redis** and **Memcached**; second, the test runs only mimic some
    unique requests but do not mirror their behavior if users are on your system.
    To overcome these drawbacks, proper profiling and monitoring are required, which
    will be dealt with at the end of this chapter.'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在Moodle中有一个内置的性能测试工具很方便，但它有两个显著的缺点：首先，一些插件被归类为**不可测试**，例如**Redis**和**Memcached**；其次，测试运行仅模拟一些独特的请求，但不会在用户位于您的系统上时反映其行为。为了克服这些缺点，需要进行适当的性能分析和监控，这将在本章末尾讨论。
- en: 'There are several caching-related settings spread across the administration
    area, which you should tailor to your requirements:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在管理区域中分散着几个与缓存相关的设置，您应该根据需求进行定制：
- en: '**Language caching**: We dealt with localization in detail in [*Chapter 10*](B18779_10.xhtml#_idTextAnchor204),
    *Configuring Technical Features*, where we covered the configuration of Moodle’s
    ability to handle multiple languages. In addition to keeping the number of languages
    to a minimum, language caching should be utilized.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**语言缓存**：我们在[*第10章*](B18779_10.xhtml#_idTextAnchor204)，“配置技术功能”中详细讨论了本地化问题，其中我们介绍了Moodle处理多种语言的配置。除了将语言数量保持在最小值外，还应利用语言缓存。'
- en: Language packs are cached to speed up the retrieval of language strings. You
    will find the **Cache language menu** and **Cache all language strings** parameters
    by going to **Site administration** | **Languages** | **Language settings**. Unless
    you modify a language pack, it is highly recommended that you leave both settings
    enabled as they cache all the language strings rather than load them dynamically.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 语言包被缓存以提高语言字符串的检索速度。您可以通过访问**网站管理** | **语言** | **语言设置**来找到**缓存语言菜单**和**缓存所有语言字符串**参数。除非您修改了语言包，否则强烈建议您保持这两个设置启用，因为它们缓存了所有语言字符串而不是动态加载。
- en: '**Theme caching**: Moodle caches the images and style sheets of themes either
    locally in a web browser or on a server. Unless you are in the process of designing
    or modifying a theme, which you shouldn’t be doing on a live system anyway, the
    **Theme designer mode** setting, at **Site administration** | **Appearance** |
    **Themes** | **Theme settings**, should remain off.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主题缓存**：Moodle将主题的图片和样式表缓存到本地，无论是在网页浏览器中还是在服务器上。除非您正在设计或修改主题（实际上您也不应该在运行中的系统上这样做），否则在**网站管理**
    | **外观** | **主题** | **主题设置**中的**主题设计师模式**设置应保持关闭状态。'
- en: You can clear the theme cache using the **Clear theme caches** button by going
    to **Site administration** | **Appearance** | **Themes** | **Theme selector**.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过访问**网站管理** | **外观** | **主题** | **主题选择器**来使用**清除主题缓存**按钮清除主题缓存。
- en: '**JavaScript caching**: Moodle makes use of JavaScript and AJAX. The **Cache
    JavaScript** setting at **Site administration** | **Appearance** | **AJAX and
    Javascript** should be kept on unless you are a developer. The same applies to
    **YUI Combo loading** on the same page.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**JavaScript缓存**：Moodle使用JavaScript和AJAX。除非您是开发者，否则应保持**网站管理** | **外观** | **AJAX和JavaScript**中的**缓存JavaScript**设置开启。同样，同一页面上的**YUI组合加载**也适用。'
- en: '**RSS caching**: RSS feeds are cached locally. You can modify the time after
    the cache is refreshed by changing the **Timeout** parameter at **Site administration**
    | **Plugins** | **Blocks** | **Remote** **RSS feeds**.'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**RSS缓存**：RSS源被本地缓存。您可以通过更改**网站管理** | **插件** | **块** | **远程** **RSS源**中的**超时**参数来修改缓存刷新后的时间。'
- en: '**Networking caching**: Moodle uses cURL to fetch data from remote sites. The
    **cURL cache TTL** setting can be modified by going to **Site administration**
    | **Server** | **Performance**. The larger the time-to-live value, the better
    the performance. More on networking in [*Chapter 19*](B18779_19.xhtml#_idTextAnchor344),
    *Setting Up* *Moodle Networking*.'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络缓存**：Moodle使用cURL从远程站点获取数据。您可以通过访问**网站管理** | **服务器** | **性能**来修改**cURL缓存TTL**设置。生存时间值越大，性能越好。更多关于网络的内容请参阅[*第19章*](B18779_19.xhtml#_idTextAnchor344)，“设置Moodle网络”。'
- en: '**Repository caching**: When browsing external repositories, such as Nextcloud
    or Google Drive, the file listing is kept in a local cache. The amount of time
    the listing is kept can be changed via the **Cache expire** parameter by going
    to **Site administration** | **Plugins** | **Repositories** | **Common repository
    settings**. We covered repositories in [*Chapter 10*](B18779_10.xhtml#_idTextAnchor204),
    *Configuring* *Technical Features*.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**仓库缓存**：当浏览外部仓库，如 Nextcloud 或 Google Drive 时，文件列表将保存在本地缓存中。列表保留的时间可以通过访问 **站点管理**
    | **插件** | **仓库** | **通用仓库设置** 中的 **缓存过期** 参数来更改。我们已在 [*第 10 章*](B18779_10.xhtml#_idTextAnchor204)
    中介绍了仓库，*配置* *技术功能*。'
- en: 'You can purge all these caches in a single operation by pressing the `$CFG->dataroot/cache`
    for the file cache. While this feature is more relevant to developers, it is recommended
    after installing updates or when your system behaves oddly. You can see an illustration
    of this in the following screenshot:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过按 `$CFG->dataroot/cache` 来一次性清除所有这些缓存。虽然这个功能对开发者来说更为相关，但在安装更新或系统行为异常时推荐使用。您可以在以下屏幕截图中看到这个功能的示例：
- en: '![Figure 15.12 – Purging caches ](img/Figure_15.12_B18779.jpg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![图 15.12 – 清除缓存](img/Figure_15.12_B18779.jpg)'
- en: Figure 15.12 – Purging caches
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.12 – 清除缓存
- en: 'There is also a CLI script to purge caches: `php admin/cli/purge_caches.php`.'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一个 CLI 脚本可以清除缓存：`php admin/cli/purge_caches.php`。
- en: Once you have set up cache stores and configured all available caching options
    correctly, you should then move on to check that performance-related system settings
    have been configured properly.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您已设置缓存存储并正确配置所有可用的缓存选项，您应继续检查与性能相关的系统设置是否已正确配置。
- en: Optimizing Moodle system performance
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 优化 Moodle 系统性能
- en: In this section, we have grouped settings that potentially impact performance
    without compromising any Moodle features. The topics covered are session handling,
    cron management and scheduled tasks, global search, and system paths.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将可能影响性能但不会损害任何 Moodle 功能的设置分组。涵盖的主题包括会话处理、Cron 管理、预定任务、全局搜索和系统路径。
- en: Handling sessions
  id: totrans-159
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 处理会话
- en: 'A session is initiated for each user that authenticates against Moodle, which
    also applies to guests. There are several well-explained settings relevant in
    a performance optimization context, which can be found by going to **Site administration**
    | **Server** |**Session handling**:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个通过 Moodle 进行身份验证的用户（包括访客），都会启动一个会话。在性能优化的背景下，有几个相关的设置解释得很好，可以通过访问 **站点管理**
    | **服务器** | **会话处理** 来找到：
- en: '![Figure 15.13 – Session handling ](img/Figure_15.13_B18779.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![图 15.13 – 会话处理](img/Figure_15.13_B18779.jpg)'
- en: Figure 15.13 – Session handling
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 图 15.13 – 会话处理
- en: Moodle manages sessions and cookies very well. However, when problems occur,
    it is sometimes necessary to intervene manually. This should be done locally in
    the web browser if a specific user experiences issues (clear cache and cookies)
    or on the server if the problem affects multiple users. The latter is done by
    clearing the `mdl_sessions` table if sessions are stored in the database or emptying
    the `$CFG->dataroot/sessions` directory if the sessions are stored in files. Bear
    in mind that all logged-in users will be logged out.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 管理会话和 Cookie 非常出色。然而，当出现问题时，有时需要手动干预。如果特定用户遇到问题（清除缓存和 Cookie），则应在本地网页浏览器中执行此操作；如果问题影响多个用户，则应在服务器上执行，这可以通过清除数据库中存储的
    `mdl_sessions` 表或清空 `$CFG->dataroot/sessions` 目录（如果会话存储在文件中）来实现。请注意，所有已登录用户都将被注销。
- en: 'You can also kill all user sessions via a CLI script that performs the preceding
    steps via a single command: `php admin/cli/kill_all_sessions.php`.'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以通过执行前面步骤的单个命令来通过 CLI 脚本终止所有用户会话：`php admin/cli/kill_all_sessions.php`。
- en: Cleaning up old sessions is done in the background by a so-called scheduled
    task. Cron management and scheduled tasks are the topics of the following subsection.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 清理旧会话是通过所谓的预定任务在后台完成的。Cron 管理和预定任务是以下小节的主题。
- en: Managing cron and scheduled tasks
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 管理cron和预定任务
- en: Moodle performs a significant number of background tasks regularly. The system
    script that performs these tasks is known as a **cron script** and is executed
    by the **cron process**.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 定期执行大量后台任务。执行这些任务的系统脚本被称为 **cron 脚本**，并由 **cron 进程**执行。
- en: Important note
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: The Moodle cron script runs different tasks at differently scheduled intervals.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 的 cron 脚本在不同的预定时间间隔运行不同的任务。
- en: 'The following diagram illustrates when scheduled tasks are executed in Moodle:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表说明了Moodle中计划任务执行的时间：
- en: '![Figure 15.14 – Scheduled tasks and the cron process ](img/Figure_15.14_B18779.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![图15.14 – 计划任务和cron进程](img/Figure_15.14_B18779.jpg)'
- en: Figure 15.14 – Scheduled tasks and the cron process
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.14 – 计划任务和cron进程
- en: Cron is a system process that triggers Moodle’s cron script, which determines
    which tasks are executed at a particular time slot.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Cron是一个系统进程，它触发Moodle的cron脚本，该脚本确定在特定时间槽执行哪些任务。
- en: Important note
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: The cron process should run every minute.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: cron进程应该每分钟运行一次。
- en: 'Moodle comes with a task scheduler (**Site administration** | **Server** |
    **Scheduled tasks**) that lets you precisely configure which routine job runs
    when and how often. The following screenshot shows some selected tasks (I hope
    your eyesight is better than mine):'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle附带一个任务调度器（**站点管理** | **服务器** | **计划任务**），允许您精确配置哪些常规工作何时以及多久运行一次。以下截图显示了某些选定的任务（希望您的视力比我好）：
- en: '![Figure 15.15 – Scheduled tasks ](img/Figure_15.15_B18779.jpg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![图15.15 – 计划任务](img/Figure_15.15_B18779.jpg)'
- en: Figure 15.15 – Scheduled tasks
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.15 – 计划任务
- en: 'The following information is provided for each scheduled task:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个计划任务，以下信息是可用的：
- en: '**Name**: Name and internal location of the task'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名称**: 任务的名称和内部位置'
- en: '**Component**: Moodle component that triggers the task'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组件**: 触发任务的Moodle组件'
- en: '**Logs**: Details on each task execution, including duration and database reads/writes'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日志**: 每个任务执行的详细信息，包括持续时间以及数据库的读取/写入'
- en: '**Last run**: Date and time of the previous task execution or **Never**'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**上次运行**: 上次任务执行的日期和时间或**从未**'
- en: '**Next run**: Date and time of subsequent task execution or **ASAP**'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**下次运行**: 下次任务执行日期和时间或**尽快**'
- en: '**Minute**, **Hour**, **Day**, **Day of week**, **Month**: Schedule information
    in Unix cron format:'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分钟**、**小时**、**天**、**星期**、**月**: Unix cron格式的计划信息：'
- en: '*****: every minute, hour, day, day of the week, and month'
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*****: 每分钟、每小时、每天、每周的每一天和每个月'
- en: '***/x**: every *x* minutes, hours, and so on'
  id: totrans-187
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '***/x**: 每*x*分钟、每小时等'
- en: '**x-y**: every minute between *x* and *y* past the hour or every hour, between
    *x* and *y*'
  id: totrans-188
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**x-y**: 每小时*x*到*y*分钟之间的每分钟或每小时，从*x*到*y*之间'
- en: '**0** = Sunday, **1** = Monday, and so on'
  id: totrans-189
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**0** = 星期日，**1** = 星期一，以此类推'
- en: '**Fail delay**: Number of seconds to wait before reattempting a failed task'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**失败延迟**: 在重新尝试失败的任务之前等待的秒数'
- en: '**Default**: Specifies whether the task has been modified'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**默认**: 指定任务是否已被修改'
- en: 'You must select the configuration icon in the **Edit** column if you wish to
    change the schedule for any tasks. As an example, we have picked the **Check for
    updates** task, which is executed at 10:48 every day, every month, and every day
    of the week:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想更改任何任务的计划，必须在**编辑**列中选择配置图标。例如，我们选择了**检查更新**任务，该任务每天、每月和每周的每天在10:48执行：
- en: '![Figure 15.16 – Editing task schedule ](img/Figure_15.16_B18779.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图15.16 – 编辑任务计划](img/Figure_15.16_B18779.jpg)'
- en: Figure 15.16 – Editing task schedule
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.16 – 编辑任务计划
- en: In addition to the already covered scheduling settings, you can pause a task
    (**Disabled**) and revert the original settings (**Reset task schedule to defaults**).
    The default settings have been set with performance in mind. However, you might
    want to fine-tune these, considering any idiosyncrasies in your setup.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 除了已经覆盖的计划设置外，您还可以暂停任务（**禁用**）并恢复原始设置（**将任务计划重置为默认值**）。默认设置已考虑到性能。然而，您可能希望根据您的设置中的任何特殊要求进行微调。
- en: 'There are some things worth mentioning when dealing with scheduled tasks and
    the cron process:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理计划任务和cron进程时，有一些值得注意的事项：
- en: Tasks can be kicked off manually using the **Run now** option. For this action
    to appear underneath each enabled task, the **Allow ‘Run now’ for scheduled tasks**
    option in **Site administration** | **General** | **Security** | **Site security
    settings** must be set, and **Path to PHP CLI** in **Site administration** | **Server**
    | **System paths** has to be configured correctly.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以使用**立即运行**选项手动启动任务。要使此操作出现在每个启用的任务下方，必须在**站点管理** | **常规** | **安全** | **站点安全设置**中设置**允许“立即运行”计划任务**选项，并且必须在**站点管理**
    | **服务器** | **系统路径**中正确配置**PHP CLI路径**。
- en: Multiple tasks can run in parallel. The concurrency limits for scheduled and
    ad hoc tasks can be configured at **Site administration** | **Server** | **Tasks**
    | **Task processing**.
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多个任务可以并行运行。计划任务和临时任务的并发限制可以在**站点管理** | **服务器** | **任务** | **任务处理**中进行配置。
- en: 'A cron run can take longer than the specified time between two executions,
    and the new tasks will be queued and executed at the next run if this is the case.
    The task lifetime before the task is freed can also be scheduled, and ad hoc tasks
    can be configured at **Site administration** | **Server** | **Tasks** | **Task
    processing**:'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果cron运行时间超过两次执行之间的指定时间，新任务将在下一次运行时排队并执行。在任务释放之前，任务的生命周期也可以进行安排，并且可以在**网站管理**
    | **服务器** | **任务** | **任务处理**中配置临时任务：
- en: '![Figure 15.17 – Task processing settings ](img/Figure_15.17_B18779.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![图15.17 – 任务处理设置](img/Figure_15.17_B18779.jpg)'
- en: Figure 15.17 – Task processing settings
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.17 – 任务处理设置
- en: To view which tasks are running, go to **Site administration** | **Server**
    | **Tasks** | **Tasks running** **now**. Any processes in progress will be listed,
    including the time the process has already run.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看正在运行的任务，请转到**网站管理** | **服务器** | **任务** | **当前运行的任务**。任何正在进行的进程都将列出，包括进程已经运行的时间。
- en: 'Details of each task are logged in Moodle and can be viewed at **Site administration**
    | **Server** | **Tasks** | **Task log**. Via the report filters, you can drill
    down to processes that have taken a long time or tasks that have failed to complete.
    The settings at **Site administration** | **Server** | **Tasks** | **Task log
    configuration** let you reduce the number of log entries that are written to the
    log table:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 每个任务的详细信息都记录在Moodle中，可以在**网站管理** | **服务器** | **任务** | **任务日志**中查看。通过报告过滤器，您可以深入到耗时较长的进程或未能完成的任务。在**网站管理**
    | **服务器** | **任务** | **任务日志配置**中的设置可以让您减少写入日志表中的日志条目数量：
- en: '![Figure 15.18 – Task log configuration ](img/Figure_15.18_B18779.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![图15.18 – 任务日志配置](img/Figure_15.18_B18779.jpg)'
- en: Figure 15.18 – Task log configuration
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.18 – 任务日志配置
- en: We have already covered this as part of the installation, but it is worth reiterating
    that the method by which you call the Moodle cron job can have a significant impact
    on your system performance, especially on larger installations. If the `cron.php`
    script is invoked over HTTP (either using `wget` or `curl`), more memory is used
    than calling directly via the php –f command.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在安装过程中介绍了这一点，但值得重申的是，您调用Moodle cron作业的方法可能会对您的系统性能产生重大影响，尤其是在大型安装中。如果通过HTTP（无论是使用`wget`还是`curl`）调用`cron.php`脚本，与直接通过php
    –f命令调用相比，将使用更多的内存。
- en: Moodle’s memory management has proven to be very efficient. However, there are
    scenarios when extra memory is required to execute complex PHP scripts, and cron
    is a candidate for such a complex script. To increase the memory limit, change
    the **Extra PHP memory limit** setting by going to **Site administration** | **Server**
    |**Performance**.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle的内存管理已被证明非常高效。然而，在执行复杂的PHP脚本时，可能需要额外的内存，cron就是这样的一个候选脚本。要增加内存限制，请通过转到**网站管理**
    | **服务器** | **性能**来更改**额外PHP内存限制**设置。
- en: An operation that relies heavily on scheduled tasks and that potentially has
    a significant impact on system performance is global search, which we are configuring
    in the following subsection.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 依赖于计划任务并且可能对系统性能产生重大影响的操作是全局搜索，我们将在以下小节中进行配置。
- en: Configuring global search
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置全局搜索
- en: Moodle comes with a powerful global search facility, supporting different content
    types, content areas, access permissions, and pluggable search engines.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle自带强大的全局搜索功能，支持不同内容类型、内容区域、访问权限和可插拔的搜索引擎。
- en: Important note
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Global search lets users search everywhere in Moodle they have access.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 全局搜索允许用户搜索Moodle中他们有权访问的任何地方。
- en: 'The following diagram is a simplified illustration of how global search works
    in Moodle:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表是Moodle中全局搜索工作原理的简化说明：
- en: '![Figure 15.19 – Moodle global search ](img/Figure_15.19_B18779.jpg)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![图15.19 – Moodle全局搜索](img/Figure_15.19_B18779.jpg)'
- en: Figure 15.19 – Moodle global search
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.19 – Moodle全局搜索
- en: The **indexing** process (top) is triggered by a scheduled task, during which
    any **content and metadata** created, updated, or deleted since the last run is
    sent to the search engine. The search engine never requests anything from Moodle;
    there is no content crawling. Moodle global search can be limited to **search
    areas**, such as assignment activity information, text block content, or received
    messages. The search engine processes the received data and stores it in its index.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '**索引**过程（顶部）是由计划任务触发的，在此期间，自上次运行以来创建、更新或删除的任何**内容和元数据**都会发送到搜索引擎。搜索引擎从不从Moodle请求任何内容；没有内容爬取。Moodle全局搜索可以限制为**搜索区域**，例如作业活动信息、文本块内容或收到的消息。搜索引擎处理接收到的数据并将其存储在其索引中。'
- en: The **searching** process (bottom) is initiated by a user keying in a search
    word or phrase. The query is sent to the search engine alongside the user’s access
    permissions, which are taken into account by the **querying** mechanism in the
    search engine. This last point is critical to ensure that users are only presented
    with results they have access to. The results are returned to Moodle and displayed
    to the user.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '**搜索**过程（底部）是由用户输入搜索词或短语触发的。查询与用户的访问权限一起发送到搜索引擎，这些权限由搜索引擎的**查询**机制考虑。最后这一点至关重要，以确保用户只能看到他们有权访问的结果。结果返回到Moodle并显示给用户。'
- en: 'Moodle ships with one internal and one external search engine plugin:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle附带一个内部和一个外部搜索引擎插件：
- en: '**Simple search**: A built-in search engine supporting basic search operations.'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**简单搜索**：一个内置的搜索引擎，支持基本的搜索操作。'
- en: '**Solr**: According to [solr.apache.org](http://solr.apache.org), “*Apache
    Solr is the popular, blazing-fast, open source enterprise search platform built
    on Apache Lucene*.” **Solr** supports file searches and advanced search operations,
    such as Boolean operators, wildcards, prefixing, proximity searches, and boosting.'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Solr**：根据[solr.apache.org](http://solr.apache.org)，“*Apache Solr是基于Apache
    Lucene的流行、快速、开源的企业级搜索引擎平台*。”**Solr**支持文件搜索和高级搜索操作，例如布尔运算符、通配符、前缀、邻近搜索和提升。'
- en: You will find additional search engine plugins at [moodle.org/plugins/?q=type:search](http://moodle.org/plugins/?q=type:search),
    for example, **Elastic** or **Azure Search**.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在[moodle.org/plugins/?q=type:search](http://moodle.org/plugins/?q=type:search)找到额外的搜索引擎插件，例如**Elastic**或**Azure
    Search**。
- en: 'To manage global search, go to **Site administration** | **Plugins** | **Search**
    | **Manage global search**, where you should see a table of setup steps to go
    through:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 要管理全局搜索，请转到**站点管理** | **插件** | **搜索** | **管理全局搜索**，在那里你应该看到一个需要通过的设置步骤表：
- en: '![Figure 15.20 – Moodle global search setup](img/Figure_15.20_B18779.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![图15.20 – Moodle全局搜索设置](img/Figure_15.20_B18779.png)'
- en: Figure 15.20 – Moodle global search setup
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.20 – Moodle全局搜索设置
- en: 'Let’s go through the six actions step by step:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们一步一步地通过六个动作：
- en: '**Select search engine**: The options are **Simple search** and **Solr** unless
    you have installed third-party search engine plugins.'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**选择搜索引擎**：选项是**简单搜索**和**Solr**，除非你已经安装了第三方搜索引擎插件。'
- en: '**Enable search areas**: Search areas are content groups that are indexed separately.
    By default, global search indexes all search areas; however, you can enable and
    disable individual search areas in **Site administration** | **Plugins** | **Search**
    | **Search areas**. By disabling a search area, you improve search speed but exclude
    its content from appearing in search results. You might choose to disable the
    **User** search area to exclude links to user profiles from global search.'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**启用搜索区域**：搜索区域是分别索引的内容组。默认情况下，全局搜索索引所有搜索区域；然而，你可以在**站点管理** | **插件** | **搜索**
    | **搜索区域**中启用和禁用单个搜索区域。通过禁用搜索区域，你可以提高搜索速度，但会排除其内容出现在搜索结果中。你可能选择禁用**用户**搜索区域，以排除用户个人资料链接从全局搜索中。'
- en: '**Setup search engine**: Simple search does not need any configuration; others
    do.'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**设置搜索引擎**：简单搜索不需要任何配置；其他则需要。'
- en: '**Index data**: Indexing is triggered by the **Global search indexing** scheduled
    task. Alternatively, there are multiple indexing actions in **Site administration**
    | **Plugins** | **Search** | **Search areas**, namely updating, reindexing, and
    deleting the entire index or indices of an individual search area.'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**索引数据**：索引是由**全局搜索索引**计划任务触发的。或者，在**站点管理** | **插件** | **搜索** | **搜索区域**中有多项索引操作，即更新、重新索引和删除整个索引或单个搜索区域的索引。'
- en: '**Enable global search**: You enable global search in **Site administration**
    | **General** | **Advanced features**. Before enabling the feature, you should
    first configure global search and index the site contents. Otherwise, searches
    can return incomplete results.'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**启用全局搜索**：您可以在“**站点管理**” | “**常规**” | “**高级功能**”中启用全局搜索。在启用此功能之前，您应首先配置全局搜索并索引站点内容。否则，搜索可能会返回不完整的结果。'
- en: '**Used for site home course search**: If enabled, search results will include
    course information visible to users, even if they don’t have access to the course
    content.'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**用于站点主页课程搜索**：如果启用，搜索结果将包括用户可见的课程信息，即使他们没有访问课程内容。'
- en: You will find the last setting underneath the list of setup steps among various
    configuration options dealing with search options, search scopes (for instance,
    only courses the users are enrolled in), and display preferences. These settings
    are well explained onscreen, so we are not repeating them here.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在各种配置选项中找到最后一个设置，这些选项涉及搜索选项、搜索范围（例如，仅用户注册的课程）和显示偏好。这些设置在屏幕上有很好的解释，所以我们在这里不再重复。
- en: Some more parameters are grouped under **Search management** at the bottom of
    the global search configuration screen. These options are helpful when making
    changes on sites with extensive search indexes that take a long time to rebuild.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 一些更多参数被分组在全局搜索配置屏幕底部的“**搜索管理**”下。当在具有大量搜索索引且重建时间较长的站点上进行更改时，这些选项很有帮助。
- en: 'Since the **Solr** plugin ships with Moodle, here are some pointers that will
    help you use the powerful search engine as part of your setup:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 由于**Solr**插件随Moodle一起提供，以下是一些有助于您将强大的搜索引擎作为设置一部分使用的提示：
- en: Solr must be installed separately, either on the same or on a dedicated server.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Solr必须单独安装，无论是在同一服务器上还是在专用服务器上。
- en: 'Solr configuration in Moodle is located in **Site administration** | **Plugins**
    | **Search** | **Solr**. There are three groups of parameters: configuration (Solr
    host information and **SSL** support), file indexing, and query-only alternate
    settings.'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Moodle中的Solr配置位于“**站点管理**” | “**插件**” | “**搜索**” | “**Solr**”。有三个参数组：配置（Solr主机信息和**SSL**支持）、文件索引和仅查询的备用设置。
- en: Solr installation and configuration in Moodle have been well documented at [docs.moodle.org/en/Global_search](http://docs.moodle.org/en/Global_search).
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Moodle中的Solr安装和配置已在[docs.moodle.org/en/Global_search](http://docs.moodle.org/en/Global_search)上进行了很好的记录。
- en: The last configuration options in the system performance section are system
    paths, which we will set in the following subsection.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 系统性能部分的最后配置选项是系统路径，我们将在以下小节中设置。
- en: Setting system paths
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置系统路径
- en: An operation that Moodle performs regularly is the listing of directories. The
    operation can either be run using Moodle’s internal routine coded in PHP or a
    native version of the function provided by the host operating system. The latter
    approach is significantly faster since it reduces the load on your server, but
    it is only supported in Unix environments.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle定期执行的操作是列出目录。此操作可以通过Moodle内部用PHP编写的常规程序运行，或者使用宿主操作系统的本地版本的功能。后者方法显著更快，因为它减少了服务器负载，但仅支持Unix环境。
- en: 'You can specify the path for the `du` command by navigating to `/usr/bin/du`.
    Once specified correctly, this will accelerate the displaying of the directory
    content, especially if it contains many files:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过导航到`/usr/bin/du`来指定`du`命令的路径。一旦正确指定，这将加速目录内容的显示，尤其是如果它包含许多文件：
- en: '![Figure 15.21 – System paths](img/Figure_15.21_B18779.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![图15.21 – 系统路径](img/Figure_15.21_B18779.jpg)'
- en: Figure 15.21 – System paths
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.21 – 系统路径
- en: This concludes the section on system performance. To ensure that any optimization
    leads to better performance and user experiences, you need to profile and monitor
    your Moodle system, which we will deal with in the last section of the chapter.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 这就完成了系统性能部分的介绍。为了确保任何优化都能带来更好的性能和用户体验，您需要分析和监控您的Moodle系统，我们将在本章的最后部分处理这个问题。
- en: Moodle performance profiling and monitoring
  id: totrans-245
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Moodle性能分析和管理
- en: When you set up your Moodle system, you can take some initial precautions to
    optimize the performance of your LMS. However, the real test is when Moodle is
    in full operation—that is, when the system is under load (“There is no test like
    production!”).
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 当您设置Moodle系统时，您可以采取一些初步预防措施来优化您的LMS性能。然而，真正的测试是在Moodle完全运行时——也就是说，当系统处于负载之下时（“没有比生产更好的测试了！”）。
- en: We will be looking at Moodle’s built-in profiling tools to let you monitor your
    Moodle system regularly. While application monitoring cannot be seen as a standalone
    exercise, we won’t be dealing with system profiling since this is beyond the scope
    of this book.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将查看Moodle的内置性能分析工具，以便您定期监控您的Moodle系统。虽然应用监控不能被视为一个独立的练习，但我们不会处理系统性能分析，因为这超出了本书的范围。
- en: 'We will cover three supported tools: **Performance info**, Tideways, and JMeter.'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将介绍三种支持的工具：**性能信息**、Tideways和JMeter。
- en: Performance info
  id: totrans-249
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 性能信息
- en: Moodle provides some basic profiling information you can activate in **Site
    administration** | **Development** | **Debugging**, where you have to enable the
    **Performance info** option. This feature displays the execution time, RAM usage,
    the number of files in use, CPU usage and load, session size, and various filter
    and caching measures (less information will be shown on a Windows-based installation).
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle提供了一些基本性能分析信息，您可以在**网站管理** | **开发** | **调试**中激活这些信息。在此处，您必须启用**性能信息**选项。此功能显示执行时间、RAM使用情况、正在使用的文件数量、CPU使用率和负载、会话大小以及各种过滤和缓存措施（基于Windows的安装将显示较少的信息）。
- en: '**Performance info** further displays information on the caches used on the
    particular page. For each cache, **hits**, **misses**, and **sets** are shown.
    The caches are highlighted using traffic light colors: red uses up the most, orange
    some, and green (or no color) uses up the least resources. These signals are rather
    good indicators to identify potential performance issues.'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '**性能信息**进一步显示了特定页面上使用的缓存信息。对于每个缓存，显示**命中**、**未命中**和**设置**。缓存使用交通灯颜色突出显示：红色消耗最多，橙色消耗一些，绿色（或无颜色）消耗最少资源。这些信号是识别潜在性能问题的良好指标。'
- en: The data will be displayed in the footer of Moodle as long as the theme in use
    supports it—for instance, **Boost**.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 只要使用的主题支持，数据将显示在Moodle页脚中——例如，**Boost**。
- en: 'You can see an overview of **Performance info** in the following screenshot:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在以下屏幕截图中查看**性能信息**的概述：
- en: '![Figure 15.22 – Performance info ](img/Figure_15.22_B18779.jpg)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![图15.22 – 性能信息](img/Figure_15.22_B18779.jpg)'
- en: Figure 15.22 – Performance info
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.22 – 性能信息
- en: '**Performance info** provides data on the overall Moodle system and its cache
    items. If you require more in-depth information, Tideways profiling might be helpful.'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '**性能信息**提供了有关整体Moodle系统和其缓存项的数据。如果您需要更深入的信息，Tideways性能分析可能有所帮助。'
- en: Tideways profiling
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Tideways性能分析
- en: Moodle supports profiling at the PHP level. While this is mainly targeted at
    developers, it may be helpful for you to identify bottlenecks in your system.
    Internal profiling is built on top of **Tideways**, a replacement for **XHProf**,
    which allows the profiling of PHP pages at a relatively low performance cost.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle支持PHP级别的性能分析。虽然这主要是针对开发者的，但它可能有助于您识别系统中的瓶颈。内部性能分析建立在**Tideways**之上，它是**XHProf**的替代品，允许以相对较低的性能成本对PHP页面进行性能分析。
- en: 'Once you have installed the `php-tideways` and `php-graphviz` PHP extensions,
    you will see a new menu item when you navigate to **Site administration** | **Development**
    | **Profiling**:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您安装了`php-tideways`和`php-graphviz`PHP扩展，当您导航到**网站管理** | **开发** | **性能分析**时，您将看到一个新菜单项：
- en: '![Figure 15.23 – Profiling configuration ](img/Figure_15.23_B18779.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![图15.23 – 性能分析配置](img/Figure_15.23_B18779.jpg)'
- en: Figure 15.23 – Profiling configuration
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.23 – 性能分析配置
- en: The profiler can be configured to run automatically (set the **Automatic profiling**
    frequency to any value except 0, and specify URLs in the **Profile these** field)
    or manually. The latter can be **Selective** (you have to initiate the profiling)
    or **Continuous** (once it starts, you have to stop it).
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 性能分析器可以配置为自动运行（将**自动性能分析**频率设置为除0以外的任何值，并在**分析这些**字段中指定URL）或手动运行。后者可以是**选择性的**（您必须启动性能分析）或**连续的**（一旦开始，您必须停止它）。
- en: 'As soon as profiling has been enabled, yet another menu item will appear when
    you go to **Site administration** | **Development** | **Profiling runs**, which
    lists summary information on all the profile runs that have been executed:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦启用性能分析，当您进入**网站管理** | **开发** | **性能分析运行**时，将出现另一个菜单项，列出了已执行的所有性能分析运行的摘要信息：
- en: '![Figure 15.24 – Profiling runs ](img/Figure_15.24_B18779.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![图15.24 – 性能分析运行](img/Figure_15.24_B18779.jpg)'
- en: Figure 15.24 – Profiling runs
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.24 – 性能分析运行
- en: When you click on the URL or date of a single run, you can mark the run as a
    reference and provide a comment. You can also view its profiling details, where
    each function call’s execution times and memory usage are shown in tabular form.
    From this table, you can view a call graph. However, this requires dot to be installed
    (part of the Graphviz package) and **Path to dot** to be specified at **Site administration**
    | **Server** | **System paths**. The result is a scary-looking graph showing each
    function call’s order, dependencies, and details.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 当你点击单个运行的URL或日期时，你可以将该运行标记为参考并提供注释。你还可以查看其性能分析详情，其中每个函数调用的执行时间和内存使用以表格形式展示。从这张表中，你可以查看调用图。然而，这需要安装dot（Graphviz包的一部分）并在**站点管理**
    | **服务器** | **系统路径**中指定**Path to dot**。结果是看起来令人恐惧的图表，显示了每个函数调用的顺序、依赖关系和详细信息。
- en: The general strategy when dealing with profiling is to identify the functions
    that take the longest to execute, tweak your setup, and check whether the time
    has been reduced. The difficulty in doing this is ensuring that the test runs
    occur under the same or, at least, very similar conditions. You can find more
    information on PHP profiling at [docs.moodle.org/dev/Profiling_PHP](http://docs.moodle.org/dev/Profiling_PHP).
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理性能分析时的一般策略是确定执行时间最长的函数，调整你的设置，并检查时间是否已经减少。做这件事的困难在于确保测试运行是在相同或至少非常相似的条件下的。你可以在[docs.moodle.org/dev/Profiling_PHP](http://docs.moodle.org/dev/Profiling_PHP)找到更多关于PHP性能分析的信息。
- en: Tideways helps identify issues at the PHP level. Another external profiling
    tool supported by Moodle is JMeter, as briefly covered in the following subsection.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: Tideways有助于在PHP级别识别问题。Moodle支持的其他外部性能分析工具是JMeter，如以下小节简要介绍的。
- en: JMeter support
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: JMeter支持
- en: '**Apache JMeter** is another tool aimed at developers but potentially helpful
    when locating Moodle bottlenecks. To create a test plan file, set **Debug messages**
    to **DEVELOPER** at **Site administration** | **Development** | **Debugging**,
    and go to **Site administration** | **Development** | **Make JMeter test plan**.
    You need to follow the instructions shown in the following screenshot before a
    test plan can be created:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: '**Apache JMeter**是另一个面向开发者的工具，但在定位Moodle瓶颈时可能很有帮助。要创建测试计划文件，请在**站点管理** | **开发**
    | **调试**中将**调试消息**设置为**DEVELOPER**，然后转到**站点管理** | **开发** | **创建JMeter测试计划**。在创建测试计划之前，你需要遵循以下截图中的说明：'
- en: '![Figure 15.25 – Creating JMeter test plans ](img/Figure_15.25_B18779.jpg)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![图15.25 – 创建JMeter测试计划](img/Figure_15.25_B18779.jpg)'
- en: Figure 15.25 – Creating JMeter test plans
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.25 – 创建JMeter测试计划
- en: The outcome of the performance test run over a Moodle course is a file in JMX
    format that can then be loaded and analyzed in the JMeter tool, which you need
    to install separately.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 在Moodle课程上运行的性能测试的结果是一个JMX格式的文件，然后可以在需要单独安装的JMeter工具中加载和分析。
- en: 'Moodle comes with an unsupported tool that lets you generate random course
    data, which is helpful in the context of creating JMeter test plans. You have
    to call the script manually at `<yoursite>/admin/tool/generator`, where you can
    simulate having hundreds of courses with various levels and types of activities.
    You can see an overview of this here:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle附带了一个不受支持的工具，允许你生成随机课程数据，这在创建JMeter测试计划时很有帮助。你必须手动在`<yoursite>/admin/tool/generator`处调用脚本，在那里你可以模拟拥有数百门具有不同级别和类型的活动的课程。你可以在这里查看概述：
- en: '![Figure 15.26 – Creating JMeter test plans ](img/Figure_15.26_B18779.jpg)'
  id: totrans-275
  prefs: []
  type: TYPE_IMG
  zh: '![图15.26 – 创建JMeter测试计划](img/Figure_15.26_B18779.jpg)'
- en: Figure 15.26 – Creating JMeter test plans
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.26 – 创建JMeter测试计划
- en: You can select **Size of course** as well as **Course short name**, **Course
    full name**, and **Course summary** options. Beware that the generation of large
    courses may take hours and significantly negatively impacts your system performance.
    Do not perform this operation in production environments.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以选择**课程大小**以及**课程简称**、**课程全名**和**课程摘要**选项。请注意，生成大型课程可能需要数小时，并且会显著影响你的系统性能。不要在生产环境中执行此操作。
- en: Now that you have been armed with some profiling and monitoring tools, you can
    tweak the settings as described throughout the chapter. Take a look at what impact,
    positive or negative, they have on the performance of your Moodle system.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经配备了某些性能分析和监控工具，你可以根据本章中描述的进行调整。看看它们对你的Moodle系统性能有何影响，无论是积极的还是消极的。
- en: Summary
  id: totrans-279
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'You learned how to optimize and monitor Moodle’s performance in this chapter.
    We first provided an overview of Moodle performance and briefly mentioned optimizing
    hardware, networks, databases, web servers, and course content. The key Moodle
    performance topics have been grouped into the following sections:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 您在本章中学习了如何优化和监控 Moodle 的性能。我们首先提供了 Moodle 性能的概述，并简要提到了优化硬件、网络、数据库、Web 服务器和课程内容。关键
    Moodle 性能主题已分组到以下部分：
- en: '**Moodle feature performance**: We covered performance issues in Moodle functions
    and Moodle activities.'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle 功能性能**：我们涵盖了 Moodle 函数和 Moodle 活动中的性能问题。'
- en: '**Moodle Universal Cache**: We dealt with the powerful MUC and configured cache
    types, cache stores, and cache definitions before testing MUC performance and
    activating various caching options.'
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle 通用缓存**：我们处理了强大的 MUC，配置了缓存类型、缓存存储和缓存定义，在测试 MUC 性能和激活各种缓存选项之前。'
- en: '**Moodle system performance**: We optimized session handling, cron management
    and scheduled tasks, global search, and system paths.'
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle 系统性能**：我们优化了会话处理、cron 管理、计划任务、全局搜索和系统路径。'
- en: The chapter was concluded with a short Moodle performance profiling and monitoring
    section.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 本章以一个简短的 Moodle 性能分析和监控部分结束。
- en: As you have probably gathered from the chapter, optimization is not always straightforward.
    It depends on various circumstances, such as the system that Moodle is running
    on, the hardware it utilizes, the network, the number of concurrent users logged
    in to the system, the types of activities carried out, and so on. While basic
    optimization is usually straightforward, fine-tuning is a bit of an art in itself.
    A lot of trial and error (that is, profiling) will be required to achieve the
    ideal setup for your Moodle system.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从本章中可能已经了解到的那样，优化并不总是直截了当的。它取决于各种情况，例如 Moodle 运行的系统、它所使用的硬件、网络、登录到系统的并发用户数量、执行的活动类型等等。虽然基本优化通常是直截了当的，但微调本身也是一种艺术。为了达到您
    Moodle 系统的理想设置，可能需要进行大量的尝试和错误（即性能分析）。
- en: Now that your system is ready to perform to its maximum potential, let’s ensure
    that you have a professional backup and recovery strategy in place, which is covered
    in the next chapter.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您的系统已经准备好发挥其最大潜力，让我们确保您已经实施了一个专业的备份和恢复策略，这将在下一章中介绍。
