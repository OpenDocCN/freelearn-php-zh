- en: Chapter 3. Files and File Sets
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 3 章。文件和文件集
- en: 'In this chapter, we will cover the following:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下内容：
- en: Loading a file by its ID
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件
- en: Getting a file's path
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取文件的路径
- en: Getting a list of files
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取文件列表
- en: Uploading a file to the file manager
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将文件上传到文件管理器
- en: Loading a file set by its ID
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件集
- en: Adding a file to a file set
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将文件添加到文件集中
- en: Removing a file from a file set
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从文件集中移除文件
- en: Checking if a file is part of a file set
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 检查文件是否属于文件集
- en: Getting all of the files in a file set
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取文件集中的所有文件
- en: Duplicating a file
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 复制文件
- en: Deleting a file
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 删除文件
- en: Reindexing a file's search attributes
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重新索引文件的搜索属性
- en: Setting passwords on file objects
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在文件对象上设置密码
- en: Setting permissions on files
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在文件上设置权限
- en: Getting the download URL for a file
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取文件的下载 URL
- en: Getting the download statistics for a file
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取文件的下载统计信息
- en: Adding a file picker to a form
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在表单中添加文件选择器
- en: Introduction
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: In addition to robust content editing features, **concrete5** comes with a powerful
    tool to manage static files on your website, called the **file manager**. The
    file manager is where you can store any type of static document, including images,
    videos, PDFs, documents, and audio files. The file manager allows you to create
    downloadable links to the files, embed photos into your site content, and much
    more. You can even assign permissions to files inside the file manager to allow
    for greater control in deciding what files users can download.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 除了强大的内容编辑功能外，**concrete5** 还附带了一个强大的工具来管理网站上的静态文件，称为 **文件管理器**。文件管理器是您可以存储任何类型的静态文档的地方，包括图片、视频、PDF、文档和音频文件。文件管理器允许您创建文件的下载链接，将图片嵌入到网站内容中，等等。您甚至可以分配文件管理器内文件的权限，以便在决定用户可以下载哪些文件时拥有更大的控制权。
- en: Working with files through the concrete5 interface is a delight, but sometimes
    you will want to integrate the powerful functionality of the file manager into
    your own custom applications built in concrete5\. In this chapter, we will show
    how to interact with files, upload new files, and even upload new files to the
    file manager.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 concrete5 接口处理文件是一种乐趣，但有时你可能希望将文件管理器的强大功能集成到你自己构建在 concrete5 中的自定义应用程序中。在本章中，我们将展示如何与文件交互、上传新文件，甚至将新文件上传到文件管理器。
- en: A note about the code in this chapter
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关于本章代码的说明
- en: Much of the code presented in this chapter can go just about anywhere in a concrete5
    application. Since we are just going to be trying out simple code snippets, it
    makes sense to experiment with this code in a sandbox area. There are a few places
    in concrete5 that make sense for this, but we will be using `/config/site_post.php`
    to test out our code.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中展示的大部分代码几乎可以在 concrete5 应用程序的任何地方使用。由于我们只是将要尝试简单的代码片段，所以在沙盒区域进行实验是有意义的。在
    concrete5 中有几个地方适合这样做，但我们将使用 `/config/site_post.php` 来测试我们的代码。
- en: It is a good idea to erase any experimental and arbitrary code from `site_post.php`
    after each recipe, so that your site is ready for the next exercise.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个菜谱之后删除 `site_post.php` 中的任何实验性和任意代码是个好主意，这样您的网站就为下一个练习做好了准备。
- en: Also, we will need to dump the contents of variables from time to time. Each
    PHP developer has his or her own way of doing this, but in this chapter we will
    be using a custom debug function. You may recognize this function from [Chapter
    1](ch01.html "Chapter 1. Pages and Page Types"), *Pages and Page Types*. We will
    continue using it here, as it makes the output easy to read and saves some time
    while developing.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们有时还需要转储变量的内容。每个 PHP 开发者都有自己的方式来做这件事，但本章我们将使用自定义的调试函数。您可能已经从 [第 1 章](ch01.html
    "第 1 章。页面和页面类型")，*页面和页面类型* 中认出了这个函数。我们在这里将继续使用它，因为它使得输出易于阅读，并在开发过程中节省了一些时间。
- en: 'Place the following PHP function at the top of `/config/site_post.php`:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 将以下 PHP 函数放置在 `/config/site_post.php` 的顶部：
- en: '[PRE0]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Now we can dump variable contents by calling `my_debug($variableName)` and see
    a nicely formatted output of the contents of the variable. Feel free to use `print_r`
    or `var_dump` as an alternative.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以通过调用 `my_debug($variableName)` 来转储变量内容，并看到变量内容的格式化输出。您可以使用 `print_r`
    或 `var_dump` 作为替代。
- en: Placing debug code in `site_post.php` is great for experimentation and trying
    out the concrete5 API, but it will disrupt the regular operation of a concrete5
    website. It is recommended that all of the recipes in this chapter be performed
    on a testing copy of concrete5.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `site_post.php` 中放置调试代码对于实验和尝试 concrete5 API 非常好，但它会干扰 concrete5 网站的正常操作。建议在本章中执行的所有菜谱都在
    concrete5 的测试副本上执行。
- en: Loading a file by its ID
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过文件ID加载文件
- en: The most common interaction with files for most concrete5 developers is loading
    files and interacting with them. To do this, we must load a file by its ID. The
    code in this recipe can be placed wherever you need to load a file and retrieve
    or modify its attributes.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大多数concrete5开发者来说，最常见的文件交互是加载文件并与它们交互。为此，我们必须通过ID加载文件。此配方中的代码可以放置在你需要加载文件并检索或修改其属性的地方。
- en: Getting ready
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will need to know the ID of the file that we are loading. In this recipe,
    we will load a file with the **ID** of `17`. If your concrete5 site does not have
    a file with an **ID** of `17`, upload a new file to the file manager and change
    the **ID** in this recipe to match the **ID** of the newly uploaded file. You
    can get the **ID** of a file by visiting the file manager, clicking on a file,
    and choosing **Properties**.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要知道我们正在加载的文件的ID。在这个配方中，我们将加载ID为`17`的文件。如果你的concrete5网站没有ID为`17`的文件，请上传一个新的文件到文件管理器，并将此配方中的**ID**更改为与新上传文件的**ID**相匹配。你可以通过访问文件管理器，点击一个文件，并选择**属性**来获取文件的**ID**。
- en: '![Getting ready](img/4548OS_03_01.jpg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![准备工作](img/4548OS_03_01.jpg)'
- en: How to do it...
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下步骤：
- en: Open `/config/site_post.php` in your code editor, or place this code, wherever
    it is appropriate in your own application.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的代码编辑器中打开`/config/site_post.php`，或者将此代码放置在你自己的应用程序中适当的位置。
- en: 'Declare the ID of the file to load and be sure to set this to something relevant
    for your system:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要加载的文件的ID，并确保将其设置为对你系统相关的内容：
- en: '[PRE1]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Load the file:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件：
- en: '[PRE2]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Dump the contents of the file variable:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输出文件变量的内容：
- en: '[PRE3]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: How it works...
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 will use this function to load the relevant file from the database,
    based on the numeric ID that you passed in. The static `getByID` function will
    return a fully loaded `file` object that you can work further with.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5将使用此函数根据你传入的数字ID从数据库中加载相关文件。静态`getByID`函数将返回一个完全加载的`file`对象，你可以进一步操作。
- en: Getting a file's path
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取文件的路径
- en: Once you have loaded the `file` object, there are a multitude of different methods
    that you can call, to get all of the different attributes associated with that
    file. One of the most common and important attributes is that file's path.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你加载了`文件`对象，你可以调用多种不同的方法，以获取与该文件相关联的所有不同属性。其中最常见且重要的属性是文件的路径。
- en: Getting ready
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will get a file's path and use it to display an image stored
    in the file manager.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，我们将获取一个文件的路径，并使用它来显示存储在文件管理器中的图像。
- en: Once again, we will be referencing an image with the ID of `1`. Be sure to adapt
    the code in this recipe to load an image that actually exists in your concrete5
    installation.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，我们将引用ID为`1`的图像。请确保将此配方中的代码修改为加载你concrete5安装中实际存在的图像。
- en: How to do it...
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下步骤：
- en: Open `/config/site_post.php` in your editor.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的编辑器中打开`/config/site_post.php`。
- en: 'Declare the ID of the file to be loaded:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要加载的文件的ID：
- en: '[PRE4]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Load the file by its ID:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过文件ID加载文件：
- en: '[PRE5]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Get the file''s path:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取文件的路径：
- en: '[PRE6]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Output the path to the screen:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将路径输出到屏幕：
- en: '[PRE7]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How it works...
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The file manager stores files in various locations through the concrete5 website,
    typically beneath the `files/` folder, which gets broken up into a few machine-readable
    folders consisting of integers. Since these paths are too hard to figure out and
    predict on a regular basis, the file object API allows us to get those paths with
    a simple function call.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 文件管理器通过concrete5网站将文件存储在多个位置，通常位于`files/`文件夹下，该文件夹被分割成几个由整数组成的机器可读文件夹。由于这些路径难以定期确定和预测，文件对象API允许我们通过简单的函数调用获取这些路径。
- en: There's more...
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多...
- en: 'You will need the actual absolute path of a file, if you are working with the
    image in PHP''s `fopen` function, for instance. For that, you will use the `getPath`
    function:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在使用PHP的`fopen`函数处理图像，你需要文件的实际绝对路径。为此，你将使用`getPath`函数：
- en: '[PRE8]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: See also
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关内容
- en: The *Loading a file by its ID* recipe
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过文件ID加载文件的方法
- en: Getting a list of files
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取文件列表
- en: Many times, you will need to get several files at once. For example, if you
    were building a photo gallery, you would want to get a list of files to display
    in the gallery.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 许多时候，你需要一次性获取多个文件。例如，如果你正在构建一个相册，你将想要获取要在相册中显示的文件列表。
- en: In this recipe, we will get a list of the first hundred images stored in the
    file manager and output their file paths.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将获取文件管理器中存储的前一百个图像的列表，并输出它们的文件路径。
- en: Getting ready
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe assumes that there is at least one image stored in concrete5's file
    manager. Please make sure that your own version of concrete5 has one or more images
    stored.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 这个菜谱假设 concrete5 的文件管理器中至少存储了一个图像。请确保您的 concrete5 版本中至少存储了一个或多个图像。
- en: How to do it...
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Open `/config/site_post.php` in your preferred code editor.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您偏好的代码编辑器中打开 `/config/site_post.php`。
- en: 'Load the file list model:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件列表模型：
- en: '[PRE9]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Create a new instance of the `FileList` class:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 `FileList` 类的新实例：
- en: '[PRE10]'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Filter the list to only show images:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 过滤列表以仅显示图像：
- en: '[PRE11]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Get an array of images.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取图像数组。
- en: '[PRE12]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Loop through the images array and output each image's path.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 遍历图像数组并输出每个图像的路径。
- en: '[PRE13]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: How it works...
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Much like listing pages and other object in concrete5, we loaded a `FileList`
    object that extends the core `DatabaseItemList` class. This afforded us an object-oriented
    manner in which to filter, search, and retrieve an array of files.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 与在 concrete5 中列出页面和其他对象类似，我们加载了一个扩展核心 `DatabaseItemList` 类的 `FileList` 对象。这为我们提供了一种面向对象的方式来过滤、搜索和检索文件数组。
- en: We called the `get()` function to return the images found in the file manager.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们调用了 `get()` 函数来返回文件管理器中找到的图像。
- en: There's more...
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: 'concrete5 stores a few file type constants in the `FileType` class, which you
    can view in `concrete/libraries/file/types.php`. The following constants are available
    to filter by different file types:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 在 `FileType` 类中存储了一些文件类型常量，您可以在 `concrete/libraries/file/types.php`
    中查看。以下常量可用于根据不同的文件类型进行过滤：
- en: '`FileType::T_APPLICATION`'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_APPLICATION`'
- en: '`FileType::T_AUDIO`'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_AUDIO`'
- en: '`FileType::T_DOCUMENT`'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_DOCUMENT`'
- en: '`FileType::T_IMAGE`'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_IMAGE`'
- en: '`FileType::T_TEXT`'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_TEXT`'
- en: '`FileType::T_UNKNOWN`'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_UNKNOWN`'
- en: '`FileType::T_VIDEO`'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileType::T_VIDEO`'
- en: 'There are quite a few functions available on the `FileList` class to search
    and filter the list of files. The following are a few more functions that you
    can use:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '`FileList` 类上提供了许多函数来搜索和过滤文件列表。以下是一些您可以使用的更多函数：'
- en: 'Filter the list by file extension (do not supply a period in the extension
    parameter):'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过文件扩展名过滤列表（不要在扩展名参数中提供点）：
- en: '[PRE14]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Filter the list by a keyword phrase (searches by the file title, filename,
    and some other attributes):'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过关键词短语过滤列表（通过文件标题、文件名和一些其他属性进行搜索）：
- en: '[PRE15]'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: There are a few more specific filters available for the `FileList` class. You
    can dive into these filter functions by browsing the `FileList` class source code,
    or by viewing the online concrete5 developer documentation at [http://www.concrete5.org/documentation/developers/files/searching-and/](http://www.concrete5.org/documentation/developers/files/searching-and/)
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 `FileList` 类，还有一些更具体的过滤器可用。您可以通过浏览 `FileList` 类的源代码或查看在线 concrete5 开发者文档
    [http://www.concrete5.org/documentation/developers/files/searching-and/](http://www.concrete5.org/documentation/developers/files/searching-and/)
    来深入了解这些过滤器函数。
- en: See also
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Getting all of the files in a file set* recipe
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*获取文件集中的所有文件* 的菜谱'
- en: Uploading a file to the file manager
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将文件上传到文件管理器
- en: Sometimes you will want to store user-supplied files in the file manager, or
    perhaps want to migrate the existing files on the server to the file manager.
    There are obvious security concerns whenever you are dealing with user-generated
    content, but there are plenty of legitimate reasons to want to programmatically
    add files to the file manager.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 有时您可能需要在文件管理器中存储用户提供的文件，或者可能想要将服务器上现有的文件迁移到文件管理器。在处理用户生成内容时，您总会遇到明显的安全问题，但有许多合法的理由想要通过编程方式将文件添加到文件管理器中。
- en: Getting ready
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe requires us to create a basic HTML form with a file upload input.
    We will place the HTML form in a single page located at `/single_pages/upload.php`.
    Be sure to install the single page by visiting `/dashboard/pages/single` and adding
    a new page with a path of `/upload`.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 这个菜谱要求我们创建一个基本的 HTML 表单，其中包含文件上传输入。我们将 HTML 表单放置在位于 `/single_pages/upload.php`
    的单个页面上。确保通过访问 `/dashboard/pages/single` 并添加一个路径为 `/upload` 的新页面来安装单页。
- en: Since this recipe is a little bit more complex, it may be useful to check out
    the free code download for this chapter on this book's website.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这个菜谱稍微复杂一些，因此查看本书网站上这一章的免费代码下载可能很有用。
- en: We also will be using the custom debug function that we discussed in the chapter
    introduction.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将使用我们在章节介绍中讨论的自定义调试函数。
- en: How to do it...
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 请看以下步骤：
- en: Create a new single page at `/single_pages/upload.php`.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `/single_pages/upload.php` 创建一个新的单页。
- en: Add the single page to the concrete5 website by visiting /`dashboard/pages/single`
    and entering the path `/upload`.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过访问 `/dashboard/pages/single` 并输入路径 `/upload` 将单页添加到 concrete5 网站。
- en: 'Create a basic HTML form in the `upload.php` file with a file input:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `upload.php` 文件中创建一个基本的 HTML 表单，包含文件输入：
- en: '[PRE16]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Create `/config/site_process.php`, if it does not exist.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果不存在，请创建 `/config/site_process.php`。
- en: 'In `site_process.php`, check to see if a file has been uploaded:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `site_process.php` 中，检查是否有文件已上传：
- en: '[PRE17]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Inside the `if` statement, load the `FileImporter` library:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `if` 语句内部，加载 `FileImporter` 库：
- en: '[PRE18]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Then, create a new instance of the `FileImporter` class:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，创建 `FileImporter` 类的新实例：
- en: '[PRE19]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Get the uploaded file from the `$_FILES` super global:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 `$_FILES` 超全局变量中获取上传的文件：
- en: '[PRE20]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Get the filename:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取文件名：
- en: '[PRE21]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Get the file''s current temporary location:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取文件的当前临时位置：
- en: '[PRE22]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Add the file to the file manager:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将文件添加到文件管理器：
- en: '[PRE23]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'If `$newFile` is an integer, concrete5 has encountered an error. Output the
    error message:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果 `$newFile` 是一个整数，concrete5 遇到了错误。输出错误信息：
- en: '[PRE24]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Otherwise, the file upload was successful.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否则，文件上传成功。
- en: Visit the site's file manager at `/dashboard/files/search/` to see the newly
    uploaded file.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问网站的文件管理器 `/dashboard/files/search/` 以查看新上传的文件。
- en: How it works...
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The `FileImporter` class takes the temporary path of the uploaded file (taken
    from the `$_FILES` super global) and a name for the file. The file is then added
    to the file manager, where it can be used throughout the concrete5 website.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '`FileImporter` 类接受上传文件的临时路径（从 `$_FILES` 超全局变量中获取）和文件名。然后，文件被添加到文件管理器，在整个 concrete5
    网站上都可以使用。'
- en: See also
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Adding a file picker to a form* recipe
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*将文件选择器添加到表单* 的配方'
- en: Loading a file set by its ID
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件集
- en: concrete5 allows you to group files into sets. Some developers consider file
    sets to be similar to using folders on your computer, except that a file can be
    in multiple sets (or no sets) at a time, so a more apt description would be that,
    these are file categories.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 允许您将文件分组到集合中。一些开发者认为文件集类似于在您的计算机上使用文件夹，只不过一个文件可以同时属于多个集合（或没有任何集合），因此一个更恰当的描述可能是，这些是文件类别。
- en: File sets are great to organize files used for different purposes in your concrete5
    website. For example, you might have one file set for a slideshow on the home
    page, while there is another file set for staff photos, and another for internal
    documents.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 文件集非常适合组织 concrete5 网站上用于不同目的的文件。例如，您可能有一个用于主页幻灯片的文件集，同时还有一个用于员工照片的文件集，还有一个用于内部文件。
- en: In this recipe, we will load a file set using its numeric ID.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将使用其数字 ID 加载文件集。
- en: Getting ready
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this section, we assume the existence of a file set with the ID of `1`. Please
    adjust the code in this recipe to suit your own concrete5 environment.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们假设存在一个 ID 为 `1` 的文件集。请根据您的 concrete5 环境调整本配方中的代码。
- en: How to do it...
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will assume that we want to load a file set that has an ID of `1`. Have
    a look at the following steps:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将假设我们想要加载一个 ID 为 `1` 的文件集。请看以下步骤：
- en: 'First, make sure you know the ID of the file set that you wish to load:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，确保您知道要加载的文件集的 ID：
- en: '[PRE25]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Load the file set:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件集：
- en: '[PRE26]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'If you wish, you can verify that the file set has loaded correctly by dumping
    the `$fileSet` variable:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您愿意，可以通过输出 `$fileSet` 变量来验证文件集是否正确加载：
- en: '[PRE27]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: How it works...
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: concrete5 will query the database for the file set that has the ID you supplied.
    Once it finds the appropriate record, it will return a `FileSet` object that you
    can interact with.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 将查询数据库以找到具有您提供的 ID 的文件集。一旦找到合适的记录，它将返回一个 `FileSet` 对象，您可以与之交互。
- en: There's more...
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多...
- en: 'You can also retrieve file sets by providing their names as shown in the following
    code snippet:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以通过提供它们的名称来检索文件集，如下面的代码片段所示：
- en: '[PRE28]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: See also
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Adding a file to a file set* recipe
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*将文件添加到文件集* 的配方'
- en: The *Getting a list of files* recipe
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*获取文件列表* 的配方'
- en: Adding a file to a file set
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将文件添加到文件集
- en: A useful aspect of working with file sets is the ability to add files to a given
    set using PHP code. Fortunately, this is a very simple task.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 与文件集一起工作的一个有用方面是能够使用 PHP 代码将文件添加到指定的集合中。幸运的是，这是一个非常简单的任务。
- en: Getting ready
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: You will need to know the ID of the file that you are adding, or have the `File`
    object already loaded. This recipe will assume the existence of a file with the
    ID of `1` and of a file set also with an ID of `1`.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要知道您要添加的文件ID，或者已经加载了 `File` 对象。本菜谱将假设存在一个ID为`1`的文件和一个ID也为`1`的文件集。
- en: How to do it...
  id: totrans-167
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些步骤：
- en: Open `/config/site_post.php` in your code editor.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中打开 `/config/site_post.php`。
- en: Declare the file ID of the file that you wish to load.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要加载的文件ID。
- en: '[PRE29]'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Declare the file set ID of the file set that you wish to load:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要加载的文件集ID：
- en: '[PRE30]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Load the file by its ID:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过其ID加载文件：
- en: '[PRE31]'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Load the file set by its ID:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过其ID加载文件集：
- en: '[PRE32]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Add the file to the file set:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将文件添加到文件集：
- en: '[PRE33]'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Dump the resulting FileSetFile object:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输出结果 `FileSetFile` 对象：
- en: '[PRE34]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: How it works...
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 will create an association between the file and the file set, and
    then return a `FileSetFile` object once it is complete.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5将在完成后将文件与文件集之间创建关联，并返回一个 `FileSetFile` 对象。
- en: There's more...
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: 'Alternatively, if you don''t wish to load the file object, you can just provide
    the ID of the file that you are adding. Have a look at the following code snippet:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，如果您不想加载文件对象，只需提供您要添加的文件ID。请查看以下代码片段：
- en: '[PRE35]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: See also
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关内容
- en: The *Removing a file from a file set* recipe
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*从文件集中删除文件* 菜单'
- en: The *Checking if a file is part of a file set* recipe
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*检查文件是否属于文件集* 菜单'
- en: Removing a file from a file set
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从文件集中删除文件
- en: In addition to being able to add files to file sets, developers can also remove
    files from their file sets.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 除了能够将文件添加到文件集外，开发者还可以从他们的文件集中删除文件。
- en: Getting ready
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will again assume the existence of a file with an ID of `1`,
    as well as a file set with an ID of `1`. Make sure to adjust the code as needed
    for your own concrete5 instance.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在本菜谱中，我们将再次假设存在一个ID为`1`的文件，以及一个ID也为`1`的文件集。请确保根据您的concrete5实例调整代码。
- en: How to do it...
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些步骤：
- en: Open `/config/site_post.php` in your code editor, so that we can play with some
    arbitrary code.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中打开 `/config/site_post.php`，以便我们可以玩一些任意代码。
- en: 'Declare the file ID:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明文件ID：
- en: '[PRE36]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Declare the file set ID:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明文件集ID：
- en: '[PRE37]'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Load the file by its ID:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过其ID加载文件：
- en: '[PRE38]'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Load the file set by its ID:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过其ID加载文件集：
- en: '[PRE39]'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Remove the file from the file set:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从文件集中删除文件：
- en: '[PRE40]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: How it works...
  id: totrans-207
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 simply destroys the relationship between the file and the file set.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5简单地破坏了文件与文件集之间的关系。
- en: See also
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关内容
- en: The *Adding a file to a file set* recipe
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*将文件添加到文件集* 菜单'
- en: The *Checking if a file is part of a file set* recipe
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*检查文件是否属于文件集* 菜单'
- en: Checking if a file is part of a file set
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检查文件是否属于文件集
- en: Occasionally, developers may want to know if a file is a member of a certain
    file set. In this recipe, we will load a file, load a file set, and then find
    out if the file is a member of the given file set.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 开发者有时可能想知道一个文件是否是某个特定文件集的成员。在本菜谱中，我们将加载一个文件，加载一个文件集，然后找出该文件是否是给定文件集的成员。
- en: Getting ready
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: As usual, we will be assuming the existence of a file and a file set in this
    recipe. We will be using the ID of `1` for both the file and the file set, so
    be sure to make the necessary adjustments to the code to make this work in your
    own concrete5 system.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 如往常一样，在本菜谱中，我们将假设存在一个文件和一个文件集。我们将使用文件和文件集的ID `1`，所以请确保对代码进行必要的调整，以便在您的concrete5系统中运行。
- en: How to do it...
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些步骤：
- en: Open `/config/site_post.php` and clear any existing code.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 `/config/site_post.php` 并清除任何现有代码。
- en: 'Declare the ID of the file to be loaded:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要加载的文件ID：
- en: '[PRE41]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Declare the ID of the file set that we will be working with:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明我们将要处理的文件集ID：
- en: '[PRE42]'
  id: totrans-222
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Load the file by its ID:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过其ID加载文件：
- en: '[PRE43]'
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Load the file set by its ID:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过其ID加载文件集：
- en: '[PRE44]'
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'If the file is a member of the file set, output a `yes` message:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果文件是文件集的成员，输出一条 `yes` 消息：
- en: '[PRE45]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'If the file is not a member of the set, output `no`:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果文件不是集的成员，输出 `no`：
- en: '[PRE46]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: How it works...
  id: totrans-231
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 will do the heavy lifting of querying the database to find out if
    the file is a member of the given set.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5将执行查询数据库的繁重工作，以确定文件是否是给定集的成员。
- en: See also
  id: totrans-233
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关内容
- en: The *Adding a file to a file set* recipe
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*将文件添加到文件集* 菜单'
- en: The *Removing a file from a file set* recipe
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*从文件集中删除文件* 菜单'
- en: Getting all of the files in a file set
  id: totrans-236
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取文件集中的所有文件
- en: Now that we know how to load file sets and add files to them, we can learn how
    to get all of the files from a file set. We will be using the `FileList` class,
    which we first described earlier in this chapter.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道了如何加载文件集并将文件添加到其中，我们可以学习如何从文件集中获取所有文件。我们将使用 `FileList` 类，这是我们在此章中较早描述过的。
- en: Getting ready
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will continue working with the assumption that there is at least one file
    and one file set installed in concrete5, both with an ID of `1`. Make the necessary
    adjustments to the variables in this recipe to suit your own needs.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将继续假设在 concrete5 中至少安装了一个文件和一个文件集，它们的 ID 都是 `1`。请根据您的需求调整此配方中的变量。
- en: How to do it...
  id: totrans-240
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看以下步骤：
- en: Open `/config/site_post.php` in your code editor, removing any existing code
    that might be in there.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中打开 `/config/site_post.php`，移除其中可能存在的任何现有代码。
- en: 'Load the `FileList` model:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载 `FileList` 模型：
- en: '[PRE47]'
  id: totrans-244
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Create a new instance of the `FileList` model:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 `FileList` 模型的新实例：
- en: '[PRE48]'
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Declare the ID of the file set to filter by:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要过滤的文件集的 ID：
- en: '[PRE49]'
  id: totrans-248
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Load the file set:'
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件集：
- en: '[PRE50]'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Filter the list by the loaded file set:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过加载的文件集过滤列表：
- en: '[PRE51]'
  id: totrans-252
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Get an array of files in the file set:'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取文件集中的文件数组：
- en: '[PRE52]'
  id: totrans-254
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Loop through the array, printing each file''s path to the screen:'
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 遍历数组，将每个文件的路径打印到屏幕上：
- en: '[PRE53]'
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Refresh your website to see the results.
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 刷新您的网站以查看结果。
- en: How it works...
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this example, we are simply instantiating the `FileList` class, which will
    expose several methods to filter files. The method we are interested in is `filterBySet`.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，我们只是实例化 `FileList` 类，这将公开几个用于过滤文件的方法。我们感兴趣的方法是 `filterBySet`。
- en: We have to pass a `FileSet` object to this function and then we can call the
    `get` function, which will return an array of files that belong to that file set.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须传递一个 `FileSet` 对象给此函数，然后我们可以调用 `get` 函数，该函数将返回属于该文件集的文件数组。
- en: See also
  id: totrans-261
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Getting a list of files* recipe
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*获取文件列表的配方*'
- en: The *Loading a file set by its ID* recipe
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*通过 ID 加载文件集的配方*'
- en: Duplicating a file
  id: totrans-264
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 复制文件
- en: Just as in traditional file systems, concrete5 allows developers to duplicate
    files; in this recipe, we will load a file by its ID and then create a duplicate
    copy.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 正如传统的文件系统一样，concrete5 允许开发人员复制文件；在此配方中，我们将通过 ID 加载一个文件，然后创建一个副本。
- en: Getting ready
  id: totrans-266
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Be sure to adjust the file ID in this recipe to something that exists in your
    concrete5 database.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 请确保在此配方中调整文件 ID 以匹配您 concrete5 数据库中存在的 ID。
- en: How to do it...
  id: totrans-268
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看以下步骤：
- en: Open `/config/site_post.php` in your preferred code editor.
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您首选的代码编辑器中打开 `/config/site_post.php`。
- en: 'Declare the ID of the file to be duplicated:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要复制的文件的 ID：
- en: '[PRE54]'
  id: totrans-272
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Load the file by its ID:'
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件：
- en: '[PRE55]'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Duplicate the file:'
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制文件：
- en: '[PRE56]'
  id: totrans-276
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Dump the contents of the new copy, using our custom debugging function that
    we created in the chapter intro:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用我们在章节简介中创建的自定义调试函数，转储新副本的内容：
- en: '[PRE57]'
  id: totrans-278
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: How it works...
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 will create a carbon copy of the original file and return the new
    file once the function has completed.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 将创建原始文件的碳副本，并在函数完成后返回新文件。
- en: Deleting a file
  id: totrans-281
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 删除文件
- en: concrete5 allows developers to delete files through the PHP API. In this recipe,
    we will load a file by its ID and then delete it permanently.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 允许开发人员通过 PHP API 删除文件。在此配方中，我们将通过 ID 加载一个文件，然后永久删除它。
- en: Getting ready
  id: totrans-283
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Once a file has been deleted, it cannot be recovered. It is a good idea to experiment
    with a temporary or dummy file in this recipe so you do not delete anything important.
    This recipe will use the ID of `1` for the file to delete, but be sure to change
    this to something that you would be comfortable deleting.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦文件被删除，就无法恢复。在此配方中尝试使用临时或虚拟文件是一个好主意，这样您就不会删除任何重要的内容。此配方将使用 `1` 作为要删除的文件的 ID，但请确保将其更改为您愿意删除的任何内容。
- en: How to do it...
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看以下步骤：
- en: Open `/config/site_post.php` in your code editor.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中打开 `/config/site_post.php`。
- en: 'Declare the ID of the file to delete:'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要删除的文件的 ID：
- en: '[PRE58]'
  id: totrans-289
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Load the file by its ID:'
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件：
- en: '[PRE59]'
  id: totrans-291
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Delete the file:'
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除文件：
- en: '[PRE60]'
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: How it works...
  id: totrans-294
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 will delete the file from your server's file system, as well as remove
    the reference to it in the MySQL database.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 将从您的服务器文件系统中删除文件，并从 MySQL 数据库中删除对它的引用。
- en: Reindexing a file's search attributes
  id: totrans-296
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重新索引文件的搜索属性
- en: When changing a file's attributes programmatically, sometimes the concrete5
    search engine needs to be made aware of the new changes. In this exercise, we
    will reindex the search attributes for a file.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 当以编程方式更改文件属性时，有时 concrete5 搜索引擎需要知道新的更改。在这个练习中，我们将重新索引文件的搜索属性。
- en: Getting ready
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will assume that a file with an ID of `1` exists in your concrete5 installation.
    Please adjust the ID in this recipe to a file that exists.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将假设在您的 concrete5 安装中存在一个 ID 为 `1` 的文件。请将本菜谱中的 ID 调整为存在的文件。
- en: How to do it...
  id: totrans-300
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 看看以下步骤：
- en: Open `/config/site_post.php` in your code editor.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中打开 `/config/site_post.php` 文件。
- en: 'Declare the ID of the file to reindex:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要重新索引的文件 ID：
- en: '[PRE61]'
  id: totrans-304
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Load the file by its ID:'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件：
- en: '[PRE62]'
  id: totrans-306
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Reindex the search attributes:'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新索引搜索属性：
- en: '[PRE63]'
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: How it works...
  id: totrans-309
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: concrete5 will query the database and update the search index for the given
    file. This will make sure that the internal search engine is able to find a file
    based on its most current attributes.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 将查询数据库并更新给定文件的搜索索引。这将确保内部搜索引擎能够根据文件最新的属性找到文件。
- en: Setting passwords on file objects
  id: totrans-311
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在文件对象上设置密码
- en: concrete5 supports adding passwords to individual files, so site owners can
    restrict the download of these files to only those people who possess the shared
    password.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 支持向单个文件添加密码，因此网站管理员可以限制只有拥有共享密码的人才能下载这些文件。
- en: Getting ready
  id: totrans-313
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This recipe will continue with the assumption of a file with the ID of `1`.
    Please make sure to adjust this ID to match something that exists in your own
    concrete5 website.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 本菜谱将继续假设有一个 ID 为 `1` 的文件。请确保调整此 ID 以匹配您自己的 concrete5 网站中存在的某个文件。
- en: How to do it...
  id: totrans-315
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 看看以下步骤：
- en: Open `/config/site_post.php` so we have a place to try out this code.
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 `/config/site_post.php` 文件，以便我们有一个地方来尝试这段代码。
- en: 'Declare the file ID:'
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明文件 ID：
- en: '[PRE64]'
  id: totrans-319
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Load the file by its ID:'
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过 ID 加载文件：
- en: '[PRE65]'
  id: totrans-321
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Declare the password:'
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明密码：
- en: '[PRE66]'
  id: totrans-323
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Set the password on the file:'
  id: totrans-324
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件上设置密码：
- en: '[PRE67]'
  id: totrans-325
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: How it works...
  id: totrans-326
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: concrete5 will store the password in the database in plain text. Since this
    password is meant to be shared with several people, it is inherently insecure.
    As a result, concrete5 does not hash or encrypt the password for the file in the
    database. Once the password is set, the `on_file_set_password` event is fired.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 将以纯文本形式将密码存储在数据库中。由于此密码打算与多个人共享，因此它本质上是不安全的。因此，concrete5 不会在数据库中对文件密码进行散列或加密。一旦设置密码，就会触发
    `on_file_set_password` 事件。
- en: There's more...
  id: totrans-328
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: 'One can retrieve the password on a file by simply calling the `getPassword`
    function on the file:'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过在文件上调用 `getPassword` 函数来简单地检索文件的密码：
- en: '[PRE68]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: See also
  id: totrans-331
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关内容
- en: The *Loading a file by its ID* recipe
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*通过 ID 加载文件* 菜谱'
- en: Setting permissions on files
  id: totrans-333
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在文件上设置权限
- en: In the previous recipe, we discussed how to set a shared password on the file.
    Sometimes, though, more robust security is desired. For that, we can hook into
    the concrete5 permissions model to provide more advanced access control.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个菜谱中，我们讨论了如何在文件上设置共享密码。不过，有时人们希望有更健壮的安全性。为此，我们可以挂钩到 concrete5 权限模型以提供更高级的访问控制。
- en: In this recipe, we will give a user read access to a file.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 在本菜谱中，我们将给用户赋予文件的读取权限。
- en: Getting ready
  id: totrans-336
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: This example will assume the existence of a file with the ID of `1` and also
    of a user with an ID of `1`. Adjust those IDs as needed.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例将假设存在一个 ID 为 `1` 的文件和一个 ID 为 `1` 的用户。根据需要调整这些 ID。
- en: How to do it...
  id: totrans-338
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 看看以下步骤：
- en: Open `/config/site_post.php` in your code editor.
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中打开 `/config/site_post.php` 文件。
- en: 'Declare the ID of the file that we will be applying permissions to:'
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明我们将应用权限的文件 ID：
- en: '[PRE69]'
  id: totrans-342
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Load the file:'
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件：
- en: '[PRE70]'
  id: totrans-344
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Declare the ID of the user who will be receiving these permissions:'
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明将获得这些权限的用户 ID：
- en: '[PRE71]'
  id: totrans-346
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'Load the user:'
  id: totrans-347
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载用户：
- en: '[PRE72]'
  id: totrans-348
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Set the permissions on the file:'
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件上设置权限：
- en: '[PRE73]'
  id: totrans-350
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: There's more...
  id: totrans-351
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: 'concrete5 uses static constants for the permission modes (none, mine, and all).
    These constants are as follows:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5 使用静态常量来设置权限模式（无、我的和所有）。这些常量如下：
- en: '`FilePermissions::PTYPE_NONE`'
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FilePermissions::PTYPE_NONE`'
- en: '`FilePermissions::PTYPE_MINE`'
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FilePermissions::PTYPE_MINE`'
- en: '`FilePermissions::PTYPE_ALL`'
  id: totrans-355
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FilePermissions::PTYPE_ALL`'
- en: See also
  id: totrans-356
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关内容
- en: '[Chapter 7](ch07.html "Chapter 7. Working with Users and Permissions"), *Working
    With Users and Permissions*'
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第 7 章](ch07.html "第 7 章。与用户和权限一起工作"), *与用户和权限一起工作*'
- en: Getting the download URL for a file
  id: totrans-358
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取文件的下载URL
- en: concrete5 can enforce permissions on files as well as keep track of download
    statistics by funneling all download requests through a special URL. This also
    has the added advantage of serving the correct HTTP headers to force the download
    to the user's computer.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5可以通过将所有下载请求通过一个特殊URL来过滤，对文件执行权限控制以及跟踪下载统计数据。这也有额外的优势，即向用户计算机发送正确的HTTP头，强制下载。
- en: Getting ready
  id: totrans-360
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: As usual, we will have to assume the presence of a file with the ID of `1` in
    the file manager. Feel free to change this ID to something appropriate for your
    own website.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 如往常一样，我们必须假设文件管理器中存在一个ID为`1`的文件。请随意将此ID更改为适合您自己网站的适当ID。
- en: How to do it...
  id: totrans-362
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 看看以下步骤：
- en: Open `/config/site_post.php` in your favorite code editor.
  id: totrans-364
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您喜欢的代码编辑器中打开`/config/site_post.php`。
- en: 'Declare the ID of the file to load:'
  id: totrans-365
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明要加载的文件ID：
- en: '[PRE74]'
  id: totrans-366
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Load the file:'
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件：
- en: '[PRE75]'
  id: totrans-368
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Get the download URL:'
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取下载URL：
- en: '[PRE76]'
  id: totrans-370
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Output the download URL to the screen:'
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将下载URL输出到屏幕：
- en: '[PRE77]'
  id: totrans-372
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: How it works...
  id: totrans-373
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: concrete5 passes the download request through a special URL that is able to
    track permissions, downloads, and also send the correct HTTP headers for the download.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: concrete5通过一个能够跟踪权限、下载并能够发送正确HTTP头部的特殊URL来传递下载请求。
- en: See also
  id: totrans-375
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Loading a file by its ID* recipe
  id: totrans-376
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*通过ID加载文件*的菜谱'
- en: Getting the download statistics for a file
  id: totrans-377
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取文件的下载统计数据
- en: If you serve files using the download function described in the previous recipe,
    then the download numbers would be stored in the database. You can get these statistics
    using just a few lines of code.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用前面菜谱中描述的下载函数提供文件服务，那么下载次数将被存储在数据库中。您只需几行代码就可以获取这些统计数据。
- en: Getting ready
  id: totrans-379
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will assume that a file with an ID of `1` exists in the file manager. Change
    this variable as needed for your own concrete5 website.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将假设文件管理器中存在一个ID为`1`的文件。根据您自己的concrete5网站需要，相应地更改此变量。
- en: How to do it...
  id: totrans-381
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 看看以下步骤：
- en: Open `/config/site_post.php` in your preferred code editor.
  id: totrans-383
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您首选的代码编辑器中打开`/config/site_post.php`。
- en: 'Declare the ID of the file of which we want to get the statistics for:'
  id: totrans-384
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 声明我们想要获取统计数据的文件ID：
- en: '[PRE78]'
  id: totrans-385
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Load the file:'
  id: totrans-386
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载文件：
- en: '[PRE79]'
  id: totrans-387
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'Get the statistics array:'
  id: totrans-388
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取统计数据数组：
- en: '[PRE80]'
  id: totrans-389
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'Dump the contents of the array:'
  id: totrans-390
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将数组内容导出：
- en: '[PRE81]'
  id: totrans-391
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: How it works...
  id: totrans-392
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: When we call the `getDownloadStatistics` method of the file object, concrete5
    will return only the 20 most recent downloads by default. By providing `false`
    as the parameter, we are telling concrete5 to return all of the results.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们调用文件对象的`getDownloadStatistics`方法时，concrete5默认将只返回最近的20次下载。通过将`false`作为参数提供，我们告诉concrete5返回所有结果。
- en: Adding a file picker to a form
  id: totrans-394
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在表单中添加文件选择器
- en: When building applications in concrete5, you will often find yourself creating
    **CRUD** (create, read, update, delete) interfaces on the dashboard for site editors
    and administrators to manage custom content. In some instances, you may have to
    handle file uploads on these backend forms. A useful tool on such forms would
    be to provide an interface to browse the file manager, rather than using the standard
    HTML file input. concrete5 uses the asset library widget to facilitate this for
    us.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 在concrete5中构建应用程序时，您经常会发现自己需要在仪表板上创建**CRUD**（创建、读取、更新、删除）界面，以便网站编辑和管理员管理自定义内容。在某些情况下，您可能需要在这些后端表单上处理文件上传。在这样的表单上，提供一个用于浏览文件管理器的界面将是一个有用的工具，而不是使用标准的HTML文件输入。concrete5使用资产库小部件来为我们提供这种便利。
- en: Getting ready
  id: totrans-396
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this recipe, we will create a basic HTML form that will send the selected
    file ID from the file manager along with the form submission. The full code for
    this recipe is available for download from the book's website.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将创建一个基本的HTML表单，该表单将发送来自文件管理器的所选文件ID，以及表单提交。此菜谱的完整代码可以从本书的网站上下载。
- en: How to do it...
  id: totrans-398
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Have a look at the following steps:'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 看看以下步骤：
- en: Create a new single page (if it doesn't already exist) at `/single_pages/upload.php`.
  id: totrans-400
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`/single_pages/upload.php`中创建一个新的单页（如果尚未存在）。
- en: If you need to, add the single page to the sitemap, by visiting `/dashboard/pages/single`
    and entering `upload` as the page path.
  id: totrans-401
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果需要，通过访问`/dashboard/pages/single`并输入`upload`作为页面路径，将单个页面添加到网站地图中。
- en: 'In `upload.php`, load the asset Library helper:'
  id: totrans-402
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`upload.php`中，加载资产库助手：
- en: '[PRE82]'
  id: totrans-403
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Create an HTML form that outputs the file picker:'
  id: totrans-404
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个输出文件选择器的HTML表单：
- en: '[PRE83]'
  id: totrans-405
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: Create `/config/site_process.php` if it doesn't already exist.
  id: totrans-406
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果尚不存在，则创建 `/config/site_process.php`。
- en: 'Check to see if a file upload has occurred:'
  id: totrans-407
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查是否有文件上传发生：
- en: '[PRE84]'
  id: totrans-408
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'Inside the `if` statement, get the file ID of the chosen file:'
  id: totrans-409
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `if` 语句内部，获取所选文件的文件 ID：
- en: '[PRE85]'
  id: totrans-410
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Output the chosen file ID to the screen:'
  id: totrans-411
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将所选文件 ID 输出到屏幕：
- en: '[PRE86]'
  id: totrans-412
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE86]'
- en: How it works...
  id: totrans-413
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The asset Library helper will output all of the necessary HTML and JavaScript
    to provide a nice, modal interface for the user to select a file from the file
    manager (or upload a new file to the file manager). Once the user selects a file,
    the file ID will be added to a hidden input which has the name that you provided
    in the `file()` function's second parameter.
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 资产库助手将输出所有必要的 HTML 和 JavaScript，为用户提供一个优雅的模式界面，以便从文件管理器中选择文件（或上传新文件到文件管理器）。一旦用户选择了一个文件，文件
    ID 将被添加到一个隐藏的输入框中，该输入框的名称与您在 `file()` 函数的第二参数中提供的名称相同。
- en: Once the user submits the form surrounding the file selector, the file ID will
    be included in the `$_POST` array (in this example, it would be in `$_POST['file_id']`),
    which you can then use for further storage or processing on the server side.
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦用户提交了围绕文件选择器的表单，文件 ID 将包含在 `$_POST` 数组中（在这个例子中，它将在 `$_POST['file_id']` 中），然后您可以在服务器端进行进一步存储或处理。
- en: There's more...
  id: totrans-416
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: 'You can also bring up a file manager window that is limited to only images.
    Use the following code to accomplish this:'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以调出一个仅限于图像的文件管理器窗口。使用以下代码来完成此操作：
- en: '[PRE87]'
  id: totrans-418
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: You may notice that the only change here is that, instead of calling `file()`
    on the `asset` `library` class, we call `image()`. This will do the same exact
    thing as `file()`, except limit the modal window to contain only images.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能会注意到这里唯一的改变是，我们不是在 `asset` `library` 类上调用 `file()`，而是调用 `image()`。这将与 `file()`
    做完全相同的事情，但会将模式窗口限制为仅包含图像。
- en: See also
  id: totrans-420
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Uploading a file to the file manager* recipe
  id: totrans-421
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*上传文件到文件管理器* 菜单'
