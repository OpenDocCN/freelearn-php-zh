- en: '16'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '16'
- en: Avoiding Sleepless Nights – Moodle Backup and Restore
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 避免失眠之夜 – Moodle备份和恢复
- en: Your Moodle application will contain important data such as coursework, assignments,
    grades, and all administrative data, for example, users, cohorts, and roles. Therefore,
    you must have a good backup strategy in place.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 您的Moodle应用程序将包含重要数据，例如课程作业、作业、成绩以及所有管理数据，例如用户、群体和角色。因此，您必须制定良好的备份策略。
- en: Preparing for the unexpected is always a good strategy when dealing with information
    systems, and having well-preserved backups allows for full application recovery
    upon unexpected hardware or software failures. Systems are not expected to fail,
    but there’s always a possibility for failure, and a good strategy for fast recovery
    ensures a low impact on users. This chapter presents strategies and options for
    managing backups and auto-backups of your data.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理信息系统时，为意外情况做好准备总是一个好的策略，并且拥有良好的备份可以确保在意外硬件或软件故障后完全恢复应用程序。我们并不期望系统会失败，但总是存在失败的可能性，而快速恢复的良好策略可以确保对用户的影响最小。本章介绍了管理备份和自动备份数据策略和选项。
- en: 'Moodle itself supports two types of backups:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle本身支持两种类型的备份：
- en: '**Course-level backups**: Course backups are usually ad hoc and only archive
    the selected course. You will learn how to create course backups, restore courses,
    and copy course content using the related course import facility.'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**课程级备份**：课程备份通常是临时的，并且仅归档所选课程。您将学习如何创建课程备份、恢复课程以及使用相关的课程导入功能复制课程内容。'
- en: '**Site-level backups**: The site backup option saves all courses and related
    data to a specified location at regular intervals. You will learn how to set this
    up and recover data from it.'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**站点级备份**：站点备份选项定期将所有课程和相关数据保存到指定的位置。您将学习如何设置此选项并从中恢复数据。'
- en: 'Both mechanisms will be covered in detail before we look at **system-level
    backups**, including Moodle backups (covering the Moodle software and the data
    stored in it) and snapshot creation (full system images). The three backup types
    are shown in the following diagram and are at the core of this chapter:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们查看**系统级备份**之前，包括Moodle备份（涵盖Moodle软件及其中的数据）和快照创建（完整系统镜像）之前，我们将详细介绍这两种机制。以下图表显示了三种备份类型，并构成了本章的核心：
- en: '![Figure 16.1 – Moodle backups ](img/Figure_16.01_B18779.jpg)'
  id: totrans-8
  prefs: []
  type: TYPE_IMG
  zh: '![图16.1 – Moodle备份](img/Figure_16.01_B18779.jpg)'
- en: Figure 16.1 – Moodle backups
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.1 – Moodle备份
- en: 'We will conclude this chapter by looking at two applications that use backup
    and restore facilities: planning year-end procedures and implementing course templates.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过查看两个使用备份和恢复功能的应用程序来结束本章：规划年终程序和实施课程模板。
- en: 'We will cover the following main topics in this chapter:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主要内容：
- en: Managing course-level backups
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理课程级备份
- en: Managing site-level backups
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理站点级备份
- en: Managing system-level backups
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理系统级备份
- en: Using backup and restore for alternative tasks
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用备份和恢复进行替代任务
- en: Managing course-level backups
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理课程级备份
- en: Course-level backups allow teachers and administrators to create copies of courses
    for safekeeping or to pass on to colleagues. If configured appropriately, course
    backups can save an administrator a lot of hassle and time.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 课程级备份允许教师和管理员创建课程副本以备安全或传给同事。如果配置得当，课程备份可以为管理员节省大量麻烦和时间。
- en: Important note
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Course backups include some or all of the items of a course.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 课程备份包括课程的一些或全部项目。
- en: First, we will look at the backup procedure before going into the details of
    recovering data during the restore operation.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在详细讨论恢复操作期间的数据恢复细节之前，我们将查看备份过程。
- en: Creating course backups
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建课程备份
- en: To back up an individual course, it is best if you are inside that course, where
    you have to select the **Course reuse** option in the course menu and then select
    **Backup** from the dropdown.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 要备份单个课程，最好是在该课程内部，在那里您需要在课程菜单中选择**课程重用**选项，然后从下拉菜单中选择**备份**。
- en: 'The backup procedure comprises five steps, illustrated in the following workflow:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 备份过程包括以下五个步骤，如图所示的工作流程：
- en: '![Figure 16.2 – Course backup workflow ](img/Figure_16.02_B18779.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![图16.2 – 课程备份工作流程](img/Figure_16.02_B18779.jpg)'
- en: Figure 16.2 – Course backup workflow
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.2 – 课程备份工作流程
- en: You can navigate back to any step via the process links at the top of the screen
    or the navigation buttons at the bottom. We will go through the steps one by one
    in the following subsections.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过屏幕顶部的流程链接或底部的导航按钮导航回任何步骤。我们将在以下子节中逐一介绍这些步骤。
- en: Initial settings
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 初始设置
- en: 'Several settings determine how the backup will be performed and what type of
    information will be included:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 几个设置决定了备份将如何执行以及将包含哪些类型的信息：
- en: '![Figure 16.3 – Course backup – Initial settings ](img/Figure_16.03_B18779.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图16.3 – 课程备份 – 初始设置](img/Figure_16.03_B18779.jpg)'
- en: Figure 16.3 – Course backup – Initial settings
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.3 – 课程备份 – 初始设置
- en: 'Some settings are only available if other settings have been activated; for
    example, **Include user role assignments** can only be ticked if enrolled users
    are included. Most options are self-explanatory, but two options require some
    commentary:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 一些设置仅在其他设置已被激活时才可用；例如，**包含用户角色分配**只能在已注册用户被包含时勾选。大多数选项都是自我解释的，但有两个选项需要一些说明：
- en: If `Jonny Walker` might become `anonfirstname69 anonlastname69`.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果`Jonny Walker`可能会变成`anonfirstname69 anonlastname69`。
- en: In addition to the standard Moodle backup format, **IMS Common Cartridge 1.1**
    is a special format that’s supported. For more information on IMS CC, please consult
    the Moodle Docs at [docs.moodle.org/en/IMS_Common_Cartridge_import_and_export](http://docs.moodle.org/en/IMS_Common_Cartridge_import_and_export).
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除了标准的Moodle备份格式外，**IMS通用课程包1.1**是一个受支持的特定格式。有关IMS CC的更多信息，请参阅Moodle文档[docs.moodle.org/en/IMS_Common_Cartridge_import_and_export](http://docs.moodle.org/en/IMS_Common_Cartridge_import_and_export)。
- en: 'By default, all options can be selected for all users who have the appropriate
    permissions in the course context. If you wish to change the default values and/or
    lock specific settings (such as **Include course logs**, as shown in the previous
    screenshot), go to **Site administration** | **Courses** | **Backups** | **General**
    **backup defaults**:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，所有用户都可以选择具有适当权限的课程环境中的所有选项。如果您希望更改默认值和/或锁定特定设置（如前一个屏幕截图所示的**包含课程日志**），请转到**网站管理**
    | **课程** | **备份** | **常规备份默认值**：
- en: '![Figure 16.4 – Course backup default settings ](img/Figure_16.04_B18779.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![图16.4 – 课程备份默认设置](img/Figure_16.04_B18779.jpg)'
- en: Figure 16.4 – Course backup default settings
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.4 – 课程备份默认设置
- en: For every setting, there are two checkboxes. The first represents the parameter’s
    default, whereas the second value indicates whether it is locked or not. Locking
    allows you to force specific settings, for instance, the exclusion of users.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个设置，都有两个复选框。第一个代表参数的默认值，而第二个值表示是否锁定。锁定允许您强制特定设置，例如，排除用户。
- en: 'There are usually two types of course backups that you are likely to perform:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 通常您可能会执行两种类型的课程备份：
- en: '**Content-only backups**'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内容仅备份**'
- en: As the name suggests, this type of backup only contains content that can be
    passed on to another person without transferring any information about its users,
    roles, grades, and so on. To perform a content-only backup, you must deselect
    **Include enrolled users**, which is a prerequisite for all user-related backup
    options.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 如其名称所示，此类备份仅包含可以传递给他人而无需转移任何关于其用户、角色、成绩等信息的内容。要执行内容仅备份，您必须取消选择**包含已注册用户**，这是所有与用户相关的备份选项的前提条件。
- en: A content-only backup is the best option if you wish to pass a course on to
    other educators or make it available for download. Another use case is to create
    a new instance of a course for yourself, for example, taking a course backup from
    one semester to use in a different semester. When you publish courses on a community
    hub or MoodleNet (refer to [*Chapter 19*](B18779_19.xhtml#_idTextAnchor344), *Setting
    Up Moodle Networking*), you will also create a content-only backup.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望将课程传递给其他教育工作者或使其可供下载，内容仅备份是最佳选项。另一个用例是为您自己创建一个课程的全新实例，例如，从一个学期备份课程以用于不同的学期。当您在社区中心或MoodleNet上发布课程时（参考[*第19章*](B18779_19.xhtml#_idTextAnchor344)，*设置Moodle网络*），您也将创建一个内容仅备份。
- en: Important note
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: By default, users with teaching rights can only perform content-only backups.
    This restriction can be changed via the `moodle/backup:userinfo` capability, but
    it should be done carefully.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，具有教学权限的用户只能执行内容仅备份。此限制可以通过`moodle/backup:userinfo`能力进行更改，但应谨慎操作。
- en: '**Full-course backups**'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**完整课程备份**'
- en: If you wish to back up a course for potential recovery purposes, you should
    create a full-course backup, which includes user data (for example, forum posts),
    course data, and user information. To do this, you can leave all the settings
    at their default values and use the **Jump to final** **step** button.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望为潜在恢复目的备份课程，您应该创建完整的课程备份，包括用户数据（例如，论坛帖子）、课程数据和用户信息。为此，您可以保留所有设置在默认值，并使用
    **跳转到最终** **步骤** 按钮。
- en: If you wish to back up the course logs, the **Include course logs** setting
    must be enabled. Remember that logs can be massive and often exceed multiple gigabytes
    when you’re backing up several courses.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望备份课程日志，必须启用 **包含课程日志** 设置。请记住，日志可能非常大，在备份多个课程时通常超过多个吉字节。
- en: 'Before we move on to the next screen, a note of caution: some third-party course-level
    plugins (activities, blocks, or filters) might not support backups. If you encounter
    any issues, you will have to exclude items created by these from the backup or,
    better, avoid the plugin altogether.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们进入下一个屏幕之前，请注意：一些第三方课程级别插件（活动、块或过滤器）可能不支持备份。如果您遇到任何问题，您将不得不从备份中排除这些插件创建的项目，或者更好的是，完全避免使用该插件。
- en: Schema settings
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 架构设置
- en: 'All learning resources and activities are shown in the order in which they
    appear in the course. Resources are only available if the **Include activities**
    parameter has not been deactivated on the previous screen. By default, all the
    available elements are selected; if you wish to exclude any individual items,
    you have to deselect them. Additionally, you can exclude/include all the items
    of a section by selecting/deselecting the section name itself:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 所有学习资源和活动都按照它们在课程中出现的顺序显示。资源仅在 **包含活动** 参数在上一屏幕未被禁用的情况下可用。默认情况下，所有可用元素都被选中；如果您希望排除任何单个项目，您必须取消选中它们。此外，您可以通过选择/取消选择节名称本身来排除/包含该节的所有项目：
- en: '![Figure 16.5 – Course backup – Schema settings ](img/Figure_16.05_B18779.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![图 16.5 – 课程备份 – 架构设置](img/Figure_16.05_B18779.jpg)'
- en: Figure 16.5 – Course backup – Schema settings
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16.5 – 课程备份 – 架构设置
- en: Moodle distinguishes between **course content** and **user data**. For example,
    the forum description and all its settings are classified as course content in
    a forum activity. In contrast, all topics, posts, and replies to a forum are classified
    as user data. If the **Include enrolled users** option has been left activated
    on the initial setup screen, user data can be included/excluded for each selected
    activity and resource.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 区分 **课程内容** 和 **用户数据**。例如，论坛描述及其所有设置在论坛活动中被归类为课程内容。相比之下，所有论坛主题、帖子和对论坛的回复都被归类为用户数据。如果
    **包含已注册用户** 选项在初始设置屏幕上被激活，可以为每个选定的活动和资源包含/排除用户数据。
- en: Selecting the **Next** button will take you to the last course backup configuration
    screen.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 **下一步** 按钮将带您进入最后一个课程备份配置屏幕。
- en: Confirmation and review
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 确认和审查
- en: 'The third screen lets you choose the backup filename and review the items to
    be included in the archive. The format of the default **Filename** is as follows:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 第三屏幕允许您选择备份文件名并审查要包含在存档中的项目。默认 **文件名** 的格式如下：
- en: '[PRE0]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: At the time of writing, `<type>` is always set to `<format>` is `–nu` parameter
    stands for no users, and `-an` is an indicator for anonymous users.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本文时，`<type>` 总是设置为 `<format>`，其中 `–nu` 参数表示无用户，而 `-an` 是匿名用户的指示符。
- en: 'If you have opted to create `.imscc` extension will be used instead of `.mbz`:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您选择创建 `.imscc` 扩展名，将使用 `.mbz` 扩展名：
- en: '![Figure 16.6 – Course backup – Confirmation and review ](img/Figure_16.06_B18779.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![图 16.6 – 课程备份 – 确认和审查](img/Figure_16.06_B18779.jpg)'
- en: Figure 16.6 – Course backup – Confirmation and review
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16.6 – 课程备份 – 确认和审查
- en: Moodle creates a bespoke file format for backups, known as the `.mbz` extension.
    A Moodle backup file is a compressed file (in `.tgz` format) that consists of
    an XML file (which describes the file’s content) and the actual content, users,
    log data, and so on.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 为备份创建了一个专有的文件格式，称为 `.mbz` 扩展名。Moodle 备份文件是一个压缩文件（`.tgz` 格式），由一个 XML 文件（描述文件内容）和实际内容、用户、日志数据等组成。
- en: The additional **Backup settings** section shows which item has been selected
    and deselected on the initial settings screen. The **Included items** section
    indicates, with a green tick, all resources and activities that will be included,
    as well as any user data that will be part of the course backup. A red cross means
    that the item has been deselected, whereas a red cross followed by a lock indicates
    that it wasn’t possible to select the item since a prerequisite has not been fulfilled.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 附加的**备份设置**部分显示了在初始设置屏幕上选择了哪些项和未选择哪些项。**包含项**部分通过绿色勾选标记显示所有将被包含的资源、活动以及任何将成为课程备份一部分的用户数据。红色叉号表示该项已被取消选择，而红色叉号后面跟着一个锁表示由于没有满足先决条件，无法选择该项。
- en: Once you press the **Perform backup** button, the Moodle course archive will
    be created.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您按下**执行备份**按钮，Moodle课程存档将被创建。
- en: Finalizing the backup
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 完成备份
- en: The created archive file is saved in the **Course backup** area. This process
    can take a few minutes, depending on the volume of data being backed up. If the
    **Anonymize user data** setting was chosen at the beginning, the backup file will
    be placed in the **User private** **backup** area.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 创建的存档文件保存在**课程备份**区域。这个过程可能需要几分钟，具体取决于备份的数据量。如果最初选择了**匿名化用户数据**设置，备份文件将放置在**用户私有**
    **备份**区域。
- en: Important note
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Moodle backups include the course configuration, which contains course settings,
    activity arrangements, and block positions.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle备份包括课程配置，其中包含课程设置、活动安排和块位置。
- en: After completion, a brief status message is shown; you will have to take appropriate
    actions if this contains any errors or warnings.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，会显示一条简短的状态消息；如果其中包含任何错误或警告，您将需要采取适当的行动。
- en: 'Backups sometimes fail on large courses, and the cause is usually that the
    backup process runs out of time or memory. If this happens, you have two options
    that are not mutually exclusive:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 备份有时会在大型课程上失败，原因通常是备份过程耗尽时间或内存。如果发生这种情况，您有两个选项，这两个选项不是互斥的：
- en: First, you can increase the **Extra PHP memory limit** setting by going to **Server**
    | **Performance**.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 首先，您可以通过访问**服务器** | **性能**来增加**额外PHP内存限制**设置。
- en: 'Second, you can choose **Enable synchronous backups** by going to **Site administration**
    | **Courses** | **Backups** | **Asynchronous backup/restore**, which triggers
    Moodle to execute backups (and restores) as a separate background process:'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其次，您可以通过访问**网站管理** | **课程** | **备份** | **异步备份/恢复**来选择**启用同步备份**，这将触发Moodle以单独的后台进程执行备份（和恢复）：
- en: '![Figure 16.7 – Asynchronous backup/restore ](img/Figure_16.07_B18779.jpg)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![图16.7 – 异步备份/恢复](img/Figure_16.07_B18779.jpg)'
- en: Figure 16.7 – Asynchronous backup/restore
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.7 – 异步备份/恢复
- en: Asynchronous backups only allow a user to have one pending backup for a resource
    at a time. Multiple asynchronous backups of the same resource can’t be queued,
    as this would likely result in multiple backups that contain the same content.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 异步备份每次只允许用户为同一资源有一个待处理的备份。同一资源的多个异步备份不能排队，因为这可能会导致包含相同内容的多个备份。
- en: If you wish to notify the user who initiated the course backup when the process
    is completed, choose **Enable message notifications** and customize the **Subject**
    and **Message** properties of the notification that will be sent out.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望在过程完成后通知启动课程备份的用户，请选择**启用消息通知**并自定义将要发送的通知的**主题**和**消息**属性。
- en: This concludes this section on creating course backups. The reverse operation
    – restoring course backups – is the topic of the following section.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 这就结束了关于创建课程备份的部分。相反的操作——恢复课程备份——是下一节的主题。
- en: Restoring course backups
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 恢复课程备份
- en: To wholly or partly restore a previously backed up course, it is best if you
    are inside that course, where you have to select the **Course reuse** option in
    the course menu and then select **Restore** from the dropdown. Alternatively,
    you can navigate to **Site administration** | **Courses** | **Restore course**.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 要完全或部分恢复之前备份的课程，最好是在该课程内部进行，在那里您需要在课程菜单中选择**课程重用**选项，然后从下拉菜单中选择**恢复**。或者，您可以导航到**网站管理**
    | **课程** | **恢复课程**。
- en: 'Once you have selected a `.mbz` file, the restore procedure comprises seven
    steps, illustrated in the following diagram:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您选择了一个`.mbz`文件，恢复过程包括以下七个步骤，如图所示：
- en: '![Figure 16.8 – Course restore workflow ](img/Figure_16.08_B18779.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![图16.8 – 课程恢复工作流程](img/Figure_16.08_B18779.jpg)'
- en: Figure 16.8 – Course restore workflow
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16.8 – 课程恢复工作流程
- en: As with the backup workflow, you can navigate back to any step via the process
    links at the top of the screen or using the navigation buttons at the bottom.
    We will go through the steps one by one in the following subsections.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 与备份工作流程类似，您可以通过屏幕顶部的流程链接或使用底部的导航按钮返回到任何步骤。我们将在以下子节中逐一介绍这些步骤。
- en: File selection and confirmation
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 文件选择和确认
- en: 'Moodle stores its backup files in different `.mbz` file to be restored, as
    shown in the following screenshot:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 将其备份文件存储在不同的 `.mbz` 文件中以便恢复，如下截图所示：
- en: '![Figure 16.9 – Course backup areas ](img/Figure_16.09_B18779.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![图 16.9 – 课程备份区域](img/Figure_16.09_B18779.jpg)'
- en: Figure 16.9 – Course backup areas
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16.9 – 课程备份区域
- en: 'The four locations for Moodle archives are as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 存档的四个位置如下：
- en: '**Import backup file**: Archives that are usually stored outside of Moodle
    and selected via the file picker or drag’n’drop'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导入备份文件**：通常存储在 Moodle 之外并通过文件选择器或拖放选择的存档'
- en: '**Course backup area**: Archives created using default settings are stored
    in this area'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**课程备份区域**：使用默认设置创建的存档存储在此区域'
- en: '**User private backup area**: Archives with anonymized users are stored here'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户私有备份区域**：存储匿名用户的存档'
- en: '**Automated backups**: Archives that are created automatically (see the *Site*
    *backups* section)'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动备份**：自动创建的存档（见 *站点* *备份* 部分）'
- en: In the preceding example, a single course is present in the course backup area,
    called `backup-moodle2-course-14-packt_backup-20220712-2001.mbz`. From its filename,
    we already know that the course ID is 14, its name is Packt Backup, and that it
    was backed up on July 12, 2022, at 20:01.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，课程备份区域中只有一个课程，称为 `backup-moodle2-course-14-packt_backup-20220712-2001.mbz`。从其文件名中，我们已知道课程
    ID 是 14，其名称是 Packt Backup，并且它在 2022 年 7 月 12 日 20:01 进行了备份。
- en: Select the `.mbz` file), **Backup settings** (identical to the initial settings
    in the backup), and **Course details**. Once you have confirmed this information-only
    screen, you have to specify where you wish to recover the backup.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 `.mbz` 文件）、**备份设置**（与备份中的初始设置相同）和**课程详情**。一旦确认了这个仅包含信息屏幕，您就必须指定您希望恢复备份的位置。
- en: Selecting the restore destination
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选择恢复目标
- en: 'There are various options for restoring a course backup:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复课程备份有多种选项：
- en: '**Restore as a** **new course**'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**作为新课程恢复**'
- en: '**Restore into this course** and merge the backup into this course'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**恢复到本课程**并将备份合并到本课程中'
- en: '**Restore into this course**, delete the contents of this course, and then
    restore it'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**恢复到本课程**，删除本课程的内容，然后恢复它'
- en: '**Restore into an existing course** and merge the backup into the selected
    course'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**恢复到现有课程**并将备份合并到所选课程中'
- en: '**Restore into an existing course**, delete its contents, and then restore:'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**恢复到现有课程**，删除其内容，然后恢复：'
- en: '![Figure 16.10 – Course restore – Destination](img/Figure_16.10_B18779.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图 16.10 – 课程恢复 – 目标](img/Figure_16.10_B18779.jpg)'
- en: Figure 16.10 – Course restore – Destination
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16.10 – 课程恢复 – 目标
- en: If you wish to **Restore as a new course**, you will have to select a category
    in which the new course will be created. You must use the provided search facility
    if the number of categories exceeds 20\. Alternatively, you can choose the current
    course as the destination (**Restore into this course**). You can either combine
    the current course content with the backup (**Merge the backup course into this
    existing course**) or replace it (**Delete the contents of this course and then
    restore**). If you choose the merging option and an activity or resource with
    the same name exists, both will be kept and not overridden. The third option is
    to restore the course to another existing course, which you have to select. The
    same options (merge and replace) exist to restore the backup in the current course.
    Make sure you click on the correct **Continue** button before you proceed.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您希望**作为新课程恢复**，您将不得不选择一个新课程将被创建的分类。如果分类数量超过 20 个，您必须使用提供的搜索功能。或者，您可以选择当前课程作为目标（**恢复到本课程**）。您可以选择将当前课程内容与备份合并（**将备份课程合并到现有课程中**）或替换它（**删除本课程的内容然后恢复**）。如果您选择合并选项，并且存在同名活动或资源，两者都将被保留，不会覆盖。第三种选项是将课程恢复到另一个现有课程，您必须选择它。在当前课程中恢复备份时，也存在相同的选项（合并和替换）。在继续之前，请确保点击正确的**继续**按钮。
- en: Restore settings
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 恢复设置
- en: The **Restore settings** screen shows all the available options that were selected
    during the backup process (refer to the preceding *Initial settings* section).
    As shown earlier, the choices made here determine the types of data that will
    be recovered, and which type of content will be offered for further selection.
    Also, most options have prerequisites that are identical to their backup counterparts.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '**恢复设置**屏幕显示了在备份过程中选择的所有可用选项（参见图16.1节中的*初始设置*）。如前所述，这里所做的选择决定了将要恢复的数据类型以及将提供哪种类型的内容供进一步选择。此外，大多数选项都有与备份相对应的先决条件。'
- en: If you wish to change the default values and/or lock specific settings, go to
    **Site administration** | **Courses** | **Backups** | **General restore defaults**.
    For every parameter, there are two checkboxes. The first represents the setting’s
    default, whereas the second value indicates whether it is locked or not. Locking
    allows you to force specific settings, for instance, the exclusion of users.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想更改默认值和/或锁定特定设置，请转到**站点管理** | **课程** | **备份** | **通用恢复默认值**。对于每个参数，都有两个复选框。第一个代表设置的默认值，而第二个值表示是否锁定。锁定允许您强制特定设置，例如，排除用户。
- en: The backup schema
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备份架构
- en: 'Depending on your choices on the previous two screens, the schema step lets
    you specify several course settings. If you restore the backup to an existing
    course, you have the option to overwrite its settings. These are **Course name**,
    **Course short name**, and **Course start date**. You can further choose to **Keep
    current roles and enrolments** (if these are part of the backup), **Keep current
    groups and groupings** (if stored in the backup), and use the course settings
    of the backup file instead of the current ones (**Overwrite** **course configuration**):'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 根据前两个屏幕上的选择，架构步骤允许您指定几个课程设置。如果您将备份恢复到现有课程，您可以选择覆盖其设置。这些是**课程名称**、**课程简称**和**课程开始日期**。您还可以选择**保留当前角色和注册**（如果这些是备份的一部分），**保留当前分组和分组**（如果存储在备份中），以及使用备份文件的课程设置而不是当前设置（**覆盖**
    **课程配置**）：
- en: '![Figure 16.11 – Course restore – Schema](img/Figure_16.11_B18779.jpg)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![图16.11 – 课程恢复 – 架构](img/Figure_16.11_B18779.jpg)'
- en: Figure 16.11 – Course restore – Schema
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.11 – 课程恢复 – 架构
- en: You must also choose which content and user data to include in the recovery
    procedure. The selection mechanism is very similar to the backup equivalent described
    earlier. By default, all the data that is present is selected. If you wish to
    narrow down the data to be restored, you must manually deselect items.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 您还必须选择在恢复过程中包含哪些内容和用户数据。选择机制与前面描述的备份类似。默认情况下，所有现有数据都被选中。如果您想缩小要恢复的数据，您必须手动取消选中项目。
- en: Finalizing restore
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 完成恢复
- en: After the final familiar-looking **Review** screen, the restore process is initiated
    once the **Perform restore** button is pressed. Any selected data will be recovered
    to the chosen destination. After completion, a summary message is shown.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在最终的看起来熟悉的**审查**屏幕之后，一旦按下**执行恢复**按钮，就会启动恢复过程。任何选定的数据都将恢复到所选目的地。完成后，将显示一个总结消息。
- en: 'If the restored course contains any roles that do not exist on your Moodle
    system, a role mappings step will be shown, where you must map roles manually
    to ensure consistency:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如果恢复的课程包含任何在您的Moodle系统中不存在的角色，将显示一个角色映射步骤，您必须手动映射角色以确保一致性：
- en: '![Figure 16.12 – Course restore – Restore role mappings ](img/Figure_16.12_B18779.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![图16.12 – 课程恢复 – 恢复角色映射](img/Figure_16.12_B18779.jpg)'
- en: Figure 16.12 – Course restore – Restore role mappings
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.12 – 课程恢复 – 恢复角色映射
- en: 'This completes this section on restoring course backups. Before we move on
    to site backups, let’s cover a feature closely related to course restore: course
    import.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了关于恢复课程备份的这部分内容。在我们继续到站点备份之前，让我们了解一下与课程恢复密切相关的功能：课程导入。
- en: Importing course data
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 导入课程数据
- en: It is sometimes necessary to copy data from one course to another. To achieve
    this, Moodle provides the **import course data** feature. However, unlike the
    backup function, it will not import user data, such as assignment submissions
    or forum posts – it will only import the structure of activities, blocks, and
    filters. For example, you might want to import a single quiz from one course to
    another.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 有时需要从一个课程复制数据到另一个课程。为了实现这一点，Moodle提供了**导入课程数据**功能。然而，与备份功能不同，它不会导入用户数据，如作业提交或论坛帖子——它只会导入活动、块和过滤器的结构。例如，您可能希望从一个课程导入一个单独的测验到另一个课程。
- en: Teachers can import content from courses for which they have editing rights;
    as an administrator, this restriction does not apply. This mechanism bypasses
    the requirement for a backup and restore procedure if you want to copy course
    content from one course to another and do not require user data.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 教师可以导入他们有编辑权限的课程内容；作为管理员，此限制不适用。此机制绕过了从一门课程复制内容到另一门课程且不需要用户数据时的备份和恢复程序的要求。
- en: To copy course data, you need to be inside the receiving course, where you have
    to select the **Course reuse** option in the course menu and then select **Import**
    from the dropdown.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 要复制课程数据，您必须位于接收课程内，在那里您必须在课程菜单中选择**课程重用**选项，然后从下拉菜单中选择**导入**。
- en: 'The import procedure comprises six steps, as illustrated in the following workflow:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 导入过程包括六个步骤，如下所示的工作流程所示：
- en: '![Figure 16.13 – Course import workflow ](img/Figure_16.13_B18779.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图16.13 – 课程导入工作流程](img/Figure_16.13_B18779.jpg)'
- en: Figure 16.13 – Course import workflow
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.13 – 课程导入工作流程
- en: 'As with the backup and restore workflows, you can navigate back to any step
    via the process links at the top of the screen or the navigation buttons at the
    bottom. Since the course import feature is effectively a subset of the course
    backup and restore functionality, we will only briefly mention each step in the
    process:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 与备份和恢复工作流程一样，您可以通过屏幕顶部的流程链接或底部的导航按钮返回到任何步骤。由于课程导入功能实际上是课程备份和恢复功能的一个子集，因此我们只需简要提及过程中的每个步骤：
- en: '**Course selection**: You must select a course from which you wish to import
    content. Use the provided search facility if the list exceeds 10 courses (default
    value). You can also select the current course; this way, you can duplicate multiple
    activities.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**课程选择**：您必须选择一个您希望从中导入内容的课程。如果列表超过10门课程（默认值），请使用提供的搜索功能。您还可以选择当前课程；这样，您可以复制多个活动。'
- en: '**Initial settings**: Choose which course items you wish to import. Note the
    absence of user-related options.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**初始设置**：选择您希望导入的课程项目。注意用户相关选项的缺失。'
- en: '**Schema settings**: A familiar screen for selecting topics and activities.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模式设置**：一个用于选择主题和活动的熟悉屏幕。'
- en: '**Confirmation and review**: Import settings and included items are shown.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**确认和审查**：显示导入设置和包含的项目。'
- en: '**Perform import**: Go, go, go!'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行导入**：去，去，去！'
- en: '**Complete**: A summary message is shown.'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**完成**：显示摘要信息。'
- en: If you wish to change the default values and/or lock specific settings, go to
    **Site administration** | **Courses** | **Backups** | **General import defaults**.
    There are two checkboxes for every setting, and the same logic applies as for
    the backup and restore defaults. On this screen, you can also specify the **Maximum
    number of courses listed for** **import** option.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想更改默认值并/或锁定特定设置，请转到**网站管理** | **课程** | **备份** | **通用导入默认值**。每个设置都有两个复选框，并且与备份和恢复默认值的逻辑相同。在此屏幕上，您还可以指定**导入**选项的**最大课程列表数量**。
- en: Importing concludes this section on course-level archives, where the focus has
    been on creating and restoring individual course backups. To automate this process
    across courses, site-level backups are needed, which we will cover in the following
    section.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 导入结束本节关于课程级存档的内容，本节重点在于创建和恢复单个课程备份。为了跨课程自动化此过程，需要网站级备份，我们将在下一节中介绍。
- en: Managing site-level backups
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理网站级备份
- en: So far, we have dealt with backing up single courses. Site-level backups perform
    the same operation for every course in your system, including hidden courses and
    the home page.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经处理了备份单个课程。网站级备份对您系统中的每个课程执行相同的操作，包括隐藏课程和主页。
- en: Before we look at backup reports and notifications, we will configure automated
    backups. We will conclude this section with some backup strategies.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们查看备份报告和通知之前，我们将配置自动备份。我们将以一些备份策略结束本节。
- en: Configuring automated backups
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置自动备份
- en: 'Go to **Site administration** | **Courses** | **Backups** | **Automated backup
    setup** to schedule site backups. Here, you will see the following settings:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 前往**网站管理** | **课程** | **备份** | **自动备份设置**以安排网站备份。在这里，您将看到以下设置：
- en: '![Figure 16.14 – Automated backup configuration ](img/Figure_16.14_B18779.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![图16.14 – 自动备份配置](img/Figure_16.14_B18779.jpg)'
- en: Figure 16.14 – Automated backup configuration
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.14 – 自动备份配置
- en: The remainder of the configuration page covers **Automated backup settings**,
    which specify which elements will be included in the backup. These are identical
    to the initial backup settings, except for the anonymize option, which has been
    excluded.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 配置页面的其余部分涵盖了**自动备份设置**，这些设置指定了哪些元素将包含在备份中。这些设置与初始备份设置相同，除了匿名化选项已被排除。
- en: 'For the backup to start automatically at the specified time, the `cron` process
    must be configured correctly, which we covered in [*Chapter 1*](B18779_01.xhtml#_idTextAnchor020),
    *Installing Moodle*. Alternatively, you can initiate the backup process via the
    CLI, which executes the same script that’s called by the `cron` process. The command
    execution from the shell or for the inclusion in scripts is as follows (assuming
    the Apache user is `www-data`):'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使备份在指定的时间自动开始，必须正确配置`cron`进程，这在[*第1章*](B18779_01.xhtml#_idTextAnchor020)，*安装Moodle*中已介绍。或者，您可以通过CLI启动备份过程，CLI执行与`cron`进程相同的脚本。从shell或用于脚本中的命令执行如下（假设Apache用户是`www-data`）：
- en: '[PRE1]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Recovering courses from an automated backup is identical to restoring data from
    course-level backup archives.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 从自动备份中恢复课程与从课程级备份存档中恢复数据相同。
- en: To ensure that the backups are running correctly, Moodle provides a backup report
    and notifications, which we will explain in the following subsection.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保备份运行正确，Moodle提供了一个备份报告和通知，我们将在下一个小节中解释。
- en: Backup reports and notifications
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 备份报告和通知
- en: 'As a Moodle administrator, you must ensure that the backup execution has been
    successful. For this purpose, Moodle provides a backup report, which you can find
    by going to **Site administration** | **Reports** | **Backups**. It shows a log
    of the last execution:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 作为Moodle管理员，您必须确保备份执行已成功。为此，Moodle提供了一个备份报告，您可以通过访问**网站管理** | **报告** | **备份**来找到它。它显示了上次执行的日志：
- en: '![Figure 16.15 – Automated backup configuration ](img/Figure_16.15_B18779.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![图16.15 – 自动备份配置](img/Figure_16.15_B18779.jpg)'
- en: Figure 16.15 – Automated backup configuration
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.15 – 自动备份配置
- en: The report provides details for each **Course** being backed up, namely **Time
    taken** (start and end time), **Status**, and the date and time of its **Next
    backup**.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 报告提供了每个正在备份的**课程**的详细信息，即**耗时**（开始和结束时间）、**状态**以及其**下一次备份**的日期和时间。
- en: Courses in which there hasn’t been any activity for 30 days – that is, no changes
    have been made to the course content, and no users have used the course – are
    excluded from the automated backup, and the status is shown as **Skipped**.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 30天内没有任何活动的课程（即课程内容没有变化，也没有用户使用课程）将被排除在自动备份之外，状态显示为**跳过**。
- en: As a Moodle administrator, you will receive an email after the scheduled site-level
    backup has been completed. It provides details on the total number of courses
    backed up and a split of how many course backups were okay, contained errors,
    were unfinished, and were skipped. Ensure your email settings have been configured
    correctly (refer to [*Chapter 10*](B18779_10.xhtml#_idTextAnchor204), *Configuring
    Technical Features*). It is highly recommended that you check the content of this
    email every day.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在计划中的站点级备份完成后，作为Moodle管理员，您将收到一封电子邮件。它提供了备份课程总数以及课程备份是否正常、包含错误、未完成或被跳过的详细信息。请确保您的电子邮件设置已正确配置（参考[*第10章*](B18779_10.xhtml#_idTextAnchor204)，*配置技术功能*）。强烈建议您每天检查这封电子邮件的内容。
- en: To ensure the smooth and reliable execution of your automated backups, you must
    have an adequate backup strategy in place, which we will discuss next.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保自动备份的平稳和可靠执行，您必须有一个适当的备份策略，我们将在下面讨论。
- en: The backup strategy
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 备份策略
- en: 'There are several issues to consider when running automatic site-wide Moodle
    backups:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行自动的全站Moodle备份时，有几个问题需要考虑：
- en: '**Backup content**: Ensure that everything included in the archives is needed,
    and anything that is not required is excluded. Do you have to back up the entire
    logs and gradebook history every night?'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**备份内容**：确保存档中包含的每一项都是必需的，并且任何不必要的内容都被排除。您是否需要每晚备份整个日志和成绩册历史记录？'
- en: '**Backup size**: The size of the backup files can be potentially huge (multiple
    gigabytes). Ensure that you only keep the number of backups that are required
    and your setup can cope with.'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**备份大小**：备份文件的大小可能非常大（多个吉字节）。请确保您只保留所需的备份数量，并且您的设置可以处理。'
- en: '**Backup timing**: The backup operation is a CPU and hard disk-intensive operation.
    Make sure you schedule its execution when the load on the site is relatively low.
    If you run multiple sites on the same server, it is recommended to time-stagger
    backups or create a script that uses the described CLI. An alternative approach
    is to set up a dedicated backup server.'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**备份时间**：备份操作是一个CPU和硬盘密集型操作。确保您在网站负载相对较低时安排其执行。如果您在同一服务器上运行多个网站，建议错开备份时间或创建一个使用所述CLI的脚本。另一种方法是设置一个专门的备份服务器。'
- en: '**Backup frequency**: Do you need seven daily backups, or are weekly backups
    sufficient? Are there periods (such as weekends) when you can switch off the backup
    facility altogether?'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**备份频率**：您需要每天备份七次，还是每周备份就足够了？是否存在可以完全关闭备份设施的时间段（例如周末）？'
- en: '**Backup location**: By default, all backup files are saved to the respective
    courses, which means that the backups are held on the same server as Moodle. If
    you have to recover multiple courses, you must locate each archive separately,
    a potentially mind-numbing and time-consuming exercise.'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**备份位置**：默认情况下，所有备份文件都保存在相应的课程中，这意味着备份存储在与Moodle相同的服务器上。如果您必须恢复多个课程，您必须分别定位每个存档，这可能是一项令人头疼且耗时的任务。'
- en: You might want to consider storing your backups on an external device (external
    disk, NAS drive, SAN, and so on). An alternative to this approach is to mount
    a backup device and include its content in the organization-wide backup.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能希望考虑将备份存储在外部设备上（外部硬盘、NAS驱动器、SAN等）。此方法的替代方法是挂载备份设备并将其内容包含在组织范围内的备份中。
- en: Site-level backups are a great way to automate course backups and simplify educators’
    lives. However, they only back up courses, not the entire system. While this is
    sufficient if you have to recover a single course or some activities, it is insufficient
    in a disaster scenario when the entire system has to be recovered.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 站点级别的备份是自动化课程备份和简化教育工作者生活的好方法。然而，它们只备份课程，而不是整个系统。虽然如果您需要恢复单个课程或某些活动时这已经足够，但在整个系统需要恢复的灾难场景中就不够了。
- en: Important note
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You should not use the course backup facility as your sole backup system.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 您不应将课程备份设施作为您唯一的备份系统。
- en: Instead, system-level backups should be used as a supplement, which we will
    look at next.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，应将系统级别的备份用作补充，我们将在下一部分探讨。
- en: Managing system-level backups
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理系统级别的备份
- en: System-level backups cannot be configured or executed from within Moodle. Instead,
    they must be set up at the system level. If your system is hosted externally,
    there is a possibility that you will not have access to the system level, which
    will prevent you from performing this type of backup. Unless the host already
    runs system-level backups on your behalf, it is time to change to another provider!
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 系统级别的备份不能从Moodle内部配置或执行。相反，它们必须在系统级别设置。如果您的系统托管在外部，您可能无法访问系统级别，这将阻止您执行此类备份。除非托管方已经代表您运行系统级别的备份，否则是时候更换提供商了！
- en: 'There are two types of system backups that are not mutually exclusive:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种类型的系统备份，它们不是互斥的：
- en: '**Moodle backups**: These create an archive of Moodle itself, the application
    data, and any application configuration'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle备份**：这些创建Moodle本身、应用程序数据和任何应用程序配置的存档。'
- en: '**Snapshots**: These create an image of the system, which is used for disaster
    recovery if the system has to be rolled back in its totality'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**快照**：这些创建系统的镜像，如果系统需要完全回滚，则用于灾难恢复。'
- en: We will briefly cover both approaches in the following two subsections.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的两个小节中简要介绍这两种方法。
- en: Moodle backups
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Moodle备份
- en: 'Moodle distinguishes between the application software and the data stored in
    it. The advantage of this separation becomes apparent when creating backups: a
    software backup is only required when an update has been installed or customization
    is taking place, whereas data should be backed up more frequently.'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 区分了存储在其中的应用程序软件和其中存储的数据。当创建备份时，这种分离的优势变得明显：只有当安装了更新或正在进行定制时才需要软件备份，而数据应更频繁地备份。
- en: Backing up the `moodle`). Most administrators would create a single archive
    of the directory for easier handling (in Unix, simply use `tar -cvf <backupfile>`).
    This step is usually only required before a system upgrade or when you need to
    archive your entire system.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 备份 `moodle`。大多数管理员会创建一个目录的单个存档以方便处理（在 Unix 中，只需使用 `tar -cvf <backupfile>`）。这一步通常只在系统升级之前或需要存档整个系统时才需要。
- en: 'Moodle stores its data in two separate locations:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle将其数据存储在两个不同的位置：
- en: '`mysqldump` shell command for MySQL and MariaDB to create a single backup file:'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于MySQL和MariaDB创建单个备份文件的`mysqldump` shell命令：
- en: '[PRE2]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '`<username>` has to be replaced with the database username, `–p` will ask you
    for a password, and `–h <databasehost>` is only required if the database is located
    on a separate server. The `<database>` option is the name of the database, and
    `<backup-file>` is the name of the archive to be created. It is common practice
    to use the `.``sql` extension.'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`<username>`必须替换为数据库用户名，`-p`将提示你输入密码，而`-h <databasehost>`仅在数据库位于单独的服务器上时才需要。《database》选项是数据库名称，而`<backup-file>`是要创建的存档的名称。使用`.sql`扩展名是常见做法。'
- en: 'To recover the database dump, use the following `mysql` shell command:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 要恢复数据库转储，请使用以下`mysql` shell命令：
- en: '[PRE3]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: For other database types, refer to the respective administration guides.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 对于其他数据库类型，请参阅相应的管理指南。
- en: '**Moodle data directory ($CFG->dataroot)**: This is where all contributed files
    reside – for instance, submitted assignments, language customizations, user profile
    pictures, videos, and so on. Like the Moodle system, all you have to do is create
    a copy of the directory and all its subdirectories. It is crucial to stop Apache
    while performing the backup to guarantee that the content does not go out of sync.'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Moodle数据目录（$CFG->dataroot）**：这是所有贡献文件所在的地方——例如，提交的作业、语言定制、用户个人资料图片、视频等等。就像Moodle系统一样，你只需要创建目录及其所有子目录的副本。在执行备份时停止Apache至关重要，以确保内容不会不同步。'
- en: The advantage of this approach is that it is less resource-intensive, can be
    scripted, and recovering the entire Moodle system is far more straightforward.
    However, it is impossible to retrieve individual activities without setting up
    a temporary server, as is possible with course backups.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的优点是它资源消耗较少，可以脚本化，并且恢复整个Moodle系统要简单得多。然而，如果不设置临时服务器，就无法检索单个活动，这与课程备份不同。
- en: Snapshot creation
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 快照创建
- en: Creating snapshots is only briefly mentioned here for completeness as it is
    not a Moodle administrator role but a system administrator task. However, you
    should ensure that such a mechanism is set up in case of hardware failures or
    other system issues.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完整性，这里简要提及创建快照，因为它不是Moodle管理员角色，而是系统管理员任务。然而，你应该确保在硬件故障或其他系统问题发生时设置了这样的机制。
- en: A snapshot is an image of the entire partition(s) on the hard disk(s) that contain(s)
    the Moodle software itself, as well as all the data (database and data directory).
    The advantage of the snapshot is that the entire system can be rolled back to
    the point when the image was created. However, any data that has been added or
    modified since this point in time will be overridden. Snapshots cannot be used
    to recover a single course or parts thereof but to fully replace the system.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 快照是包含Moodle软件本身以及所有数据（数据库和数据目录）的整个硬盘分区（s）的镜像。快照的优点是整个系统可以回滚到创建镜像时的点。然而，从那时起添加或修改的数据将被覆盖。快照不能用于恢复单个课程或其部分，而是完全替换系统。
- en: Important note
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: No matter what combination of backups you choose, frequently verify that the
    backup procedure is working. There is nothing worse than a false sense of security
    – that is, assuming that all your data is backed up when it isn’t!
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你选择哪种备份组合，都要经常验证备份过程是否正常工作。没有什么比虚假的安全感更糟糕了——也就是说，假设你的所有数据都已备份，而实际上并没有！
- en: 'This concludes this section on site-wide backups, which covered Moodle backups
    and snapshots. The following checklist provides a quick summary of the backup
    and restore configurations that should be taken care of:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分关于网站范围备份的讨论到此结束，涵盖了Moodle备份和快照。以下清单提供了一个关于备份和恢复配置的快速总结，应该注意以下事项：
- en: '![Figure 16.16 – Backup checklist ](img/Figure_16.16_B18779.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![图16.16 – 备份清单](img/Figure_16.16_B18779.jpg)'
- en: Figure 16.16 – Backup checklist
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图16.16 – 备份清单
- en: We will finish this chapter by looking at two use cases that utilize Moodle’s
    backup and restore features.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过查看两个利用Moodle备份和恢复功能的用例来结束本章。
- en: Using backup and restore for alternative tasks
  id: totrans-193
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用备份和恢复进行其他任务
- en: 'While the prime purpose of backups is the recovery of data in case of loss,
    some applications can be carried out using the techniques covered in this chapter.
    We will briefly describe two of them: year-end procedure and course templates.'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然备份的主要目的是在数据丢失的情况下恢复数据，但可以使用本章中介绍的技术执行一些应用程序。我们将简要描述其中两个：年终程序和课程模板。
- en: Planning the year-end procedure
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 规划年终程序
- en: 'Most organizations have some sort of year-end procedure in place, which might
    be at the end of an academic year, a term, the financial year, or, in the case
    of roll-on-roll-off setups, every month. Given the nature and importance of the
    procedure, each step should be planned well in advance. The key considerations
    are as follows:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数组织都有一套年终程序，这可能是学年末、学期末、财年末，或者在滚动进出设置的情况下，每月一次。鉴于程序的性质和重要性，每个步骤都应该提前做好规划。关键考虑因素如下：
- en: When do you run the year-end procedure?
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您何时运行年终程序？
- en: What has to be done?
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要做什么？
- en: Who is involved?
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 谁参与其中？
- en: Where will the archives go?
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 归档将存放在哪里？
- en: 'The following is a list of typical steps that might or might not apply to your
    setup. It gives you an idea of how such a procedure may look and demonstrates
    the importance of the backup facility:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一系列典型的步骤，这些步骤可能适用于也可能不适用于您的设置。它为您提供了此类程序可能看起来如何的思路，并展示了备份功能的重要性：
- en: '**Archive**: Create full backups of all courses and consider including a system
    backup. Ensure archives are stored on a separate medium.'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**归档**：创建所有课程的完整备份，并考虑包括系统备份。确保归档存储在单独的介质上。'
- en: '**Grade export**: Export grades course by course to store them on your student
    management information system.'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**成绩导出**：按课程导出成绩以存储在您的学生管理信息系统上。'
- en: '**Course reset**: Use the reset feature at the course level to remove any user
    data. (Resetting courses can also be done in batch mode. Refer to the *Managing
    courses in bulk* section in [*Chapter 4*](B18779_04.xhtml#_idTextAnchor074), *Managing
    Courses* *and Enrolments*.)'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**课程重置**：使用课程级别的重置功能来删除任何用户数据。（重置课程也可以批量进行。请参阅[*第4章*](B18779_04.xhtml#_idTextAnchor074)中的*批量管理课程*部分，*管理和注册课程*。）'
- en: '**Delete users**: Remove users who have left the organization or disable their
    accounts.'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**删除用户**：删除已离开组织的用户或禁用他们的账户。'
- en: '**Next-year preparation**: Hide or delete obsolete courses and add new courses.
    Add new users and assign roles to courses.'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**下一年的准备**：隐藏或删除过时的课程，并添加新课程。添加新用户并为课程分配角色。'
- en: This is only a crude outline of tasks to be considered. Ensure you have a detailed
    plan for this type of exercise before you kick off the year-end procedure.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 这只是一个粗略的任务清单，供您考虑。在启动年终程序之前，请确保您有一个详细的计划。
- en: Implementing course templates
  id: totrans-208
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实施课程模板
- en: 'There is often a requirement to create course templates, which are used as
    a basis to create multiple courses. This process might be in an organization that
    emphasizes the homogeneity of course structure and layout or an education establishment
    that wants to simplify the work of its course creators. The steps to achieve this
    are as follows:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 常常需要创建课程模板，这些模板用作创建多个课程的基础。这个过程可能是在强调课程结构和布局同质化的组织中，或者是在希望简化其课程创建者工作的教育机构中。实现这一目标的步骤如下：
- en: Create a course that will become your course template.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建将成为您课程模板的课程。
- en: Add all the elements (activities, resources, filters, blocks, and so on) to
    the course, change its settings, and arrange the content as required.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将所有元素（活动、资源、过滤器、块等）添加到课程中，更改其设置，并按要求安排内容。
- en: Create a content-only backup of the course.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建课程的内容备份。
- en: You can now use the restore mechanism to create as many courses from this template
    as you wish. (This operation can also be done in batch mode. Refer to the *Managing
    courses in bulk* section in [*Chapter 4*](B18779_04.xhtml#_idTextAnchor074), *Managing
    Courses* *and Enrolments*.)
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '您现在可以使用恢复机制从这个模板中创建尽可能多的课程。（此操作也可以批量进行。请参阅[*第4章*](B18779_04.xhtml#_idTextAnchor074)中的*批量管理课程*部分，*管理和注册课程*。） '
- en: Alternatively, use the **Copy course** feature in the **Course reuse** menu
    at the course level instead of performing *Steps 3* and *4*. However, course copying
    cannot be done in batch mode.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 或者，您可以在课程级别的**课程重用**菜单中使用**复制课程**功能，而不是执行*步骤3*和*步骤4*。然而，课程复制不能批量进行。
- en: Optionally, you can grant users appropriate rights to the course so that they
    can use the import facility.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，您可以授予用户对课程的适当权限，以便他们可以使用导入功能。
- en: The preceding list requires you to perform some manual steps to implement a
    course templating mechanism. You may find more user-friendly approaches in the
    Moodle plugin database at [moodle.org/plugins](http://moodle.org/plugins), such
    as **Kickstart** ([moodle.org/plugins/format_kickstart](http://moodle.org/plugins/format_kickstart)).
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 上述列表要求您执行一些手动步骤以实现课程模板机制。您可以在 Moodle 插件数据库 [moodle.org/plugins](http://moodle.org/plugins)
    中找到更多用户友好的方法，例如 **Kickstart** ([moodle.org/plugins/format_kickstart](http://moodle.org/plugins/format_kickstart))。
- en: Summary
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we dealt with various Moodle backup alternatives. You learned
    how to create course-level, site-level, and system-level backups, as well as how
    to perform data recovery from each type. Your Moodle backup strategy must fit
    in with your organization’s overall disaster recovery plan. We also saw some applications
    that use the covered backup and restore facilities.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了各种 Moodle 备份替代方案。您学习了如何创建课程级别、站点级别和系统级别的备份，以及如何从每种类型中执行数据恢复。您的 Moodle
    备份策略必须与您组织的整体灾难恢复计划相匹配。我们还看到了一些使用所涵盖的备份和恢复功能的应用程序。
- en: Moodle offers a good range of backup and restore options. Ensure that they are
    configured correctly and run test recoveries to be on the safe(r) side. There
    is nothing worse than a false sense of security – that is, assuming that all your
    data is backed up when it isn’t!
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: Moodle 提供了一系列良好的备份和恢复选项。确保它们配置正确，并运行测试恢复以确保安全。没有什么比虚假的安全感更糟糕了——也就是说，假设当数据实际上没有备份时，所有数据都已备份！
- en: In the next chapter, we will cover a collection of useful and not-so-useful
    Moodle admin tools.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍一系列有用和不太有用的 Moodle 管理工具。
