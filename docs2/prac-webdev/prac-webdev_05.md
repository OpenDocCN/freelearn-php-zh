# 第五章：PHP

在上一章中，我们讨论了使用 JavaScript 作为语言进行客户端编程。这一章完全是关于**服务器端编程**，我们将学习用于此目的的编程语言是 PHP。

PHP 最初是由拉斯马斯·勒德夫（Rasmus Lerdorf）开发的，他将其称为**个人主页**。如今，这三个字母代表的是**PHP：超文本预处理器**。它是一种功能齐全的编程语言，是解释执行的，而不是编译的（我们现在知道这意味着什么）。

在我不断提到的那个 6 个月课程中，当我们最终到达 PHP 部分时，我期待着一个全新的、未探索的主题，一个新的前沿。作为一个程序员，我准备大胆地走向没有人——尤其是我自己——曾经去过的地方。然而，所有元素对我来说都是如此熟悉。

当我向人们解释这个经历时，我把这比作遇到一个 15 年未见的女友，并意识到你仍然喜欢她。奇怪的是，去年发生了一件类似的事情，这次是一个女友。

对 PHP 的熟悉不仅涉及语言本身，与 C 编程语言相似，而且还特别涉及与语言一起提供的所有函数。其中许多与你在 UNIX 系统标准 C 库中找到的相同实用函数相同。

# PHP 简介

正如我们提到的，PHP，就像 JavaScript 一样，是一种解释执行的编程语言。因此，我们首先需要一个解释器。对于 JavaScript 来说，这很简单，解释器在任何一个浏览器中都有。对于 PHP 来说，你需要一个单独的程序来解释你的代码。假设你在电脑上有一个名为`php`的程序（我在我的 Mac 上有一个），你可以在其中输入 PHP 代码或提供包含代码的文件，然后我们就可以编写我们的第一个程序。

我们第一个，不那么有用的例子：使用你最喜欢的编辑器，创建一个名为`first.php`的文件，并输入以下文本：

```php
<?php
echo "Hello, world";
?>
```

注意字符串`<?php`和`?>`。通常，PHP 代码放置在这两个字符串之间。所以这两个例子实际上只包含了一行 PHP 代码。

因此，如果你在你的电脑上有那个`php`程序（如果你没有，不要慌张，你不需要一个），你可以输入`php first.php`，你会在屏幕上看到`Hello, world`出现。

由于 PHP 是一种功能齐全的语言，你可以用它以这种方式为你的项目创建独立的程序。然而，这并不是你购买这本书的原因，也不是我们将要教你的语言的方式。

## 我们的第一个真正的 PHP 程序

我们将使用 PHP 来创建**动态网页**。简单来说，这些是嵌入 PHP 代码的 HTML 页面。PHP 解释器将取走你的代码，进行解释，并用程序的结果替换它。生成的修改后的 HTML 文档将不再包含 PHP 代码；那个纯 HTML 文件将是浏览器看到的。这里有一个很好的例子：

```php
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title><?php echo "Hello, world"; ?></title>
</head>
<body>
<?php
echo '<h1>Hello, World</h1>' ;
?>
</body>
<html>
```

一旦解释器完成了它的任务，这个文件的 内容将会转换成我们第二章中的第一个示例的精确行，*HTML*，这就是浏览器所看到的。

注意，在带有`<title>`标签的行中，我们在 HTML 标签内嵌入了 PHP 代码。你可以这样做。我们例子中的第二行带有 PHP 代码的部分是一个 PHP 语句块的一部分。这使得它更容易阅读。

那么，这有什么用呢？你在开玩笑吧。我们已经走了三个章节的路，而你所能做的只是告诉我用十种不同的方式来写`Hello, world`？

当然 PHP 是有用的。嵌入到你的 HTML 文件中的 PHP 代码可以是一个 while 循环（是的，PHP 也有这个），从文件或数据库中提取数据，并使用这些数据构建干净的 HTML 代码来生成多个 HTML 页面。所有这些都可以用几行 PHP 代码完成。但我们如何让它工作呢？好吧，我们首先需要做一些准备工作。

# PHP 和网络托管

到目前为止，除了在浏览器的请求下从服务器加载文件到浏览器之外，所有的事情都是由浏览器完成的，这是**网络服务器**做的——更准确地说，是一个 HTTP 请求。

需要下载的文件由 URL 决定，即用户输入的网页地址，或者他们点击的链接；在这种情况下，`www.sitename.com/demo.html`（或`demo.php`）。

一旦 HTML 文件被加载到浏览器中，其中的所有内容都会被读取，包括带有`href`和`src`属性的`<img>`、`<script>`和`<link>`标签。浏览器会列出它还需要更多的文件，并变成一个小奥利弗·退斯特，说“请服务器，我能再要点吗？”

一旦所有这些代码都准备好了，浏览器就知道如何处理它，并在用户的电脑或平板电脑上渲染网页。`script`和`style`标签帮助你区分哪些是纯 HTML，哪些是 CSS 或 JavaScript。

现在究竟是怎么把这些文件弄到那里的，*那里*又是哪里呢？它们到了那里，又回来了，因为`www.sitename.com`这个名字背后有一台计算机和一个叫做**网络托管**的服务。

## 网络托管 101

我们一直推迟解释这部分，因为我们到目前为止可以用我们的例子而不需要真正的网站。使用 PHP，这将会不同，所以这是概述如果你想要一个人们可以访问的自己的网站需要采取哪些步骤的地方。

## 域名

你首先需要给你的网站起一个名字。实际上你需要的是一个**域名**。网站不能有你想取的任何名字，而且两个网站不能有相同的名字。所以，如果你想叫你的管道公司网站为`joe.theplumber.com`，这不会自动发生。

你希望使用一家网络托管公司来帮你完成这件事。

## 网络托管公司

网络托管公司不仅能为您提供域名和注册服务，他们还会（收取费用）在他们的计算机上为您设置一个服务器，这些计算机每周 7 天，每天 24 小时运行——简称为 24/7。这样，世界上任何有互联网连接的人都可以随时访问您的网站。

我不能用自己的电脑来设置我的网站吗？是的，您可以，但一旦您关闭它并离开家，就没有人能访问您的网站了，这并不是您想要的。

域名通常是`www.`后面跟着代表一个人或公司的字符串，然后是一个表示涉及的组织类型或所在国家的可用结尾。一开始，这些结尾只有几个：`.com`、`.org`、`.net`、`.gov`等等。这个列表仍在扩展。

您可以访问一些网站，例如，访问`dns.be`查看您选择的域名是否仍然可用。我选择了[paulpwellens.com](http://paulpwellens.com)，因为`paulwellens.com`已经被一位英国橄榄球运动员占用。嗯，我既不是英国人，也不是橄榄球运动员。

几年后，当我回到比利时后，`paulwellens.be`变得可用。我以我的名义注册了一年，但后来我放弃了它，因为我看不出保留两个不同名称的必要性，更糟糕的是，两个不同的托管公司。但如果你愿意，你可以为单个网站拥有多个域名。

## 服务器端设置

一旦您的网络托管公司为您设置好，它将提供必要的信息，以便您可以将您的网页文件转移到您的网站上。这通常包括：

+   您网站的域名（当然）

+   FTP 地址（一个 IP 地址或简单地是相同的域名）

+   登录名和密码

+   文件夹的名称，例如 `public_html`

使用这些信息，您可以使用 FTP 协议将您在计算机上开发的网页转移到您自己的网站上。这意味着您需要在您的计算机或平板电脑上有一个可以处理该协议的程序。对于大多数基于 UNIX 的系统（如 Mac OS、Linux）来说，这很自然，平板电脑上有一些很酷的 FTP 应用程序，同时 Windows 也存在 FTP 客户端。

FTP 代表**文件传输协议**。在您的计算机或平板电脑上使用或安装一个所谓的 FTP 客户端，它将允许您在客户端和主机之间传输文件，通常一次传输一个文件。如果您想批量传输文件，FileZilla 是一个不错的选择。而且，还有更多的好消息，许多酷的 HTML 编辑器和其他工具都内置了 FTP 功能。

服务器上存放您网站主页的文件夹，在我们的例子中是`public_html`，通常被称为您的文档根目录。

## 附加的服务器端服务

我们刚才描述的正是你需要的一切，没有其他东西，来设置一个静态网站。如果你计划使用其他东西，而且你确实会使用，那么检查你考虑的网站托管公司提供的附加服务非常重要。最基本设置将连接你到一个支持 HTTP 和 FTP 协议的 Web 服务器。你还需要确保以下内容可用：

+   PHP - 检查 PHP 的版本

+   MySQL 服务器 - 也请检查版本

+   PHPMyAdmin - 一个易于管理 MySQL 数据库的工具

大多数供应商都会提供某种类型的面板，CPanel 是其中流行的一个，用于访问和配置这些服务。服务器本身通常运行 Linux 或 MacOS 作为操作系统，Apache 作为 web 服务器，并支持 MySQL 和 PHP。在 `www` 领域，这种组合通常被称为 LAMP 架构。拥有自己的 LAMP 会怎样呢？

## PHP 开发环境

我们刚才描述的设置基本上没有问题，但它有一个主要的不便之处：你的网站总是会看起来像是在进行中。在这个环境中，你测试工作结果的唯一方法是通过使用 FTP 上传你的更改到网站，并作为你自己的网站的访客。很可能时不时会出现一些问题；即使是微小的错误也可能造成巨大的损害。

因此，你需要在电脑上设置一个本地开发环境。这样，你就可以在稳定、经过测试的代码里程碑到达时，定期更新你的网站。在此期间，你可以开发新功能，进行实验，学习新事物，以及所有这些美好的事情。

为了能够本地开发和测试你的 PHP 应用程序，你需要：

+   运行 MacOS、Linux 或 Windows 的计算机（在撰写本文时，平板电脑上没有可行的 PHP 环境）

+   支持 PHP 的 Apache 网络服务器

+   一个好的代码编辑器，一个完整的 **集成开发环境**（**IDE**），或者介于两者之间的工具

我个人喜欢 Adobe Dreamweaver。它做了我需要的一切，没有多余的东西。它让我可以查看我的页面/应用程序并在本地测试它们，只需点击鼠标即可通过 FTP 连接到服务器，并且它的编辑器可以识别 HTML 标签、CSS 属性以及 JavaScript 和 PHP 关键字。但它不是免费的。有几个 IDE 是免费的。

无论哪种方式，你应该将构成你网站的文件都存储在本地目录中，你的本地文档根目录（例如，`$HOME/Sites/mysitename`），并使用以 `localhost` 开头的 URL 在本地进行测试。在 Mac 上，这将是 `http://localhost/~username/sitename/filename.php`

现在，让我们回到语言本身。就像我们对 JavaScript 所做的那样，我们将遍历 PHP 中所有可用的成分，你可以使用它们来编写 PHP 程序。为了避免重复，我们不会重复两种语言中相同的内容，但会指出它们之间的差异。在适当的地方，我们将按照相同的顺序进行。

# PHP 作为一种网络开发语言

因此，现在我们准备好使用 PHP 编写网络程序，在本地运行和测试它们，并将它们放置在你网络托管公司管理的服务器上；简而言之——开发和部署。

我们专注于使用 PHP 动态生成网页。在 PHP 代码被解释后，剩下的就是 HTML，你应该将其视为在服务器上生成并由客户端渲染的文本字符串。用于生成这些页面的数据要么来自外部文件，要么来自数据库。

当你的网站被邀请时，访客会与之互动。可能会有一个需要填写的表单，一个需要点击的按钮，从几个选择中做出选择，等等。访客的这种干预结果需要以某种方式返回服务器并处理，所有这些都可以再次被视为文本字符串。处理完毕后，它要么返回客户端通知访客，要么需要存储在某个地方。那个地方也将是服务器上的文件或数据库。

虽然我一直在宣称，并且我是认真的，这本书不应该用作参考，但我们包括了一个关于字符串和文件相关内容的简短参考，因为你们每天都需要它们。数据库是下一章的主题。

## 变量、值、运算符和表达式

好吧，你可以说在 PHP 中，每个变量都会让你损失一美元，因为每个变量名都必须以一个`$`符号开始，一个美元符号。如果这个小小的文字游戏能帮助我们记住 JavaScript 和 PHP 变量之间的重要区别，那么我们都会随着时间的推移节省很多美元。

```php
<?php
$counter = 0;
$hello = "Hello, world";
?>
```

PHP 中没有`var`关键字来声明变量。你可以在初始化它们时开始使用它们。就像在 JavaScript 中一样，没有严格的类型，你可以使用数字和字符串值；PHP 也使用函数，并且运算符相同，除非你想拼接字符串。然而，关于变量作用域的故事是不同的。

### 变量作用域

就像在 JavaScript 中一样，变量的作用域，即变量在程序中已知并可访问的区域，是一个非常重要的事情需要理解。与 JavaScript 相比，使用了不同的关键字。我已经提到过没有`var`关键字。相反，我们有两个新的关键字——全局和静态。

#### 局部变量

局部变量可以在声明它们的函数内部访问。这就像在 JavaScript 中，但没有`var`关键字。让我们再次在至少三行中生成数字`3`：

```php
<?php
function three()
{
$a = 1;
$b = 2;
$c = $a + $b ;
echo $c;
}
?>
```

这只是简单地产生`3`。如果我们想在函数外部使用变量`$c`在`echo`语句中，它将不会产生任何东西。是的，你听到的，什么都没有——不是未定义的，不是 0，没有错误信息，就是什么都没有，但以某种方式，它是一个空字符串。

这里还有一个例子。这次它甚至不计算`3`：

```php
<?php
$a = 1;
$b = 2;
function nothing() {
$c = $a + $b;
echo $c;
echo $d;
}
nothing();
?>
```

记得我们之前提到的 JavaScript 示例，我们在函数外部声明了一个变量并初始化它，然后在函数内部不小心修改了它的值？函数外部的声明将那个变量变成了全局变量，而无需在程序中使用那个词。函数内部具有相同名称的变量会隐藏这些全局变量，但只有当它们被显式声明时。

在 PHP 中，情况正好相反。当我们在外部声明变量，然后在我们的代码中引入一个函数尝试访问它们时，它们将简单地从我们的程序视图中消失。所以，在我们的例子中，在`nothing()`函数内部的语句中：

```php
$c = $a + $b;
```

`$a`和`$b`是未声明的变量，当它们在表达式中使用时，它们的值通常变为空字符串。这就是为什么当我们使用以下语句时，屏幕上不会显示任何内容：

```php
echo $d;
```

然而，上一行将产生数字`0`。这是因为它是包含`+`运算符的表达式的结果。表达式的操作数首先被转换为数值，所以我们最终什么也没有加到什么也没有上，这和将零加到零一样，结果仍然是零。那么，我们如何在函数内部访问我们在外部声明的`$a`和`$b`呢？

#### 全局变量

在许多编程语言中，将频繁使用的语句序列取出来，放在一个可重用的函数中，这是一种常见的做法，例如：

```php
getProductList();
```

根据编程语言的不同，一个函数在技术上可能不被称为函数，而是子程序、过程等等。在一个典型的 Web 开发场景中，你需要从数据库中获取数据，这种操作经常发生，因此你希望以这种方式组织你的代码。

有很多次，我感到非常惊讶，因为当我将代码分组到函数中时，原本正常工作的代码突然停止工作。原因是：我在其他所有内容之外初始化的全局`$mysqli`对象在函数内部无法访问。对我来说是全局的，但 PHP 并没有将其视为全局。以下是补救措施：

```php
<?php
$a = 1;
$b = 2;
function nothing() {
global $a, $b;
$c = $a + $b;
echo $c;
}
nothing();
?>
```

除非你在函数内部使用全局关键字，否则你的全局变量才会被当作全局变量处理。

另一种补救措施是将你的`$a`和`$b`变量作为函数的参数，但我不会推荐这样做。在需要使用全局变量的函数中将它们声明为全局变量是全局最佳实践。

#### 静态变量

在某些编程情况下，存在一种非常有用的变量作用域类型。考虑以下情况：

```php
<?php
function listNextPrice ($price)  {
// Yes, arguments cost a dollar too
$article = 0;
$article++;
echo  'Article number ' . $article . 'costs  $' . $price  ;
//Analyze this carefully
?>
```

很可能已经很清楚我们的意图。每次我们使用这个函数时，我们希望列出我们作为参数传递的价格，但我们期望文章编号也要高一个。然而，每次我们重新进入函数时，`$article`变量都会重置为 0。现在，请注意这个略有不同的版本：

```php
<?php
function listNextPrice ($price)  {
static $article = 0;
$article++;
echo  'Article number ' . $article . 'costs  $' . $price  ;
}
?>
```

这将提供预期的结果，因为我们已将`$article`声明为静态。变量被赋予初始值的带有关键字`static`的行只使用一次，并且从那时起，当程序返回到函数时将被忽略。然而，每次它这样做时，都会记住上一次访问的变量的值。使用`static`关键字声明的变量不能使用表达式来初始化。

我们在第四章中使用的相同的选择表达式和运算符在 PHP 中也是有效的，只有一个主要且极其重要的例外。

#### 字符串运算符

在 JavaScript 中，你学习了不仅可以使用`+`符号来加数字，还可以用来连接字符串——连接它们，也可以称为连接。在 PHP 中，有一个专门的运算符来做这件事。它有两种形式，我们在这里展示：

```php
<?php
$a = "Hello";
$a =  $a   .   "World";
?>
```

或者：

```php
<?php
$a = "Hello";
$a  .=  "World";
?>
```

你的大部分 PHP 代码将像这样：将字符串连接起来构建动态页面的最终 HTML。通常，你会从一个变量开始，用开标签初始化它，然后从那里构建，直到达到最终的 HTML 标签，然后`echo`整个内容：

```php
<?php
$htmlstring     = '<div>';
$htmlstring    .= '<h1>Hello, World </h1>';
$htmlstring    .= '</div>';
echo $htmlstring;
?>
```

一旦我们开始向 HTML 标签添加需要引号的属性，并开始使用包含美元符号的 PHP 变量，就必须仔细注意，不仅要正确使用引号，还要注意使用哪种引号。

#### 双引号还是单引号，这是一个问题

我是一个单引号爱好者，我总是用单引号开始字符串，然后在需要时切换到双引号。它们之间有什么区别？单引号内的内容将被当作字面意思处理，所以`$name`读作`$name`。在双引号之间的文本中，变量将被评估，所以`$name`将读作该变量的值。如果你使用单引号并需要变量，请将它们放在引号外，并使用连接运算符来组合你的文本，如下所示：

```php
$htmlstring .= '<h2 class="blue">'.$hello.'</h2>';
```

如果你想使用双引号，相同的语句看起来应该是这样的。

```php
$htmlstring .= "<h2 class=\"blue\">$hello</h2>";
```

你可以将`$hello`放在里面，因为它将被评估，但你必须使用反斜杠转义类属性的引号以取消其特殊含义。

我的偏好是使用单引号。只是避免混合这两种方法。另一方面，如果你必须处理他人的代码，请确保你注意这些，虽然不是总是微妙的，但差异。

## 控制流

在第四章中，*JavaScript*，我们列出了该语言的原则控制流语句：if，if/else，while 和 switch。PHP 中也有相同的语法，但不要忘记变量名中的美元符号！

## 函数

用户定义函数的语法与 JavaScript 中的语法相同。

PHP 还提供了一些预定义的函数。其中一些非常有用，所以我们决定包括它们的描述和语法。大多数都让我想起了 UNIX 时代的 C 库函数。

## 字符串函数

由于您将始终使用字符串，并且经常需要在最终输出之前对这些字符串进行操作，因此了解 PHP 提供了一组不错的字符串函数是很有用的。为了您的方便，我们在此包括最实用的函数。

### strpos()

`strpos()` 函数在另一个字符串中查找字符串首次出现的位置。如果找到字符串，则返回位置（从 `0` 开始，而不是 `1`），如果没有找到字符串，则返回 `FALSE`。该函数接受两个参数：要查找的字符串和要查找的字符串：

```php
<?php
echo strpos("Hello, World","World");  // this wil print 7
?>
```

### strlen()

`strlen()` 返回该函数唯一参数的字符串长度，如果字符串为空则返回 `0`。

### substr()

`substr()` 返回字符串的子串。其典型用法是 `substr($string,$start,$length)`。`$string` 是用于检查的字符串，`$start` 是该字符串中的起始位置，可选的 `$length` 用于指定要返回的字符串长度。默认值是字符串的末尾。

我们还可以组合这些函数。您认为以下代码会做什么？

```php
<?php
echo substr("Hello,world", strpos("Hello, world","world"));
?>
```

## 日期函数

很难想象一个不需要与时间或日期有任何关系的 Web 应用程序。此外，您将经常需要使用不同的日期格式，这不仅因为世界各地的日期格式不同，例如，07/19 在美国是正确的，但在欧洲必须是 19/07，数据库中的日期也使用不同的格式。有三个非常方便的函数可以帮助您处理这些。

那么，什么是日期呢？嗯，它可以是生长在温暖国家并挂在树上的东西；我过去在死亡谷买枣，然后给我的朋友们吃。日期也可以是约会的另一个词，年轻人和老年人都可以在约会时兴奋起来。

然而，在 PHP 中，日期或时间的定义也来自 UNIX，等于现在与 1970 年 1 月 1 日 00:00:00 GMT 之间的秒数。以下是三个函数及其用法。

### time()

这将返回现在的秒数。因此，在以下代码中，您可以将它存储在一个变量中：

```php
<?php
$rightnow = time();
?>
```

请注意，这将是托管服务器上的日期和时间，它可能位于与您的计算机或网站访问者所在的不同地区。您始终可以使用 `date_default_timezone_set` 函数指定程序的正确时区，例如：

```php
<?php
date_default_timezone_set('Europe/Brussels');
?>
```

如果需要确定访问者的日期和时间，那么这将在客户端发生，即使用 JavaScript 的 `date` 对象。

### date()

`date()` 函数用于获取时间戳，例如，秒数或默认情况下为当前时间，并将其转换为所需的格式。它接受的第一个参数是一个格式字符串。查看一个良好的参考，以获取该字符串中可以使用的完整项目列表。最常用的有 `m` 表示两位数的月份，`d` 表示日期，`Y` 表示四位数的年份。因此，要获取今天的日期，以欧洲格式使用斜杠分隔：

```php
<?php
$eurodate = date('d/m/Y');
//or, same thing
$eurodate = date('d/m/Y', time());
?>
```

当然，你时不时地需要现在的日期和时间，但更常见的是你需要处理过去的日期（订单日期）和未来的日期（日程事项）。那么，我们如何计算订单时间与 1969 年最后一天午夜之间的确切秒数？你不需要。还有一个函数可以帮助我们做到这一点。

### `strtotime()`

`strtotime()` 函数将根据传递给它的字符串作为参数返回一个时间戳——例如，来自数据库的格式。查找一个良好的 `strtotime` 参考，以获取所有有效格式的列表。因此，在实践中，你通常会结合使用这两个函数，如下所示：

```php
<?php
$htmlstring .= '<td>'.date("d/m/Y", strtotime($dbdate)).'</td>';
?>
```

## 数组

数组是存储在单个变量中的数据元素集合。在我之前知道的几乎所有编程语言中，这些元素都会通过一个数字，即它的索引来引用，第一个元素的索引从 0 开始。在我提到的培训期间，对我来说是一个启示的是，PHP 中可以使用的一种不同类型的数组：关联数组。关于这一点，很快就会详细介绍。

### 数字数组或索引数组

具有数字索引的传统数组可以一次声明和初始化，如下所示：

```php
<?php
$beatles  = array ("John", "Paul", "George", "Ringo" );
echo  $beatles[0]. " Lennon:;
?>
<?php
/* different way to do the same */
$beatles = array();
$beatles[]= "John';
$beatles[]= "Paul";
$beatles[]= "George";
$beatles[]="Ringo";
?>
```

在这两个例子中，我们创建了一个包含披头士乐队成员名字的首字母缩写的`4`元素数组。在第一个例子中，我们一次完成，使用`array()`构造函数——类似于我们在 JavaScript 中创建对象时使用的方法。实际上，JavaScript 也有数组，但我们不会像在 PHP 中那样经常需要它们。

第二个例子首先告诉 PHP 先生，`$beatles` 应该是一个数组，然后我们开始填充它。第一个 `$beatles[]="John"` 赋值相当于：

```php
$beatles[0] = "John";
```

下一个将初始化索引高一位的元素。然而，我们可以这样写：

```php
<?php
$beatles[6] = "George";
$beatles[] = "Ringo";
?>
```

然后，乔治将成为`$beatles[6]`的值，林戈将成为`$beatles[7]`的值。没有元素具有索引 2、3、4 和 5 是完全可以接受的。喜欢收集东西的人可能不喜欢这样。他们无法忍受有 0 和 1 和 6 和 7 而没有中间的。他们可能会像我一样喜欢关联数组。

### 关联数组

在 PHP 中所谓的关联数组中，索引可以是一个字符串而不是一个数字。这是它的工作方式：

```php
<?php
$employee = array();
$employee['first'] =  "John";
$employee['last'] = "Williams";
$employee['profession'] = "conductor";
?>
```

我们基本上将上一章中的 JavaScript 对象重新创建为一个关联数组。还有一种方法可以在一个语句中初始化所有这些。它的语法是新的，并且不同，引入了键/值对。当我们开始从数据库（如 MySQL）提取数据时，这些键/值对将非常有用，因为 MySQL 可以将数据以……猜猜看……关联数组的形式返回给我们。

因此，这里有一个使用特殊 `=>` 操作符的单行版本：

```php
$employee = array(
"first" => "John",
"last" => "Williams",
"profession" => "conductor"
);
```

### 关联数组的酷控制语句

控制语句比我们在本章和上一章中描述的要多。`foreach` 语句在遍历数组时非常有用，因为你可以轻松地遍历键和值。以下语句遍历了我们的示例数组：

```php
foreach ($employee as $key => $value) {
echo $key. ' is '.$value. '<br />';
}
```

现在你已经了解了关联数组是什么，我们准备解释一些重要的数组变量，我们不是自己创建的，而是由系统生成的：`: $_POST` 和 `$_GET`。我们将能够访问这些变量的最常见场景是当我们的网站访客填写表单并点击按钮时。

## 将数据发送回服务器 – 表单

你已经知道一种从服务器获取信息的方法，当我们讨论文件和数据库时，你将学习其他方法，但让我们首先反过来。我们将向你展示我们如何捕捉和处理我们的网站访客提供给我们信息。

最常见的方式是当访客填写表单字段并提交时。这把我们带回到第二章，*HTML*，在那里我们讨论了 `<form>` 和 `<input>` 元素。`<form>` 标签具有比我们讨论的更多属性，因为我们当时无法解释它们。例如，为了验证用户输入，比如在发送到服务器之前查看 ZIP 代码是否只包含数字，我们需要了解 JavaScript。我们仍在推迟这个任务，因为有一个非常棒的 jQuery 插件可以为我们完成这个任务。我们也不能解释 `*action*` 和 `*method*` 属性，因为这涉及到 PHP。现在是做这件事的时候了。

看看以下 HTML 片段，这是一个相对简单的、部分表单，人们可以用它来注册通讯。

```php
<form id="myform" action="process.php" method="POST">
<label> First name </label>
<input type="text" name="first" /><br />
<label>Last name </label>
<input  type="text" name="last" /><br />
<label>Tell me about your hobbies:</label><br />
<input type="checkbox" name="hobbies[]" value="Photography">Photography</input><br />
<input type="checkbox" name="hobbies[]" value="Music">Music</input><br />
<input type="checkbox" name="hobbies[]" value="Theatre">Theatre</input><br />
<input type="checkbox" name="hobbies[]" value="Tennis">Tennis</input><br />
<button>Submit</button>
</form>
```

想象这段代码是网站的一部分，访客填写表单并点击提交按钮。用户填写的数据将被发送到服务器，并可以在带有 `action` 属性的 PHP 模块中处理，例如我们例子中的 `process.php`。另一方面，输入字段中输入的值将被存储在一个数组中，名为 `$_POST` 或 `$_GET`，具体取决于选择了哪种方法。

### POST 或 GET，我们应该获取什么？

我个人的偏好是始终使用 **POST**，除非我需要使用 **GET**。那么，区别是什么？

使用`GET`方法，数据会与 URL 一起传递，这是你在浏览器内可以看到的网页地址。你会在地址栏看到类似：`process.php?first=John&last=Williams&profession=conductor`这样的内容。问号后面的字符串被称为查询字符串。

使用这种方法，访客（假设你给了他们指示）可以传递参数，然后你可以在 PHP 代码中处理这些参数。如果有一个大型网站中的有趣文章，你可以通过例如查询字符串`article=number`来重新访问它，那么这也会很有用。

使用`GET`的两个主要缺点是，实现依赖于大小限制（可能是 1024 字节）以及所有内容都是可见的。这不是你想要用来显示登录名和密码的方式：

```php
login.php?login=paul&password=mysecret.
```

因此，一般来说，你想要使用`POST`方法；实际上没有大小限制，并且浏览器地址栏中不会显示任何内容：

#### $_POST 和$_GET 数组

这非常简单；你可以在关联数组`$_POST`中找到在表单中填写过的所有值。在输入标签的情况下，键/值对是`name`属性的值和`value`属性或填写的内容。

我们不能确定用户是否填写了所有必填字段，以及我们是否在客户端进行了验证（我们将在后面的章节中学习这一点），但在服务器端仍然需要进行验证。否则，我们可能会在文件或数据库中填充空或不完整的员工记录。

注意在复选框的名称属性中使用的方括号。它们怎么可能都有相同的名称？它们并不相同。用户选择爱好后的结果将是一个索引数组，它将是`$_POST['hobbies']`。

当处理你的`POST`变量时，你可能想要使用`isset()`函数。这个函数检查变量实际上是否存在，这与检查它是否存在并且具有除`0`或空字符串之外的其他值是不同的。

接下来的是我们`process.php`模块中可能出现的代码。在其中，我们引入了`&&`，这是一个逻辑运算符。把它想象成一个逻辑`AND`运算符，如果其左右两边都是真的，则返回 true。它的对应物是`||`，逻辑`OR`，如果至少有一个操作数是真的，则返回 true。

```php
<?php
if((isset($_POST['first'])))&& ($_POST != "")){
$first = $_POST['first'];
}
if((isset($_POST['last']))&& (4_POST['last'] != "")) {
$last = $_POST['last'];
}
if(isset($_POST['hobbies']){
$totalhobbies = count($_POST['hobbies']);
}
?>
```

`count()`函数是一个函数，它计算数组中有多少个元素，即它的大小，并返回它。在我们的例子中，这将等于所选爱好的数量，而不是可供选择的数量。

## 文件

在前面的章节中，我们处理的是内联 CSS 或 JavaScript，或者通过使用正确的标签和属性，我们可以引用包含我们代码的外部文件。但是，对于我们的 PHP 代码，没有这样的标签或属性。但是，有另一种方法可以做到这一点。

假设您已经编写了一组您计划在其他项目中重用的酷函数。在您想要使用的每个`.html`文件中的`<?php`和`?>`之间重复它们是没有意义的。将它们保存在一个单独的文件中，您可以引用它，这是一个更好的主意。我们有一些 PHP 关键字可以做到这一点。

### include、require 和 require_once

当在 PHP 语句中使用时，这三个关键字都会做同样的事情。包含关键字和文件名的语句将被文件的内容所替换。有一些细微差别：如果使用`include`且文件未找到，程序将继续执行，而如果您使用`require`，程序将停止。

`require`和`require_once`之间的区别在于，使用`require_once`时，已经加载的文件将不会再次加载。请确保您将 PHP 代码放在您在`<?php`和`?>`之间包含的文件中。在语句本身中，您可以使用括号或不使用括号，例如：

```php
include "morecode.php"
require ("includes/functions.php");
```

### 常规文件

到目前为止，我们一直在使用存储在服务器上的各种文件：程序（`.php`和`.js`）、样式表（`.css`）、纯网页（`.html`）和图像，这些图像与`<img>`标签一起使用。这些图像可以是不同的格式：`.png`、`.gif`、`.png`，甚至是`.tiff`。我们网页中的链接可以引用存储在服务器上的更多文件，例如所有格式的 PDF 文档，甚至 Word 文档。所有这些文件在需要时将由浏览器下载给我们的网站访客，并且它们会到达服务器，因为我们可能使用 FTP 将它们放在那里。

然而，您可以从程序内部访问不同类型的文件，以及创建或修改新文件。毕竟，一个结构良好的文件可以充当一个小型数据库。有一系列现成的函数来处理文件。大多数函数需要一个指向文件的路径，这不过是文件名本身或由一个或多个目录名通过`/`分隔的名称。

这些函数随后返回或使用文件句柄或文件指针。这就是我在培训课程中感到似曾相识的部分。UNIX 用户会记得，一切都被当作文件来处理：一个真正的文件、打印机、硬盘、任何设备，而文件的基本操作是：创建、删除、打开、关闭、读取和写入。对于真正的文件、文本文件或二进制文件，有一系列方便的函数，所有这些函数的名字都以一个`f`开头。我们在 PHP 中重新发现了这些函数。

## 文件函数或 f 函数

有函数可以访问现有文件或创建新文件，检查文件是否存在，以及它们实际上是文件而不是目录，还有从文件中读取和写入的函数。第一个函数需要一点学习；其余的都很简单。

### fopen

没有名为`fcreate!`的函数，所以`fopen`用于创建一个新文件或打开一个现有文件，但目的是什么？你必须仔细研究这个函数第二个参数的选项，因为这决定了你的文件会发生什么。这可以从为写入创建一个新文件和为读取打开一个现有文件，到获取一个文件，销毁其中的内容并重新开始。了解文件指针指向的位置也很重要。我们将给你提供这三个选项中的三个，但它们应该足以满足 95%的工作。请注意，我们期望`$filename`的值是一个指向文件的路径名。

```php
$fp = fopen($filename, "r");
```

这将打开文件用于读取，文件指针将指向文件的开始。如果你想要从现有文件中提取信息，这通常是你要做的。

```php
$fp = fopen($filename,"a");
```

`a`代表追加。因此，这将打开一个文件用于写入，从文件末尾开始。所以文件指针指向的位置就是末尾，你写入此文件的所有内容都将添加到末尾。

```php
$fp = fopen($filename, "x");
```

这是最接近创建的。如果文件已经存在，它将保持完整，并且`fopen()`将返回`FALSE`而不是文件指针。否则，你刚刚创建了一个可以写入的文件。

如我所述，大多数其他选项可能会通过截断文件内容来破坏你的文件，你肯定不希望这样。这就像在 UNIX 系统上执行命令一样 - 例如：`> filename`

### file_exists(), is_file(), 和 is_dir()

为了避免意外，你可能想要检查你想要打开的文件是否存在。

```php
<?php
if (file_exists($filename)) {
echo "$filename exists";
}
else
{
echo "$filename nowhere to be found";
}
?>
```

`file_exists()`函数如果`$filename`存在则返回`TRUE`，否则返回`FALSE`。它不会告诉我们它是一个文件还是一个目录。为此，我们有`is_dir()`和`is_file()`函数。

### fread 和 fwrite

现在，假设我们已经有文件打开，并且指针指向文件内部，我们可以从中读取和写入。为此，我们使用`fread`和`fwrite`。假设我们有`$fpin`用于读取和`$fpout`用于写入；这将是一个简单的文件复制代码片段，使用这些函数：

```php
<?php
$filecontents = fread($fpin, filesize($filename));
$success = fwrite($fpout, $filecontents);
?>
```

`fread`的第二个参数用于指定你想要读取的字节数。当然，我们在这里简化了，说：让我们一次性读取整个文件。为此，`filesize()`函数非常有用。使用`fwrite`，你可以将你想要写入的字节数作为可选的第三个参数。在我们的例子中我们没有这样做，我们只是简单地使用包含整个文件的字符串作为第二个参数。

### 逐行读取 - fgets()

我们使用了前两个函数来一次性读取文件的内容，然后将这个块写入另一个文件。我们可能会用到的许多文件，而不是数据库，将会有组织成固定长度记录的信息行，这些记录不过是固定长度的字符串或数字。如果我们能够逐行处理文件会怎么样呢？我们可以。`fgets()`是一个一次返回一行内容的函数：

```php
<?php
while ($line = fgets($fp)) {
/* do something with $line */
}
?>
```

### printf 函数族

`printf`函数是让我在现在臭名昭著的六个月课程中感到“好久不见”的那个函数。它非常强大，如果你掌握了如何编写好的格式字符串，你只需几个语句就能创建出色的结构化输出。

不幸的是，你可能会发现`printf`，PHP 版本，不太可能被大量用于生成 HTML，因为 HTML 与固定长度字段的输出相去甚远。首先，后续空格会被删除，等你看到输出时，HTML 标签也不会显示。

讲师从未使用`printf`有两个原因——其中一个是很有道理的。`printf`是一个函数，而`echo`是内置的。所以，大多数时候，你 echo 的内容会比`printf`快。

那么，为什么要提它呢？有一些与`printf`非常相似的功能可以读取或写入字符串或文件，并且有一个简单的方法来处理结构化格式是非常有用的。它们是：`sscanf`、`fscanf`、`sprintf`和`fprintf`。它们共同的特点是使用格式字符串。首先，我们向您展示语法；然后，我们解释格式字符串本身。

### `printf`函数族的语法

+   `printf($format, $arg1, $arg2, ... );`

+   `sprintf($string,$format,$arg1,$arg2, ...);`

+   `sscanf($string, $format, $arg1, $arg2, ...);`

+   `fprintf($fp, $format, $arg1, $arg2, ...);`

+   `fscanf($fp,$format, $arg1, $arg2, ...);`

在这种语法中，`$fp`代表一个文件指针，它之前使用`fopen()`和`$string`变量来包含字符串创建；`$arg1`、`$arg2`等，是存储我们检索的数据或持有我们想要使用的数据的变量。`$format`包含如何格式化的魔法：

```php
<?php
$product ="Stereo receiver";
$price = 499;
printf("Item purchased: %20s - Price:%7.2\n", $product, $price);
?>
```

这将输出：

```php
Item purchased: Stereo receiver     - Price:0000499.00
```

这使得产品名称正好是 20 个字符，价格在浮点数前有 7 位，后跟 2 位。我知道，当在浏览器中显示时，这些额外空格将减少到只有一个，但如果使用`fprintf`将此写入文件，并在循环中重复相同的语句，我们最终会得到一个所有行都整齐排列的文件。所有这些都包含在带有`%`符号的字符串中。通常，每使用一个`%`字符串就有一个额外的参数。以下是他们可以包含的内容：

| 格式值 | 描述 |
| --- | --- |
| `%%` | 如果你需要一个`%`符号——使用两个，只显示一个 |
| `%b` | 显示值为二进制数，即只有零和一 |
| `%c` | 根据 ASCII 值显示字符 |
| `%d` | 显示值为十进制数 |
| `%f` | 浮点数 |
| `%o` | 八进制数 |
| `%x` | 十六进制数（小写字母） |
| `%X` | 十六进制数（大写字母） |

| `%s` | 将值视为字符串。你将最常使用它，结合额外的格式值，这些值放在`%`和字母之间（例如`%.2f`）：

+   [0-9]（指定变量值保持的最小宽度）

+   [0-9]（指定小数位数或最大字符串长度）

|

# 摘要

在本章中，我们介绍了 PHP 编程语言以及你需要做什么才能开始在你的网页中使用它。这正是本章的重点——不是深入覆盖语言能做什么，即使在 Web 开发的情况下。我们没有涉及语言的对象化方面，也没有涵盖特定于网站的内容，如 cookies 和会话。

我们立即聚焦于每个人在 PHP 中都需要的内容。我们以讨论如何在客户端和服务器之间交换数据以及如何使用文件存储这些数据结束本章。这些函数使我们能够为这些文件添加结构。如果你使用 XML 等格式，文件甚至可以有更多的结构，XML 与 HTML 非常相似。有一些酷的 PHP 库可以处理这些，例如**SimpleXML**，我们将在第十章中讨论，*XML 和 JSON*。

最终，你希望超越仅使用文件来存储数据的使用，并使用真正的数据库。在基于 PHP 的 Web 开发领域，最常用的数据库是 MySQL，这也是我们下一章的主题。
