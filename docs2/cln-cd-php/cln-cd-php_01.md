# 1

# 什么是代码整洁性以及为什么你应该关心？

如果你刚开始接触**PHP：超文本预处理器**（**PHP**）以及一般的软件开发，那么你还没有遇到过代码整洁性的可能性很大。我们所有人都是从这里开始的；每个人都必须意识到这一点。代码整洁性不仅仅是一套规则。它是一种真正的思维方式——一种思考你所创造事物的方式。

我们经常遇到那些在**信息技术**（**IT**）领域工作多年，甚至几十年，却从未需要担心过代码整洁性的开发者。这可能是由于多种原因，比如多年来独自在一个项目上工作，或者在遗留代码库上进行开发，这些都是“代码整洁性”没有进入他们的耳朵或者不是他们关注的问题的几个原因。

早日意识到代码整洁性的重要性——越早越好。就像许多其他习惯一样，一旦你习惯了某种代码工作方式，就很难改变。可能是因为你对代码整洁性的理解并不完全确定，你不确定它是否适用于你，或者你可能只是对应用新的“规则”感到懒惰，因为你的方法已经对你有效（请放心，每个人都会经历这个过程）。但是，如果你关心它并且开始注意——那么，你已经完成了最困难的部分，因为这意味着你已经准备好改变你的习惯了。不要误解我们——我们的目的不是改变你迄今为止所学的一切；更多的是改进你已有的技能。

你可能没有意识到这一点，但可以肯定的是，你已经有一些完全符合代码整洁性原则的习惯，这些习惯对你来说是自然而然的，但对其他开发者来说却是全新的。你应该注意，代码整洁性原则的目标根本不是为了引起争议。

本章我们将涵盖的主要主题如下：

+   本书将涵盖的内容

+   理解什么是代码整洁性

+   代码整洁性在团队中的重要性

+   代码整洁性在个人项目中的重要性

# 本书将涵盖的内容

你可能已经听说过软件工艺书籍、代码整洁性书籍等等。这本书与其他书籍有什么区别呢？好吧，当我们作为开发新手，在探索新的编程语言，甚至第一次接触编程和源代码时，可能很难理解如何应用你到处都能看到的这些原则。编程语言并不都提供相同的功能——有些发展迅速，而有些则不再发展。一个语言中的概念和命名方式可能在其他语言中不适用。这就是为什么这本书专注于 PHP 中的代码整洁性。

你无需思考如何在 PHP 中实现这些原则和规则，这在吸收知识时是一种较少需要记住的事情。你会发现直接适用于你、在专业项目中使用并被行业证明的例子和工具。这样，我们可以直接进入我们希望您理解的重要观点。您可以在阅读这本书的同时立即将您的知识付诸实践，从而更快地学习。此外，您不需要 10 年以上的经验来理解将要展示的内容。只需要具备基本的 PHP 知识，就能完全理解将要展示的内容。

这本书是多年经验的汇编——多年的实践领域，面对必须根据技术约束、功能约束、时间和金钱约束解决的实际问题。这不会是另一本充满乌托邦原则的书，这些原则无法应用于现实生活中。

这本书不仅仅通过只谈论 PHP 来直接适应你的环境，你可以按照你想要的顺序阅读。它分为两个不同的部分。第一部分（你现在正在阅读的部分）将展示一些关于什么是清洁代码以及它的基本原理的理论，直接应用于 PHP 语言，直到版本 8.2 等。第二部分将专注于你可以使用的实用工具，以确保你正确地遵循正确的规则，设置环境以及你的**集成开发环境**（**IDE**），以便尽可能高效和清洁，并对你的代码进行度量、自动化测试、编写文档等。这意味着你可以跳过部分内容，按照你想要的顺序阅读，以你想要的速率学习。

在开始实践之前，你不必阅读整个理论部分——你现在就可以直接深入研究工具和具体例子。你还可以在进入实践方面之前专注于第一部分，以确保你完全理解稍后将要解释的内容。这取决于你。

# 理解什么是清洁代码

清洁代码的行为是通过考虑未来来编写代码——也就是说，考虑那些将与你或项目合作但不在你身边的人。当我们谈论“将与你合作的人”时，这甚至可能包括你自己。如果你从未这样做过，你应该尝试阅读和维护你几个月（或几年）前编写的源代码。这不是很有挑战性吗？好吧，不要担心——这对每个人来说都很困难。你肯定会发现这很复杂，而且没有快速解决问题的方法。这是*对每个人来说都是同样的过程*。

如下所述，有多个原因：

+   你每天都在学习新的编码方式

+   你正在练习，并且你在编码方面越来越擅长

+   你的思维方式可能因为遇到的人或仅仅因为你变老了而正在演变

+   每天都有创新的技术和库发布，一些精确完成任务的方法正在被弃用

+   你正在使用的语言（这里指 PHP）正在进化，新的标准也在出现

谈到 PHP，最近几年看到这种语言在快速且大幅地进化，这确实非常有趣。几年前，很多人呼吁 PHP 的消亡。确实，在 PHP 7 之前，这门语言确实不太顺利。PHP 7 及更新的版本对我们来说是一股清新的空气。新版本正在频繁发布，PHP（只需看看 PHP 8.1 中的`match`表达式和对枚举的支持！）也在不断增加新特性。严格的类型检查也被引入，这也是一个巨大的进步。我们将在稍后深入探讨 PHP 的进化，这些进化有助于编写干净的代码。

无论你使用哪种编程语言——不可否认，每次你看到自己写的旧代码时都会感到害怕。以“干净”的方式编写你的代码将帮助你最大限度地减少这种影响，并立即更好地理解它，多年后也是如此。通过这样做，你是在给自己一个奖励，因为你将用一种你越来越习惯的方式——许多人习惯的编写方式来编写代码。

这可能是关于干净代码最令人印象深刻的事情：它无关乎你使用哪种技术、哪个库，甚至无关乎你使用的语言。它不取决于你居住的国家，也不取决于你的工作经验，甚至无关乎你是否以编程为生或作为爱好进行编程而没有背后的经济意图。干净代码是一种技能，在某个时刻，每个开发者都会在他们的生活中提高并面对。当然，如果你专注于它，你会变得更好，但仅仅从你在 IT 项目中遇到的成功和失败的经验中学习，就已经是在某种程度上学习干净代码了。除了这本书中你会找到的规则、工具和技巧之外，干净代码是一个关于经验和多年实践的问题。在你的开发者生涯中，通过结识不同的人和与众多不同的团队合作，你将遇到不同的挑战和不同的思维方式。

你应该始终记住，编码是一项团队工作。现在独自在一个项目上工作而不需要其他开发者的干预是很罕见的——如果这种情况还发生的话。这可能是一个专业项目、开源项目，甚至是一个私人个人项目。说其他开发者会帮助你的项目并不意味着他们会编写一些代码。他们也可以尝试与你一起解决你将面临的技术挑战，这适用于所有类型的项目。

在任何情况下，正确地做事都将简化我们所有人进入新项目时都会经历的至关重要的一步：入职流程。

# 干净代码在团队中的重要性

入职过程从来都不容易。你正在进入一个新的项目，周围很多人已经熟悉它。你必须学习一切：团队中谁负责什么，确切的要求是什么，团队经历过的技术挑战，以及接下来会发生什么。这个过程可能持续几周，在某些情况下甚至可能持续几个月（在一些巨大的遗留项目中，这个过程可能持续超过一年，但这又是另一个话题）。如果你能够通过了解清洁代码原则来节省学习编码约定的过程，那么这就是你不必担心的一件事，你可以专注于其他事情。

能够编写清洁的代码就像在团队中流利地使用相同的语言一样：它使得沟通和以相同的方式编写代码变得更容易，而不会注意到是谁编写了哪一部分。

清洁的代码有助于代码的长期维护。当作为一个团队在项目上工作时，源代码至少会维护几年。代码将在你离职多年后继续被维护。正确地做事很重要，因为你不会永远在这里向仍在项目上工作的人解释你所做的一切。

清洁地编写代码将避免我们所说的**单点故障**（**SPOFs**）的出现。这些 SPOFs 是任何项目的最恶梦。它们也是遗留项目的症状。它们可以被描述为一个实体（一个开发者、一项技术、一个库等等）独自支撑整个项目。如果这个实体失败了，一切都会崩溃。

一个实体失败的具体例子是开发者的离职。如果他们是唯一一个完全理解项目运作方式的人，并被认为是该项目的“超级英雄”，那么这将会是一个大问题。这意味着没有他们，项目将无法继续进行，而且在他们离职后维护项目将会非常痛苦。

在 *SymfonyWorld Online 2021 冬季版* 大会期间，Symfony 框架的创造者 Fabien Potencier 给出了一个避免 SPoF 的绝佳例子。即使 Symfony 是一个开源项目，但他自从项目创建以来一直是投入最多的人。他在一次会议上解释说，他现在的首要任务是将尽可能多的关于框架的知识传授给尽可能多的人，这样 Symfony 就不再完全依赖于他。他绝对不想成为 Symfony 的 SPOF，并且自然希望 Symfony 在他不再亲自工作后仍能被维护和开发。

避免这种问题的众多方法之一是编写清晰、简洁、易于理解的代码——以这种方式编写代码，让每个人都能轻松理解正在发生的事情。在阅读这本书后，你可能会对如何实现这一点有更好的理解。

谈到团队合作，另一个关键点是代码审查。即使我们将在本书的后面部分详细讨论这些内容，但让我们在这里快速了解一下。如果你从未听说过代码审查，它就是一个过程，其他项目开发者会审查、阅读并评论你想要对代码库做出的更改。这个过程在大多数开源项目中是强制性的，并且鉴于它带来的好处，对于任何项目都强烈推荐。现在你可以很容易地想象，如果每个人都用自己的方式编写代码，那么这些审查将会花费更长的时间。这包括你格式化代码的方式，或者你是如何分离文件、类等等。如果我们都使用同一种语言，那么我们就可以在代码审查时专注于真正重要的事情：是否尊重了功能需求，是否存在任何错误等等。

在下一章中，我们将看到干净的代码定义通常取决于你正在与之合作的团队。即使有一些通用规则，这主要还是取决于你合作的开发者习惯于什么。再次强调，原因是习惯和一致性。这样，团队可以更快、更好地一起工作。

如果你恰好在一个有几个团队聚集在同一地点工作的领域工作，你不可避免地会注意到每个团队都有自己的规则，这些规则对他们来说很有效，但也有共同的规则，这将使你能够用同一种语言与所有人交谈。因为解决问题的方案并不总是来自你直接所在的团队，有时也来自那些没有直接与你一起在同一个项目上工作的人，如果人们之间共享基本规则，那么互相帮助将会容易得多。

# 个人项目中干净代码的重要性

你可能认为对于个人项目来说，干净的代码不那么重要，甚至只是一点点。如果你这样想，有很多原因，如以下所述：

+   你如何确保未来没有人会参与到开发中来？

+   如果你将你的项目开源，你难道不希望全世界看到你编写代码干净整洁，并为此感到自豪吗？

+   你可能想要反复改进你的项目。如果你编写了糟糕的基础，那么在没有担心破坏任何东西的情况下维护和添加新功能将会是一场噩梦。有时，由于糟糕的代码编写，你甚至无法添加新功能。在最坏的情况下，你可能不得不完全重写你的应用程序。你不想这样做。

如前所述，尝试阅读你几年前编写的代码。有很大可能性你将无法简要地理解你当时想要做什么。你可能认为你放置的注释（如果你这样做）是为了帮助，但让我们提出两个问题，如下：

+   谁真正阅读代码注释？

+   关于编写无需注释且清晰得像一本书一样可读的代码呢？

这就是一切的核心：能够像阅读简单句子一样阅读源代码，而无需停下来理解它。此外，关于团队中提到的干净代码：仅仅因为你是在独自创建项目，并不意味着你不会需要外部帮助。实际上，几乎可以肯定的是，总有一天，你将需要某人的帮助来完成某事。再次强调，如果你共享一套共同的规则，那么帮助者引入他们的想法将会容易得多。即使在个人时刻和项目中，开发者的工作也是团队合作。始终如此。

干净代码是一种心态，这种心态包括为我们所创造的东西感到自豪——工作完成的滋味。也许需要几年时间才能完全理解它是什么，我们总是有新事物要学习，有新情况要面对。干净代码是朝着这样一个时刻迈进，当你看着你的代码时，你会告诉自己你对向任何人展示你的代码感到完全放松。

正如俗话所说，“编写代码就像下一个运行它的开发者知道你的地址一样”。这也应该适用于个人项目，因为你就是那个下一个开发者。

# 摘要

我们的理论讨论完了吗？嗯，有点。我们一起定义了干净代码的构成。我们给出了干净代码的共同定义。通过拥有相同的干净代码定义，我们更深入了一步，并准备好在下一节深入更高级的原则。

当然，我们还没有完成。即使你同意我们提出的定义，你当然可能已经有很多问题。最重要的是以下问题：谁为你决定这些规则？谁有权力强加这种愿景？这就是我们在下一章将要一起探讨的内容。
