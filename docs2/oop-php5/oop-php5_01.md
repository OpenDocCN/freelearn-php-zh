# 第一章：面向对象编程（OOP）与过程式编程的比较

PHP 是过去几年中最受欢迎的脚本语言之一。几乎有 60% 的 Web 服务器运行在 Apache 上，并使用 PHP。它的受欢迎程度如此之高，以至于每个月都有数百万个网站和 Web 应用程序使用 PHP 开发。PHP 的旅程始于作为 Perl 的简单替代品，几年后它变得极其流行和强大。该语言本身与 ANSI C 非常相似。

PHP 变得如此受欢迎的一个原因是它的学习曲线很短。学习 PHP 不是一个很大的任务，尤其是如果你熟悉 Java 或 C 的语法。由于编写 PHP 脚本很容易，任何人都可以编写 PHP 代码，而不必遵循约定，将表示层与业务逻辑混合（这是大量不可管理项目存在的主要原因之一）。由于在 PHP 中没有遵循严格的编码约定，随着时间的推移，随着项目规模的扩大，它可能会变成一个难以管理的恶魔。

**OOP** 或 **面向对象编程** 是一种良好的编程实践，可以更容易地创建可管理的项目。过程式编程意味着编写没有对象的代码。过程式编程由带有或没有例程的代码组成。OOP 为任何语言提供了更好的编码、最佳性能以及编写非常大的项目而无需过多担心管理的功能。OOP 为你提供了创建可重用对象的便利，你可以或其他开发者可以在他们的项目中使用这些对象，而无需反复重新发明它们。OOP 消除了编写和管理大型应用程序的麻烦和困难。

在这本书中，我们将讨论如何使用 PHP 的面向对象编程（OOP）获得最大效益，使用逐步指导、真实生活示例来展示 OOP 如何帮助你编写有效的代码，如何改进你的编码风格，以及如何随着时间的推移重用它们。这本书不会作为 PHP 语言的参考书；我们只会涵盖 PHP 的 OOP 特性，而不是一般 PHP 的基础知识。如果你正在寻找一本好的参考书，首先查阅 PHP 手册，然后你可以学习由 Leon Atkinson 编写的《Core PHP Programming》，这是一本非常好的书。

# PHP 简介

如果你已经是一名 PHP 开发者，本节不是为你准备的，而是为那些刚开始学习 PHP 并使用这本书的人准备的。虽然我在一开始就说，我假设你在阅读这本书时将在 PHP 领域有一些预开发经验，但如果你是一个完全的新手，并想通过这本书学习 OOP，那么这一节可能值得回顾一下基本的 PHP 语言特性。如果你已经足够熟悉，请不要跳过这一节，因为我们在这里还有其他主题要讨论。

所以你可能想知道 PHP 的介绍在哪里，我没有在这里看到任何代码！好吧，你不需要。互联网上最好的资源是免费的。请访问[`www.php.net`](http://www.php.net)，下载手册并阅读基本章节。为了详细学习 PHP，你可以研究 David Sklar 所著的《Learning PHP5》这本书。

## 准备，设置，出发

在这本书中，我们使用 PHP5.1.2 作为示例，但几乎在 99%的情况下，它都可以运行在 PHP 版本 5x 上。我们在机器上安装了 MySQL 5，并使用 Apache 2 作为我们的 Web 服务器。如果你不熟悉在你的机器上配置所有这些，你可以下载预先配置好的 WAMP 或 LAMP 发行版，如 XAMPP（[`apachefriends.org`](http://apachefriends.org)）或 Apache2Triad（[`www.apache2triad.net`](http://www.apache2triad.net)）。你可以在每个产品的网站上找到相应的安装和自定义文档。

# PHP 中面向对象编程的历史简述

当 PHP 被开发出来时，它自身并没有实现面向对象的功能。在 PHP/FI 之后，当 Zeev、Rasmus 和 Andy 重写了核心并发布了 PHP3 时，引入了非常基础的面向对象功能。当 PHP4 发布时，面向对象功能得到了成熟，并且性能有了巨大的提升。但 PHP 团队再次重写了核心引擎，引入了全新的对象模型，并发布了 PHP5。现在有两个版本的 PHP 正在开发中。不要因为将 PHP 版本与其他语言进行比较而感到困惑。PHP5 并不意味着它是最新的 PHP 版本。正如我之前所说的，PHP4 和 PHP5 仍在积极发布（尽管 PHP4 将在 2007 年 12 月之后不再发布）。在这两个版本之间，PHP5 实现了几乎完整的面向对象功能，而 PHP4 则没有。在撰写这本书的时候，这两个版本的最新版本是 PHP5.2 和 PHP4.4。

# 过程式编程与面向对象编程风格

PHP 允许你以两种风格编写代码，一种是通过过程式编程，另一种是通过面向对象编程。你甚至可以在 PHP5 中编写过程式代码，而不会出现任何问题。如果你对过程式编程和面向对象编程不甚了解，那么我们将探讨这两种不同的编程风格。以下两个示例不是完整的运行示例，而是伪代码：

```php
<?
$user_input = $_POST[‘field‘];
$filtered_content = filter($user_input); //user input filtering
mysql_connect("dbhost","dbuser","dbpassword"); //database
mysql_select_db("dbname");
$sql = "some query";
$result = mysql_query($sql);
while ($data = mysql_fetch_assoc())
{
  process ($data);
}
process_user_input($filtered_content);
?>
```

你会注意到使用了很多内联处理，无论是直接使用还是通过使用函数。这可以作为一个典型过程式操作的例子。让我们看看转换成面向对象编程后它看起来会怎样：

```php
<?
$input_filter = new filter();
$input_filter->filter_user_input(); //filter the user inputs
$db = new dal("mysql"); //data access layer
$db->connect($dbconfig);//we wre using mysql
$result = $db->execute($sql);
ReportGenerator::makereport($result); //process data
$model = new Postmodel($filter->get_filtered_content());
$model->insert();
?>
```

现在如果你看看这两个代码片段，你会发现后者要容易阅读得多。嗯，你可以通过在第一个片段中引入更多的函数来使其更易读，但当你使用它们时，你准备好搜索多少个函数呢？后者的片段组织得更好，因为你知道哪个对象正在处理哪个过程。如果你用过程式风格编写大型应用程序，那么在几个版本之后几乎不可能管理。当然，你可以实施严格的编码规范，但数百万开发者都认为，除非以面向对象的方式实现，否则过程式编程不会给你带来终极的可管理性和可用性。几乎所有的大型应用程序都是使用面向对象的方法编写的。

# 面向对象编程（OOP）的好处

面向对象编程（OOP）是为了让开发者的生活更轻松而发明的。使用面向对象编程，你可以将问题分解成相对容易理解的小问题。面向对象编程的主要目标是：你想做的任何事情，都通过对象来完成。对象基本上是小的离散代码块，可以将数据和行为结合在一起。在应用程序中，所有这些对象都相互连接，它们之间共享数据，解决问题。

从许多方面来看，面向对象编程（OOP）可以被认为更好，尤其是当你考虑到开发时间和维护开销时。面向对象编程的主要好处可以概括如下：

+   **可重用性**：一个对象是一个具有大量属性和方法并可以与其他对象交互的实体。一个对象可能是充分的，或者它可能依赖于其他对象。但通常开发对象是为了解决一组特定的问题。因此，当其他开发者遇到相同的问题时，他们可以直接将你的类集成到他们的项目中，并使用它，而不会影响他们的现有工作流程。这防止了 DRY（不要重复自己），在函数式或模块化编程中，重用是可能的，但比较复杂。

+   **重构**：当你需要重构你的项目时，面向对象编程（OOP）能给你带来最大的好处，因为所有对象都是小的实体，并且将它们的属性和方法作为自身的一部分。因此，重构相对容易。

+   **可扩展性**：如果你需要向你的项目添加功能，你可以通过面向对象编程（OOP）实现最佳结果。面向对象编程的核心特性之一就是可扩展性。你可以重构你的对象以添加功能。在这个过程中，你仍然可以保持这个对象的向后兼容性，使其与旧代码库兼容。或者，你可以扩展这个对象，创建一个完全新的对象，它保留了从其派生出来的父对象的所有必要属性和方法，然后暴露新的功能。这被称为“继承”，是面向对象编程的一个非常重要的特性。

+   **维护**：面向对象的代码更容易维护，因为它遵循某种严格的编码规范，并且以自解释的格式编写。例如，当开发者扩展它、重构它或调试它时，他们可以轻松地找出内部编码结构，并一次又一次地维护代码。此外，只要你的项目中存在团队开发环境，面向对象编程（OOP）就可以是最佳解决方案，因为你可以将代码分成小块后进行分发。这些小块可以作为一个单独的对象来开发，因此开发者可以几乎独立地开发它们。最后，合并代码将变得非常容易。

+   **效率**：面向对象编程的概念实际上是开发出来以提高效率和简化开发过程的。已经开发出几种设计模式来创建更好、更高效的代码。此外，在 OOP 中，你可以用比过程式编程更好的方法来思考你的解决方案。因为你首先将问题分解成一小部分问题，然后为每个问题找到解决方案，大问题就自动解决了。

# 对象剖析

那么，什么是对象呢？嗯，它不过是一段包含许多属性和方法代码。那么它和数组相似吗，因为数组可以存储通过属性（嗯，它们被称为键）识别的数据？对象比数组多得多，因为它们内部包含一些方法。它们可以隐藏它们或公开它们，这在数组中是不可能的。对象在某种程度上可以与数据结构、数据结构相提并论，并且可以将其自身包含许多其他对象，要么在它们之间创建紧密耦合，要么创建松散耦合。对象可以将其自身包含许多其他对象，要么在它们之间创建紧密耦合，要么创建松散耦合。我们将在本书的后面部分学习更多关于松散耦合和紧密耦合的内容，并了解它们将如何对我们有用。

让我们看看 PHP 中一个对象的代码。以下对象是一个非常简单的对象，可以向一组用户发送电子邮件。在 PHP5 中，对象与 PHP4 中的对象有很大的不同。我们不会讨论它的细节，这只是一个介绍性的对象，以展示如何在 PHP 中编写对象。

```php
<?
//class.emailer.php
class emailer
{
  private $sender;
  private $recipients;
  private $subject;
  private $body;

  function __construct($sender)
  {
    $this->sender = $sender;
    $this->recipients = array();
  }

  public function addRecipients($recipient)
  {
    array_push($this->recipients, $recipient);
  }
  public function setSubject($subject)
  {
    $this->subject = $subject;
  }

  public function setBody($body)
  {
    $this->body = $body;
  }

  public function sendEmail()
  {
    foreach ($this->recipients as $recipient)
    {
      $result = mail($recipient, $this->subject, $this->body, 
                                "From: {$this->sender}\r\n");
      if ($result) echo "Mail successfully sent to 
                                         {$recipient}<br/>";
    }
  }
}
?>
```

上述对象包含四个私有属性、三个访问器方法和一个将电子邮件发送给收件人的方法。那么我们如何在 PHP 代码中使用它呢？让我们看看下面：

```php
<?
$emailer = new emailer("hasin@pageflakes.com"); //construcion 
$emailer->addRecipients("hasin@somewherein.net"); //accessing methods
// and passing some data
$emailer->setSubject("Just a Test");
$emailer->setBody("Hi Hasin, How are you?");
$emailer->sendEmail();
?>
```

我相信上面的代码片段要更加自解释和易于阅读。如果你遵循适当的规范，你可以使你的代码易于管理和维护。WordPress 开发者在其网站上使用了一个口号，即[www.wordpress.org](http://www.wordpress.org)，它是“编码即诗歌”。编码确实就像一首诗；如果你知道如何写它。

# PHP4 和 PHP5 中面向对象的差异

PHP5 中的对象与 PHP4 中的对象有很大不同。从 PHP5 开始，面向对象编程（OOP）在真正意义上成熟起来。OOP 自 PHP3 引入以来，但那只是真正面向对象编程的错觉。在 PHP4 中，你可以创建对象，但无法真正感受到对象的真正风味。在 PHP4 中，它几乎是一个较差的对象模型。

PHP4 中 OOP 的主要区别之一是一切都是开放的；没有关于方法或属性使用的限制。你不能为你的方法使用 public、private 和 protected 修饰符。在 PHP4 中，开发者通常使用双下划线声明私有方法。但这并不意味着以这种格式声明方法实际上阻止你从类外部访问该方法。这只是一种遵循的纪律。

在 PHP4 中，你可以找到接口，但没有抽象或 final 关键字。接口是一段代码，任何对象都可以实现，这意味着对象必须实现接口中声明的所有方法。它严格检查你必须实现其中的所有函数。在接口中，你只能声明任何方法的名称和访问类型。抽象类是某些方法可能也有一些内容的地方。然后任何对象都可以扩展那个抽象类，并扩展那个抽象类中定义的所有这些方法。一个 final 类是一个不允许扩展的对象。在 PHP5 中，你可以使用所有这些。

在 PHP4 中，接口没有多重继承。这意味着一个接口只能扩展一个接口。但在 PHP5 中，通过实现多个接口，支持多重继承。

在 PHP4 中，几乎一切都是静态的。这意味着如果你在类中声明任何方法，你可以直接调用它，而无需创建其实例。例如，以下代码在 PHP4 中是有效的：

```php
<?
class Abc
{
  var $ab;

  function abc()
  {
    $this->ab = 7;
  }
  function echosomething()
  {
    echo $this->ab;
  }
}

echo abc::echosomething();
?>
```

然而，在 PHP5 中这是无效的，因为`echosomething()`方法使用了`$this`关键字，而在静态调用中不可用。

PHP4 中没有基于类的常量。PHP4 中的对象没有静态属性，也没有析构函数。

每当复制一个对象时，它都是该对象的浅拷贝。但在 PHP5 中，只有使用 clone 关键字才能进行浅拷贝。

PHP4 中没有异常对象。但在 PHP5 中，异常管理是一个很大的新增功能。

在 PHP4 中，有一些函数用于调查类的方法和属性，但在 PHP5 中，除了这些函数之外，还引入了一个强大的 API 集合（反射 API），用于此目的。

通过像`__get()`和`__set()`这样的魔术方法进行方法重载在 PHP5 中可用。还有许多内置对象可以使你的生活更轻松。

但最重要的是，PHP5 在 OOP 方面有巨大的性能提升。

# 一些基本的 OO 术语

一些基本的面向对象术语如下：

**类**：类是对象的模板。类包含定义对象如何行为和交互的代码，无论是相互之间还是与它。每次你在 PHP 中创建一个对象时，实际上你就是在开发类。因此，有时在这本书中，我们将对象命名为“类”，因为它们是同义的。

**属性**：属性是类中的一个容器，可以保留一些信息。与其它语言不同，PHP 不检查属性变量的类型。属性可能只能在本类中访问，由其子类访问，或者由任何人访问。本质上，属性是声明在类内部但不在该类任何函数内部的变量。

**方法**：方法是类内的函数。像属性一样，方法也可以被这三种类型的用户访问。

**封装**：封装是将代码及其操作的数据绑定在一起，并使它们免受外部干扰和误用的机制。将数据和方法的包装成一个单一单元（称为类）的过程称为封装。封装的好处是它执行任务而不让你担心。

**多态**：对象可以是任何类型。离散对象可以具有离散的属性和方法，它们与其他对象独立工作。然而，一组对象可以从父对象派生出来并保留父类的某些属性。这个过程称为多态。一个对象可以变形为其他几个对象，同时保留其部分行为。

**继承**：通过扩展另一个对象来派生新对象的关键过程称为继承。当你从一个对象继承对象时，子类（继承者）继承了超类（被继承）的所有属性和方法。子类可以处理超类中的每个方法（这被称为重写）。

**耦合**：耦合是类之间相互依赖的行为。松耦合架构比紧耦合对象更易于重用。在下一章中，我们将学习耦合的细节。耦合是设计更好的对象时非常重要的一个考虑因素。

**设计模式**：最初由“四人帮”发明，设计模式是面向对象编程中解决相似问题集的一种更智能的方法的技巧。使用设计模式（DP）可以在开发者编写的代码最少的情况下提高整个应用程序的性能。有时不使用 DP 可能无法设计优化的解决方案。但过度和不计划使用 DP 也可能降低应用程序的性能。本书中有一章专门介绍设计模式。

**子类**：在面向对象编程中一个非常常见的术语，本书中我们一直使用这个术语。当一个对象从另一个对象派生出来时，派生出来的对象被称为其派生自的子类。

**超类**：如果一个对象是从它派生出来的，那么这个类就是该对象的超类。为了简化，当你扩展一个对象时，你正在扩展的对象是新扩展对象的超类。

**实例**：每次通过调用其构造函数创建一个对象时，它将被称作一个实例。为了简化，每次你写一些像这样 `$var = new Object();` 的东西时，你实际上创建了一个对象类的实例。

# 通用编码约定

在本书中，我们将遵循一些编码约定。这些约定不会过于严格，但它们将帮助你在大范围内维护你的应用程序。此外，它还将提高代码的可维护性。它还将通过避免重复和冗余对象来帮助你编写更高效的代码。最后但同样重要的是，它将使你的代码更加易于阅读。

+   在一个单独的 `php` 文件中，我们一次不会写超过一个类。超出该类的范围，我们不会写任何过程式代码。

+   我们将使用适当的命名约定来保存任何类。例如，我们将保存放置在本章前面引入的 `Emailer` 类的文件为 `class.emailer.php`。使用这种命名约定你能获得哪些好处？嗯，不进入那个文件，你现在至少可以确认这个文件包含一个名为 "Emailer" 的类。

+   永远不要在文件名中混合大小写。这会创建丑陋的应用程序结构。继续使用全部小写字母。

+   就像类一样，我们将任何接口保存为 `interface.name.php`，抽象类保存为 `abstract.name.php`，最终类保存为 `final.name.php`。

+   我们将始终使用驼峰式命名我们的类。这意味着主要部分的第一个字母总是大写，其余部分是小写。例如，一个名为 "arrayobject" 的类，如果我们写成 `ArrayObject`，将更容易阅读。

+   在编写属性或类变量名称时，我们将遵循相同的约定。

+   在编写方法名称时，我们将以小写字母开头，然后其余部分使用驼峰式。例如，一个用于发送电子邮件的方法可以命名为 `sendEmail`。

+   好吧，这本书中不再使用更多的约定。

# 摘要

在本章中，我们学习了面向对象编程以及它是如何与 PHP 结合的。我们还了解了一些相对于过程式和函数式编程的优势。然而，我们还没有详细学习 PHP 中的面向对象语言。在下一章中，我们将更多地了解对象及其方法和属性，特别是创建对象、扩展其功能和它们之间的交互。所以，让我们开始这段旅程吧，快乐地用 PHP 进行面向对象编程。
